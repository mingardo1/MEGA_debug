<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>232</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    232
                    <a href="231.html">prev</a>
                    <a href="233.html">next</a>
                    <a href="232_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_fd1394d8a0df0583b1f2c7c6fefa993051f65c10_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexServiceImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;fd1394d8a0df0583b1f2c7c6fefa993051f65c10:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexServiceImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;fd1394d8a0df0583b1f2c7c6fefa993051f65c10^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexServiceImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;fd1394d8a0df0583b1f2c7c6fefa993051f65c10^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexServiceImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;f40b9b4e9d4d9c82000944599b1a359d6f8adba4:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexServiceImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="1122494097902733579" onmouseenter="enter('1122494097902733579');" onmouseout="out('1122494097902733579');" style="">  18 package org.broadleafcommerce.core.search.service.solr.index;                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="7358117227230759843" onmouseenter="enter('7358117227230759843');" onmouseout="out('7358117227230759843');" style="">  21 import org.apache.commons.lang3.ObjectUtils;                                                             </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5774725166806839225" onmouseenter="enter('5774725166806839225');" onmouseout="out('5774725166806839225');" style="">  25 import org.apache.solr.client.solrj.SolrClient;                                                          </span>
<span class="2534520300286315365" onmouseenter="enter('2534520300286315365');" onmouseout="out('2534520300286315365');" style="">  26 import org.apache.solr.client.solrj.SolrServerException;                                                 </span>
<span class="3039478051879307902" onmouseenter="enter('3039478051879307902');" onmouseout="out('3039478051879307902');" style="">  27 import org.apache.solr.common.SolrInputDocument;                                                         </span>
<span class="-5062615271713994505" onmouseenter="enter('-5062615271713994505');" onmouseout="out('-5062615271713994505');" style="">  28 import org.apache.solr.common.SolrInputField;                                                            </span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  29 import org.broadleafcommerce.common.exception.ExceptionHelper;                                           </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  30 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  31 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  32 import org.broadleafcommerce.common.locale.domain.Locale;                                                </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  33 import org.broadleafcommerce.common.locale.service.LocaleService;                                        </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  34 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-4286566313930798693" onmouseenter="enter('-4286566313930798693');" onmouseout="out('-4286566313930798693');" style="">  35 import org.broadleafcommerce.common.site.domain.Catalog;                                                 </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  36 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-8450438836187654019" onmouseenter="enter('-8450438836187654019');" onmouseout="out('-8450438836187654019');" style="">  37 import org.broadleafcommerce.common.util.StopWatch;                                                      </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  38 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  39 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  40 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  41 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="-4682247906377627479" onmouseenter="enter('-4682247906377627479');" onmouseout="out('-4682247906377627479');" style="">  42 import org.broadleafcommerce.core.catalog.dao.ProductDao;                                                </span>
<span class="819600147337546609" onmouseenter="enter('819600147337546609');" onmouseout="out('819600147337546609');" style="">  43 import org.broadleafcommerce.core.catalog.domain.Indexable;                                              </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  44 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-8898703314888663548" onmouseenter="enter('-8898703314888663548');" onmouseout="out('-8898703314888663548');" style="">  45 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuActiveDatesService;                  </span>
<span class="4379279529485441894" onmouseenter="enter('4379279529485441894');" onmouseout="out('4379279529485441894');" style="">  46 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuPricingService;                      </span>
<span class="-3681422864492833385" onmouseenter="enter('-3681422864492833385');" onmouseout="out('-3681422864492833385');" style="">  47 import org.broadleafcommerce.core.catalog.service.dynamic.SkuActiveDateConsiderationContext;             </span>
<span class="-829094426310214064" onmouseenter="enter('-829094426310214064');" onmouseout="out('-829094426310214064');" style="">  48 import org.broadleafcommerce.core.catalog.service.dynamic.SkuPricingConsiderationContext;                </span>
<span class="-1576266836408736884" onmouseenter="enter('-1576266836408736884');" onmouseout="out('-1576266836408736884');" style="">  49 import org.broadleafcommerce.core.search.dao.CatalogStructure;                                           </span>
<span class="3400766289256993125" onmouseenter="enter('3400766289256993125');" onmouseout="out('3400766289256993125');" style="">  50 import org.broadleafcommerce.core.search.dao.FieldDao;                                                   </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  51 import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                              </span>
<span class="920426074093689209" onmouseenter="enter('920426074093689209');" onmouseout="out('920426074093689209');" style="">  52 import org.broadleafcommerce.core.search.dao.SearchFacetDao;                                             </span>
<span class="-5322157128750858217" onmouseenter="enter('-5322157128750858217');" onmouseout="out('-5322157128750858217');" style="">  53 import org.broadleafcommerce.core.search.dao.SolrIndexDao;                                               </span>
<span class="4766648382130970293" onmouseenter="enter('4766648382130970293');" onmouseout="out('4766648382130970293');" style="">  54 import org.broadleafcommerce.core.search.domain.Field;                                                   </span>
<span class="-5357326536069928479" onmouseenter="enter('-5357326536069928479');" onmouseout="out('-5357326536069928479');" style="">  55 import org.broadleafcommerce.core.search.domain.FieldEntity;                                             </span>
<span class="6698299629643684636" onmouseenter="enter('6698299629643684636');" onmouseout="out('6698299629643684636');" style="">  56 import org.broadleafcommerce.core.search.domain.IndexField;                                              </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  57 import org.broadleafcommerce.core.search.domain.IndexFieldType;                                          </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  58 import org.broadleafcommerce.core.search.domain.solr.FieldType;                                          </span>
<span class="5698008419148469327" onmouseenter="enter('5698008419148469327');" onmouseout="out('5698008419148469327');" style="">  59 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;                                 </span>
<span class="1831820877510608733" onmouseenter="enter('1831820877510608733');" onmouseout="out('1831820877510608733');" style="">  60 import org.broadleafcommerce.core.search.service.solr.SolrHelperService;                                 </span>
<span class="-138378224551372777" onmouseenter="enter('-138378224551372777');" onmouseout="out('-138378224551372777');" style="">  61 import org.springframework.beans.factory.InitializingBean;                                               </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  62 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  63 import org.springframework.beans.factory.annotation.Qualifier;                                           </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  64 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  65 import org.springframework.stereotype.Service;                                                           </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  66 import org.springframework.transaction.PlatformTransactionManager;                                       </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  67 import org.springframework.transaction.TransactionDefinition;                                            </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  68 import org.springframework.transaction.TransactionStatus;                                                </span>
<span  style="">  69                                                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  70 import java.io.IOException;                                                                              </span>
<span class="5727252987923913" onmouseenter="enter('5727252987923913');" onmouseout="out('5727252987923913');" style="">  71 import java.lang.reflect.InvocationTargetException;                                                      </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  72 import java.math.BigDecimal;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  73 import java.util.ArrayList;                                                                              </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  74 import java.util.Collection;                                                                             </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  75 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  76 import java.util.HashSet;                                                                                </span>
<span class="5562422284534979298" onmouseenter="enter('5562422284534979298');" onmouseout="out('5562422284534979298');" style="">  77 import java.util.LinkedHashMap;                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  78 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  79 import java.util.Map;                                                                                    </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  80 import java.util.Map.Entry;                                                                              </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  81 import java.util.Set;                                                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  83 import javax.annotation.Resource;                                                                        </span>
<span  style="">  84                                                                                                          </span>
<span  style="">  85                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  86 /**                                                                                                      </span>
<span class="2637600201222846009" onmouseenter="enter('2637600201222846009');" onmouseout="out('2637600201222846009');" style="">  87  * Responsible for building and rebuilding the Solr index                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  88  *                                                                                                       </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  89  * @author Andre Azzolini (apazzolini)                                                                   </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  90  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  91  */                                                                                                      </span>
<span class="5147427781650963861" onmouseenter="enter('5147427781650963861');" onmouseout="out('5147427781650963861');" style="">  92 @Service(&quot;blSolrIndexService&quot;)                                                                           </span>
<span class="7238718603103423444" onmouseenter="enter('7238718603103423444');" onmouseout="out('7238718603103423444');" style="">  93 public class SolrIndexServiceImpl implements SolrIndexService, InitializingBean {                        </span>
<span  style="">  94                                                                                                          </span>
<span class="2912831792317267849" onmouseenter="enter('2912831792317267849');" onmouseout="out('2912831792317267849');" style="">  95     private static final Log LOG = LogFactory.getLog(SolrIndexServiceImpl.class);                        </span>
<span  style="">  96                                                                                                          </span>
<span class="-8977974913293567232" onmouseenter="enter('-8977974913293567232');" onmouseout="out('-8977974913293567232');" style="">  97     @Qualifier(&quot;blCatalogSolrConfiguration&quot;)                                                             </span>
<span class="2602789178515286342" onmouseenter="enter('2602789178515286342');" onmouseout="out('2602789178515286342');" style="">  98     @Autowired(required = false)                                                                         </span>
<span class="-8579597795724805463" onmouseenter="enter('-8579597795724805463');" onmouseout="out('-8579597795724805463');" style="">  99     protected SolrConfiguration solrConfiguration;                                                       </span>
<span  style=""> 100                                                                                                          </span>
<span class="2195771720820037705" onmouseenter="enter('2195771720820037705');" onmouseout="out('2195771720820037705');" style=""> 101     @Value(&quot;${solr.index.errorOnConcurrentReIndex}&quot;)                                                     </span>
<span class="-1712197847076792635" onmouseenter="enter('-1712197847076792635');" onmouseout="out('-1712197847076792635');" style=""> 102     protected boolean errorOnConcurrentReIndex = false;                                                  </span>
<span  style=""> 103                                                                                                          </span>
<span class="7048903042822364298" onmouseenter="enter('7048903042822364298');" onmouseout="out('7048903042822364298');" style=""> 104     @Value(&quot;${solr.index.product.pageSize}&quot;)                                                             </span>
<span class="-4484811886017880292" onmouseenter="enter('-4484811886017880292');" onmouseout="out('-4484811886017880292');" style=""> 105     protected int pageSize;                                                                              </span>
<span  style=""> 106                                                                                                          </span>
<span class="8105652327274456362" onmouseenter="enter('8105652327274456362');" onmouseout="out('8105652327274456362');" style=""> 107     @Value(&quot;${solr.index.commit}&quot;)                                                                       </span>
<span class="2310160779081566815" onmouseenter="enter('2310160779081566815');" onmouseout="out('2310160779081566815');" style=""> 108     protected boolean commit;                                                                            </span>
<span  style=""> 109                                                                                                          </span>
<span class="4958585362396000858" onmouseenter="enter('4958585362396000858');" onmouseout="out('4958585362396000858');" style=""> 110     @Value(&quot;${solr.index.softCommit}&quot;)                                                                   </span>
<span class="-7523707349512810888" onmouseenter="enter('-7523707349512810888');" onmouseout="out('-7523707349512810888');" style=""> 111     protected boolean softCommit;                                                                        </span>
<span  style=""> 112                                                                                                          </span>
<span class="2752166020843058826" onmouseenter="enter('2752166020843058826');" onmouseout="out('2752166020843058826');" style=""> 113     @Value(&quot;${solr.index.waitSearcher}&quot;)                                                                 </span>
<span class="-7977681737585438995" onmouseenter="enter('-7977681737585438995');" onmouseout="out('-7977681737585438995');" style=""> 114     protected boolean waitSearcher;                                                                      </span>
<span  style=""> 115                                                                                                          </span>
<span class="-1787870543439636120" onmouseenter="enter('-1787870543439636120');" onmouseout="out('-1787870543439636120');" style=""> 116     @Value(&quot;${solr.index.waitFlush}&quot;)                                                                    </span>
<span class="-1071744707232356027" onmouseenter="enter('-1071744707232356027');" onmouseout="out('-1071744707232356027');" style=""> 117     protected boolean waitFlush;                                                                         </span>
<span  style=""> 118                                                                                                          </span>
<span class="-504996646074126996" onmouseenter="enter('-504996646074126996');" onmouseout="out('-504996646074126996');" style=""> 119     @Value(value = &quot;${solr.catalog.useLegacySolrIndexer:true}&quot;)                                          </span>
<span class="598047637926589746" onmouseenter="enter('598047637926589746');" onmouseout="out('598047637926589746');" style=""> 120     protected boolean useLegacySolrIndexer = true;                                                       </span>
<span  style=""> 121                                                                                                          </span>
<span class="-8581768554675866702" onmouseenter="enter('-8581768554675866702');" onmouseout="out('-8581768554675866702');" style=""> 122     @Resource(name = &quot;blProductDao&quot;)                                                                     </span>
<span class="8458703512033747413" onmouseenter="enter('8458703512033747413');" onmouseout="out('8458703512033747413');" style=""> 123     protected ProductDao productDao;                                                                     </span>
<span  style=""> 124                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style=""> 125     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 126     protected CatalogService catalogService;                                                             </span>
<span  style=""> 127                                                                                                          </span>
<span class="8745422771459947563" onmouseenter="enter('8745422771459947563');" onmouseout="out('8745422771459947563');" style=""> 128     @Resource(name = &quot;blFieldDao&quot;)                                                                       </span>
<span class="-5779425042369505145" onmouseenter="enter('-5779425042369505145');" onmouseout="out('-5779425042369505145');" style=""> 129     protected FieldDao fieldDao;                                                                         </span>
<span  style=""> 130                                                                                                          </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style=""> 131     @Resource(name = &quot;blLocaleService&quot;)                                                                  </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style=""> 132     protected LocaleService localeService;                                                               </span>
<span  style=""> 133                                                                                                          </span>
<span class="3433532014428154380" onmouseenter="enter('3433532014428154380');" onmouseout="out('3433532014428154380');" style=""> 134     @Resource(name = &quot;blSolrHelperService&quot;)                                                              </span>
<span class="-7677498150151406376" onmouseenter="enter('-7677498150151406376');" onmouseout="out('-7677498150151406376');" style=""> 135     protected SolrHelperService shs;                                                                     </span>
<span  style=""> 136                                                                                                          </span>
<span class="6454351128227777183" onmouseenter="enter('6454351128227777183');" onmouseout="out('6454351128227777183');" style=""> 137     @Resource(name = &quot;blSolrIndexServiceExtensionManager&quot;)                                               </span>
<span class="5247479920184811971" onmouseenter="enter('5247479920184811971');" onmouseout="out('5247479920184811971');" style=""> 138     protected SolrIndexServiceExtensionManager extensionManager;                                         </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 140     @Resource(name = &quot;blTransactionManager&quot;)                                                             </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 141     protected PlatformTransactionManager transactionManager;                                             </span>
<span  style=""> 142                                                                                                          </span>
<span class="-2777716978602743792" onmouseenter="enter('-2777716978602743792');" onmouseout="out('-2777716978602743792');" style=""> 143     @Resource(name = &quot;blSolrIndexDao&quot;)                                                                   </span>
<span class="2803857682022434599" onmouseenter="enter('2803857682022434599');" onmouseout="out('2803857682022434599');" style=""> 144     protected SolrIndexDao solrIndexDao;                                                                 </span>
<span  style=""> 145                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 146     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 147     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 148                                                                                                          </span>
<span class="722550641335667641" onmouseenter="enter('722550641335667641');" onmouseout="out('722550641335667641');" style=""> 149     @Resource(name = &quot;blSearchFacetDao&quot;)                                                                 </span>
<span class="-2192164507887589197" onmouseenter="enter('-2192164507887589197');" onmouseout="out('-2192164507887589197');" style=""> 150     protected SearchFacetDao searchFacetDao;                                                             </span>
<span  style=""> 151                                                                                                          </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style=""> 152     @Resource(name = &quot;blIndexFieldDao&quot;)                                                                  </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style=""> 153     protected IndexFieldDao indexFieldDao;                                                               </span>
<span  style=""> 154                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 155     @Override                                                                                            </span>
<span class="293221034776945003" onmouseenter="enter('293221034776945003');" onmouseout="out('293221034776945003');" style=""> 156     public void afterPropertiesSet() throws Exception {                                                  </span>
<span class="8737826944751881878" onmouseenter="enter('8737826944751881878');" onmouseout="out('8737826944751881878');" style=""> 157         if (!useLegacySolrIndexer) {                                                                     </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style=""> 158             if (useSku) {                                                                                </span>
<span class="9179894285227722563" onmouseenter="enter('9179894285227722563');" onmouseout="out('9179894285227722563');" style=""><abbr title=" 159                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.use.sku&#x27; was true, which is not supported.&quot;);"> 159                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was falðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160             }                                                                                            </span>
<span class="-3752749985901808876" onmouseenter="enter('-3752749985901808876');" onmouseout="out('-3752749985901808876');" style=""> 161             if (solrConfiguration != null &amp;&amp; solrConfiguration.isSiteCollections()) {                    </span>
<span class="-7184456578586809293" onmouseenter="enter('-7184456578586809293');" onmouseout="out('-7184456578586809293');" style=""><abbr title=" 162                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.site.collections&#x27; was true, which is not supported.&quot;);"> 162                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was falðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165     }                                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="4861142252788854730" onmouseenter="enter('4861142252788854730');" onmouseout="out('4861142252788854730');" style=""> 167     @Value(value = &quot;${enable.solr.optimize:false}&quot;)                                                      </span>
<span class="-7987045041834234094" onmouseenter="enter('-7987045041834234094');" onmouseout="out('-7987045041834234094');" style=""> 168     private boolean optimizeEnabled;                                                                     </span>
<span  style=""> 169                                                                                                          </span>
<span  style=""> 170                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 171     @Override                                                                                            </span>
<span class="-1854653869970518806" onmouseenter="enter('-1854653869970518806');" onmouseout="out('-1854653869970518806');" style=""><abbr title=" 172     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException {"> 172     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 173         try {                                                                                            </span>
<span class="2574663780463066494" onmouseenter="enter('2574663780463066494');" onmouseout="out('2574663780463066494');" style=""> 174             CatalogStructure cache = new CatalogStructure();                                             </span>
<span class="1856999562212420811" onmouseenter="enter('1856999562212420811');" onmouseout="out('1856999562212420811');" style=""> 175             SolrIndexCachedOperation.setCache(cache);                                                    </span>
<span class="-195994336271238110" onmouseenter="enter('-195994336271238110');" onmouseout="out('-195994336271238110');" style=""> 176             cacheOperation.execute();                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 177         } finally {                                                                                      </span>
<span class="7293095816713805281" onmouseenter="enter('7293095816713805281');" onmouseout="out('7293095816713805281');" style=""> 178             SolrIndexCachedOperation.clearCache();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span  style=""> 181                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 182     @Override                                                                                            </span>
<span class="-8221211564360382808" onmouseenter="enter('-8221211564360382808');" onmouseout="out('-8221211564360382808');" style=""> 183     public void rebuildIndex() throws ServiceException, IOException {                                    </span>
<span class="4404402464743924238" onmouseenter="enter('4404402464743924238');" onmouseout="out('4404402464743924238');" style=""> 184         LOG.info(&quot;Rebuilding the entire Solr index...&quot;);                                                 </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 185         StopWatch s = new StopWatch();                                                                   </span>
<span  style=""> 186                                                                                                          </span>
<span class="2782448594641417849" onmouseenter="enter('2782448594641417849');" onmouseout="out('2782448594641417849');" style=""> 187         preBuildIndex();                                                                                 </span>
<span class="5364167027467208466" onmouseenter="enter('5364167027467208466');" onmouseout="out('5364167027467208466');" style=""> 188         buildIndex();                                                                                    </span>
<span class="-2734214044106280557" onmouseenter="enter('-2734214044106280557');" onmouseout="out('-2734214044106280557');" style=""> 189         postBuildIndex();                                                                                </span>
<span  style=""> 190                                                                                                          </span>
<span class="8949756262532963545" onmouseenter="enter('8949756262532963545');" onmouseout="out('8949756262532963545');" style=""> 191         LOG.info(String.format(&quot;Finished building entire Solr index in %s&quot;, s.toLapString()));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192     }                                                                                                    </span>
<span  style=""> 193                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 194     @Override                                                                                            </span>
<span class="3237807690855435825" onmouseenter="enter('3237807690855435825');" onmouseout="out('3237807690855435825');" style=""> 195     public void preBuildIndex() throws ServiceException {                                                </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style=""><abbr title=" 196         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 196         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197     }                                                                                                    </span>
<span  style=""> 198                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 199     @Override                                                                                            </span>
<span class="107860368930590037" onmouseenter="enter('107860368930590037');" onmouseout="out('107860368930590037');" style=""> 200     public void buildIndex() throws IOException, ServiceException {                                      </span>
<span class="5469402358120203042" onmouseenter="enter('5469402358120203042');" onmouseout="out('5469402358120203042');" style=""> 201         executeSolrIndexOperation(getReindexOperation());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 204     @Override                                                                                            </span>
<span class="2712485588427861869" onmouseenter="enter('2712485588427861869');" onmouseout="out('2712485588427861869');" style=""> 205     public void postBuildIndex() throws IOException, ServiceException {                                  </span>
<span class="8445746639246064219" onmouseenter="enter('8445746639246064219');" onmouseout="out('8445746639246064219');" style=""> 206         if(optimizeEnabled) {                                                                            </span>
<span class="4104911694494191311" onmouseenter="enter('4104911694494191311');" onmouseout="out('4104911694494191311');" style=""> 207             // this is required to be at the very very very end after rebuilding the whole index         </span>
<span class="-3594378582194653803" onmouseenter="enter('-3594378582194653803');" onmouseout="out('-3594378582194653803');" style=""><abbr title=" 208             optimizeIndex(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 208             optimizeIndex(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209         }                                                                                                </span>
<span class="-7179442614804219935" onmouseenter="enter('-7179442614804219935');" onmouseout="out('-7179442614804219935');" style=""> 210         // Swap the active and the reindex cores                                                         </span>
<span class="-211335379164132987" onmouseenter="enter('-211335379164132987');" onmouseout="out('-211335379164132987');" style=""> 211         if (!solrConfiguration.isSingleCoreMode()) {                                                     </span>
<span class="-1073514264710403192" onmouseenter="enter('-1073514264710403192');" onmouseout="out('-1073514264710403192');" style=""> 212             shs.swapActiveCores(solrConfiguration);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 216     @Override                                                                                            </span>
<span class="-811355888891304948" onmouseenter="enter('-811355888891304948');" onmouseout="out('-811355888891304948');" style=""> 217     public SolrIndexOperation getReindexOperation() {                                                    </span>
<span class="4313634092062438466" onmouseenter="enter('4313634092062438466');" onmouseout="out('4313634092062438466');" style=""><abbr title=" 218         return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex) {"> 218         return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex)ðŸ”µ</abbr></span>
<span  style=""> 219                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 220             @Override                                                                                    </span>
<span class="-4387595312024622473" onmouseenter="enter('-4387595312024622473');" onmouseout="out('-4387595312024622473');" style=""> 221             public List&lt;? extends Indexable&gt; readIndexables(int pageSize, Long lastId) {                 </span>
<span class="4006405235344016633" onmouseenter="enter('4006405235344016633');" onmouseout="out('4006405235344016633');" style=""> 222                 return readAllActiveIndexables(pageSize, lastId);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223             }                                                                                            </span>
<span  style=""> 224                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225             @Override                                                                                    </span>
<span class="5959961393917647667" onmouseenter="enter('5959961393917647667');" onmouseout="out('5959961393917647667');" style=""> 226             public Long countIndexables() {                                                              </span>
<span class="2520275452674275986" onmouseenter="enter('2520275452674275986');" onmouseout="out('2520275452674275986');" style=""> 227                 return countIndexableItems();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228             }                                                                                            </span>
<span  style=""> 229                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 230             @Override                                                                                    </span>
<span class="-1692826682113823468" onmouseenter="enter('-1692826682113823468');" onmouseout="out('-1692826682113823468');" style=""> 231             public void buildPage(List&lt;? extends Indexable&gt; indexables) throws ServiceException {        </span>
<span class="3979625068666947530" onmouseenter="enter('3979625068666947530');" onmouseout="out('3979625068666947530');" style=""><abbr title=" 232                 buildIncrementalIndex(getSolrCollectionForIndexing(), indexables, getSolrServerForIndexing());"> 232                 buildIncrementalIndex(getSolrCollectionForIndexing(), indexables, getSolrServerForIndexinðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 234         };                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 237     @Override                                                                                            </span>
<span class="-4119273796811407274" onmouseenter="enter('-4119273796811407274');" onmouseout="out('-4119273796811407274');" style=""><abbr title=" 238     public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOException {"> 238     public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOðŸ”µ</abbr></span>
<span class="-6605112368804100748" onmouseenter="enter('-6605112368804100748');" onmouseout="out('-6605112368804100748');" style=""> 239         operation.obtainLock();                                                                          </span>
<span  style=""> 240                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 241         try {                                                                                            </span>
<span class="5776764097449375233" onmouseenter="enter('5776764097449375233');" onmouseout="out('5776764097449375233');" style=""> 242             LOG.info(&quot;Executing Indexing operation&quot;);                                                    </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 243             StopWatch s = new StopWatch();                                                               </span>
<span  style=""> 244                                                                                                          </span>
<span class="-4925351317711298127" onmouseenter="enter('-4925351317711298127');" onmouseout="out('-4925351317711298127');" style=""> 245             Object[] pack = saveState();                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 246             try {                                                                                        </span>
<span class="4852869320838830283" onmouseenter="enter('4852869320838830283');" onmouseout="out('4852869320838830283');" style=""> 247                 final Long numItemsToIndex;                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 248                 try {                                                                                    </span>
<span class="997617649642836840" onmouseenter="enter('997617649642836840');" onmouseout="out('997617649642836840');" style=""> 249                     operation.beforeCountIndexables();                                                   </span>
<span  style=""> 250                                                                                                          </span>
<span class="-8341915703694509082" onmouseenter="enter('-8341915703694509082');" onmouseout="out('-8341915703694509082');" style=""> 251                     numItemsToIndex = operation.countIndexables();                                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 252                 } finally {                                                                              </span>
<span class="8625682159596383443" onmouseenter="enter('8625682159596383443');" onmouseout="out('8625682159596383443');" style=""> 253                     operation.afterCountIndexables();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                 }                                                                                        </span>
<span  style=""> 255                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 256                 if (LOG.isDebugEnabled()) {                                                              </span>
<span class="-1342537230534112505" onmouseenter="enter('-1342537230534112505');" onmouseout="out('-1342537230534112505');" style=""> 257                     LOG.debug(&quot;There are at most &quot; + numItemsToIndex + &quot; items to index&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258                 }                                                                                        </span>
<span class="-6975585634623067095" onmouseenter="enter('-6975585634623067095');" onmouseout="out('-6975585634623067095');" style=""> 259                 performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {                   </span>
<span  style=""> 260                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 261                     @Override                                                                            </span>
<span class="-7096128206041696180" onmouseenter="enter('-7096128206041696180');" onmouseout="out('-7096128206041696180');" style=""> 262                     public void execute() throws ServiceException {                                      </span>
<span class="-4395739824177979579" onmouseenter="enter('-4395739824177979579');" onmouseout="out('-4395739824177979579');" style=""> 263                         int page = 1;                                                                    </span>
<span class="4634490409390119351" onmouseenter="enter('4634490409390119351');" onmouseout="out('4634490409390119351');" style=""> 264                         Long lastId = null;                                                              </span>
<span class="-2807153128771866015" onmouseenter="enter('-2807153128771866015');" onmouseout="out('-2807153128771866015');" style=""> 265                         Long remainingNumItemsToIndex = numItemsToIndex;                                 </span>
<span class="-6866370637183701575" onmouseenter="enter('-6866370637183701575');" onmouseout="out('-6866370637183701575');" style=""> 266                         Long totalPages = getTotalPageCount(numItemsToIndex);                            </span>
<span  style=""> 267                                                                                                          </span>
<span class="-2134634807912211771" onmouseenter="enter('-2134634807912211771');" onmouseout="out('-2134634807912211771');" style=""> 268                         while (remainingNumItemsToIndex &gt; 0) {                                           </span>
<span class="6951794882859960666" onmouseenter="enter('6951794882859960666');" onmouseout="out('6951794882859960666');" style=""> 269                             String pageNumberMessage = buildPageNumberMessage(page, totalPages);         </span>
<span class="5716330204152709052" onmouseenter="enter('5716330204152709052');" onmouseout="out('5716330204152709052');" style=""> 270                             LOG.info(pageNumberMessage);                                                 </span>
<span  style=""> 271                                                                                                          </span>
<span class="165772722778294439" onmouseenter="enter('165772722778294439');" onmouseout="out('165772722778294439');" style=""> 272                             lastId = buildIncrementalIndex(pageSize, lastId, operation);                 </span>
<span class="-4024045770293484238" onmouseenter="enter('-4024045770293484238');" onmouseout="out('-4024045770293484238');" style=""> 273                             remainingNumItemsToIndex -= pageSize;                                        </span>
<span class="-8284897147643623971" onmouseenter="enter('-8284897147643623971');" onmouseout="out('-8284897147643623971');" style=""> 274                             page++;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 277                 });                                                                                      </span>
<span  style=""> 278                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 279             } finally {                                                                                  </span>
<span class="-5823413484715712161" onmouseenter="enter('-5823413484715712161');" onmouseout="out('-5823413484715712161');" style=""> 280                 restoreState(pack);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281             }                                                                                            </span>
<span  style=""> 282                                                                                                          </span>
<span class="7093623796813341550" onmouseenter="enter('7093623796813341550');" onmouseout="out('7093623796813341550');" style=""> 283             LOG.info(String.format(&quot;Indexing operation completed in %s&quot;, s.toLapString()));              </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 284         } finally {                                                                                      </span>
<span class="-1350180452435495402" onmouseenter="enter('-1350180452435495402');" onmouseout="out('-1350180452435495402');" style=""> 285             operation.releaseLock();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287     }                                                                                                    </span>
<span  style=""> 288                                                                                                          </span>
<span class="4509881942909907564" onmouseenter="enter('4509881942909907564');" onmouseout="out('4509881942909907564');" style=""> 289     protected long getTotalPageCount(Long numItemsToIndex) {                                             </span>
<span class="885623822255204209" onmouseenter="enter('885623822255204209');" onmouseout="out('885623822255204209');" style=""> 290         long numPagesToIndex = numItemsToIndex / pageSize;                                               </span>
<span class="1202091708155781117" onmouseenter="enter('1202091708155781117');" onmouseout="out('1202091708155781117');" style=""> 291         boolean hasRemainingItemsToIndex = numItemsToIndex % pageSize != 0;                              </span>
<span  style=""> 292                                                                                                          </span>
<span class="-8914515660918232216" onmouseenter="enter('-8914515660918232216');" onmouseout="out('-8914515660918232216');" style=""> 293         return hasRemainingItemsToIndex ? (numPagesToIndex + 1) : numPagesToIndex;                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294     }                                                                                                    </span>
<span  style=""> 295                                                                                                          </span>
<span class="-1140169622753247687" onmouseenter="enter('-1140169622753247687');" onmouseout="out('-1140169622753247687');" style=""> 296     protected String buildPageNumberMessage(int page, Long totalPages) {                                 </span>
<span class="5185167171670482872" onmouseenter="enter('5185167171670482872');" onmouseout="out('5185167171670482872');" style=""> 297         String pageNumberMessage = String.format(&quot;Building page number %s of %s&quot;, page, totalPages);     </span>
<span  style=""> 298                                                                                                          </span>
<span class="3917690980387875903" onmouseenter="enter('3917690980387875903');" onmouseout="out('3917690980387875903');" style=""><abbr title=" 299         Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog();"> 299         Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog()ðŸ”µ</abbr></span>
<span class="3059190135946477261" onmouseenter="enter('3059190135946477261');" onmouseout="out('3059190135946477261');" style=""> 300         if (currentCatalog != null) {                                                                    </span>
<span class="-2760479412731933677" onmouseenter="enter('-2760479412731933677');" onmouseout="out('-2760479412731933677');" style=""> 301             pageNumberMessage += String.format(&quot; for catalog: %s&quot;, currentCatalog.getName());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302         }                                                                                                </span>
<span  style=""> 303                                                                                                          </span>
<span class="6061536256827306935" onmouseenter="enter('6061536256827306935');" onmouseout="out('6061536256827306935');" style=""> 304         return pageNumberMessage;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305     }                                                                                                    </span>
<span  style=""> 306                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 307     /**                                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 308      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 309      */                                                                                                  </span>
<span class="307261357449118205" onmouseenter="enter('307261357449118205');" onmouseout="out('307261357449118205');" style=""> 310     protected Long countIndexableItems() {                                                               </span>
<span class="3881831181376649254" onmouseenter="enter('3881831181376649254');" onmouseout="out('3881831181376649254');" style=""> 311         return productDao.readCountAllActiveProducts();                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312     }                                                                                                    </span>
<span  style=""> 313                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 314     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 315      * &lt;p&gt;                                                                                               </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 316      * This method deletes all of the documents from {@link SolrContext#getReindexServer()}              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 317      *                                                                                                   </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 318      * @throws ServiceException if there was a problem removing the documents                            </span>
<span class="-1570570320656419415" onmouseenter="enter('-1570570320656419415');" onmouseout="out('-1570570320656419415');" style=""> 319      * @deprecated use {@link #deleteAllReindexCoreDocuments()} instead                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 320      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 321     @Deprecated                                                                                          </span>
<span class="7799053882932808400" onmouseenter="enter('7799053882932808400');" onmouseout="out('7799053882932808400');" style=""> 322     protected void deleteAllDocuments() throws ServiceException {                                        </span>
<span class="3834807060428836051" onmouseenter="enter('3834807060428836051');" onmouseout="out('3834807060428836051');" style=""> 323         deleteAllReindexCoreDocuments();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324     }                                                                                                    </span>
<span  style=""> 325                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 326     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 327      * &lt;p&gt;                                                                                               </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 328      * This method deletes all of the documents from {@link SolrContext#getReindexServer()}              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 329      *                                                                                                   </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 330      * @throws ServiceException if there was a problem removing the documents                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 331      */                                                                                                  </span>
<span class="6870158579484852535" onmouseenter="enter('6870158579484852535');" onmouseout="out('6870158579484852535');" style=""> 332     protected void deleteAllReindexCoreDocuments() throws ServiceException {                             </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style=""><abbr title=" 333         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 333         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 336     @Override                                                                                            </span>
<span class="-4976975123662493196" onmouseenter="enter('-4976975123662493196');" onmouseout="out('-4976975123662493196');" style=""><abbr title=" 337     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException {"> 337     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 338         try {                                                                                            </span>
<span class="-6389361698931234700" onmouseenter="enter('-6389361698931234700');" onmouseout="out('-6389361698931234700');" style=""> 339             String deleteQuery = StringUtil.sanitize(shs.getNamespaceFieldName()) + &quot;:(\&quot;&quot;               </span>
<span class="-1195999488596466196" onmouseenter="enter('-1195999488596466196');" onmouseout="out('-1195999488596466196');" style=""> 340                     + StringUtil.sanitize(solrConfiguration.getNamespace()) + &quot;\&quot;)&quot;;                     </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 341             LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                              </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style=""> 342             server.deleteByQuery(collection, deleteQuery);                                               </span>
<span  style=""> 343                                                                                                          </span>
<span class="-546379745910436336" onmouseenter="enter('-546379745910436336');" onmouseout="out('-546379745910436336');" style=""> 344             //Explicitly do a hard commit here since we just deleted the entire index                    </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style=""> 345             server.commit(collection);                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 346         } catch (Exception e) {                                                                          </span>
<span class="4280241435178863824" onmouseenter="enter('4280241435178863824');" onmouseout="out('4280241435178863824');" style=""> 347             if (ServiceException.class.isAssignableFrom(e.getClass())) {                                 </span>
<span class="-9048611182670468194" onmouseenter="enter('-9048611182670468194');" onmouseout="out('-9048611182670468194');" style=""> 348                 throw (ServiceException) e;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349             }                                                                                            </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 350             throw new ServiceException(&quot;Could not delete documents&quot;, e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352     }                                                                                                    </span>
<span  style=""> 353                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 354     @Override                                                                                            </span>
<span class="8552288591606532671" onmouseenter="enter('8552288591606532671');" onmouseout="out('8552288591606532671');" style=""> 355     public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException {       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 356         try {                                                                                            </span>
<span class="2136303103230726070" onmouseenter="enter('2136303103230726070');" onmouseout="out('2136303103230726070');" style=""> 357             String deleteQuery = &quot;*:*&quot;;                                                                  </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 358             LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                              </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style=""> 359             server.deleteByQuery(collection, deleteQuery);                                               </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style=""> 360             server.commit(collection);                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 361         } catch (Exception e) {                                                                          </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 362             throw new ServiceException(&quot;Could not delete documents&quot;, e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364     }                                                                                                    </span>
<span  style=""> 365                                                                                                          </span>
<span class="-1911085678082561084" onmouseenter="enter('-1911085678082561084');" onmouseout="out('-1911085678082561084');" style=""><abbr title=" 366     protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ServiceException {"> 366     protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ðŸ”µ</abbr></span>
<span class="1006805691441623516" onmouseenter="enter('1006805691441623516');" onmouseout="out('1006805691441623516');" style=""> 367         TransactionStatus status = TransactionUtils.createTransaction(&quot;readItemsToIndex&quot;,                </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 368             TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                       </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 369         if (SolrIndexCachedOperation.getCache() == null) {                                               </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 370             LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +   </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 371                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 371                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372         }                                                                                                </span>
<span class="-4530225541058778702" onmouseenter="enter('-4530225541058778702');" onmouseout="out('-4530225541058778702');" style=""> 373         Long response = null;                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 374         try {                                                                                            </span>
<span class="-3204111561138569714" onmouseenter="enter('-3204111561138569714');" onmouseout="out('-3204111561138569714');" style=""> 375             List&lt;? extends Indexable&gt; indexables;                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 376             try {                                                                                        </span>
<span class="3356995070675471983" onmouseenter="enter('3356995070675471983');" onmouseout="out('3356995070675471983');" style=""> 377                 operation.beforeReadIndexables();                                                        </span>
<span class="1315644369404660428" onmouseenter="enter('1315644369404660428');" onmouseout="out('1315644369404660428');" style=""> 378                 indexables = operation.readIndexables(pageSize, lastId);                                 </span>
<span class="-3163865863529807802" onmouseenter="enter('-3163865863529807802');" onmouseout="out('-3163865863529807802');" style=""> 379                 if (CollectionUtils.isNotEmpty(indexables)) {                                            </span>
<span class="1879209496515446980" onmouseenter="enter('1879209496515446980');" onmouseout="out('1879209496515446980');" style=""> 380                     response = indexables.get(indexables.size()-1).getId();                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381                 }                                                                                        </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 382             } finally {                                                                                  </span>
<span class="-7029725537576676912" onmouseenter="enter('-7029725537576676912');" onmouseout="out('-7029725537576676912');" style=""> 383                 operation.afterReadIndexables();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384             }                                                                                            </span>
<span  style=""> 385                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 386             try {                                                                                        </span>
<span class="-2168921446123257487" onmouseenter="enter('-2168921446123257487');" onmouseout="out('-2168921446123257487');" style=""> 387                 operation.beforeBuildPage();                                                             </span>
<span  style=""> 388                                                                                                          </span>
<span class="9094317700245591530" onmouseenter="enter('9094317700245591530');" onmouseout="out('9094317700245591530');" style=""> 389                 operation.buildPage(indexables);                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 390             } finally {                                                                                  </span>
<span class="3074038306845641791" onmouseenter="enter('3074038306845641791');" onmouseout="out('3074038306845641791');" style=""> 391                 operation.afterBuildPage();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392             }                                                                                            </span>
<span  style=""> 393                                                                                                          </span>
<span  style=""> 394                                                                                                          </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 395             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 396         } catch (RuntimeException e) {                                                                   </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 397             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 398             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 400         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 403     @Override                                                                                            </span>
<span class="-3229146772555478401" onmouseenter="enter('-3229146772555478401');" onmouseout="out('-3229146772555478401');" style=""><abbr title=" 404     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 404     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends IndexablðŸ”µ</abbr></span>
<span class="2510928886343537128" onmouseenter="enter('2510928886343537128');" onmouseout="out('2510928886343537128');" style=""> 405         TransactionStatus status = TransactionUtils.createTransaction(&quot;executeIncrementalIndex&quot;,         </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 406                 TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                   </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 407         if (SolrIndexCachedOperation.getCache() == null) {                                               </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 408             LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +   </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 409                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 409                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410         }                                                                                                </span>
<span  style=""> 411                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 412         if (LOG.isDebugEnabled()) {                                                                      </span>
<span class="5294183869527180393" onmouseenter="enter('5294183869527180393');" onmouseout="out('5294183869527180393');" style=""><abbr title=" 413             LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.size()));"> 413             LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414         }                                                                                                </span>
<span  style=""> 415                                                                                                          </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 416         StopWatch s = new StopWatch();                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 417         try {                                                                                            </span>
<span class="6539966544446663437" onmouseenter="enter('6539966544446663437');" onmouseout="out('6539966544446663437');" style=""> 418             sandBoxHelper.ignoreCloneCache(true);                                                        </span>
<span class="7183587253332869173" onmouseenter="enter('7183587253332869173');" onmouseout="out('7183587253332869173');" style=""> 419             extensionManager.getProxy().startBatchEvent(indexables);                                     </span>
<span class="3424650845291102605" onmouseenter="enter('3424650845291102605');" onmouseout="out('3424650845291102605');" style=""> 420             Collection&lt;SolrInputDocument&gt; documents = new ArrayList&lt;&gt;();                                 </span>
<span class="7801772952659649444" onmouseenter="enter('7801772952659649444');" onmouseout="out('7801772952659649444');" style=""> 421             List&lt;Locale&gt; locales = getAllLocales();                                                      </span>
<span  style=""> 422                                                                                                          </span>
<span class="-2189912087670236149" onmouseenter="enter('-2189912087670236149');" onmouseout="out('-2189912087670236149');" style=""><abbr title=" 423             List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;() {"> 423             List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 424                 @Override                                                                                </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 425                 public Long transform(Object input) {                                                    </span>
<span class="6561542425546767799" onmouseenter="enter('6561542425546767799');" onmouseout="out('6561542425546767799');" style=""> 426                     return shs.getCurrentProductId((Indexable) input);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 428             });                                                                                          </span>
<span  style=""> 429                                                                                                          </span>
<span class="-6904889408824287124" onmouseenter="enter('-6904889408824287124');" onmouseout="out('-6904889408824287124');" style=""><abbr title=" 430             solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache());"> 430             solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache())ðŸ”µ</abbr></span>
<span  style=""> 431                                                                                                          </span>
<span class="326959637207207549" onmouseenter="enter('326959637207207549');" onmouseout="out('326959637207207549');" style=""> 432             List&lt;IndexField&gt; fields = null;                                                              </span>
<span class="-1903082167184535893" onmouseenter="enter('-1903082167184535893');" onmouseout="out('-1903082167184535893');" style=""> 433             FieldEntity currentFieldType = null;                                                         </span>
<span class="-3671570197523764351" onmouseenter="enter('-3671570197523764351');" onmouseout="out('-3671570197523764351');" style=""> 434             for (Indexable indexable : indexables) {                                                     </span>
<span class="-6818188811001504815" onmouseenter="enter('-6818188811001504815');" onmouseout="out('-6818188811001504815');" style=""><abbr title=" 435                 if (fields == null || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityType())) {"> 435                 if (fields == null || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityTypeðŸ”µ</abbr></span>
<span class="4379308220695057970" onmouseenter="enter('4379308220695057970');" onmouseout="out('4379308220695057970');" style=""> 436                     fields = indexFieldDao.readFieldsByEntityType(indexable.getFieldEntityType());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437                 }                                                                                        </span>
<span  style=""> 438                                                                                                          </span>
<span class="7630570351050256200" onmouseenter="enter('7630570351050256200');" onmouseout="out('7630570351050256200');" style=""> 439                 SolrInputDocument doc = buildDocument(indexable, fields, locales);                       </span>
<span class="-3475311009677795568" onmouseenter="enter('-3475311009677795568');" onmouseout="out('-3475311009677795568');" style=""><abbr title=" 440                 //If someone overrides the buildDocument method and determines that they don&#x27;t want a product "> 440                 //If someone overrides the buildDocument method and determines that they don&#x27;t want a proðŸ”µ</abbr></span>
<span class="4539214609551390244" onmouseenter="enter('4539214609551390244');" onmouseout="out('4539214609551390244');" style=""> 441                 //indexed, then they can return null. If the document is null it does not get added to   </span>
<span class="-225951702109518326" onmouseenter="enter('-225951702109518326');" onmouseout="out('-225951702109518326');" style=""> 442                 //to the index.                                                                          </span>
<span class="-5520172171866318279" onmouseenter="enter('-5520172171866318279');" onmouseout="out('-5520172171866318279');" style=""> 443                 if (doc != null) {                                                                       </span>
<span class="4425904984588304942" onmouseenter="enter('4425904984588304942');" onmouseout="out('4425904984588304942');" style=""> 444                     documents.add(doc);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446             }                                                                                            </span>
<span  style=""> 447                                                                                                          </span>
<span class="-5162140986849793305" onmouseenter="enter('-5162140986849793305');" onmouseout="out('-5162140986849793305');" style=""> 448             extensionManager.getProxy().modifyBuiltDocuments(documents, indexables, fields, locales);    </span>
<span  style=""> 449                                                                                                          </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 450             logDocuments(documents);                                                                     </span>
<span  style=""> 451                                                                                                          </span>
<span class="-6239196544496643062" onmouseenter="enter('-6239196544496643062');" onmouseout="out('-6239196544496643062');" style=""> 452             if (!CollectionUtils.isEmpty(documents) &amp;&amp; solrServer != null) {                             </span>
<span class="6742664882868092095" onmouseenter="enter('6742664882868092095');" onmouseout="out('6742664882868092095');" style=""> 453                 solrServer.add(collection, documents);                                                   </span>
<span class="4440071783810203686" onmouseenter="enter('4440071783810203686');" onmouseout="out('4440071783810203686');" style=""> 454                 commit(collection, solrServer);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455             }                                                                                            </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 456             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span  style=""> 457                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 458             if (LOG.isDebugEnabled()) {                                                                  </span>
<span class="-5239549129780834185" onmouseenter="enter('-5239549129780834185');" onmouseout="out('-5239549129780834185');" style=""><abbr title=" 459                 LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexables.size(), s.toLapString()));"> 459                 LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460             }                                                                                            </span>
<span  style=""> 461                                                                                                          </span>
<span class="-4724346008918927046" onmouseenter="enter('-4724346008918927046');" onmouseout="out('-4724346008918927046');" style=""> 462             return documents;                                                                            </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 463         } catch (SolrServerException e) {                                                                </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 464             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 465             throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 466         } catch (IOException e) {                                                                        </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 467             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 468             throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                    </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 469         } catch (RuntimeException e) {                                                                   </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 470             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 471             throw e;                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 472         } finally {                                                                                      </span>
<span class="90671037077050937" onmouseenter="enter('90671037077050937');" onmouseout="out('90671037077050937');" style=""> 473             extensionManager.getProxy().endBatchEvent(indexables);                                       </span>
<span class="8189254405929957329" onmouseenter="enter('8189254405929957329');" onmouseout="out('8189254405929957329');" style=""> 474             sandBoxHelper.ignoreCloneCache(false);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476     }                                                                                                    </span>
<span  style=""> 477                                                                                                          </span>
<span class="5551263307167100166" onmouseenter="enter('5551263307167100166');" onmouseout="out('5551263307167100166');" style=""> 478     protected List&lt;? extends Indexable&gt; readAllActiveIndexables(int pageSize, Long lastId) {             </span>
<span class="6192419674169007142" onmouseenter="enter('6192419674169007142');" onmouseout="out('6192419674169007142');" style=""> 479         return productDao.readAllActiveProducts(pageSize, lastId);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480     }                                                                                                    </span>
<span  style=""> 481                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 482     @Override                                                                                            </span>
<span class="-8038322947777108176" onmouseenter="enter('-8038322947777108176');" onmouseout="out('-8038322947777108176');" style=""> 483     public List&lt;Locale&gt; getAllLocales() {                                                                </span>
<span class="-8741721793451188111" onmouseenter="enter('-8741721793451188111');" onmouseout="out('-8741721793451188111');" style=""> 484         List&lt;Locale&gt; allLocales = localeService.findAllLocales();                                        </span>
<span class="4034520407475000176" onmouseenter="enter('4034520407475000176');" onmouseout="out('4034520407475000176');" style=""> 485         Map&lt;String, Locale&gt; processedLocales = new HashMap&lt;&gt;();                                          </span>
<span class="2399355616829443482" onmouseenter="enter('2399355616829443482');" onmouseout="out('2399355616829443482');" style=""><abbr title=" 486         // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale set and I&#x27;m"> 486         // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale seðŸ”µ</abbr></span>
<span class="1459641740327693907" onmouseenter="enter('1459641740327693907');" onmouseout="out('1459641740327693907');" style=""> 487         // not using the country code to index the values, then I only need to index the locale &#x27;en&#x27;     </span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style=""> 488         for (Locale locale : allLocales) {                                                               </span>
<span class="343473664574147441" onmouseenter="enter('343473664574147441');" onmouseout="out('343473664574147441');" style=""> 489             String localeCode = locale.getLocaleCode();                                                  </span>
<span class="-113413807046306655" onmouseenter="enter('-113413807046306655');" onmouseout="out('-113413807046306655');" style=""> 490             int underscoreLocation = localeCode.indexOf(&quot;_&quot;);                                            </span>
<span class="5152034502068978670" onmouseenter="enter('5152034502068978670');" onmouseout="out('5152034502068978670');" style=""> 491             if (underscoreLocation &gt; 0 &amp;&amp; Boolean.FALSE.equals(locale.getUseCountryInSearchIndex())) {   </span>
<span class="8938820827276960997" onmouseenter="enter('8938820827276960997');" onmouseout="out('8938820827276960997');" style=""> 492                 String localeCodeWithoutCountry = localeCode.substring(0, underscoreLocation);           </span>
<span class="-6764305435332837995" onmouseenter="enter('-6764305435332837995');" onmouseout="out('-6764305435332837995');" style=""> 493                 if (!processedLocales.containsKey(localeCodeWithoutCountry)) {                           </span>
<span class="-3212129377547784987" onmouseenter="enter('-3212129377547784987');" onmouseout="out('-3212129377547784987');" style=""> 494                     processedLocales.put(localeCodeWithoutCountry, locale);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 496             } else {                                                                                     </span>
<span class="-3143247090679758655" onmouseenter="enter('-3143247090679758655');" onmouseout="out('-3143247090679758655');" style=""> 497                 processedLocales.put(locale.getLocaleCode(), locale);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499         }                                                                                                </span>
<span class="8478562493399850393" onmouseenter="enter('8478562493399850393');" onmouseout="out('8478562493399850393');" style=""> 500         return new ArrayList&lt;&gt;(processedLocales.values());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501     }                                                                                                    </span>
<span  style=""> 502                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 503     @Override                                                                                            </span>
<span class="-5988937181784380794" onmouseenter="enter('-5988937181784380794');" onmouseout="out('-5988937181784380794');" style=""><abbr title=" 504     public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 504     public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;LocalðŸ”µ</abbr></span>
<span class="4147487252329209973" onmouseenter="enter('4147487252329209973');" onmouseout="out('4147487252329209973');" style=""><abbr title=" 505         final SolrInputDocument document = new SolrInputDocument(new LinkedHashMap&lt;String,SolrInputField&gt;());"> 505         final SolrInputDocument document = new SolrInputDocument(new LinkedHashMap&lt;String,SolrInputField&gt;ðŸ”µ</abbr></span>
<span  style=""> 506                                                                                                          </span>
<span class="-1191402169666210527" onmouseenter="enter('-1191402169666210527');" onmouseout="out('-1191402169666210527');" style=""> 507         attachBasicDocumentFields(indexable, document);                                                  </span>
<span  style=""> 508                                                                                                          </span>
<span class="6176356407772671184" onmouseenter="enter('6176356407772671184');" onmouseout="out('6176356407772671184');" style=""> 509         attachIndexableDocumentFields(document, indexable, fields, locales);                             </span>
<span  style=""> 510                                                                                                          </span>
<span class="-7308801397401646621" onmouseenter="enter('-7308801397401646621');" onmouseout="out('-7308801397401646621');" style=""> 511         attachAdditionalDocumentFields(indexable, document);                                             </span>
<span  style=""> 512                                                                                                          </span>
<span class="581573764679058551" onmouseenter="enter('581573764679058551');" onmouseout="out('581573764679058551');" style=""> 513         extensionManager.getProxy().attachChildDocuments(indexable, document, fields, locales);          </span>
<span  style=""> 514                                                                                                          </span>
<span class="-4026438827530914052" onmouseenter="enter('-4026438827530914052');" onmouseout="out('-4026438827530914052');" style=""> 515         return document;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516     }                                                                                                    </span>
<span  style=""> 517                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 518     @Override                                                                                            </span>
<span class="-2827903308009028143" onmouseenter="enter('-2827903308009028143');" onmouseout="out('-2827903308009028143');" style=""><abbr title=" 519     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 519     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr></span>
<span class="-7267711193404106417" onmouseenter="enter('-7267711193404106417');" onmouseout="out('-7267711193404106417');" style=""> 520         for (IndexField indexField : fields) {                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 521             try {                                                                                        </span>
<span class="-5685362315060478990" onmouseenter="enter('-5685362315060478990');" onmouseout="out('-5685362315060478990');" style=""> 522                 // If we find an IndexField entry for this field, then we need to store it in the index  </span>
<span class="-6138117391173223373" onmouseenter="enter('-6138117391173223373');" onmouseout="out('-6138117391173223373');" style=""> 523                 if (indexField != null) {                                                                </span>
<span class="-1605896855845279090" onmouseenter="enter('-1605896855845279090');" onmouseout="out('-1605896855845279090');" style=""> 524                     List&lt;IndexFieldType&gt; searchableFieldTypes = indexField.getFieldTypes();              </span>
<span  style=""> 525                                                                                                          </span>
<span class="7314822488779147745" onmouseenter="enter('7314822488779147745');" onmouseout="out('7314822488779147745');" style=""><abbr title=" 526                     // For each of its search field types, get the property values, and add a field to the document for each property value"> 526                     // For each of its search field types, get the property values, and add a field to thðŸ”µ</abbr></span>
<span class="9127582384821892356" onmouseenter="enter('9127582384821892356');" onmouseout="out('9127582384821892356');" style=""> 527                     for (IndexFieldType sft : searchableFieldTypes) {                                    </span>
<span class="-1855754965803101801" onmouseenter="enter('-1855754965803101801');" onmouseout="out('-1855754965803101801');" style=""> 528                         FieldType fieldType = sft.getFieldType();                                        </span>
<span class="1213494569726901077" onmouseenter="enter('1213494569726901077');" onmouseout="out('1213494569726901077');" style=""><abbr title=" 529                         Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getField(), fieldType, locales);"> 529                         Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getFðŸ”µ</abbr></span>
<span  style=""> 530                                                                                                          </span>
<span class="2731937647730128807" onmouseenter="enter('2731937647730128807');" onmouseout="out('2731937647730128807');" style=""><abbr title=" 531                         ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentForIndexField(document, indexField, fieldType, propertyValues);"> 531                         ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentFoðŸ”µ</abbr></span>
<span  style=""> 532                                                                                                          </span>
<span class="-2046283582941202064" onmouseenter="enter('-2046283582941202064');" onmouseout="out('-2046283582941202064');" style=""> 533                         if (ExtensionResultStatusType.NOT_HANDLED.equals(result)) {                      </span>
<span class="1818285189854508408" onmouseenter="enter('1818285189854508408');" onmouseout="out('1818285189854508408');" style=""> 534                             // Build out the field for every prefix                                      </span>
<span class="-7947315413202592125" onmouseenter="enter('-7947315413202592125');" onmouseout="out('-7947315413202592125');" style=""> 535                             for (Entry&lt;String, Object&gt; entry : propertyValues.entrySet()) {              </span>
<span class="-6275926878676507761" onmouseenter="enter('-6275926878676507761');" onmouseout="out('-6275926878676507761');" style=""> 536                                 String prefix = entry.getKey();                                          </span>
<span class="2218524055946596429" onmouseenter="enter('2218524055946596429');" onmouseout="out('2218524055946596429');" style=""> 537                                 prefix = StringUtils.isBlank(prefix) ? prefix : prefix + &quot;_&quot;;            </span>
<span  style=""> 538                                                                                                          </span>
<span class="-3898910784215480067" onmouseenter="enter('-3898910784215480067');" onmouseout="out('-3898910784215480067');" style=""><abbr title=" 539                                 String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fieldType, prefix);"> 539                                 String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fiðŸ”µ</abbr></span>
<span class="-4401151924846137205" onmouseenter="enter('-4401151924846137205');" onmouseout="out('-4401151924846137205');" style=""> 540                                 Object value = entry.getValue();                                         </span>
<span  style=""> 541                                                                                                          </span>
<span class="626346901079283965" onmouseenter="enter('626346901079283965');" onmouseout="out('626346901079283965');" style=""> 542                                 if (FieldType.isMultiValued(fieldType)) {                                </span>
<span class="-3165450242186121028" onmouseenter="enter('-3165450242186121028');" onmouseout="out('-3165450242186121028');" style=""> 543                                     document.addField(solrPropertyName, value);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 544                                 } else {                                                                 </span>
<span class="3313383578919119200" onmouseenter="enter('3313383578919119200');" onmouseout="out('3313383578919119200');" style=""> 545                                     document.setField(solrPropertyName, value);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550                 }                                                                                        </span>
<span  style=""> 551                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 552             } catch (Exception e) {                                                                      </span>
<span class="3922644492767384995" onmouseenter="enter('3922644492767384995');" onmouseout="out('3922644492767384995');" style=""><abbr title=" 553                 LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldName() + &quot;] for product id[&quot;"> 553                 LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldNaðŸ”µ</abbr></span>
<span class="6260448561791331284" onmouseenter="enter('6260448561791331284');" onmouseout="out('6260448561791331284');" style=""> 554                         + indexable.getId() + &quot;]&quot;, e);                                                   </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 555                 throw ExceptionHelper.refineException(e);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558     }                                                                                                    </span>
<span  style=""> 559                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 560     /**                                                                                                  </span>
<span class="4238183781809234032" onmouseenter="enter('4238183781809234032');" onmouseout="out('4238183781809234032');" style=""><abbr title=" 561      * Implementors can extend this and override this method to add additional fields to the Solr document."> 561      * Implementors can extend this and override this method to add additional fields to the Solr documenðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 562      *                                                                                                   </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 563      * @param sku                                                                                        </span>
<span class="-4531925645240977456" onmouseenter="enter('-4531925645240977456');" onmouseout="out('-4531925645240977456');" style=""> 564      * @param document                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 565      */                                                                                                  </span>
<span class="-8826176176899724303" onmouseenter="enter('-8826176176899724303');" onmouseout="out('-8826176176899724303');" style=""> 566     protected void attachAdditionalDocumentFields(Indexable indexable, SolrInputDocument document) {     </span>
<span class="2874503221562082086" onmouseenter="enter('2874503221562082086');" onmouseout="out('2874503221562082086');" style=""> 567         //Empty implementation. Placeholder for others to extend and add additional fields               </span>
<span class="6562860541481637604" onmouseenter="enter('6562860541481637604');" onmouseout="out('6562860541481637604');" style=""> 568         extensionManager.getProxy().attachAdditionalDocumentFields(indexable, document);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569     }                                                                                                    </span>
<span  style=""> 570                                                                                                          </span>
<span class="2269161038285740545" onmouseenter="enter('2269161038285740545');" onmouseout="out('2269161038285740545');" style=""> 571     protected void attachBasicDocumentFields(Indexable indexable, SolrInputDocument document) {          </span>
<span class="3677952974140195445" onmouseenter="enter('3677952974140195445');" onmouseout="out('3677952974140195445');" style=""> 572         CatalogStructure cache = SolrIndexCachedOperation.getCache();                                    </span>
<span class="3690595679967484902" onmouseenter="enter('3690595679967484902');" onmouseout="out('3690595679967484902');" style=""> 573         if (cache == null) {                                                                             </span>
<span class="-5953957341705739916" onmouseenter="enter('-5953957341705739916');" onmouseout="out('-5953957341705739916');" style=""> 574             String msg = &quot;SolrIndexService.performCachedOperation() must be used in conjuction with&quot;     </span>
<span class="5121342196990946089" onmouseenter="enter('5121342196990946089');" onmouseout="out('5121342196990946089');" style=""><abbr title=" 575                 + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog documents or should&quot;"> 575                 + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog doðŸ”µ</abbr></span>
<span class="5921421762371925976" onmouseenter="enter('5921421762371925976');" onmouseout="out('5921421762371925976');" style=""> 576                 + &quot; be invoked from buildIncrementalIndex()&quot;;                                            </span>
<span class="4339245929318812534" onmouseenter="enter('4339245929318812534');" onmouseout="out('4339245929318812534');" style=""> 577             LOG.error(msg);                                                                              </span>
<span class="86168282544735545" onmouseenter="enter('86168282544735545');" onmouseout="out('86168282544735545');" style=""> 578             throw new IllegalStateException(msg);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579         }                                                                                                </span>
<span  style=""> 580                                                                                                          </span>
<span class="-3140243218980457613" onmouseenter="enter('-3140243218980457613');" onmouseout="out('-3140243218980457613');" style=""> 581         // Add the namespace and ID fields for this product                                              </span>
<span class="-8136043564923018877" onmouseenter="enter('-8136043564923018877');" onmouseout="out('-8136043564923018877');" style=""> 582         document.addField(shs.getNamespaceFieldName(), solrConfiguration.getNamespace());                </span>
<span class="4638667037339624807" onmouseenter="enter('4638667037339624807');" onmouseout="out('4638667037339624807');" style=""> 583         document.addField(shs.getIdFieldName(), shs.getSolrDocumentId(document, indexable));             </span>
<span class="-1745274961796795631" onmouseenter="enter('-1745274961796795631');" onmouseout="out('-1745274961796795631');" style=""> 584         document.addField(shs.getTypeFieldName(), shs.getDocumentType(indexable));                       </span>
<span class="4848544160674821385" onmouseenter="enter('4848544160674821385');" onmouseout="out('4848544160674821385');" style=""> 585         document.addField(shs.getIndexableIdFieldName(), shs.getIndexableId(indexable));                 </span>
<span  style=""> 586                                                                                                          </span>
<span class="4524398296663961208" onmouseenter="enter('4524398296663961208');" onmouseout="out('4524398296663961208');" style=""> 587         extensionManager.getProxy().attachAdditionalBasicFields(indexable, document, shs);               </span>
<span  style=""> 588                                                                                                          </span>
<span class="8081444938024983637" onmouseenter="enter('8081444938024983637');" onmouseout="out('8081444938024983637');" style=""> 589         Long cacheKey = this.shs.getCurrentProductId(indexable); // current                              </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 590         if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                               </span>
<span class="1019588205807698651" onmouseenter="enter('1019588205807698651');" onmouseout="out('1019588205807698651');" style=""> 591             cacheKey = sandBoxHelper.getOriginalId(cacheKey); // parent                                  </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 592             if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                           </span>
<span class="-2582971950633728748" onmouseenter="enter('-2582971950633728748');" onmouseout="out('-2582971950633728748');" style=""> 593                 cacheKey = shs.getIndexableId(indexable); // master                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595         }                                                                                                </span>
<span  style=""> 596                                                                                                          </span>
<span class="-5777629244031949400" onmouseenter="enter('-5777629244031949400');" onmouseout="out('-5777629244031949400');" style=""> 597         // TODO: figure this out more generally; this doesn&#x27;t work for CMS content                       </span>
<span class="-6650188849299086912" onmouseenter="enter('-6650188849299086912');" onmouseout="out('-6650188849299086912');" style=""> 598         // The explicit categories are the ones defined by the product itself                            </span>
<span class="-9160995028433643624" onmouseenter="enter('-9160995028433643624');" onmouseout="out('-9160995028433643624');" style=""> 599         if (cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                </span>
<span class="4256320710674012617" onmouseenter="enter('4256320710674012617');" onmouseout="out('4256320710674012617');" style=""> 600             for (Long categoryId : cache.getParentCategoriesByProduct().get(cacheKey)) {                 </span>
<span class="8455722384905122433" onmouseenter="enter('8455722384905122433');" onmouseout="out('8455722384905122433');" style=""> 601                 document.addField(shs.getExplicitCategoryFieldName(), shs.getCategoryId(categoryId));    </span>
<span  style=""> 602                                                                                                          </span>
<span class="2226871268244895600" onmouseenter="enter('2226871268244895600');" onmouseout="out('2226871268244895600');" style=""> 603                 // Make sure that we&#x27;re always referencing the parent for the sort field                 </span>
<span class="885050313007205730" onmouseenter="enter('885050313007205730');" onmouseout="out('885050313007205730');" style=""><abbr title=" 604                 String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId));"> 604                 String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId)ðŸ”µ</abbr></span>
<span class="2056097617960887013" onmouseenter="enter('2056097617960887013');" onmouseout="out('2056097617960887013');" style=""><abbr title=" 605                 // The issue here was the super category id is always what is stored in the cache, while the category"> 605                 // The issue here was the super category id is always what is stored in the cache, while ðŸ”µ</abbr></span>
<span class="-892018914725665598" onmouseenter="enter('-892018914725665598');" onmouseout="out('-892018914725665598');" style=""><abbr title=" 606                 // by product id is the overridden versions. Need to always look at parent version for cache stuff, which"> 606                 // by product id is the overridden versions. Need to always look at parent version for caðŸ”µ</abbr></span>
<span class="-9167754401626692888" onmouseenter="enter('-9167754401626692888');" onmouseout="out('-9167754401626692888');" style=""> 607                 // is given from shs.getCategoryId                                                       </span>
<span class="-5291059882317809252" onmouseenter="enter('-5291059882317809252');" onmouseout="out('-5291059882317809252');" style=""> 608                 // First try the current level                                                           </span>
<span class="-431096296060400570" onmouseenter="enter('-431096296060400570');" onmouseout="out('-431096296060400570');" style=""> 609                 String displayOrderKey = categoryId + &quot;-&quot; + cacheKey;                                    </span>
<span class="-2136310867529994982" onmouseenter="enter('-2136310867529994982');" onmouseout="out('-2136310867529994982');" style=""> 610                 Long displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                   </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 611                 if (displayOrder == null) {                                                              </span>
<span class="-23846589771862516" onmouseenter="enter('-23846589771862516');" onmouseout="out('-23846589771862516');" style=""><abbr title=" 612                     // Didn&#x27;t find the cache at the current level, this might be an override so look upwards"> 612                     // Didn&#x27;t find the cache at the current level, this might be an override so look upwaðŸ”µ</abbr></span>
<span class="-2522276541728086971" onmouseenter="enter('-2522276541728086971');" onmouseout="out('-2522276541728086971');" style=""> 613                     displayOrderKey = shs.getCategoryId(categoryId) + &quot;-&quot; + cacheKey;                    </span>
<span class="-4225610511634364677" onmouseenter="enter('-4225610511634364677');" onmouseout="out('-4225610511634364677');" style=""> 614                     displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615                 }                                                                                        </span>
<span  style=""> 616                                                                                                          </span>
<span class="-1309608839151321080" onmouseenter="enter('-1309608839151321080');" onmouseout="out('-1309608839151321080');" style=""> 617                 if (document.getField(categorySortFieldName) == null &amp;&amp; displayOrder != null) {          </span>
<span class="-139575474281341237" onmouseenter="enter('-139575474281341237');" onmouseout="out('-139575474281341237');" style=""> 618                     document.addField(categorySortFieldName, displayOrder);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619                 }                                                                                        </span>
<span  style=""> 620                                                                                                          </span>
<span class="368279688641772108" onmouseenter="enter('368279688641772108');" onmouseout="out('368279688641772108');" style=""> 621                 // This is the entire tree of every category defined on the product                      </span>
<span class="7804252118891085182" onmouseenter="enter('7804252118891085182');" onmouseout="out('7804252118891085182');" style=""> 622                 buildFullCategoryHierarchy(document, cache, categoryId, new HashSet&lt;Long&gt;());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 623             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625     }                                                                                                    </span>
<span  style=""> 626                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 627     /**                                                                                                  </span>
<span class="6681629456063376998" onmouseenter="enter('6681629456063376998');" onmouseout="out('6681629456063376998');" style=""> 628      * Walk the category hierarchy upwards, adding a field for each level to the solr document           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 629      *                                                                                                   </span>
<span class="1689379025577151242" onmouseenter="enter('1689379025577151242');" onmouseout="out('1689379025577151242');" style=""> 630      * @param document the solr document for the product                                                 </span>
<span class="-7318706520602943649" onmouseenter="enter('-7318706520602943649');" onmouseout="out('-7318706520602943649');" style=""> 631      * @param cache the catalog structure cache                                                          </span>
<span class="-6836312806010046064" onmouseenter="enter('-6836312806010046064');" onmouseout="out('-6836312806010046064');" style=""> 632      * @param categoryId the current category id                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 633      */                                                                                                  </span>
<span class="2161311715252659768" onmouseenter="enter('2161311715252659768');" onmouseout="out('2161311715252659768');" style=""><abbr title=" 634     protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long categoryId, Set&lt;Long&gt; indexedParents) {"> 634     protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long caðŸ”µ</abbr></span>
<span class="3164345535572197299" onmouseenter="enter('3164345535572197299');" onmouseout="out('3164345535572197299');" style=""> 635         Long catIdToAdd = shs.getCategoryId(categoryId);                                                 </span>
<span  style=""> 636                                                                                                          </span>
<span class="-3890718915071250281" onmouseenter="enter('-3890718915071250281');" onmouseout="out('-3890718915071250281');" style=""> 637         Collection&lt;Object&gt; existingValues = document.getFieldValues(shs.getCategoryFieldName());         </span>
<span class="6039307398262207081" onmouseenter="enter('6039307398262207081');" onmouseout="out('6039307398262207081');" style=""> 638         if (existingValues == null || !existingValues.contains(catIdToAdd)) {                            </span>
<span class="527969679087238607" onmouseenter="enter('527969679087238607');" onmouseout="out('527969679087238607');" style=""> 639             document.addField(shs.getCategoryFieldName(), catIdToAdd);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640         }                                                                                                </span>
<span  style=""> 641                                                                                                          </span>
<span class="6863771221853966476" onmouseenter="enter('6863771221853966476');" onmouseout="out('6863771221853966476');" style=""> 642         Set&lt;Long&gt; parents = cache.getParentCategoriesByCategory().get(categoryId);                       </span>
<span class="-2911148901929748808" onmouseenter="enter('-2911148901929748808');" onmouseout="out('-2911148901929748808');" style=""> 643         for (Long parent : parents) {                                                                    </span>
<span class="-7460726028904993058" onmouseenter="enter('-7460726028904993058');" onmouseout="out('-7460726028904993058');" style=""> 644             if (!indexedParents.contains(parent)) {                                                      </span>
<span class="7294571508456102427" onmouseenter="enter('7294571508456102427');" onmouseout="out('7294571508456102427');" style=""> 645                 indexedParents.add(parent);                                                              </span>
<span class="-1881502435741878283" onmouseenter="enter('-1881502435741878283');" onmouseout="out('-1881502435741878283');" style=""> 646                 buildFullCategoryHierarchy(document, cache, parent, indexedParents);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 648         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649     }                                                                                                    </span>
<span  style=""> 650                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 651     /**                                                                                                  </span>
<span class="-4462927116106886000" onmouseenter="enter('-4462927116106886000');" onmouseout="out('-4462927116106886000');" style=""><abbr title=" 652      * Returns a map of prefix to value for the requested attributes. For example, if the requested field corresponds to"> 652      * Returns a map of prefix to value for the requested attributes. For example, if the requested fieldðŸ”µ</abbr></span>
<span class="-4378589169221473186" onmouseenter="enter('-4378589169221473186');" onmouseout="out('-4378589169221473186');" style=""><abbr title=" 653      * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting map could be"> 653      * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 654      *                                                                                                   </span>
<span class="4965494886678626130" onmouseenter="enter('4965494886678626130');" onmouseout="out('4965494886678626130');" style=""> 655      * { &quot;en_US&quot; : &quot;A description&quot;,                                                                      </span>
<span class="-259254215439445341" onmouseenter="enter('-259254215439445341');" onmouseout="out('-259254215439445341');" style=""> 656      *   &quot;es_ES&quot; : &quot;Una descripcion&quot; }                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 657      *                                                                                                   </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 658      * @param product                                                                                    </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 659      * @param sku                                                                                        </span>
<span class="-2810227465158556501" onmouseenter="enter('-2810227465158556501');" onmouseout="out('-2810227465158556501');" style=""> 660      * @param field                                                                                      </span>
<span class="8333989749186698144" onmouseenter="enter('8333989749186698144');" onmouseout="out('8333989749186698144');" style=""> 661      * @param fieldType                                                                                  </span>
<span class="4196076978965854681" onmouseenter="enter('4196076978965854681');" onmouseout="out('4196076978965854681');" style=""> 662      * @param locales                                                                                    </span>
<span class="8270246261244700409" onmouseenter="enter('8270246261244700409');" onmouseout="out('8270246261244700409');" style=""> 663      * @return the value of the property                                                                 </span>
<span class="8083004877096205463" onmouseenter="enter('8083004877096205463');" onmouseout="out('8083004877096205463');" style=""> 664      * @throws IllegalAccessException                                                                    </span>
<span class="-5812785901555574031" onmouseenter="enter('-5812785901555574031');" onmouseout="out('-5812785901555574031');" style=""> 665      * @throws InvocationTargetException                                                                 </span>
<span class="-7952440753472318794" onmouseenter="enter('-7952440753472318794');" onmouseout="out('-7952440753472318794');" style=""> 666      * @throws NoSuchMethodException                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 667      */                                                                                                  </span>
<span class="8748893838745138853" onmouseenter="enter('8748893838745138853');" onmouseout="out('8748893838745138853');" style=""><abbr title=" 668     protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldType, List&lt;Locale&gt; locales)"> 668     protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldTyðŸ”µ</abbr></span>
<span class="1769827535532852924" onmouseenter="enter('1769827535532852924');" onmouseout="out('1769827535532852924');" style=""> 669             throws IllegalAccessException, InvocationTargetException, NoSuchMethodException {            </span>
<span  style=""> 670                                                                                                          </span>
<span class="6107905045905939603" onmouseenter="enter('6107905045905939603');" onmouseout="out('6107905045905939603');" style=""> 671         String propertyName = field.getPropertyName();                                                   </span>
<span class="-4589490168925589742" onmouseenter="enter('-4589490168925589742');" onmouseout="out('-4589490168925589742');" style=""> 672         Map&lt;String, Object&gt; values = new HashMap&lt;&gt;();                                                    </span>
<span  style=""> 673                                                                                                          </span>
<span class="6659346108356717008" onmouseenter="enter('6659346108356717008');" onmouseout="out('6659346108356717008');" style=""> 674         ExtensionResultStatusType extensionResult = ExtensionResultStatusType.NOT_HANDLED;               </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 675         if (extensionManager != null) {                                                                  </span>
<span class="-9204729919056407683" onmouseenter="enter('-9204729919056407683');" onmouseout="out('-9204729919056407683');" style=""><abbr title=" 676             extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldType, values, propertyName, locales);"> 676             extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldTypeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677         }                                                                                                </span>
<span  style=""> 678                                                                                                          </span>
<span class="978300925065413292" onmouseenter="enter('978300925065413292');" onmouseout="out('978300925065413292');" style=""> 679         if (ExtensionResultStatusType.NOT_HANDLED.equals(extensionResult)) {                             </span>
<span class="-4780873355376927780" onmouseenter="enter('-4780873355376927780');" onmouseout="out('-4780873355376927780');" style=""> 680             Object propertyValue = shs.getPropertyValue(indexedItem, field);                             </span>
<span class="-3197092395980898064" onmouseenter="enter('-3197092395980898064');" onmouseout="out('-3197092395980898064');" style=""> 681             if (propertyValue != null) {                                                                 </span>
<span class="2260924254129751704" onmouseenter="enter('2260924254129751704');" onmouseout="out('2260924254129751704');" style=""> 682                 values.put(&quot;&quot;, propertyValue);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684         }                                                                                                </span>
<span  style=""> 685                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 686         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687     }                                                                                                    </span>
<span  style=""> 688                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 689     /**                                                                                                  </span>
<span class="9061850100512653526" onmouseenter="enter('9061850100512653526');" onmouseout="out('9061850100512653526');" style=""><abbr title=" 690      * Converts a propertyName to one that is able to reference inside a map. For example, consider the property"> 690      * Converts a propertyName to one that is able to reference inside a map. For example, consider the pðŸ”µ</abbr></span>
<span class="-895456647484563444" onmouseenter="enter('-895456647484563444');" onmouseout="out('-895456647484563444');" style=""><abbr title=" 691      * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utility method"> 691      * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utilitðŸ”µ</abbr></span>
<span class="-552833576006343516" onmouseenter="enter('-552833576006343516');" onmouseout="out('-552833576006343516');" style=""><abbr title=" 692      * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed by the name"> 692      * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed byðŸ”µ</abbr></span>
<span class="825713137907557548" onmouseenter="enter('825713137907557548');" onmouseout="out('825713137907557548');" style=""><abbr title=" 693      * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttributes&quot;, "> 693      * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttrðŸ”µ</abbr></span>
<span class="-5368406654183806848" onmouseenter="enter('-5368406654183806848');" onmouseout="out('-5368406654183806848');" style=""><abbr title=" 694      * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; that "> 694      * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; tðŸ”µ</abbr></span>
<span class="2947641499517828088" onmouseenter="enter('2947641499517828088');" onmouseout="out('2947641499517828088');" style=""><abbr title=" 695      * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatRange&quot;, "> 695      * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatðŸ”µ</abbr></span>
<span class="-7978269712217451802" onmouseenter="enter('-7978269712217451802');" onmouseout="out('-7978269712217451802');" style=""><abbr title=" 696      * this method will convert this property to mappedProductAttributes(heatRange).value, which is then usable "> 696      * this method will convert this property to mappedProductAttributes(heatRange).value, which is then ðŸ”µ</abbr></span>
<span class="2645537127888120036" onmouseenter="enter('2645537127888120036');" onmouseout="out('2645537127888120036');" style=""> 697      * by the standard beanutils PropertyUtils class to get the value.                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 698      *                                                                                                   </span>
<span class="-7192310373251332281" onmouseenter="enter('-7192310373251332281');" onmouseout="out('-7192310373251332281');" style=""> 699      * @param propertyName                                                                               </span>
<span class="4673892841275975431" onmouseenter="enter('4673892841275975431');" onmouseout="out('4673892841275975431');" style=""> 700      * @param listPropertyName                                                                           </span>
<span class="-3179260629250258297" onmouseenter="enter('-3179260629250258297');" onmouseout="out('-3179260629250258297');" style=""> 701      * @param mapPropertyName                                                                            </span>
<span class="3476440775818037910" onmouseenter="enter('3476440775818037910');" onmouseout="out('3476440775818037910');" style=""> 702      * @return the converted property name                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 703      *                                                                                                   </span>
<span class="52899359164217029" onmouseenter="enter('52899359164217029');" onmouseout="out('52899359164217029');" style=""> 704      * @deprecated see SolrHelperService.getPropertyValue()                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 705      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 706     @Deprecated                                                                                          </span>
<span class="-8166943252759778933" onmouseenter="enter('-8166943252759778933');" onmouseout="out('-8166943252759778933');" style=""><abbr title=" 707     protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropertyName) {"> 707     protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropðŸ”µ</abbr></span>
<span class="1454213590133189928" onmouseenter="enter('1454213590133189928');" onmouseout="out('1454213590133189928');" style=""> 708         String[] splitName = StringUtils.split(propertyName, &quot;\\.&quot;);                                     </span>
<span class="8763032247946290041" onmouseenter="enter('8763032247946290041');" onmouseout="out('8763032247946290041');" style=""> 709         StringBuilder convertedProperty = new StringBuilder();                                           </span>
<span class="6897833212568273038" onmouseenter="enter('6897833212568273038');" onmouseout="out('6897833212568273038');" style=""> 710         for (int i = 0; i &lt; splitName.length; i++) {                                                     </span>
<span class="7476336611017662047" onmouseenter="enter('7476336611017662047');" onmouseout="out('7476336611017662047');" style=""> 711             if (convertedProperty.length() &gt; 0) {                                                        </span>
<span class="3942759274962034898" onmouseenter="enter('3942759274962034898');" onmouseout="out('3942759274962034898');" style=""> 712                 convertedProperty.append(&quot;.&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713             }                                                                                            </span>
<span  style=""> 714                                                                                                          </span>
<span class="-5101250235350090861" onmouseenter="enter('-5101250235350090861');" onmouseout="out('-5101250235350090861');" style=""> 715             if (splitName[i].equals(listPropertyName)) {                                                 </span>
<span class="5747881404112979701" onmouseenter="enter('5747881404112979701');" onmouseout="out('5747881404112979701');" style=""> 716                 convertedProperty.append(mapPropertyName).append(&quot;(&quot;);                                   </span>
<span class="-4744112788117022497" onmouseenter="enter('-4744112788117022497');" onmouseout="out('-4744112788117022497');" style=""> 717                 convertedProperty.append(splitName[i + 1]).append(&quot;).value&quot;);                            </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 718                 i++;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 719             } else {                                                                                     </span>
<span class="-2902127022925554102" onmouseenter="enter('-2902127022925554102');" onmouseout="out('-2902127022925554102');" style=""> 720                 convertedProperty.append(splitName[i]);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 722         }                                                                                                </span>
<span class="5092332446699272394" onmouseenter="enter('5092332446699272394');" onmouseout="out('5092332446699272394');" style=""> 723         return convertedProperty.toString();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724     }                                                                                                    </span>
<span  style=""> 725                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 726     @Override                                                                                            </span>
<span class="-3936693135713622895" onmouseenter="enter('-3936693135713622895');" onmouseout="out('-3936693135713622895');" style=""> 727     public Object[] saveState() {                                                                        </span>
<span class="6340072029414808943" onmouseenter="enter('6340072029414808943');" onmouseout="out('6340072029414808943');" style=""> 728          return new Object[] {                                                                           </span>
<span class="-1198820822862086393" onmouseenter="enter('-1198820822862086393');" onmouseout="out('-1198820822862086393');" style=""> 729              BroadleafRequestContext.getBroadleafRequestContext(),                                       </span>
<span class="4468406610576348115" onmouseenter="enter('4468406610576348115');" onmouseout="out('4468406610576348115');" style=""> 730              SkuPricingConsiderationContext.getSkuPricingConsiderationContext(),                         </span>
<span class="-4551736393079008426" onmouseenter="enter('-4551736393079008426');" onmouseout="out('-4551736393079008426');" style=""> 731              SkuPricingConsiderationContext.getSkuPricingService(),                                      </span>
<span class="3011904497645750283" onmouseenter="enter('3011904497645750283');" onmouseout="out('3011904497645750283');" style=""> 732              SkuActiveDateConsiderationContext.getSkuActiveDatesService()                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 733          };                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734      }                                                                                                   </span>
<span  style=""> 735                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 736     @Override                                                                                            </span>
<span class="-1725049255621638202" onmouseenter="enter('-1725049255621638202');" onmouseout="out('-1725049255621638202');" style=""> 737     @SuppressWarnings(&quot;rawtypes&quot;)                                                                        </span>
<span class="-799181704487695614" onmouseenter="enter('-799181704487695614');" onmouseout="out('-799181704487695614');" style=""> 738     public void restoreState(Object[] pack) {                                                            </span>
<span class="5773741038987480013" onmouseenter="enter('5773741038987480013');" onmouseout="out('5773741038987480013');" style=""> 739          BroadleafRequestContext.setBroadleafRequestContext((BroadleafRequestContext) pack[0]);          </span>
<span class="-7019853679694091506" onmouseenter="enter('-7019853679694091506');" onmouseout="out('-7019853679694091506');" style=""> 740          SkuPricingConsiderationContext.setSkuPricingConsiderationContext((HashMap) pack[1]);            </span>
<span class="4085014913476561326" onmouseenter="enter('4085014913476561326');" onmouseout="out('4085014913476561326');" style=""> 741          SkuPricingConsiderationContext.setSkuPricingService((DynamicSkuPricingService) pack[2]);        </span>
<span class="-8007069714826871365" onmouseenter="enter('-8007069714826871365');" onmouseout="out('-8007069714826871365');" style=""><abbr title=" 742          SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3]);"> 742          SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743      }                                                                                                   </span>
<span  style=""> 744                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 745     @Override                                                                                            </span>
<span class="-9091641891346182972" onmouseenter="enter('-9091641891346182972');" onmouseout="out('-9091641891346182972');" style=""><abbr title=" 746     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException {"> 746     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException ðŸ”µ</abbr></span>
<span class="-2539995639166621773" onmouseenter="enter('-2539995639166621773');" onmouseout="out('-2539995639166621773');" style=""> 747         shs.optimizeIndex(collection, server);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748     }                                                                                                    </span>
<span  style=""> 749                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 750     @Override                                                                                            </span>
<span class="7341867013968379883" onmouseenter="enter('7341867013968379883');" onmouseout="out('7341867013968379883');" style=""> 751     public void commit(String collection, SolrClient server) throws ServiceException, IOException {      </span>
<span class="7675894021553797865" onmouseenter="enter('7675894021553797865');" onmouseout="out('7675894021553797865');" style=""> 752         if (this.commit) {                                                                               </span>
<span class="-6090512425803845008" onmouseenter="enter('-6090512425803845008');" onmouseout="out('-6090512425803845008');" style=""> 753             commit(collection, server, this.softCommit, this.waitSearcher, this.waitFlush);              </span>
<span class="6963313292914152592" onmouseenter="enter('6963313292914152592');" onmouseout="out('6963313292914152592');" style=""> 754         } else if (LOG.isDebugEnabled()) {                                                               </span>
<span class="1765076834887086466" onmouseenter="enter('1765076834887086466');" onmouseout="out('1765076834887086466');" style=""><abbr title=" 755             LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoCommit is configured.&quot;);"> 755             LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoComðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 756         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757     }                                                                                                    </span>
<span  style=""> 758                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 759     @Override                                                                                            </span>
<span class="-5625380272333943282" onmouseenter="enter('-5625380272333943282');" onmouseout="out('-5625380272333943282');" style=""><abbr title=" 760     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 760     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 761         try {                                                                                            </span>
<span class="897708696444656733" onmouseenter="enter('897708696444656733');" onmouseout="out('897708696444656733');" style=""> 762             if (!this.commit) {                                                                          </span>
<span class="9109442794169141002" onmouseenter="enter('9109442794169141002');" onmouseout="out('9109442794169141002');" style=""><abbr title=" 763                 LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is being forced via the API.&quot;);"> 763                 LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is beingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764             }                                                                                            </span>
<span  style=""> 765                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 766             if (LOG.isDebugEnabled()) {                                                                  </span>
<span class="-8336995023402134302" onmouseenter="enter('-8336995023402134302');" onmouseout="out('-8336995023402134302');" style=""> 767                 LOG.debug(&quot;Committing changes to Solr index: softCommit: &quot; + softCommit                  </span>
<span class="8772898042441368535" onmouseenter="enter('8772898042441368535');" onmouseout="out('8772898042441368535');" style=""> 768                         + &quot;, waitSearcher: &quot; + waitSearcher + &quot;, waitFlush: &quot; + waitFlush);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769             }                                                                                            </span>
<span  style=""> 770                                                                                                          </span>
<span class="-4946339855213882534" onmouseenter="enter('-4946339855213882534');" onmouseout="out('-4946339855213882534');" style=""> 771             server.commit(collection, waitFlush, waitSearcher, softCommit);                              </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 772         } catch (SolrServerException e) {                                                                </span>
<span class="6480332907391821448" onmouseenter="enter('6480332907391821448');" onmouseout="out('6480332907391821448');" style=""> 773             throw new ServiceException(&quot;Could not commit changes to Solr index&quot;, e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775     }                                                                                                    </span>
<span  style=""> 776                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 777     @Override                                                                                            </span>
<span class="-235343663931086975" onmouseenter="enter('-235343663931086975');" onmouseout="out('-235343663931086975');" style=""> 778     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents) {                                  </span>
<span class="1446253227197554536" onmouseenter="enter('1446253227197554536');" onmouseout="out('1446253227197554536');" style=""> 779         if (LOG.isTraceEnabled()) {                                                                      </span>
<span class="-4118597588854644187" onmouseenter="enter('-4118597588854644187');" onmouseout="out('-4118597588854644187');" style=""> 780             for (SolrInputDocument document : documents) {                                               </span>
<span class="3338392633918275305" onmouseenter="enter('3338392633918275305');" onmouseout="out('3338392633918275305');" style=""> 781                 LOG.trace(document);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784     }                                                                                                    </span>
<span  style=""> 785                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 786     /**                                                                                                  </span>
<span class="-4161606046612334483" onmouseenter="enter('-4161606046612334483');" onmouseout="out('-4161606046612334483');" style=""> 787      *  We multiply the BigDecimal by 1,000,000 to maintain any possible decimals in use the             </span>
<span class="1095534727201270293" onmouseenter="enter('1095534727201270293');" onmouseout="out('1095534727201270293');" style=""> 788      *  displayOrder value.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 789      *                                                                                                   </span>
<span class="1237233419561726312" onmouseenter="enter('1237233419561726312');" onmouseout="out('1237233419561726312');" style=""> 790      * @param cache                                                                                      </span>
<span class="-4411905951100486196" onmouseenter="enter('-4411905951100486196');" onmouseout="out('-4411905951100486196');" style=""> 791      * @param displayOrderKey                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 792      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 793      */                                                                                                  </span>
<span class="1635922478501180747" onmouseenter="enter('1635922478501180747');" onmouseout="out('1635922478501180747');" style=""> 794     protected Long convertDisplayOrderToLong(CatalogStructure cache, String displayOrderKey) {           </span>
<span class="4518367233651177280" onmouseenter="enter('4518367233651177280');" onmouseout="out('4518367233651177280');" style=""> 795         BigDecimal displayOrder = cache.getDisplayOrdersByCategoryProduct().get(displayOrderKey);        </span>
<span  style=""> 796                                                                                                          </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 797         if (displayOrder == null) {                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 798             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799         }                                                                                                </span>
<span  style=""> 800                                                                                                          </span>
<span class="4133773492119237930" onmouseenter="enter('4133773492119237930');" onmouseout="out('4133773492119237930');" style=""> 801         return displayOrder.multiply(BigDecimal.valueOf(1000000)).longValue();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802     }                                                                                                    </span>
<span  style=""> 803                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 804     @Override                                                                                            </span>
<span class="4004348612697349075" onmouseenter="enter('4004348612697349075');" onmouseout="out('4004348612697349075');" style=""> 805     public void deleteByQuery(String deleteQuery) throws SolrServerException, IOException {              </span>
<span class="1027311076504650094" onmouseenter="enter('1027311076504650094');" onmouseout="out('1027311076504650094');" style=""> 806         String productFilter = shs.getTypeFieldName() + &quot;:&quot; + shs.getPrimaryDocumentType();              </span>
<span  style=""> 807                                                                                                          </span>
<span class="1739252735366935461" onmouseenter="enter('1739252735366935461');" onmouseout="out('1739252735366935461');" style=""><abbr title=" 808         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t delete non-product documents accidentally"> 808         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we doðŸ”µ</abbr></span>
<span class="8967770841500493181" onmouseenter="enter('8967770841500493181');" onmouseout="out('8967770841500493181');" style=""> 809         deleteQuery = productFilter + &quot; AND (&quot; + deleteQuery + &quot;)&quot;;                                      </span>
<span  style=""> 810                                                                                                          </span>
<span class="35790388838229419" onmouseenter="enter('35790388838229419');" onmouseout="out('35790388838229419');" style=""> 811         String childDeleteQuery = &quot;{!child of=&quot; + productFilter + &quot;} &quot; + deleteQuery;                    </span>
<span class="-5958139659148111368" onmouseenter="enter('-5958139659148111368');" onmouseout="out('-5958139659148111368');" style=""><abbr title=" 812         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), childDeleteQuery);"> 812         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), childDeleðŸ”µ</abbr></span>
<span class="870065906158081107" onmouseenter="enter('870065906158081107');" onmouseout="out('870065906158081107');" style=""><abbr title=" 813         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), deleteQuery);"> 813         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), deleteQueðŸ”µ</abbr></span>
<span  style=""> 814                                                                                                          </span>
<span class="2572292351348869388" onmouseenter="enter('2572292351348869388');" onmouseout="out('2572292351348869388');" style=""> 815         logDeleteQuery(childDeleteQuery);                                                                </span>
<span class="-7276176933862949274" onmouseenter="enter('-7276176933862949274');" onmouseout="out('-7276176933862949274');" style=""> 816         logDeleteQuery(deleteQuery);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817     }                                                                                                    </span>
<span  style=""> 818                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 819     @Override                                                                                            </span>
<span class="-7948321486753422000" onmouseenter="enter('-7948321486753422000');" onmouseout="out('-7948321486753422000');" style=""><abbr title=" 820     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException {"> 820     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerExcepðŸ”µ</abbr></span>
<span class="-1557641774356947070" onmouseenter="enter('-1557641774356947070');" onmouseout="out('-1557641774356947070');" style=""> 821         solrConfiguration.getServer().add(solrConfiguration.getQueryCollectionName(), documents);        </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 822         logDocuments(documents);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823     }                                                                                                    </span>
<span  style=""> 824                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 825     @Override                                                                                            </span>
<span class="5429697153738572572" onmouseenter="enter('5429697153738572572');" onmouseout="out('5429697153738572572');" style=""> 826     public void logDeleteQuery(String deleteQuery) {                                                     </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 827         if (LOG.isDebugEnabled()) {                                                                      </span>
<span class="1652863876971966554" onmouseenter="enter('1652863876971966554');" onmouseout="out('1652863876971966554');" style=""> 828             LOG.debug(&quot;Delete query: &quot; + deleteQuery);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830     }                                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 831 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 832                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 833     @Override                                                                                            </span>
<span class="8474819187366488777" onmouseenter="enter('8474819187366488777');" onmouseout="out('8474819187366488777');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 834     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 834     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrðŸ”µ</abbr></span>
<span class="1797277787154549011" onmouseenter="enter('1797277787154549011');" onmouseout="out('1797277787154549011');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 835         return buildIncrementalIndex(null, indexables, solrServer);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 836     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 837                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 838     @Override                                                                                            </span>
<span class="3365555763697732929" onmouseenter="enter('3365555763697732929');" onmouseout="out('3365555763697732929');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 839     public void optimizeIndex(SolrClient server) throws ServiceException, IOException {                  </span>
<span class="-604246973254031119" onmouseenter="enter('-604246973254031119');" onmouseout="out('-604246973254031119');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 840         optimizeIndex(null, server);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 841     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 842                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 843     @Override                                                                                            </span>
<span class="8022176589656897042" onmouseenter="enter('8022176589656897042');" onmouseout="out('8022176589656897042');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 844     public void commit(SolrClient server) throws ServiceException, IOException {                         </span>
<span class="8538330963534152673" onmouseenter="enter('8538330963534152673');" onmouseout="out('8538330963534152673');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 845         commit(null, server);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 846     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 847                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 848     @Override                                                                                            </span>
<span class="4402093086393350326" onmouseenter="enter('4402093086393350326');" onmouseout="out('4402093086393350326');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 849     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 849     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) thðŸ”µ</abbr></span>
<span class="-6149532067307109215" onmouseenter="enter('-6149532067307109215');" onmouseout="out('-6149532067307109215');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 850         commit(null, server, softCommit, waitSearcher, waitFlush);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 851     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 852                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 853     @Override                                                                                            </span>
<span class="125965368563769580" onmouseenter="enter('125965368563769580');" onmouseout="out('125965368563769580');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 854     public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException {                 </span>
<span class="-6644416202801761209" onmouseenter="enter('-6644416202801761209');" onmouseout="out('-6644416202801761209');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 855         deleteAllNamespaceDocuments(null, server);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 856     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 857                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 858     @Override                                                                                            </span>
<span class="31475417648561827" onmouseenter="enter('31475417648561827');" onmouseout="out('31475417648561827');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 859     public void deleteAllDocuments(SolrClient server) throws ServiceException {                          </span>
<span class="6597141509256723624" onmouseenter="enter('6597141509256723624');" onmouseout="out('6597141509256723624');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 860         deleteAllDocuments(null, server);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 861     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 862                                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 863 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 864      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 865      */                                                                                                  </span>
<span class="1635922478501180747" onmouseenter="enter('1635922478501180747');" onmouseout="out('1635922478501180747');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 866     protected Long convertDisplayOrderToLong(CatalogStructure cache, String displayOrderKey) {           </span>
<span class="4518367233651177280" onmouseenter="enter('4518367233651177280');" onmouseout="out('4518367233651177280');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 867         BigDecimal displayOrder = cache.getDisplayOrdersByCategoryProduct().get(displayOrderKey);        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 868                                                                                                          </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 869         if (displayOrder == null) {                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 870             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 871         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 872                                                                                                          </span>
<span class="4133773492119237930" onmouseenter="enter('4133773492119237930');" onmouseout="out('4133773492119237930');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 873         return displayOrder.multiply(BigDecimal.valueOf(1000000)).longValue();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 874     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 875                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 876     @Override                                                                                            </span>
<span class="4004348612697349075" onmouseenter="enter('4004348612697349075');" onmouseout="out('4004348612697349075');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 877     public void deleteByQuery(String deleteQuery) throws SolrServerException, IOException {              </span>
<span class="1027311076504650094" onmouseenter="enter('1027311076504650094');" onmouseout="out('1027311076504650094');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 878         String productFilter = shs.getTypeFieldName() + &quot;:&quot; + shs.getPrimaryDocumentType();              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 879                                                                                                          </span>
<span class="1739252735366935461" onmouseenter="enter('1739252735366935461');" onmouseout="out('1739252735366935461');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 880         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t delete non-product documents accidentally"> 880         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we doðŸ”µ</abbr></span>
<span class="8967770841500493181" onmouseenter="enter('8967770841500493181');" onmouseout="out('8967770841500493181');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 881         deleteQuery = productFilter + &quot; AND (&quot; + deleteQuery + &quot;)&quot;;                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 882                                                                                                          </span>
<span class="35790388838229419" onmouseenter="enter('35790388838229419');" onmouseout="out('35790388838229419');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 883         String childDeleteQuery = &quot;{!child of=&quot; + productFilter + &quot;} &quot; + deleteQuery;                    </span>
<span class="-5097470124987660196" onmouseenter="enter('-5097470124987660196');" onmouseout="out('-5097470124987660196');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 884         solrConfiguration.getServer().deleteByQuery(childDeleteQuery);                                   </span>
<span class="-4328599925487855664" onmouseenter="enter('-4328599925487855664');" onmouseout="out('-4328599925487855664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 885         solrConfiguration.getServer().deleteByQuery(deleteQuery);                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 886                                                                                                          </span>
<span class="2572292351348869388" onmouseenter="enter('2572292351348869388');" onmouseout="out('2572292351348869388');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 887         logDeleteQuery(childDeleteQuery);                                                                </span>
<span class="-7276176933862949274" onmouseenter="enter('-7276176933862949274');" onmouseout="out('-7276176933862949274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 888         logDeleteQuery(deleteQuery);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 889     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 890                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 891     @Override                                                                                            </span>
<span class="-7948321486753422000" onmouseenter="enter('-7948321486753422000');" onmouseout="out('-7948321486753422000');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 892     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException {"> 892     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerExcepðŸ”µ</abbr></span>
<span class="-3675518693353771931" onmouseenter="enter('-3675518693353771931');" onmouseout="out('-3675518693353771931');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 893         solrConfiguration.getServer().add(documents);                                                    </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 894         logDocuments(documents);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 895     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 896                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 897     @Override                                                                                            </span>
<span class="5429697153738572572" onmouseenter="enter('5429697153738572572');" onmouseout="out('5429697153738572572');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 898     public void logDeleteQuery(String deleteQuery) {                                                     </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 899         if (LOG.isDebugEnabled()) {                                                                      </span>
<span class="1652863876971966554" onmouseenter="enter('1652863876971966554');" onmouseout="out('1652863876971966554');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 900             LOG.debug(&quot;Delete query: &quot; + deleteQuery);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 901         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 902     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 903                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 904 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 905 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 906                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 907     @Override                                                                                            </span>
<span class="-7107052052553344125" onmouseenter="enter('-7107052052553344125');" onmouseout="out('-7107052052553344125');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 908     public boolean useLegacyIndexer() {                                                                  </span>
<span class="-518627155049265606" onmouseenter="enter('-518627155049265606');" onmouseout="out('-518627155049265606');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 909         return useLegacySolrIndexer;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 910     }                                                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 911 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="1122494097902733579" onmouseenter="enter('1122494097902733579');" onmouseout="out('1122494097902733579');" style="">  18 package org.broadleafcommerce.core.search.service.solr.index;                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="7358117227230759843" onmouseenter="enter('7358117227230759843');" onmouseout="out('7358117227230759843');" style="">  21 import org.apache.commons.lang3.ObjectUtils;                                                             </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5774725166806839225" onmouseenter="enter('5774725166806839225');" onmouseout="out('5774725166806839225');" style="">  25 import org.apache.solr.client.solrj.SolrClient;                                                          </span>
<span class="2534520300286315365" onmouseenter="enter('2534520300286315365');" onmouseout="out('2534520300286315365');" style="">  26 import org.apache.solr.client.solrj.SolrServerException;                                                 </span>
<span class="3039478051879307902" onmouseenter="enter('3039478051879307902');" onmouseout="out('3039478051879307902');" style="">  27 import org.apache.solr.common.SolrInputDocument;                                                         </span>
<span class="-5062615271713994505" onmouseenter="enter('-5062615271713994505');" onmouseout="out('-5062615271713994505');" style="">  28 import org.apache.solr.common.SolrInputField;                                                            </span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  29 import org.broadleafcommerce.common.exception.ExceptionHelper;                                           </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  30 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  31 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  32 import org.broadleafcommerce.common.locale.domain.Locale;                                                </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  33 import org.broadleafcommerce.common.locale.service.LocaleService;                                        </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  34 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-4286566313930798693" onmouseenter="enter('-4286566313930798693');" onmouseout="out('-4286566313930798693');" style="">  35 import org.broadleafcommerce.common.site.domain.Catalog;                                                 </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  36 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-8450438836187654019" onmouseenter="enter('-8450438836187654019');" onmouseout="out('-8450438836187654019');" style="">  37 import org.broadleafcommerce.common.util.StopWatch;                                                      </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  38 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  39 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  40 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  41 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="-4682247906377627479" onmouseenter="enter('-4682247906377627479');" onmouseout="out('-4682247906377627479');" style="">  42 import org.broadleafcommerce.core.catalog.dao.ProductDao;                                                </span>
<span class="819600147337546609" onmouseenter="enter('819600147337546609');" onmouseout="out('819600147337546609');" style="">  43 import org.broadleafcommerce.core.catalog.domain.Indexable;                                              </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  44 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-8898703314888663548" onmouseenter="enter('-8898703314888663548');" onmouseout="out('-8898703314888663548');" style="">  45 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuActiveDatesService;                  </span>
<span class="4379279529485441894" onmouseenter="enter('4379279529485441894');" onmouseout="out('4379279529485441894');" style="">  46 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuPricingService;                      </span>
<span class="-3681422864492833385" onmouseenter="enter('-3681422864492833385');" onmouseout="out('-3681422864492833385');" style="">  47 import org.broadleafcommerce.core.catalog.service.dynamic.SkuActiveDateConsiderationContext;             </span>
<span class="-829094426310214064" onmouseenter="enter('-829094426310214064');" onmouseout="out('-829094426310214064');" style="">  48 import org.broadleafcommerce.core.catalog.service.dynamic.SkuPricingConsiderationContext;                </span>
<span class="-1576266836408736884" onmouseenter="enter('-1576266836408736884');" onmouseout="out('-1576266836408736884');" style="">  49 import org.broadleafcommerce.core.search.dao.CatalogStructure;                                           </span>
<span class="3400766289256993125" onmouseenter="enter('3400766289256993125');" onmouseout="out('3400766289256993125');" style="">  50 import org.broadleafcommerce.core.search.dao.FieldDao;                                                   </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  51 import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                              </span>
<span class="920426074093689209" onmouseenter="enter('920426074093689209');" onmouseout="out('920426074093689209');" style="">  52 import org.broadleafcommerce.core.search.dao.SearchFacetDao;                                             </span>
<span class="-5322157128750858217" onmouseenter="enter('-5322157128750858217');" onmouseout="out('-5322157128750858217');" style="">  53 import org.broadleafcommerce.core.search.dao.SolrIndexDao;                                               </span>
<span class="4766648382130970293" onmouseenter="enter('4766648382130970293');" onmouseout="out('4766648382130970293');" style="">  54 import org.broadleafcommerce.core.search.domain.Field;                                                   </span>
<span class="-5357326536069928479" onmouseenter="enter('-5357326536069928479');" onmouseout="out('-5357326536069928479');" style="">  55 import org.broadleafcommerce.core.search.domain.FieldEntity;                                             </span>
<span class="6698299629643684636" onmouseenter="enter('6698299629643684636');" onmouseout="out('6698299629643684636');" style="">  56 import org.broadleafcommerce.core.search.domain.IndexField;                                              </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  57 import org.broadleafcommerce.core.search.domain.IndexFieldType;                                          </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  58 import org.broadleafcommerce.core.search.domain.solr.FieldType;                                          </span>
<span class="5698008419148469327" onmouseenter="enter('5698008419148469327');" onmouseout="out('5698008419148469327');" style="">  59 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;                                 </span>
<span class="1831820877510608733" onmouseenter="enter('1831820877510608733');" onmouseout="out('1831820877510608733');" style="">  60 import org.broadleafcommerce.core.search.service.solr.SolrHelperService;                                 </span>
<span class="-138378224551372777" onmouseenter="enter('-138378224551372777');" onmouseout="out('-138378224551372777');" style="">  61 import org.springframework.beans.factory.InitializingBean;                                               </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  62 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  63 import org.springframework.beans.factory.annotation.Qualifier;                                           </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  64 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  65 import org.springframework.stereotype.Service;                                                           </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  66 import org.springframework.transaction.PlatformTransactionManager;                                       </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  67 import org.springframework.transaction.TransactionDefinition;                                            </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  68 import org.springframework.transaction.TransactionStatus;                                                </span>
<span  style="">  69                                                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  70 import java.io.IOException;                                                                              </span>
<span class="5727252987923913" onmouseenter="enter('5727252987923913');" onmouseout="out('5727252987923913');" style="">  71 import java.lang.reflect.InvocationTargetException;                                                      </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  72 import java.math.BigDecimal;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  73 import java.util.ArrayList;                                                                              </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  74 import java.util.Collection;                                                                             </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  75 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  76 import java.util.HashSet;                                                                                </span>
<span class="5562422284534979298" onmouseenter="enter('5562422284534979298');" onmouseout="out('5562422284534979298');" style="">  77 import java.util.LinkedHashMap;                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  78 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  79 import java.util.Map;                                                                                    </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  80 import java.util.Map.Entry;                                                                              </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  81 import java.util.Set;                                                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  83 import javax.annotation.Resource;                                                                        </span>
<span  style="">  84                                                                                                          </span>
<span  style="">  85                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  86 /**                                                                                                      </span>
<span class="2637600201222846009" onmouseenter="enter('2637600201222846009');" onmouseout="out('2637600201222846009');" style="">  87  * Responsible for building and rebuilding the Solr index                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  88  *                                                                                                       </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  89  * @author Andre Azzolini (apazzolini)                                                                   </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  90  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  91  */                                                                                                      </span>
<span class="5147427781650963861" onmouseenter="enter('5147427781650963861');" onmouseout="out('5147427781650963861');" style="">  92 @Service(&quot;blSolrIndexService&quot;)                                                                           </span>
<span class="7238718603103423444" onmouseenter="enter('7238718603103423444');" onmouseout="out('7238718603103423444');" style="">  93 public class SolrIndexServiceImpl implements SolrIndexService, InitializingBean {                        </span>
<span  style="">  94                                                                                                          </span>
<span class="2912831792317267849" onmouseenter="enter('2912831792317267849');" onmouseout="out('2912831792317267849');" style="">  95     private static final Log LOG = LogFactory.getLog(SolrIndexServiceImpl.class);                        </span>
<span  style="">  96                                                                                                          </span>
<span class="-8977974913293567232" onmouseenter="enter('-8977974913293567232');" onmouseout="out('-8977974913293567232');" style="">  97     @Qualifier(&quot;blCatalogSolrConfiguration&quot;)                                                             </span>
<span class="2602789178515286342" onmouseenter="enter('2602789178515286342');" onmouseout="out('2602789178515286342');" style="">  98     @Autowired(required = false)                                                                         </span>
<span class="-8579597795724805463" onmouseenter="enter('-8579597795724805463');" onmouseout="out('-8579597795724805463');" style="">  99     protected SolrConfiguration solrConfiguration;                                                       </span>
<span  style=""> 100                                                                                                          </span>
<span class="2195771720820037705" onmouseenter="enter('2195771720820037705');" onmouseout="out('2195771720820037705');" style=""> 101     @Value(&quot;${solr.index.errorOnConcurrentReIndex}&quot;)                                                     </span>
<span class="-1712197847076792635" onmouseenter="enter('-1712197847076792635');" onmouseout="out('-1712197847076792635');" style=""> 102     protected boolean errorOnConcurrentReIndex = false;                                                  </span>
<span  style=""> 103                                                                                                          </span>
<span class="7048903042822364298" onmouseenter="enter('7048903042822364298');" onmouseout="out('7048903042822364298');" style=""> 104     @Value(&quot;${solr.index.product.pageSize}&quot;)                                                             </span>
<span class="-4484811886017880292" onmouseenter="enter('-4484811886017880292');" onmouseout="out('-4484811886017880292');" style=""> 105     protected int pageSize;                                                                              </span>
<span  style=""> 106                                                                                                          </span>
<span class="8105652327274456362" onmouseenter="enter('8105652327274456362');" onmouseout="out('8105652327274456362');" style=""> 107     @Value(&quot;${solr.index.commit}&quot;)                                                                       </span>
<span class="2310160779081566815" onmouseenter="enter('2310160779081566815');" onmouseout="out('2310160779081566815');" style=""> 108     protected boolean commit;                                                                            </span>
<span  style=""> 109                                                                                                          </span>
<span class="4958585362396000858" onmouseenter="enter('4958585362396000858');" onmouseout="out('4958585362396000858');" style=""> 110     @Value(&quot;${solr.index.softCommit}&quot;)                                                                   </span>
<span class="-7523707349512810888" onmouseenter="enter('-7523707349512810888');" onmouseout="out('-7523707349512810888');" style=""> 111     protected boolean softCommit;                                                                        </span>
<span  style=""> 112                                                                                                          </span>
<span class="2752166020843058826" onmouseenter="enter('2752166020843058826');" onmouseout="out('2752166020843058826');" style=""> 113     @Value(&quot;${solr.index.waitSearcher}&quot;)                                                                 </span>
<span class="-7977681737585438995" onmouseenter="enter('-7977681737585438995');" onmouseout="out('-7977681737585438995');" style=""> 114     protected boolean waitSearcher;                                                                      </span>
<span  style=""> 115                                                                                                          </span>
<span class="-1787870543439636120" onmouseenter="enter('-1787870543439636120');" onmouseout="out('-1787870543439636120');" style=""> 116     @Value(&quot;${solr.index.waitFlush}&quot;)                                                                    </span>
<span class="-1071744707232356027" onmouseenter="enter('-1071744707232356027');" onmouseout="out('-1071744707232356027');" style=""> 117     protected boolean waitFlush;                                                                         </span>
<span  style=""> 118                                                                                                          </span>
<span class="-504996646074126996" onmouseenter="enter('-504996646074126996');" onmouseout="out('-504996646074126996');" style=""> 119     @Value(value = &quot;${solr.catalog.useLegacySolrIndexer:true}&quot;)                                          </span>
<span class="598047637926589746" onmouseenter="enter('598047637926589746');" onmouseout="out('598047637926589746');" style=""> 120     protected boolean useLegacySolrIndexer = true;                                                       </span>
<span  style=""> 121                                                                                                          </span>
<span class="-8581768554675866702" onmouseenter="enter('-8581768554675866702');" onmouseout="out('-8581768554675866702');" style=""> 122     @Resource(name = &quot;blProductDao&quot;)                                                                     </span>
<span class="8458703512033747413" onmouseenter="enter('8458703512033747413');" onmouseout="out('8458703512033747413');" style=""> 123     protected ProductDao productDao;                                                                     </span>
<span  style=""> 124                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style=""> 125     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 126     protected CatalogService catalogService;                                                             </span>
<span  style=""> 127                                                                                                          </span>
<span class="8745422771459947563" onmouseenter="enter('8745422771459947563');" onmouseout="out('8745422771459947563');" style=""> 128     @Resource(name = &quot;blFieldDao&quot;)                                                                       </span>
<span class="-5779425042369505145" onmouseenter="enter('-5779425042369505145');" onmouseout="out('-5779425042369505145');" style=""> 129     protected FieldDao fieldDao;                                                                         </span>
<span  style=""> 130                                                                                                          </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style=""> 131     @Resource(name = &quot;blLocaleService&quot;)                                                                  </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style=""> 132     protected LocaleService localeService;                                                               </span>
<span  style=""> 133                                                                                                          </span>
<span class="3433532014428154380" onmouseenter="enter('3433532014428154380');" onmouseout="out('3433532014428154380');" style=""> 134     @Resource(name = &quot;blSolrHelperService&quot;)                                                              </span>
<span class="-7677498150151406376" onmouseenter="enter('-7677498150151406376');" onmouseout="out('-7677498150151406376');" style=""> 135     protected SolrHelperService shs;                                                                     </span>
<span  style=""> 136                                                                                                          </span>
<span class="6454351128227777183" onmouseenter="enter('6454351128227777183');" onmouseout="out('6454351128227777183');" style=""> 137     @Resource(name = &quot;blSolrIndexServiceExtensionManager&quot;)                                               </span>
<span class="5247479920184811971" onmouseenter="enter('5247479920184811971');" onmouseout="out('5247479920184811971');" style=""> 138     protected SolrIndexServiceExtensionManager extensionManager;                                         </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 140     @Resource(name = &quot;blTransactionManager&quot;)                                                             </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 141     protected PlatformTransactionManager transactionManager;                                             </span>
<span  style=""> 142                                                                                                          </span>
<span class="-2777716978602743792" onmouseenter="enter('-2777716978602743792');" onmouseout="out('-2777716978602743792');" style=""> 143     @Resource(name = &quot;blSolrIndexDao&quot;)                                                                   </span>
<span class="2803857682022434599" onmouseenter="enter('2803857682022434599');" onmouseout="out('2803857682022434599');" style=""> 144     protected SolrIndexDao solrIndexDao;                                                                 </span>
<span  style=""> 145                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 146     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 147     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 148                                                                                                          </span>
<span class="722550641335667641" onmouseenter="enter('722550641335667641');" onmouseout="out('722550641335667641');" style=""> 149     @Resource(name = &quot;blSearchFacetDao&quot;)                                                                 </span>
<span class="-2192164507887589197" onmouseenter="enter('-2192164507887589197');" onmouseout="out('-2192164507887589197');" style=""> 150     protected SearchFacetDao searchFacetDao;                                                             </span>
<span  style=""> 151                                                                                                          </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style=""> 152     @Resource(name = &quot;blIndexFieldDao&quot;)                                                                  </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style=""> 153     protected IndexFieldDao indexFieldDao;                                                               </span>
<span  style=""> 154                                                                                                          </span>
<span class="4861142252788854730" onmouseenter="enter('4861142252788854730');" onmouseout="out('4861142252788854730');" style=""> 155     @Value(value = &quot;${enable.solr.optimize:false}&quot;)                                                      </span>
<span class="-7987045041834234094" onmouseenter="enter('-7987045041834234094');" onmouseout="out('-7987045041834234094');" style=""> 156     private boolean optimizeEnabled;                                                                     </span>
<span  style=""> 157                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 158     @Override                                                                                            </span>
<span class="293221034776945003" onmouseenter="enter('293221034776945003');" onmouseout="out('293221034776945003');" style=""> 159     public void afterPropertiesSet() throws Exception {                                                  </span>
<span class="8737826944751881878" onmouseenter="enter('8737826944751881878');" onmouseout="out('8737826944751881878');" style=""> 160         if (!useLegacySolrIndexer) {                                                                     </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style=""> 161             if (useSku) {                                                                                </span>
<span class="9179894285227722563" onmouseenter="enter('9179894285227722563');" onmouseout="out('9179894285227722563');" style=""><abbr title=" 162                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.use.sku&#x27; was true, which is not supported.&quot;);"> 162                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was falðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163             }                                                                                            </span>
<span class="-3752749985901808876" onmouseenter="enter('-3752749985901808876');" onmouseout="out('-3752749985901808876');" style=""> 164             if (solrConfiguration != null &amp;&amp; solrConfiguration.isSiteCollections()) {                    </span>
<span class="-7184456578586809293" onmouseenter="enter('-7184456578586809293');" onmouseout="out('-7184456578586809293');" style=""><abbr title=" 165                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.site.collections&#x27; was true, which is not supported.&quot;);"> 165                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was falðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168     }                                                                                                    </span>
<span  style=""> 169                                                                                                          </span>
<span  style=""> 170                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 171     @Override                                                                                            </span>
<span class="-1854653869970518806" onmouseenter="enter('-1854653869970518806');" onmouseout="out('-1854653869970518806');" style=""><abbr title=" 172     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException {"> 172     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 173         try {                                                                                            </span>
<span class="2574663780463066494" onmouseenter="enter('2574663780463066494');" onmouseout="out('2574663780463066494');" style=""> 174             CatalogStructure cache = new CatalogStructure();                                             </span>
<span class="1856999562212420811" onmouseenter="enter('1856999562212420811');" onmouseout="out('1856999562212420811');" style=""> 175             SolrIndexCachedOperation.setCache(cache);                                                    </span>
<span class="-195994336271238110" onmouseenter="enter('-195994336271238110');" onmouseout="out('-195994336271238110');" style=""> 176             cacheOperation.execute();                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 177         } finally {                                                                                      </span>
<span class="7293095816713805281" onmouseenter="enter('7293095816713805281');" onmouseout="out('7293095816713805281');" style=""> 178             SolrIndexCachedOperation.clearCache();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span  style=""> 181                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 182     @Override                                                                                            </span>
<span class="-8221211564360382808" onmouseenter="enter('-8221211564360382808');" onmouseout="out('-8221211564360382808');" style=""> 183     public void rebuildIndex() throws ServiceException, IOException {                                    </span>
<span class="4404402464743924238" onmouseenter="enter('4404402464743924238');" onmouseout="out('4404402464743924238');" style=""> 184         LOG.info(&quot;Rebuilding the entire Solr index...&quot;);                                                 </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 185         StopWatch s = new StopWatch();                                                                   </span>
<span  style=""> 186                                                                                                          </span>
<span class="2782448594641417849" onmouseenter="enter('2782448594641417849');" onmouseout="out('2782448594641417849');" style=""> 187         preBuildIndex();                                                                                 </span>
<span class="5364167027467208466" onmouseenter="enter('5364167027467208466');" onmouseout="out('5364167027467208466');" style=""> 188         buildIndex();                                                                                    </span>
<span class="-2734214044106280557" onmouseenter="enter('-2734214044106280557');" onmouseout="out('-2734214044106280557');" style=""> 189         postBuildIndex();                                                                                </span>
<span  style=""> 190                                                                                                          </span>
<span class="8949756262532963545" onmouseenter="enter('8949756262532963545');" onmouseout="out('8949756262532963545');" style=""> 191         LOG.info(String.format(&quot;Finished building entire Solr index in %s&quot;, s.toLapString()));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192     }                                                                                                    </span>
<span  style=""> 193                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 194     @Override                                                                                            </span>
<span class="3237807690855435825" onmouseenter="enter('3237807690855435825');" onmouseout="out('3237807690855435825');" style=""> 195     public void preBuildIndex() throws ServiceException {                                                </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style=""><abbr title=" 196         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 196         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197     }                                                                                                    </span>
<span  style=""> 198                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 199     @Override                                                                                            </span>
<span class="107860368930590037" onmouseenter="enter('107860368930590037');" onmouseout="out('107860368930590037');" style=""> 200     public void buildIndex() throws IOException, ServiceException {                                      </span>
<span class="5469402358120203042" onmouseenter="enter('5469402358120203042');" onmouseout="out('5469402358120203042');" style=""> 201         executeSolrIndexOperation(getReindexOperation());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 204     @Override                                                                                            </span>
<span class="2712485588427861869" onmouseenter="enter('2712485588427861869');" onmouseout="out('2712485588427861869');" style=""> 205     public void postBuildIndex() throws IOException, ServiceException {                                  </span>
<span class="8445746639246064219" onmouseenter="enter('8445746639246064219');" onmouseout="out('8445746639246064219');" style=""> 206         if(optimizeEnabled) {                                                                            </span>
<span class="4104911694494191311" onmouseenter="enter('4104911694494191311');" onmouseout="out('4104911694494191311');" style=""> 207         // this is required to be at the very very very end after rebuilding the whole index             </span>
<span class="-3594378582194653803" onmouseenter="enter('-3594378582194653803');" onmouseout="out('-3594378582194653803');" style=""><abbr title=" 208             optimizeIndex(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 208             optimizeIndex(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209         }                                                                                                </span>
<span class="-7179442614804219935" onmouseenter="enter('-7179442614804219935');" onmouseout="out('-7179442614804219935');" style=""> 210         // Swap the active and the reindex cores                                                         </span>
<span class="-211335379164132987" onmouseenter="enter('-211335379164132987');" onmouseout="out('-211335379164132987');" style=""> 211         if (!solrConfiguration.isSingleCoreMode()) {                                                     </span>
<span class="-1073514264710403192" onmouseenter="enter('-1073514264710403192');" onmouseout="out('-1073514264710403192');" style=""> 212             shs.swapActiveCores(solrConfiguration);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 216     @Override                                                                                            </span>
<span class="-811355888891304948" onmouseenter="enter('-811355888891304948');" onmouseout="out('-811355888891304948');" style=""> 217     public SolrIndexOperation getReindexOperation() {                                                    </span>
<span class="4313634092062438466" onmouseenter="enter('4313634092062438466');" onmouseout="out('4313634092062438466');" style=""><abbr title=" 218         return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex) {"> 218         return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex)ðŸ”µ</abbr></span>
<span  style=""> 219                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 220             @Override                                                                                    </span>
<span class="-4387595312024622473" onmouseenter="enter('-4387595312024622473');" onmouseout="out('-4387595312024622473');" style=""> 221             public List&lt;? extends Indexable&gt; readIndexables(int pageSize, Long lastId) {                 </span>
<span class="4006405235344016633" onmouseenter="enter('4006405235344016633');" onmouseout="out('4006405235344016633');" style=""> 222                 return readAllActiveIndexables(pageSize, lastId);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223             }                                                                                            </span>
<span  style=""> 224                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225             @Override                                                                                    </span>
<span class="5959961393917647667" onmouseenter="enter('5959961393917647667');" onmouseout="out('5959961393917647667');" style=""> 226             public Long countIndexables() {                                                              </span>
<span class="2520275452674275986" onmouseenter="enter('2520275452674275986');" onmouseout="out('2520275452674275986');" style=""> 227                 return countIndexableItems();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228             }                                                                                            </span>
<span  style=""> 229                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 230             @Override                                                                                    </span>
<span class="-1692826682113823468" onmouseenter="enter('-1692826682113823468');" onmouseout="out('-1692826682113823468');" style=""> 231             public void buildPage(List&lt;? extends Indexable&gt; indexables) throws ServiceException {        </span>
<span class="3979625068666947530" onmouseenter="enter('3979625068666947530');" onmouseout="out('3979625068666947530');" style=""><abbr title=" 232                 buildIncrementalIndex(getSolrCollectionForIndexing(), indexables, getSolrServerForIndexing());"> 232                 buildIncrementalIndex(getSolrCollectionForIndexing(), indexables, getSolrServerForIndexinðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 234         };                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 237     @Override                                                                                            </span>
<span class="-4119273796811407274" onmouseenter="enter('-4119273796811407274');" onmouseout="out('-4119273796811407274');" style=""><abbr title=" 238     public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOException {"> 238     public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOðŸ”µ</abbr></span>
<span class="-6605112368804100748" onmouseenter="enter('-6605112368804100748');" onmouseout="out('-6605112368804100748');" style=""> 239         operation.obtainLock();                                                                          </span>
<span  style=""> 240                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 241         try {                                                                                            </span>
<span class="5776764097449375233" onmouseenter="enter('5776764097449375233');" onmouseout="out('5776764097449375233');" style=""> 242             LOG.info(&quot;Executing Indexing operation&quot;);                                                    </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 243             StopWatch s = new StopWatch();                                                               </span>
<span  style=""> 244                                                                                                          </span>
<span class="-4925351317711298127" onmouseenter="enter('-4925351317711298127');" onmouseout="out('-4925351317711298127');" style=""> 245             Object[] pack = saveState();                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 246             try {                                                                                        </span>
<span class="4852869320838830283" onmouseenter="enter('4852869320838830283');" onmouseout="out('4852869320838830283');" style=""> 247                 final Long numItemsToIndex;                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 248                 try {                                                                                    </span>
<span class="997617649642836840" onmouseenter="enter('997617649642836840');" onmouseout="out('997617649642836840');" style=""> 249                     operation.beforeCountIndexables();                                                   </span>
<span  style=""> 250                                                                                                          </span>
<span class="-8341915703694509082" onmouseenter="enter('-8341915703694509082');" onmouseout="out('-8341915703694509082');" style=""> 251                     numItemsToIndex = operation.countIndexables();                                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 252                 } finally {                                                                              </span>
<span class="8625682159596383443" onmouseenter="enter('8625682159596383443');" onmouseout="out('8625682159596383443');" style=""> 253                     operation.afterCountIndexables();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                 }                                                                                        </span>
<span  style=""> 255                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 256                 if (LOG.isDebugEnabled()) {                                                              </span>
<span class="-1342537230534112505" onmouseenter="enter('-1342537230534112505');" onmouseout="out('-1342537230534112505');" style=""> 257                     LOG.debug(&quot;There are at most &quot; + numItemsToIndex + &quot; items to index&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258                 }                                                                                        </span>
<span class="-6975585634623067095" onmouseenter="enter('-6975585634623067095');" onmouseout="out('-6975585634623067095');" style=""> 259                 performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {                   </span>
<span  style=""> 260                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 261                     @Override                                                                            </span>
<span class="-7096128206041696180" onmouseenter="enter('-7096128206041696180');" onmouseout="out('-7096128206041696180');" style=""> 262                     public void execute() throws ServiceException {                                      </span>
<span class="-4395739824177979579" onmouseenter="enter('-4395739824177979579');" onmouseout="out('-4395739824177979579');" style=""> 263                         int page = 1;                                                                    </span>
<span class="4634490409390119351" onmouseenter="enter('4634490409390119351');" onmouseout="out('4634490409390119351');" style=""> 264                         Long lastId = null;                                                              </span>
<span class="-2807153128771866015" onmouseenter="enter('-2807153128771866015');" onmouseout="out('-2807153128771866015');" style=""> 265                         Long remainingNumItemsToIndex = numItemsToIndex;                                 </span>
<span class="-6866370637183701575" onmouseenter="enter('-6866370637183701575');" onmouseout="out('-6866370637183701575');" style=""> 266                         Long totalPages = getTotalPageCount(numItemsToIndex);                            </span>
<span  style=""> 267                                                                                                          </span>
<span class="-2134634807912211771" onmouseenter="enter('-2134634807912211771');" onmouseout="out('-2134634807912211771');" style=""> 268                         while (remainingNumItemsToIndex &gt; 0) {                                           </span>
<span class="6951794882859960666" onmouseenter="enter('6951794882859960666');" onmouseout="out('6951794882859960666');" style=""> 269                             String pageNumberMessage = buildPageNumberMessage(page, totalPages);         </span>
<span class="5716330204152709052" onmouseenter="enter('5716330204152709052');" onmouseout="out('5716330204152709052');" style=""> 270                             LOG.info(pageNumberMessage);                                                 </span>
<span  style=""> 271                                                                                                          </span>
<span class="165772722778294439" onmouseenter="enter('165772722778294439');" onmouseout="out('165772722778294439');" style=""> 272                             lastId = buildIncrementalIndex(pageSize, lastId, operation);                 </span>
<span class="-4024045770293484238" onmouseenter="enter('-4024045770293484238');" onmouseout="out('-4024045770293484238');" style=""> 273                             remainingNumItemsToIndex -= pageSize;                                        </span>
<span class="-8284897147643623971" onmouseenter="enter('-8284897147643623971');" onmouseout="out('-8284897147643623971');" style=""> 274                             page++;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 277                 });                                                                                      </span>
<span  style=""> 278                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 279             } finally {                                                                                  </span>
<span class="-5823413484715712161" onmouseenter="enter('-5823413484715712161');" onmouseout="out('-5823413484715712161');" style=""> 280                 restoreState(pack);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281             }                                                                                            </span>
<span  style=""> 282                                                                                                          </span>
<span class="7093623796813341550" onmouseenter="enter('7093623796813341550');" onmouseout="out('7093623796813341550');" style=""> 283             LOG.info(String.format(&quot;Indexing operation completed in %s&quot;, s.toLapString()));              </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 284         } finally {                                                                                      </span>
<span class="-1350180452435495402" onmouseenter="enter('-1350180452435495402');" onmouseout="out('-1350180452435495402');" style=""> 285             operation.releaseLock();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287     }                                                                                                    </span>
<span  style=""> 288                                                                                                          </span>
<span class="4509881942909907564" onmouseenter="enter('4509881942909907564');" onmouseout="out('4509881942909907564');" style=""> 289     protected long getTotalPageCount(Long numItemsToIndex) {                                             </span>
<span class="885623822255204209" onmouseenter="enter('885623822255204209');" onmouseout="out('885623822255204209');" style=""> 290         long numPagesToIndex = numItemsToIndex / pageSize;                                               </span>
<span class="1202091708155781117" onmouseenter="enter('1202091708155781117');" onmouseout="out('1202091708155781117');" style=""> 291         boolean hasRemainingItemsToIndex = numItemsToIndex % pageSize != 0;                              </span>
<span  style=""> 292                                                                                                          </span>
<span class="-8914515660918232216" onmouseenter="enter('-8914515660918232216');" onmouseout="out('-8914515660918232216');" style=""> 293         return hasRemainingItemsToIndex ? (numPagesToIndex + 1) : numPagesToIndex;                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294     }                                                                                                    </span>
<span  style=""> 295                                                                                                          </span>
<span class="-1140169622753247687" onmouseenter="enter('-1140169622753247687');" onmouseout="out('-1140169622753247687');" style=""> 296     protected String buildPageNumberMessage(int page, Long totalPages) {                                 </span>
<span class="5185167171670482872" onmouseenter="enter('5185167171670482872');" onmouseout="out('5185167171670482872');" style=""> 297         String pageNumberMessage = String.format(&quot;Building page number %s of %s&quot;, page, totalPages);     </span>
<span  style=""> 298                                                                                                          </span>
<span class="3917690980387875903" onmouseenter="enter('3917690980387875903');" onmouseout="out('3917690980387875903');" style=""><abbr title=" 299         Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog();"> 299         Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog()ðŸ”µ</abbr></span>
<span class="3059190135946477261" onmouseenter="enter('3059190135946477261');" onmouseout="out('3059190135946477261');" style=""> 300         if (currentCatalog != null) {                                                                    </span>
<span class="-2760479412731933677" onmouseenter="enter('-2760479412731933677');" onmouseout="out('-2760479412731933677');" style=""> 301             pageNumberMessage += String.format(&quot; for catalog: %s&quot;, currentCatalog.getName());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302         }                                                                                                </span>
<span  style=""> 303                                                                                                          </span>
<span class="6061536256827306935" onmouseenter="enter('6061536256827306935');" onmouseout="out('6061536256827306935');" style=""> 304         return pageNumberMessage;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305     }                                                                                                    </span>
<span  style=""> 306                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 307     /**                                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 308      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 309      */                                                                                                  </span>
<span class="307261357449118205" onmouseenter="enter('307261357449118205');" onmouseout="out('307261357449118205');" style=""> 310     protected Long countIndexableItems() {                                                               </span>
<span class="3881831181376649254" onmouseenter="enter('3881831181376649254');" onmouseout="out('3881831181376649254');" style=""> 311             return productDao.readCountAllActiveProducts();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312         }                                                                                                </span>
<span  style=""> 313                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 314     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 315      * &lt;p&gt;                                                                                               </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 316      * This method deletes all of the documents from {@link SolrContext#getReindexServer()}              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 317      *                                                                                                   </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 318      * @throws ServiceException if there was a problem removing the documents                            </span>
<span class="-1570570320656419415" onmouseenter="enter('-1570570320656419415');" onmouseout="out('-1570570320656419415');" style=""> 319      * @deprecated use {@link #deleteAllReindexCoreDocuments()} instead                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 320      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 321     @Deprecated                                                                                          </span>
<span class="7799053882932808400" onmouseenter="enter('7799053882932808400');" onmouseout="out('7799053882932808400');" style=""> 322     protected void deleteAllDocuments() throws ServiceException {                                        </span>
<span class="3834807060428836051" onmouseenter="enter('3834807060428836051');" onmouseout="out('3834807060428836051');" style=""> 323         deleteAllReindexCoreDocuments();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324     }                                                                                                    </span>
<span  style=""> 325                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 326     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 327      * &lt;p&gt;                                                                                               </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 328      * This method deletes all of the documents from {@link SolrContext#getReindexServer()}              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 329      *                                                                                                   </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 330      * @throws ServiceException if there was a problem removing the documents                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 331      */                                                                                                  </span>
<span class="6870158579484852535" onmouseenter="enter('6870158579484852535');" onmouseout="out('6870158579484852535');" style=""> 332     protected void deleteAllReindexCoreDocuments() throws ServiceException {                             </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style=""><abbr title=" 333         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 333         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 336     @Override                                                                                            </span>
<span class="-4976975123662493196" onmouseenter="enter('-4976975123662493196');" onmouseout="out('-4976975123662493196');" style=""><abbr title=" 337     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException {"> 337     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 338         try {                                                                                            </span>
<span class="-6389361698931234700" onmouseenter="enter('-6389361698931234700');" onmouseout="out('-6389361698931234700');" style=""> 339             String deleteQuery = StringUtil.sanitize(shs.getNamespaceFieldName()) + &quot;:(\&quot;&quot;               </span>
<span class="-1195999488596466196" onmouseenter="enter('-1195999488596466196');" onmouseout="out('-1195999488596466196');" style=""> 340                     + StringUtil.sanitize(solrConfiguration.getNamespace()) + &quot;\&quot;)&quot;;                     </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 341             LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                              </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style=""> 342             server.deleteByQuery(collection, deleteQuery);                                               </span>
<span  style=""> 343                                                                                                          </span>
<span class="-546379745910436336" onmouseenter="enter('-546379745910436336');" onmouseout="out('-546379745910436336');" style=""> 344             //Explicitly do a hard commit here since we just deleted the entire index                    </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style=""> 345             server.commit(collection);                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 346         } catch (Exception e) {                                                                          </span>
<span class="4280241435178863824" onmouseenter="enter('4280241435178863824');" onmouseout="out('4280241435178863824');" style=""> 347             if (ServiceException.class.isAssignableFrom(e.getClass())) {                                 </span>
<span class="-9048611182670468194" onmouseenter="enter('-9048611182670468194');" onmouseout="out('-9048611182670468194');" style=""> 348                 throw (ServiceException) e;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349             }                                                                                            </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 350             throw new ServiceException(&quot;Could not delete documents&quot;, e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352     }                                                                                                    </span>
<span  style=""> 353                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 354     @Override                                                                                            </span>
<span class="8552288591606532671" onmouseenter="enter('8552288591606532671');" onmouseout="out('8552288591606532671');" style=""> 355     public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException {       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 356         try {                                                                                            </span>
<span class="2136303103230726070" onmouseenter="enter('2136303103230726070');" onmouseout="out('2136303103230726070');" style=""> 357             String deleteQuery = &quot;*:*&quot;;                                                                  </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 358             LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                              </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style=""> 359             server.deleteByQuery(collection, deleteQuery);                                               </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style=""> 360             server.commit(collection);                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 361         } catch (Exception e) {                                                                          </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 362             throw new ServiceException(&quot;Could not delete documents&quot;, e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364     }                                                                                                    </span>
<span  style=""> 365                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 366     @Override                                                                                            </span>
<span class="125965368563769580" onmouseenter="enter('125965368563769580');" onmouseout="out('125965368563769580');" style=""> 367     public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException {                 </span>
<span class="-6644416202801761209" onmouseenter="enter('-6644416202801761209');" onmouseout="out('-6644416202801761209');" style=""> 368         deleteAllNamespaceDocuments(null, server);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369     }                                                                                                    </span>
<span  style=""> 370                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 371     @Override                                                                                            </span>
<span class="31475417648561827" onmouseenter="enter('31475417648561827');" onmouseout="out('31475417648561827');" style=""> 372     public void deleteAllDocuments(SolrClient server) throws ServiceException {                          </span>
<span class="6597141509256723624" onmouseenter="enter('6597141509256723624');" onmouseout="out('6597141509256723624');" style=""> 373         deleteAllDocuments(null, server);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374     }                                                                                                    </span>
<span  style=""> 375                                                                                                          </span>
<span class="-1911085678082561084" onmouseenter="enter('-1911085678082561084');" onmouseout="out('-1911085678082561084');" style=""><abbr title=" 376     protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ServiceException {"> 376     protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ðŸ”µ</abbr></span>
<span class="1006805691441623516" onmouseenter="enter('1006805691441623516');" onmouseout="out('1006805691441623516');" style=""> 377         TransactionStatus status = TransactionUtils.createTransaction(&quot;readItemsToIndex&quot;,                </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 378             TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                       </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 379         if (SolrIndexCachedOperation.getCache() == null) {                                               </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 380             LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +   </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 381                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 381                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382         }                                                                                                </span>
<span class="-4530225541058778702" onmouseenter="enter('-4530225541058778702');" onmouseout="out('-4530225541058778702');" style=""> 383         Long response = null;                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 384         try {                                                                                            </span>
<span class="-3204111561138569714" onmouseenter="enter('-3204111561138569714');" onmouseout="out('-3204111561138569714');" style=""> 385             List&lt;? extends Indexable&gt; indexables;                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 386             try {                                                                                        </span>
<span class="3356995070675471983" onmouseenter="enter('3356995070675471983');" onmouseout="out('3356995070675471983');" style=""> 387                 operation.beforeReadIndexables();                                                        </span>
<span class="1315644369404660428" onmouseenter="enter('1315644369404660428');" onmouseout="out('1315644369404660428');" style=""> 388                 indexables = operation.readIndexables(pageSize, lastId);                                 </span>
<span class="-3163865863529807802" onmouseenter="enter('-3163865863529807802');" onmouseout="out('-3163865863529807802');" style=""> 389                 if (CollectionUtils.isNotEmpty(indexables)) {                                            </span>
<span class="1879209496515446980" onmouseenter="enter('1879209496515446980');" onmouseout="out('1879209496515446980');" style=""> 390                     response = indexables.get(indexables.size()-1).getId();                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391                 }                                                                                        </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 392             } finally {                                                                                  </span>
<span class="-7029725537576676912" onmouseenter="enter('-7029725537576676912');" onmouseout="out('-7029725537576676912');" style=""> 393                 operation.afterReadIndexables();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394             }                                                                                            </span>
<span  style=""> 395                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 396             try {                                                                                        </span>
<span class="-2168921446123257487" onmouseenter="enter('-2168921446123257487');" onmouseout="out('-2168921446123257487');" style=""> 397                 operation.beforeBuildPage();                                                             </span>
<span  style=""> 398                                                                                                          </span>
<span class="9094317700245591530" onmouseenter="enter('9094317700245591530');" onmouseout="out('9094317700245591530');" style=""> 399                 operation.buildPage(indexables);                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 400             } finally {                                                                                  </span>
<span class="3074038306845641791" onmouseenter="enter('3074038306845641791');" onmouseout="out('3074038306845641791');" style=""> 401                 operation.afterBuildPage();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402             }                                                                                            </span>
<span  style=""> 403                                                                                                          </span>
<span  style=""> 404                                                                                                          </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 405             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 406         } catch (RuntimeException e) {                                                                   </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 407             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 408             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 410         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411     }                                                                                                    </span>
<span  style=""> 412                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 413     @Override                                                                                            </span>
<span class="-3229146772555478401" onmouseenter="enter('-3229146772555478401');" onmouseout="out('-3229146772555478401');" style=""><abbr title=" 414     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 414     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends IndexablðŸ”µ</abbr></span>
<span class="2510928886343537128" onmouseenter="enter('2510928886343537128');" onmouseout="out('2510928886343537128');" style=""> 415         TransactionStatus status = TransactionUtils.createTransaction(&quot;executeIncrementalIndex&quot;,         </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 416                 TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                   </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 417         if (SolrIndexCachedOperation.getCache() == null) {                                               </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 418             LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +   </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 419                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 419                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span  style=""> 421                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 422         if (LOG.isDebugEnabled()) {                                                                      </span>
<span class="5294183869527180393" onmouseenter="enter('5294183869527180393');" onmouseout="out('5294183869527180393');" style=""><abbr title=" 423             LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.size()));"> 423             LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424         }                                                                                                </span>
<span  style=""> 425                                                                                                          </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 426         StopWatch s = new StopWatch();                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 427         try {                                                                                            </span>
<span class="6539966544446663437" onmouseenter="enter('6539966544446663437');" onmouseout="out('6539966544446663437');" style=""> 428             sandBoxHelper.ignoreCloneCache(true);                                                        </span>
<span class="7183587253332869173" onmouseenter="enter('7183587253332869173');" onmouseout="out('7183587253332869173');" style=""> 429             extensionManager.getProxy().startBatchEvent(indexables);                                     </span>
<span class="3424650845291102605" onmouseenter="enter('3424650845291102605');" onmouseout="out('3424650845291102605');" style=""> 430             Collection&lt;SolrInputDocument&gt; documents = new ArrayList&lt;&gt;();                                 </span>
<span class="7801772952659649444" onmouseenter="enter('7801772952659649444');" onmouseout="out('7801772952659649444');" style=""> 431             List&lt;Locale&gt; locales = getAllLocales();                                                      </span>
<span  style=""> 432                                                                                                          </span>
<span class="-2189912087670236149" onmouseenter="enter('-2189912087670236149');" onmouseout="out('-2189912087670236149');" style=""><abbr title=" 433             List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;() {"> 433             List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 434                 @Override                                                                                </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 435                 public Long transform(Object input) {                                                    </span>
<span class="6561542425546767799" onmouseenter="enter('6561542425546767799');" onmouseout="out('6561542425546767799');" style=""> 436                     return shs.getCurrentProductId((Indexable) input);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 438             });                                                                                          </span>
<span  style=""> 439                                                                                                          </span>
<span class="-6904889408824287124" onmouseenter="enter('-6904889408824287124');" onmouseout="out('-6904889408824287124');" style=""><abbr title=" 440             solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache());"> 440             solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache())ðŸ”µ</abbr></span>
<span  style=""> 441                                                                                                          </span>
<span class="326959637207207549" onmouseenter="enter('326959637207207549');" onmouseout="out('326959637207207549');" style=""> 442             List&lt;IndexField&gt; fields = null;                                                              </span>
<span class="-1903082167184535893" onmouseenter="enter('-1903082167184535893');" onmouseout="out('-1903082167184535893');" style=""> 443             FieldEntity currentFieldType = null;                                                         </span>
<span class="-3671570197523764351" onmouseenter="enter('-3671570197523764351');" onmouseout="out('-3671570197523764351');" style=""> 444             for (Indexable indexable : indexables) {                                                     </span>
<span class="-6818188811001504815" onmouseenter="enter('-6818188811001504815');" onmouseout="out('-6818188811001504815');" style=""><abbr title=" 445                 if (fields == null || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityType())) {"> 445                 if (fields == null || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityTypeðŸ”µ</abbr></span>
<span class="4379308220695057970" onmouseenter="enter('4379308220695057970');" onmouseout="out('4379308220695057970');" style=""> 446                     fields = indexFieldDao.readFieldsByEntityType(indexable.getFieldEntityType());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447                 }                                                                                        </span>
<span  style=""> 448                                                                                                          </span>
<span class="7630570351050256200" onmouseenter="enter('7630570351050256200');" onmouseout="out('7630570351050256200');" style=""> 449                 SolrInputDocument doc = buildDocument(indexable, fields, locales);                       </span>
<span class="-3475311009677795568" onmouseenter="enter('-3475311009677795568');" onmouseout="out('-3475311009677795568');" style=""><abbr title=" 450                 //If someone overrides the buildDocument method and determines that they don&#x27;t want a product"> 450                 //If someone overrides the buildDocument method and determines that they don&#x27;t want a proðŸ”µ</abbr></span>
<span class="4539214609551390244" onmouseenter="enter('4539214609551390244');" onmouseout="out('4539214609551390244');" style=""> 451                 //indexed, then they can return null. If the document is null it does not get added to   </span>
<span class="-225951702109518326" onmouseenter="enter('-225951702109518326');" onmouseout="out('-225951702109518326');" style=""> 452                 //to the index.                                                                          </span>
<span class="-5520172171866318279" onmouseenter="enter('-5520172171866318279');" onmouseout="out('-5520172171866318279');" style=""> 453                 if (doc != null) {                                                                       </span>
<span class="4425904984588304942" onmouseenter="enter('4425904984588304942');" onmouseout="out('4425904984588304942');" style=""> 454                     documents.add(doc);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456             }                                                                                            </span>
<span  style=""> 457                                                                                                          </span>
<span class="-5162140986849793305" onmouseenter="enter('-5162140986849793305');" onmouseout="out('-5162140986849793305');" style=""> 458             extensionManager.getProxy().modifyBuiltDocuments(documents, indexables, fields, locales);    </span>
<span  style=""> 459                                                                                                          </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 460             logDocuments(documents);                                                                     </span>
<span  style=""> 461                                                                                                          </span>
<span class="-6239196544496643062" onmouseenter="enter('-6239196544496643062');" onmouseout="out('-6239196544496643062');" style=""> 462             if (!CollectionUtils.isEmpty(documents) &amp;&amp; solrServer != null) {                             </span>
<span class="6742664882868092095" onmouseenter="enter('6742664882868092095');" onmouseout="out('6742664882868092095');" style=""> 463                 solrServer.add(collection, documents);                                                   </span>
<span class="4440071783810203686" onmouseenter="enter('4440071783810203686');" onmouseout="out('4440071783810203686');" style=""> 464                 commit(collection, solrServer);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465             }                                                                                            </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 466             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span  style=""> 467                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 468             if (LOG.isDebugEnabled()) {                                                                  </span>
<span class="-5239549129780834185" onmouseenter="enter('-5239549129780834185');" onmouseout="out('-5239549129780834185');" style=""><abbr title=" 469                 LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexables.size(), s.toLapString()));"> 469                 LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470             }                                                                                            </span>
<span  style=""> 471                                                                                                          </span>
<span class="-4724346008918927046" onmouseenter="enter('-4724346008918927046');" onmouseout="out('-4724346008918927046');" style=""> 472             return documents;                                                                            </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 473         } catch (SolrServerException e) {                                                                </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 474             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 475             throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 476         } catch (IOException e) {                                                                        </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 477             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 478             throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                    </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 479         } catch (RuntimeException e) {                                                                   </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 480             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 481             throw e;                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 482         } finally {                                                                                      </span>
<span class="90671037077050937" onmouseenter="enter('90671037077050937');" onmouseout="out('90671037077050937');" style=""> 483             extensionManager.getProxy().endBatchEvent(indexables);                                       </span>
<span class="8189254405929957329" onmouseenter="enter('8189254405929957329');" onmouseout="out('8189254405929957329');" style=""> 484             sandBoxHelper.ignoreCloneCache(false);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486     }                                                                                                    </span>
<span  style=""> 487                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 488     @Override                                                                                            </span>
<span class="8474819187366488777" onmouseenter="enter('8474819187366488777');" onmouseout="out('8474819187366488777');" style=""><abbr title=" 489     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 489     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrðŸ”µ</abbr></span>
<span class="1797277787154549011" onmouseenter="enter('1797277787154549011');" onmouseout="out('1797277787154549011');" style=""> 490         return buildIncrementalIndex(null, indexables, solrServer);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491     }                                                                                                    </span>
<span  style=""> 492                                                                                                          </span>
<span class="5551263307167100166" onmouseenter="enter('5551263307167100166');" onmouseout="out('5551263307167100166');" style=""> 493     protected List&lt;? extends Indexable&gt; readAllActiveIndexables(int pageSize, Long lastId) {             </span>
<span class="6192419674169007142" onmouseenter="enter('6192419674169007142');" onmouseout="out('6192419674169007142');" style=""> 494             return productDao.readAllActiveProducts(pageSize, lastId);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495         }                                                                                                </span>
<span  style=""> 496                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 497     @Override                                                                                            </span>
<span class="-8038322947777108176" onmouseenter="enter('-8038322947777108176');" onmouseout="out('-8038322947777108176');" style=""> 498     public List&lt;Locale&gt; getAllLocales() {                                                                </span>
<span class="-8741721793451188111" onmouseenter="enter('-8741721793451188111');" onmouseout="out('-8741721793451188111');" style=""> 499         List&lt;Locale&gt; allLocales = localeService.findAllLocales();                                        </span>
<span class="4034520407475000176" onmouseenter="enter('4034520407475000176');" onmouseout="out('4034520407475000176');" style=""> 500         Map&lt;String, Locale&gt; processedLocales = new HashMap&lt;&gt;();                                          </span>
<span class="2399355616829443482" onmouseenter="enter('2399355616829443482');" onmouseout="out('2399355616829443482');" style=""><abbr title=" 501         // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale set and I&#x27;m"> 501         // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale seðŸ”µ</abbr></span>
<span class="1459641740327693907" onmouseenter="enter('1459641740327693907');" onmouseout="out('1459641740327693907');" style=""> 502         // not using the country code to index the values, then I only need to index the locale &#x27;en&#x27;     </span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style=""> 503         for (Locale locale : allLocales) {                                                               </span>
<span class="343473664574147441" onmouseenter="enter('343473664574147441');" onmouseout="out('343473664574147441');" style=""> 504             String localeCode = locale.getLocaleCode();                                                  </span>
<span class="-113413807046306655" onmouseenter="enter('-113413807046306655');" onmouseout="out('-113413807046306655');" style=""> 505             int underscoreLocation = localeCode.indexOf(&quot;_&quot;);                                            </span>
<span class="5152034502068978670" onmouseenter="enter('5152034502068978670');" onmouseout="out('5152034502068978670');" style=""> 506             if (underscoreLocation &gt; 0 &amp;&amp; Boolean.FALSE.equals(locale.getUseCountryInSearchIndex())) {   </span>
<span class="8938820827276960997" onmouseenter="enter('8938820827276960997');" onmouseout="out('8938820827276960997');" style=""> 507                 String localeCodeWithoutCountry = localeCode.substring(0, underscoreLocation);           </span>
<span class="-6764305435332837995" onmouseenter="enter('-6764305435332837995');" onmouseout="out('-6764305435332837995');" style=""> 508                 if (!processedLocales.containsKey(localeCodeWithoutCountry)) {                           </span>
<span class="-3212129377547784987" onmouseenter="enter('-3212129377547784987');" onmouseout="out('-3212129377547784987');" style=""> 509                     processedLocales.put(localeCodeWithoutCountry, locale);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 511             } else {                                                                                     </span>
<span class="-3143247090679758655" onmouseenter="enter('-3143247090679758655');" onmouseout="out('-3143247090679758655');" style=""> 512                 processedLocales.put(locale.getLocaleCode(), locale);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514         }                                                                                                </span>
<span class="8478562493399850393" onmouseenter="enter('8478562493399850393');" onmouseout="out('8478562493399850393');" style=""> 515         return new ArrayList&lt;&gt;(processedLocales.values());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516     }                                                                                                    </span>
<span  style=""> 517                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 518     @Override                                                                                            </span>
<span class="-5988937181784380794" onmouseenter="enter('-5988937181784380794');" onmouseout="out('-5988937181784380794');" style=""><abbr title=" 519     public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 519     public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;LocalðŸ”µ</abbr></span>
<span class="4147487252329209973" onmouseenter="enter('4147487252329209973');" onmouseout="out('4147487252329209973');" style=""><abbr title=" 520         final SolrInputDocument document = new SolrInputDocument(new LinkedHashMap&lt;String,SolrInputField&gt;());"> 520         final SolrInputDocument document = new SolrInputDocument(new LinkedHashMap&lt;String,SolrInputField&gt;ðŸ”µ</abbr></span>
<span  style=""> 521                                                                                                          </span>
<span class="-1191402169666210527" onmouseenter="enter('-1191402169666210527');" onmouseout="out('-1191402169666210527');" style=""> 522         attachBasicDocumentFields(indexable, document);                                                  </span>
<span  style=""> 523                                                                                                          </span>
<span class="6176356407772671184" onmouseenter="enter('6176356407772671184');" onmouseout="out('6176356407772671184');" style=""> 524         attachIndexableDocumentFields(document, indexable, fields, locales);                             </span>
<span  style=""> 525                                                                                                          </span>
<span class="-7308801397401646621" onmouseenter="enter('-7308801397401646621');" onmouseout="out('-7308801397401646621');" style=""> 526         attachAdditionalDocumentFields(indexable, document);                                             </span>
<span  style=""> 527                                                                                                          </span>
<span class="581573764679058551" onmouseenter="enter('581573764679058551');" onmouseout="out('581573764679058551');" style=""> 528         extensionManager.getProxy().attachChildDocuments(indexable, document, fields, locales);          </span>
<span  style=""> 529                                                                                                          </span>
<span class="-4026438827530914052" onmouseenter="enter('-4026438827530914052');" onmouseout="out('-4026438827530914052');" style=""> 530         return document;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531     }                                                                                                    </span>
<span  style=""> 532                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 533     @Override                                                                                            </span>
<span class="-2827903308009028143" onmouseenter="enter('-2827903308009028143');" onmouseout="out('-2827903308009028143');" style=""><abbr title=" 534     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 534     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr></span>
<span class="-7267711193404106417" onmouseenter="enter('-7267711193404106417');" onmouseout="out('-7267711193404106417');" style=""> 535         for (IndexField indexField : fields) {                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 536             try {                                                                                        </span>
<span class="-5685362315060478990" onmouseenter="enter('-5685362315060478990');" onmouseout="out('-5685362315060478990');" style=""> 537                 // If we find an IndexField entry for this field, then we need to store it in the index  </span>
<span class="-6138117391173223373" onmouseenter="enter('-6138117391173223373');" onmouseout="out('-6138117391173223373');" style=""> 538                 if (indexField != null) {                                                                </span>
<span class="-1605896855845279090" onmouseenter="enter('-1605896855845279090');" onmouseout="out('-1605896855845279090');" style=""> 539                     List&lt;IndexFieldType&gt; searchableFieldTypes = indexField.getFieldTypes();              </span>
<span  style=""> 540                                                                                                          </span>
<span class="7314822488779147745" onmouseenter="enter('7314822488779147745');" onmouseout="out('7314822488779147745');" style=""><abbr title=" 541                     // For each of its search field types, get the property values, and add a field to the document for each property value"> 541                     // For each of its search field types, get the property values, and add a field to thðŸ”µ</abbr></span>
<span class="9127582384821892356" onmouseenter="enter('9127582384821892356');" onmouseout="out('9127582384821892356');" style=""> 542                     for (IndexFieldType sft : searchableFieldTypes) {                                    </span>
<span class="-1855754965803101801" onmouseenter="enter('-1855754965803101801');" onmouseout="out('-1855754965803101801');" style=""> 543                         FieldType fieldType = sft.getFieldType();                                        </span>
<span class="1213494569726901077" onmouseenter="enter('1213494569726901077');" onmouseout="out('1213494569726901077');" style=""><abbr title=" 544                         Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getField(), fieldType, locales);"> 544                         Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getFðŸ”µ</abbr></span>
<span  style=""> 545                                                                                                          </span>
<span class="2731937647730128807" onmouseenter="enter('2731937647730128807');" onmouseout="out('2731937647730128807');" style=""><abbr title=" 546                         ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentForIndexField(document, indexField, fieldType, propertyValues);"> 546                         ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentFoðŸ”µ</abbr></span>
<span  style=""> 547                                                                                                          </span>
<span class="-2046283582941202064" onmouseenter="enter('-2046283582941202064');" onmouseout="out('-2046283582941202064');" style=""> 548                         if (ExtensionResultStatusType.NOT_HANDLED.equals(result)) {                      </span>
<span class="1818285189854508408" onmouseenter="enter('1818285189854508408');" onmouseout="out('1818285189854508408');" style=""> 549                             // Build out the field for every prefix                                      </span>
<span class="-7947315413202592125" onmouseenter="enter('-7947315413202592125');" onmouseout="out('-7947315413202592125');" style=""> 550                             for (Entry&lt;String, Object&gt; entry : propertyValues.entrySet()) {              </span>
<span class="-6275926878676507761" onmouseenter="enter('-6275926878676507761');" onmouseout="out('-6275926878676507761');" style=""> 551                                 String prefix = entry.getKey();                                          </span>
<span class="2218524055946596429" onmouseenter="enter('2218524055946596429');" onmouseout="out('2218524055946596429');" style=""> 552                                 prefix = StringUtils.isBlank(prefix) ? prefix : prefix + &quot;_&quot;;            </span>
<span  style=""> 553                                                                                                          </span>
<span class="-3898910784215480067" onmouseenter="enter('-3898910784215480067');" onmouseout="out('-3898910784215480067');" style=""><abbr title=" 554                                 String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fieldType, prefix);"> 554                                 String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fiðŸ”µ</abbr></span>
<span class="-4401151924846137205" onmouseenter="enter('-4401151924846137205');" onmouseout="out('-4401151924846137205');" style=""> 555                                 Object value = entry.getValue();                                         </span>
<span  style=""> 556                                                                                                          </span>
<span class="626346901079283965" onmouseenter="enter('626346901079283965');" onmouseout="out('626346901079283965');" style=""> 557                                 if (FieldType.isMultiValued(fieldType)) {                                </span>
<span class="-3165450242186121028" onmouseenter="enter('-3165450242186121028');" onmouseout="out('-3165450242186121028');" style=""> 558                                     document.addField(solrPropertyName, value);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 559                                 } else {                                                                 </span>
<span class="3313383578919119200" onmouseenter="enter('3313383578919119200');" onmouseout="out('3313383578919119200');" style=""> 560                                     document.setField(solrPropertyName, value);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565                 }                                                                                        </span>
<span  style=""> 566                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 567             } catch (Exception e) {                                                                      </span>
<span class="3922644492767384995" onmouseenter="enter('3922644492767384995');" onmouseout="out('3922644492767384995');" style=""><abbr title=" 568                 LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldName() + &quot;] for product id[&quot;"> 568                 LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldNaðŸ”µ</abbr></span>
<span class="6260448561791331284" onmouseenter="enter('6260448561791331284');" onmouseout="out('6260448561791331284');" style=""> 569                         + indexable.getId() + &quot;]&quot;, e);                                                   </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 570                 throw ExceptionHelper.refineException(e);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573     }                                                                                                    </span>
<span  style=""> 574                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 575     /**                                                                                                  </span>
<span class="4238183781809234032" onmouseenter="enter('4238183781809234032');" onmouseout="out('4238183781809234032');" style=""><abbr title=" 576      * Implementors can extend this and override this method to add additional fields to the Solr document."> 576      * Implementors can extend this and override this method to add additional fields to the Solr documenðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 577      *                                                                                                   </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 578      * @param sku                                                                                        </span>
<span class="-4531925645240977456" onmouseenter="enter('-4531925645240977456');" onmouseout="out('-4531925645240977456');" style=""> 579      * @param document                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 580      */                                                                                                  </span>
<span class="-8826176176899724303" onmouseenter="enter('-8826176176899724303');" onmouseout="out('-8826176176899724303');" style=""> 581     protected void attachAdditionalDocumentFields(Indexable indexable, SolrInputDocument document) {     </span>
<span class="2874503221562082086" onmouseenter="enter('2874503221562082086');" onmouseout="out('2874503221562082086');" style=""> 582         //Empty implementation. Placeholder for others to extend and add additional fields               </span>
<span class="6562860541481637604" onmouseenter="enter('6562860541481637604');" onmouseout="out('6562860541481637604');" style=""> 583         extensionManager.getProxy().attachAdditionalDocumentFields(indexable, document);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584     }                                                                                                    </span>
<span  style=""> 585                                                                                                          </span>
<span class="2269161038285740545" onmouseenter="enter('2269161038285740545');" onmouseout="out('2269161038285740545');" style=""> 586     protected void attachBasicDocumentFields(Indexable indexable, SolrInputDocument document) {          </span>
<span class="3677952974140195445" onmouseenter="enter('3677952974140195445');" onmouseout="out('3677952974140195445');" style=""> 587         CatalogStructure cache = SolrIndexCachedOperation.getCache();                                    </span>
<span class="3690595679967484902" onmouseenter="enter('3690595679967484902');" onmouseout="out('3690595679967484902');" style=""> 588         if (cache == null) {                                                                             </span>
<span class="-5953957341705739916" onmouseenter="enter('-5953957341705739916');" onmouseout="out('-5953957341705739916');" style=""> 589             String msg = &quot;SolrIndexService.performCachedOperation() must be used in conjuction with&quot;     </span>
<span class="5121342196990946089" onmouseenter="enter('5121342196990946089');" onmouseout="out('5121342196990946089');" style=""><abbr title=" 590                 + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog documents or should&quot;"> 590                 + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog doðŸ”µ</abbr></span>
<span class="5921421762371925976" onmouseenter="enter('5921421762371925976');" onmouseout="out('5921421762371925976');" style=""> 591                 + &quot; be invoked from buildIncrementalIndex()&quot;;                                            </span>
<span class="4339245929318812534" onmouseenter="enter('4339245929318812534');" onmouseout="out('4339245929318812534');" style=""> 592             LOG.error(msg);                                                                              </span>
<span class="86168282544735545" onmouseenter="enter('86168282544735545');" onmouseout="out('86168282544735545');" style=""> 593             throw new IllegalStateException(msg);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594         }                                                                                                </span>
<span  style=""> 595                                                                                                          </span>
<span class="-3140243218980457613" onmouseenter="enter('-3140243218980457613');" onmouseout="out('-3140243218980457613');" style=""> 596         // Add the namespace and ID fields for this product                                              </span>
<span class="-8136043564923018877" onmouseenter="enter('-8136043564923018877');" onmouseout="out('-8136043564923018877');" style=""> 597         document.addField(shs.getNamespaceFieldName(), solrConfiguration.getNamespace());                </span>
<span class="4638667037339624807" onmouseenter="enter('4638667037339624807');" onmouseout="out('4638667037339624807');" style=""> 598         document.addField(shs.getIdFieldName(), shs.getSolrDocumentId(document, indexable));             </span>
<span class="-1745274961796795631" onmouseenter="enter('-1745274961796795631');" onmouseout="out('-1745274961796795631');" style=""> 599         document.addField(shs.getTypeFieldName(), shs.getDocumentType(indexable));                       </span>
<span class="4848544160674821385" onmouseenter="enter('4848544160674821385');" onmouseout="out('4848544160674821385');" style=""> 600         document.addField(shs.getIndexableIdFieldName(), shs.getIndexableId(indexable));                 </span>
<span  style=""> 601                                                                                                          </span>
<span class="4524398296663961208" onmouseenter="enter('4524398296663961208');" onmouseout="out('4524398296663961208');" style=""> 602         extensionManager.getProxy().attachAdditionalBasicFields(indexable, document, shs);               </span>
<span  style=""> 603                                                                                                          </span>
<span class="8081444938024983637" onmouseenter="enter('8081444938024983637');" onmouseout="out('8081444938024983637');" style=""> 604         Long cacheKey = this.shs.getCurrentProductId(indexable); // current                              </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 605         if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                               </span>
<span class="1019588205807698651" onmouseenter="enter('1019588205807698651');" onmouseout="out('1019588205807698651');" style=""> 606             cacheKey = sandBoxHelper.getOriginalId(cacheKey); // parent                                  </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 607             if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                           </span>
<span class="-2582971950633728748" onmouseenter="enter('-2582971950633728748');" onmouseout="out('-2582971950633728748');" style=""> 608                 cacheKey = shs.getIndexableId(indexable); // master                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610         }                                                                                                </span>
<span  style=""> 611                                                                                                          </span>
<span class="-5777629244031949400" onmouseenter="enter('-5777629244031949400');" onmouseout="out('-5777629244031949400');" style=""> 612         // TODO: figure this out more generally; this doesn&#x27;t work for CMS content                       </span>
<span class="-6650188849299086912" onmouseenter="enter('-6650188849299086912');" onmouseout="out('-6650188849299086912');" style=""> 613         // The explicit categories are the ones defined by the product itself                            </span>
<span class="-9160995028433643624" onmouseenter="enter('-9160995028433643624');" onmouseout="out('-9160995028433643624');" style=""> 614         if (cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                </span>
<span class="4256320710674012617" onmouseenter="enter('4256320710674012617');" onmouseout="out('4256320710674012617');" style=""> 615             for (Long categoryId : cache.getParentCategoriesByProduct().get(cacheKey)) {                 </span>
<span class="8455722384905122433" onmouseenter="enter('8455722384905122433');" onmouseout="out('8455722384905122433');" style=""> 616                 document.addField(shs.getExplicitCategoryFieldName(), shs.getCategoryId(categoryId));    </span>
<span  style=""> 617                                                                                                          </span>
<span class="2226871268244895600" onmouseenter="enter('2226871268244895600');" onmouseout="out('2226871268244895600');" style=""> 618                 // Make sure that we&#x27;re always referencing the parent for the sort field                 </span>
<span class="885050313007205730" onmouseenter="enter('885050313007205730');" onmouseout="out('885050313007205730');" style=""><abbr title=" 619                 String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId));"> 619                 String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId)ðŸ”µ</abbr></span>
<span class="2056097617960887013" onmouseenter="enter('2056097617960887013');" onmouseout="out('2056097617960887013');" style=""><abbr title=" 620                 // The issue here was the super category id is always what is stored in the cache, while the category"> 620                 // The issue here was the super category id is always what is stored in the cache, while ðŸ”µ</abbr></span>
<span class="-892018914725665598" onmouseenter="enter('-892018914725665598');" onmouseout="out('-892018914725665598');" style=""><abbr title=" 621                 // by product id is the overridden versions. Need to always look at parent version for cache stuff, which"> 621                 // by product id is the overridden versions. Need to always look at parent version for caðŸ”µ</abbr></span>
<span class="-9167754401626692888" onmouseenter="enter('-9167754401626692888');" onmouseout="out('-9167754401626692888');" style=""> 622                 // is given from shs.getCategoryId                                                       </span>
<span class="-5291059882317809252" onmouseenter="enter('-5291059882317809252');" onmouseout="out('-5291059882317809252');" style=""> 623                 // First try the current level                                                           </span>
<span class="-431096296060400570" onmouseenter="enter('-431096296060400570');" onmouseout="out('-431096296060400570');" style=""> 624                 String displayOrderKey = categoryId + &quot;-&quot; + cacheKey;                                    </span>
<span class="-2136310867529994982" onmouseenter="enter('-2136310867529994982');" onmouseout="out('-2136310867529994982');" style=""> 625                 Long displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                   </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 626                 if (displayOrder == null) {                                                              </span>
<span class="-23846589771862516" onmouseenter="enter('-23846589771862516');" onmouseout="out('-23846589771862516');" style=""><abbr title=" 627                     // Didn&#x27;t find the cache at the current level, this might be an override so look upwards"> 627                     // Didn&#x27;t find the cache at the current level, this might be an override so look upwaðŸ”µ</abbr></span>
<span class="-2522276541728086971" onmouseenter="enter('-2522276541728086971');" onmouseout="out('-2522276541728086971');" style=""> 628                     displayOrderKey = shs.getCategoryId(categoryId) + &quot;-&quot; + cacheKey;                    </span>
<span class="-4225610511634364677" onmouseenter="enter('-4225610511634364677');" onmouseout="out('-4225610511634364677');" style=""> 629                     displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630                 }                                                                                        </span>
<span  style=""> 631                                                                                                          </span>
<span class="-1309608839151321080" onmouseenter="enter('-1309608839151321080');" onmouseout="out('-1309608839151321080');" style=""> 632                 if (document.getField(categorySortFieldName) == null &amp;&amp; displayOrder != null) {          </span>
<span class="-139575474281341237" onmouseenter="enter('-139575474281341237');" onmouseout="out('-139575474281341237');" style=""> 633                     document.addField(categorySortFieldName, displayOrder);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634                 }                                                                                        </span>
<span  style=""> 635                                                                                                          </span>
<span class="368279688641772108" onmouseenter="enter('368279688641772108');" onmouseout="out('368279688641772108');" style=""> 636                 // This is the entire tree of every category defined on the product                      </span>
<span class="7804252118891085182" onmouseenter="enter('7804252118891085182');" onmouseout="out('7804252118891085182');" style=""> 637                 buildFullCategoryHierarchy(document, cache, categoryId, new HashSet&lt;Long&gt;());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 638             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640     }                                                                                                    </span>
<span  style=""> 641                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 642     /**                                                                                                  </span>
<span class="6681629456063376998" onmouseenter="enter('6681629456063376998');" onmouseout="out('6681629456063376998');" style=""> 643      * Walk the category hierarchy upwards, adding a field for each level to the solr document           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 644      *                                                                                                   </span>
<span class="1689379025577151242" onmouseenter="enter('1689379025577151242');" onmouseout="out('1689379025577151242');" style=""> 645      * @param document the solr document for the product                                                 </span>
<span class="-7318706520602943649" onmouseenter="enter('-7318706520602943649');" onmouseout="out('-7318706520602943649');" style=""> 646      * @param cache the catalog structure cache                                                          </span>
<span class="-6836312806010046064" onmouseenter="enter('-6836312806010046064');" onmouseout="out('-6836312806010046064');" style=""> 647      * @param categoryId the current category id                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 648      */                                                                                                  </span>
<span class="2161311715252659768" onmouseenter="enter('2161311715252659768');" onmouseout="out('2161311715252659768');" style=""><abbr title=" 649     protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long categoryId, Set&lt;Long&gt; indexedParents) {"> 649     protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long caðŸ”µ</abbr></span>
<span class="3164345535572197299" onmouseenter="enter('3164345535572197299');" onmouseout="out('3164345535572197299');" style=""> 650         Long catIdToAdd = shs.getCategoryId(categoryId);                                                 </span>
<span  style=""> 651                                                                                                          </span>
<span class="-3890718915071250281" onmouseenter="enter('-3890718915071250281');" onmouseout="out('-3890718915071250281');" style=""> 652         Collection&lt;Object&gt; existingValues = document.getFieldValues(shs.getCategoryFieldName());         </span>
<span class="6039307398262207081" onmouseenter="enter('6039307398262207081');" onmouseout="out('6039307398262207081');" style=""> 653         if (existingValues == null || !existingValues.contains(catIdToAdd)) {                            </span>
<span class="527969679087238607" onmouseenter="enter('527969679087238607');" onmouseout="out('527969679087238607');" style=""> 654             document.addField(shs.getCategoryFieldName(), catIdToAdd);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655         }                                                                                                </span>
<span  style=""> 656                                                                                                          </span>
<span class="6863771221853966476" onmouseenter="enter('6863771221853966476');" onmouseout="out('6863771221853966476');" style=""> 657         Set&lt;Long&gt; parents = cache.getParentCategoriesByCategory().get(categoryId);                       </span>
<span class="-2911148901929748808" onmouseenter="enter('-2911148901929748808');" onmouseout="out('-2911148901929748808');" style=""> 658         for (Long parent : parents) {                                                                    </span>
<span class="-7460726028904993058" onmouseenter="enter('-7460726028904993058');" onmouseout="out('-7460726028904993058');" style=""> 659             if (!indexedParents.contains(parent)) {                                                      </span>
<span class="7294571508456102427" onmouseenter="enter('7294571508456102427');" onmouseout="out('7294571508456102427');" style=""> 660                 indexedParents.add(parent);                                                              </span>
<span class="-1881502435741878283" onmouseenter="enter('-1881502435741878283');" onmouseout="out('-1881502435741878283');" style=""> 661                 buildFullCategoryHierarchy(document, cache, parent, indexedParents);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664     }                                                                                                    </span>
<span  style=""> 665                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 666     /**                                                                                                  </span>
<span class="-4462927116106886000" onmouseenter="enter('-4462927116106886000');" onmouseout="out('-4462927116106886000');" style=""><abbr title=" 667      * Returns a map of prefix to value for the requested attributes. For example, if the requested field corresponds to"> 667      * Returns a map of prefix to value for the requested attributes. For example, if the requested fieldðŸ”µ</abbr></span>
<span class="-4378589169221473186" onmouseenter="enter('-4378589169221473186');" onmouseout="out('-4378589169221473186');" style=""><abbr title=" 668      * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting map could be"> 668      * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 669      *                                                                                                   </span>
<span class="4965494886678626130" onmouseenter="enter('4965494886678626130');" onmouseout="out('4965494886678626130');" style=""> 670      * { &quot;en_US&quot; : &quot;A description&quot;,                                                                      </span>
<span class="-259254215439445341" onmouseenter="enter('-259254215439445341');" onmouseout="out('-259254215439445341');" style=""> 671      *   &quot;es_ES&quot; : &quot;Una descripcion&quot; }                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 672      *                                                                                                   </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 673      * @param product                                                                                    </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 674      * @param sku                                                                                        </span>
<span class="-2810227465158556501" onmouseenter="enter('-2810227465158556501');" onmouseout="out('-2810227465158556501');" style=""> 675      * @param field                                                                                      </span>
<span class="8333989749186698144" onmouseenter="enter('8333989749186698144');" onmouseout="out('8333989749186698144');" style=""> 676      * @param fieldType                                                                                  </span>
<span class="4196076978965854681" onmouseenter="enter('4196076978965854681');" onmouseout="out('4196076978965854681');" style=""> 677      * @param locales                                                                                    </span>
<span class="8270246261244700409" onmouseenter="enter('8270246261244700409');" onmouseout="out('8270246261244700409');" style=""> 678      * @return the value of the property                                                                 </span>
<span class="8083004877096205463" onmouseenter="enter('8083004877096205463');" onmouseout="out('8083004877096205463');" style=""> 679      * @throws IllegalAccessException                                                                    </span>
<span class="-5812785901555574031" onmouseenter="enter('-5812785901555574031');" onmouseout="out('-5812785901555574031');" style=""> 680      * @throws InvocationTargetException                                                                 </span>
<span class="-7952440753472318794" onmouseenter="enter('-7952440753472318794');" onmouseout="out('-7952440753472318794');" style=""> 681      * @throws NoSuchMethodException                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 682      */                                                                                                  </span>
<span class="8748893838745138853" onmouseenter="enter('8748893838745138853');" onmouseout="out('8748893838745138853');" style=""><abbr title=" 683     protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldType, List&lt;Locale&gt; locales)"> 683     protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldTyðŸ”µ</abbr></span>
<span class="1769827535532852924" onmouseenter="enter('1769827535532852924');" onmouseout="out('1769827535532852924');" style=""> 684             throws IllegalAccessException, InvocationTargetException, NoSuchMethodException {            </span>
<span  style=""> 685                                                                                                          </span>
<span class="6107905045905939603" onmouseenter="enter('6107905045905939603');" onmouseout="out('6107905045905939603');" style=""> 686         String propertyName = field.getPropertyName();                                                   </span>
<span class="-4589490168925589742" onmouseenter="enter('-4589490168925589742');" onmouseout="out('-4589490168925589742');" style=""> 687         Map&lt;String, Object&gt; values = new HashMap&lt;&gt;();                                                    </span>
<span  style=""> 688                                                                                                          </span>
<span class="6659346108356717008" onmouseenter="enter('6659346108356717008');" onmouseout="out('6659346108356717008');" style=""> 689         ExtensionResultStatusType extensionResult = ExtensionResultStatusType.NOT_HANDLED;               </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 690         if (extensionManager != null) {                                                                  </span>
<span class="-9204729919056407683" onmouseenter="enter('-9204729919056407683');" onmouseout="out('-9204729919056407683');" style=""><abbr title=" 691             extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldType, values, propertyName, locales);"> 691             extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldTypeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692         }                                                                                                </span>
<span  style=""> 693                                                                                                          </span>
<span class="978300925065413292" onmouseenter="enter('978300925065413292');" onmouseout="out('978300925065413292');" style=""> 694         if (ExtensionResultStatusType.NOT_HANDLED.equals(extensionResult)) {                             </span>
<span class="-4780873355376927780" onmouseenter="enter('-4780873355376927780');" onmouseout="out('-4780873355376927780');" style=""> 695             Object propertyValue = shs.getPropertyValue(indexedItem, field);                             </span>
<span class="-3197092395980898064" onmouseenter="enter('-3197092395980898064');" onmouseout="out('-3197092395980898064');" style=""> 696             if (propertyValue != null) {                                                                 </span>
<span class="2260924254129751704" onmouseenter="enter('2260924254129751704');" onmouseout="out('2260924254129751704');" style=""> 697                 values.put(&quot;&quot;, propertyValue);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699         }                                                                                                </span>
<span  style=""> 700                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 701         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702     }                                                                                                    </span>
<span  style=""> 703                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 704     /**                                                                                                  </span>
<span class="9061850100512653526" onmouseenter="enter('9061850100512653526');" onmouseout="out('9061850100512653526');" style=""><abbr title=" 705      * Converts a propertyName to one that is able to reference inside a map. For example, consider the property"> 705      * Converts a propertyName to one that is able to reference inside a map. For example, consider the pðŸ”µ</abbr></span>
<span class="-895456647484563444" onmouseenter="enter('-895456647484563444');" onmouseout="out('-895456647484563444');" style=""><abbr title=" 706      * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utility method"> 706      * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utilitðŸ”µ</abbr></span>
<span class="-552833576006343516" onmouseenter="enter('-552833576006343516');" onmouseout="out('-552833576006343516');" style=""><abbr title=" 707      * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed by the name"> 707      * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed byðŸ”µ</abbr></span>
<span class="825713137907557548" onmouseenter="enter('825713137907557548');" onmouseout="out('825713137907557548');" style=""><abbr title=" 708      * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttributes&quot;,"> 708      * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttrðŸ”µ</abbr></span>
<span class="-5368406654183806848" onmouseenter="enter('-5368406654183806848');" onmouseout="out('-5368406654183806848');" style=""><abbr title=" 709      * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; that"> 709      * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; tðŸ”µ</abbr></span>
<span class="2947641499517828088" onmouseenter="enter('2947641499517828088');" onmouseout="out('2947641499517828088');" style=""><abbr title=" 710      * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatRange&quot;,"> 710      * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatðŸ”µ</abbr></span>
<span class="-7978269712217451802" onmouseenter="enter('-7978269712217451802');" onmouseout="out('-7978269712217451802');" style=""><abbr title=" 711      * this method will convert this property to mappedProductAttributes(heatRange).value, which is then usable"> 711      * this method will convert this property to mappedProductAttributes(heatRange).value, which is then ðŸ”µ</abbr></span>
<span class="2645537127888120036" onmouseenter="enter('2645537127888120036');" onmouseout="out('2645537127888120036');" style=""> 712      * by the standard beanutils PropertyUtils class to get the value.                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 713      *                                                                                                   </span>
<span class="-7192310373251332281" onmouseenter="enter('-7192310373251332281');" onmouseout="out('-7192310373251332281');" style=""> 714      * @param propertyName                                                                               </span>
<span class="4673892841275975431" onmouseenter="enter('4673892841275975431');" onmouseout="out('4673892841275975431');" style=""> 715      * @param listPropertyName                                                                           </span>
<span class="-3179260629250258297" onmouseenter="enter('-3179260629250258297');" onmouseout="out('-3179260629250258297');" style=""> 716      * @param mapPropertyName                                                                            </span>
<span class="3476440775818037910" onmouseenter="enter('3476440775818037910');" onmouseout="out('3476440775818037910');" style=""> 717      * @return the converted property name                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 718      *                                                                                                   </span>
<span class="52899359164217029" onmouseenter="enter('52899359164217029');" onmouseout="out('52899359164217029');" style=""> 719      * @deprecated see SolrHelperService.getPropertyValue()                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 720      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 721     @Deprecated                                                                                          </span>
<span class="-8166943252759778933" onmouseenter="enter('-8166943252759778933');" onmouseout="out('-8166943252759778933');" style=""><abbr title=" 722     protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropertyName) {"> 722     protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropðŸ”µ</abbr></span>
<span class="1454213590133189928" onmouseenter="enter('1454213590133189928');" onmouseout="out('1454213590133189928');" style=""> 723         String[] splitName = StringUtils.split(propertyName, &quot;\\.&quot;);                                     </span>
<span class="8763032247946290041" onmouseenter="enter('8763032247946290041');" onmouseout="out('8763032247946290041');" style=""> 724         StringBuilder convertedProperty = new StringBuilder();                                           </span>
<span class="6897833212568273038" onmouseenter="enter('6897833212568273038');" onmouseout="out('6897833212568273038');" style=""> 725         for (int i = 0; i &lt; splitName.length; i++) {                                                     </span>
<span class="7476336611017662047" onmouseenter="enter('7476336611017662047');" onmouseout="out('7476336611017662047');" style=""> 726             if (convertedProperty.length() &gt; 0) {                                                        </span>
<span class="3942759274962034898" onmouseenter="enter('3942759274962034898');" onmouseout="out('3942759274962034898');" style=""> 727                 convertedProperty.append(&quot;.&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728             }                                                                                            </span>
<span  style=""> 729                                                                                                          </span>
<span class="-5101250235350090861" onmouseenter="enter('-5101250235350090861');" onmouseout="out('-5101250235350090861');" style=""> 730             if (splitName[i].equals(listPropertyName)) {                                                 </span>
<span class="5747881404112979701" onmouseenter="enter('5747881404112979701');" onmouseout="out('5747881404112979701');" style=""> 731                 convertedProperty.append(mapPropertyName).append(&quot;(&quot;);                                   </span>
<span class="-4744112788117022497" onmouseenter="enter('-4744112788117022497');" onmouseout="out('-4744112788117022497');" style=""> 732                 convertedProperty.append(splitName[i + 1]).append(&quot;).value&quot;);                            </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 733                 i++;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 734             } else {                                                                                     </span>
<span class="-2902127022925554102" onmouseenter="enter('-2902127022925554102');" onmouseout="out('-2902127022925554102');" style=""> 735                 convertedProperty.append(splitName[i]);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737         }                                                                                                </span>
<span class="5092332446699272394" onmouseenter="enter('5092332446699272394');" onmouseout="out('5092332446699272394');" style=""> 738         return convertedProperty.toString();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739     }                                                                                                    </span>
<span  style=""> 740                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 741     @Override                                                                                            </span>
<span class="-3936693135713622895" onmouseenter="enter('-3936693135713622895');" onmouseout="out('-3936693135713622895');" style=""> 742     public Object[] saveState() {                                                                        </span>
<span class="6340072029414808943" onmouseenter="enter('6340072029414808943');" onmouseout="out('6340072029414808943');" style=""> 743          return new Object[] {                                                                           </span>
<span class="-1198820822862086393" onmouseenter="enter('-1198820822862086393');" onmouseout="out('-1198820822862086393');" style=""> 744              BroadleafRequestContext.getBroadleafRequestContext(),                                       </span>
<span class="4468406610576348115" onmouseenter="enter('4468406610576348115');" onmouseout="out('4468406610576348115');" style=""> 745              SkuPricingConsiderationContext.getSkuPricingConsiderationContext(),                         </span>
<span class="-4551736393079008426" onmouseenter="enter('-4551736393079008426');" onmouseout="out('-4551736393079008426');" style=""> 746              SkuPricingConsiderationContext.getSkuPricingService(),                                      </span>
<span class="3011904497645750283" onmouseenter="enter('3011904497645750283');" onmouseout="out('3011904497645750283');" style=""> 747              SkuActiveDateConsiderationContext.getSkuActiveDatesService()                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 748          };                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749      }                                                                                                   </span>
<span  style=""> 750                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 751     @Override                                                                                            </span>
<span class="-1725049255621638202" onmouseenter="enter('-1725049255621638202');" onmouseout="out('-1725049255621638202');" style=""> 752     @SuppressWarnings(&quot;rawtypes&quot;)                                                                        </span>
<span class="-799181704487695614" onmouseenter="enter('-799181704487695614');" onmouseout="out('-799181704487695614');" style=""> 753     public void restoreState(Object[] pack) {                                                            </span>
<span class="5773741038987480013" onmouseenter="enter('5773741038987480013');" onmouseout="out('5773741038987480013');" style=""> 754          BroadleafRequestContext.setBroadleafRequestContext((BroadleafRequestContext) pack[0]);          </span>
<span class="-7019853679694091506" onmouseenter="enter('-7019853679694091506');" onmouseout="out('-7019853679694091506');" style=""> 755          SkuPricingConsiderationContext.setSkuPricingConsiderationContext((HashMap) pack[1]);            </span>
<span class="4085014913476561326" onmouseenter="enter('4085014913476561326');" onmouseout="out('4085014913476561326');" style=""> 756          SkuPricingConsiderationContext.setSkuPricingService((DynamicSkuPricingService) pack[2]);        </span>
<span class="-8007069714826871365" onmouseenter="enter('-8007069714826871365');" onmouseout="out('-8007069714826871365');" style=""><abbr title=" 757          SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3]);"> 757          SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758      }                                                                                                   </span>
<span  style=""> 759                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 760     @Override                                                                                            </span>
<span class="-9091641891346182972" onmouseenter="enter('-9091641891346182972');" onmouseout="out('-9091641891346182972');" style=""><abbr title=" 761     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException {"> 761     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException ðŸ”µ</abbr></span>
<span class="-2539995639166621773" onmouseenter="enter('-2539995639166621773');" onmouseout="out('-2539995639166621773');" style=""> 762         shs.optimizeIndex(collection, server);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763     }                                                                                                    </span>
<span  style=""> 764                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 765     @Override                                                                                            </span>
<span class="7341867013968379883" onmouseenter="enter('7341867013968379883');" onmouseout="out('7341867013968379883');" style=""> 766     public void commit(String collection, SolrClient server) throws ServiceException, IOException {      </span>
<span class="7675894021553797865" onmouseenter="enter('7675894021553797865');" onmouseout="out('7675894021553797865');" style=""> 767         if (this.commit) {                                                                               </span>
<span class="-6090512425803845008" onmouseenter="enter('-6090512425803845008');" onmouseout="out('-6090512425803845008');" style=""> 768             commit(collection, server, this.softCommit, this.waitSearcher, this.waitFlush);              </span>
<span class="6963313292914152592" onmouseenter="enter('6963313292914152592');" onmouseout="out('6963313292914152592');" style=""> 769         } else if (LOG.isDebugEnabled()) {                                                               </span>
<span class="1765076834887086466" onmouseenter="enter('1765076834887086466');" onmouseout="out('1765076834887086466');" style=""><abbr title=" 770             LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoCommit is configured.&quot;);"> 770             LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoComðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772     }                                                                                                    </span>
<span  style=""> 773                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 774     @Override                                                                                            </span>
<span class="-5625380272333943282" onmouseenter="enter('-5625380272333943282');" onmouseout="out('-5625380272333943282');" style=""><abbr title=" 775     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 775     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 776         try {                                                                                            </span>
<span class="897708696444656733" onmouseenter="enter('897708696444656733');" onmouseout="out('897708696444656733');" style=""> 777             if (!this.commit) {                                                                          </span>
<span class="9109442794169141002" onmouseenter="enter('9109442794169141002');" onmouseout="out('9109442794169141002');" style=""><abbr title=" 778                 LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is being forced via the API.&quot;);"> 778                 LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is beingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779             }                                                                                            </span>
<span  style=""> 780                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 781             if (LOG.isDebugEnabled()) {                                                                  </span>
<span class="-8336995023402134302" onmouseenter="enter('-8336995023402134302');" onmouseout="out('-8336995023402134302');" style=""> 782                 LOG.debug(&quot;Committing changes to Solr index: softCommit: &quot; + softCommit                  </span>
<span class="8772898042441368535" onmouseenter="enter('8772898042441368535');" onmouseout="out('8772898042441368535');" style=""> 783                         + &quot;, waitSearcher: &quot; + waitSearcher + &quot;, waitFlush: &quot; + waitFlush);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784             }                                                                                            </span>
<span  style=""> 785                                                                                                          </span>
<span class="-4946339855213882534" onmouseenter="enter('-4946339855213882534');" onmouseout="out('-4946339855213882534');" style=""> 786             server.commit(collection, waitFlush, waitSearcher, softCommit);                              </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 787         } catch (SolrServerException e) {                                                                </span>
<span class="6480332907391821448" onmouseenter="enter('6480332907391821448');" onmouseout="out('6480332907391821448');" style=""> 788             throw new ServiceException(&quot;Could not commit changes to Solr index&quot;, e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 789         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790     }                                                                                                    </span>
<span  style=""> 791                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 792     @Override                                                                                            </span>
<span class="3365555763697732929" onmouseenter="enter('3365555763697732929');" onmouseout="out('3365555763697732929');" style=""> 793     public void optimizeIndex(SolrClient server) throws ServiceException, IOException {                  </span>
<span class="-604246973254031119" onmouseenter="enter('-604246973254031119');" onmouseout="out('-604246973254031119');" style=""> 794         optimizeIndex(null, server);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 795     }                                                                                                    </span>
<span  style=""> 796                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 797     @Override                                                                                            </span>
<span class="8022176589656897042" onmouseenter="enter('8022176589656897042');" onmouseout="out('8022176589656897042');" style=""> 798     public void commit(SolrClient server) throws ServiceException, IOException {                         </span>
<span class="8538330963534152673" onmouseenter="enter('8538330963534152673');" onmouseout="out('8538330963534152673');" style=""> 799         commit(null, server);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800     }                                                                                                    </span>
<span  style=""> 801                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 802     @Override                                                                                            </span>
<span class="4402093086393350326" onmouseenter="enter('4402093086393350326');" onmouseout="out('4402093086393350326');" style=""><abbr title=" 803     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 803     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) thðŸ”µ</abbr></span>
<span class="-6149532067307109215" onmouseenter="enter('-6149532067307109215');" onmouseout="out('-6149532067307109215');" style=""> 804         commit(null, server, softCommit, waitSearcher, waitFlush);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805     }                                                                                                    </span>
<span  style=""> 806                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 807     @Override                                                                                            </span>
<span class="-235343663931086975" onmouseenter="enter('-235343663931086975');" onmouseout="out('-235343663931086975');" style=""> 808     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents) {                                  </span>
<span class="1446253227197554536" onmouseenter="enter('1446253227197554536');" onmouseout="out('1446253227197554536');" style=""> 809         if (LOG.isTraceEnabled()) {                                                                      </span>
<span class="-4118597588854644187" onmouseenter="enter('-4118597588854644187');" onmouseout="out('-4118597588854644187');" style=""> 810             for (SolrInputDocument document : documents) {                                               </span>
<span class="3338392633918275305" onmouseenter="enter('3338392633918275305');" onmouseout="out('3338392633918275305');" style=""> 811                 LOG.trace(document);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814     }                                                                                                    </span>
<span  style=""> 815                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 816     /**                                                                                                  </span>
<span class="-4161606046612334483" onmouseenter="enter('-4161606046612334483');" onmouseout="out('-4161606046612334483');" style=""> 817      *  We multiply the BigDecimal by 1,000,000 to maintain any possible decimals in use the             </span>
<span class="1095534727201270293" onmouseenter="enter('1095534727201270293');" onmouseout="out('1095534727201270293');" style=""> 818      *  displayOrder value.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 819      *                                                                                                   </span>
<span class="1237233419561726312" onmouseenter="enter('1237233419561726312');" onmouseout="out('1237233419561726312');" style=""> 820      * @param cache                                                                                      </span>
<span class="-4411905951100486196" onmouseenter="enter('-4411905951100486196');" onmouseout="out('-4411905951100486196');" style=""> 821      * @param displayOrderKey                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 822      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 823      */                                                                                                  </span>
<span class="1635922478501180747" onmouseenter="enter('1635922478501180747');" onmouseout="out('1635922478501180747');" style=""> 824     protected Long convertDisplayOrderToLong(CatalogStructure cache, String displayOrderKey) {           </span>
<span class="4518367233651177280" onmouseenter="enter('4518367233651177280');" onmouseout="out('4518367233651177280');" style=""> 825         BigDecimal displayOrder = cache.getDisplayOrdersByCategoryProduct().get(displayOrderKey);        </span>
<span  style=""> 826                                                                                                          </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 827         if (displayOrder == null) {                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 828             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829         }                                                                                                </span>
<span  style=""> 830                                                                                                          </span>
<span class="4133773492119237930" onmouseenter="enter('4133773492119237930');" onmouseout="out('4133773492119237930');" style=""> 831         return displayOrder.multiply(BigDecimal.valueOf(1000000)).longValue();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832     }                                                                                                    </span>
<span  style=""> 833                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 834     @Override                                                                                            </span>
<span class="4004348612697349075" onmouseenter="enter('4004348612697349075');" onmouseout="out('4004348612697349075');" style=""> 835     public void deleteByQuery(String deleteQuery) throws SolrServerException, IOException {              </span>
<span class="1027311076504650094" onmouseenter="enter('1027311076504650094');" onmouseout="out('1027311076504650094');" style=""> 836         String productFilter = shs.getTypeFieldName() + &quot;:&quot; + shs.getPrimaryDocumentType();              </span>
<span  style=""> 837                                                                                                          </span>
<span class="1739252735366935461" onmouseenter="enter('1739252735366935461');" onmouseout="out('1739252735366935461');" style=""><abbr title=" 838         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t delete non-product documents accidentally"> 838         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we doðŸ”µ</abbr></span>
<span class="8967770841500493181" onmouseenter="enter('8967770841500493181');" onmouseout="out('8967770841500493181');" style=""> 839         deleteQuery = productFilter + &quot; AND (&quot; + deleteQuery + &quot;)&quot;;                                      </span>
<span  style=""> 840                                                                                                          </span>
<span class="35790388838229419" onmouseenter="enter('35790388838229419');" onmouseout="out('35790388838229419');" style=""> 841         String childDeleteQuery = &quot;{!child of=&quot; + productFilter + &quot;} &quot; + deleteQuery;                    </span>
<span class="-5958139659148111368" onmouseenter="enter('-5958139659148111368');" onmouseout="out('-5958139659148111368');" style=""><abbr title=" 842         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), childDeleteQuery);"> 842         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), childDeleðŸ”µ</abbr></span>
<span class="870065906158081107" onmouseenter="enter('870065906158081107');" onmouseout="out('870065906158081107');" style=""><abbr title=" 843         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), deleteQuery);"> 843         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), deleteQueðŸ”µ</abbr></span>
<span  style=""> 844                                                                                                          </span>
<span class="2572292351348869388" onmouseenter="enter('2572292351348869388');" onmouseout="out('2572292351348869388');" style=""> 845         logDeleteQuery(childDeleteQuery);                                                                </span>
<span class="-7276176933862949274" onmouseenter="enter('-7276176933862949274');" onmouseout="out('-7276176933862949274');" style=""> 846         logDeleteQuery(deleteQuery);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847     }                                                                                                    </span>
<span  style=""> 848                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 849     @Override                                                                                            </span>
<span class="-7948321486753422000" onmouseenter="enter('-7948321486753422000');" onmouseout="out('-7948321486753422000');" style=""><abbr title=" 850     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException {"> 850     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerExcepðŸ”µ</abbr></span>
<span class="-1557641774356947070" onmouseenter="enter('-1557641774356947070');" onmouseout="out('-1557641774356947070');" style=""> 851         solrConfiguration.getServer().add(solrConfiguration.getQueryCollectionName(), documents);        </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 852         logDocuments(documents);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853     }                                                                                                    </span>
<span  style=""> 854                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 855     @Override                                                                                            </span>
<span class="5429697153738572572" onmouseenter="enter('5429697153738572572');" onmouseout="out('5429697153738572572');" style=""> 856     public void logDeleteQuery(String deleteQuery) {                                                     </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 857         if (LOG.isDebugEnabled()) {                                                                      </span>
<span class="1652863876971966554" onmouseenter="enter('1652863876971966554');" onmouseout="out('1652863876971966554');" style=""> 858             LOG.debug(&quot;Delete query: &quot; + deleteQuery);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 860     }                                                                                                    </span>
<span  style=""> 861                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 862     @Override                                                                                            </span>
<span class="-7107052052553344125" onmouseenter="enter('-7107052052553344125');" onmouseout="out('-7107052052553344125');" style=""> 863     public boolean useLegacyIndexer() {                                                                  </span>
<span class="-518627155049265606" onmouseenter="enter('-518627155049265606');" onmouseout="out('-518627155049265606');" style=""> 864         return useLegacySolrIndexer;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 865     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866 }                                                                                                        </span>












































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="1122494097902733579" onmouseenter="enter('1122494097902733579');" onmouseout="out('1122494097902733579');" style="">  18 package org.broadleafcommerce.core.search.service.solr.index;                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  20 import java.io.IOException;                                                                              </span>
<span class="5727252987923913" onmouseenter="enter('5727252987923913');" onmouseout="out('5727252987923913');" style="">  21 import java.lang.reflect.InvocationTargetException;                                                      </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  22 import java.math.BigDecimal;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  23 import java.util.ArrayList;                                                                              </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  24 import java.util.Collection;                                                                             </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  25 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  26 import java.util.HashSet;                                                                                </span>
<span class="5562422284534979298" onmouseenter="enter('5562422284534979298');" onmouseout="out('5562422284534979298');" style="">  27 import java.util.LinkedHashMap;                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  28 import java.util.List;                                                                                   </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  29 import java.util.Map.Entry;                                                                              </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  30 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  31 import java.util.Set;                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  32 import javax.annotation.Resource;                                                                        </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  33 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="7358117227230759843" onmouseenter="enter('7358117227230759843');" onmouseout="out('7358117227230759843');" style="">  34 import org.apache.commons.lang3.ObjectUtils;                                                             </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  35 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  36 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  37 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5774725166806839225" onmouseenter="enter('5774725166806839225');" onmouseout="out('5774725166806839225');" style="">  38 import org.apache.solr.client.solrj.SolrClient;                                                          </span>
<span class="2534520300286315365" onmouseenter="enter('2534520300286315365');" onmouseout="out('2534520300286315365');" style="">  39 import org.apache.solr.client.solrj.SolrServerException;                                                 </span>
<span class="3039478051879307902" onmouseenter="enter('3039478051879307902');" onmouseout="out('3039478051879307902');" style="">  40 import org.apache.solr.common.SolrInputDocument;                                                         </span>
<span class="-5062615271713994505" onmouseenter="enter('-5062615271713994505');" onmouseout="out('-5062615271713994505');" style="">  41 import org.apache.solr.common.SolrInputField;                                                            </span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  42 import org.broadleafcommerce.common.exception.ExceptionHelper;                                           </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  43 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  44 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  45 import org.broadleafcommerce.common.locale.domain.Locale;                                                </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  46 import org.broadleafcommerce.common.locale.service.LocaleService;                                        </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  47 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-4286566313930798693" onmouseenter="enter('-4286566313930798693');" onmouseout="out('-4286566313930798693');" style="">  48 import org.broadleafcommerce.common.site.domain.Catalog;                                                 </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  49 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-8450438836187654019" onmouseenter="enter('-8450438836187654019');" onmouseout="out('-8450438836187654019');" style="">  50 import org.broadleafcommerce.common.util.StopWatch;                                                      </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  51 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  52 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  53 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  54 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="-4682247906377627479" onmouseenter="enter('-4682247906377627479');" onmouseout="out('-4682247906377627479');" style="">  55 import org.broadleafcommerce.core.catalog.dao.ProductDao;                                                </span>
<span class="819600147337546609" onmouseenter="enter('819600147337546609');" onmouseout="out('819600147337546609');" style="">  56 import org.broadleafcommerce.core.catalog.domain.Indexable;                                              </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  57 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-8898703314888663548" onmouseenter="enter('-8898703314888663548');" onmouseout="out('-8898703314888663548');" style="">  58 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuActiveDatesService;                  </span>
<span class="4379279529485441894" onmouseenter="enter('4379279529485441894');" onmouseout="out('4379279529485441894');" style="">  59 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuPricingService;                      </span>
<span class="-3681422864492833385" onmouseenter="enter('-3681422864492833385');" onmouseout="out('-3681422864492833385');" style="">  60 import org.broadleafcommerce.core.catalog.service.dynamic.SkuActiveDateConsiderationContext;             </span>
<span class="-829094426310214064" onmouseenter="enter('-829094426310214064');" onmouseout="out('-829094426310214064');" style="">  61 import org.broadleafcommerce.core.catalog.service.dynamic.SkuPricingConsiderationContext;                </span>
<span class="-1576266836408736884" onmouseenter="enter('-1576266836408736884');" onmouseout="out('-1576266836408736884');" style="">  62 import org.broadleafcommerce.core.search.dao.CatalogStructure;                                           </span>
<span class="3400766289256993125" onmouseenter="enter('3400766289256993125');" onmouseout="out('3400766289256993125');" style="">  63 import org.broadleafcommerce.core.search.dao.FieldDao;                                                   </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  64 import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                              </span>
<span class="920426074093689209" onmouseenter="enter('920426074093689209');" onmouseout="out('920426074093689209');" style="">  65 import org.broadleafcommerce.core.search.dao.SearchFacetDao;                                             </span>
<span class="-5322157128750858217" onmouseenter="enter('-5322157128750858217');" onmouseout="out('-5322157128750858217');" style="">  66 import org.broadleafcommerce.core.search.dao.SolrIndexDao;                                               </span>
<span class="4766648382130970293" onmouseenter="enter('4766648382130970293');" onmouseout="out('4766648382130970293');" style="">  67 import org.broadleafcommerce.core.search.domain.Field;                                                   </span>
<span class="-5357326536069928479" onmouseenter="enter('-5357326536069928479');" onmouseout="out('-5357326536069928479');" style="">  68 import org.broadleafcommerce.core.search.domain.FieldEntity;                                             </span>
<span class="6698299629643684636" onmouseenter="enter('6698299629643684636');" onmouseout="out('6698299629643684636');" style="">  69 import org.broadleafcommerce.core.search.domain.IndexField;                                              </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  70 import org.broadleafcommerce.core.search.domain.IndexFieldType;                                          </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  71 import org.broadleafcommerce.core.search.domain.solr.FieldType;                                          </span>
<span class="5698008419148469327" onmouseenter="enter('5698008419148469327');" onmouseout="out('5698008419148469327');" style="">  72 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;                                 </span>
<span class="1831820877510608733" onmouseenter="enter('1831820877510608733');" onmouseout="out('1831820877510608733');" style="">  73 import org.broadleafcommerce.core.search.service.solr.SolrHelperService;                                 </span>
<span class="-138378224551372777" onmouseenter="enter('-138378224551372777');" onmouseout="out('-138378224551372777');" style="">  74 import org.springframework.beans.factory.InitializingBean;                                               </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  75 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  76 import org.springframework.beans.factory.annotation.Qualifier;                                           </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  77 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  78 import org.springframework.stereotype.Service;                                                           </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  79 import org.springframework.transaction.PlatformTransactionManager;                                       </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  80 import org.springframework.transaction.TransactionDefinition;                                            </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  81 import org.springframework.transaction.TransactionStatus;                                                </span>
<span  style="">  82                                                                                                          </span>
<span  style="">  83                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  84 /**                                                                                                      </span>
<span class="2637600201222846009" onmouseenter="enter('2637600201222846009');" onmouseout="out('2637600201222846009');" style="">  85  * Responsible for building and rebuilding the Solr index                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  86  *                                                                                                       </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  87  * @author Andre Azzolini (apazzolini)                                                                   </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  88  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  89  */                                                                                                      </span>
<span class="5147427781650963861" onmouseenter="enter('5147427781650963861');" onmouseout="out('5147427781650963861');" style="">  90 @Service(&quot;blSolrIndexService&quot;)                                                                           </span>
<span class="1970422993362857351" onmouseenter="enter('1970422993362857351');" onmouseout="out('1970422993362857351');" style="">  91 public class SolrIndexServiceImpl implements SolrIndexService , InitializingBean {                       </span>
<span class="2912831792317267849" onmouseenter="enter('2912831792317267849');" onmouseout="out('2912831792317267849');" style="">  92     private static final Log LOG = LogFactory.getLog(SolrIndexServiceImpl.class);                        </span>
<span  style="">  93                                                                                                          </span>
<span class="-8977974913293567232" onmouseenter="enter('-8977974913293567232');" onmouseout="out('-8977974913293567232');" style="">  94     @Qualifier(&quot;blCatalogSolrConfiguration&quot;)                                                             </span>
<span class="2602789178515286342" onmouseenter="enter('2602789178515286342');" onmouseout="out('2602789178515286342');" style="">  95     @Autowired(required = false)                                                                         </span>
<span class="-8579597795724805463" onmouseenter="enter('-8579597795724805463');" onmouseout="out('-8579597795724805463');" style="">  96     protected SolrConfiguration solrConfiguration;                                                       </span>
<span  style="">  97                                                                                                          </span>
<span class="2195771720820037705" onmouseenter="enter('2195771720820037705');" onmouseout="out('2195771720820037705');" style="">  98     @Value(&quot;${solr.index.errorOnConcurrentReIndex}&quot;)                                                     </span>
<span class="-1712197847076792635" onmouseenter="enter('-1712197847076792635');" onmouseout="out('-1712197847076792635');" style="">  99     protected boolean errorOnConcurrentReIndex = false;                                                  </span>
<span  style=""> 100                                                                                                          </span>
<span class="7048903042822364298" onmouseenter="enter('7048903042822364298');" onmouseout="out('7048903042822364298');" style=""> 101     @Value(&quot;${solr.index.product.pageSize}&quot;)                                                             </span>
<span class="-4484811886017880292" onmouseenter="enter('-4484811886017880292');" onmouseout="out('-4484811886017880292');" style=""> 102     protected int pageSize;                                                                              </span>
<span  style=""> 103                                                                                                          </span>
<span class="8105652327274456362" onmouseenter="enter('8105652327274456362');" onmouseout="out('8105652327274456362');" style=""> 104     @Value(&quot;${solr.index.commit}&quot;)                                                                       </span>
<span class="2310160779081566815" onmouseenter="enter('2310160779081566815');" onmouseout="out('2310160779081566815');" style=""> 105     protected boolean commit;                                                                            </span>
<span  style=""> 106                                                                                                          </span>
<span class="4958585362396000858" onmouseenter="enter('4958585362396000858');" onmouseout="out('4958585362396000858');" style=""> 107     @Value(&quot;${solr.index.softCommit}&quot;)                                                                   </span>
<span class="-7523707349512810888" onmouseenter="enter('-7523707349512810888');" onmouseout="out('-7523707349512810888');" style=""> 108     protected boolean softCommit;                                                                        </span>
<span  style=""> 109                                                                                                          </span>
<span class="2752166020843058826" onmouseenter="enter('2752166020843058826');" onmouseout="out('2752166020843058826');" style=""> 110     @Value(&quot;${solr.index.waitSearcher}&quot;)                                                                 </span>
<span class="-7977681737585438995" onmouseenter="enter('-7977681737585438995');" onmouseout="out('-7977681737585438995');" style=""> 111     protected boolean waitSearcher;                                                                      </span>
<span  style=""> 112                                                                                                          </span>
<span class="-1787870543439636120" onmouseenter="enter('-1787870543439636120');" onmouseout="out('-1787870543439636120');" style=""> 113     @Value(&quot;${solr.index.waitFlush}&quot;)                                                                    </span>
<span class="-1071744707232356027" onmouseenter="enter('-1071744707232356027');" onmouseout="out('-1071744707232356027');" style=""> 114     protected boolean waitFlush;                                                                         </span>
<span  style=""> 115                                                                                                          </span>
<span class="-504996646074126996" onmouseenter="enter('-504996646074126996');" onmouseout="out('-504996646074126996');" style=""> 116     @Value(value = &quot;${solr.catalog.useLegacySolrIndexer:true}&quot;)                                          </span>
<span class="598047637926589746" onmouseenter="enter('598047637926589746');" onmouseout="out('598047637926589746');" style=""> 117     protected boolean useLegacySolrIndexer = true;                                                       </span>
<span  style=""> 118                                                                                                          </span>
<span class="-8581768554675866702" onmouseenter="enter('-8581768554675866702');" onmouseout="out('-8581768554675866702');" style=""> 119     @Resource(name = &quot;blProductDao&quot;)                                                                     </span>
<span class="8458703512033747413" onmouseenter="enter('8458703512033747413');" onmouseout="out('8458703512033747413');" style=""> 120     protected ProductDao productDao;                                                                     </span>
<span  style=""> 121                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style=""> 122     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 123     protected CatalogService catalogService;                                                             </span>
<span  style=""> 124                                                                                                          </span>
<span class="8745422771459947563" onmouseenter="enter('8745422771459947563');" onmouseout="out('8745422771459947563');" style=""> 125     @Resource(name = &quot;blFieldDao&quot;)                                                                       </span>
<span class="-5779425042369505145" onmouseenter="enter('-5779425042369505145');" onmouseout="out('-5779425042369505145');" style=""> 126     protected FieldDao fieldDao;                                                                         </span>
<span  style=""> 127                                                                                                          </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style=""> 128     @Resource(name = &quot;blLocaleService&quot;)                                                                  </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style=""> 129     protected LocaleService localeService;                                                               </span>
<span  style=""> 130                                                                                                          </span>
<span class="3433532014428154380" onmouseenter="enter('3433532014428154380');" onmouseout="out('3433532014428154380');" style=""> 131     @Resource(name = &quot;blSolrHelperService&quot;)                                                              </span>
<span class="-7677498150151406376" onmouseenter="enter('-7677498150151406376');" onmouseout="out('-7677498150151406376');" style=""> 132     protected SolrHelperService shs;                                                                     </span>
<span  style=""> 133                                                                                                          </span>
<span class="6454351128227777183" onmouseenter="enter('6454351128227777183');" onmouseout="out('6454351128227777183');" style=""> 134     @Resource(name = &quot;blSolrIndexServiceExtensionManager&quot;)                                               </span>
<span class="5247479920184811971" onmouseenter="enter('5247479920184811971');" onmouseout="out('5247479920184811971');" style=""> 135     protected SolrIndexServiceExtensionManager extensionManager;                                         </span>
<span  style=""> 136                                                                                                          </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 137     @Resource(name = &quot;blTransactionManager&quot;)                                                             </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 138     protected PlatformTransactionManager transactionManager;                                             </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2777716978602743792" onmouseenter="enter('-2777716978602743792');" onmouseout="out('-2777716978602743792');" style=""> 140     @Resource(name = &quot;blSolrIndexDao&quot;)                                                                   </span>
<span class="2803857682022434599" onmouseenter="enter('2803857682022434599');" onmouseout="out('2803857682022434599');" style=""> 141     protected SolrIndexDao solrIndexDao;                                                                 </span>
<span  style=""> 142                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 143     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 144     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 145                                                                                                          </span>
<span class="722550641335667641" onmouseenter="enter('722550641335667641');" onmouseout="out('722550641335667641');" style=""> 146     @Resource(name = &quot;blSearchFacetDao&quot;)                                                                 </span>
<span class="-2192164507887589197" onmouseenter="enter('-2192164507887589197');" onmouseout="out('-2192164507887589197');" style=""> 147     protected SearchFacetDao searchFacetDao;                                                             </span>
<span  style=""> 148                                                                                                          </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style=""> 149     @Resource(name = &quot;blIndexFieldDao&quot;)                                                                  </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style=""> 150     protected IndexFieldDao indexFieldDao;                                                               </span>
<span  style=""> 151                                                                                                          </span>
<span class="7259833124441141354" onmouseenter="enter('7259833124441141354');" onmouseout="out('7259833124441141354');" style=""> 152     @Value(&quot;${enable.solr.optimize:false}&quot;)                                                              </span>
<span class="-7987045041834234094" onmouseenter="enter('-7987045041834234094');" onmouseout="out('-7987045041834234094');" style=""> 153     private boolean optimizeEnabled;                                                                     </span>
<span  style=""> 154                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 155     @Override                                                                                            </span>
<span class="293221034776945003" onmouseenter="enter('293221034776945003');" onmouseout="out('293221034776945003');" style=""> 156     public void afterPropertiesSet() throws Exception {                                                  </span>
<span class="8737826944751881878" onmouseenter="enter('8737826944751881878');" onmouseout="out('8737826944751881878');" style=""> 157         if (!useLegacySolrIndexer) {                                                                     </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style=""> 158             if (useSku) {                                                                                </span>
<span class="9179894285227722563" onmouseenter="enter('9179894285227722563');" onmouseout="out('9179894285227722563');" style=""><abbr title=" 159                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.use.sku&#x27; was true, which is not supported.&quot;);"> 159                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was falðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160             }                                                                                            </span>
<span class="-3752749985901808876" onmouseenter="enter('-3752749985901808876');" onmouseout="out('-3752749985901808876');" style=""> 161             if (solrConfiguration != null &amp;&amp; solrConfiguration.isSiteCollections()) {                    </span>
<span class="-7184456578586809293" onmouseenter="enter('-7184456578586809293');" onmouseout="out('-7184456578586809293');" style=""><abbr title=" 162                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.site.collections&#x27; was true, which is not supported.&quot;);"> 162                 throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was falðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165     }                                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 167     @Override                                                                                            </span>
<span class="-1854653869970518806" onmouseenter="enter('-1854653869970518806');" onmouseout="out('-1854653869970518806');" style=""><abbr title=" 168     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException {"> 168     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 169         try {                                                                                            </span>
<span class="2574663780463066494" onmouseenter="enter('2574663780463066494');" onmouseout="out('2574663780463066494');" style=""> 170             CatalogStructure cache = new CatalogStructure();                                             </span>
<span class="1856999562212420811" onmouseenter="enter('1856999562212420811');" onmouseout="out('1856999562212420811');" style=""> 171             SolrIndexCachedOperation.setCache(cache);                                                    </span>
<span class="-195994336271238110" onmouseenter="enter('-195994336271238110');" onmouseout="out('-195994336271238110');" style=""> 172             cacheOperation.execute();                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 173         } finally {                                                                                      </span>
<span class="7293095816713805281" onmouseenter="enter('7293095816713805281');" onmouseout="out('7293095816713805281');" style=""> 174             SolrIndexCachedOperation.clearCache();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176     }                                                                                                    </span>
<span  style=""> 177                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 178     @Override                                                                                            </span>
<span class="-8221211564360382808" onmouseenter="enter('-8221211564360382808');" onmouseout="out('-8221211564360382808');" style=""> 179     public void rebuildIndex() throws ServiceException, IOException {                                    </span>
<span class="4404402464743924238" onmouseenter="enter('4404402464743924238');" onmouseout="out('4404402464743924238');" style=""> 180         LOG.info(&quot;Rebuilding the entire Solr index...&quot;);                                                 </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 181         StopWatch s = new StopWatch();                                                                   </span>
<span  style=""> 182                                                                                                          </span>
<span class="2782448594641417849" onmouseenter="enter('2782448594641417849');" onmouseout="out('2782448594641417849');" style=""> 183         preBuildIndex();                                                                                 </span>
<span class="5364167027467208466" onmouseenter="enter('5364167027467208466');" onmouseout="out('5364167027467208466');" style=""> 184         buildIndex();                                                                                    </span>
<span class="-2734214044106280557" onmouseenter="enter('-2734214044106280557');" onmouseout="out('-2734214044106280557');" style=""> 185         postBuildIndex();                                                                                </span>
<span  style=""> 186                                                                                                          </span>
<span class="8949756262532963545" onmouseenter="enter('8949756262532963545');" onmouseout="out('8949756262532963545');" style=""> 187         LOG.info(String.format(&quot;Finished building entire Solr index in %s&quot;, s.toLapString()));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188     }                                                                                                    </span>
<span  style=""> 189                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 190     @Override                                                                                            </span>
<span class="3237807690855435825" onmouseenter="enter('3237807690855435825');" onmouseout="out('3237807690855435825');" style=""> 191     public void preBuildIndex() throws ServiceException {                                                </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style=""><abbr title=" 192         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 192         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193     }                                                                                                    </span>
<span  style=""> 194                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 195     @Override                                                                                            </span>
<span class="107860368930590037" onmouseenter="enter('107860368930590037');" onmouseout="out('107860368930590037');" style=""> 196     public void buildIndex() throws IOException, ServiceException {                                      </span>
<span class="5469402358120203042" onmouseenter="enter('5469402358120203042');" onmouseout="out('5469402358120203042');" style=""> 197         executeSolrIndexOperation(getReindexOperation());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198     }                                                                                                    </span>
<span  style=""> 199                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 200     @Override                                                                                            </span>
<span class="2712485588427861869" onmouseenter="enter('2712485588427861869');" onmouseout="out('2712485588427861869');" style=""> 201     public void postBuildIndex() throws IOException, ServiceException {                                  </span>
<span class="2217794635114723364" onmouseenter="enter('2217794635114723364');" onmouseout="out('2217794635114723364');" style=""> 202         if (optimizeEnabled) {                                                                           </span>
<span class="4104911694494191311" onmouseenter="enter('4104911694494191311');" onmouseout="out('4104911694494191311');" style=""> 203         // this is required to be at the very very very end after rebuilding the whole index             </span>
<span class="-3594378582194653803" onmouseenter="enter('-3594378582194653803');" onmouseout="out('-3594378582194653803');" style=""><abbr title=" 204             optimizeIndex(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 204             optimizeIndex(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205         }                                                                                                </span>
<span class="-7179442614804219935" onmouseenter="enter('-7179442614804219935');" onmouseout="out('-7179442614804219935');" style=""> 206         // Swap the active and the reindex cores                                                         </span>
<span class="-211335379164132987" onmouseenter="enter('-211335379164132987');" onmouseout="out('-211335379164132987');" style=""> 207         if (!solrConfiguration.isSingleCoreMode()) {                                                     </span>
<span class="-1073514264710403192" onmouseenter="enter('-1073514264710403192');" onmouseout="out('-1073514264710403192');" style=""> 208             shs.swapActiveCores(solrConfiguration);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210     }                                                                                                    </span>
<span  style=""> 211                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 212     @Override                                                                                            </span>
<span class="-811355888891304948" onmouseenter="enter('-811355888891304948');" onmouseout="out('-811355888891304948');" style=""> 213     public SolrIndexOperation getReindexOperation() {                                                    </span>
<span class="4313634092062438466" onmouseenter="enter('4313634092062438466');" onmouseout="out('4313634092062438466');" style=""><abbr title=" 214         return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex) {"> 214         return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex)ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 215             @Override                                                                                    </span>
<span class="-4387595312024622473" onmouseenter="enter('-4387595312024622473');" onmouseout="out('-4387595312024622473');" style=""> 216             public List&lt;? extends Indexable&gt; readIndexables(int pageSize, Long lastId) {                 </span>
<span class="4006405235344016633" onmouseenter="enter('4006405235344016633');" onmouseout="out('4006405235344016633');" style=""> 217                 return readAllActiveIndexables(pageSize, lastId);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218             }                                                                                            </span>
<span  style=""> 219                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 220             @Override                                                                                    </span>
<span class="5959961393917647667" onmouseenter="enter('5959961393917647667');" onmouseout="out('5959961393917647667');" style=""> 221             public Long countIndexables() {                                                              </span>
<span class="2520275452674275986" onmouseenter="enter('2520275452674275986');" onmouseout="out('2520275452674275986');" style=""> 222                 return countIndexableItems();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223             }                                                                                            </span>
<span  style=""> 224                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225             @Override                                                                                    </span>
<span class="-1692826682113823468" onmouseenter="enter('-1692826682113823468');" onmouseout="out('-1692826682113823468');" style=""> 226             public void buildPage(List&lt;? extends Indexable&gt; indexables) throws ServiceException {        </span>
<span class="3979625068666947530" onmouseenter="enter('3979625068666947530');" onmouseout="out('3979625068666947530');" style=""><abbr title=" 227                 buildIncrementalIndex(getSolrCollectionForIndexing(), indexables, getSolrServerForIndexing());"> 227                 buildIncrementalIndex(getSolrCollectionForIndexing(), indexables, getSolrServerForIndexinðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 229         };                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230     }                                                                                                    </span>
<span  style=""> 231                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 232     @Override                                                                                            </span>
<span class="-4119273796811407274" onmouseenter="enter('-4119273796811407274');" onmouseout="out('-4119273796811407274');" style=""><abbr title=" 233     public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOException {"> 233     public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOðŸ”µ</abbr></span>
<span class="-6605112368804100748" onmouseenter="enter('-6605112368804100748');" onmouseout="out('-6605112368804100748');" style=""> 234         operation.obtainLock();                                                                          </span>
<span  style=""> 235                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 236         try {                                                                                            </span>
<span class="5776764097449375233" onmouseenter="enter('5776764097449375233');" onmouseout="out('5776764097449375233');" style=""> 237             LOG.info(&quot;Executing Indexing operation&quot;);                                                    </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 238             StopWatch s = new StopWatch();                                                               </span>
<span  style=""> 239                                                                                                          </span>
<span class="-4925351317711298127" onmouseenter="enter('-4925351317711298127');" onmouseout="out('-4925351317711298127');" style=""> 240             Object[] pack = saveState();                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 241             try {                                                                                        </span>
<span class="4852869320838830283" onmouseenter="enter('4852869320838830283');" onmouseout="out('4852869320838830283');" style=""> 242                 final Long numItemsToIndex;                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 243                 try {                                                                                    </span>
<span class="997617649642836840" onmouseenter="enter('997617649642836840');" onmouseout="out('997617649642836840');" style=""> 244                     operation.beforeCountIndexables();                                                   </span>
<span  style=""> 245                                                                                                          </span>
<span class="-8341915703694509082" onmouseenter="enter('-8341915703694509082');" onmouseout="out('-8341915703694509082');" style=""> 246                     numItemsToIndex = operation.countIndexables();                                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 247                 } finally {                                                                              </span>
<span class="8625682159596383443" onmouseenter="enter('8625682159596383443');" onmouseout="out('8625682159596383443');" style=""> 248                     operation.afterCountIndexables();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249                 }                                                                                        </span>
<span  style=""> 250                                                                                                          </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 251                 if (LOG.isDebugEnabled()) {                                                              </span>
<span class="-1342537230534112505" onmouseenter="enter('-1342537230534112505');" onmouseout="out('-1342537230534112505');" style=""> 252                     LOG.debug(&quot;There are at most &quot; + numItemsToIndex + &quot; items to index&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                 }                                                                                        </span>
<span class="-6975585634623067095" onmouseenter="enter('-6975585634623067095');" onmouseout="out('-6975585634623067095');" style=""> 254                 performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {                   </span>
<span  style=""> 255                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 256                     @Override                                                                            </span>
<span class="-7096128206041696180" onmouseenter="enter('-7096128206041696180');" onmouseout="out('-7096128206041696180');" style=""> 257                     public void execute() throws ServiceException {                                      </span>
<span class="-4395739824177979579" onmouseenter="enter('-4395739824177979579');" onmouseout="out('-4395739824177979579');" style=""> 258                         int page = 1;                                                                    </span>
<span class="4634490409390119351" onmouseenter="enter('4634490409390119351');" onmouseout="out('4634490409390119351');" style=""> 259                         Long lastId = null;                                                              </span>
<span class="-2807153128771866015" onmouseenter="enter('-2807153128771866015');" onmouseout="out('-2807153128771866015');" style=""> 260                         Long remainingNumItemsToIndex = numItemsToIndex;                                 </span>
<span class="-6866370637183701575" onmouseenter="enter('-6866370637183701575');" onmouseout="out('-6866370637183701575');" style=""> 261                         Long totalPages = getTotalPageCount(numItemsToIndex);                            </span>
<span  style=""> 262                                                                                                          </span>
<span class="-2134634807912211771" onmouseenter="enter('-2134634807912211771');" onmouseout="out('-2134634807912211771');" style=""> 263                         while (remainingNumItemsToIndex &gt; 0) {                                           </span>
<span class="6951794882859960666" onmouseenter="enter('6951794882859960666');" onmouseout="out('6951794882859960666');" style=""> 264                             String pageNumberMessage = buildPageNumberMessage(page, totalPages);         </span>
<span class="5716330204152709052" onmouseenter="enter('5716330204152709052');" onmouseout="out('5716330204152709052');" style=""> 265                             LOG.info(pageNumberMessage);                                                 </span>
<span  style=""> 266                                                                                                          </span>
<span class="165772722778294439" onmouseenter="enter('165772722778294439');" onmouseout="out('165772722778294439');" style=""> 267                             lastId = buildIncrementalIndex(pageSize, lastId, operation);                 </span>
<span class="-4024045770293484238" onmouseenter="enter('-4024045770293484238');" onmouseout="out('-4024045770293484238');" style=""> 268                             remainingNumItemsToIndex -= pageSize;                                        </span>
<span class="-8284897147643623971" onmouseenter="enter('-8284897147643623971');" onmouseout="out('-8284897147643623971');" style=""> 269                             page++;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 272                 });                                                                                      </span>
<span  style=""> 273                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 274             } finally {                                                                                  </span>
<span class="-5823413484715712161" onmouseenter="enter('-5823413484715712161');" onmouseout="out('-5823413484715712161');" style=""> 275                 restoreState(pack);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276             }                                                                                            </span>
<span  style=""> 277                                                                                                          </span>
<span class="7093623796813341550" onmouseenter="enter('7093623796813341550');" onmouseout="out('7093623796813341550');" style=""> 278             LOG.info(String.format(&quot;Indexing operation completed in %s&quot;, s.toLapString()));              </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 279         } finally {                                                                                      </span>
<span class="-1350180452435495402" onmouseenter="enter('-1350180452435495402');" onmouseout="out('-1350180452435495402');" style=""> 280             operation.releaseLock();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282     }                                                                                                    </span>
<span  style=""> 283                                                                                                          </span>
<span class="4509881942909907564" onmouseenter="enter('4509881942909907564');" onmouseout="out('4509881942909907564');" style=""> 284     protected long getTotalPageCount(Long numItemsToIndex) {                                             </span>
<span class="885623822255204209" onmouseenter="enter('885623822255204209');" onmouseout="out('885623822255204209');" style=""> 285         long numPagesToIndex = numItemsToIndex / pageSize;                                               </span>
<span class="1202091708155781117" onmouseenter="enter('1202091708155781117');" onmouseout="out('1202091708155781117');" style=""> 286         boolean hasRemainingItemsToIndex = numItemsToIndex % pageSize != 0;                              </span>
<span  style=""> 287                                                                                                          </span>
<span class="-8914515660918232216" onmouseenter="enter('-8914515660918232216');" onmouseout="out('-8914515660918232216');" style=""> 288         return hasRemainingItemsToIndex ? (numPagesToIndex + 1) : numPagesToIndex;                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289     }                                                                                                    </span>
<span  style=""> 290                                                                                                          </span>
<span class="-1140169622753247687" onmouseenter="enter('-1140169622753247687');" onmouseout="out('-1140169622753247687');" style=""> 291     protected String buildPageNumberMessage(int page, Long totalPages) {                                 </span>
<span class="5185167171670482872" onmouseenter="enter('5185167171670482872');" onmouseout="out('5185167171670482872');" style=""> 292         String pageNumberMessage = String.format(&quot;Building page number %s of %s&quot;, page, totalPages);     </span>
<span  style=""> 293                                                                                                          </span>
<span class="3917690980387875903" onmouseenter="enter('3917690980387875903');" onmouseout="out('3917690980387875903');" style=""><abbr title=" 294         Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog();"> 294         Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog()ðŸ”µ</abbr></span>
<span class="3059190135946477261" onmouseenter="enter('3059190135946477261');" onmouseout="out('3059190135946477261');" style=""> 295         if (currentCatalog != null) {                                                                    </span>
<span class="-2760479412731933677" onmouseenter="enter('-2760479412731933677');" onmouseout="out('-2760479412731933677');" style=""> 296             pageNumberMessage += String.format(&quot; for catalog: %s&quot;, currentCatalog.getName());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297         }                                                                                                </span>
<span  style=""> 298                                                                                                          </span>
<span class="6061536256827306935" onmouseenter="enter('6061536256827306935');" onmouseout="out('6061536256827306935');" style=""> 299         return pageNumberMessage;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300     }                                                                                                    </span>
<span  style=""> 301                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 302     /**                                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 303      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 304      */                                                                                                  </span>
<span class="307261357449118205" onmouseenter="enter('307261357449118205');" onmouseout="out('307261357449118205');" style=""> 305     protected Long countIndexableItems() {                                                               </span>
<span class="3881831181376649254" onmouseenter="enter('3881831181376649254');" onmouseout="out('3881831181376649254');" style=""> 306         return productDao.readCountAllActiveProducts();                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307     }                                                                                                    </span>
<span  style=""> 308                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 309     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 310      * &lt;p&gt;                                                                                               </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 311      * This method deletes all of the documents from {@link SolrContext#getReindexServer()}              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 312      *                                                                                                   </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 313      * @throws ServiceException if there was a problem removing the documents                            </span>
<span class="-1570570320656419415" onmouseenter="enter('-1570570320656419415');" onmouseout="out('-1570570320656419415');" style=""> 314      * @deprecated use {@link #deleteAllReindexCoreDocuments()} instead                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 315      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 316     @Deprecated                                                                                          </span>
<span class="7799053882932808400" onmouseenter="enter('7799053882932808400');" onmouseout="out('7799053882932808400');" style=""> 317     protected void deleteAllDocuments() throws ServiceException {                                        </span>
<span class="3834807060428836051" onmouseenter="enter('3834807060428836051');" onmouseout="out('3834807060428836051');" style=""> 318         deleteAllReindexCoreDocuments();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319     }                                                                                                    </span>
<span  style=""> 320                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 321     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 322      * &lt;p&gt;                                                                                               </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 323      * This method deletes all of the documents from {@link SolrContext#getReindexServer()}              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 324      *                                                                                                   </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 325      * @throws ServiceException if there was a problem removing the documents                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 326      */                                                                                                  </span>
<span class="6870158579484852535" onmouseenter="enter('6870158579484852535');" onmouseout="out('6870158579484852535');" style=""> 327     protected void deleteAllReindexCoreDocuments() throws ServiceException {                             </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style=""><abbr title=" 328         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 328         deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329     }                                                                                                    </span>
<span  style=""> 330                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 331     @Override                                                                                            </span>
<span class="-4976975123662493196" onmouseenter="enter('-4976975123662493196');" onmouseout="out('-4976975123662493196');" style=""><abbr title=" 332     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException {"> 332     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 333         try {                                                                                            </span>
<span class="-3598784994642327032" onmouseenter="enter('-3598784994642327032');" onmouseout="out('-3598784994642327032');" style=""><abbr title=" 334             String deleteQuery = ((StringUtil.sanitize(shs.getNamespaceFieldName()) + &quot;:(\&quot;&quot;) + StringUtil.sanitize(solrConfiguration.getNamespace())) + &quot;\&quot;)&quot;;"> 334             String deleteQuery = ((StringUtil.sanitize(shs.getNamespaceFieldName()) + &quot;:(\&quot;&quot;) + StringUtiðŸ”µ</abbr></span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 335             LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                              </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style=""> 336             server.deleteByQuery(collection, deleteQuery);                                               </span>
<span class="-546379745910436336" onmouseenter="enter('-546379745910436336');" onmouseout="out('-546379745910436336');" style=""> 337             //Explicitly do a hard commit here since we just deleted the entire index                    </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style=""> 338             server.commit(collection);                                                                   </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 339         } catch (java.lang.Exception e) {                                                                </span>
<span class="4280241435178863824" onmouseenter="enter('4280241435178863824');" onmouseout="out('4280241435178863824');" style=""> 340             if (ServiceException.class.isAssignableFrom(e.getClass())) {                                 </span>
<span class="7199617623149194361" onmouseenter="enter('7199617623149194361');" onmouseout="out('7199617623149194361');" style=""> 341                 throw ((ServiceException) (e));                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342             }                                                                                            </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 343             throw new ServiceException(&quot;Could not delete documents&quot;, e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345     }                                                                                                    </span>
<span  style=""> 346                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 347     @Override                                                                                            </span>
<span class="8552288591606532671" onmouseenter="enter('8552288591606532671');" onmouseout="out('8552288591606532671');" style=""> 348     public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException {       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 349         try {                                                                                            </span>
<span class="2136303103230726070" onmouseenter="enter('2136303103230726070');" onmouseout="out('2136303103230726070');" style=""> 350             String deleteQuery = &quot;*:*&quot;;                                                                  </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 351             LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                              </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style=""> 352             server.deleteByQuery(collection, deleteQuery);                                               </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style=""> 353             server.commit(collection);                                                                   </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 354         } catch (java.lang.Exception e) {                                                                </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 355             throw new ServiceException(&quot;Could not delete documents&quot;, e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357     }                                                                                                    </span>
<span  style=""> 358                                                                                                          </span>
<span class="-1911085678082561084" onmouseenter="enter('-1911085678082561084');" onmouseout="out('-1911085678082561084');" style=""><abbr title=" 359     protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ServiceException {"> 359     protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ðŸ”µ</abbr></span>
<span class="1006805691441623516" onmouseenter="enter('1006805691441623516');" onmouseout="out('1006805691441623516');" style=""> 360         TransactionStatus status = TransactionUtils.createTransaction(&quot;readItemsToIndex&quot;,                </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 361             TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                       </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 362         if (SolrIndexCachedOperation.getCache() == null) {                                               </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 363             LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +   </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 364                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 364                     &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365         }                                                                                                </span>
<span class="-4530225541058778702" onmouseenter="enter('-4530225541058778702');" onmouseout="out('-4530225541058778702');" style=""> 366         Long response = null;                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 367         try {                                                                                            </span>
<span class="-3204111561138569714" onmouseenter="enter('-3204111561138569714');" onmouseout="out('-3204111561138569714');" style=""> 368             List&lt;? extends Indexable&gt; indexables;                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 369             try {                                                                                        </span>
<span class="3356995070675471983" onmouseenter="enter('3356995070675471983');" onmouseout="out('3356995070675471983');" style=""> 370                 operation.beforeReadIndexables();                                                        </span>
<span class="1315644369404660428" onmouseenter="enter('1315644369404660428');" onmouseout="out('1315644369404660428');" style=""> 371                 indexables = operation.readIndexables(pageSize, lastId);                                 </span>
<span class="-3163865863529807802" onmouseenter="enter('-3163865863529807802');" onmouseout="out('-3163865863529807802');" style=""> 372                 if (CollectionUtils.isNotEmpty(indexables)) {                                            </span>
<span class="1879209496515446980" onmouseenter="enter('1879209496515446980');" onmouseout="out('1879209496515446980');" style=""> 373                     response = indexables.get(indexables.size()-1).getId();                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374                 }                                                                                        </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 375             } finally {                                                                                  </span>
<span class="-7029725537576676912" onmouseenter="enter('-7029725537576676912');" onmouseout="out('-7029725537576676912');" style=""> 376                 operation.afterReadIndexables();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377             }                                                                                            </span>
<span  style=""> 378                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 379             try {                                                                                        </span>
<span class="-2168921446123257487" onmouseenter="enter('-2168921446123257487');" onmouseout="out('-2168921446123257487');" style=""> 380                 operation.beforeBuildPage();                                                             </span>
<span  style=""> 381                                                                                                          </span>
<span class="9094317700245591530" onmouseenter="enter('9094317700245591530');" onmouseout="out('9094317700245591530');" style=""> 382                 operation.buildPage(indexables);                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 383             } finally {                                                                                  </span>
<span class="3074038306845641791" onmouseenter="enter('3074038306845641791');" onmouseout="out('3074038306845641791');" style=""> 384                 operation.afterBuildPage();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385             }                                                                                            </span>
<span  style=""> 386                                                                                                          </span>
<span  style=""> 387                                                                                                          </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 388             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 389         } catch (RuntimeException e) {                                                                   </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 390             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 391             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 393         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394     }                                                                                                    </span>
<span  style=""> 395                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 396     @Override                                                                                            </span>
<span class="-3229146772555478401" onmouseenter="enter('-3229146772555478401');" onmouseout="out('-3229146772555478401');" style=""><abbr title=" 397     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 397     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends IndexablðŸ”µ</abbr></span>
<span class="-5663035189391039231" onmouseenter="enter('-5663035189391039231');" onmouseout="out('-5663035189391039231');" style=""><abbr title=" 398         TransactionStatus status = TransactionUtils.createTransaction(&quot;executeIncrementalIndex&quot;, TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);"> 398         TransactionStatus status = TransactionUtils.createTransaction(&quot;executeIncrementalIndex&quot;, TransactðŸ”µ</abbr></span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 399         if (SolrIndexCachedOperation.getCache() == null) {                                               </span>
<span class="3434244950941566934" onmouseenter="enter('3434244950941566934');" onmouseout="out('3434244950941566934');" style=""><abbr title=" 400             LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; + &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 400             LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; + &quot;SðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401         }                                                                                                </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 402         if (LOG.isDebugEnabled()) {                                                                      </span>
<span class="5294183869527180393" onmouseenter="enter('5294183869527180393');" onmouseout="out('5294183869527180393');" style=""><abbr title=" 403             LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.size()));"> 403             LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404         }                                                                                                </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 405         StopWatch s = new StopWatch();                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 406         try {                                                                                            </span>
<span class="6539966544446663437" onmouseenter="enter('6539966544446663437');" onmouseout="out('6539966544446663437');" style=""> 407             sandBoxHelper.ignoreCloneCache(true);                                                        </span>
<span class="7183587253332869173" onmouseenter="enter('7183587253332869173');" onmouseout="out('7183587253332869173');" style=""> 408             extensionManager.getProxy().startBatchEvent(indexables);                                     </span>
<span class="3424650845291102605" onmouseenter="enter('3424650845291102605');" onmouseout="out('3424650845291102605');" style=""> 409             Collection&lt;SolrInputDocument&gt; documents = new ArrayList&lt;&gt;();                                 </span>
<span class="7801772952659649444" onmouseenter="enter('7801772952659649444');" onmouseout="out('7801772952659649444');" style=""> 410             List&lt;Locale&gt; locales = getAllLocales();                                                      </span>
<span class="-2189912087670236149" onmouseenter="enter('-2189912087670236149');" onmouseout="out('-2189912087670236149');" style=""><abbr title=" 411             List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;() {"> 411             List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 412                 @Override                                                                                </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 413                 public Long transform(Object input) {                                                    </span>
<span class="-6263628392626447830" onmouseenter="enter('-6263628392626447830');" onmouseout="out('-6263628392626447830');" style=""> 414                     return shs.getCurrentProductId(((Indexable) (input)));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 416             });                                                                                          </span>
<span class="-6904889408824287124" onmouseenter="enter('-6904889408824287124');" onmouseout="out('-6904889408824287124');" style=""><abbr title=" 417             solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache());"> 417             solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache())ðŸ”µ</abbr></span>
<span class="326959637207207549" onmouseenter="enter('326959637207207549');" onmouseout="out('326959637207207549');" style=""> 418             List&lt;IndexField&gt; fields = null;                                                              </span>
<span class="-1903082167184535893" onmouseenter="enter('-1903082167184535893');" onmouseout="out('-1903082167184535893');" style=""> 419             FieldEntity currentFieldType = null;                                                         </span>
<span class="-3671570197523764351" onmouseenter="enter('-3671570197523764351');" onmouseout="out('-3671570197523764351');" style=""> 420             for (Indexable indexable : indexables) {                                                     </span>
<span class="-5398409694819201190" onmouseenter="enter('-5398409694819201190');" onmouseout="out('-5398409694819201190');" style=""><abbr title=" 421                 if ((fields == null) || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityType())) {"> 421                 if ((fields == null) || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityTyðŸ”µ</abbr></span>
<span class="4379308220695057970" onmouseenter="enter('4379308220695057970');" onmouseout="out('4379308220695057970');" style=""> 422                     fields = indexFieldDao.readFieldsByEntityType(indexable.getFieldEntityType());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423                 }                                                                                        </span>
<span class="7630570351050256200" onmouseenter="enter('7630570351050256200');" onmouseout="out('7630570351050256200');" style=""> 424                 SolrInputDocument doc = buildDocument(indexable, fields, locales);                       </span>
<span class="4006108129684413880" onmouseenter="enter('4006108129684413880');" onmouseout="out('4006108129684413880');" style=""><abbr title=" 425                 // If someone overrides the buildDocument method and determines that they don&#x27;t want a product"> 425                 // If someone overrides the buildDocument method and determines that they don&#x27;t want a prðŸ”µ</abbr></span>
<span class="5174865918441182866" onmouseenter="enter('5174865918441182866');" onmouseout="out('5174865918441182866');" style=""> 426                 // indexed, then they can return null. If the document is null it does not get added to  </span>
<span class="6430420916721050319" onmouseenter="enter('6430420916721050319');" onmouseout="out('6430420916721050319');" style=""> 427                 // to the index.                                                                         </span>
<span class="-5520172171866318279" onmouseenter="enter('-5520172171866318279');" onmouseout="out('-5520172171866318279');" style=""> 428                 if (doc != null) {                                                                       </span>
<span class="4425904984588304942" onmouseenter="enter('4425904984588304942');" onmouseout="out('4425904984588304942');" style=""> 429                     documents.add(doc);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431             }                                                                                            </span>
<span class="-5162140986849793305" onmouseenter="enter('-5162140986849793305');" onmouseout="out('-5162140986849793305');" style=""> 432             extensionManager.getProxy().modifyBuiltDocuments(documents, indexables, fields, locales);    </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 433             logDocuments(documents);                                                                     </span>
<span class="2718358367277066962" onmouseenter="enter('2718358367277066962');" onmouseout="out('2718358367277066962');" style=""> 434             if ((!CollectionUtils.isEmpty(documents)) &amp;&amp; (solrServer != null)) {                         </span>
<span class="6742664882868092095" onmouseenter="enter('6742664882868092095');" onmouseout="out('6742664882868092095');" style=""> 435                 solrServer.add(collection, documents);                                                   </span>
<span class="4440071783810203686" onmouseenter="enter('4440071783810203686');" onmouseout="out('4440071783810203686');" style=""> 436                 commit(collection, solrServer);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437             }                                                                                            </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 438             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 439             if (LOG.isDebugEnabled()) {                                                                  </span>
<span class="-5239549129780834185" onmouseenter="enter('-5239549129780834185');" onmouseout="out('-5239549129780834185');" style=""><abbr title=" 440                 LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexables.size(), s.toLapString()));"> 440                 LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441             }                                                                                            </span>
<span class="-4724346008918927046" onmouseenter="enter('-4724346008918927046');" onmouseout="out('-4724346008918927046');" style=""> 442             return documents;                                                                            </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 443         } catch (SolrServerException e) {                                                                </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 444             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 445             throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 446         } catch (IOException e) {                                                                        </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 447             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 448             throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                    </span>
<span class="5702813929982664684" onmouseenter="enter('5702813929982664684');" onmouseout="out('5702813929982664684');" style=""> 449         } catch (java.lang.RuntimeException e) {                                                         </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 450             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 451             throw e;                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 452         } finally {                                                                                      </span>
<span class="90671037077050937" onmouseenter="enter('90671037077050937');" onmouseout="out('90671037077050937');" style=""> 453             extensionManager.getProxy().endBatchEvent(indexables);                                       </span>
<span class="8189254405929957329" onmouseenter="enter('8189254405929957329');" onmouseout="out('8189254405929957329');" style=""> 454             sandBoxHelper.ignoreCloneCache(false);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456     }                                                                                                    </span>
<span  style=""> 457                                                                                                          </span>
<span class="5551263307167100166" onmouseenter="enter('5551263307167100166');" onmouseout="out('5551263307167100166');" style=""> 458     protected List&lt;? extends Indexable&gt; readAllActiveIndexables(int pageSize, Long lastId) {             </span>
<span class="6192419674169007142" onmouseenter="enter('6192419674169007142');" onmouseout="out('6192419674169007142');" style=""> 459         return productDao.readAllActiveProducts(pageSize, lastId);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460     }                                                                                                    </span>
<span  style=""> 461                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 462     @Override                                                                                            </span>
<span class="-8038322947777108176" onmouseenter="enter('-8038322947777108176');" onmouseout="out('-8038322947777108176');" style=""> 463     public List&lt;Locale&gt; getAllLocales() {                                                                </span>
<span class="-8741721793451188111" onmouseenter="enter('-8741721793451188111');" onmouseout="out('-8741721793451188111');" style=""> 464         List&lt;Locale&gt; allLocales = localeService.findAllLocales();                                        </span>
<span class="4034520407475000176" onmouseenter="enter('4034520407475000176');" onmouseout="out('4034520407475000176');" style=""> 465         Map&lt;String, Locale&gt; processedLocales = new HashMap&lt;&gt;();                                          </span>
<span class="2399355616829443482" onmouseenter="enter('2399355616829443482');" onmouseout="out('2399355616829443482');" style=""><abbr title=" 466         // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale set and I&#x27;m"> 466         // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale seðŸ”µ</abbr></span>
<span class="1459641740327693907" onmouseenter="enter('1459641740327693907');" onmouseout="out('1459641740327693907');" style=""> 467         // not using the country code to index the values, then I only need to index the locale &#x27;en&#x27;     </span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style=""> 468         for (Locale locale : allLocales) {                                                               </span>
<span class="343473664574147441" onmouseenter="enter('343473664574147441');" onmouseout="out('343473664574147441');" style=""> 469             String localeCode = locale.getLocaleCode();                                                  </span>
<span class="-113413807046306655" onmouseenter="enter('-113413807046306655');" onmouseout="out('-113413807046306655');" style=""> 470             int underscoreLocation = localeCode.indexOf(&quot;_&quot;);                                            </span>
<span class="5152034502068978670" onmouseenter="enter('5152034502068978670');" onmouseout="out('5152034502068978670');" style=""> 471             if (underscoreLocation &gt; 0 &amp;&amp; Boolean.FALSE.equals(locale.getUseCountryInSearchIndex())) {   </span>
<span class="8938820827276960997" onmouseenter="enter('8938820827276960997');" onmouseout="out('8938820827276960997');" style=""> 472                 String localeCodeWithoutCountry = localeCode.substring(0, underscoreLocation);           </span>
<span class="-6764305435332837995" onmouseenter="enter('-6764305435332837995');" onmouseout="out('-6764305435332837995');" style=""> 473                 if (!processedLocales.containsKey(localeCodeWithoutCountry)) {                           </span>
<span class="-3212129377547784987" onmouseenter="enter('-3212129377547784987');" onmouseout="out('-3212129377547784987');" style=""> 474                     processedLocales.put(localeCodeWithoutCountry, locale);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 476             } else {                                                                                     </span>
<span class="-3143247090679758655" onmouseenter="enter('-3143247090679758655');" onmouseout="out('-3143247090679758655');" style=""> 477                 processedLocales.put(locale.getLocaleCode(), locale);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479         }                                                                                                </span>
<span class="8478562493399850393" onmouseenter="enter('8478562493399850393');" onmouseout="out('8478562493399850393');" style=""> 480         return new ArrayList&lt;&gt;(processedLocales.values());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481     }                                                                                                    </span>
<span  style=""> 482                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 483     @Override                                                                                            </span>
<span class="-5988937181784380794" onmouseenter="enter('-5988937181784380794');" onmouseout="out('-5988937181784380794');" style=""><abbr title=" 484     public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 484     public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;LocalðŸ”µ</abbr></span>
<span class="3146089677360510289" onmouseenter="enter('3146089677360510289');" onmouseout="out('3146089677360510289');" style=""><abbr title=" 485         final SolrInputDocument document = new SolrInputDocument(new LinkedHashMap&lt;String, SolrInputField&gt;());"> 485         final SolrInputDocument document = new SolrInputDocument(new LinkedHashMap&lt;String, SolrInputFieldðŸ”µ</abbr></span>
<span class="-1191402169666210527" onmouseenter="enter('-1191402169666210527');" onmouseout="out('-1191402169666210527');" style=""> 486         attachBasicDocumentFields(indexable, document);                                                  </span>
<span class="6176356407772671184" onmouseenter="enter('6176356407772671184');" onmouseout="out('6176356407772671184');" style=""> 487         attachIndexableDocumentFields(document, indexable, fields, locales);                             </span>
<span class="-7308801397401646621" onmouseenter="enter('-7308801397401646621');" onmouseout="out('-7308801397401646621');" style=""> 488         attachAdditionalDocumentFields(indexable, document);                                             </span>
<span class="581573764679058551" onmouseenter="enter('581573764679058551');" onmouseout="out('581573764679058551');" style=""> 489         extensionManager.getProxy().attachChildDocuments(indexable, document, fields, locales);          </span>
<span class="-4026438827530914052" onmouseenter="enter('-4026438827530914052');" onmouseout="out('-4026438827530914052');" style=""> 490         return document;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491     }                                                                                                    </span>
<span  style=""> 492                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 493     @Override                                                                                            </span>
<span class="-2827903308009028143" onmouseenter="enter('-2827903308009028143');" onmouseout="out('-2827903308009028143');" style=""><abbr title=" 494     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 494     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr></span>
<span class="-7267711193404106417" onmouseenter="enter('-7267711193404106417');" onmouseout="out('-7267711193404106417');" style=""> 495         for (IndexField indexField : fields) {                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 496             try {                                                                                        </span>
<span class="-5685362315060478990" onmouseenter="enter('-5685362315060478990');" onmouseout="out('-5685362315060478990');" style=""> 497                 // If we find an IndexField entry for this field, then we need to store it in the index  </span>
<span class="-6138117391173223373" onmouseenter="enter('-6138117391173223373');" onmouseout="out('-6138117391173223373');" style=""> 498                 if (indexField != null) {                                                                </span>
<span class="-1605896855845279090" onmouseenter="enter('-1605896855845279090');" onmouseout="out('-1605896855845279090');" style=""> 499                     List&lt;IndexFieldType&gt; searchableFieldTypes = indexField.getFieldTypes();              </span>
<span  style=""> 500                                                                                                          </span>
<span class="7314822488779147745" onmouseenter="enter('7314822488779147745');" onmouseout="out('7314822488779147745');" style=""><abbr title=" 501                     // For each of its search field types, get the property values, and add a field to the document for each property value"> 501                     // For each of its search field types, get the property values, and add a field to thðŸ”µ</abbr></span>
<span class="9127582384821892356" onmouseenter="enter('9127582384821892356');" onmouseout="out('9127582384821892356');" style=""> 502                     for (IndexFieldType sft : searchableFieldTypes) {                                    </span>
<span class="-1855754965803101801" onmouseenter="enter('-1855754965803101801');" onmouseout="out('-1855754965803101801');" style=""> 503                         FieldType fieldType = sft.getFieldType();                                        </span>
<span class="1213494569726901077" onmouseenter="enter('1213494569726901077');" onmouseout="out('1213494569726901077');" style=""><abbr title=" 504                         Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getField(), fieldType, locales);"> 504                         Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getFðŸ”µ</abbr></span>
<span  style=""> 505                                                                                                          </span>
<span class="2731937647730128807" onmouseenter="enter('2731937647730128807');" onmouseout="out('2731937647730128807');" style=""><abbr title=" 506                         ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentForIndexField(document, indexField, fieldType, propertyValues);"> 506                         ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentFoðŸ”µ</abbr></span>
<span  style=""> 507                                                                                                          </span>
<span class="-2046283582941202064" onmouseenter="enter('-2046283582941202064');" onmouseout="out('-2046283582941202064');" style=""> 508                         if (ExtensionResultStatusType.NOT_HANDLED.equals(result)) {                      </span>
<span class="1818285189854508408" onmouseenter="enter('1818285189854508408');" onmouseout="out('1818285189854508408');" style=""> 509                             // Build out the field for every prefix                                      </span>
<span class="-7947315413202592125" onmouseenter="enter('-7947315413202592125');" onmouseout="out('-7947315413202592125');" style=""> 510                             for (Entry&lt;String, Object&gt; entry : propertyValues.entrySet()) {              </span>
<span class="-6275926878676507761" onmouseenter="enter('-6275926878676507761');" onmouseout="out('-6275926878676507761');" style=""> 511                                 String prefix = entry.getKey();                                          </span>
<span class="2218524055946596429" onmouseenter="enter('2218524055946596429');" onmouseout="out('2218524055946596429');" style=""> 512                                 prefix = StringUtils.isBlank(prefix) ? prefix : prefix + &quot;_&quot;;            </span>
<span  style=""> 513                                                                                                          </span>
<span class="-3898910784215480067" onmouseenter="enter('-3898910784215480067');" onmouseout="out('-3898910784215480067');" style=""><abbr title=" 514                                 String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fieldType, prefix);"> 514                                 String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fiðŸ”µ</abbr></span>
<span class="-4401151924846137205" onmouseenter="enter('-4401151924846137205');" onmouseout="out('-4401151924846137205');" style=""> 515                                 Object value = entry.getValue();                                         </span>
<span  style=""> 516                                                                                                          </span>
<span class="626346901079283965" onmouseenter="enter('626346901079283965');" onmouseout="out('626346901079283965');" style=""> 517                                 if (FieldType.isMultiValued(fieldType)) {                                </span>
<span class="-3165450242186121028" onmouseenter="enter('-3165450242186121028');" onmouseout="out('-3165450242186121028');" style=""> 518                                     document.addField(solrPropertyName, value);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 519                                 } else {                                                                 </span>
<span class="3313383578919119200" onmouseenter="enter('3313383578919119200');" onmouseout="out('3313383578919119200');" style=""> 520                                     document.setField(solrPropertyName, value);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525                 }                                                                                        </span>
<span  style=""> 526                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 527             } catch (Exception e) {                                                                      </span>
<span class="3922644492767384995" onmouseenter="enter('3922644492767384995');" onmouseout="out('3922644492767384995');" style=""><abbr title=" 528                 LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldName() + &quot;] for product id[&quot;"> 528                 LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldNaðŸ”µ</abbr></span>
<span class="6260448561791331284" onmouseenter="enter('6260448561791331284');" onmouseout="out('6260448561791331284');" style=""> 529                         + indexable.getId() + &quot;]&quot;, e);                                                   </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 530                 throw ExceptionHelper.refineException(e);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533     }                                                                                                    </span>
<span  style=""> 534                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 535     /**                                                                                                  </span>
<span class="4238183781809234032" onmouseenter="enter('4238183781809234032');" onmouseout="out('4238183781809234032');" style=""><abbr title=" 536      * Implementors can extend this and override this method to add additional fields to the Solr document."> 536      * Implementors can extend this and override this method to add additional fields to the Solr documenðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 537      *                                                                                                   </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 538      * @param sku                                                                                        </span>
<span class="-4531925645240977456" onmouseenter="enter('-4531925645240977456');" onmouseout="out('-4531925645240977456');" style=""> 539      * @param document                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 540      */                                                                                                  </span>
<span class="-8826176176899724303" onmouseenter="enter('-8826176176899724303');" onmouseout="out('-8826176176899724303');" style=""> 541     protected void attachAdditionalDocumentFields(Indexable indexable, SolrInputDocument document) {     </span>
<span class="2874503221562082086" onmouseenter="enter('2874503221562082086');" onmouseout="out('2874503221562082086');" style=""> 542         //Empty implementation. Placeholder for others to extend and add additional fields               </span>
<span class="6562860541481637604" onmouseenter="enter('6562860541481637604');" onmouseout="out('6562860541481637604');" style=""> 543         extensionManager.getProxy().attachAdditionalDocumentFields(indexable, document);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544     }                                                                                                    </span>
<span  style=""> 545                                                                                                          </span>
<span class="2269161038285740545" onmouseenter="enter('2269161038285740545');" onmouseout="out('2269161038285740545');" style=""> 546     protected void attachBasicDocumentFields(Indexable indexable, SolrInputDocument document) {          </span>
<span class="3677952974140195445" onmouseenter="enter('3677952974140195445');" onmouseout="out('3677952974140195445');" style=""> 547         CatalogStructure cache = SolrIndexCachedOperation.getCache();                                    </span>
<span class="3690595679967484902" onmouseenter="enter('3690595679967484902');" onmouseout="out('3690595679967484902');" style=""> 548         if (cache == null) {                                                                             </span>
<span class="-5953957341705739916" onmouseenter="enter('-5953957341705739916');" onmouseout="out('-5953957341705739916');" style=""> 549             String msg = &quot;SolrIndexService.performCachedOperation() must be used in conjuction with&quot;     </span>
<span class="5121342196990946089" onmouseenter="enter('5121342196990946089');" onmouseout="out('5121342196990946089');" style=""><abbr title=" 550                 + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog documents or should&quot;"> 550                 + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog doðŸ”µ</abbr></span>
<span class="5921421762371925976" onmouseenter="enter('5921421762371925976');" onmouseout="out('5921421762371925976');" style=""> 551                 + &quot; be invoked from buildIncrementalIndex()&quot;;                                            </span>
<span class="4339245929318812534" onmouseenter="enter('4339245929318812534');" onmouseout="out('4339245929318812534');" style=""> 552             LOG.error(msg);                                                                              </span>
<span class="86168282544735545" onmouseenter="enter('86168282544735545');" onmouseout="out('86168282544735545');" style=""> 553             throw new IllegalStateException(msg);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554         }                                                                                                </span>
<span  style=""> 555                                                                                                          </span>
<span class="-3140243218980457613" onmouseenter="enter('-3140243218980457613');" onmouseout="out('-3140243218980457613');" style=""> 556         // Add the namespace and ID fields for this product                                              </span>
<span class="-8136043564923018877" onmouseenter="enter('-8136043564923018877');" onmouseout="out('-8136043564923018877');" style=""> 557         document.addField(shs.getNamespaceFieldName(), solrConfiguration.getNamespace());                </span>
<span class="4638667037339624807" onmouseenter="enter('4638667037339624807');" onmouseout="out('4638667037339624807');" style=""> 558         document.addField(shs.getIdFieldName(), shs.getSolrDocumentId(document, indexable));             </span>
<span class="-1745274961796795631" onmouseenter="enter('-1745274961796795631');" onmouseout="out('-1745274961796795631');" style=""> 559         document.addField(shs.getTypeFieldName(), shs.getDocumentType(indexable));                       </span>
<span class="4848544160674821385" onmouseenter="enter('4848544160674821385');" onmouseout="out('4848544160674821385');" style=""> 560         document.addField(shs.getIndexableIdFieldName(), shs.getIndexableId(indexable));                 </span>
<span  style=""> 561                                                                                                          </span>
<span class="4524398296663961208" onmouseenter="enter('4524398296663961208');" onmouseout="out('4524398296663961208');" style=""> 562         extensionManager.getProxy().attachAdditionalBasicFields(indexable, document, shs);               </span>
<span  style=""> 563                                                                                                          </span>
<span class="8081444938024983637" onmouseenter="enter('8081444938024983637');" onmouseout="out('8081444938024983637');" style=""> 564         Long cacheKey = this.shs.getCurrentProductId(indexable); // current                              </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 565         if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                               </span>
<span class="1019588205807698651" onmouseenter="enter('1019588205807698651');" onmouseout="out('1019588205807698651');" style=""> 566             cacheKey = sandBoxHelper.getOriginalId(cacheKey); // parent                                  </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 567             if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                           </span>
<span class="-2582971950633728748" onmouseenter="enter('-2582971950633728748');" onmouseout="out('-2582971950633728748');" style=""> 568                 cacheKey = shs.getIndexableId(indexable); // master                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570         }                                                                                                </span>
<span  style=""> 571                                                                                                          </span>
<span class="-5777629244031949400" onmouseenter="enter('-5777629244031949400');" onmouseout="out('-5777629244031949400');" style=""> 572         // TODO: figure this out more generally; this doesn&#x27;t work for CMS content                       </span>
<span class="-6650188849299086912" onmouseenter="enter('-6650188849299086912');" onmouseout="out('-6650188849299086912');" style=""> 573         // The explicit categories are the ones defined by the product itself                            </span>
<span class="-9160995028433643624" onmouseenter="enter('-9160995028433643624');" onmouseout="out('-9160995028433643624');" style=""> 574         if (cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                </span>
<span class="4256320710674012617" onmouseenter="enter('4256320710674012617');" onmouseout="out('4256320710674012617');" style=""> 575             for (Long categoryId : cache.getParentCategoriesByProduct().get(cacheKey)) {                 </span>
<span class="8455722384905122433" onmouseenter="enter('8455722384905122433');" onmouseout="out('8455722384905122433');" style=""> 576                 document.addField(shs.getExplicitCategoryFieldName(), shs.getCategoryId(categoryId));    </span>
<span  style=""> 577                                                                                                          </span>
<span class="2226871268244895600" onmouseenter="enter('2226871268244895600');" onmouseout="out('2226871268244895600');" style=""> 578                 // Make sure that we&#x27;re always referencing the parent for the sort field                 </span>
<span class="885050313007205730" onmouseenter="enter('885050313007205730');" onmouseout="out('885050313007205730');" style=""><abbr title=" 579                 String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId));"> 579                 String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId)ðŸ”µ</abbr></span>
<span class="2056097617960887013" onmouseenter="enter('2056097617960887013');" onmouseout="out('2056097617960887013');" style=""><abbr title=" 580                 // The issue here was the super category id is always what is stored in the cache, while the category"> 580                 // The issue here was the super category id is always what is stored in the cache, while ðŸ”µ</abbr></span>
<span class="-892018914725665598" onmouseenter="enter('-892018914725665598');" onmouseout="out('-892018914725665598');" style=""><abbr title=" 581                 // by product id is the overridden versions. Need to always look at parent version for cache stuff, which"> 581                 // by product id is the overridden versions. Need to always look at parent version for caðŸ”µ</abbr></span>
<span class="-9167754401626692888" onmouseenter="enter('-9167754401626692888');" onmouseout="out('-9167754401626692888');" style=""> 582                 // is given from shs.getCategoryId                                                       </span>
<span class="-5291059882317809252" onmouseenter="enter('-5291059882317809252');" onmouseout="out('-5291059882317809252');" style=""> 583                 // First try the current level                                                           </span>
<span class="-431096296060400570" onmouseenter="enter('-431096296060400570');" onmouseout="out('-431096296060400570');" style=""> 584                 String displayOrderKey = categoryId + &quot;-&quot; + cacheKey;                                    </span>
<span class="-2136310867529994982" onmouseenter="enter('-2136310867529994982');" onmouseout="out('-2136310867529994982');" style=""> 585                 Long displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                   </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 586                 if (displayOrder == null) {                                                              </span>
<span class="-23846589771862516" onmouseenter="enter('-23846589771862516');" onmouseout="out('-23846589771862516');" style=""><abbr title=" 587                     // Didn&#x27;t find the cache at the current level, this might be an override so look upwards"> 587                     // Didn&#x27;t find the cache at the current level, this might be an override so look upwaðŸ”µ</abbr></span>
<span class="-2522276541728086971" onmouseenter="enter('-2522276541728086971');" onmouseout="out('-2522276541728086971');" style=""> 588                     displayOrderKey = shs.getCategoryId(categoryId) + &quot;-&quot; + cacheKey;                    </span>
<span class="-4225610511634364677" onmouseenter="enter('-4225610511634364677');" onmouseout="out('-4225610511634364677');" style=""> 589                     displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590                 }                                                                                        </span>
<span  style=""> 591                                                                                                          </span>
<span class="-1309608839151321080" onmouseenter="enter('-1309608839151321080');" onmouseout="out('-1309608839151321080');" style=""> 592                 if (document.getField(categorySortFieldName) == null &amp;&amp; displayOrder != null) {          </span>
<span class="-139575474281341237" onmouseenter="enter('-139575474281341237');" onmouseout="out('-139575474281341237');" style=""> 593                     document.addField(categorySortFieldName, displayOrder);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594                 }                                                                                        </span>
<span  style=""> 595                                                                                                          </span>
<span class="368279688641772108" onmouseenter="enter('368279688641772108');" onmouseout="out('368279688641772108');" style=""> 596                 // This is the entire tree of every category defined on the product                      </span>
<span class="7804252118891085182" onmouseenter="enter('7804252118891085182');" onmouseout="out('7804252118891085182');" style=""> 597                 buildFullCategoryHierarchy(document, cache, categoryId, new HashSet&lt;Long&gt;());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600     }                                                                                                    </span>
<span  style=""> 601                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 602     /**                                                                                                  </span>
<span class="6681629456063376998" onmouseenter="enter('6681629456063376998');" onmouseout="out('6681629456063376998');" style=""> 603      * Walk the category hierarchy upwards, adding a field for each level to the solr document           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 604      *                                                                                                   </span>
<span class="1689379025577151242" onmouseenter="enter('1689379025577151242');" onmouseout="out('1689379025577151242');" style=""> 605      * @param document the solr document for the product                                                 </span>
<span class="-7318706520602943649" onmouseenter="enter('-7318706520602943649');" onmouseout="out('-7318706520602943649');" style=""> 606      * @param cache the catalog structure cache                                                          </span>
<span class="-6836312806010046064" onmouseenter="enter('-6836312806010046064');" onmouseout="out('-6836312806010046064');" style=""> 607      * @param categoryId the current category id                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 608      */                                                                                                  </span>
<span class="2161311715252659768" onmouseenter="enter('2161311715252659768');" onmouseout="out('2161311715252659768');" style=""><abbr title=" 609     protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long categoryId, Set&lt;Long&gt; indexedParents) {"> 609     protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long caðŸ”µ</abbr></span>
<span class="3164345535572197299" onmouseenter="enter('3164345535572197299');" onmouseout="out('3164345535572197299');" style=""> 610         Long catIdToAdd = shs.getCategoryId(categoryId);                                                 </span>
<span  style=""> 611                                                                                                          </span>
<span class="-3890718915071250281" onmouseenter="enter('-3890718915071250281');" onmouseout="out('-3890718915071250281');" style=""> 612         Collection&lt;Object&gt; existingValues = document.getFieldValues(shs.getCategoryFieldName());         </span>
<span class="6039307398262207081" onmouseenter="enter('6039307398262207081');" onmouseout="out('6039307398262207081');" style=""> 613         if (existingValues == null || !existingValues.contains(catIdToAdd)) {                            </span>
<span class="527969679087238607" onmouseenter="enter('527969679087238607');" onmouseout="out('527969679087238607');" style=""> 614             document.addField(shs.getCategoryFieldName(), catIdToAdd);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615         }                                                                                                </span>
<span  style=""> 616                                                                                                          </span>
<span class="6863771221853966476" onmouseenter="enter('6863771221853966476');" onmouseout="out('6863771221853966476');" style=""> 617         Set&lt;Long&gt; parents = cache.getParentCategoriesByCategory().get(categoryId);                       </span>
<span class="-2911148901929748808" onmouseenter="enter('-2911148901929748808');" onmouseout="out('-2911148901929748808');" style=""> 618         for (Long parent : parents) {                                                                    </span>
<span class="-7460726028904993058" onmouseenter="enter('-7460726028904993058');" onmouseout="out('-7460726028904993058');" style=""> 619             if (!indexedParents.contains(parent)) {                                                      </span>
<span class="7294571508456102427" onmouseenter="enter('7294571508456102427');" onmouseout="out('7294571508456102427');" style=""> 620                 indexedParents.add(parent);                                                              </span>
<span class="-1881502435741878283" onmouseenter="enter('-1881502435741878283');" onmouseout="out('-1881502435741878283');" style=""> 621                 buildFullCategoryHierarchy(document, cache, parent, indexedParents);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 623         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624     }                                                                                                    </span>
<span  style=""> 625                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 626     /**                                                                                                  </span>
<span class="-4462927116106886000" onmouseenter="enter('-4462927116106886000');" onmouseout="out('-4462927116106886000');" style=""><abbr title=" 627      * Returns a map of prefix to value for the requested attributes. For example, if the requested field corresponds to"> 627      * Returns a map of prefix to value for the requested attributes. For example, if the requested fieldðŸ”µ</abbr></span>
<span class="-4378589169221473186" onmouseenter="enter('-4378589169221473186');" onmouseout="out('-4378589169221473186');" style=""><abbr title=" 628      * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting map could be"> 628      * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 629      *                                                                                                   </span>
<span class="4965494886678626130" onmouseenter="enter('4965494886678626130');" onmouseout="out('4965494886678626130');" style=""> 630      * { &quot;en_US&quot; : &quot;A description&quot;,                                                                      </span>
<span class="-259254215439445341" onmouseenter="enter('-259254215439445341');" onmouseout="out('-259254215439445341');" style=""> 631      *   &quot;es_ES&quot; : &quot;Una descripcion&quot; }                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 632      *                                                                                                   </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 633      * @param product                                                                                    </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 634      * @param sku                                                                                        </span>
<span class="-2810227465158556501" onmouseenter="enter('-2810227465158556501');" onmouseout="out('-2810227465158556501');" style=""> 635      * @param field                                                                                      </span>
<span class="8333989749186698144" onmouseenter="enter('8333989749186698144');" onmouseout="out('8333989749186698144');" style=""> 636      * @param fieldType                                                                                  </span>
<span class="4196076978965854681" onmouseenter="enter('4196076978965854681');" onmouseout="out('4196076978965854681');" style=""> 637      * @param locales                                                                                    </span>
<span class="8270246261244700409" onmouseenter="enter('8270246261244700409');" onmouseout="out('8270246261244700409');" style=""> 638      * @return the value of the property                                                                 </span>
<span class="8083004877096205463" onmouseenter="enter('8083004877096205463');" onmouseout="out('8083004877096205463');" style=""> 639      * @throws IllegalAccessException                                                                    </span>
<span class="-5812785901555574031" onmouseenter="enter('-5812785901555574031');" onmouseout="out('-5812785901555574031');" style=""> 640      * @throws InvocationTargetException                                                                 </span>
<span class="-7952440753472318794" onmouseenter="enter('-7952440753472318794');" onmouseout="out('-7952440753472318794');" style=""> 641      * @throws NoSuchMethodException                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 642      */                                                                                                  </span>
<span class="8748893838745138853" onmouseenter="enter('8748893838745138853');" onmouseout="out('8748893838745138853');" style=""><abbr title=" 643     protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldType, List&lt;Locale&gt; locales)"> 643     protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldTyðŸ”µ</abbr></span>
<span class="1769827535532852924" onmouseenter="enter('1769827535532852924');" onmouseout="out('1769827535532852924');" style=""> 644             throws IllegalAccessException, InvocationTargetException, NoSuchMethodException {            </span>
<span  style=""> 645                                                                                                          </span>
<span class="6107905045905939603" onmouseenter="enter('6107905045905939603');" onmouseout="out('6107905045905939603');" style=""> 646         String propertyName = field.getPropertyName();                                                   </span>
<span class="-4589490168925589742" onmouseenter="enter('-4589490168925589742');" onmouseout="out('-4589490168925589742');" style=""> 647         Map&lt;String, Object&gt; values = new HashMap&lt;&gt;();                                                    </span>
<span  style=""> 648                                                                                                          </span>
<span class="6659346108356717008" onmouseenter="enter('6659346108356717008');" onmouseout="out('6659346108356717008');" style=""> 649         ExtensionResultStatusType extensionResult = ExtensionResultStatusType.NOT_HANDLED;               </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 650         if (extensionManager != null) {                                                                  </span>
<span class="-9204729919056407683" onmouseenter="enter('-9204729919056407683');" onmouseout="out('-9204729919056407683');" style=""><abbr title=" 651             extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldType, values, propertyName, locales);"> 651             extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldTypeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652         }                                                                                                </span>
<span  style=""> 653                                                                                                          </span>
<span class="978300925065413292" onmouseenter="enter('978300925065413292');" onmouseout="out('978300925065413292');" style=""> 654         if (ExtensionResultStatusType.NOT_HANDLED.equals(extensionResult)) {                             </span>
<span class="-4780873355376927780" onmouseenter="enter('-4780873355376927780');" onmouseout="out('-4780873355376927780');" style=""> 655             Object propertyValue = shs.getPropertyValue(indexedItem, field);                             </span>
<span class="-3197092395980898064" onmouseenter="enter('-3197092395980898064');" onmouseout="out('-3197092395980898064');" style=""> 656             if (propertyValue != null) {                                                                 </span>
<span class="2260924254129751704" onmouseenter="enter('2260924254129751704');" onmouseout="out('2260924254129751704');" style=""> 657                 values.put(&quot;&quot;, propertyValue);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659         }                                                                                                </span>
<span  style=""> 660                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 661         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662     }                                                                                                    </span>
<span  style=""> 663                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 664     /**                                                                                                  </span>
<span class="9061850100512653526" onmouseenter="enter('9061850100512653526');" onmouseout="out('9061850100512653526');" style=""><abbr title=" 665      * Converts a propertyName to one that is able to reference inside a map. For example, consider the property"> 665      * Converts a propertyName to one that is able to reference inside a map. For example, consider the pðŸ”µ</abbr></span>
<span class="-895456647484563444" onmouseenter="enter('-895456647484563444');" onmouseout="out('-895456647484563444');" style=""><abbr title=" 666      * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utility method"> 666      * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utilitðŸ”µ</abbr></span>
<span class="-552833576006343516" onmouseenter="enter('-552833576006343516');" onmouseout="out('-552833576006343516');" style=""><abbr title=" 667      * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed by the name"> 667      * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed byðŸ”µ</abbr></span>
<span class="825713137907557548" onmouseenter="enter('825713137907557548');" onmouseout="out('825713137907557548');" style=""><abbr title=" 668      * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttributes&quot;,"> 668      * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttrðŸ”µ</abbr></span>
<span class="-5368406654183806848" onmouseenter="enter('-5368406654183806848');" onmouseout="out('-5368406654183806848');" style=""><abbr title=" 669      * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; that"> 669      * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; tðŸ”µ</abbr></span>
<span class="2947641499517828088" onmouseenter="enter('2947641499517828088');" onmouseout="out('2947641499517828088');" style=""><abbr title=" 670      * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatRange&quot;,"> 670      * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatðŸ”µ</abbr></span>
<span class="-7978269712217451802" onmouseenter="enter('-7978269712217451802');" onmouseout="out('-7978269712217451802');" style=""><abbr title=" 671      * this method will convert this property to mappedProductAttributes(heatRange).value, which is then usable"> 671      * this method will convert this property to mappedProductAttributes(heatRange).value, which is then ðŸ”µ</abbr></span>
<span class="2645537127888120036" onmouseenter="enter('2645537127888120036');" onmouseout="out('2645537127888120036');" style=""> 672      * by the standard beanutils PropertyUtils class to get the value.                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 673      *                                                                                                   </span>
<span class="-7192310373251332281" onmouseenter="enter('-7192310373251332281');" onmouseout="out('-7192310373251332281');" style=""> 674      * @param propertyName                                                                               </span>
<span class="4673892841275975431" onmouseenter="enter('4673892841275975431');" onmouseout="out('4673892841275975431');" style=""> 675      * @param listPropertyName                                                                           </span>
<span class="-3179260629250258297" onmouseenter="enter('-3179260629250258297');" onmouseout="out('-3179260629250258297');" style=""> 676      * @param mapPropertyName                                                                            </span>
<span class="3476440775818037910" onmouseenter="enter('3476440775818037910');" onmouseout="out('3476440775818037910');" style=""> 677      * @return the converted property name                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 678      *                                                                                                   </span>
<span class="52899359164217029" onmouseenter="enter('52899359164217029');" onmouseout="out('52899359164217029');" style=""> 679      * @deprecated see SolrHelperService.getPropertyValue()                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 680      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 681     @Deprecated                                                                                          </span>
<span class="-8166943252759778933" onmouseenter="enter('-8166943252759778933');" onmouseout="out('-8166943252759778933');" style=""><abbr title=" 682     protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropertyName) {"> 682     protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropðŸ”µ</abbr></span>
<span class="1454213590133189928" onmouseenter="enter('1454213590133189928');" onmouseout="out('1454213590133189928');" style=""> 683         String[] splitName = StringUtils.split(propertyName, &quot;\\.&quot;);                                     </span>
<span class="8763032247946290041" onmouseenter="enter('8763032247946290041');" onmouseout="out('8763032247946290041');" style=""> 684         StringBuilder convertedProperty = new StringBuilder();                                           </span>
<span class="6897833212568273038" onmouseenter="enter('6897833212568273038');" onmouseout="out('6897833212568273038');" style=""> 685         for (int i = 0; i &lt; splitName.length; i++) {                                                     </span>
<span class="7476336611017662047" onmouseenter="enter('7476336611017662047');" onmouseout="out('7476336611017662047');" style=""> 686             if (convertedProperty.length() &gt; 0) {                                                        </span>
<span class="3942759274962034898" onmouseenter="enter('3942759274962034898');" onmouseout="out('3942759274962034898');" style=""> 687                 convertedProperty.append(&quot;.&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 688             }                                                                                            </span>
<span  style=""> 689                                                                                                          </span>
<span class="-5101250235350090861" onmouseenter="enter('-5101250235350090861');" onmouseout="out('-5101250235350090861');" style=""> 690             if (splitName[i].equals(listPropertyName)) {                                                 </span>
<span class="5747881404112979701" onmouseenter="enter('5747881404112979701');" onmouseout="out('5747881404112979701');" style=""> 691                 convertedProperty.append(mapPropertyName).append(&quot;(&quot;);                                   </span>
<span class="-4744112788117022497" onmouseenter="enter('-4744112788117022497');" onmouseout="out('-4744112788117022497');" style=""> 692                 convertedProperty.append(splitName[i + 1]).append(&quot;).value&quot;);                            </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 693                 i++;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 694             } else {                                                                                     </span>
<span class="-2902127022925554102" onmouseenter="enter('-2902127022925554102');" onmouseout="out('-2902127022925554102');" style=""> 695                 convertedProperty.append(splitName[i]);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697         }                                                                                                </span>
<span class="5092332446699272394" onmouseenter="enter('5092332446699272394');" onmouseout="out('5092332446699272394');" style=""> 698         return convertedProperty.toString();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699     }                                                                                                    </span>
<span  style=""> 700                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 701     @Override                                                                                            </span>
<span class="-3936693135713622895" onmouseenter="enter('-3936693135713622895');" onmouseout="out('-3936693135713622895');" style=""> 702     public Object[] saveState() {                                                                        </span>
<span class="6340072029414808943" onmouseenter="enter('6340072029414808943');" onmouseout="out('6340072029414808943');" style=""> 703          return new Object[] {                                                                           </span>
<span class="-1198820822862086393" onmouseenter="enter('-1198820822862086393');" onmouseout="out('-1198820822862086393');" style=""> 704              BroadleafRequestContext.getBroadleafRequestContext(),                                       </span>
<span class="4468406610576348115" onmouseenter="enter('4468406610576348115');" onmouseout="out('4468406610576348115');" style=""> 705              SkuPricingConsiderationContext.getSkuPricingConsiderationContext(),                         </span>
<span class="-4551736393079008426" onmouseenter="enter('-4551736393079008426');" onmouseout="out('-4551736393079008426');" style=""> 706              SkuPricingConsiderationContext.getSkuPricingService(),                                      </span>
<span class="3011904497645750283" onmouseenter="enter('3011904497645750283');" onmouseout="out('3011904497645750283');" style=""> 707              SkuActiveDateConsiderationContext.getSkuActiveDatesService()                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 708          };                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709      }                                                                                                   </span>
<span  style=""> 710                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 711     @Override                                                                                            </span>
<span class="-1725049255621638202" onmouseenter="enter('-1725049255621638202');" onmouseout="out('-1725049255621638202');" style=""> 712     @SuppressWarnings(&quot;rawtypes&quot;)                                                                        </span>
<span class="-799181704487695614" onmouseenter="enter('-799181704487695614');" onmouseout="out('-799181704487695614');" style=""> 713     public void restoreState(Object[] pack) {                                                            </span>
<span class="5773741038987480013" onmouseenter="enter('5773741038987480013');" onmouseout="out('5773741038987480013');" style=""> 714          BroadleafRequestContext.setBroadleafRequestContext((BroadleafRequestContext) pack[0]);          </span>
<span class="-7019853679694091506" onmouseenter="enter('-7019853679694091506');" onmouseout="out('-7019853679694091506');" style=""> 715          SkuPricingConsiderationContext.setSkuPricingConsiderationContext((HashMap) pack[1]);            </span>
<span class="4085014913476561326" onmouseenter="enter('4085014913476561326');" onmouseout="out('4085014913476561326');" style=""> 716          SkuPricingConsiderationContext.setSkuPricingService((DynamicSkuPricingService) pack[2]);        </span>
<span class="-8007069714826871365" onmouseenter="enter('-8007069714826871365');" onmouseout="out('-8007069714826871365');" style=""><abbr title=" 717          SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3]);"> 717          SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718      }                                                                                                   </span>
<span  style=""> 719                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 720     @Override                                                                                            </span>
<span class="-9091641891346182972" onmouseenter="enter('-9091641891346182972');" onmouseout="out('-9091641891346182972');" style=""><abbr title=" 721     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException {"> 721     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException ðŸ”µ</abbr></span>
<span class="-2539995639166621773" onmouseenter="enter('-2539995639166621773');" onmouseout="out('-2539995639166621773');" style=""> 722         shs.optimizeIndex(collection, server);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723     }                                                                                                    </span>
<span  style=""> 724                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 725     @Override                                                                                            </span>
<span class="7341867013968379883" onmouseenter="enter('7341867013968379883');" onmouseout="out('7341867013968379883');" style=""> 726     public void commit(String collection, SolrClient server) throws ServiceException, IOException {      </span>
<span class="7675894021553797865" onmouseenter="enter('7675894021553797865');" onmouseout="out('7675894021553797865');" style=""> 727         if (this.commit) {                                                                               </span>
<span class="-6090512425803845008" onmouseenter="enter('-6090512425803845008');" onmouseout="out('-6090512425803845008');" style=""> 728             commit(collection, server, this.softCommit, this.waitSearcher, this.waitFlush);              </span>
<span class="6963313292914152592" onmouseenter="enter('6963313292914152592');" onmouseout="out('6963313292914152592');" style=""> 729         } else if (LOG.isDebugEnabled()) {                                                               </span>
<span class="1765076834887086466" onmouseenter="enter('1765076834887086466');" onmouseout="out('1765076834887086466');" style=""><abbr title=" 730             LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoCommit is configured.&quot;);"> 730             LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoComðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732     }                                                                                                    </span>
<span  style=""> 733                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 734     @Override                                                                                            </span>
<span class="-5625380272333943282" onmouseenter="enter('-5625380272333943282');" onmouseout="out('-5625380272333943282');" style=""><abbr title=" 735     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 735     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 736         try {                                                                                            </span>
<span class="897708696444656733" onmouseenter="enter('897708696444656733');" onmouseout="out('897708696444656733');" style=""> 737             if (!this.commit) {                                                                          </span>
<span class="9109442794169141002" onmouseenter="enter('9109442794169141002');" onmouseout="out('9109442794169141002');" style=""><abbr title=" 738                 LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is being forced via the API.&quot;);"> 738                 LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is beingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739             }                                                                                            </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 740             if (LOG.isDebugEnabled()) {                                                                  </span>
<span class="8059632572901695123" onmouseenter="enter('8059632572901695123');" onmouseout="out('8059632572901695123');" style=""><abbr title=" 741                 LOG.debug(((((&quot;Committing changes to Solr index: softCommit: &quot; + softCommit) + &quot;, waitSearcher: &quot;) + waitSearcher) + &quot;, waitFlush: &quot;) + waitFlush);"> 741                 LOG.debug(((((&quot;Committing changes to Solr index: softCommit: &quot; + softCommit) + &quot;, waitSeaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 742             }                                                                                            </span>
<span class="-4946339855213882534" onmouseenter="enter('-4946339855213882534');" onmouseout="out('-4946339855213882534');" style=""> 743             server.commit(collection, waitFlush, waitSearcher, softCommit);                              </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 744         } catch (SolrServerException e) {                                                                </span>
<span class="6480332907391821448" onmouseenter="enter('6480332907391821448');" onmouseout="out('6480332907391821448');" style=""> 745             throw new ServiceException(&quot;Could not commit changes to Solr index&quot;, e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747     }                                                                                                    </span>
<span  style=""> 748                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 749     @Override                                                                                            </span>
<span class="-235343663931086975" onmouseenter="enter('-235343663931086975');" onmouseout="out('-235343663931086975');" style=""> 750     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents) {                                  </span>
<span class="1446253227197554536" onmouseenter="enter('1446253227197554536');" onmouseout="out('1446253227197554536');" style=""> 751         if (LOG.isTraceEnabled()) {                                                                      </span>
<span class="-4118597588854644187" onmouseenter="enter('-4118597588854644187');" onmouseout="out('-4118597588854644187');" style=""> 752             for (SolrInputDocument document : documents) {                                               </span>
<span class="3338392633918275305" onmouseenter="enter('3338392633918275305');" onmouseout="out('3338392633918275305');" style=""> 753                 LOG.trace(document);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 754             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 756     }                                                                                                    </span>
<span  style=""> 757                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 758     /**                                                                                                  </span>
<span class="-4161606046612334483" onmouseenter="enter('-4161606046612334483');" onmouseout="out('-4161606046612334483');" style=""> 759      *  We multiply the BigDecimal by 1,000,000 to maintain any possible decimals in use the             </span>
<span class="1095534727201270293" onmouseenter="enter('1095534727201270293');" onmouseout="out('1095534727201270293');" style=""> 760      *  displayOrder value.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 761      *                                                                                                   </span>
<span class="1237233419561726312" onmouseenter="enter('1237233419561726312');" onmouseout="out('1237233419561726312');" style=""> 762      * @param cache                                                                                      </span>
<span class="-4411905951100486196" onmouseenter="enter('-4411905951100486196');" onmouseout="out('-4411905951100486196');" style=""> 763      * @param displayOrderKey                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 764      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 765      */                                                                                                  </span>
<span class="1635922478501180747" onmouseenter="enter('1635922478501180747');" onmouseout="out('1635922478501180747');" style=""> 766     protected Long convertDisplayOrderToLong(CatalogStructure cache, String displayOrderKey) {           </span>
<span class="4518367233651177280" onmouseenter="enter('4518367233651177280');" onmouseout="out('4518367233651177280');" style=""> 767         BigDecimal displayOrder = cache.getDisplayOrdersByCategoryProduct().get(displayOrderKey);        </span>
<span  style=""> 768                                                                                                          </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 769         if (displayOrder == null) {                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 770             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771         }                                                                                                </span>
<span  style=""> 772                                                                                                          </span>
<span class="4133773492119237930" onmouseenter="enter('4133773492119237930');" onmouseout="out('4133773492119237930');" style=""> 773         return displayOrder.multiply(BigDecimal.valueOf(1000000)).longValue();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774     }                                                                                                    </span>
<span  style=""> 775                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 776     @Override                                                                                            </span>
<span class="4004348612697349075" onmouseenter="enter('4004348612697349075');" onmouseout="out('4004348612697349075');" style=""> 777     public void deleteByQuery(String deleteQuery) throws SolrServerException, IOException {              </span>
<span class="4944934858120936257" onmouseenter="enter('4944934858120936257');" onmouseout="out('4944934858120936257');" style=""> 778         String productFilter = (shs.getTypeFieldName() + &quot;:&quot;) + shs.getPrimaryDocumentType();            </span>
<span class="1739252735366935461" onmouseenter="enter('1739252735366935461');" onmouseout="out('1739252735366935461');" style=""><abbr title=" 779         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t delete non-product documents accidentally"> 779         // transform the deleteQuery to include the productFilter, this is necessary to ensure that we doðŸ”µ</abbr></span>
<span class="5118504468997566084" onmouseenter="enter('5118504468997566084');" onmouseout="out('5118504468997566084');" style=""> 780         deleteQuery = ((productFilter + &quot; AND (&quot;) + deleteQuery) + &quot;)&quot;;                                  </span>
<span class="7715974130806711064" onmouseenter="enter('7715974130806711064');" onmouseout="out('7715974130806711064');" style=""> 781         String childDeleteQuery = ((&quot;{!child of=&quot; + productFilter) + &quot;} &quot;) + deleteQuery;                </span>
<span class="-5958139659148111368" onmouseenter="enter('-5958139659148111368');" onmouseout="out('-5958139659148111368');" style=""><abbr title=" 782         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), childDeleteQuery);"> 782         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), childDeleðŸ”µ</abbr></span>
<span class="870065906158081107" onmouseenter="enter('870065906158081107');" onmouseout="out('870065906158081107');" style=""><abbr title=" 783         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), deleteQuery);"> 783         solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), deleteQueðŸ”µ</abbr></span>
<span class="2572292351348869388" onmouseenter="enter('2572292351348869388');" onmouseout="out('2572292351348869388');" style=""> 784         logDeleteQuery(childDeleteQuery);                                                                </span>
<span class="-7276176933862949274" onmouseenter="enter('-7276176933862949274');" onmouseout="out('-7276176933862949274');" style=""> 785         logDeleteQuery(deleteQuery);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786     }                                                                                                    </span>
<span  style=""> 787                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 788     @Override                                                                                            </span>
<span class="-7948321486753422000" onmouseenter="enter('-7948321486753422000');" onmouseout="out('-7948321486753422000');" style=""><abbr title=" 789     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException {"> 789     public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerExcepðŸ”µ</abbr></span>
<span class="-1557641774356947070" onmouseenter="enter('-1557641774356947070');" onmouseout="out('-1557641774356947070');" style=""> 790         solrConfiguration.getServer().add(solrConfiguration.getQueryCollectionName(), documents);        </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 791         logDocuments(documents);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792     }                                                                                                    </span>
<span  style=""> 793                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 794     @Override                                                                                            </span>
<span class="5429697153738572572" onmouseenter="enter('5429697153738572572');" onmouseout="out('5429697153738572572');" style=""> 795     public void logDeleteQuery(String deleteQuery) {                                                     </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 796         if (LOG.isDebugEnabled()) {                                                                      </span>
<span class="1652863876971966554" onmouseenter="enter('1652863876971966554');" onmouseout="out('1652863876971966554');" style=""> 797             LOG.debug(&quot;Delete query: &quot; + deleteQuery);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799     }                                                                                                    </span>
<span  style=""> 800                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 801     @Override                                                                                            </span>
<span class="8474819187366488777" onmouseenter="enter('8474819187366488777');" onmouseout="out('8474819187366488777');" style=""><abbr title=" 802     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 802     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrðŸ”µ</abbr></span>
<span class="1797277787154549011" onmouseenter="enter('1797277787154549011');" onmouseout="out('1797277787154549011');" style=""> 803         return buildIncrementalIndex(null, indexables, solrServer);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804     }                                                                                                    </span>
<span  style=""> 805                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 806     @Override                                                                                            </span>
<span class="3365555763697732929" onmouseenter="enter('3365555763697732929');" onmouseout="out('3365555763697732929');" style=""> 807     public void optimizeIndex(SolrClient server) throws ServiceException, IOException {                  </span>
<span class="-604246973254031119" onmouseenter="enter('-604246973254031119');" onmouseout="out('-604246973254031119');" style=""> 808         optimizeIndex(null, server);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809     }                                                                                                    </span>
<span  style=""> 810                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 811     @Override                                                                                            </span>
<span class="8022176589656897042" onmouseenter="enter('8022176589656897042');" onmouseout="out('8022176589656897042');" style=""> 812     public void commit(SolrClient server) throws ServiceException, IOException {                         </span>
<span class="8538330963534152673" onmouseenter="enter('8538330963534152673');" onmouseout="out('8538330963534152673');" style=""> 813         commit(null, server);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814     }                                                                                                    </span>
<span  style=""> 815                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 816     @Override                                                                                            </span>
<span class="4402093086393350326" onmouseenter="enter('4402093086393350326');" onmouseout="out('4402093086393350326');" style=""><abbr title=" 817     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 817     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) thðŸ”µ</abbr></span>
<span class="-6149532067307109215" onmouseenter="enter('-6149532067307109215');" onmouseout="out('-6149532067307109215');" style=""> 818         commit(null, server, softCommit, waitSearcher, waitFlush);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819     }                                                                                                    </span>
<span  style=""> 820                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 821     @Override                                                                                            </span>
<span class="125965368563769580" onmouseenter="enter('125965368563769580');" onmouseout="out('125965368563769580');" style=""> 822     public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException {                 </span>
<span class="-6644416202801761209" onmouseenter="enter('-6644416202801761209');" onmouseout="out('-6644416202801761209');" style=""> 823         deleteAllNamespaceDocuments(null, server);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824     }                                                                                                    </span>
<span  style=""> 825                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 826     @Override                                                                                            </span>
<span class="31475417648561827" onmouseenter="enter('31475417648561827');" onmouseout="out('31475417648561827');" style=""> 827     public void deleteAllDocuments(SolrClient server) throws ServiceException {                          </span>
<span class="6597141509256723624" onmouseenter="enter('6597141509256723624');" onmouseout="out('6597141509256723624');" style=""> 828         deleteAllDocuments(null, server);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829     }                                                                                                    </span>
<span  style=""> 830                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 831     @Override                                                                                            </span>
<span class="-7107052052553344125" onmouseenter="enter('-7107052052553344125');" onmouseout="out('-7107052052553344125');" style=""> 832     public boolean useLegacyIndexer() {                                                                  </span>
<span class="-518627155049265606" onmouseenter="enter('-518627155049265606');" onmouseout="out('-518627155049265606');" style=""> 833         return useLegacySolrIndexer;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835 }                                                                                                        </span>











































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="1122494097902733579" onmouseenter="enter('1122494097902733579');" onmouseout="out('1122494097902733579');" style="">  18  package org.broadleafcommerce.core.search.service.solr.index;                                                     </span>
<span  style="">  19                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="7358117227230759843" onmouseenter="enter('7358117227230759843');" onmouseout="out('7358117227230759843');" style="">  21  import org.apache.commons.lang3.ObjectUtils;                                                                      </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="5774725166806839225" onmouseenter="enter('5774725166806839225');" onmouseout="out('5774725166806839225');" style="">  25  import org.apache.solr.client.solrj.SolrClient;                                                                   </span>
<span class="2534520300286315365" onmouseenter="enter('2534520300286315365');" onmouseout="out('2534520300286315365');" style="">  26  import org.apache.solr.client.solrj.SolrServerException;                                                          </span>
<span class="3039478051879307902" onmouseenter="enter('3039478051879307902');" onmouseout="out('3039478051879307902');" style="">  27  import org.apache.solr.common.SolrInputDocument;                                                                  </span>
<span class="-5062615271713994505" onmouseenter="enter('-5062615271713994505');" onmouseout="out('-5062615271713994505');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import org.apache.solr.common.SolrInputField;                                                                     </span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  29  import org.broadleafcommerce.common.exception.ExceptionHelper;                                                    </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  30  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  31  import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                          </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  32  import org.broadleafcommerce.common.locale.domain.Locale;                                                         </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  33  import org.broadleafcommerce.common.locale.service.LocaleService;                                                 </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  34  import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                                        </span>
<span class="-4286566313930798693" onmouseenter="enter('-4286566313930798693');" onmouseout="out('-4286566313930798693');" style="">  35  import org.broadleafcommerce.common.site.domain.Catalog;                                                          </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  36  import org.broadleafcommerce.common.util.BLCCollectionUtils;                                                      </span>
<span class="-8450438836187654019" onmouseenter="enter('-8450438836187654019');" onmouseout="out('-8450438836187654019');" style="">  37  import org.broadleafcommerce.common.util.StopWatch;                                                               </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  38  import org.broadleafcommerce.common.util.StringUtil;                                                              </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  39  import org.broadleafcommerce.common.util.TransactionUtils;                                                        </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  40  import org.broadleafcommerce.common.util.TypedTransformer;                                                        </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  41  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="-4682247906377627479" onmouseenter="enter('-4682247906377627479');" onmouseout="out('-4682247906377627479');" style="">  42  import org.broadleafcommerce.core.catalog.dao.ProductDao;                                                         </span>
<span class="-7703274845132439467" onmouseenter="enter('-7703274845132439467');" onmouseout="out('-7703274845132439467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -import org.broadleafcommerce.core.catalog.dao.SkuDao;                                                             </span>
<span class="819600147337546609" onmouseenter="enter('819600147337546609');" onmouseout="out('819600147337546609');" style="">  44  import org.broadleafcommerce.core.catalog.domain.Indexable;                                                       </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                                   </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  47  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="-8898703314888663548" onmouseenter="enter('-8898703314888663548');" onmouseout="out('-8898703314888663548');" style="">  48  import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuActiveDatesService;                           </span>
<span class="4379279529485441894" onmouseenter="enter('4379279529485441894');" onmouseout="out('4379279529485441894');" style="">  49  import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuPricingService;                               </span>
<span class="-3681422864492833385" onmouseenter="enter('-3681422864492833385');" onmouseout="out('-3681422864492833385');" style="">  50  import org.broadleafcommerce.core.catalog.service.dynamic.SkuActiveDateConsiderationContext;                      </span>
<span class="-829094426310214064" onmouseenter="enter('-829094426310214064');" onmouseout="out('-829094426310214064');" style="">  51  import org.broadleafcommerce.core.catalog.service.dynamic.SkuPricingConsiderationContext;                         </span>
<span class="-1576266836408736884" onmouseenter="enter('-1576266836408736884');" onmouseout="out('-1576266836408736884');" style="">  52  import org.broadleafcommerce.core.search.dao.CatalogStructure;                                                    </span>
<span class="3400766289256993125" onmouseenter="enter('3400766289256993125');" onmouseout="out('3400766289256993125');" style="">  53  import org.broadleafcommerce.core.search.dao.FieldDao;                                                            </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  54  import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                                       </span>
<span class="920426074093689209" onmouseenter="enter('920426074093689209');" onmouseout="out('920426074093689209');" style="">  55  import org.broadleafcommerce.core.search.dao.SearchFacetDao;                                                      </span>
<span class="-5322157128750858217" onmouseenter="enter('-5322157128750858217');" onmouseout="out('-5322157128750858217');" style="">  56  import org.broadleafcommerce.core.search.dao.SolrIndexDao;                                                        </span>
<span class="4766648382130970293" onmouseenter="enter('4766648382130970293');" onmouseout="out('4766648382130970293');" style="">  57  import org.broadleafcommerce.core.search.domain.Field;                                                            </span>
<span class="-5357326536069928479" onmouseenter="enter('-5357326536069928479');" onmouseout="out('-5357326536069928479');" style="">  58  import org.broadleafcommerce.core.search.domain.FieldEntity;                                                      </span>
<span class="6698299629643684636" onmouseenter="enter('6698299629643684636');" onmouseout="out('6698299629643684636');" style="">  59  import org.broadleafcommerce.core.search.domain.IndexField;                                                       </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  60  import org.broadleafcommerce.core.search.domain.IndexFieldType;                                                   </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  61  import org.broadleafcommerce.core.search.domain.solr.FieldType;                                                   </span>
<span class="5698008419148469327" onmouseenter="enter('5698008419148469327');" onmouseout="out('5698008419148469327');" style="">  62  import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;                                          </span>
<span class="1831820877510608733" onmouseenter="enter('1831820877510608733');" onmouseout="out('1831820877510608733');" style="">  63  import org.broadleafcommerce.core.search.service.solr.SolrHelperService;                                          </span>

<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  64  import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  65  import org.springframework.beans.factory.annotation.Qualifier;                                                    </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  66  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  67  import org.springframework.stereotype.Service;                                                                    </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  68  import org.springframework.transaction.PlatformTransactionManager;                                                </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  69  import org.springframework.transaction.TransactionDefinition;                                                     </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  70  import org.springframework.transaction.TransactionStatus;                                                         </span>
<span  style="">  71                                                                                                                    </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  72  import java.io.IOException;                                                                                       </span>
<span class="5727252987923913" onmouseenter="enter('5727252987923913');" onmouseout="out('5727252987923913');" style="">  73  import java.lang.reflect.InvocationTargetException;                                                               </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  74  import java.math.BigDecimal;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  75  import java.util.ArrayList;                                                                                       </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  76  import java.util.Collection;                                                                                      </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  77  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  78  import java.util.HashSet;                                                                                         </span>
<span class="5562422284534979298" onmouseenter="enter('5562422284534979298');" onmouseout="out('5562422284534979298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +import java.util.LinkedHashMap;                                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  80  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  81  import java.util.Map;                                                                                             </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  82  import java.util.Map.Entry;                                                                                       </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  83  import java.util.Set;                                                                                             </span>
<span  style="">  84                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  85  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  86                                                                                                                    </span>
<span  style="">  87                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  88  /**                                                                                                               </span>
<span class="2637600201222846009" onmouseenter="enter('2637600201222846009');" onmouseout="out('2637600201222846009');" style="">  89   * Responsible for building and rebuilding the Solr index                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  90   *                                                                                                                </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  91   * @author Andre Azzolini (apazzolini)                                                                            </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  92   * @author Jeff Fischer                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93   */                                                                                                               </span>
<span class="5147427781650963861" onmouseenter="enter('5147427781650963861');" onmouseout="out('5147427781650963861');" style="">  94  @Service(&quot;blSolrIndexService&quot;)                                                                                    </span>
<span class="-304032367336242137" onmouseenter="enter('-304032367336242137');" onmouseout="out('-304032367336242137');" style="">  95  public class SolrIndexServiceImpl implements SolrIndexService {                                                   </span>

<span  style="">  96                                                                                                                    </span>
<span class="2912831792317267849" onmouseenter="enter('2912831792317267849');" onmouseout="out('2912831792317267849');" style="">  97      private static final Log LOG = LogFactory.getLog(SolrIndexServiceImpl.class);                                 </span>
<span  style="">  98                                                                                                                    </span>
<span class="-8977974913293567232" onmouseenter="enter('-8977974913293567232');" onmouseout="out('-8977974913293567232');" style="">  99      @Qualifier(&quot;blCatalogSolrConfiguration&quot;)                                                                      </span>
<span class="2602789178515286342" onmouseenter="enter('2602789178515286342');" onmouseout="out('2602789178515286342');" style=""> 100      @Autowired(required = false)                                                                                  </span>
<span class="-8579597795724805463" onmouseenter="enter('-8579597795724805463');" onmouseout="out('-8579597795724805463');" style=""> 101      protected SolrConfiguration solrConfiguration;                                                                </span>
<span  style=""> 102                                                                                                                    </span>
<span class="2195771720820037705" onmouseenter="enter('2195771720820037705');" onmouseout="out('2195771720820037705');" style=""> 103      @Value(&quot;${solr.index.errorOnConcurrentReIndex}&quot;)                                                              </span>
<span class="-1712197847076792635" onmouseenter="enter('-1712197847076792635');" onmouseout="out('-1712197847076792635');" style=""> 104      protected boolean errorOnConcurrentReIndex = false;                                                           </span>
<span  style=""> 105                                                                                                                    </span>
<span class="7048903042822364298" onmouseenter="enter('7048903042822364298');" onmouseout="out('7048903042822364298');" style=""> 106      @Value(&quot;${solr.index.product.pageSize}&quot;)                                                                      </span>
<span class="-4484811886017880292" onmouseenter="enter('-4484811886017880292');" onmouseout="out('-4484811886017880292');" style=""> 107      protected int pageSize;                                                                                       </span>
<span  style=""> 108                                                                                                                    </span>
<span class="-7778680861452564194" onmouseenter="enter('-7778680861452564194');" onmouseout="out('-7778680861452564194');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -    @Value(&quot;${solr.index.use.sku}&quot;)                                                                               </span>
<span class="4533755734414020763" onmouseenter="enter('4533755734414020763');" onmouseout="out('4533755734414020763');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -    protected boolean useSku;                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -                                                                                                                  </span>
<span class="8105652327274456362" onmouseenter="enter('8105652327274456362');" onmouseout="out('8105652327274456362');" style=""> 112      @Value(&quot;${solr.index.commit}&quot;)                                                                                </span>
<span class="2310160779081566815" onmouseenter="enter('2310160779081566815');" onmouseout="out('2310160779081566815');" style=""> 113      protected boolean commit;                                                                                     </span>
<span  style=""> 114                                                                                                                    </span>
<span class="4958585362396000858" onmouseenter="enter('4958585362396000858');" onmouseout="out('4958585362396000858');" style=""> 115      @Value(&quot;${solr.index.softCommit}&quot;)                                                                            </span>
<span class="-7523707349512810888" onmouseenter="enter('-7523707349512810888');" onmouseout="out('-7523707349512810888');" style=""> 116      protected boolean softCommit;                                                                                 </span>
<span  style=""> 117                                                                                                                    </span>
<span class="2752166020843058826" onmouseenter="enter('2752166020843058826');" onmouseout="out('2752166020843058826');" style=""> 118      @Value(&quot;${solr.index.waitSearcher}&quot;)                                                                          </span>
<span class="-7977681737585438995" onmouseenter="enter('-7977681737585438995');" onmouseout="out('-7977681737585438995');" style=""> 119      protected boolean waitSearcher;                                                                               </span>
<span  style=""> 120                                                                                                                    </span>
<span class="-1787870543439636120" onmouseenter="enter('-1787870543439636120');" onmouseout="out('-1787870543439636120');" style=""> 121      @Value(&quot;${solr.index.waitFlush}&quot;)                                                                             </span>
<span class="-1071744707232356027" onmouseenter="enter('-1071744707232356027');" onmouseout="out('-1071744707232356027');" style=""> 122      protected boolean waitFlush;                                                                                  </span>
<span  style=""> 123                                                                                                                    </span>



<span class="-8581768554675866702" onmouseenter="enter('-8581768554675866702');" onmouseout="out('-8581768554675866702');" style=""> 124      @Resource(name = &quot;blProductDao&quot;)                                                                              </span>
<span class="8458703512033747413" onmouseenter="enter('8458703512033747413');" onmouseout="out('8458703512033747413');" style=""> 125      protected ProductDao productDao;                                                                              </span>
<span  style=""> 126                                                                                                                    </span>
<span class="-2173743794931306759" onmouseenter="enter('-2173743794931306759');" onmouseout="out('-2173743794931306759');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -    @Resource(name = &quot;blSkuDao&quot;)                                                                                  </span>
<span class="7538466299033825182" onmouseenter="enter('7538466299033825182');" onmouseout="out('7538466299033825182');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -    protected SkuDao skuDao;                                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -                                                                                                                  </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style=""> 130      @Resource(name = &quot;blCatalogService&quot;)                                                                          </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 131      protected CatalogService catalogService;                                                                      </span>
<span  style=""> 132                                                                                                                    </span>
<span class="8745422771459947563" onmouseenter="enter('8745422771459947563');" onmouseout="out('8745422771459947563');" style=""> 133      @Resource(name = &quot;blFieldDao&quot;)                                                                                </span>
<span class="-5779425042369505145" onmouseenter="enter('-5779425042369505145');" onmouseout="out('-5779425042369505145');" style=""> 134      protected FieldDao fieldDao;                                                                                  </span>
<span  style=""> 135                                                                                                                    </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style=""> 136      @Resource(name = &quot;blLocaleService&quot;)                                                                           </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style=""> 137      protected LocaleService localeService;                                                                        </span>
<span  style=""> 138                                                                                                                    </span>
<span class="3433532014428154380" onmouseenter="enter('3433532014428154380');" onmouseout="out('3433532014428154380');" style=""> 139      @Resource(name = &quot;blSolrHelperService&quot;)                                                                       </span>
<span class="-7677498150151406376" onmouseenter="enter('-7677498150151406376');" onmouseout="out('-7677498150151406376');" style=""> 140      protected SolrHelperService shs;                                                                              </span>
<span  style=""> 141                                                                                                                    </span>
<span class="6454351128227777183" onmouseenter="enter('6454351128227777183');" onmouseout="out('6454351128227777183');" style=""> 142      @Resource(name = &quot;blSolrIndexServiceExtensionManager&quot;)                                                        </span>
<span class="5247479920184811971" onmouseenter="enter('5247479920184811971');" onmouseout="out('5247479920184811971');" style=""> 143      protected SolrIndexServiceExtensionManager extensionManager;                                                  </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 145      @Resource(name = &quot;blTransactionManager&quot;)                                                                      </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 146      protected PlatformTransactionManager transactionManager;                                                      </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-2777716978602743792" onmouseenter="enter('-2777716978602743792');" onmouseout="out('-2777716978602743792');" style=""> 148      @Resource(name = &quot;blSolrIndexDao&quot;)                                                                            </span>
<span class="2803857682022434599" onmouseenter="enter('2803857682022434599');" onmouseout="out('2803857682022434599');" style=""> 149      protected SolrIndexDao solrIndexDao;                                                                          </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 151      @Resource(name = &quot;blSandBoxHelper&quot;)                                                                           </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 152      protected SandBoxHelper sandBoxHelper;                                                                        </span>
<span  style=""> 153                                                                                                                    </span>
<span class="722550641335667641" onmouseenter="enter('722550641335667641');" onmouseout="out('722550641335667641');" style=""> 154      @Resource(name = &quot;blSearchFacetDao&quot;)                                                                          </span>
<span class="-2192164507887589197" onmouseenter="enter('-2192164507887589197');" onmouseout="out('-2192164507887589197');" style=""> 155      protected SearchFacetDao searchFacetDao;                                                                      </span>
<span  style=""> 156                                                                                                                    </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style=""> 157      @Resource(name = &quot;blIndexFieldDao&quot;)                                                                           </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style=""> 158      protected IndexFieldDao indexFieldDao;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +                                                                                                                  </span>
<span class="4861142252788854730" onmouseenter="enter('4861142252788854730');" onmouseout="out('4861142252788854730');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +    @Value(value = &quot;${enable.solr.optimize:false}&quot;)                                                               </span>
<span class="-7987045041834234094" onmouseenter="enter('-7987045041834234094');" onmouseout="out('-7987045041834234094');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +    private boolean optimizeEnabled;                                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +                                                                                                                  </span>








<span  style=""> 163                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 164      @Override                                                                                                     </span>
<span class="-1854653869970518806" onmouseenter="enter('-1854653869970518806');" onmouseout="out('-1854653869970518806');" style=""><abbr title=" 165      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException {"> 165      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceExcepðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 166          try {                                                                                                     </span>
<span class="2574663780463066494" onmouseenter="enter('2574663780463066494');" onmouseout="out('2574663780463066494');" style=""> 167              CatalogStructure cache = new CatalogStructure();                                                      </span>
<span class="1856999562212420811" onmouseenter="enter('1856999562212420811');" onmouseout="out('1856999562212420811');" style=""> 168              SolrIndexCachedOperation.setCache(cache);                                                             </span>
<span class="-195994336271238110" onmouseenter="enter('-195994336271238110');" onmouseout="out('-195994336271238110');" style=""> 169              cacheOperation.execute();                                                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 170          } finally {                                                                                               </span>
<span class="7293095816713805281" onmouseenter="enter('7293095816713805281');" onmouseout="out('7293095816713805281');" style=""> 171              SolrIndexCachedOperation.clearCache();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173      }                                                                                                             </span>
<span  style=""> 174                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175      @Override                                                                                                     </span>
<span class="-8221211564360382808" onmouseenter="enter('-8221211564360382808');" onmouseout="out('-8221211564360382808');" style=""> 176      public void rebuildIndex() throws ServiceException, IOException {                                             </span>
<span class="4404402464743924238" onmouseenter="enter('4404402464743924238');" onmouseout="out('4404402464743924238');" style=""> 177          LOG.info(&quot;Rebuilding the entire Solr index...&quot;);                                                          </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 178          StopWatch s = new StopWatch();                                                                            </span>
<span  style=""> 179                                                                                                                    </span>
<span class="2782448594641417849" onmouseenter="enter('2782448594641417849');" onmouseout="out('2782448594641417849');" style=""> 180          preBuildIndex();                                                                                          </span>
<span class="5364167027467208466" onmouseenter="enter('5364167027467208466');" onmouseout="out('5364167027467208466');" style=""> 181          buildIndex();                                                                                             </span>
<span class="-2734214044106280557" onmouseenter="enter('-2734214044106280557');" onmouseout="out('-2734214044106280557');" style=""> 182          postBuildIndex();                                                                                         </span>
<span  style=""> 183                                                                                                                    </span>
<span class="8949756262532963545" onmouseenter="enter('8949756262532963545');" onmouseout="out('8949756262532963545');" style=""> 184          LOG.info(String.format(&quot;Finished building entire Solr index in %s&quot;, s.toLapString()));                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185      }                                                                                                             </span>
<span  style=""> 186                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 187      @Override                                                                                                     </span>
<span class="3237807690855435825" onmouseenter="enter('3237807690855435825');" onmouseout="out('3237807690855435825');" style=""> 188      public void preBuildIndex() throws ServiceException {                                                         </span>
<span class="4144911976389655481" onmouseenter="enter('4144911976389655481');" onmouseout="out('4144911976389655481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -        deleteAllNamespaceDocuments(solrConfiguration.getReindexServer());                                        </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 190 +        deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 190 +        deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191      }                                                                                                             </span>
<span  style=""> 192                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 193      @Override                                                                                                     </span>
<span class="107860368930590037" onmouseenter="enter('107860368930590037');" onmouseout="out('107860368930590037');" style=""> 194      public void buildIndex() throws IOException, ServiceException {                                               </span>
<span class="5469402358120203042" onmouseenter="enter('5469402358120203042');" onmouseout="out('5469402358120203042');" style=""> 195          executeSolrIndexOperation(getReindexOperation());                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196      }                                                                                                             </span>
<span  style=""> 197                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 198      @Override                                                                                                     </span>
<span class="2712485588427861869" onmouseenter="enter('2712485588427861869');" onmouseout="out('2712485588427861869');" style=""> 199      public void postBuildIndex() throws IOException, ServiceException {                                           </span>
<span class="4104911694494191311" onmouseenter="enter('4104911694494191311');" onmouseout="out('4104911694494191311');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -        // this is required to be at the very very very end after rebuilding the whole index                      </span>
<span class="1908736344096538941" onmouseenter="enter('1908736344096538941');" onmouseout="out('1908736344096538941');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -        optimizeIndex(solrConfiguration.getReindexServer());                                                      </span>
<span class="8445746639246064219" onmouseenter="enter('8445746639246064219');" onmouseout="out('8445746639246064219');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +        if(optimizeEnabled) {                                                                                     </span>
<span class="4104911694494191311" onmouseenter="enter('4104911694494191311');" onmouseout="out('4104911694494191311');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +            // this is required to be at the very very very end after rebuilding the whole index                  </span>
<span class="-3594378582194653803" onmouseenter="enter('-3594378582194653803');" onmouseout="out('-3594378582194653803');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +            optimizeIndex(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +        }                                                                                                         </span>
<span class="-7179442614804219935" onmouseenter="enter('-7179442614804219935');" onmouseout="out('-7179442614804219935');" style=""> 206          // Swap the active and the reindex cores                                                                  </span>
<span class="-211335379164132987" onmouseenter="enter('-211335379164132987');" onmouseout="out('-211335379164132987');" style=""> 207          if (!solrConfiguration.isSingleCoreMode()) {                                                              </span>
<span class="-1073514264710403192" onmouseenter="enter('-1073514264710403192');" onmouseout="out('-1073514264710403192');" style=""> 208              shs.swapActiveCores(solrConfiguration);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210      }                                                                                                             </span>
<span  style=""> 211                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 212      @Override                                                                                                     </span>
<span class="-811355888891304948" onmouseenter="enter('-811355888891304948');" onmouseout="out('-811355888891304948');" style=""> 213      public SolrIndexOperation getReindexOperation() {                                                             </span>
<span class="4313634092062438466" onmouseenter="enter('4313634092062438466');" onmouseout="out('4313634092062438466');" style=""> 214          return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex) {       </span>
<span  style=""> 215                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 216              @Override                                                                                             </span>
<span class="-4387595312024622473" onmouseenter="enter('-4387595312024622473');" onmouseout="out('-4387595312024622473');" style=""> 217              public List&lt;? extends Indexable&gt; readIndexables(int pageSize, Long lastId) {                          </span>
<span class="4006405235344016633" onmouseenter="enter('4006405235344016633');" onmouseout="out('4006405235344016633');" style=""> 218                  return readAllActiveIndexables(pageSize, lastId);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219              }                                                                                                     </span>
<span  style=""> 220                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 221              @Override                                                                                             </span>
<span class="5959961393917647667" onmouseenter="enter('5959961393917647667');" onmouseout="out('5959961393917647667');" style=""> 222              public Long countIndexables() {                                                                       </span>
<span class="2520275452674275986" onmouseenter="enter('2520275452674275986');" onmouseout="out('2520275452674275986');" style=""> 223                  return countIndexableItems();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224              }                                                                                                     </span>
<span  style=""> 225                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 226              @Override                                                                                             </span>
<span class="-1692826682113823468" onmouseenter="enter('-1692826682113823468');" onmouseout="out('-1692826682113823468');" style=""> 227              public void buildPage(List&lt;? extends Indexable&gt; indexables) throws ServiceException {                 </span>
<span class="-621226516327610454" onmouseenter="enter('-621226516327610454');" onmouseout="out('-621226516327610454');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -                buildIncrementalIndex(indexables, getSolrServerForIndexing());                                    </span>
<span class="3979625068666947530" onmouseenter="enter('3979625068666947530');" onmouseout="out('3979625068666947530');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +                buildIncrementalIndex(getSolrCollectionForIndexing(), indexables, getSolrServerForIndexing());    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 231          };                                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232      }                                                                                                             </span>
<span  style=""> 233                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234      @Override                                                                                                     </span>
<span class="-4119273796811407274" onmouseenter="enter('-4119273796811407274');" onmouseout="out('-4119273796811407274');" style=""><abbr title=" 235      public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOException {"> 235      public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOExceptionðŸ”µ</abbr></span>
<span class="-6605112368804100748" onmouseenter="enter('-6605112368804100748');" onmouseout="out('-6605112368804100748');" style=""> 236          operation.obtainLock();                                                                                   </span>
<span  style=""> 237                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 238          try {                                                                                                     </span>
<span class="5776764097449375233" onmouseenter="enter('5776764097449375233');" onmouseout="out('5776764097449375233');" style=""> 239              LOG.info(&quot;Executing Indexing operation&quot;);                                                             </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 240              StopWatch s = new StopWatch();                                                                        </span>
<span  style=""> 241                                                                                                                    </span>
<span class="-4925351317711298127" onmouseenter="enter('-4925351317711298127');" onmouseout="out('-4925351317711298127');" style=""> 242              Object[] pack = saveState();                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 243              try {                                                                                                 </span>
<span class="4852869320838830283" onmouseenter="enter('4852869320838830283');" onmouseout="out('4852869320838830283');" style=""> 244                  final Long numItemsToIndex;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 245                  try {                                                                                             </span>
<span class="997617649642836840" onmouseenter="enter('997617649642836840');" onmouseout="out('997617649642836840');" style=""> 246                      operation.beforeCountIndexables();                                                            </span>
<span  style=""> 247                                                                                                                    </span>
<span class="-8341915703694509082" onmouseenter="enter('-8341915703694509082');" onmouseout="out('-8341915703694509082');" style=""> 248                      numItemsToIndex = operation.countIndexables();                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 249                  } finally {                                                                                       </span>
<span class="8625682159596383443" onmouseenter="enter('8625682159596383443');" onmouseout="out('8625682159596383443');" style=""> 250                      operation.afterCountIndexables();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251                  }                                                                                                 </span>
<span  style=""> 252                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 253                  if (LOG.isDebugEnabled()) {                                                                       </span>
<span class="-1342537230534112505" onmouseenter="enter('-1342537230534112505');" onmouseout="out('-1342537230534112505');" style=""> 254                      LOG.debug(&quot;There are at most &quot; + numItemsToIndex + &quot; items to index&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255                  }                                                                                                 </span>
<span class="-6975585634623067095" onmouseenter="enter('-6975585634623067095');" onmouseout="out('-6975585634623067095');" style=""> 256                  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {                            </span>
<span  style=""> 257                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 258                      @Override                                                                                     </span>
<span class="-7096128206041696180" onmouseenter="enter('-7096128206041696180');" onmouseout="out('-7096128206041696180');" style=""> 259                      public void execute() throws ServiceException {                                               </span>
<span class="-4395739824177979579" onmouseenter="enter('-4395739824177979579');" onmouseout="out('-4395739824177979579');" style=""> 260                          int page = 1;                                                                             </span>
<span class="4634490409390119351" onmouseenter="enter('4634490409390119351');" onmouseout="out('4634490409390119351');" style=""> 261                          Long lastId = null;                                                                       </span>
<span class="-2807153128771866015" onmouseenter="enter('-2807153128771866015');" onmouseout="out('-2807153128771866015');" style=""> 262                          Long remainingNumItemsToIndex = numItemsToIndex;                                          </span>
<span class="-6866370637183701575" onmouseenter="enter('-6866370637183701575');" onmouseout="out('-6866370637183701575');" style=""> 263                          Long totalPages = getTotalPageCount(numItemsToIndex);                                     </span>
<span  style=""> 264                                                                                                                    </span>
<span class="-2134634807912211771" onmouseenter="enter('-2134634807912211771');" onmouseout="out('-2134634807912211771');" style=""> 265                          while (remainingNumItemsToIndex &gt; 0) {                                                    </span>
<span class="6951794882859960666" onmouseenter="enter('6951794882859960666');" onmouseout="out('6951794882859960666');" style=""> 266                              String pageNumberMessage = buildPageNumberMessage(page, totalPages);                  </span>
<span class="5716330204152709052" onmouseenter="enter('5716330204152709052');" onmouseout="out('5716330204152709052');" style=""> 267                              LOG.info(pageNumberMessage);                                                          </span>
<span  style=""> 268                                                                                                                    </span>
<span class="165772722778294439" onmouseenter="enter('165772722778294439');" onmouseout="out('165772722778294439');" style=""> 269                              lastId = buildIncrementalIndex(pageSize, lastId, operation);                          </span>
<span class="-4024045770293484238" onmouseenter="enter('-4024045770293484238');" onmouseout="out('-4024045770293484238');" style=""> 270                              remainingNumItemsToIndex -= pageSize;                                                 </span>
<span class="-8284897147643623971" onmouseenter="enter('-8284897147643623971');" onmouseout="out('-8284897147643623971');" style=""> 271                              page++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 274                  });                                                                                               </span>
<span  style=""> 275                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 276              } finally {                                                                                           </span>
<span class="-5823413484715712161" onmouseenter="enter('-5823413484715712161');" onmouseout="out('-5823413484715712161');" style=""> 277                  restoreState(pack);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278              }                                                                                                     </span>
<span  style=""> 279                                                                                                                    </span>
<span class="7093623796813341550" onmouseenter="enter('7093623796813341550');" onmouseout="out('7093623796813341550');" style=""> 280              LOG.info(String.format(&quot;Indexing operation completed in %s&quot;, s.toLapString()));                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 281          } finally {                                                                                               </span>
<span class="-1350180452435495402" onmouseenter="enter('-1350180452435495402');" onmouseout="out('-1350180452435495402');" style=""> 282              operation.releaseLock();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284      }                                                                                                             </span>
<span  style=""> 285                                                                                                                    </span>
<span class="4509881942909907564" onmouseenter="enter('4509881942909907564');" onmouseout="out('4509881942909907564');" style=""> 286      protected long getTotalPageCount(Long numItemsToIndex) {                                                      </span>
<span class="885623822255204209" onmouseenter="enter('885623822255204209');" onmouseout="out('885623822255204209');" style=""> 287          long numPagesToIndex = numItemsToIndex / pageSize;                                                        </span>
<span class="1202091708155781117" onmouseenter="enter('1202091708155781117');" onmouseout="out('1202091708155781117');" style=""> 288          boolean hasRemainingItemsToIndex = numItemsToIndex % pageSize != 0;                                       </span>
<span  style=""> 289                                                                                                                    </span>
<span class="-8914515660918232216" onmouseenter="enter('-8914515660918232216');" onmouseout="out('-8914515660918232216');" style=""> 290          return hasRemainingItemsToIndex ? (numPagesToIndex + 1) : numPagesToIndex;                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291      }                                                                                                             </span>
<span  style=""> 292                                                                                                                    </span>
<span class="-1140169622753247687" onmouseenter="enter('-1140169622753247687');" onmouseout="out('-1140169622753247687');" style=""> 293      protected String buildPageNumberMessage(int page, Long totalPages) {                                          </span>
<span class="5185167171670482872" onmouseenter="enter('5185167171670482872');" onmouseout="out('5185167171670482872');" style=""> 294          String pageNumberMessage = String.format(&quot;Building page number %s of %s&quot;, page, totalPages);              </span>
<span  style=""> 295                                                                                                                    </span>
<span class="3917690980387875903" onmouseenter="enter('3917690980387875903');" onmouseout="out('3917690980387875903');" style=""> 296          Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog();        </span>
<span class="3059190135946477261" onmouseenter="enter('3059190135946477261');" onmouseout="out('3059190135946477261');" style=""> 297          if (currentCatalog != null) {                                                                             </span>
<span class="-2760479412731933677" onmouseenter="enter('-2760479412731933677');" onmouseout="out('-2760479412731933677');" style=""> 298              pageNumberMessage += String.format(&quot; for catalog: %s&quot;, currentCatalog.getName());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299          }                                                                                                         </span>
<span  style=""> 300                                                                                                                    </span>
<span class="6061536256827306935" onmouseenter="enter('6061536256827306935');" onmouseout="out('6061536256827306935');" style=""> 301          return pageNumberMessage;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302      }                                                                                                             </span>
<span  style=""> 303                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 304      /**                                                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 305       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 306       */                                                                                                           </span>
<span class="307261357449118205" onmouseenter="enter('307261357449118205');" onmouseout="out('307261357449118205');" style=""> 307      protected Long countIndexableItems() {                                                                        </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -        if (useSku) {                                                                                             </span>
<span class="-774456416256550159" onmouseenter="enter('-774456416256550159');" onmouseout="out('-774456416256550159');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -            return skuDao.readCountAllActiveSkus();                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -        } else {                                                                                                  </span>
<span class="3881831181376649254" onmouseenter="enter('3881831181376649254');" onmouseout="out('3881831181376649254');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -            return productDao.readCountAllActiveProducts();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -        }                                                                                                         </span>
<span class="3881831181376649254" onmouseenter="enter('3881831181376649254');" onmouseout="out('3881831181376649254');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +        return productDao.readCountAllActiveProducts();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314      }                                                                                                             </span>
<span  style=""> 315                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 316      /**                                                                                                           </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 317       * &lt;p&gt;                                                                                                        </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 318       * This method deletes all of the documents from {@link SolrContext#getReindexServer()}                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 319       *                                                                                                            </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 320       * @throws ServiceException if there was a problem removing the documents                                     </span>
<span class="-1570570320656419415" onmouseenter="enter('-1570570320656419415');" onmouseout="out('-1570570320656419415');" style=""> 321       * @deprecated use {@link #deleteAllReindexCoreDocuments()} instead                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 322       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 323      @Deprecated                                                                                                   </span>
<span class="7799053882932808400" onmouseenter="enter('7799053882932808400');" onmouseout="out('7799053882932808400');" style=""> 324      protected void deleteAllDocuments() throws ServiceException {                                                 </span>
<span class="3834807060428836051" onmouseenter="enter('3834807060428836051');" onmouseout="out('3834807060428836051');" style=""> 325          deleteAllReindexCoreDocuments();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326      }                                                                                                             </span>
<span  style=""> 327                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 328      /**                                                                                                           </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 329       * &lt;p&gt;                                                                                                        </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 330       * This method deletes all of the documents from {@link SolrContext#getReindexServer()}                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 331       *                                                                                                            </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 332       * @throws ServiceException if there was a problem removing the documents                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 333       */                                                                                                           </span>
<span class="6870158579484852535" onmouseenter="enter('6870158579484852535');" onmouseout="out('6870158579484852535');" style=""> 334      protected void deleteAllReindexCoreDocuments() throws ServiceException {                                      </span>
<span class="4144911976389655481" onmouseenter="enter('4144911976389655481');" onmouseout="out('4144911976389655481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -        deleteAllNamespaceDocuments(solrConfiguration.getReindexServer());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -    @Override                                                                                                     </span>
<span class="125965368563769580" onmouseenter="enter('125965368563769580');" onmouseout="out('125965368563769580');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -    public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException {                          </span>
<span class="-4427760311999522922" onmouseenter="enter('-4427760311999522922');" onmouseout="out('-4427760311999522922');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 340 +        deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServer());"> 340 +        deleteAllNamespaceDocuments(solrConfiguration.getReindexCollectionName(), solrConfiguration.getReindexServðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +    @Override                                                                                                     </span>
<span class="-4976975123662493196" onmouseenter="enter('-4976975123662493196');" onmouseout="out('-4976975123662493196');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +    public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException {       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 345          try {                                                                                                     </span>
<span class="-6389361698931234700" onmouseenter="enter('-6389361698931234700');" onmouseout="out('-6389361698931234700');" style=""> 346              String deleteQuery = StringUtil.sanitize(shs.getNamespaceFieldName()) + &quot;:(\&quot;&quot;                        </span>
<span class="-1195999488596466196" onmouseenter="enter('-1195999488596466196');" onmouseout="out('-1195999488596466196');" style=""> 347                      + StringUtil.sanitize(solrConfiguration.getNamespace()) + &quot;\&quot;)&quot;;                              </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 348              LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                                       </span>
<span class="-2796598282240712005" onmouseenter="enter('-2796598282240712005');" onmouseout="out('-2796598282240712005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 349 -            server.deleteByQuery(deleteQuery);                                                                    </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 350 +            server.deleteByQuery(collection, deleteQuery);                                                        </span>
<span  style=""> 351                                                                                                                    </span>
<span class="-546379745910436336" onmouseenter="enter('-546379745910436336');" onmouseout="out('-546379745910436336');" style=""> 352              //Explicitly do a hard commit here since we just deleted the entire index                             </span>
<span class="-3860280973525657844" onmouseenter="enter('-3860280973525657844');" onmouseout="out('-3860280973525657844');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 353 -            server.commit();                                                                                      </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +            server.commit(collection);                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 355          } catch (Exception e) {                                                                                   </span>
<span class="4280241435178863824" onmouseenter="enter('4280241435178863824');" onmouseout="out('4280241435178863824');" style=""> 356              if (ServiceException.class.isAssignableFrom(e.getClass())) {                                          </span>
<span class="-9048611182670468194" onmouseenter="enter('-9048611182670468194');" onmouseout="out('-9048611182670468194');" style=""> 357                  throw (ServiceException) e;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358              }                                                                                                     </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 359              throw new ServiceException(&quot;Could not delete documents&quot;, e);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361      }                                                                                                             </span>
<span  style=""> 362                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 363      @Override                                                                                                     </span>
<span class="31475417648561827" onmouseenter="enter('31475417648561827');" onmouseout="out('31475417648561827');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -    public void deleteAllDocuments(SolrClient server) throws ServiceException {                                   </span>
<span class="8552288591606532671" onmouseenter="enter('8552288591606532671');" onmouseout="out('8552288591606532671');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 365 +    public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException {                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 366          try {                                                                                                     </span>
<span class="2136303103230726070" onmouseenter="enter('2136303103230726070');" onmouseout="out('2136303103230726070');" style=""> 367              String deleteQuery = &quot;*:*&quot;;                                                                           </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 368              LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                                       </span>
<span class="-2796598282240712005" onmouseenter="enter('-2796598282240712005');" onmouseout="out('-2796598282240712005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -            server.deleteByQuery(deleteQuery);                                                                    </span>
<span class="-3860280973525657844" onmouseenter="enter('-3860280973525657844');" onmouseout="out('-3860280973525657844');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -            server.commit();                                                                                      </span>
<span class="-3851186789540604966" onmouseenter="enter('-3851186789540604966');" onmouseout="out('-3851186789540604966');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 371 +            server.deleteByQuery(collection, deleteQuery);                                                        </span>
<span class="-4658101441041368091" onmouseenter="enter('-4658101441041368091');" onmouseout="out('-4658101441041368091');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 372 +            server.commit(collection);                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 373          } catch (Exception e) {                                                                                   </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 374              throw new ServiceException(&quot;Could not delete documents&quot;, e);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376      }                                                                                                             </span>
<span  style=""> 377                                                                                                                    </span>
<span class="-1911085678082561084" onmouseenter="enter('-1911085678082561084');" onmouseout="out('-1911085678082561084');" style=""><abbr title=" 378      protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ServiceException {"> 378      protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ServiceExðŸ”µ</abbr></span>
<span class="1006805691441623516" onmouseenter="enter('1006805691441623516');" onmouseout="out('1006805691441623516');" style=""> 379          TransactionStatus status = TransactionUtils.createTransaction(&quot;readItemsToIndex&quot;,                         </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 380              TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                                </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 381          if (SolrIndexCachedOperation.getCache() == null) {                                                        </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 382              LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +            </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 383                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 383                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384          }                                                                                                         </span>
<span class="-4530225541058778702" onmouseenter="enter('-4530225541058778702');" onmouseout="out('-4530225541058778702');" style=""> 385          Long response = null;                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 386          try {                                                                                                     </span>
<span class="-3204111561138569714" onmouseenter="enter('-3204111561138569714');" onmouseout="out('-3204111561138569714');" style=""> 387              List&lt;? extends Indexable&gt; indexables;                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 388              try {                                                                                                 </span>
<span class="3356995070675471983" onmouseenter="enter('3356995070675471983');" onmouseout="out('3356995070675471983');" style=""> 389                  operation.beforeReadIndexables();                                                                 </span>
<span class="1315644369404660428" onmouseenter="enter('1315644369404660428');" onmouseout="out('1315644369404660428');" style=""> 390                  indexables = operation.readIndexables(pageSize, lastId);                                          </span>
<span class="-3163865863529807802" onmouseenter="enter('-3163865863529807802');" onmouseout="out('-3163865863529807802');" style=""> 391                  if (CollectionUtils.isNotEmpty(indexables)) {                                                     </span>
<span class="1879209496515446980" onmouseenter="enter('1879209496515446980');" onmouseout="out('1879209496515446980');" style=""> 392                      response = indexables.get(indexables.size()-1).getId();                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393                  }                                                                                                 </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 394              } finally {                                                                                           </span>
<span class="-7029725537576676912" onmouseenter="enter('-7029725537576676912');" onmouseout="out('-7029725537576676912');" style=""> 395                  operation.afterReadIndexables();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396              }                                                                                                     </span>
<span  style=""> 397                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 398              try {                                                                                                 </span>
<span class="-2168921446123257487" onmouseenter="enter('-2168921446123257487');" onmouseout="out('-2168921446123257487');" style=""> 399                  operation.beforeBuildPage();                                                                      </span>
<span  style=""> 400                                                                                                                    </span>
<span class="9094317700245591530" onmouseenter="enter('9094317700245591530');" onmouseout="out('9094317700245591530');" style=""> 401                  operation.buildPage(indexables);                                                                  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 402              } finally {                                                                                           </span>
<span class="3074038306845641791" onmouseenter="enter('3074038306845641791');" onmouseout="out('3074038306845641791');" style=""> 403                  operation.afterBuildPage();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404              }                                                                                                     </span>
<span  style=""> 405                                                                                                                    </span>
<span  style=""> 406                                                                                                                    </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 407              TransactionUtils.finalizeTransaction(status, transactionManager, false);                              </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 408          } catch (RuntimeException e) {                                                                            </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 409              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 410              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 412          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413      }                                                                                                             </span>
<span  style=""> 414                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 415      @Override                                                                                                     </span>
<span class="8474819187366488777" onmouseenter="enter('8474819187366488777');" onmouseout="out('8474819187366488777');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 416 -    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 416 -    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient soðŸ”µ</abbr></span>
<span class="-3229146772555478401" onmouseenter="enter('-3229146772555478401');" onmouseout="out('-3229146772555478401');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 417 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 417 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexaðŸ”µ</abbr></span>
<span class="2510928886343537128" onmouseenter="enter('2510928886343537128');" onmouseout="out('2510928886343537128');" style=""> 418          TransactionStatus status = TransactionUtils.createTransaction(&quot;executeIncrementalIndex&quot;,                  </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 419                  TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                            </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 420          if (SolrIndexCachedOperation.getCache() == null) {                                                        </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 421              LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +            </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 422                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 422                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423          }                                                                                                         </span>
<span  style=""> 424                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 425          if (LOG.isDebugEnabled()) {                                                                               </span>
<span class="5294183869527180393" onmouseenter="enter('5294183869527180393');" onmouseout="out('5294183869527180393');" style=""> 426              LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.size()));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427          }                                                                                                         </span>
<span  style=""> 428                                                                                                                    </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 429          StopWatch s = new StopWatch();                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 430          try {                                                                                                     </span>
<span class="6539966544446663437" onmouseenter="enter('6539966544446663437');" onmouseout="out('6539966544446663437');" style=""> 431              sandBoxHelper.ignoreCloneCache(true);                                                                 </span>
<span class="7183587253332869173" onmouseenter="enter('7183587253332869173');" onmouseout="out('7183587253332869173');" style=""> 432              extensionManager.getProxy().startBatchEvent(indexables);                                              </span>
<span class="3424650845291102605" onmouseenter="enter('3424650845291102605');" onmouseout="out('3424650845291102605');" style=""> 433              Collection&lt;SolrInputDocument&gt; documents = new ArrayList&lt;&gt;();                                          </span>
<span class="7801772952659649444" onmouseenter="enter('7801772952659649444');" onmouseout="out('7801772952659649444');" style=""> 434              List&lt;Locale&gt; locales = getAllLocales();                                                               </span>
<span  style=""> 435                                                                                                                    </span>
<span class="-2189912087670236149" onmouseenter="enter('-2189912087670236149');" onmouseout="out('-2189912087670236149');" style=""> 436              List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;() {     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 437                  @Override                                                                                         </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 438                  public Long transform(Object input) {                                                             </span>
<span class="6561542425546767799" onmouseenter="enter('6561542425546767799');" onmouseout="out('6561542425546767799');" style=""> 439                      return shs.getCurrentProductId((Indexable) input);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440                  }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 441              });                                                                                                   </span>
<span  style=""> 442                                                                                                                    </span>
<span class="-6904889408824287124" onmouseenter="enter('-6904889408824287124');" onmouseout="out('-6904889408824287124');" style=""> 443              solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache());        </span>
<span  style=""> 444                                                                                                                    </span>
<span class="326959637207207549" onmouseenter="enter('326959637207207549');" onmouseout="out('326959637207207549');" style=""> 445              List&lt;IndexField&gt; fields = null;                                                                       </span>
<span class="-1903082167184535893" onmouseenter="enter('-1903082167184535893');" onmouseout="out('-1903082167184535893');" style=""> 446              FieldEntity currentFieldType = null;                                                                  </span>
<span class="-3671570197523764351" onmouseenter="enter('-3671570197523764351');" onmouseout="out('-3671570197523764351');" style=""> 447              for (Indexable indexable : indexables) {                                                              </span>
<span class="-6818188811001504815" onmouseenter="enter('-6818188811001504815');" onmouseout="out('-6818188811001504815');" style=""> 448                  if (fields == null || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityType())) {   </span>
<span class="4379308220695057970" onmouseenter="enter('4379308220695057970');" onmouseout="out('4379308220695057970');" style=""> 449                      fields = indexFieldDao.readFieldsByEntityType(indexable.getFieldEntityType());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450                  }                                                                                                 </span>
<span  style=""> 451                                                                                                                    </span>
<span class="7630570351050256200" onmouseenter="enter('7630570351050256200');" onmouseout="out('7630570351050256200');" style=""> 452                  SolrInputDocument doc = buildDocument(indexable, fields, locales);                                </span>
<span class="-3475311009677795568" onmouseenter="enter('-3475311009677795568');" onmouseout="out('-3475311009677795568');" style=""> 453                  //If someone overrides the buildDocument method and determines that they don&#x27;t want a product     </span>
<span class="4539214609551390244" onmouseenter="enter('4539214609551390244');" onmouseout="out('4539214609551390244');" style=""> 454                  //indexed, then they can return null. If the document is null it does not get added to            </span>
<span class="-225951702109518326" onmouseenter="enter('-225951702109518326');" onmouseout="out('-225951702109518326');" style=""> 455                  //to the index.                                                                                   </span>
<span class="-5520172171866318279" onmouseenter="enter('-5520172171866318279');" onmouseout="out('-5520172171866318279');" style=""> 456                  if (doc != null) {                                                                                </span>
<span class="4425904984588304942" onmouseenter="enter('4425904984588304942');" onmouseout="out('4425904984588304942');" style=""> 457                      documents.add(doc);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459              }                                                                                                     </span>
<span  style=""> 460                                                                                                                    </span>
<span class="-5162140986849793305" onmouseenter="enter('-5162140986849793305');" onmouseout="out('-5162140986849793305');" style=""> 461              extensionManager.getProxy().modifyBuiltDocuments(documents, indexables, fields, locales);             </span>
<span  style=""> 462                                                                                                                    </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 463              logDocuments(documents);                                                                              </span>
<span  style=""> 464                                                                                                                    </span>
<span class="-6239196544496643062" onmouseenter="enter('-6239196544496643062');" onmouseout="out('-6239196544496643062');" style=""> 465              if (!CollectionUtils.isEmpty(documents) &amp;&amp; solrServer != null) {                                      </span>
<span class="-2455738755867551021" onmouseenter="enter('-2455738755867551021');" onmouseout="out('-2455738755867551021');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 466 -                solrServer.add(documents);                                                                        </span>
<span class="-9027493991986689214" onmouseenter="enter('-9027493991986689214');" onmouseout="out('-9027493991986689214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 467 -                commit(solrServer);                                                                               </span>
<span class="6742664882868092095" onmouseenter="enter('6742664882868092095');" onmouseout="out('6742664882868092095');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +                solrServer.add(collection, documents);                                                            </span>
<span class="4440071783810203686" onmouseenter="enter('4440071783810203686');" onmouseout="out('4440071783810203686');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 469 +                commit(collection, solrServer);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470              }                                                                                                     </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 471              TransactionUtils.finalizeTransaction(status, transactionManager, false);                              </span>
<span  style=""> 472                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 473              if (LOG.isDebugEnabled()) {                                                                           </span>
<span class="-5239549129780834185" onmouseenter="enter('-5239549129780834185');" onmouseout="out('-5239549129780834185');" style=""><abbr title=" 474                  LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexables.size(), s.toLapString()));"> 474                  LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexables.sizðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475              }                                                                                                     </span>
<span  style=""> 476                                                                                                                    </span>
<span class="-4724346008918927046" onmouseenter="enter('-4724346008918927046');" onmouseout="out('-4724346008918927046');" style=""> 477              return documents;                                                                                     </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 478          } catch (SolrServerException e) {                                                                         </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 479              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 480              throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 481          } catch (IOException e) {                                                                                 </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 482              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 483              throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                             </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 484          } catch (RuntimeException e) {                                                                            </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 485              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 486              throw e;                                                                                              </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 487          } finally {                                                                                               </span>
<span class="90671037077050937" onmouseenter="enter('90671037077050937');" onmouseout="out('90671037077050937');" style=""> 488              extensionManager.getProxy().endBatchEvent(indexables);                                                </span>
<span class="8189254405929957329" onmouseenter="enter('8189254405929957329');" onmouseout="out('8189254405929957329');" style=""> 489              sandBoxHelper.ignoreCloneCache(false);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491      }                                                                                                             </span>
<span  style=""> 492                                                                                                                    </span>
<span class="5551263307167100166" onmouseenter="enter('5551263307167100166');" onmouseout="out('5551263307167100166');" style=""> 493      protected List&lt;? extends Indexable&gt; readAllActiveIndexables(int pageSize, Long lastId) {                      </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -        if (useSku) {                                                                                             </span>
<span class="-3742310466348187153" onmouseenter="enter('-3742310466348187153');" onmouseout="out('-3742310466348187153');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -            List&lt;Sku&gt; skus = skuDao.readAllActiveSkus(pageSize, lastId);                                          </span>
<span class="-1918574255732088044" onmouseenter="enter('-1918574255732088044');" onmouseout="out('-1918574255732088044');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 496 -            return filterIndexableSkus(skus);                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 497 -        } else {                                                                                                  </span>
<span class="6192419674169007142" onmouseenter="enter('6192419674169007142');" onmouseout="out('6192419674169007142');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 498 -            return productDao.readAllActiveProducts(pageSize, lastId);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 499 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 500 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 502 -    @Override                                                                                                     </span>
<span class="-3297504531734357903" onmouseenter="enter('-3297504531734357903');" onmouseout="out('-3297504531734357903');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 503 -    public List&lt;Sku&gt; filterIndexableSkus(List&lt;Sku&gt; skus) {                                                        </span>
<span class="-4426996259137202563" onmouseenter="enter('-4426996259137202563');" onmouseout="out('-4426996259137202563');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 504 -        ArrayList&lt;Sku&gt; skusToIndex = new ArrayList&lt;&gt;();                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 505 -                                                                                                                  </span>
<span class="538054118057794756" onmouseenter="enter('538054118057794756');" onmouseout="out('538054118057794756');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 506 -        if (CollectionUtils.isNotEmpty(skus)) {                                                                   </span>
<span class="-2939273877835886579" onmouseenter="enter('-2939273877835886579');" onmouseout="out('-2939273877835886579');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 507 -            for (Sku sku : skus) {                                                                                </span>
<span class="5890104578951350401" onmouseenter="enter('5890104578951350401');" onmouseout="out('5890104578951350401');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 508 -                //If the sku is not active, don&#x27;t index it...                                                     </span>
<span class="3103154746255532145" onmouseenter="enter('3103154746255532145');" onmouseout="out('3103154746255532145');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 509 -                if (!sku.isActive()) {                                                                            </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 510 -                    continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 511 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 512 -                                                                                                                  </span>
<span class="-546718319586201072" onmouseenter="enter('-546718319586201072');" onmouseout="out('-546718319586201072');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 513 -                //If this is the default sku and the product has product options                                  </span>
<span class="-6470422469159347410" onmouseenter="enter('-6470422469159347410');" onmouseout="out('-6470422469159347410');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 514 -                //and is not allowed to be sold without product options                                           </span>
<span class="-337678893763484987" onmouseenter="enter('-337678893763484987');" onmouseout="out('-337678893763484987');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 515 -                if (sku.getDefaultProduct() != null                                                               </span>
<span class="-7019292284262174275" onmouseenter="enter('-7019292284262174275');" onmouseout="out('-7019292284262174275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 516 -                        &amp;&amp; !sku.getProduct().getCanSellWithoutOptions()                                           </span>
<span class="1729116690037468663" onmouseenter="enter('1729116690037468663');" onmouseout="out('1729116690037468663');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 517 -                        &amp;&amp; !sku.getProduct().getAdditionalSkus().isEmpty()) {                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 518 -                    continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 519 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 520 -                                                                                                                  </span>
<span class="-88117540515388863" onmouseenter="enter('-88117540515388863');" onmouseout="out('-88117540515388863');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 521 -                if (sku.getDefaultProduct() instanceof ProductBundle) {                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 522 -                    continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 523 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 524 -                                                                                                                  </span>
<span class="-7670999631895775847" onmouseenter="enter('-7670999631895775847');" onmouseout="out('-7670999631895775847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 525 -                skusToIndex.add(sku);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 526 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 527 -        }                                                                                                         </span>
<span class="3569956845755381035" onmouseenter="enter('3569956845755381035');" onmouseout="out('3569956845755381035');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 528 -        return skusToIndex;                                                                                       </span>
<span class="6192419674169007142" onmouseenter="enter('6192419674169007142');" onmouseout="out('6192419674169007142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 529 +        return productDao.readAllActiveProducts(pageSize, lastId);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530      }                                                                                                             </span>
<span  style=""> 531                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 532      @Override                                                                                                     </span>
<span class="-8038322947777108176" onmouseenter="enter('-8038322947777108176');" onmouseout="out('-8038322947777108176');" style=""> 533      public List&lt;Locale&gt; getAllLocales() {                                                                         </span>
<span class="-8741721793451188111" onmouseenter="enter('-8741721793451188111');" onmouseout="out('-8741721793451188111');" style=""> 534          List&lt;Locale&gt; allLocales = localeService.findAllLocales();                                                 </span>
<span class="4034520407475000176" onmouseenter="enter('4034520407475000176');" onmouseout="out('4034520407475000176');" style=""> 535          Map&lt;String, Locale&gt; processedLocales = new HashMap&lt;&gt;();                                                   </span>
<span class="2399355616829443482" onmouseenter="enter('2399355616829443482');" onmouseout="out('2399355616829443482');" style=""> 536          // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale set and I&#x27;m</span>
<span class="1459641740327693907" onmouseenter="enter('1459641740327693907');" onmouseout="out('1459641740327693907');" style=""> 537          // not using the country code to index the values, then I only need to index the locale &#x27;en&#x27;              </span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style=""> 538          for (Locale locale : allLocales) {                                                                        </span>
<span class="343473664574147441" onmouseenter="enter('343473664574147441');" onmouseout="out('343473664574147441');" style=""> 539              String localeCode = locale.getLocaleCode();                                                           </span>
<span class="-113413807046306655" onmouseenter="enter('-113413807046306655');" onmouseout="out('-113413807046306655');" style=""> 540              int underscoreLocation = localeCode.indexOf(&quot;_&quot;);                                                     </span>
<span class="5152034502068978670" onmouseenter="enter('5152034502068978670');" onmouseout="out('5152034502068978670');" style=""> 541              if (underscoreLocation &gt; 0 &amp;&amp; Boolean.FALSE.equals(locale.getUseCountryInSearchIndex())) {            </span>
<span class="8938820827276960997" onmouseenter="enter('8938820827276960997');" onmouseout="out('8938820827276960997');" style=""> 542                  String localeCodeWithoutCountry = localeCode.substring(0, underscoreLocation);                    </span>
<span class="-6764305435332837995" onmouseenter="enter('-6764305435332837995');" onmouseout="out('-6764305435332837995');" style=""> 543                  if (!processedLocales.containsKey(localeCodeWithoutCountry)) {                                    </span>
<span class="-3212129377547784987" onmouseenter="enter('-3212129377547784987');" onmouseout="out('-3212129377547784987');" style=""> 544                      processedLocales.put(localeCodeWithoutCountry, locale);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 546              } else {                                                                                              </span>
<span class="-3143247090679758655" onmouseenter="enter('-3143247090679758655');" onmouseout="out('-3143247090679758655');" style=""> 547                  processedLocales.put(locale.getLocaleCode(), locale);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549          }                                                                                                         </span>
<span class="8478562493399850393" onmouseenter="enter('8478562493399850393');" onmouseout="out('8478562493399850393');" style=""> 550          return new ArrayList&lt;&gt;(processedLocales.values());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551      }                                                                                                             </span>
<span  style=""> 552                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 553      @Override                                                                                                     </span>
<span class="-5988937181784380794" onmouseenter="enter('-5988937181784380794');" onmouseout="out('-5988937181784380794');" style=""><abbr title=" 554      public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 554      public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; localeðŸ”µ</abbr></span>
<span class="-1573032782442007580" onmouseenter="enter('-1573032782442007580');" onmouseout="out('-1573032782442007580');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 555 -        final SolrInputDocument document = new SolrInputDocument();                                               </span>
<span class="4147487252329209973" onmouseenter="enter('4147487252329209973');" onmouseout="out('4147487252329209973');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 556 +        final SolrInputDocument document = new SolrInputDocument(new LinkedHashMap&lt;String,SolrInputField&gt;());     </span>
<span  style=""> 557                                                                                                                    </span>
<span class="-1191402169666210527" onmouseenter="enter('-1191402169666210527');" onmouseout="out('-1191402169666210527');" style=""> 558          attachBasicDocumentFields(indexable, document);                                                           </span>
<span  style=""> 559                                                                                                                    </span>
<span class="6176356407772671184" onmouseenter="enter('6176356407772671184');" onmouseout="out('6176356407772671184');" style=""> 560          attachIndexableDocumentFields(document, indexable, fields, locales);                                      </span>
<span  style=""> 561                                                                                                                    </span>
<span class="-7308801397401646621" onmouseenter="enter('-7308801397401646621');" onmouseout="out('-7308801397401646621');" style=""> 562          attachAdditionalDocumentFields(indexable, document);                                                      </span>
<span  style=""> 563                                                                                                                    </span>
<span class="581573764679058551" onmouseenter="enter('581573764679058551');" onmouseout="out('581573764679058551');" style=""> 564          extensionManager.getProxy().attachChildDocuments(indexable, document, fields, locales);                   </span>
<span  style=""> 565                                                                                                                    </span>
<span class="-4026438827530914052" onmouseenter="enter('-4026438827530914052');" onmouseout="out('-4026438827530914052');" style=""> 566          return document;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567      }                                                                                                             </span>
<span  style=""> 568                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 569      @Override                                                                                                     </span>
<span class="-2827903308009028143" onmouseenter="enter('-2827903308009028143');" onmouseout="out('-2827903308009028143');" style=""><abbr title=" 570      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 570      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fiðŸ”µ</abbr></span>
<span class="-7267711193404106417" onmouseenter="enter('-7267711193404106417');" onmouseout="out('-7267711193404106417');" style=""> 571          for (IndexField indexField : fields) {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 572              try {                                                                                                 </span>
<span class="-5685362315060478990" onmouseenter="enter('-5685362315060478990');" onmouseout="out('-5685362315060478990');" style=""> 573                  // If we find an IndexField entry for this field, then we need to store it in the index           </span>
<span class="-6138117391173223373" onmouseenter="enter('-6138117391173223373');" onmouseout="out('-6138117391173223373');" style=""> 574                  if (indexField != null) {                                                                         </span>
<span class="-1605896855845279090" onmouseenter="enter('-1605896855845279090');" onmouseout="out('-1605896855845279090');" style=""> 575                      List&lt;IndexFieldType&gt; searchableFieldTypes = indexField.getFieldTypes();                       </span>
<span  style=""> 576                                                                                                                    </span>
<span class="7314822488779147745" onmouseenter="enter('7314822488779147745');" onmouseout="out('7314822488779147745');" style=""><abbr title=" 577                      // For each of its search field types, get the property values, and add a field to the document for each property value"> 577                      // For each of its search field types, get the property values, and add a field to the documenðŸ”µ</abbr></span>
<span class="9127582384821892356" onmouseenter="enter('9127582384821892356');" onmouseout="out('9127582384821892356');" style=""> 578                      for (IndexFieldType sft : searchableFieldTypes) {                                             </span>
<span class="-1855754965803101801" onmouseenter="enter('-1855754965803101801');" onmouseout="out('-1855754965803101801');" style=""> 579                          FieldType fieldType = sft.getFieldType();                                                 </span>
<span class="1213494569726901077" onmouseenter="enter('1213494569726901077');" onmouseout="out('1213494569726901077');" style=""><abbr title=" 580                          Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getField(), fieldType, locales);"> 580                          Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getField(), fðŸ”µ</abbr></span>
<span  style=""> 581                                                                                                                    </span>
<span class="2731937647730128807" onmouseenter="enter('2731937647730128807');" onmouseout="out('2731937647730128807');" style=""><abbr title=" 582                          ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentForIndexField(document, indexField, fieldType, propertyValues);"> 582                          ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentForIndexFieðŸ”µ</abbr></span>
<span  style=""> 583                                                                                                                    </span>
<span class="-2046283582941202064" onmouseenter="enter('-2046283582941202064');" onmouseout="out('-2046283582941202064');" style=""> 584                          if (ExtensionResultStatusType.NOT_HANDLED.equals(result)) {                               </span>
<span class="1818285189854508408" onmouseenter="enter('1818285189854508408');" onmouseout="out('1818285189854508408');" style=""> 585                              // Build out the field for every prefix                                               </span>
<span class="-7947315413202592125" onmouseenter="enter('-7947315413202592125');" onmouseout="out('-7947315413202592125');" style=""> 586                              for (Entry&lt;String, Object&gt; entry : propertyValues.entrySet()) {                       </span>
<span class="-6275926878676507761" onmouseenter="enter('-6275926878676507761');" onmouseout="out('-6275926878676507761');" style=""> 587                                  String prefix = entry.getKey();                                                   </span>
<span class="2218524055946596429" onmouseenter="enter('2218524055946596429');" onmouseout="out('2218524055946596429');" style=""> 588                                  prefix = StringUtils.isBlank(prefix) ? prefix : prefix + &quot;_&quot;;                     </span>
<span  style=""> 589                                                                                                                    </span>
<span class="-3898910784215480067" onmouseenter="enter('-3898910784215480067');" onmouseout="out('-3898910784215480067');" style=""><abbr title=" 590                                  String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fieldType, prefix);"> 590                                  String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fieldType, ðŸ”µ</abbr></span>
<span class="-4401151924846137205" onmouseenter="enter('-4401151924846137205');" onmouseout="out('-4401151924846137205');" style=""> 591                                  Object value = entry.getValue();                                                  </span>
<span  style=""> 592                                                                                                                    </span>
<span class="626346901079283965" onmouseenter="enter('626346901079283965');" onmouseout="out('626346901079283965');" style=""> 593                                  if (FieldType.isMultiValued(fieldType)) {                                         </span>
<span class="-3165450242186121028" onmouseenter="enter('-3165450242186121028');" onmouseout="out('-3165450242186121028');" style=""> 594                                      document.addField(solrPropertyName, value);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 595                                  } else {                                                                          </span>
<span class="3313383578919119200" onmouseenter="enter('3313383578919119200');" onmouseout="out('3313383578919119200');" style=""> 596                                      document.setField(solrPropertyName, value);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601                  }                                                                                                 </span>
<span  style=""> 602                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 603              } catch (Exception e) {                                                                               </span>
<span class="3922644492767384995" onmouseenter="enter('3922644492767384995');" onmouseout="out('3922644492767384995');" style=""><abbr title=" 604                  LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldName() + &quot;] for product id[&quot;"> 604                  LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldName() + &quot;]ðŸ”µ</abbr></span>
<span class="6260448561791331284" onmouseenter="enter('6260448561791331284');" onmouseout="out('6260448561791331284');" style=""> 605                          + indexable.getId() + &quot;]&quot;, e);                                                            </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 606                  throw ExceptionHelper.refineException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609      }                                                                                                             </span>
<span  style=""> 610                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 611      /**                                                                                                           </span>
<span class="4238183781809234032" onmouseenter="enter('4238183781809234032');" onmouseout="out('4238183781809234032');" style=""> 612       * Implementors can extend this and override this method to add additional fields to the Solr document.       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 613       *                                                                                                            </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 614       * @param sku                                                                                                 </span>
<span class="-4531925645240977456" onmouseenter="enter('-4531925645240977456');" onmouseout="out('-4531925645240977456');" style=""> 615       * @param document                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 616       */                                                                                                           </span>
<span class="-8826176176899724303" onmouseenter="enter('-8826176176899724303');" onmouseout="out('-8826176176899724303');" style=""> 617      protected void attachAdditionalDocumentFields(Indexable indexable, SolrInputDocument document) {              </span>
<span class="2874503221562082086" onmouseenter="enter('2874503221562082086');" onmouseout="out('2874503221562082086');" style=""> 618          //Empty implementation. Placeholder for others to extend and add additional fields                        </span>
<span class="6562860541481637604" onmouseenter="enter('6562860541481637604');" onmouseout="out('6562860541481637604');" style=""> 619          extensionManager.getProxy().attachAdditionalDocumentFields(indexable, document);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620      }                                                                                                             </span>
<span  style=""> 621                                                                                                                    </span>
<span class="2269161038285740545" onmouseenter="enter('2269161038285740545');" onmouseout="out('2269161038285740545');" style=""> 622      protected void attachBasicDocumentFields(Indexable indexable, SolrInputDocument document) {                   </span>
<span class="3677952974140195445" onmouseenter="enter('3677952974140195445');" onmouseout="out('3677952974140195445');" style=""> 623          CatalogStructure cache = SolrIndexCachedOperation.getCache();                                             </span>
<span class="3690595679967484902" onmouseenter="enter('3690595679967484902');" onmouseout="out('3690595679967484902');" style=""> 624          if (cache == null) {                                                                                      </span>
<span class="-5953957341705739916" onmouseenter="enter('-5953957341705739916');" onmouseout="out('-5953957341705739916');" style=""> 625              String msg = &quot;SolrIndexService.performCachedOperation() must be used in conjuction with&quot;              </span>
<span class="5121342196990946089" onmouseenter="enter('5121342196990946089');" onmouseout="out('5121342196990946089');" style=""><abbr title=" 626                  + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog documents or should&quot;"> 626                  + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog documents oðŸ”µ</abbr></span>
<span class="5921421762371925976" onmouseenter="enter('5921421762371925976');" onmouseout="out('5921421762371925976');" style=""> 627                  + &quot; be invoked from buildIncrementalIndex()&quot;;                                                     </span>
<span class="4339245929318812534" onmouseenter="enter('4339245929318812534');" onmouseout="out('4339245929318812534');" style=""> 628              LOG.error(msg);                                                                                       </span>
<span class="86168282544735545" onmouseenter="enter('86168282544735545');" onmouseout="out('86168282544735545');" style=""> 629              throw new IllegalStateException(msg);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630          }                                                                                                         </span>
<span  style=""> 631                                                                                                                    </span>
<span class="-3140243218980457613" onmouseenter="enter('-3140243218980457613');" onmouseout="out('-3140243218980457613');" style=""> 632          // Add the namespace and ID fields for this product                                                       </span>
<span class="-8136043564923018877" onmouseenter="enter('-8136043564923018877');" onmouseout="out('-8136043564923018877');" style=""> 633          document.addField(shs.getNamespaceFieldName(), solrConfiguration.getNamespace());                         </span>
<span class="4638667037339624807" onmouseenter="enter('4638667037339624807');" onmouseout="out('4638667037339624807');" style=""> 634          document.addField(shs.getIdFieldName(), shs.getSolrDocumentId(document, indexable));                      </span>
<span class="-1745274961796795631" onmouseenter="enter('-1745274961796795631');" onmouseout="out('-1745274961796795631');" style=""> 635          document.addField(shs.getTypeFieldName(), shs.getDocumentType(indexable));                                </span>
<span class="4848544160674821385" onmouseenter="enter('4848544160674821385');" onmouseout="out('4848544160674821385');" style=""> 636          document.addField(shs.getIndexableIdFieldName(), shs.getIndexableId(indexable));                          </span>
<span  style=""> 637                                                                                                                    </span>
<span class="4524398296663961208" onmouseenter="enter('4524398296663961208');" onmouseout="out('4524398296663961208');" style=""> 638          extensionManager.getProxy().attachAdditionalBasicFields(indexable, document, shs);                        </span>
<span  style=""> 639                                                                                                                    </span>
<span class="8081444938024983637" onmouseenter="enter('8081444938024983637');" onmouseout="out('8081444938024983637');" style=""> 640          Long cacheKey = this.shs.getCurrentProductId(indexable); // current                                       </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 641          if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                        </span>
<span class="1019588205807698651" onmouseenter="enter('1019588205807698651');" onmouseout="out('1019588205807698651');" style=""> 642              cacheKey = sandBoxHelper.getOriginalId(cacheKey); // parent                                           </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 643              if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                    </span>
<span class="-2582971950633728748" onmouseenter="enter('-2582971950633728748');" onmouseout="out('-2582971950633728748');" style=""> 644                  cacheKey = shs.getIndexableId(indexable); // master                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646          }                                                                                                         </span>
<span  style=""> 647                                                                                                                    </span>
<span class="-5777629244031949400" onmouseenter="enter('-5777629244031949400');" onmouseout="out('-5777629244031949400');" style=""> 648          // TODO: figure this out more generally; this doesn&#x27;t work for CMS content                                </span>
<span class="-6650188849299086912" onmouseenter="enter('-6650188849299086912');" onmouseout="out('-6650188849299086912');" style=""> 649          // The explicit categories are the ones defined by the product itself                                     </span>
<span class="-9160995028433643624" onmouseenter="enter('-9160995028433643624');" onmouseout="out('-9160995028433643624');" style=""> 650          if (cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                         </span>
<span class="4256320710674012617" onmouseenter="enter('4256320710674012617');" onmouseout="out('4256320710674012617');" style=""> 651              for (Long categoryId : cache.getParentCategoriesByProduct().get(cacheKey)) {                          </span>
<span class="8455722384905122433" onmouseenter="enter('8455722384905122433');" onmouseout="out('8455722384905122433');" style=""> 652                  document.addField(shs.getExplicitCategoryFieldName(), shs.getCategoryId(categoryId));             </span>
<span  style=""> 653                                                                                                                    </span>
<span class="2226871268244895600" onmouseenter="enter('2226871268244895600');" onmouseout="out('2226871268244895600');" style=""> 654                  // Make sure that we&#x27;re always referencing the parent for the sort field                          </span>
<span class="885050313007205730" onmouseenter="enter('885050313007205730');" onmouseout="out('885050313007205730');" style=""> 655                  String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId));       </span>
<span class="2056097617960887013" onmouseenter="enter('2056097617960887013');" onmouseout="out('2056097617960887013');" style=""><abbr title=" 656                  // The issue here was the super category id is always what is stored in the cache, while the category"> 656                  // The issue here was the super category id is always what is stored in the cache, while the categðŸ”µ</abbr></span>
<span class="-892018914725665598" onmouseenter="enter('-892018914725665598');" onmouseout="out('-892018914725665598');" style=""><abbr title=" 657                  // by product id is the overridden versions. Need to always look at parent version for cache stuff, which"> 657                  // by product id is the overridden versions. Need to always look at parent version for cache stuffðŸ”µ</abbr></span>
<span class="-9167754401626692888" onmouseenter="enter('-9167754401626692888');" onmouseout="out('-9167754401626692888');" style=""> 658                  // is given from shs.getCategoryId                                                                </span>
<span class="-5291059882317809252" onmouseenter="enter('-5291059882317809252');" onmouseout="out('-5291059882317809252');" style=""> 659                  // First try the current level                                                                    </span>
<span class="-431096296060400570" onmouseenter="enter('-431096296060400570');" onmouseout="out('-431096296060400570');" style=""> 660                  String displayOrderKey = categoryId + &quot;-&quot; + cacheKey;                                             </span>
<span class="-2136310867529994982" onmouseenter="enter('-2136310867529994982');" onmouseout="out('-2136310867529994982');" style=""> 661                  Long displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                            </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 662                  if (displayOrder == null) {                                                                       </span>
<span class="-23846589771862516" onmouseenter="enter('-23846589771862516');" onmouseout="out('-23846589771862516');" style=""> 663                      // Didn&#x27;t find the cache at the current level, this might be an override so look upwards      </span>
<span class="-2522276541728086971" onmouseenter="enter('-2522276541728086971');" onmouseout="out('-2522276541728086971');" style=""> 664                      displayOrderKey = shs.getCategoryId(categoryId) + &quot;-&quot; + cacheKey;                             </span>
<span class="-4225610511634364677" onmouseenter="enter('-4225610511634364677');" onmouseout="out('-4225610511634364677');" style=""> 665                      displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666                  }                                                                                                 </span>
<span  style=""> 667                                                                                                                    </span>
<span class="-1309608839151321080" onmouseenter="enter('-1309608839151321080');" onmouseout="out('-1309608839151321080');" style=""> 668                  if (document.getField(categorySortFieldName) == null &amp;&amp; displayOrder != null) {                   </span>
<span class="-139575474281341237" onmouseenter="enter('-139575474281341237');" onmouseout="out('-139575474281341237');" style=""> 669                      document.addField(categorySortFieldName, displayOrder);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 670                  }                                                                                                 </span>
<span  style=""> 671                                                                                                                    </span>
<span class="368279688641772108" onmouseenter="enter('368279688641772108');" onmouseout="out('368279688641772108');" style=""> 672                  // This is the entire tree of every category defined on the product                               </span>
<span class="7804252118891085182" onmouseenter="enter('7804252118891085182');" onmouseout="out('7804252118891085182');" style=""> 673                  buildFullCategoryHierarchy(document, cache, categoryId, new HashSet&lt;Long&gt;());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676      }                                                                                                             </span>
<span  style=""> 677                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 678      /**                                                                                                           </span>
<span class="6681629456063376998" onmouseenter="enter('6681629456063376998');" onmouseout="out('6681629456063376998');" style=""> 679       * Walk the category hierarchy upwards, adding a field for each level to the solr document                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 680       *                                                                                                            </span>
<span class="1689379025577151242" onmouseenter="enter('1689379025577151242');" onmouseout="out('1689379025577151242');" style=""> 681       * @param document the solr document for the product                                                          </span>
<span class="-7318706520602943649" onmouseenter="enter('-7318706520602943649');" onmouseout="out('-7318706520602943649');" style=""> 682       * @param cache the catalog structure cache                                                                   </span>
<span class="-6836312806010046064" onmouseenter="enter('-6836312806010046064');" onmouseout="out('-6836312806010046064');" style=""> 683       * @param categoryId the current category id                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 684       */                                                                                                           </span>
<span class="2161311715252659768" onmouseenter="enter('2161311715252659768');" onmouseout="out('2161311715252659768');" style=""><abbr title=" 685      protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long categoryId, Set&lt;Long&gt; indexedParents) {"> 685      protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long categoryId,ðŸ”µ</abbr></span>
<span class="3164345535572197299" onmouseenter="enter('3164345535572197299');" onmouseout="out('3164345535572197299');" style=""> 686          Long catIdToAdd = shs.getCategoryId(categoryId);                                                          </span>
<span  style=""> 687                                                                                                                    </span>
<span class="-3890718915071250281" onmouseenter="enter('-3890718915071250281');" onmouseout="out('-3890718915071250281');" style=""> 688          Collection&lt;Object&gt; existingValues = document.getFieldValues(shs.getCategoryFieldName());                  </span>
<span class="6039307398262207081" onmouseenter="enter('6039307398262207081');" onmouseout="out('6039307398262207081');" style=""> 689          if (existingValues == null || !existingValues.contains(catIdToAdd)) {                                     </span>
<span class="527969679087238607" onmouseenter="enter('527969679087238607');" onmouseout="out('527969679087238607');" style=""> 690              document.addField(shs.getCategoryFieldName(), catIdToAdd);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691          }                                                                                                         </span>
<span  style=""> 692                                                                                                                    </span>
<span class="6863771221853966476" onmouseenter="enter('6863771221853966476');" onmouseout="out('6863771221853966476');" style=""> 693          Set&lt;Long&gt; parents = cache.getParentCategoriesByCategory().get(categoryId);                                </span>
<span class="-2911148901929748808" onmouseenter="enter('-2911148901929748808');" onmouseout="out('-2911148901929748808');" style=""> 694          for (Long parent : parents) {                                                                             </span>
<span class="-7460726028904993058" onmouseenter="enter('-7460726028904993058');" onmouseout="out('-7460726028904993058');" style=""> 695              if (!indexedParents.contains(parent)) {                                                               </span>
<span class="7294571508456102427" onmouseenter="enter('7294571508456102427');" onmouseout="out('7294571508456102427');" style=""> 696                  indexedParents.add(parent);                                                                       </span>
<span class="-1881502435741878283" onmouseenter="enter('-1881502435741878283');" onmouseout="out('-1881502435741878283');" style=""> 697                  buildFullCategoryHierarchy(document, cache, parent, indexedParents);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 700      }                                                                                                             </span>
<span  style=""> 701                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 702      /**                                                                                                           </span>
<span class="-4462927116106886000" onmouseenter="enter('-4462927116106886000');" onmouseout="out('-4462927116106886000');" style=""><abbr title=" 703       * Returns a map of prefix to value for the requested attributes. For example, if the requested field corresponds to"> 703       * Returns a map of prefix to value for the requested attributes. For example, if the requested field correspoðŸ”µ</abbr></span>
<span class="-4378589169221473186" onmouseenter="enter('-4378589169221473186');" onmouseout="out('-4378589169221473186');" style=""><abbr title=" 704       * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting map could be"> 704       * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting map couldðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 705       *                                                                                                            </span>
<span class="4965494886678626130" onmouseenter="enter('4965494886678626130');" onmouseout="out('4965494886678626130');" style=""> 706       * { &quot;en_US&quot; : &quot;A description&quot;,                                                                               </span>
<span class="-259254215439445341" onmouseenter="enter('-259254215439445341');" onmouseout="out('-259254215439445341');" style=""> 707       *   &quot;es_ES&quot; : &quot;Una descripcion&quot; }                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 708       *                                                                                                            </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 709       * @param product                                                                                             </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 710       * @param sku                                                                                                 </span>
<span class="-2810227465158556501" onmouseenter="enter('-2810227465158556501');" onmouseout="out('-2810227465158556501');" style=""> 711       * @param field                                                                                               </span>
<span class="8333989749186698144" onmouseenter="enter('8333989749186698144');" onmouseout="out('8333989749186698144');" style=""> 712       * @param fieldType                                                                                           </span>
<span class="4196076978965854681" onmouseenter="enter('4196076978965854681');" onmouseout="out('4196076978965854681');" style=""> 713       * @param locales                                                                                             </span>
<span class="8270246261244700409" onmouseenter="enter('8270246261244700409');" onmouseout="out('8270246261244700409');" style=""> 714       * @return the value of the property                                                                          </span>
<span class="8083004877096205463" onmouseenter="enter('8083004877096205463');" onmouseout="out('8083004877096205463');" style=""> 715       * @throws IllegalAccessException                                                                             </span>
<span class="-5812785901555574031" onmouseenter="enter('-5812785901555574031');" onmouseout="out('-5812785901555574031');" style=""> 716       * @throws InvocationTargetException                                                                          </span>
<span class="-7952440753472318794" onmouseenter="enter('-7952440753472318794');" onmouseout="out('-7952440753472318794');" style=""> 717       * @throws NoSuchMethodException                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 718       */                                                                                                           </span>
<span class="8748893838745138853" onmouseenter="enter('8748893838745138853');" onmouseout="out('8748893838745138853');" style=""><abbr title=" 719      protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldType, List&lt;Locale&gt; locales)"> 719      protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldType, List&lt;ðŸ”µ</abbr></span>
<span class="1769827535532852924" onmouseenter="enter('1769827535532852924');" onmouseout="out('1769827535532852924');" style=""> 720              throws IllegalAccessException, InvocationTargetException, NoSuchMethodException {                     </span>
<span  style=""> 721                                                                                                                    </span>
<span class="6107905045905939603" onmouseenter="enter('6107905045905939603');" onmouseout="out('6107905045905939603');" style=""> 722          String propertyName = field.getPropertyName();                                                            </span>
<span class="-4589490168925589742" onmouseenter="enter('-4589490168925589742');" onmouseout="out('-4589490168925589742');" style=""> 723          Map&lt;String, Object&gt; values = new HashMap&lt;&gt;();                                                             </span>
<span  style=""> 724                                                                                                                    </span>
<span class="6659346108356717008" onmouseenter="enter('6659346108356717008');" onmouseout="out('6659346108356717008');" style=""> 725          ExtensionResultStatusType extensionResult = ExtensionResultStatusType.NOT_HANDLED;                        </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 726          if (extensionManager != null) {                                                                           </span>
<span class="-9204729919056407683" onmouseenter="enter('-9204729919056407683');" onmouseout="out('-9204729919056407683');" style=""><abbr title=" 727              extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldType, values, propertyName, locales);"> 727              extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldType, values,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728          }                                                                                                         </span>
<span  style=""> 729                                                                                                                    </span>
<span class="978300925065413292" onmouseenter="enter('978300925065413292');" onmouseout="out('978300925065413292');" style=""> 730          if (ExtensionResultStatusType.NOT_HANDLED.equals(extensionResult)) {                                      </span>
<span class="-4780873355376927780" onmouseenter="enter('-4780873355376927780');" onmouseout="out('-4780873355376927780');" style=""> 731              Object propertyValue = shs.getPropertyValue(indexedItem, field);                                      </span>
<span class="-3197092395980898064" onmouseenter="enter('-3197092395980898064');" onmouseout="out('-3197092395980898064');" style=""> 732              if (propertyValue != null) {                                                                          </span>
<span class="2260924254129751704" onmouseenter="enter('2260924254129751704');" onmouseout="out('2260924254129751704');" style=""> 733                  values.put(&quot;&quot;, propertyValue);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 735          }                                                                                                         </span>
<span  style=""> 736                                                                                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 737          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738      }                                                                                                             </span>
<span  style=""> 739                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 740      /**                                                                                                           </span>
<span class="9061850100512653526" onmouseenter="enter('9061850100512653526');" onmouseout="out('9061850100512653526');" style=""> 741       * Converts a propertyName to one that is able to reference inside a map. For example, consider the property  </span>
<span class="-895456647484563444" onmouseenter="enter('-895456647484563444');" onmouseout="out('-895456647484563444');" style=""> 742       * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utility method </span>
<span class="-552833576006343516" onmouseenter="enter('-552833576006343516');" onmouseout="out('-552833576006343516');" style=""> 743       * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed by the name</span>
<span class="825713137907557548" onmouseenter="enter('825713137907557548');" onmouseout="out('825713137907557548');" style=""> 744       * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttributes&quot;, </span>
<span class="-5368406654183806848" onmouseenter="enter('-5368406654183806848');" onmouseout="out('-5368406654183806848');" style=""> 745       * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; that      </span>
<span class="2947641499517828088" onmouseenter="enter('2947641499517828088');" onmouseout="out('2947641499517828088');" style=""> 746       * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatRange&quot;,  </span>
<span class="-7978269712217451802" onmouseenter="enter('-7978269712217451802');" onmouseout="out('-7978269712217451802');" style=""> 747       * this method will convert this property to mappedProductAttributes(heatRange).value, which is then usable   </span>
<span class="2645537127888120036" onmouseenter="enter('2645537127888120036');" onmouseout="out('2645537127888120036');" style=""> 748       * by the standard beanutils PropertyUtils class to get the value.                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 749       *                                                                                                            </span>
<span class="-7192310373251332281" onmouseenter="enter('-7192310373251332281');" onmouseout="out('-7192310373251332281');" style=""> 750       * @param propertyName                                                                                        </span>
<span class="4673892841275975431" onmouseenter="enter('4673892841275975431');" onmouseout="out('4673892841275975431');" style=""> 751       * @param listPropertyName                                                                                    </span>
<span class="-3179260629250258297" onmouseenter="enter('-3179260629250258297');" onmouseout="out('-3179260629250258297');" style=""> 752       * @param mapPropertyName                                                                                     </span>
<span class="3476440775818037910" onmouseenter="enter('3476440775818037910');" onmouseout="out('3476440775818037910');" style=""> 753       * @return the converted property name                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 754       *                                                                                                            </span>
<span class="52899359164217029" onmouseenter="enter('52899359164217029');" onmouseout="out('52899359164217029');" style=""> 755       * @deprecated see SolrHelperService.getPropertyValue()                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 756       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 757      @Deprecated                                                                                                   </span>
<span class="-8166943252759778933" onmouseenter="enter('-8166943252759778933');" onmouseout="out('-8166943252759778933');" style=""><abbr title=" 758      protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropertyName) {"> 758      protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropertyName)ðŸ”µ</abbr></span>
<span class="1454213590133189928" onmouseenter="enter('1454213590133189928');" onmouseout="out('1454213590133189928');" style=""> 759          String[] splitName = StringUtils.split(propertyName, &quot;\\.&quot;);                                              </span>
<span class="8763032247946290041" onmouseenter="enter('8763032247946290041');" onmouseout="out('8763032247946290041');" style=""> 760          StringBuilder convertedProperty = new StringBuilder();                                                    </span>
<span class="6897833212568273038" onmouseenter="enter('6897833212568273038');" onmouseout="out('6897833212568273038');" style=""> 761          for (int i = 0; i &lt; splitName.length; i++) {                                                              </span>
<span class="7476336611017662047" onmouseenter="enter('7476336611017662047');" onmouseout="out('7476336611017662047');" style=""> 762              if (convertedProperty.length() &gt; 0) {                                                                 </span>
<span class="3942759274962034898" onmouseenter="enter('3942759274962034898');" onmouseout="out('3942759274962034898');" style=""> 763                  convertedProperty.append(&quot;.&quot;);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764              }                                                                                                     </span>
<span  style=""> 765                                                                                                                    </span>
<span class="-5101250235350090861" onmouseenter="enter('-5101250235350090861');" onmouseout="out('-5101250235350090861');" style=""> 766              if (splitName[i].equals(listPropertyName)) {                                                          </span>
<span class="5747881404112979701" onmouseenter="enter('5747881404112979701');" onmouseout="out('5747881404112979701');" style=""> 767                  convertedProperty.append(mapPropertyName).append(&quot;(&quot;);                                            </span>
<span class="-4744112788117022497" onmouseenter="enter('-4744112788117022497');" onmouseout="out('-4744112788117022497');" style=""> 768                  convertedProperty.append(splitName[i + 1]).append(&quot;).value&quot;);                                     </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 769                  i++;                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 770              } else {                                                                                              </span>
<span class="-2902127022925554102" onmouseenter="enter('-2902127022925554102');" onmouseout="out('-2902127022925554102');" style=""> 771                  convertedProperty.append(splitName[i]);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773          }                                                                                                         </span>
<span class="5092332446699272394" onmouseenter="enter('5092332446699272394');" onmouseout="out('5092332446699272394');" style=""> 774          return convertedProperty.toString();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775      }                                                                                                             </span>
<span  style=""> 776                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 777      @Override                                                                                                     </span>
<span class="-3936693135713622895" onmouseenter="enter('-3936693135713622895');" onmouseout="out('-3936693135713622895');" style=""> 778      public Object[] saveState() {                                                                                 </span>
<span class="6340072029414808943" onmouseenter="enter('6340072029414808943');" onmouseout="out('6340072029414808943');" style=""> 779           return new Object[] {                                                                                    </span>
<span class="-1198820822862086393" onmouseenter="enter('-1198820822862086393');" onmouseout="out('-1198820822862086393');" style=""> 780               BroadleafRequestContext.getBroadleafRequestContext(),                                                </span>
<span class="4468406610576348115" onmouseenter="enter('4468406610576348115');" onmouseout="out('4468406610576348115');" style=""> 781               SkuPricingConsiderationContext.getSkuPricingConsiderationContext(),                                  </span>
<span class="-4551736393079008426" onmouseenter="enter('-4551736393079008426');" onmouseout="out('-4551736393079008426');" style=""> 782               SkuPricingConsiderationContext.getSkuPricingService(),                                               </span>
<span class="3011904497645750283" onmouseenter="enter('3011904497645750283');" onmouseout="out('3011904497645750283');" style=""> 783               SkuActiveDateConsiderationContext.getSkuActiveDatesService()                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 784           };                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785       }                                                                                                            </span>
<span  style=""> 786                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 787      @Override                                                                                                     </span>
<span class="-1725049255621638202" onmouseenter="enter('-1725049255621638202');" onmouseout="out('-1725049255621638202');" style=""> 788      @SuppressWarnings(&quot;rawtypes&quot;)                                                                                 </span>
<span class="-799181704487695614" onmouseenter="enter('-799181704487695614');" onmouseout="out('-799181704487695614');" style=""> 789      public void restoreState(Object[] pack) {                                                                     </span>
<span class="5773741038987480013" onmouseenter="enter('5773741038987480013');" onmouseout="out('5773741038987480013');" style=""> 790           BroadleafRequestContext.setBroadleafRequestContext((BroadleafRequestContext) pack[0]);                   </span>
<span class="-7019853679694091506" onmouseenter="enter('-7019853679694091506');" onmouseout="out('-7019853679694091506');" style=""> 791           SkuPricingConsiderationContext.setSkuPricingConsiderationContext((HashMap) pack[1]);                     </span>
<span class="4085014913476561326" onmouseenter="enter('4085014913476561326');" onmouseout="out('4085014913476561326');" style=""> 792           SkuPricingConsiderationContext.setSkuPricingService((DynamicSkuPricingService) pack[2]);                 </span>
<span class="-8007069714826871365" onmouseenter="enter('-8007069714826871365');" onmouseout="out('-8007069714826871365');" style=""> 793           SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3]);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794       }                                                                                                            </span>
<span  style=""> 795                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 796      @Override                                                                                                     </span>
<span class="3365555763697732929" onmouseenter="enter('3365555763697732929');" onmouseout="out('3365555763697732929');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 797 -    public void optimizeIndex(SolrClient server) throws ServiceException, IOException {                           </span>
<span class="-7586705105215270214" onmouseenter="enter('-7586705105215270214');" onmouseout="out('-7586705105215270214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 798 -        shs.optimizeIndex(server);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 799 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 800 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 801 -    @Override                                                                                                     </span>
<span class="8022176589656897042" onmouseenter="enter('8022176589656897042');" onmouseout="out('8022176589656897042');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 802 -    public void commit(SolrClient server) throws ServiceException, IOException {                                  </span>
<span class="-9091641891346182972" onmouseenter="enter('-9091641891346182972');" onmouseout="out('-9091641891346182972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 803 +    public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException {        </span>
<span class="-2539995639166621773" onmouseenter="enter('-2539995639166621773');" onmouseout="out('-2539995639166621773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 804 +        shs.optimizeIndex(collection, server);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 805 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 806 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 807 +    @Override                                                                                                     </span>
<span class="7341867013968379883" onmouseenter="enter('7341867013968379883');" onmouseout="out('7341867013968379883');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 808 +    public void commit(String collection, SolrClient server) throws ServiceException, IOException {               </span>
<span class="7675894021553797865" onmouseenter="enter('7675894021553797865');" onmouseout="out('7675894021553797865');" style=""> 809          if (this.commit) {                                                                                        </span>
<span class="4198520714946338996" onmouseenter="enter('4198520714946338996');" onmouseout="out('4198520714946338996');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 810 -            commit(server, this.softCommit, this.waitSearcher, this.waitFlush);                                   </span>
<span class="-6090512425803845008" onmouseenter="enter('-6090512425803845008');" onmouseout="out('-6090512425803845008');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 811 +            commit(collection, server, this.softCommit, this.waitSearcher, this.waitFlush);                       </span>
<span class="6963313292914152592" onmouseenter="enter('6963313292914152592');" onmouseout="out('6963313292914152592');" style=""> 812          } else if (LOG.isDebugEnabled()) {                                                                        </span>
<span class="1765076834887086466" onmouseenter="enter('1765076834887086466');" onmouseout="out('1765076834887086466');" style=""><abbr title=" 813              LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoCommit is configured.&quot;);"> 813              LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoCommit is coðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 815      }                                                                                                             </span>
<span  style=""> 816                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 817      @Override                                                                                                     </span>
<span class="4402093086393350326" onmouseenter="enter('4402093086393350326');" onmouseout="out('4402093086393350326');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 818 -    public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 818 -    public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServðŸ”µ</abbr></span>
<span class="-5625380272333943282" onmouseenter="enter('-5625380272333943282');" onmouseout="out('-5625380272333943282');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 819 +    public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 819 +    public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waiðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 820          try {                                                                                                     </span>
<span class="897708696444656733" onmouseenter="enter('897708696444656733');" onmouseout="out('897708696444656733');" style=""> 821              if (!this.commit) {                                                                                   </span>
<span class="9109442794169141002" onmouseenter="enter('9109442794169141002');" onmouseout="out('9109442794169141002');" style=""><abbr title=" 822                  LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is being forced via the API.&quot;);"> 822                  LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is being forced vðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823              }                                                                                                     </span>
<span  style=""> 824                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 825              if (LOG.isDebugEnabled()) {                                                                           </span>
<span class="-8336995023402134302" onmouseenter="enter('-8336995023402134302');" onmouseout="out('-8336995023402134302');" style=""> 826                  LOG.debug(&quot;Committing changes to Solr index: softCommit: &quot; + softCommit                           </span>
<span class="8772898042441368535" onmouseenter="enter('8772898042441368535');" onmouseout="out('8772898042441368535');" style=""> 827                          + &quot;, waitSearcher: &quot; + waitSearcher + &quot;, waitFlush: &quot; + waitFlush);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828              }                                                                                                     </span>
<span  style=""> 829                                                                                                                    </span>
<span class="7487026730073104755" onmouseenter="enter('7487026730073104755');" onmouseout="out('7487026730073104755');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 830 -            server.commit(waitFlush, waitSearcher, softCommit);                                                   </span>
<span class="-4946339855213882534" onmouseenter="enter('-4946339855213882534');" onmouseout="out('-4946339855213882534');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 831 +            server.commit(collection, waitFlush, waitSearcher, softCommit);                                       </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 832          } catch (SolrServerException e) {                                                                         </span>
<span class="6480332907391821448" onmouseenter="enter('6480332907391821448');" onmouseout="out('6480332907391821448');" style=""> 833              throw new ServiceException(&quot;Could not commit changes to Solr index&quot;, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835      }                                                                                                             </span>
<span  style=""> 836                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 837      @Override                                                                                                     </span>
<span class="-235343663931086975" onmouseenter="enter('-235343663931086975');" onmouseout="out('-235343663931086975');" style=""> 838      public void logDocuments(Collection&lt;SolrInputDocument&gt; documents) {                                           </span>
<span class="1446253227197554536" onmouseenter="enter('1446253227197554536');" onmouseout="out('1446253227197554536');" style=""> 839          if (LOG.isTraceEnabled()) {                                                                               </span>
<span class="-4118597588854644187" onmouseenter="enter('-4118597588854644187');" onmouseout="out('-4118597588854644187');" style=""> 840              for (SolrInputDocument document : documents) {                                                        </span>
<span class="3338392633918275305" onmouseenter="enter('3338392633918275305');" onmouseout="out('3338392633918275305');" style=""> 841                  LOG.trace(document);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 842              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844      }                                                                                                             </span>
<span  style=""> 845                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 846      /**                                                                                                           </span>
<span class="-4161606046612334483" onmouseenter="enter('-4161606046612334483');" onmouseout="out('-4161606046612334483');" style=""> 847       *  We multiply the BigDecimal by 1,000,000 to maintain any possible decimals in use the                      </span>
<span class="1095534727201270293" onmouseenter="enter('1095534727201270293');" onmouseout="out('1095534727201270293');" style=""> 848       *  displayOrder value.                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 849       *                                                                                                            </span>
<span class="1237233419561726312" onmouseenter="enter('1237233419561726312');" onmouseout="out('1237233419561726312');" style=""> 850       * @param cache                                                                                               </span>
<span class="-4411905951100486196" onmouseenter="enter('-4411905951100486196');" onmouseout="out('-4411905951100486196');" style=""> 851       * @param displayOrderKey                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 852       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 853       */                                                                                                           </span>
<span class="1635922478501180747" onmouseenter="enter('1635922478501180747');" onmouseout="out('1635922478501180747');" style=""> 854      protected Long convertDisplayOrderToLong(CatalogStructure cache, String displayOrderKey) {                    </span>
<span class="4518367233651177280" onmouseenter="enter('4518367233651177280');" onmouseout="out('4518367233651177280');" style=""> 855          BigDecimal displayOrder = cache.getDisplayOrdersByCategoryProduct().get(displayOrderKey);                 </span>
<span  style=""> 856                                                                                                                    </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 857          if (displayOrder == null) {                                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 858              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859          }                                                                                                         </span>
<span  style=""> 860                                                                                                                    </span>
<span class="4133773492119237930" onmouseenter="enter('4133773492119237930');" onmouseout="out('4133773492119237930');" style=""> 861          return displayOrder.multiply(BigDecimal.valueOf(1000000)).longValue();                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862      }                                                                                                             </span>
<span  style=""> 863                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 864      @Override                                                                                                     </span>
<span class="4004348612697349075" onmouseenter="enter('4004348612697349075');" onmouseout="out('4004348612697349075');" style=""> 865      public void deleteByQuery(String deleteQuery) throws SolrServerException, IOException {                       </span>
<span class="1027311076504650094" onmouseenter="enter('1027311076504650094');" onmouseout="out('1027311076504650094');" style=""> 866          String productFilter = shs.getTypeFieldName() + &quot;:&quot; + shs.getPrimaryDocumentType();                       </span>
<span  style=""> 867                                                                                                                    </span>
<span class="1739252735366935461" onmouseenter="enter('1739252735366935461');" onmouseout="out('1739252735366935461');" style=""><abbr title=" 868          // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t delete non-product documents accidentally"> 868          // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t deletðŸ”µ</abbr></span>
<span class="8967770841500493181" onmouseenter="enter('8967770841500493181');" onmouseout="out('8967770841500493181');" style=""> 869          deleteQuery = productFilter + &quot; AND (&quot; + deleteQuery + &quot;)&quot;;                                               </span>
<span  style=""> 870                                                                                                                    </span>
<span class="35790388838229419" onmouseenter="enter('35790388838229419');" onmouseout="out('35790388838229419');" style=""> 871          String childDeleteQuery = &quot;{!child of=&quot; + productFilter + &quot;} &quot; + deleteQuery;                             </span>
<span class="-5097470124987660196" onmouseenter="enter('-5097470124987660196');" onmouseout="out('-5097470124987660196');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 872 -        solrConfiguration.getServer().deleteByQuery(childDeleteQuery);                                            </span>
<span class="-4328599925487855664" onmouseenter="enter('-4328599925487855664');" onmouseout="out('-4328599925487855664');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 873 -        solrConfiguration.getServer().deleteByQuery(deleteQuery);                                                 </span>
<span class="-5958139659148111368" onmouseenter="enter('-5958139659148111368');" onmouseout="out('-5958139659148111368');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 874 +        solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), childDeleteQuery);</span>
<span class="870065906158081107" onmouseenter="enter('870065906158081107');" onmouseout="out('870065906158081107');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 875 +        solrConfiguration.getServer().deleteByQuery(solrConfiguration.getQueryCollectionName(), deleteQuery);     </span>
<span  style=""> 876                                                                                                                    </span>
<span class="2572292351348869388" onmouseenter="enter('2572292351348869388');" onmouseout="out('2572292351348869388');" style=""> 877          logDeleteQuery(childDeleteQuery);                                                                         </span>
<span class="-7276176933862949274" onmouseenter="enter('-7276176933862949274');" onmouseout="out('-7276176933862949274');" style=""> 878          logDeleteQuery(deleteQuery);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879      }                                                                                                             </span>
<span  style=""> 880                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 881      @Override                                                                                                     </span>
<span class="-7948321486753422000" onmouseenter="enter('-7948321486753422000');" onmouseout="out('-7948321486753422000');" style=""> 882      public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException {   </span>
<span class="-3675518693353771931" onmouseenter="enter('-3675518693353771931');" onmouseout="out('-3675518693353771931');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 883 -        solrConfiguration.getServer().add(documents);                                                             </span>
<span class="-1557641774356947070" onmouseenter="enter('-1557641774356947070');" onmouseout="out('-1557641774356947070');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 884 +        solrConfiguration.getServer().add(solrConfiguration.getQueryCollectionName(), documents);                 </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 885          logDocuments(documents);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886      }                                                                                                             </span>
<span  style=""> 887                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 888      @Override                                                                                                     </span>
<span class="5429697153738572572" onmouseenter="enter('5429697153738572572');" onmouseout="out('5429697153738572572');" style=""> 889      public void logDeleteQuery(String deleteQuery) {                                                              </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 890          if (LOG.isDebugEnabled()) {                                                                               </span>
<span class="1652863876971966554" onmouseenter="enter('1652863876971966554');" onmouseout="out('1652863876971966554');" style=""> 891              LOG.debug(&quot;Delete query: &quot; + deleteQuery);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 892          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 893      }                                                                                                             </span>
<span  style=""> 894                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 895 +    @Override                                                                                                     </span>
<span class="8474819187366488777" onmouseenter="enter('8474819187366488777');" onmouseout="out('8474819187366488777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 896 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 896 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient soðŸ”µ</abbr></span>
<span class="1797277787154549011" onmouseenter="enter('1797277787154549011');" onmouseout="out('1797277787154549011');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 897 +        return buildIncrementalIndex(null, indexables, solrServer);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 898 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 899 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 900 +    @Override                                                                                                     </span>
<span class="3365555763697732929" onmouseenter="enter('3365555763697732929');" onmouseout="out('3365555763697732929');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 901 +    public void optimizeIndex(SolrClient server) throws ServiceException, IOException {                           </span>
<span class="-604246973254031119" onmouseenter="enter('-604246973254031119');" onmouseout="out('-604246973254031119');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 902 +        optimizeIndex(null, server);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 903 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 904 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 905 +    @Override                                                                                                     </span>
<span class="8022176589656897042" onmouseenter="enter('8022176589656897042');" onmouseout="out('8022176589656897042');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 906 +    public void commit(SolrClient server) throws ServiceException, IOException {                                  </span>
<span class="8538330963534152673" onmouseenter="enter('8538330963534152673');" onmouseout="out('8538330963534152673');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 907 +        commit(null, server);                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 908 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 909 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 910 +    @Override                                                                                                     </span>
<span class="4402093086393350326" onmouseenter="enter('4402093086393350326');" onmouseout="out('4402093086393350326');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 911 +    public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 911 +    public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServðŸ”µ</abbr></span>
<span class="-6149532067307109215" onmouseenter="enter('-6149532067307109215');" onmouseout="out('-6149532067307109215');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 912 +        commit(null, server, softCommit, waitSearcher, waitFlush);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 913 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 914 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 915 +    @Override                                                                                                     </span>
<span class="125965368563769580" onmouseenter="enter('125965368563769580');" onmouseout="out('125965368563769580');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 916 +    public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException {                          </span>
<span class="-6644416202801761209" onmouseenter="enter('-6644416202801761209');" onmouseout="out('-6644416202801761209');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 917 +        deleteAllNamespaceDocuments(null, server);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 918 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 919 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 920 +    @Override                                                                                                     </span>
<span class="31475417648561827" onmouseenter="enter('31475417648561827');" onmouseout="out('31475417648561827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 921 +    public void deleteAllDocuments(SolrClient server) throws ServiceException {                                   </span>
<span class="6597141509256723624" onmouseenter="enter('6597141509256723624');" onmouseout="out('6597141509256723624');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 922 +        deleteAllDocuments(null, server);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 923 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 924 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 925  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="1122494097902733579" onmouseenter="enter('1122494097902733579');" onmouseout="out('1122494097902733579');" style="">  18  package org.broadleafcommerce.core.search.service.solr.index;                                                     </span>
<span  style="">  19                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="7358117227230759843" onmouseenter="enter('7358117227230759843');" onmouseout="out('7358117227230759843');" style="">  21  import org.apache.commons.lang3.ObjectUtils;                                                                      </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="5774725166806839225" onmouseenter="enter('5774725166806839225');" onmouseout="out('5774725166806839225');" style="">  25  import org.apache.solr.client.solrj.SolrClient;                                                                   </span>
<span class="2534520300286315365" onmouseenter="enter('2534520300286315365');" onmouseout="out('2534520300286315365');" style="">  26  import org.apache.solr.client.solrj.SolrServerException;                                                          </span>
<span class="3039478051879307902" onmouseenter="enter('3039478051879307902');" onmouseout="out('3039478051879307902');" style="">  27  import org.apache.solr.common.SolrInputDocument;                                                                  </span>

<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  28  import org.broadleafcommerce.common.exception.ExceptionHelper;                                                    </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  29  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  30  import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                          </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  31  import org.broadleafcommerce.common.locale.domain.Locale;                                                         </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  32  import org.broadleafcommerce.common.locale.service.LocaleService;                                                 </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  33  import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                                        </span>
<span class="-4286566313930798693" onmouseenter="enter('-4286566313930798693');" onmouseout="out('-4286566313930798693');" style="">  34  import org.broadleafcommerce.common.site.domain.Catalog;                                                          </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  35  import org.broadleafcommerce.common.util.BLCCollectionUtils;                                                      </span>
<span class="-8450438836187654019" onmouseenter="enter('-8450438836187654019');" onmouseout="out('-8450438836187654019');" style="">  36  import org.broadleafcommerce.common.util.StopWatch;                                                               </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  37  import org.broadleafcommerce.common.util.StringUtil;                                                              </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  38  import org.broadleafcommerce.common.util.TransactionUtils;                                                        </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  39  import org.broadleafcommerce.common.util.TypedTransformer;                                                        </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  40  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="-4682247906377627479" onmouseenter="enter('-4682247906377627479');" onmouseout="out('-4682247906377627479');" style="">  41  import org.broadleafcommerce.core.catalog.dao.ProductDao;                                                         </span>
<span class="-7703274845132439467" onmouseenter="enter('-7703274845132439467');" onmouseout="out('-7703274845132439467');" style="">  42  import org.broadleafcommerce.core.catalog.dao.SkuDao;                                                             </span>
<span class="819600147337546609" onmouseenter="enter('819600147337546609');" onmouseout="out('819600147337546609');" style="">  43  import org.broadleafcommerce.core.catalog.domain.Indexable;                                                       </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  44  import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                                   </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  45  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  46  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="-8898703314888663548" onmouseenter="enter('-8898703314888663548');" onmouseout="out('-8898703314888663548');" style="">  47  import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuActiveDatesService;                           </span>
<span class="4379279529485441894" onmouseenter="enter('4379279529485441894');" onmouseout="out('4379279529485441894');" style="">  48  import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuPricingService;                               </span>
<span class="-3681422864492833385" onmouseenter="enter('-3681422864492833385');" onmouseout="out('-3681422864492833385');" style="">  49  import org.broadleafcommerce.core.catalog.service.dynamic.SkuActiveDateConsiderationContext;                      </span>
<span class="-829094426310214064" onmouseenter="enter('-829094426310214064');" onmouseout="out('-829094426310214064');" style="">  50  import org.broadleafcommerce.core.catalog.service.dynamic.SkuPricingConsiderationContext;                         </span>
<span class="-1576266836408736884" onmouseenter="enter('-1576266836408736884');" onmouseout="out('-1576266836408736884');" style="">  51  import org.broadleafcommerce.core.search.dao.CatalogStructure;                                                    </span>
<span class="3400766289256993125" onmouseenter="enter('3400766289256993125');" onmouseout="out('3400766289256993125');" style="">  52  import org.broadleafcommerce.core.search.dao.FieldDao;                                                            </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  53  import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                                       </span>
<span class="920426074093689209" onmouseenter="enter('920426074093689209');" onmouseout="out('920426074093689209');" style="">  54  import org.broadleafcommerce.core.search.dao.SearchFacetDao;                                                      </span>
<span class="-5322157128750858217" onmouseenter="enter('-5322157128750858217');" onmouseout="out('-5322157128750858217');" style="">  55  import org.broadleafcommerce.core.search.dao.SolrIndexDao;                                                        </span>
<span class="4766648382130970293" onmouseenter="enter('4766648382130970293');" onmouseout="out('4766648382130970293');" style="">  56  import org.broadleafcommerce.core.search.domain.Field;                                                            </span>
<span class="-5357326536069928479" onmouseenter="enter('-5357326536069928479');" onmouseout="out('-5357326536069928479');" style="">  57  import org.broadleafcommerce.core.search.domain.FieldEntity;                                                      </span>
<span class="6698299629643684636" onmouseenter="enter('6698299629643684636');" onmouseout="out('6698299629643684636');" style="">  58  import org.broadleafcommerce.core.search.domain.IndexField;                                                       </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  59  import org.broadleafcommerce.core.search.domain.IndexFieldType;                                                   </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  60  import org.broadleafcommerce.core.search.domain.solr.FieldType;                                                   </span>
<span class="5698008419148469327" onmouseenter="enter('5698008419148469327');" onmouseout="out('5698008419148469327');" style="">  61  import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;                                          </span>
<span class="1831820877510608733" onmouseenter="enter('1831820877510608733');" onmouseout="out('1831820877510608733');" style="">  62  import org.broadleafcommerce.core.search.service.solr.SolrHelperService;                                          </span>
<span class="-138378224551372777" onmouseenter="enter('-138378224551372777');" onmouseout="out('-138378224551372777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import org.springframework.beans.factory.InitializingBean;                                                        </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  64  import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  65  import org.springframework.beans.factory.annotation.Qualifier;                                                    </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  66  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  67  import org.springframework.stereotype.Service;                                                                    </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  68  import org.springframework.transaction.PlatformTransactionManager;                                                </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  69  import org.springframework.transaction.TransactionDefinition;                                                     </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  70  import org.springframework.transaction.TransactionStatus;                                                         </span>
<span  style="">  71                                                                                                                    </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  72  import java.io.IOException;                                                                                       </span>
<span class="5727252987923913" onmouseenter="enter('5727252987923913');" onmouseout="out('5727252987923913');" style="">  73  import java.lang.reflect.InvocationTargetException;                                                               </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  74  import java.math.BigDecimal;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  75  import java.util.ArrayList;                                                                                       </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  76  import java.util.Collection;                                                                                      </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  77  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  78  import java.util.HashSet;                                                                                         </span>

<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  79  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  80  import java.util.Map;                                                                                             </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  81  import java.util.Map.Entry;                                                                                       </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  82  import java.util.Set;                                                                                             </span>
<span  style="">  83                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  84  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  85                                                                                                                    </span>
<span  style="">  86                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  87  /**                                                                                                               </span>
<span class="2637600201222846009" onmouseenter="enter('2637600201222846009');" onmouseout="out('2637600201222846009');" style="">  88   * Responsible for building and rebuilding the Solr index                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  89   *                                                                                                                </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  90   * @author Andre Azzolini (apazzolini)                                                                            </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  91   * @author Jeff Fischer                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  92   */                                                                                                               </span>
<span class="5147427781650963861" onmouseenter="enter('5147427781650963861');" onmouseout="out('5147427781650963861');" style="">  93  @Service(&quot;blSolrIndexService&quot;)                                                                                    </span>
<span class="-304032367336242137" onmouseenter="enter('-304032367336242137');" onmouseout="out('-304032367336242137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -public class SolrIndexServiceImpl implements SolrIndexService {                                                   </span>
<span class="7238718603103423444" onmouseenter="enter('7238718603103423444');" onmouseout="out('7238718603103423444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +public class SolrIndexServiceImpl implements SolrIndexService, InitializingBean {                                 </span>
<span  style="">  96                                                                                                                    </span>
<span class="2912831792317267849" onmouseenter="enter('2912831792317267849');" onmouseout="out('2912831792317267849');" style="">  97      private static final Log LOG = LogFactory.getLog(SolrIndexServiceImpl.class);                                 </span>
<span  style="">  98                                                                                                                    </span>
<span class="-8977974913293567232" onmouseenter="enter('-8977974913293567232');" onmouseout="out('-8977974913293567232');" style="">  99      @Qualifier(&quot;blCatalogSolrConfiguration&quot;)                                                                      </span>
<span class="2602789178515286342" onmouseenter="enter('2602789178515286342');" onmouseout="out('2602789178515286342');" style=""> 100      @Autowired(required = false)                                                                                  </span>
<span class="-8579597795724805463" onmouseenter="enter('-8579597795724805463');" onmouseout="out('-8579597795724805463');" style=""> 101      protected SolrConfiguration solrConfiguration;                                                                </span>
<span  style=""> 102                                                                                                                    </span>
<span class="2195771720820037705" onmouseenter="enter('2195771720820037705');" onmouseout="out('2195771720820037705');" style=""> 103      @Value(&quot;${solr.index.errorOnConcurrentReIndex}&quot;)                                                              </span>
<span class="-1712197847076792635" onmouseenter="enter('-1712197847076792635');" onmouseout="out('-1712197847076792635');" style=""> 104      protected boolean errorOnConcurrentReIndex = false;                                                           </span>
<span  style=""> 105                                                                                                                    </span>
<span class="7048903042822364298" onmouseenter="enter('7048903042822364298');" onmouseout="out('7048903042822364298');" style=""> 106      @Value(&quot;${solr.index.product.pageSize}&quot;)                                                                      </span>
<span class="-4484811886017880292" onmouseenter="enter('-4484811886017880292');" onmouseout="out('-4484811886017880292');" style=""> 107      protected int pageSize;                                                                                       </span>
<span  style=""> 108                                                                                                                    </span>
<span class="-7778680861452564194" onmouseenter="enter('-7778680861452564194');" onmouseout="out('-7778680861452564194');" style=""> 109      @Value(&quot;${solr.index.use.sku}&quot;)                                                                               </span>
<span class="4533755734414020763" onmouseenter="enter('4533755734414020763');" onmouseout="out('4533755734414020763');" style=""> 110      protected boolean useSku;                                                                                     </span>
<span  style=""> 111                                                                                                                    </span>
<span class="8105652327274456362" onmouseenter="enter('8105652327274456362');" onmouseout="out('8105652327274456362');" style=""> 112      @Value(&quot;${solr.index.commit}&quot;)                                                                                </span>
<span class="2310160779081566815" onmouseenter="enter('2310160779081566815');" onmouseout="out('2310160779081566815');" style=""> 113      protected boolean commit;                                                                                     </span>
<span  style=""> 114                                                                                                                    </span>
<span class="4958585362396000858" onmouseenter="enter('4958585362396000858');" onmouseout="out('4958585362396000858');" style=""> 115      @Value(&quot;${solr.index.softCommit}&quot;)                                                                            </span>
<span class="-7523707349512810888" onmouseenter="enter('-7523707349512810888');" onmouseout="out('-7523707349512810888');" style=""> 116      protected boolean softCommit;                                                                                 </span>
<span  style=""> 117                                                                                                                    </span>
<span class="2752166020843058826" onmouseenter="enter('2752166020843058826');" onmouseout="out('2752166020843058826');" style=""> 118      @Value(&quot;${solr.index.waitSearcher}&quot;)                                                                          </span>
<span class="-7977681737585438995" onmouseenter="enter('-7977681737585438995');" onmouseout="out('-7977681737585438995');" style=""> 119      protected boolean waitSearcher;                                                                               </span>
<span  style=""> 120                                                                                                                    </span>
<span class="-1787870543439636120" onmouseenter="enter('-1787870543439636120');" onmouseout="out('-1787870543439636120');" style=""> 121      @Value(&quot;${solr.index.waitFlush}&quot;)                                                                             </span>
<span class="-1071744707232356027" onmouseenter="enter('-1071744707232356027');" onmouseout="out('-1071744707232356027');" style=""> 122      protected boolean waitFlush;                                                                                  </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-504996646074126996" onmouseenter="enter('-504996646074126996');" onmouseout="out('-504996646074126996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +    @Value(value = &quot;${solr.catalog.useLegacySolrIndexer:true}&quot;)                                                   </span>
<span class="598047637926589746" onmouseenter="enter('598047637926589746');" onmouseout="out('598047637926589746');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +    protected boolean useLegacySolrIndexer = true;                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                                                                                                                  </span>
<span class="-8581768554675866702" onmouseenter="enter('-8581768554675866702');" onmouseout="out('-8581768554675866702');" style=""> 127      @Resource(name = &quot;blProductDao&quot;)                                                                              </span>
<span class="8458703512033747413" onmouseenter="enter('8458703512033747413');" onmouseout="out('8458703512033747413');" style=""> 128      protected ProductDao productDao;                                                                              </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-2173743794931306759" onmouseenter="enter('-2173743794931306759');" onmouseout="out('-2173743794931306759');" style=""> 130      @Resource(name = &quot;blSkuDao&quot;)                                                                                  </span>
<span class="7538466299033825182" onmouseenter="enter('7538466299033825182');" onmouseout="out('7538466299033825182');" style=""> 131      protected SkuDao skuDao;                                                                                      </span>
<span  style=""> 132                                                                                                                    </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style=""> 133      @Resource(name = &quot;blCatalogService&quot;)                                                                          </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 134      protected CatalogService catalogService;                                                                      </span>
<span  style=""> 135                                                                                                                    </span>
<span class="8745422771459947563" onmouseenter="enter('8745422771459947563');" onmouseout="out('8745422771459947563');" style=""> 136      @Resource(name = &quot;blFieldDao&quot;)                                                                                </span>
<span class="-5779425042369505145" onmouseenter="enter('-5779425042369505145');" onmouseout="out('-5779425042369505145');" style=""> 137      protected FieldDao fieldDao;                                                                                  </span>
<span  style=""> 138                                                                                                                    </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style=""> 139      @Resource(name = &quot;blLocaleService&quot;)                                                                           </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style=""> 140      protected LocaleService localeService;                                                                        </span>
<span  style=""> 141                                                                                                                    </span>
<span class="3433532014428154380" onmouseenter="enter('3433532014428154380');" onmouseout="out('3433532014428154380');" style=""> 142      @Resource(name = &quot;blSolrHelperService&quot;)                                                                       </span>
<span class="-7677498150151406376" onmouseenter="enter('-7677498150151406376');" onmouseout="out('-7677498150151406376');" style=""> 143      protected SolrHelperService shs;                                                                              </span>
<span  style=""> 144                                                                                                                    </span>
<span class="6454351128227777183" onmouseenter="enter('6454351128227777183');" onmouseout="out('6454351128227777183');" style=""> 145      @Resource(name = &quot;blSolrIndexServiceExtensionManager&quot;)                                                        </span>
<span class="5247479920184811971" onmouseenter="enter('5247479920184811971');" onmouseout="out('5247479920184811971');" style=""> 146      protected SolrIndexServiceExtensionManager extensionManager;                                                  </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 148      @Resource(name = &quot;blTransactionManager&quot;)                                                                      </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 149      protected PlatformTransactionManager transactionManager;                                                      </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-2777716978602743792" onmouseenter="enter('-2777716978602743792');" onmouseout="out('-2777716978602743792');" style=""> 151      @Resource(name = &quot;blSolrIndexDao&quot;)                                                                            </span>
<span class="2803857682022434599" onmouseenter="enter('2803857682022434599');" onmouseout="out('2803857682022434599');" style=""> 152      protected SolrIndexDao solrIndexDao;                                                                          </span>
<span  style=""> 153                                                                                                                    </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 154      @Resource(name = &quot;blSandBoxHelper&quot;)                                                                           </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 155      protected SandBoxHelper sandBoxHelper;                                                                        </span>
<span  style=""> 156                                                                                                                    </span>
<span class="722550641335667641" onmouseenter="enter('722550641335667641');" onmouseout="out('722550641335667641');" style=""> 157      @Resource(name = &quot;blSearchFacetDao&quot;)                                                                          </span>
<span class="-2192164507887589197" onmouseenter="enter('-2192164507887589197');" onmouseout="out('-2192164507887589197');" style=""> 158      protected SearchFacetDao searchFacetDao;                                                                      </span>
<span  style=""> 159                                                                                                                    </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style=""> 160      @Resource(name = &quot;blIndexFieldDao&quot;)                                                                           </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style=""> 161      protected IndexFieldDao indexFieldDao;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +    @Override                                                                                                     </span>
<span class="293221034776945003" onmouseenter="enter('293221034776945003');" onmouseout="out('293221034776945003');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +    public void afterPropertiesSet() throws Exception {                                                           </span>
<span class="8737826944751881878" onmouseenter="enter('8737826944751881878');" onmouseout="out('8737826944751881878');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +        if (!useLegacySolrIndexer) {                                                                              </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +            if (useSku) {                                                                                         </span>
<span class="9179894285227722563" onmouseenter="enter('9179894285227722563');" onmouseout="out('9179894285227722563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 167 +                throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.use.sku&#x27; was true, which is not supported.&quot;);"> 167 +                throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;sðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +            }                                                                                                     </span>
<span class="-3752749985901808876" onmouseenter="enter('-3752749985901808876');" onmouseout="out('-3752749985901808876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +            if (solrConfiguration != null &amp;&amp; solrConfiguration.isSiteCollections()) {                             </span>
<span class="-7184456578586809293" onmouseenter="enter('-7184456578586809293');" onmouseout="out('-7184456578586809293');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 170 +                throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;solr.index.site.collections&#x27; was true, which is not supported.&quot;);"> 170 +                throw new IllegalStateException(&quot;The property &#x27;solr.catalog.useLegacySolrIndexer&#x27; was false and &#x27;sðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +    }                                                                                                             </span>
<span  style=""> 174                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175      @Override                                                                                                     </span>
<span class="-1854653869970518806" onmouseenter="enter('-1854653869970518806');" onmouseout="out('-1854653869970518806');" style=""><abbr title=" 176      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException {"> 176      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceExcepðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 177          try {                                                                                                     </span>
<span class="2574663780463066494" onmouseenter="enter('2574663780463066494');" onmouseout="out('2574663780463066494');" style=""> 178              CatalogStructure cache = new CatalogStructure();                                                      </span>
<span class="1856999562212420811" onmouseenter="enter('1856999562212420811');" onmouseout="out('1856999562212420811');" style=""> 179              SolrIndexCachedOperation.setCache(cache);                                                             </span>
<span class="-195994336271238110" onmouseenter="enter('-195994336271238110');" onmouseout="out('-195994336271238110');" style=""> 180              cacheOperation.execute();                                                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 181          } finally {                                                                                               </span>
<span class="7293095816713805281" onmouseenter="enter('7293095816713805281');" onmouseout="out('7293095816713805281');" style=""> 182              SolrIndexCachedOperation.clearCache();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184      }                                                                                                             </span>
<span  style=""> 185                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 186      @Override                                                                                                     </span>
<span class="-8221211564360382808" onmouseenter="enter('-8221211564360382808');" onmouseout="out('-8221211564360382808');" style=""> 187      public void rebuildIndex() throws ServiceException, IOException {                                             </span>
<span class="4404402464743924238" onmouseenter="enter('4404402464743924238');" onmouseout="out('4404402464743924238');" style=""> 188          LOG.info(&quot;Rebuilding the entire Solr index...&quot;);                                                          </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 189          StopWatch s = new StopWatch();                                                                            </span>
<span  style=""> 190                                                                                                                    </span>
<span class="2782448594641417849" onmouseenter="enter('2782448594641417849');" onmouseout="out('2782448594641417849');" style=""> 191          preBuildIndex();                                                                                          </span>
<span class="5364167027467208466" onmouseenter="enter('5364167027467208466');" onmouseout="out('5364167027467208466');" style=""> 192          buildIndex();                                                                                             </span>
<span class="-2734214044106280557" onmouseenter="enter('-2734214044106280557');" onmouseout="out('-2734214044106280557');" style=""> 193          postBuildIndex();                                                                                         </span>
<span  style=""> 194                                                                                                                    </span>
<span class="8949756262532963545" onmouseenter="enter('8949756262532963545');" onmouseout="out('8949756262532963545');" style=""> 195          LOG.info(String.format(&quot;Finished building entire Solr index in %s&quot;, s.toLapString()));                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196      }                                                                                                             </span>
<span  style=""> 197                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 198      @Override                                                                                                     </span>
<span class="3237807690855435825" onmouseenter="enter('3237807690855435825');" onmouseout="out('3237807690855435825');" style=""> 199      public void preBuildIndex() throws ServiceException {                                                         </span>
<span class="4144911976389655481" onmouseenter="enter('4144911976389655481');" onmouseout="out('4144911976389655481');" style=""> 200          deleteAllNamespaceDocuments(solrConfiguration.getReindexServer());                                        </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201      }                                                                                                             </span>
<span  style=""> 202                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 203      @Override                                                                                                     </span>
<span class="107860368930590037" onmouseenter="enter('107860368930590037');" onmouseout="out('107860368930590037');" style=""> 204      public void buildIndex() throws IOException, ServiceException {                                               </span>
<span class="5469402358120203042" onmouseenter="enter('5469402358120203042');" onmouseout="out('5469402358120203042');" style=""> 205          executeSolrIndexOperation(getReindexOperation());                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206      }                                                                                                             </span>
<span  style=""> 207                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 208      @Override                                                                                                     </span>
<span class="2712485588427861869" onmouseenter="enter('2712485588427861869');" onmouseout="out('2712485588427861869');" style=""> 209      public void postBuildIndex() throws IOException, ServiceException {                                           </span>
<span class="4104911694494191311" onmouseenter="enter('4104911694494191311');" onmouseout="out('4104911694494191311');" style=""> 210          // this is required to be at the very very very end after rebuilding the whole index                      </span>
<span class="1908736344096538941" onmouseenter="enter('1908736344096538941');" onmouseout="out('1908736344096538941');" style=""> 211          optimizeIndex(solrConfiguration.getReindexServer());                                                      </span>




<span class="-7179442614804219935" onmouseenter="enter('-7179442614804219935');" onmouseout="out('-7179442614804219935');" style=""> 212          // Swap the active and the reindex cores                                                                  </span>
<span class="-211335379164132987" onmouseenter="enter('-211335379164132987');" onmouseout="out('-211335379164132987');" style=""> 213          if (!solrConfiguration.isSingleCoreMode()) {                                                              </span>
<span class="-1073514264710403192" onmouseenter="enter('-1073514264710403192');" onmouseout="out('-1073514264710403192');" style=""> 214              shs.swapActiveCores(solrConfiguration);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 218      @Override                                                                                                     </span>
<span class="-811355888891304948" onmouseenter="enter('-811355888891304948');" onmouseout="out('-811355888891304948');" style=""> 219      public SolrIndexOperation getReindexOperation() {                                                             </span>
<span class="4313634092062438466" onmouseenter="enter('4313634092062438466');" onmouseout="out('4313634092062438466');" style=""> 220          return new GlobalSolrFullReIndexOperation(this, solrConfiguration, shs, errorOnConcurrentReIndex) {       </span>
<span  style=""> 221                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 222              @Override                                                                                             </span>
<span class="-4387595312024622473" onmouseenter="enter('-4387595312024622473');" onmouseout="out('-4387595312024622473');" style=""> 223              public List&lt;? extends Indexable&gt; readIndexables(int pageSize, Long lastId) {                          </span>
<span class="4006405235344016633" onmouseenter="enter('4006405235344016633');" onmouseout="out('4006405235344016633');" style=""> 224                  return readAllActiveIndexables(pageSize, lastId);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225              }                                                                                                     </span>
<span  style=""> 226                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 227              @Override                                                                                             </span>
<span class="5959961393917647667" onmouseenter="enter('5959961393917647667');" onmouseout="out('5959961393917647667');" style=""> 228              public Long countIndexables() {                                                                       </span>
<span class="2520275452674275986" onmouseenter="enter('2520275452674275986');" onmouseout="out('2520275452674275986');" style=""> 229                  return countIndexableItems();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230              }                                                                                                     </span>
<span  style=""> 231                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 232              @Override                                                                                             </span>
<span class="-1692826682113823468" onmouseenter="enter('-1692826682113823468');" onmouseout="out('-1692826682113823468');" style=""> 233              public void buildPage(List&lt;? extends Indexable&gt; indexables) throws ServiceException {                 </span>
<span class="-621226516327610454" onmouseenter="enter('-621226516327610454');" onmouseout="out('-621226516327610454');" style=""> 234                  buildIncrementalIndex(indexables, getSolrServerForIndexing());                                    </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 236          };                                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237      }                                                                                                             </span>
<span  style=""> 238                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 239      @Override                                                                                                     </span>
<span class="-4119273796811407274" onmouseenter="enter('-4119273796811407274');" onmouseout="out('-4119273796811407274');" style=""><abbr title=" 240      public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOException {"> 240      public void executeSolrIndexOperation(final SolrIndexOperation operation) throws ServiceException, IOExceptionðŸ”µ</abbr></span>
<span class="-6605112368804100748" onmouseenter="enter('-6605112368804100748');" onmouseout="out('-6605112368804100748');" style=""> 241          operation.obtainLock();                                                                                   </span>
<span  style=""> 242                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 243          try {                                                                                                     </span>
<span class="5776764097449375233" onmouseenter="enter('5776764097449375233');" onmouseout="out('5776764097449375233');" style=""> 244              LOG.info(&quot;Executing Indexing operation&quot;);                                                             </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 245              StopWatch s = new StopWatch();                                                                        </span>
<span  style=""> 246                                                                                                                    </span>
<span class="-4925351317711298127" onmouseenter="enter('-4925351317711298127');" onmouseout="out('-4925351317711298127');" style=""> 247              Object[] pack = saveState();                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 248              try {                                                                                                 </span>
<span class="4852869320838830283" onmouseenter="enter('4852869320838830283');" onmouseout="out('4852869320838830283');" style=""> 249                  final Long numItemsToIndex;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 250                  try {                                                                                             </span>
<span class="997617649642836840" onmouseenter="enter('997617649642836840');" onmouseout="out('997617649642836840');" style=""> 251                      operation.beforeCountIndexables();                                                            </span>
<span  style=""> 252                                                                                                                    </span>
<span class="-8341915703694509082" onmouseenter="enter('-8341915703694509082');" onmouseout="out('-8341915703694509082');" style=""> 253                      numItemsToIndex = operation.countIndexables();                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 254                  } finally {                                                                                       </span>
<span class="8625682159596383443" onmouseenter="enter('8625682159596383443');" onmouseout="out('8625682159596383443');" style=""> 255                      operation.afterCountIndexables();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256                  }                                                                                                 </span>
<span  style=""> 257                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 258                  if (LOG.isDebugEnabled()) {                                                                       </span>
<span class="-1342537230534112505" onmouseenter="enter('-1342537230534112505');" onmouseout="out('-1342537230534112505');" style=""> 259                      LOG.debug(&quot;There are at most &quot; + numItemsToIndex + &quot; items to index&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260                  }                                                                                                 </span>
<span class="-6975585634623067095" onmouseenter="enter('-6975585634623067095');" onmouseout="out('-6975585634623067095');" style=""> 261                  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {                            </span>
<span  style=""> 262                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 263                      @Override                                                                                     </span>
<span class="-7096128206041696180" onmouseenter="enter('-7096128206041696180');" onmouseout="out('-7096128206041696180');" style=""> 264                      public void execute() throws ServiceException {                                               </span>
<span class="-4395739824177979579" onmouseenter="enter('-4395739824177979579');" onmouseout="out('-4395739824177979579');" style=""> 265                          int page = 1;                                                                             </span>
<span class="4634490409390119351" onmouseenter="enter('4634490409390119351');" onmouseout="out('4634490409390119351');" style=""> 266                          Long lastId = null;                                                                       </span>
<span class="-2807153128771866015" onmouseenter="enter('-2807153128771866015');" onmouseout="out('-2807153128771866015');" style=""> 267                          Long remainingNumItemsToIndex = numItemsToIndex;                                          </span>
<span class="-6866370637183701575" onmouseenter="enter('-6866370637183701575');" onmouseout="out('-6866370637183701575');" style=""> 268                          Long totalPages = getTotalPageCount(numItemsToIndex);                                     </span>
<span  style=""> 269                                                                                                                    </span>
<span class="-2134634807912211771" onmouseenter="enter('-2134634807912211771');" onmouseout="out('-2134634807912211771');" style=""> 270                          while (remainingNumItemsToIndex &gt; 0) {                                                    </span>
<span class="6951794882859960666" onmouseenter="enter('6951794882859960666');" onmouseout="out('6951794882859960666');" style=""> 271                              String pageNumberMessage = buildPageNumberMessage(page, totalPages);                  </span>
<span class="5716330204152709052" onmouseenter="enter('5716330204152709052');" onmouseout="out('5716330204152709052');" style=""> 272                              LOG.info(pageNumberMessage);                                                          </span>
<span  style=""> 273                                                                                                                    </span>
<span class="165772722778294439" onmouseenter="enter('165772722778294439');" onmouseout="out('165772722778294439');" style=""> 274                              lastId = buildIncrementalIndex(pageSize, lastId, operation);                          </span>
<span class="-4024045770293484238" onmouseenter="enter('-4024045770293484238');" onmouseout="out('-4024045770293484238');" style=""> 275                              remainingNumItemsToIndex -= pageSize;                                                 </span>
<span class="-8284897147643623971" onmouseenter="enter('-8284897147643623971');" onmouseout="out('-8284897147643623971');" style=""> 276                              page++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 279                  });                                                                                               </span>
<span  style=""> 280                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 281              } finally {                                                                                           </span>
<span class="-5823413484715712161" onmouseenter="enter('-5823413484715712161');" onmouseout="out('-5823413484715712161');" style=""> 282                  restoreState(pack);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283              }                                                                                                     </span>
<span  style=""> 284                                                                                                                    </span>
<span class="7093623796813341550" onmouseenter="enter('7093623796813341550');" onmouseout="out('7093623796813341550');" style=""> 285              LOG.info(String.format(&quot;Indexing operation completed in %s&quot;, s.toLapString()));                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 286          } finally {                                                                                               </span>
<span class="-1350180452435495402" onmouseenter="enter('-1350180452435495402');" onmouseout="out('-1350180452435495402');" style=""> 287              operation.releaseLock();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289      }                                                                                                             </span>
<span  style=""> 290                                                                                                                    </span>
<span class="4509881942909907564" onmouseenter="enter('4509881942909907564');" onmouseout="out('4509881942909907564');" style=""> 291      protected long getTotalPageCount(Long numItemsToIndex) {                                                      </span>
<span class="885623822255204209" onmouseenter="enter('885623822255204209');" onmouseout="out('885623822255204209');" style=""> 292          long numPagesToIndex = numItemsToIndex / pageSize;                                                        </span>
<span class="1202091708155781117" onmouseenter="enter('1202091708155781117');" onmouseout="out('1202091708155781117');" style=""> 293          boolean hasRemainingItemsToIndex = numItemsToIndex % pageSize != 0;                                       </span>
<span  style=""> 294                                                                                                                    </span>
<span class="-8914515660918232216" onmouseenter="enter('-8914515660918232216');" onmouseout="out('-8914515660918232216');" style=""> 295          return hasRemainingItemsToIndex ? (numPagesToIndex + 1) : numPagesToIndex;                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296      }                                                                                                             </span>
<span  style=""> 297                                                                                                                    </span>
<span class="-1140169622753247687" onmouseenter="enter('-1140169622753247687');" onmouseout="out('-1140169622753247687');" style=""> 298      protected String buildPageNumberMessage(int page, Long totalPages) {                                          </span>
<span class="5185167171670482872" onmouseenter="enter('5185167171670482872');" onmouseout="out('5185167171670482872');" style=""> 299          String pageNumberMessage = String.format(&quot;Building page number %s of %s&quot;, page, totalPages);              </span>
<span  style=""> 300                                                                                                                    </span>
<span class="3917690980387875903" onmouseenter="enter('3917690980387875903');" onmouseout="out('3917690980387875903');" style=""> 301          Catalog currentCatalog = BroadleafRequestContext.getBroadleafRequestContext().getCurrentCatalog();        </span>
<span class="3059190135946477261" onmouseenter="enter('3059190135946477261');" onmouseout="out('3059190135946477261');" style=""> 302          if (currentCatalog != null) {                                                                             </span>
<span class="-2760479412731933677" onmouseenter="enter('-2760479412731933677');" onmouseout="out('-2760479412731933677');" style=""> 303              pageNumberMessage += String.format(&quot; for catalog: %s&quot;, currentCatalog.getName());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304          }                                                                                                         </span>
<span  style=""> 305                                                                                                                    </span>
<span class="6061536256827306935" onmouseenter="enter('6061536256827306935');" onmouseout="out('6061536256827306935');" style=""> 306          return pageNumberMessage;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307      }                                                                                                             </span>
<span  style=""> 308                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 309      /**                                                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 310       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 311       */                                                                                                           </span>
<span class="307261357449118205" onmouseenter="enter('307261357449118205');" onmouseout="out('307261357449118205');" style=""> 312      protected Long countIndexableItems() {                                                                        </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style=""> 313          if (useSku) {                                                                                             </span>
<span class="-774456416256550159" onmouseenter="enter('-774456416256550159');" onmouseout="out('-774456416256550159');" style=""> 314              return skuDao.readCountAllActiveSkus();                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 315          } else {                                                                                                  </span>
<span class="3881831181376649254" onmouseenter="enter('3881831181376649254');" onmouseout="out('3881831181376649254');" style=""> 316              return productDao.readCountAllActiveProducts();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317          }                                                                                                         </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318      }                                                                                                             </span>
<span  style=""> 319                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 320      /**                                                                                                           </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 321       * &lt;p&gt;                                                                                                        </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 322       * This method deletes all of the documents from {@link SolrContext#getReindexServer()}                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 323       *                                                                                                            </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 324       * @throws ServiceException if there was a problem removing the documents                                     </span>
<span class="-1570570320656419415" onmouseenter="enter('-1570570320656419415');" onmouseout="out('-1570570320656419415');" style=""> 325       * @deprecated use {@link #deleteAllReindexCoreDocuments()} instead                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 326       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 327      @Deprecated                                                                                                   </span>
<span class="7799053882932808400" onmouseenter="enter('7799053882932808400');" onmouseout="out('7799053882932808400');" style=""> 328      protected void deleteAllDocuments() throws ServiceException {                                                 </span>
<span class="3834807060428836051" onmouseenter="enter('3834807060428836051');" onmouseout="out('3834807060428836051');" style=""> 329          deleteAllReindexCoreDocuments();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330      }                                                                                                             </span>
<span  style=""> 331                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 332      /**                                                                                                           </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 333       * &lt;p&gt;                                                                                                        </span>
<span class="3154276444761410738" onmouseenter="enter('3154276444761410738');" onmouseout="out('3154276444761410738');" style=""> 334       * This method deletes all of the documents from {@link SolrContext#getReindexServer()}                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 335       *                                                                                                            </span>
<span class="3412598748930426846" onmouseenter="enter('3412598748930426846');" onmouseout="out('3412598748930426846');" style=""> 336       * @throws ServiceException if there was a problem removing the documents                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 337       */                                                                                                           </span>
<span class="6870158579484852535" onmouseenter="enter('6870158579484852535');" onmouseout="out('6870158579484852535');" style=""> 338      protected void deleteAllReindexCoreDocuments() throws ServiceException {                                      </span>
<span class="4144911976389655481" onmouseenter="enter('4144911976389655481');" onmouseout="out('4144911976389655481');" style=""> 339          deleteAllNamespaceDocuments(solrConfiguration.getReindexServer());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340      }                                                                                                             </span>
<span  style=""> 341                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 342      @Override                                                                                                     </span>
<span class="125965368563769580" onmouseenter="enter('125965368563769580');" onmouseout="out('125965368563769580');" style=""> 343      public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException {                          </span>





<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 344          try {                                                                                                     </span>
<span class="-6389361698931234700" onmouseenter="enter('-6389361698931234700');" onmouseout="out('-6389361698931234700');" style=""> 345              String deleteQuery = StringUtil.sanitize(shs.getNamespaceFieldName()) + &quot;:(\&quot;&quot;                        </span>
<span class="-1195999488596466196" onmouseenter="enter('-1195999488596466196');" onmouseout="out('-1195999488596466196');" style=""> 346                      + StringUtil.sanitize(solrConfiguration.getNamespace()) + &quot;\&quot;)&quot;;                              </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 347              LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                                       </span>
<span class="-2796598282240712005" onmouseenter="enter('-2796598282240712005');" onmouseout="out('-2796598282240712005');" style=""> 348              server.deleteByQuery(deleteQuery);                                                                    </span>

<span  style=""> 349                                                                                                                    </span>
<span class="-546379745910436336" onmouseenter="enter('-546379745910436336');" onmouseout="out('-546379745910436336');" style=""> 350              //Explicitly do a hard commit here since we just deleted the entire index                             </span>
<span class="-3860280973525657844" onmouseenter="enter('-3860280973525657844');" onmouseout="out('-3860280973525657844');" style=""> 351              server.commit();                                                                                      </span>

<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 352          } catch (Exception e) {                                                                                   </span>
<span class="4280241435178863824" onmouseenter="enter('4280241435178863824');" onmouseout="out('4280241435178863824');" style=""> 353              if (ServiceException.class.isAssignableFrom(e.getClass())) {                                          </span>
<span class="-9048611182670468194" onmouseenter="enter('-9048611182670468194');" onmouseout="out('-9048611182670468194');" style=""> 354                  throw (ServiceException) e;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355              }                                                                                                     </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 356              throw new ServiceException(&quot;Could not delete documents&quot;, e);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358      }                                                                                                             </span>
<span  style=""> 359                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 360      @Override                                                                                                     </span>
<span class="31475417648561827" onmouseenter="enter('31475417648561827');" onmouseout="out('31475417648561827');" style=""> 361      public void deleteAllDocuments(SolrClient server) throws ServiceException {                                   </span>

<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 362          try {                                                                                                     </span>
<span class="2136303103230726070" onmouseenter="enter('2136303103230726070');" onmouseout="out('2136303103230726070');" style=""> 363              String deleteQuery = &quot;*:*&quot;;                                                                           </span>
<span class="-1908307727391183331" onmouseenter="enter('-1908307727391183331');" onmouseout="out('-1908307727391183331');" style=""> 364              LOG.debug(&quot;Deleting by query: &quot; + deleteQuery);                                                       </span>
<span class="-2796598282240712005" onmouseenter="enter('-2796598282240712005');" onmouseout="out('-2796598282240712005');" style=""> 365              server.deleteByQuery(deleteQuery);                                                                    </span>
<span class="-3860280973525657844" onmouseenter="enter('-3860280973525657844');" onmouseout="out('-3860280973525657844');" style=""> 366              server.commit();                                                                                      </span>


<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 367          } catch (Exception e) {                                                                                   </span>
<span class="1933728598272136967" onmouseenter="enter('1933728598272136967');" onmouseout="out('1933728598272136967');" style=""> 368              throw new ServiceException(&quot;Could not delete documents&quot;, e);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370      }                                                                                                             </span>
<span  style=""> 371                                                                                                                    </span>
<span class="-1911085678082561084" onmouseenter="enter('-1911085678082561084');" onmouseout="out('-1911085678082561084');" style=""><abbr title=" 372      protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ServiceException {"> 372      protected Long buildIncrementalIndex(int pageSize, Long lastId, SolrIndexOperation operation) throws ServiceExðŸ”µ</abbr></span>
<span class="1006805691441623516" onmouseenter="enter('1006805691441623516');" onmouseout="out('1006805691441623516');" style=""> 373          TransactionStatus status = TransactionUtils.createTransaction(&quot;readItemsToIndex&quot;,                         </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 374              TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                                </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 375          if (SolrIndexCachedOperation.getCache() == null) {                                                        </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 376              LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +            </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 377                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 377                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378          }                                                                                                         </span>
<span class="-4530225541058778702" onmouseenter="enter('-4530225541058778702');" onmouseout="out('-4530225541058778702');" style=""> 379          Long response = null;                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 380          try {                                                                                                     </span>
<span class="-3204111561138569714" onmouseenter="enter('-3204111561138569714');" onmouseout="out('-3204111561138569714');" style=""> 381              List&lt;? extends Indexable&gt; indexables;                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 382              try {                                                                                                 </span>
<span class="3356995070675471983" onmouseenter="enter('3356995070675471983');" onmouseout="out('3356995070675471983');" style=""> 383                  operation.beforeReadIndexables();                                                                 </span>
<span class="1315644369404660428" onmouseenter="enter('1315644369404660428');" onmouseout="out('1315644369404660428');" style=""> 384                  indexables = operation.readIndexables(pageSize, lastId);                                          </span>
<span class="-3163865863529807802" onmouseenter="enter('-3163865863529807802');" onmouseout="out('-3163865863529807802');" style=""> 385                  if (CollectionUtils.isNotEmpty(indexables)) {                                                     </span>
<span class="1879209496515446980" onmouseenter="enter('1879209496515446980');" onmouseout="out('1879209496515446980');" style=""> 386                      response = indexables.get(indexables.size()-1).getId();                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387                  }                                                                                                 </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 388              } finally {                                                                                           </span>
<span class="-7029725537576676912" onmouseenter="enter('-7029725537576676912');" onmouseout="out('-7029725537576676912');" style=""> 389                  operation.afterReadIndexables();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390              }                                                                                                     </span>
<span  style=""> 391                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 392              try {                                                                                                 </span>
<span class="-2168921446123257487" onmouseenter="enter('-2168921446123257487');" onmouseout="out('-2168921446123257487');" style=""> 393                  operation.beforeBuildPage();                                                                      </span>
<span  style=""> 394                                                                                                                    </span>
<span class="9094317700245591530" onmouseenter="enter('9094317700245591530');" onmouseout="out('9094317700245591530');" style=""> 395                  operation.buildPage(indexables);                                                                  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 396              } finally {                                                                                           </span>
<span class="3074038306845641791" onmouseenter="enter('3074038306845641791');" onmouseout="out('3074038306845641791');" style=""> 397                  operation.afterBuildPage();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398              }                                                                                                     </span>
<span  style=""> 399                                                                                                                    </span>
<span  style=""> 400                                                                                                                    </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 401              TransactionUtils.finalizeTransaction(status, transactionManager, false);                              </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 402          } catch (RuntimeException e) {                                                                            </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 403              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 404              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 406          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407      }                                                                                                             </span>
<span  style=""> 408                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 409      @Override                                                                                                     </span>
<span class="8474819187366488777" onmouseenter="enter('8474819187366488777');" onmouseout="out('8474819187366488777');" style=""><abbr title=" 410      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException {"> 410      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient soðŸ”µ</abbr></span>

<span class="2510928886343537128" onmouseenter="enter('2510928886343537128');" onmouseout="out('2510928886343537128');" style=""> 411          TransactionStatus status = TransactionUtils.createTransaction(&quot;executeIncrementalIndex&quot;,                  </span>
<span class="5715634927994073857" onmouseenter="enter('5715634927994073857');" onmouseout="out('5715634927994073857');" style=""> 412                  TransactionDefinition.PROPAGATION_REQUIRED, transactionManager, true);                            </span>
<span class="-2663727623830751523" onmouseenter="enter('-2663727623830751523');" onmouseout="out('-2663727623830751523');" style=""> 413          if (SolrIndexCachedOperation.getCache() == null) {                                                        </span>
<span class="5315253434748968720" onmouseenter="enter('5315253434748968720');" onmouseout="out('5315253434748968720');" style=""> 414              LOG.warn(&quot;Consider using SolrIndexService.performCachedOperation() in combination with &quot; +            </span>
<span class="-3297419628887486745" onmouseenter="enter('-3297419628887486745');" onmouseout="out('-3297419628887486745');" style=""><abbr title=" 415                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;);"> 415                      &quot;SolrIndexService.buildIncrementalIndex() for better caching performance during solr indexing&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416          }                                                                                                         </span>
<span  style=""> 417                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 418          if (LOG.isDebugEnabled()) {                                                                               </span>
<span class="5294183869527180393" onmouseenter="enter('5294183869527180393');" onmouseout="out('5294183869527180393');" style=""> 419              LOG.debug(String.format(&quot;Building incremental product index - pageSize: [%s]...&quot;, indexables.size()));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420          }                                                                                                         </span>
<span  style=""> 421                                                                                                                    </span>
<span class="8561669462181988185" onmouseenter="enter('8561669462181988185');" onmouseout="out('8561669462181988185');" style=""> 422          StopWatch s = new StopWatch();                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 423          try {                                                                                                     </span>
<span class="6539966544446663437" onmouseenter="enter('6539966544446663437');" onmouseout="out('6539966544446663437');" style=""> 424              sandBoxHelper.ignoreCloneCache(true);                                                                 </span>
<span class="7183587253332869173" onmouseenter="enter('7183587253332869173');" onmouseout="out('7183587253332869173');" style=""> 425              extensionManager.getProxy().startBatchEvent(indexables);                                              </span>
<span class="3424650845291102605" onmouseenter="enter('3424650845291102605');" onmouseout="out('3424650845291102605');" style=""> 426              Collection&lt;SolrInputDocument&gt; documents = new ArrayList&lt;&gt;();                                          </span>
<span class="7801772952659649444" onmouseenter="enter('7801772952659649444');" onmouseout="out('7801772952659649444');" style=""> 427              List&lt;Locale&gt; locales = getAllLocales();                                                               </span>
<span  style=""> 428                                                                                                                    </span>
<span class="-2189912087670236149" onmouseenter="enter('-2189912087670236149');" onmouseout="out('-2189912087670236149');" style=""> 429              List&lt;Long&gt; productIds = BLCCollectionUtils.collectList(indexables, new TypedTransformer&lt;Long&gt;() {     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 430                  @Override                                                                                         </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 431                  public Long transform(Object input) {                                                             </span>
<span class="6561542425546767799" onmouseenter="enter('6561542425546767799');" onmouseout="out('6561542425546767799');" style=""> 432                      return shs.getCurrentProductId((Indexable) input);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433                  }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 434              });                                                                                                   </span>
<span  style=""> 435                                                                                                                    </span>
<span class="-6904889408824287124" onmouseenter="enter('-6904889408824287124');" onmouseout="out('-6904889408824287124');" style=""> 436              solrIndexDao.populateProductCatalogStructure(productIds, SolrIndexCachedOperation.getCache());        </span>
<span  style=""> 437                                                                                                                    </span>
<span class="326959637207207549" onmouseenter="enter('326959637207207549');" onmouseout="out('326959637207207549');" style=""> 438              List&lt;IndexField&gt; fields = null;                                                                       </span>
<span class="-1903082167184535893" onmouseenter="enter('-1903082167184535893');" onmouseout="out('-1903082167184535893');" style=""> 439              FieldEntity currentFieldType = null;                                                                  </span>
<span class="-3671570197523764351" onmouseenter="enter('-3671570197523764351');" onmouseout="out('-3671570197523764351');" style=""> 440              for (Indexable indexable : indexables) {                                                              </span>
<span class="-6818188811001504815" onmouseenter="enter('-6818188811001504815');" onmouseout="out('-6818188811001504815');" style=""> 441                  if (fields == null || ObjectUtils.notEqual(currentFieldType, indexable.getFieldEntityType())) {   </span>
<span class="4379308220695057970" onmouseenter="enter('4379308220695057970');" onmouseout="out('4379308220695057970');" style=""> 442                      fields = indexFieldDao.readFieldsByEntityType(indexable.getFieldEntityType());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443                  }                                                                                                 </span>
<span  style=""> 444                                                                                                                    </span>
<span class="7630570351050256200" onmouseenter="enter('7630570351050256200');" onmouseout="out('7630570351050256200');" style=""> 445                  SolrInputDocument doc = buildDocument(indexable, fields, locales);                                </span>
<span class="-3475311009677795568" onmouseenter="enter('-3475311009677795568');" onmouseout="out('-3475311009677795568');" style=""> 446                  //If someone overrides the buildDocument method and determines that they don&#x27;t want a product     </span>
<span class="4539214609551390244" onmouseenter="enter('4539214609551390244');" onmouseout="out('4539214609551390244');" style=""> 447                  //indexed, then they can return null. If the document is null it does not get added to            </span>
<span class="-225951702109518326" onmouseenter="enter('-225951702109518326');" onmouseout="out('-225951702109518326');" style=""> 448                  //to the index.                                                                                   </span>
<span class="-5520172171866318279" onmouseenter="enter('-5520172171866318279');" onmouseout="out('-5520172171866318279');" style=""> 449                  if (doc != null) {                                                                                </span>
<span class="4425904984588304942" onmouseenter="enter('4425904984588304942');" onmouseout="out('4425904984588304942');" style=""> 450                      documents.add(doc);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452              }                                                                                                     </span>
<span  style=""> 453                                                                                                                    </span>
<span class="-5162140986849793305" onmouseenter="enter('-5162140986849793305');" onmouseout="out('-5162140986849793305');" style=""> 454              extensionManager.getProxy().modifyBuiltDocuments(documents, indexables, fields, locales);             </span>
<span  style=""> 455                                                                                                                    </span>
<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 456              logDocuments(documents);                                                                              </span>
<span  style=""> 457                                                                                                                    </span>
<span class="-6239196544496643062" onmouseenter="enter('-6239196544496643062');" onmouseout="out('-6239196544496643062');" style=""> 458              if (!CollectionUtils.isEmpty(documents) &amp;&amp; solrServer != null) {                                      </span>
<span class="-2455738755867551021" onmouseenter="enter('-2455738755867551021');" onmouseout="out('-2455738755867551021');" style=""> 459                  solrServer.add(documents);                                                                        </span>
<span class="-9027493991986689214" onmouseenter="enter('-9027493991986689214');" onmouseout="out('-9027493991986689214');" style=""> 460                  commit(solrServer);                                                                               </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461              }                                                                                                     </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 462              TransactionUtils.finalizeTransaction(status, transactionManager, false);                              </span>
<span  style=""> 463                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 464              if (LOG.isDebugEnabled()) {                                                                           </span>
<span class="-5239549129780834185" onmouseenter="enter('-5239549129780834185');" onmouseout="out('-5239549129780834185');" style=""><abbr title=" 465                  LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexables.size(), s.toLapString()));"> 465                  LOG.debug(String.format(&quot;Built incremental product index - pageSize: [%s] in [%s]&quot;, indexables.sizðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466              }                                                                                                     </span>
<span  style=""> 467                                                                                                                    </span>
<span class="-4724346008918927046" onmouseenter="enter('-4724346008918927046');" onmouseout="out('-4724346008918927046');" style=""> 468              return documents;                                                                                     </span>
<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 469          } catch (SolrServerException e) {                                                                         </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 470              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 471              throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 472          } catch (IOException e) {                                                                                 </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 473              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-8456301175683541875" onmouseenter="enter('-8456301175683541875');" onmouseout="out('-8456301175683541875');" style=""> 474              throw new ServiceException(&quot;Could not rebuild index&quot;, e);                                             </span>
<span class="1200625667814236005" onmouseenter="enter('1200625667814236005');" onmouseout="out('1200625667814236005');" style=""> 475          } catch (RuntimeException e) {                                                                            </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 476              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 477              throw e;                                                                                              </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 478          } finally {                                                                                               </span>
<span class="90671037077050937" onmouseenter="enter('90671037077050937');" onmouseout="out('90671037077050937');" style=""> 479              extensionManager.getProxy().endBatchEvent(indexables);                                                </span>
<span class="8189254405929957329" onmouseenter="enter('8189254405929957329');" onmouseout="out('8189254405929957329');" style=""> 480              sandBoxHelper.ignoreCloneCache(false);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482      }                                                                                                             </span>
<span  style=""> 483                                                                                                                    </span>
<span class="5551263307167100166" onmouseenter="enter('5551263307167100166');" onmouseout="out('5551263307167100166');" style=""> 484      protected List&lt;? extends Indexable&gt; readAllActiveIndexables(int pageSize, Long lastId) {                      </span>
<span class="-2562999579041363902" onmouseenter="enter('-2562999579041363902');" onmouseout="out('-2562999579041363902');" style=""> 485          if (useSku) {                                                                                             </span>
<span class="-3742310466348187153" onmouseenter="enter('-3742310466348187153');" onmouseout="out('-3742310466348187153');" style=""> 486              List&lt;Sku&gt; skus = skuDao.readAllActiveSkus(pageSize, lastId);                                          </span>
<span class="-1918574255732088044" onmouseenter="enter('-1918574255732088044');" onmouseout="out('-1918574255732088044');" style=""> 487              return filterIndexableSkus(skus);                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 488          } else {                                                                                                  </span>
<span class="6192419674169007142" onmouseenter="enter('6192419674169007142');" onmouseout="out('6192419674169007142');" style=""> 489              return productDao.readAllActiveProducts(pageSize, lastId);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491      }                                                                                                             </span>
<span  style=""> 492                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 493      @Override                                                                                                     </span>
<span class="-3297504531734357903" onmouseenter="enter('-3297504531734357903');" onmouseout="out('-3297504531734357903');" style=""> 494      public List&lt;Sku&gt; filterIndexableSkus(List&lt;Sku&gt; skus) {                                                        </span>
<span class="-4426996259137202563" onmouseenter="enter('-4426996259137202563');" onmouseout="out('-4426996259137202563');" style=""> 495          ArrayList&lt;Sku&gt; skusToIndex = new ArrayList&lt;&gt;();                                                           </span>
<span  style=""> 496                                                                                                                    </span>
<span class="538054118057794756" onmouseenter="enter('538054118057794756');" onmouseout="out('538054118057794756');" style=""> 497          if (CollectionUtils.isNotEmpty(skus)) {                                                                   </span>
<span class="-2939273877835886579" onmouseenter="enter('-2939273877835886579');" onmouseout="out('-2939273877835886579');" style=""> 498              for (Sku sku : skus) {                                                                                </span>
<span class="5890104578951350401" onmouseenter="enter('5890104578951350401');" onmouseout="out('5890104578951350401');" style=""> 499                  //If the sku is not active, don&#x27;t index it...                                                     </span>
<span class="3103154746255532145" onmouseenter="enter('3103154746255532145');" onmouseout="out('3103154746255532145');" style=""> 500                  if (!sku.isActive()) {                                                                            </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 501                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502                  }                                                                                                 </span>
<span  style=""> 503                                                                                                                    </span>
<span class="-546718319586201072" onmouseenter="enter('-546718319586201072');" onmouseout="out('-546718319586201072');" style=""> 504                  //If this is the default sku and the product has product options                                  </span>
<span class="-6470422469159347410" onmouseenter="enter('-6470422469159347410');" onmouseout="out('-6470422469159347410');" style=""> 505                  //and is not allowed to be sold without product options                                           </span>
<span class="-337678893763484987" onmouseenter="enter('-337678893763484987');" onmouseout="out('-337678893763484987');" style=""> 506                  if (sku.getDefaultProduct() != null                                                               </span>
<span class="-7019292284262174275" onmouseenter="enter('-7019292284262174275');" onmouseout="out('-7019292284262174275');" style=""> 507                          &amp;&amp; !sku.getProduct().getCanSellWithoutOptions()                                           </span>
<span class="1729116690037468663" onmouseenter="enter('1729116690037468663');" onmouseout="out('1729116690037468663');" style=""> 508                          &amp;&amp; !sku.getProduct().getAdditionalSkus().isEmpty()) {                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 509                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510                  }                                                                                                 </span>
<span  style=""> 511                                                                                                                    </span>
<span class="-88117540515388863" onmouseenter="enter('-88117540515388863');" onmouseout="out('-88117540515388863');" style=""> 512                  if (sku.getDefaultProduct() instanceof ProductBundle) {                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 513                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514                  }                                                                                                 </span>
<span  style=""> 515                                                                                                                    </span>
<span class="-7670999631895775847" onmouseenter="enter('-7670999631895775847');" onmouseout="out('-7670999631895775847');" style=""> 516                  skusToIndex.add(sku);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518          }                                                                                                         </span>
<span class="3569956845755381035" onmouseenter="enter('3569956845755381035');" onmouseout="out('3569956845755381035');" style=""> 519          return skusToIndex;                                                                                       </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520      }                                                                                                             </span>
<span  style=""> 521                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 522      @Override                                                                                                     </span>
<span class="-8038322947777108176" onmouseenter="enter('-8038322947777108176');" onmouseout="out('-8038322947777108176');" style=""> 523      public List&lt;Locale&gt; getAllLocales() {                                                                         </span>
<span class="-8741721793451188111" onmouseenter="enter('-8741721793451188111');" onmouseout="out('-8741721793451188111');" style=""> 524          List&lt;Locale&gt; allLocales = localeService.findAllLocales();                                                 </span>
<span class="4034520407475000176" onmouseenter="enter('4034520407475000176');" onmouseout="out('4034520407475000176');" style=""> 525          Map&lt;String, Locale&gt; processedLocales = new HashMap&lt;&gt;();                                                   </span>
<span class="2399355616829443482" onmouseenter="enter('2399355616829443482');" onmouseout="out('2399355616829443482');" style=""> 526          // Optimize the list of locales we are looking at. If I have an &#x27;en&#x27; and &#x27;en_US&#x27; in the locale set and I&#x27;m</span>
<span class="1459641740327693907" onmouseenter="enter('1459641740327693907');" onmouseout="out('1459641740327693907');" style=""> 527          // not using the country code to index the values, then I only need to index the locale &#x27;en&#x27;              </span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style=""> 528          for (Locale locale : allLocales) {                                                                        </span>
<span class="343473664574147441" onmouseenter="enter('343473664574147441');" onmouseout="out('343473664574147441');" style=""> 529              String localeCode = locale.getLocaleCode();                                                           </span>
<span class="-113413807046306655" onmouseenter="enter('-113413807046306655');" onmouseout="out('-113413807046306655');" style=""> 530              int underscoreLocation = localeCode.indexOf(&quot;_&quot;);                                                     </span>
<span class="5152034502068978670" onmouseenter="enter('5152034502068978670');" onmouseout="out('5152034502068978670');" style=""> 531              if (underscoreLocation &gt; 0 &amp;&amp; Boolean.FALSE.equals(locale.getUseCountryInSearchIndex())) {            </span>
<span class="8938820827276960997" onmouseenter="enter('8938820827276960997');" onmouseout="out('8938820827276960997');" style=""> 532                  String localeCodeWithoutCountry = localeCode.substring(0, underscoreLocation);                    </span>
<span class="-6764305435332837995" onmouseenter="enter('-6764305435332837995');" onmouseout="out('-6764305435332837995');" style=""> 533                  if (!processedLocales.containsKey(localeCodeWithoutCountry)) {                                    </span>
<span class="-3212129377547784987" onmouseenter="enter('-3212129377547784987');" onmouseout="out('-3212129377547784987');" style=""> 534                      processedLocales.put(localeCodeWithoutCountry, locale);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 536              } else {                                                                                              </span>
<span class="-3143247090679758655" onmouseenter="enter('-3143247090679758655');" onmouseout="out('-3143247090679758655');" style=""> 537                  processedLocales.put(locale.getLocaleCode(), locale);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539          }                                                                                                         </span>
<span class="8478562493399850393" onmouseenter="enter('8478562493399850393');" onmouseout="out('8478562493399850393');" style=""> 540          return new ArrayList&lt;&gt;(processedLocales.values());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541      }                                                                                                             </span>
<span  style=""> 542                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 543      @Override                                                                                                     </span>
<span class="-5988937181784380794" onmouseenter="enter('-5988937181784380794');" onmouseout="out('-5988937181784380794');" style=""><abbr title=" 544      public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 544      public SolrInputDocument buildDocument(final Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; localeðŸ”µ</abbr></span>
<span class="-1573032782442007580" onmouseenter="enter('-1573032782442007580');" onmouseout="out('-1573032782442007580');" style=""> 545          final SolrInputDocument document = new SolrInputDocument();                                               </span>

<span  style=""> 546                                                                                                                    </span>
<span class="-1191402169666210527" onmouseenter="enter('-1191402169666210527');" onmouseout="out('-1191402169666210527');" style=""> 547          attachBasicDocumentFields(indexable, document);                                                           </span>
<span  style=""> 548                                                                                                                    </span>
<span class="6176356407772671184" onmouseenter="enter('6176356407772671184');" onmouseout="out('6176356407772671184');" style=""> 549          attachIndexableDocumentFields(document, indexable, fields, locales);                                      </span>
<span  style=""> 550                                                                                                                    </span>
<span class="-7308801397401646621" onmouseenter="enter('-7308801397401646621');" onmouseout="out('-7308801397401646621');" style=""> 551          attachAdditionalDocumentFields(indexable, document);                                                      </span>
<span  style=""> 552                                                                                                                    </span>
<span class="581573764679058551" onmouseenter="enter('581573764679058551');" onmouseout="out('581573764679058551');" style=""> 553          extensionManager.getProxy().attachChildDocuments(indexable, document, fields, locales);                   </span>
<span  style=""> 554                                                                                                                    </span>
<span class="-4026438827530914052" onmouseenter="enter('-4026438827530914052');" onmouseout="out('-4026438827530914052');" style=""> 555          return document;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556      }                                                                                                             </span>
<span  style=""> 557                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 558      @Override                                                                                                     </span>
<span class="-2827903308009028143" onmouseenter="enter('-2827903308009028143');" onmouseout="out('-2827903308009028143');" style=""><abbr title=" 559      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales) {"> 559      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fiðŸ”µ</abbr></span>
<span class="-7267711193404106417" onmouseenter="enter('-7267711193404106417');" onmouseout="out('-7267711193404106417');" style=""> 560          for (IndexField indexField : fields) {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 561              try {                                                                                                 </span>
<span class="-5685362315060478990" onmouseenter="enter('-5685362315060478990');" onmouseout="out('-5685362315060478990');" style=""> 562                  // If we find an IndexField entry for this field, then we need to store it in the index           </span>
<span class="-6138117391173223373" onmouseenter="enter('-6138117391173223373');" onmouseout="out('-6138117391173223373');" style=""> 563                  if (indexField != null) {                                                                         </span>
<span class="-1605896855845279090" onmouseenter="enter('-1605896855845279090');" onmouseout="out('-1605896855845279090');" style=""> 564                      List&lt;IndexFieldType&gt; searchableFieldTypes = indexField.getFieldTypes();                       </span>
<span  style=""> 565                                                                                                                    </span>
<span class="7314822488779147745" onmouseenter="enter('7314822488779147745');" onmouseout="out('7314822488779147745');" style=""><abbr title=" 566                      // For each of its search field types, get the property values, and add a field to the document for each property value"> 566                      // For each of its search field types, get the property values, and add a field to the documenðŸ”µ</abbr></span>
<span class="9127582384821892356" onmouseenter="enter('9127582384821892356');" onmouseout="out('9127582384821892356');" style=""> 567                      for (IndexFieldType sft : searchableFieldTypes) {                                             </span>
<span class="-1855754965803101801" onmouseenter="enter('-1855754965803101801');" onmouseout="out('-1855754965803101801');" style=""> 568                          FieldType fieldType = sft.getFieldType();                                                 </span>
<span class="1213494569726901077" onmouseenter="enter('1213494569726901077');" onmouseout="out('1213494569726901077');" style=""><abbr title=" 569                          Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getField(), fieldType, locales);"> 569                          Map&lt;String, Object&gt; propertyValues = getPropertyValues(indexable, indexField.getField(), fðŸ”µ</abbr></span>
<span  style=""> 570                                                                                                                    </span>
<span class="2731937647730128807" onmouseenter="enter('2731937647730128807');" onmouseout="out('2731937647730128807');" style=""><abbr title=" 571                          ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentForIndexField(document, indexField, fieldType, propertyValues);"> 571                          ExtensionResultStatusType result = extensionManager.getProxy().populateDocumentForIndexFieðŸ”µ</abbr></span>
<span  style=""> 572                                                                                                                    </span>
<span class="-2046283582941202064" onmouseenter="enter('-2046283582941202064');" onmouseout="out('-2046283582941202064');" style=""> 573                          if (ExtensionResultStatusType.NOT_HANDLED.equals(result)) {                               </span>
<span class="1818285189854508408" onmouseenter="enter('1818285189854508408');" onmouseout="out('1818285189854508408');" style=""> 574                              // Build out the field for every prefix                                               </span>
<span class="-7947315413202592125" onmouseenter="enter('-7947315413202592125');" onmouseout="out('-7947315413202592125');" style=""> 575                              for (Entry&lt;String, Object&gt; entry : propertyValues.entrySet()) {                       </span>
<span class="-6275926878676507761" onmouseenter="enter('-6275926878676507761');" onmouseout="out('-6275926878676507761');" style=""> 576                                  String prefix = entry.getKey();                                                   </span>
<span class="2218524055946596429" onmouseenter="enter('2218524055946596429');" onmouseout="out('2218524055946596429');" style=""> 577                                  prefix = StringUtils.isBlank(prefix) ? prefix : prefix + &quot;_&quot;;                     </span>
<span  style=""> 578                                                                                                                    </span>
<span class="-3898910784215480067" onmouseenter="enter('-3898910784215480067');" onmouseout="out('-3898910784215480067');" style=""><abbr title=" 579                                  String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fieldType, prefix);"> 579                                  String solrPropertyName = shs.getPropertyNameForIndexField(indexField, fieldType, ðŸ”µ</abbr></span>
<span class="-4401151924846137205" onmouseenter="enter('-4401151924846137205');" onmouseout="out('-4401151924846137205');" style=""> 580                                  Object value = entry.getValue();                                                  </span>
<span  style=""> 581                                                                                                                    </span>
<span class="626346901079283965" onmouseenter="enter('626346901079283965');" onmouseout="out('626346901079283965');" style=""> 582                                  if (FieldType.isMultiValued(fieldType)) {                                         </span>
<span class="-3165450242186121028" onmouseenter="enter('-3165450242186121028');" onmouseout="out('-3165450242186121028');" style=""> 583                                      document.addField(solrPropertyName, value);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 584                                  } else {                                                                          </span>
<span class="3313383578919119200" onmouseenter="enter('3313383578919119200');" onmouseout="out('3313383578919119200');" style=""> 585                                      document.setField(solrPropertyName, value);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 587                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590                  }                                                                                                 </span>
<span  style=""> 591                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 592              } catch (Exception e) {                                                                               </span>
<span class="3922644492767384995" onmouseenter="enter('3922644492767384995');" onmouseout="out('3922644492767384995');" style=""><abbr title=" 593                  LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldName() + &quot;] for product id[&quot;"> 593                  LOG.error(&quot;Could not get value for property[&quot; + indexField.getField().getQualifiedFieldName() + &quot;]ðŸ”µ</abbr></span>
<span class="6260448561791331284" onmouseenter="enter('6260448561791331284');" onmouseout="out('6260448561791331284');" style=""> 594                          + indexable.getId() + &quot;]&quot;, e);                                                            </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 595                  throw ExceptionHelper.refineException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598      }                                                                                                             </span>
<span  style=""> 599                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 600      /**                                                                                                           </span>
<span class="4238183781809234032" onmouseenter="enter('4238183781809234032');" onmouseout="out('4238183781809234032');" style=""> 601       * Implementors can extend this and override this method to add additional fields to the Solr document.       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 602       *                                                                                                            </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 603       * @param sku                                                                                                 </span>
<span class="-4531925645240977456" onmouseenter="enter('-4531925645240977456');" onmouseout="out('-4531925645240977456');" style=""> 604       * @param document                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 605       */                                                                                                           </span>
<span class="-8826176176899724303" onmouseenter="enter('-8826176176899724303');" onmouseout="out('-8826176176899724303');" style=""> 606      protected void attachAdditionalDocumentFields(Indexable indexable, SolrInputDocument document) {              </span>
<span class="2874503221562082086" onmouseenter="enter('2874503221562082086');" onmouseout="out('2874503221562082086');" style=""> 607          //Empty implementation. Placeholder for others to extend and add additional fields                        </span>
<span class="6562860541481637604" onmouseenter="enter('6562860541481637604');" onmouseout="out('6562860541481637604');" style=""> 608          extensionManager.getProxy().attachAdditionalDocumentFields(indexable, document);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609      }                                                                                                             </span>
<span  style=""> 610                                                                                                                    </span>
<span class="2269161038285740545" onmouseenter="enter('2269161038285740545');" onmouseout="out('2269161038285740545');" style=""> 611      protected void attachBasicDocumentFields(Indexable indexable, SolrInputDocument document) {                   </span>
<span class="3677952974140195445" onmouseenter="enter('3677952974140195445');" onmouseout="out('3677952974140195445');" style=""> 612          CatalogStructure cache = SolrIndexCachedOperation.getCache();                                             </span>
<span class="3690595679967484902" onmouseenter="enter('3690595679967484902');" onmouseout="out('3690595679967484902');" style=""> 613          if (cache == null) {                                                                                      </span>
<span class="-5953957341705739916" onmouseenter="enter('-5953957341705739916');" onmouseout="out('-5953957341705739916');" style=""> 614              String msg = &quot;SolrIndexService.performCachedOperation() must be used in conjuction with&quot;              </span>
<span class="5121342196990946089" onmouseenter="enter('5121342196990946089');" onmouseout="out('5121342196990946089');" style=""><abbr title=" 615                  + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog documents or should&quot;"> 615                  + &quot; solrIndexDao.populateProductCatalogStructure() in order to correctly build catalog documents oðŸ”µ</abbr></span>
<span class="5921421762371925976" onmouseenter="enter('5921421762371925976');" onmouseout="out('5921421762371925976');" style=""> 616                  + &quot; be invoked from buildIncrementalIndex()&quot;;                                                     </span>
<span class="4339245929318812534" onmouseenter="enter('4339245929318812534');" onmouseout="out('4339245929318812534');" style=""> 617              LOG.error(msg);                                                                                       </span>
<span class="86168282544735545" onmouseenter="enter('86168282544735545');" onmouseout="out('86168282544735545');" style=""> 618              throw new IllegalStateException(msg);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619          }                                                                                                         </span>
<span  style=""> 620                                                                                                                    </span>
<span class="-3140243218980457613" onmouseenter="enter('-3140243218980457613');" onmouseout="out('-3140243218980457613');" style=""> 621          // Add the namespace and ID fields for this product                                                       </span>
<span class="-8136043564923018877" onmouseenter="enter('-8136043564923018877');" onmouseout="out('-8136043564923018877');" style=""> 622          document.addField(shs.getNamespaceFieldName(), solrConfiguration.getNamespace());                         </span>
<span class="4638667037339624807" onmouseenter="enter('4638667037339624807');" onmouseout="out('4638667037339624807');" style=""> 623          document.addField(shs.getIdFieldName(), shs.getSolrDocumentId(document, indexable));                      </span>
<span class="-1745274961796795631" onmouseenter="enter('-1745274961796795631');" onmouseout="out('-1745274961796795631');" style=""> 624          document.addField(shs.getTypeFieldName(), shs.getDocumentType(indexable));                                </span>
<span class="4848544160674821385" onmouseenter="enter('4848544160674821385');" onmouseout="out('4848544160674821385');" style=""> 625          document.addField(shs.getIndexableIdFieldName(), shs.getIndexableId(indexable));                          </span>
<span  style=""> 626                                                                                                                    </span>
<span class="4524398296663961208" onmouseenter="enter('4524398296663961208');" onmouseout="out('4524398296663961208');" style=""> 627          extensionManager.getProxy().attachAdditionalBasicFields(indexable, document, shs);                        </span>
<span  style=""> 628                                                                                                                    </span>
<span class="8081444938024983637" onmouseenter="enter('8081444938024983637');" onmouseout="out('8081444938024983637');" style=""> 629          Long cacheKey = this.shs.getCurrentProductId(indexable); // current                                       </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 630          if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                        </span>
<span class="1019588205807698651" onmouseenter="enter('1019588205807698651');" onmouseout="out('1019588205807698651');" style=""> 631              cacheKey = sandBoxHelper.getOriginalId(cacheKey); // parent                                           </span>
<span class="6257745385922343419" onmouseenter="enter('6257745385922343419');" onmouseout="out('6257745385922343419');" style=""> 632              if (!cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                    </span>
<span class="-2582971950633728748" onmouseenter="enter('-2582971950633728748');" onmouseout="out('-2582971950633728748');" style=""> 633                  cacheKey = shs.getIndexableId(indexable); // master                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635          }                                                                                                         </span>
<span  style=""> 636                                                                                                                    </span>
<span class="-5777629244031949400" onmouseenter="enter('-5777629244031949400');" onmouseout="out('-5777629244031949400');" style=""> 637          // TODO: figure this out more generally; this doesn&#x27;t work for CMS content                                </span>
<span class="-6650188849299086912" onmouseenter="enter('-6650188849299086912');" onmouseout="out('-6650188849299086912');" style=""> 638          // The explicit categories are the ones defined by the product itself                                     </span>
<span class="-9160995028433643624" onmouseenter="enter('-9160995028433643624');" onmouseout="out('-9160995028433643624');" style=""> 639          if (cache.getParentCategoriesByProduct().containsKey(cacheKey)) {                                         </span>
<span class="4256320710674012617" onmouseenter="enter('4256320710674012617');" onmouseout="out('4256320710674012617');" style=""> 640              for (Long categoryId : cache.getParentCategoriesByProduct().get(cacheKey)) {                          </span>
<span class="8455722384905122433" onmouseenter="enter('8455722384905122433');" onmouseout="out('8455722384905122433');" style=""> 641                  document.addField(shs.getExplicitCategoryFieldName(), shs.getCategoryId(categoryId));             </span>
<span  style=""> 642                                                                                                                    </span>
<span class="2226871268244895600" onmouseenter="enter('2226871268244895600');" onmouseout="out('2226871268244895600');" style=""> 643                  // Make sure that we&#x27;re always referencing the parent for the sort field                          </span>
<span class="885050313007205730" onmouseenter="enter('885050313007205730');" onmouseout="out('885050313007205730');" style=""> 644                  String categorySortFieldName = shs.getCategorySortFieldName(shs.getCategoryId(categoryId));       </span>
<span class="2056097617960887013" onmouseenter="enter('2056097617960887013');" onmouseout="out('2056097617960887013');" style=""><abbr title=" 645                  // The issue here was the super category id is always what is stored in the cache, while the category"> 645                  // The issue here was the super category id is always what is stored in the cache, while the categðŸ”µ</abbr></span>
<span class="-892018914725665598" onmouseenter="enter('-892018914725665598');" onmouseout="out('-892018914725665598');" style=""><abbr title=" 646                  // by product id is the overridden versions. Need to always look at parent version for cache stuff, which"> 646                  // by product id is the overridden versions. Need to always look at parent version for cache stuffðŸ”µ</abbr></span>
<span class="-9167754401626692888" onmouseenter="enter('-9167754401626692888');" onmouseout="out('-9167754401626692888');" style=""> 647                  // is given from shs.getCategoryId                                                                </span>
<span class="-5291059882317809252" onmouseenter="enter('-5291059882317809252');" onmouseout="out('-5291059882317809252');" style=""> 648                  // First try the current level                                                                    </span>
<span class="-431096296060400570" onmouseenter="enter('-431096296060400570');" onmouseout="out('-431096296060400570');" style=""> 649                  String displayOrderKey = categoryId + &quot;-&quot; + cacheKey;                                             </span>
<span class="-2136310867529994982" onmouseenter="enter('-2136310867529994982');" onmouseout="out('-2136310867529994982');" style=""> 650                  Long displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                            </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 651                  if (displayOrder == null) {                                                                       </span>
<span class="-23846589771862516" onmouseenter="enter('-23846589771862516');" onmouseout="out('-23846589771862516');" style=""> 652                      // Didn&#x27;t find the cache at the current level, this might be an override so look upwards      </span>
<span class="-2522276541728086971" onmouseenter="enter('-2522276541728086971');" onmouseout="out('-2522276541728086971');" style=""> 653                      displayOrderKey = shs.getCategoryId(categoryId) + &quot;-&quot; + cacheKey;                             </span>
<span class="-4225610511634364677" onmouseenter="enter('-4225610511634364677');" onmouseout="out('-4225610511634364677');" style=""> 654                      displayOrder = convertDisplayOrderToLong(cache, displayOrderKey);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655                  }                                                                                                 </span>
<span  style=""> 656                                                                                                                    </span>
<span class="-1309608839151321080" onmouseenter="enter('-1309608839151321080');" onmouseout="out('-1309608839151321080');" style=""> 657                  if (document.getField(categorySortFieldName) == null &amp;&amp; displayOrder != null) {                   </span>
<span class="-139575474281341237" onmouseenter="enter('-139575474281341237');" onmouseout="out('-139575474281341237');" style=""> 658                      document.addField(categorySortFieldName, displayOrder);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659                  }                                                                                                 </span>
<span  style=""> 660                                                                                                                    </span>
<span class="368279688641772108" onmouseenter="enter('368279688641772108');" onmouseout="out('368279688641772108');" style=""> 661                  // This is the entire tree of every category defined on the product                               </span>
<span class="7804252118891085182" onmouseenter="enter('7804252118891085182');" onmouseout="out('7804252118891085182');" style=""> 662                  buildFullCategoryHierarchy(document, cache, categoryId, new HashSet&lt;Long&gt;());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665      }                                                                                                             </span>
<span  style=""> 666                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 667      /**                                                                                                           </span>
<span class="6681629456063376998" onmouseenter="enter('6681629456063376998');" onmouseout="out('6681629456063376998');" style=""> 668       * Walk the category hierarchy upwards, adding a field for each level to the solr document                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 669       *                                                                                                            </span>
<span class="1689379025577151242" onmouseenter="enter('1689379025577151242');" onmouseout="out('1689379025577151242');" style=""> 670       * @param document the solr document for the product                                                          </span>
<span class="-7318706520602943649" onmouseenter="enter('-7318706520602943649');" onmouseout="out('-7318706520602943649');" style=""> 671       * @param cache the catalog structure cache                                                                   </span>
<span class="-6836312806010046064" onmouseenter="enter('-6836312806010046064');" onmouseout="out('-6836312806010046064');" style=""> 672       * @param categoryId the current category id                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 673       */                                                                                                           </span>
<span class="2161311715252659768" onmouseenter="enter('2161311715252659768');" onmouseout="out('2161311715252659768');" style=""><abbr title=" 674      protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long categoryId, Set&lt;Long&gt; indexedParents) {"> 674      protected void buildFullCategoryHierarchy(SolrInputDocument document, CatalogStructure cache, Long categoryId,ðŸ”µ</abbr></span>
<span class="3164345535572197299" onmouseenter="enter('3164345535572197299');" onmouseout="out('3164345535572197299');" style=""> 675          Long catIdToAdd = shs.getCategoryId(categoryId);                                                          </span>
<span  style=""> 676                                                                                                                    </span>
<span class="-3890718915071250281" onmouseenter="enter('-3890718915071250281');" onmouseout="out('-3890718915071250281');" style=""> 677          Collection&lt;Object&gt; existingValues = document.getFieldValues(shs.getCategoryFieldName());                  </span>
<span class="6039307398262207081" onmouseenter="enter('6039307398262207081');" onmouseout="out('6039307398262207081');" style=""> 678          if (existingValues == null || !existingValues.contains(catIdToAdd)) {                                     </span>
<span class="527969679087238607" onmouseenter="enter('527969679087238607');" onmouseout="out('527969679087238607');" style=""> 679              document.addField(shs.getCategoryFieldName(), catIdToAdd);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 680          }                                                                                                         </span>
<span  style=""> 681                                                                                                                    </span>
<span class="6863771221853966476" onmouseenter="enter('6863771221853966476');" onmouseout="out('6863771221853966476');" style=""> 682          Set&lt;Long&gt; parents = cache.getParentCategoriesByCategory().get(categoryId);                                </span>
<span class="-2911148901929748808" onmouseenter="enter('-2911148901929748808');" onmouseout="out('-2911148901929748808');" style=""> 683          for (Long parent : parents) {                                                                             </span>
<span class="-7460726028904993058" onmouseenter="enter('-7460726028904993058');" onmouseout="out('-7460726028904993058');" style=""> 684              if (!indexedParents.contains(parent)) {                                                               </span>
<span class="7294571508456102427" onmouseenter="enter('7294571508456102427');" onmouseout="out('7294571508456102427');" style=""> 685                  indexedParents.add(parent);                                                                       </span>
<span class="-1881502435741878283" onmouseenter="enter('-1881502435741878283');" onmouseout="out('-1881502435741878283');" style=""> 686                  buildFullCategoryHierarchy(document, cache, parent, indexedParents);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 688          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689      }                                                                                                             </span>
<span  style=""> 690                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 691      /**                                                                                                           </span>
<span class="-4462927116106886000" onmouseenter="enter('-4462927116106886000');" onmouseout="out('-4462927116106886000');" style=""><abbr title=" 692       * Returns a map of prefix to value for the requested attributes. For example, if the requested field corresponds to"> 692       * Returns a map of prefix to value for the requested attributes. For example, if the requested field correspoðŸ”µ</abbr></span>
<span class="-4378589169221473186" onmouseenter="enter('-4378589169221473186');" onmouseout="out('-4378589169221473186');" style=""><abbr title=" 693       * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting map could be"> 693       * a Sku&#x27;s description and the locales list has the en_US locale and the es_ES locale, the resulting map couldðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 694       *                                                                                                            </span>
<span class="4965494886678626130" onmouseenter="enter('4965494886678626130');" onmouseout="out('4965494886678626130');" style=""> 695       * { &quot;en_US&quot; : &quot;A description&quot;,                                                                               </span>
<span class="-259254215439445341" onmouseenter="enter('-259254215439445341');" onmouseout="out('-259254215439445341');" style=""> 696       *   &quot;es_ES&quot; : &quot;Una descripcion&quot; }                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 697       *                                                                                                            </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 698       * @param product                                                                                             </span>
<span class="382575667047236709" onmouseenter="enter('382575667047236709');" onmouseout="out('382575667047236709');" style=""> 699       * @param sku                                                                                                 </span>
<span class="-2810227465158556501" onmouseenter="enter('-2810227465158556501');" onmouseout="out('-2810227465158556501');" style=""> 700       * @param field                                                                                               </span>
<span class="8333989749186698144" onmouseenter="enter('8333989749186698144');" onmouseout="out('8333989749186698144');" style=""> 701       * @param fieldType                                                                                           </span>
<span class="4196076978965854681" onmouseenter="enter('4196076978965854681');" onmouseout="out('4196076978965854681');" style=""> 702       * @param locales                                                                                             </span>
<span class="8270246261244700409" onmouseenter="enter('8270246261244700409');" onmouseout="out('8270246261244700409');" style=""> 703       * @return the value of the property                                                                          </span>
<span class="8083004877096205463" onmouseenter="enter('8083004877096205463');" onmouseout="out('8083004877096205463');" style=""> 704       * @throws IllegalAccessException                                                                             </span>
<span class="-5812785901555574031" onmouseenter="enter('-5812785901555574031');" onmouseout="out('-5812785901555574031');" style=""> 705       * @throws InvocationTargetException                                                                          </span>
<span class="-7952440753472318794" onmouseenter="enter('-7952440753472318794');" onmouseout="out('-7952440753472318794');" style=""> 706       * @throws NoSuchMethodException                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 707       */                                                                                                           </span>
<span class="8748893838745138853" onmouseenter="enter('8748893838745138853');" onmouseout="out('8748893838745138853');" style=""><abbr title=" 708      protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldType, List&lt;Locale&gt; locales)"> 708      protected Map&lt;String, Object&gt; getPropertyValues(Indexable indexedItem, Field field, FieldType fieldType, List&lt;ðŸ”µ</abbr></span>
<span class="1769827535532852924" onmouseenter="enter('1769827535532852924');" onmouseout="out('1769827535532852924');" style=""> 709              throws IllegalAccessException, InvocationTargetException, NoSuchMethodException {                     </span>
<span  style=""> 710                                                                                                                    </span>
<span class="6107905045905939603" onmouseenter="enter('6107905045905939603');" onmouseout="out('6107905045905939603');" style=""> 711          String propertyName = field.getPropertyName();                                                            </span>
<span class="-4589490168925589742" onmouseenter="enter('-4589490168925589742');" onmouseout="out('-4589490168925589742');" style=""> 712          Map&lt;String, Object&gt; values = new HashMap&lt;&gt;();                                                             </span>
<span  style=""> 713                                                                                                                    </span>
<span class="6659346108356717008" onmouseenter="enter('6659346108356717008');" onmouseout="out('6659346108356717008');" style=""> 714          ExtensionResultStatusType extensionResult = ExtensionResultStatusType.NOT_HANDLED;                        </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 715          if (extensionManager != null) {                                                                           </span>
<span class="-9204729919056407683" onmouseenter="enter('-9204729919056407683');" onmouseout="out('-9204729919056407683');" style=""><abbr title=" 716              extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldType, values, propertyName, locales);"> 716              extensionResult = extensionManager.getProxy().addPropertyValues(indexedItem, field, fieldType, values,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717          }                                                                                                         </span>
<span  style=""> 718                                                                                                                    </span>
<span class="978300925065413292" onmouseenter="enter('978300925065413292');" onmouseout="out('978300925065413292');" style=""> 719          if (ExtensionResultStatusType.NOT_HANDLED.equals(extensionResult)) {                                      </span>
<span class="-4780873355376927780" onmouseenter="enter('-4780873355376927780');" onmouseout="out('-4780873355376927780');" style=""> 720              Object propertyValue = shs.getPropertyValue(indexedItem, field);                                      </span>
<span class="-3197092395980898064" onmouseenter="enter('-3197092395980898064');" onmouseout="out('-3197092395980898064');" style=""> 721              if (propertyValue != null) {                                                                          </span>
<span class="2260924254129751704" onmouseenter="enter('2260924254129751704');" onmouseout="out('2260924254129751704');" style=""> 722                  values.put(&quot;&quot;, propertyValue);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724          }                                                                                                         </span>
<span  style=""> 725                                                                                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 726          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727      }                                                                                                             </span>
<span  style=""> 728                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 729      /**                                                                                                           </span>
<span class="9061850100512653526" onmouseenter="enter('9061850100512653526');" onmouseout="out('9061850100512653526');" style=""> 730       * Converts a propertyName to one that is able to reference inside a map. For example, consider the property  </span>
<span class="-895456647484563444" onmouseenter="enter('-895456647484563444');" onmouseout="out('-895456647484563444');" style=""> 731       * in Product that references a List&lt;ProductAttribute&gt;, &quot;productAttributes&quot;. Also consider the utility method </span>
<span class="-552833576006343516" onmouseenter="enter('-552833576006343516');" onmouseout="out('-552833576006343516');" style=""> 732       * in Product called &quot;mappedProductAttributes&quot;, which returns a map of the ProductAttributes keyed by the name</span>
<span class="825713137907557548" onmouseenter="enter('825713137907557548');" onmouseout="out('825713137907557548');" style=""> 733       * property in the ProductAttribute. Given the parameters &quot;productAttributes.heatRange&quot;, &quot;productAttributes&quot;, </span>
<span class="-5368406654183806848" onmouseenter="enter('-5368406654183806848');" onmouseout="out('-5368406654183806848');" style=""> 734       * &quot;mappedProductAttributes&quot; (which would represent a property called &quot;productAttributes.heatRange&quot; that      </span>
<span class="2947641499517828088" onmouseenter="enter('2947641499517828088');" onmouseout="out('2947641499517828088');" style=""> 735       * references a specific ProductAttribute inside of a product whose &quot;name&quot; property is equal to &quot;heatRange&quot;,  </span>
<span class="-7978269712217451802" onmouseenter="enter('-7978269712217451802');" onmouseout="out('-7978269712217451802');" style=""> 736       * this method will convert this property to mappedProductAttributes(heatRange).value, which is then usable   </span>
<span class="2645537127888120036" onmouseenter="enter('2645537127888120036');" onmouseout="out('2645537127888120036');" style=""> 737       * by the standard beanutils PropertyUtils class to get the value.                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 738       *                                                                                                            </span>
<span class="-7192310373251332281" onmouseenter="enter('-7192310373251332281');" onmouseout="out('-7192310373251332281');" style=""> 739       * @param propertyName                                                                                        </span>
<span class="4673892841275975431" onmouseenter="enter('4673892841275975431');" onmouseout="out('4673892841275975431');" style=""> 740       * @param listPropertyName                                                                                    </span>
<span class="-3179260629250258297" onmouseenter="enter('-3179260629250258297');" onmouseout="out('-3179260629250258297');" style=""> 741       * @param mapPropertyName                                                                                     </span>
<span class="3476440775818037910" onmouseenter="enter('3476440775818037910');" onmouseout="out('3476440775818037910');" style=""> 742       * @return the converted property name                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 743       *                                                                                                            </span>
<span class="52899359164217029" onmouseenter="enter('52899359164217029');" onmouseout="out('52899359164217029');" style=""> 744       * @deprecated see SolrHelperService.getPropertyValue()                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 745       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 746      @Deprecated                                                                                                   </span>
<span class="-8166943252759778933" onmouseenter="enter('-8166943252759778933');" onmouseout="out('-8166943252759778933');" style=""><abbr title=" 747      protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropertyName) {"> 747      protected String convertToMappedProperty(String propertyName, String listPropertyName, String mapPropertyName)ðŸ”µ</abbr></span>
<span class="1454213590133189928" onmouseenter="enter('1454213590133189928');" onmouseout="out('1454213590133189928');" style=""> 748          String[] splitName = StringUtils.split(propertyName, &quot;\\.&quot;);                                              </span>
<span class="8763032247946290041" onmouseenter="enter('8763032247946290041');" onmouseout="out('8763032247946290041');" style=""> 749          StringBuilder convertedProperty = new StringBuilder();                                                    </span>
<span class="6897833212568273038" onmouseenter="enter('6897833212568273038');" onmouseout="out('6897833212568273038');" style=""> 750          for (int i = 0; i &lt; splitName.length; i++) {                                                              </span>
<span class="7476336611017662047" onmouseenter="enter('7476336611017662047');" onmouseout="out('7476336611017662047');" style=""> 751              if (convertedProperty.length() &gt; 0) {                                                                 </span>
<span class="3942759274962034898" onmouseenter="enter('3942759274962034898');" onmouseout="out('3942759274962034898');" style=""> 752                  convertedProperty.append(&quot;.&quot;);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753              }                                                                                                     </span>
<span  style=""> 754                                                                                                                    </span>
<span class="-5101250235350090861" onmouseenter="enter('-5101250235350090861');" onmouseout="out('-5101250235350090861');" style=""> 755              if (splitName[i].equals(listPropertyName)) {                                                          </span>
<span class="5747881404112979701" onmouseenter="enter('5747881404112979701');" onmouseout="out('5747881404112979701');" style=""> 756                  convertedProperty.append(mapPropertyName).append(&quot;(&quot;);                                            </span>
<span class="-4744112788117022497" onmouseenter="enter('-4744112788117022497');" onmouseout="out('-4744112788117022497');" style=""> 757                  convertedProperty.append(splitName[i + 1]).append(&quot;).value&quot;);                                     </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 758                  i++;                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 759              } else {                                                                                              </span>
<span class="-2902127022925554102" onmouseenter="enter('-2902127022925554102');" onmouseout="out('-2902127022925554102');" style=""> 760                  convertedProperty.append(splitName[i]);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762          }                                                                                                         </span>
<span class="5092332446699272394" onmouseenter="enter('5092332446699272394');" onmouseout="out('5092332446699272394');" style=""> 763          return convertedProperty.toString();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764      }                                                                                                             </span>
<span  style=""> 765                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 766      @Override                                                                                                     </span>
<span class="-3936693135713622895" onmouseenter="enter('-3936693135713622895');" onmouseout="out('-3936693135713622895');" style=""> 767      public Object[] saveState() {                                                                                 </span>
<span class="6340072029414808943" onmouseenter="enter('6340072029414808943');" onmouseout="out('6340072029414808943');" style=""> 768           return new Object[] {                                                                                    </span>
<span class="-1198820822862086393" onmouseenter="enter('-1198820822862086393');" onmouseout="out('-1198820822862086393');" style=""> 769               BroadleafRequestContext.getBroadleafRequestContext(),                                                </span>
<span class="4468406610576348115" onmouseenter="enter('4468406610576348115');" onmouseout="out('4468406610576348115');" style=""> 770               SkuPricingConsiderationContext.getSkuPricingConsiderationContext(),                                  </span>
<span class="-4551736393079008426" onmouseenter="enter('-4551736393079008426');" onmouseout="out('-4551736393079008426');" style=""> 771               SkuPricingConsiderationContext.getSkuPricingService(),                                               </span>
<span class="3011904497645750283" onmouseenter="enter('3011904497645750283');" onmouseout="out('3011904497645750283');" style=""> 772               SkuActiveDateConsiderationContext.getSkuActiveDatesService()                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 773           };                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774       }                                                                                                            </span>
<span  style=""> 775                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 776      @Override                                                                                                     </span>
<span class="-1725049255621638202" onmouseenter="enter('-1725049255621638202');" onmouseout="out('-1725049255621638202');" style=""> 777      @SuppressWarnings(&quot;rawtypes&quot;)                                                                                 </span>
<span class="-799181704487695614" onmouseenter="enter('-799181704487695614');" onmouseout="out('-799181704487695614');" style=""> 778      public void restoreState(Object[] pack) {                                                                     </span>
<span class="5773741038987480013" onmouseenter="enter('5773741038987480013');" onmouseout="out('5773741038987480013');" style=""> 779           BroadleafRequestContext.setBroadleafRequestContext((BroadleafRequestContext) pack[0]);                   </span>
<span class="-7019853679694091506" onmouseenter="enter('-7019853679694091506');" onmouseout="out('-7019853679694091506');" style=""> 780           SkuPricingConsiderationContext.setSkuPricingConsiderationContext((HashMap) pack[1]);                     </span>
<span class="4085014913476561326" onmouseenter="enter('4085014913476561326');" onmouseout="out('4085014913476561326');" style=""> 781           SkuPricingConsiderationContext.setSkuPricingService((DynamicSkuPricingService) pack[2]);                 </span>
<span class="-8007069714826871365" onmouseenter="enter('-8007069714826871365');" onmouseout="out('-8007069714826871365');" style=""> 782           SkuActiveDateConsiderationContext.setSkuActiveDatesService((DynamicSkuActiveDatesService) pack[3]);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783       }                                                                                                            </span>
<span  style=""> 784                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 785      @Override                                                                                                     </span>
<span class="3365555763697732929" onmouseenter="enter('3365555763697732929');" onmouseout="out('3365555763697732929');" style=""> 786      public void optimizeIndex(SolrClient server) throws ServiceException, IOException {                           </span>
<span class="-7586705105215270214" onmouseenter="enter('-7586705105215270214');" onmouseout="out('-7586705105215270214');" style=""> 787          shs.optimizeIndex(server);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 788      }                                                                                                             </span>
<span  style=""> 789                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 790      @Override                                                                                                     </span>
<span class="8022176589656897042" onmouseenter="enter('8022176589656897042');" onmouseout="out('8022176589656897042');" style=""> 791      public void commit(SolrClient server) throws ServiceException, IOException {                                  </span>






<span class="7675894021553797865" onmouseenter="enter('7675894021553797865');" onmouseout="out('7675894021553797865');" style=""> 792          if (this.commit) {                                                                                        </span>
<span class="4198520714946338996" onmouseenter="enter('4198520714946338996');" onmouseout="out('4198520714946338996');" style=""> 793              commit(server, this.softCommit, this.waitSearcher, this.waitFlush);                                   </span>

<span class="6963313292914152592" onmouseenter="enter('6963313292914152592');" onmouseout="out('6963313292914152592');" style=""> 794          } else if (LOG.isDebugEnabled()) {                                                                        </span>
<span class="1765076834887086466" onmouseenter="enter('1765076834887086466');" onmouseout="out('1765076834887086466');" style=""><abbr title=" 795              LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoCommit is configured.&quot;);"> 795              LOG.debug(&quot;The flag / property \&quot;solr.index.commit\&quot; is false. Not committing! Ensure autoCommit is coðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 796          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797      }                                                                                                             </span>
<span  style=""> 798                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 799      @Override                                                                                                     </span>
<span class="4402093086393350326" onmouseenter="enter('4402093086393350326');" onmouseout="out('4402093086393350326');" style=""><abbr title=" 800      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException {"> 800      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServðŸ”µ</abbr></span>

<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 801          try {                                                                                                     </span>
<span class="897708696444656733" onmouseenter="enter('897708696444656733');" onmouseout="out('897708696444656733');" style=""> 802              if (!this.commit) {                                                                                   </span>
<span class="9109442794169141002" onmouseenter="enter('9109442794169141002');" onmouseout="out('9109442794169141002');" style=""><abbr title=" 803                  LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is being forced via the API.&quot;);"> 803                  LOG.warn(&quot;The flag / property \&quot;solr.index.commit\&quot; is set to false but a commit is being forced vðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804              }                                                                                                     </span>
<span  style=""> 805                                                                                                                    </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 806              if (LOG.isDebugEnabled()) {                                                                           </span>
<span class="-8336995023402134302" onmouseenter="enter('-8336995023402134302');" onmouseout="out('-8336995023402134302');" style=""> 807                  LOG.debug(&quot;Committing changes to Solr index: softCommit: &quot; + softCommit                           </span>
<span class="8772898042441368535" onmouseenter="enter('8772898042441368535');" onmouseout="out('8772898042441368535');" style=""> 808                          + &quot;, waitSearcher: &quot; + waitSearcher + &quot;, waitFlush: &quot; + waitFlush);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809              }                                                                                                     </span>
<span  style=""> 810                                                                                                                    </span>
<span class="7487026730073104755" onmouseenter="enter('7487026730073104755');" onmouseout="out('7487026730073104755');" style=""> 811              server.commit(waitFlush, waitSearcher, softCommit);                                                   </span>

<span class="1273098091472445055" onmouseenter="enter('1273098091472445055');" onmouseout="out('1273098091472445055');" style=""> 812          } catch (SolrServerException e) {                                                                         </span>
<span class="6480332907391821448" onmouseenter="enter('6480332907391821448');" onmouseout="out('6480332907391821448');" style=""> 813              throw new ServiceException(&quot;Could not commit changes to Solr index&quot;, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 815      }                                                                                                             </span>
<span  style=""> 816                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 817      @Override                                                                                                     </span>
<span class="-235343663931086975" onmouseenter="enter('-235343663931086975');" onmouseout="out('-235343663931086975');" style=""> 818      public void logDocuments(Collection&lt;SolrInputDocument&gt; documents) {                                           </span>
<span class="1446253227197554536" onmouseenter="enter('1446253227197554536');" onmouseout="out('1446253227197554536');" style=""> 819          if (LOG.isTraceEnabled()) {                                                                               </span>
<span class="-4118597588854644187" onmouseenter="enter('-4118597588854644187');" onmouseout="out('-4118597588854644187');" style=""> 820              for (SolrInputDocument document : documents) {                                                        </span>
<span class="3338392633918275305" onmouseenter="enter('3338392633918275305');" onmouseout="out('3338392633918275305');" style=""> 821                  LOG.trace(document);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824      }                                                                                                             </span>
<span  style=""> 825                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 826      /**                                                                                                           </span>
<span class="-4161606046612334483" onmouseenter="enter('-4161606046612334483');" onmouseout="out('-4161606046612334483');" style=""> 827       *  We multiply the BigDecimal by 1,000,000 to maintain any possible decimals in use the                      </span>
<span class="1095534727201270293" onmouseenter="enter('1095534727201270293');" onmouseout="out('1095534727201270293');" style=""> 828       *  displayOrder value.                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 829       *                                                                                                            </span>
<span class="1237233419561726312" onmouseenter="enter('1237233419561726312');" onmouseout="out('1237233419561726312');" style=""> 830       * @param cache                                                                                               </span>
<span class="-4411905951100486196" onmouseenter="enter('-4411905951100486196');" onmouseout="out('-4411905951100486196');" style=""> 831       * @param displayOrderKey                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 832       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 833       */                                                                                                           </span>
<span class="1635922478501180747" onmouseenter="enter('1635922478501180747');" onmouseout="out('1635922478501180747');" style=""> 834      protected Long convertDisplayOrderToLong(CatalogStructure cache, String displayOrderKey) {                    </span>
<span class="4518367233651177280" onmouseenter="enter('4518367233651177280');" onmouseout="out('4518367233651177280');" style=""> 835          BigDecimal displayOrder = cache.getDisplayOrdersByCategoryProduct().get(displayOrderKey);                 </span>
<span  style=""> 836                                                                                                                    </span>
<span class="5014973012510290491" onmouseenter="enter('5014973012510290491');" onmouseout="out('5014973012510290491');" style=""> 837          if (displayOrder == null) {                                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 838              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839          }                                                                                                         </span>
<span  style=""> 840                                                                                                                    </span>
<span class="4133773492119237930" onmouseenter="enter('4133773492119237930');" onmouseout="out('4133773492119237930');" style=""> 841          return displayOrder.multiply(BigDecimal.valueOf(1000000)).longValue();                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 842      }                                                                                                             </span>
<span  style=""> 843                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 844      @Override                                                                                                     </span>
<span class="4004348612697349075" onmouseenter="enter('4004348612697349075');" onmouseout="out('4004348612697349075');" style=""> 845      public void deleteByQuery(String deleteQuery) throws SolrServerException, IOException {                       </span>
<span class="1027311076504650094" onmouseenter="enter('1027311076504650094');" onmouseout="out('1027311076504650094');" style=""> 846          String productFilter = shs.getTypeFieldName() + &quot;:&quot; + shs.getPrimaryDocumentType();                       </span>
<span  style=""> 847                                                                                                                    </span>
<span class="1739252735366935461" onmouseenter="enter('1739252735366935461');" onmouseout="out('1739252735366935461');" style=""><abbr title=" 848          // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t delete non-product documents accidentally"> 848          // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don&#x27;t deletðŸ”µ</abbr></span>
<span class="8967770841500493181" onmouseenter="enter('8967770841500493181');" onmouseout="out('8967770841500493181');" style=""> 849          deleteQuery = productFilter + &quot; AND (&quot; + deleteQuery + &quot;)&quot;;                                               </span>
<span  style=""> 850                                                                                                                    </span>
<span class="35790388838229419" onmouseenter="enter('35790388838229419');" onmouseout="out('35790388838229419');" style=""> 851          String childDeleteQuery = &quot;{!child of=&quot; + productFilter + &quot;} &quot; + deleteQuery;                             </span>
<span class="-5097470124987660196" onmouseenter="enter('-5097470124987660196');" onmouseout="out('-5097470124987660196');" style=""> 852          solrConfiguration.getServer().deleteByQuery(childDeleteQuery);                                            </span>
<span class="-4328599925487855664" onmouseenter="enter('-4328599925487855664');" onmouseout="out('-4328599925487855664');" style=""> 853          solrConfiguration.getServer().deleteByQuery(deleteQuery);                                                 </span>


<span  style=""> 854                                                                                                                    </span>
<span class="2572292351348869388" onmouseenter="enter('2572292351348869388');" onmouseout="out('2572292351348869388');" style=""> 855          logDeleteQuery(childDeleteQuery);                                                                         </span>
<span class="-7276176933862949274" onmouseenter="enter('-7276176933862949274');" onmouseout="out('-7276176933862949274');" style=""> 856          logDeleteQuery(deleteQuery);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 857      }                                                                                                             </span>
<span  style=""> 858                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 859      @Override                                                                                                     </span>
<span class="-7948321486753422000" onmouseenter="enter('-7948321486753422000');" onmouseout="out('-7948321486753422000');" style=""> 860      public void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException {   </span>
<span class="-3675518693353771931" onmouseenter="enter('-3675518693353771931');" onmouseout="out('-3675518693353771931');" style=""> 861          solrConfiguration.getServer().add(documents);                                                             </span>

<span class="6412225141999109234" onmouseenter="enter('6412225141999109234');" onmouseout="out('6412225141999109234');" style=""> 862          logDocuments(documents);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863      }                                                                                                             </span>
<span  style=""> 864                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 865      @Override                                                                                                     </span>
<span class="5429697153738572572" onmouseenter="enter('5429697153738572572');" onmouseout="out('5429697153738572572');" style=""> 866      public void logDeleteQuery(String deleteQuery) {                                                              </span>
<span class="4800026243591222227" onmouseenter="enter('4800026243591222227');" onmouseout="out('4800026243591222227');" style=""> 867          if (LOG.isDebugEnabled()) {                                                                               </span>
<span class="1652863876971966554" onmouseenter="enter('1652863876971966554');" onmouseout="out('1652863876971966554');" style=""> 868              LOG.debug(&quot;Delete query: &quot; + deleteQuery);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 870      }                                                                                                             </span>
<span  style=""> 871                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 872 +    @Override                                                                                                     </span>
<span class="-7107052052553344125" onmouseenter="enter('-7107052052553344125');" onmouseout="out('-7107052052553344125');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 873 +    public boolean useLegacyIndexer() {                                                                           </span>
<span class="-518627155049265606" onmouseenter="enter('-518627155049265606');" onmouseout="out('-518627155049265606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 874 +        return useLegacySolrIndexer;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 875 +    }                                                                                                             </span>


























<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            