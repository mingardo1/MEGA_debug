<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>74</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    74
                    <a href="73.html">prev</a>
                    <a href="75.html">next</a>
                    <a href="74_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CarGuo/GSYVideoPlayer_d4d1bdf16a1634f70fffbb34594c8ee5d317b61f_app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoPlayerManager.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;d4d1bdf16a1634f70fffbb34594c8ee5d317b61f:app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoPlayerManager.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;d4d1bdf16a1634f70fffbb34594c8ee5d317b61f^1:app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoPlayerManager.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;d4d1bdf16a1634f70fffbb34594c8ee5d317b61f^2:app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoPlayerManager.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;111bb508922fe092629031fd764786b96f53a796:app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoPlayerManager.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [j], [j]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 package com.example.gsyvideoplayer.exo;
   2 
   3 import android.content.Context;
   4 import android.media.AudioManager;
   5 import android.os.Message;
   6 import android.view.Surface;
   7 
   8 import com.google.android.exoplayer2.video.DummySurface;
   9 import com.shuyu.gsyvideoplayer.cache.ICacheManager;
  10 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  11 import com.shuyu.gsyvideoplayer.player.BasePlayerManager;
  12 import com.shuyu.gsyvideoplayer.utils.Debuger;
  13 
  14 import java.util.List;
  15 
  16 import tv.danmaku.ijk.media.exo2.IjkExo2MediaPlayer;
  17 import tv.danmaku.ijk.media.player.IMediaPlayer;
  18 
  19 /**
  20  * Created by guoshuyu on 2018/5/16.
  21  * 自定义player管理器，装载自定义exo player，实现无缝切换效果
  22  */
  23 public class GSYExoPlayerManager extends BasePlayerManager {
  24 
  25     private GSYExo2MediaPlayer mediaPlayer;
  26 
  27     private Surface surface;
  28 
  29     private DummySurface dummySurface;
  30 
  31     @Override
  32     public IMediaPlayer getMediaPlayer() {
  33         return mediaPlayer;
  34     }
  35 
  36     @Override
<abbr title="  37     public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICacheManager cacheManager) {">  37     public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICa🔵</abbr>
  38         mediaPlayer = new GSYExo2MediaPlayer(context);
  39         mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
  40         if (dummySurface == null) {
  41             dummySurface = DummySurface.newInstanceV17(context, false);
  42         }
  43         try {
  44             mediaPlayer.setLooping(((GSYExoModel) msg.obj).isLooping());
  45             Debuger.printfError(&quot;###### &quot; + ((GSYExoModel) msg.obj).getOverrideExtension());
  46             mediaPlayer.setOverrideExtension(((GSYExoModel) msg.obj).getOverrideExtension());
<abbr title="  47             mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(), ((GSYExoModel) msg.obj).index, ((GSYExoModel) msg.obj).isCache());">  47             mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHe🔵</abbr>
  48             //很遗憾，EXO2的setSpeed只能在播放前生效
  49             if (((GSYExoModel) msg.obj).getSpeed() != 1 &amp;&amp; ((GSYExoModel) msg.obj).getSpeed() &gt; 0) {
  50                 mediaPlayer.setSpeed(((GSYExoModel) msg.obj).getSpeed(), 1);
  51             }
  52         } catch (Exception e) {
  53             e.printStackTrace();
  54         }
  55     }
  56 
  57     @Override
  58     public void showDisplay(Message msg) {
  59         if (mediaPlayer == null) {
  60             return;
  61         }
  62         if (msg.obj == null) {
  63             mediaPlayer.setSurface(dummySurface);
  64         } else {
  65             Surface holder = (Surface) msg.obj;
  66             surface = holder;
  67             mediaPlayer.setSurface(holder);
  68         }
  69     }
  70 
  71     @Override
  72     public void setSpeed(float speed, boolean soundTouch) {
  73         //很遗憾，EXO2的setSpeed只能在播放前生效
  74         //Debuger.printfError(&quot;很遗憾，目前EXO2的setSpeed只能在播放前设置生效&quot;);
  75         if (mediaPlayer != null) {
  76             try {
  77                 mediaPlayer.setSpeed(speed, 1);
  78             } catch (Exception e) {
  79                 e.printStackTrace();
  80             }
  81         }
  82     }
  83 
  84     @Override
  85     public void setNeedMute(boolean needMute) {
  86         if (mediaPlayer != null) {
  87             if (needMute) {
  88                 mediaPlayer.setVolume(0, 0);
  89             } else {
  90                 mediaPlayer.setVolume(1, 1);
  91             }
  92         }
  93     }
  94 
  95     @Override
  96     public void setVolume(float left, float right) {
  97         if (mediaPlayer != null) {
  98             mediaPlayer.setVolume(left, right);
  99         }
 100     }
 101 
 102     @Override
 103     public void releaseSurface() {
 104         if (surface != null) {
 105             //surface.release();
 106             surface = null;
 107         }
 108     }
 109 
 110     /**
 111      * 测试异步释放
 112      * */
 113     @Override
 114     public void release() {
 115         if (mediaPlayer != null) {
 116             final IjkExo2MediaPlayer mm = mediaPlayer;
 117             /// todo 测试异步，可能会收到警告
<abbr title=" 118             /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-accessed-on-wrong-thread"> 118             /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-acce🔵</abbr>
 119 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120 //            new Thread(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121 //                    new Runnable() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122 //                        @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123 //                        public void run() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124                            mm.setSurface(null);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125                            mm.release();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126 //</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127 //                        }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128 //</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129 //                    }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130 //            ).start();</span>
 131 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132             new Thread(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133                     new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134                         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135                         public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136                             mm.setSurface(null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137                             mm.release();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142             ).start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143             mediaPlayer = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         }</span>
 145 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146             /*new Thread(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                     new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148                         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149                         public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150                             mm.setSurface(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151                             mm.release();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156             ).start();*/</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157             mm.setSurface(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158             mm.release();</span>
 159 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 160             mediaPlayer = null;
 161         }
 162         if (dummySurface != null) {
 163             dummySurface.release();
 164             dummySurface = null;
 165         }
 166     }
 167 
 168     @Override
 169     public int getBufferedPercentage() {
 170         return -1;
 171     }
 172 
 173     /**
 174      * 上一集
 175      */
 176     public void previous() {
 177         if (mediaPlayer == null) {
 178             return;
 179         }
 180         mediaPlayer.previous();
 181     }
 182 
 183     /**
 184      * 下一集
 185      */
 186     public void next() {
 187         if (mediaPlayer == null) {
 188             return;
 189         }
 190         mediaPlayer.next();
 191     }
 192 
 193     @Override
 194     public long getNetSpeed() {
 195         return 0;
 196     }
 197 
 198     @Override
 199     public void setSpeedPlaying(float speed, boolean soundTouch) {
 200 
 201     }
 202 
 203     @Override
 204     public void start() {
 205         if (mediaPlayer != null) {
 206             mediaPlayer.start();
 207         }
 208     }
 209 
 210     @Override
 211     public void stop() {
 212         if (mediaPlayer != null) {
 213             mediaPlayer.stop();
 214         }
 215     }
 216 
 217     @Override
 218     public void pause() {
 219         if (mediaPlayer != null) {
 220             mediaPlayer.pause();
 221         }
 222     }
 223 
 224     @Override
 225     public int getVideoWidth() {
 226         if (mediaPlayer != null) {
 227             return mediaPlayer.getVideoWidth();
 228         }
 229         return 0;
 230     }
 231 
 232     @Override
 233     public int getVideoHeight() {
 234         if (mediaPlayer != null) {
 235             return mediaPlayer.getVideoHeight();
 236         }
 237         return 0;
 238     }
 239 
 240     @Override
 241     public boolean isPlaying() {
 242         if (mediaPlayer != null) {
 243             return mediaPlayer.isPlaying();
 244         }
 245         return false;
 246     }
 247 
 248     @Override
 249     public void seekTo(long time) {
 250         if (mediaPlayer != null) {
 251             mediaPlayer.seekTo(time);
 252         }
 253     }
 254 
 255     @Override
 256     public long getCurrentPosition() {
 257         if (mediaPlayer != null) {
 258             return mediaPlayer.getCurrentPosition();
 259         }
 260         return 0;
 261     }
 262 
 263     @Override
 264     public long getDuration() {
 265         if (mediaPlayer != null) {
 266             return mediaPlayer.getDuration();
 267         }
 268         return 0;
 269     }
 270 
 271     @Override
 272     public int getVideoSarNum() {
 273         if (mediaPlayer != null) {
 274             return mediaPlayer.getVideoSarNum();
 275         }
 276         return 1;
 277     }
 278 
 279     @Override
 280     public int getVideoSarDen() {
 281         if (mediaPlayer != null) {
 282             return mediaPlayer.getVideoSarDen();
 283         }
 284         return 1;
 285     }
 286 
 287     @Override
 288     public boolean isSurfaceSupportLockCanvas() {
 289         return false;
 290     }
 291 }</pre></td>
                            <td><pre>   1 package com.example.gsyvideoplayer.exo;
   2 
   3 import android.content.Context;
   4 import android.media.AudioManager;
   5 import android.os.Message;
   6 import android.view.Surface;
   7 
   8 import com.google.android.exoplayer2.video.DummySurface;
   9 import com.shuyu.gsyvideoplayer.cache.ICacheManager;
  10 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  11 import com.shuyu.gsyvideoplayer.player.BasePlayerManager;
  12 import com.shuyu.gsyvideoplayer.utils.Debuger;
  13 
  14 import java.util.List;
  15 
  16 import tv.danmaku.ijk.media.exo2.IjkExo2MediaPlayer;
  17 import tv.danmaku.ijk.media.player.IMediaPlayer;
  18 
  19 /**
  20  * Created by guoshuyu on 2018/5/16.
  21  * 自定义player管理器，装载自定义exo player，实现无缝切换效果
  22  */
  23 public class GSYExoPlayerManager extends BasePlayerManager {
  24 
  25     private GSYExo2MediaPlayer mediaPlayer;
  26 
  27     private Surface surface;
  28 
  29     private DummySurface dummySurface;
  30 
  31     @Override
  32     public IMediaPlayer getMediaPlayer() {
  33         return mediaPlayer;
  34     }
  35 
  36     @Override
<abbr title="  37     public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICacheManager cacheManager) {">  37     public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICa🔵</abbr>
  38         mediaPlayer = new GSYExo2MediaPlayer(context);
  39         mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
  40         if (dummySurface == null) {
  41             dummySurface = DummySurface.newInstanceV17(context, false);
  42         }
  43         try {
  44             mediaPlayer.setLooping(((GSYExoModel) msg.obj).isLooping());
  45             Debuger.printfError(&quot;###### &quot; + ((GSYExoModel) msg.obj).getOverrideExtension());
  46             mediaPlayer.setOverrideExtension(((GSYExoModel) msg.obj).getOverrideExtension());
<abbr title="  47             mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(), ((GSYExoModel) msg.obj).index, ((GSYExoModel) msg.obj).isCache());">  47             mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHe🔵</abbr>
  48             //很遗憾，EXO2的setSpeed只能在播放前生效
  49             if (((GSYExoModel) msg.obj).getSpeed() != 1 &amp;&amp; ((GSYExoModel) msg.obj).getSpeed() &gt; 0) {
  50                 mediaPlayer.setSpeed(((GSYExoModel) msg.obj).getSpeed(), 1);
  51             }
  52         } catch (Exception e) {
  53             e.printStackTrace();
  54         }
  55     }
  56 
  57     @Override
  58     public void showDisplay(Message msg) {
  59         if (mediaPlayer == null) {
  60             return;
  61         }
  62         if (msg.obj == null) {
  63             mediaPlayer.setSurface(dummySurface);
  64         } else {
  65             Surface holder = (Surface) msg.obj;
  66             surface = holder;
  67             mediaPlayer.setSurface(holder);
  68         }
  69     }
  70 
  71     @Override
  72     public void setSpeed(float speed, boolean soundTouch) {
  73         //很遗憾，EXO2的setSpeed只能在播放前生效
  74         //Debuger.printfError(&quot;很遗憾，目前EXO2的setSpeed只能在播放前设置生效&quot;);
  75         if (mediaPlayer != null) {
  76             try {
  77                 mediaPlayer.setSpeed(speed, 1);
  78             } catch (Exception e) {
  79                 e.printStackTrace();
  80             }
  81         }
  82     }
  83 
  84     @Override
  85     public void setNeedMute(boolean needMute) {
  86         if (mediaPlayer != null) {
  87             if (needMute) {
  88                 mediaPlayer.setVolume(0, 0);
  89             } else {
  90                 mediaPlayer.setVolume(1, 1);
  91             }
  92         }
  93     }
  94 
  95     @Override
  96     public void setVolume(float left, float right) {
  97         if (mediaPlayer != null) {
  98             mediaPlayer.setVolume(left, right);
  99         }
 100     }
 101 
 102     @Override
 103     public void releaseSurface() {
 104         if (surface != null) {
 105             //surface.release();
 106             surface = null;
 107         }
 108     }
 109 
 110     /**
 111      * 测试异步释放
 112      * */
 113     @Override
 114     public void release() {
 115         if (mediaPlayer != null) {
 116             final IjkExo2MediaPlayer mm = mediaPlayer;
 117             /// todo 测试异步，可能会收到警告
<abbr title=" 118             /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-accessed-on-wrong-thread"> 118             /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-acce🔵</abbr>
 119 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120 //            new Thread(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121 //                    new Runnable() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122 //                        @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123 //                        public void run() {</span>
 124 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125             new Thread(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126                     new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127                         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128                         public void run() {</span>
 129 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130             /*new Thread(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131                     new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132                         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133                         public void run() {</span>
 134 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 135                             mm.setSurface(null);
 136                             mm.release();
 137 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138 //</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139 //                        }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140 //</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141 //                    }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142 //            ).start();</span>
 143 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148             ).start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149             mediaPlayer = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         }</span>
 151 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156             ).start();*/</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157             mm.setSurface(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158             mm.release();</span>
 159 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 160             mediaPlayer = null;
 161         }
 162         if (dummySurface != null) {
 163             dummySurface.release();
 164             dummySurface = null;
 165         }
 166     }
 167 
 168     @Override
 169     public int getBufferedPercentage() {
 170         return -1;
 171     }
 172 
 173     /**
 174      * 上一集
 175      */
 176     public void previous() {
 177         if (mediaPlayer == null) {
 178             return;
 179         }
 180         mediaPlayer.previous();
 181     }
 182 
 183     /**
 184      * 下一集
 185      */
 186     public void next() {
 187         if (mediaPlayer == null) {
 188             return;
 189         }
 190         mediaPlayer.next();
 191     }
 192 
 193     @Override
 194     public long getNetSpeed() {
 195         return 0;
 196     }
 197 
 198     @Override
 199     public void setSpeedPlaying(float speed, boolean soundTouch) {
 200 
 201     }
 202 
 203     @Override
 204     public void start() {
 205         if (mediaPlayer != null) {
 206             mediaPlayer.start();
 207         }
 208     }
 209 
 210     @Override
 211     public void stop() {
 212         if (mediaPlayer != null) {
 213             mediaPlayer.stop();
 214         }
 215     }
 216 
 217     @Override
 218     public void pause() {
 219         if (mediaPlayer != null) {
 220             mediaPlayer.pause();
 221         }
 222     }
 223 
 224     @Override
 225     public int getVideoWidth() {
 226         if (mediaPlayer != null) {
 227             return mediaPlayer.getVideoWidth();
 228         }
 229         return 0;
 230     }
 231 
 232     @Override
 233     public int getVideoHeight() {
 234         if (mediaPlayer != null) {
 235             return mediaPlayer.getVideoHeight();
 236         }
 237         return 0;
 238     }
 239 
 240     @Override
 241     public boolean isPlaying() {
 242         if (mediaPlayer != null) {
 243             return mediaPlayer.isPlaying();
 244         }
 245         return false;
 246     }
 247 
 248     @Override
 249     public void seekTo(long time) {
 250         if (mediaPlayer != null) {
 251             mediaPlayer.seekTo(time);
 252         }
 253     }
 254 
 255     @Override
 256     public long getCurrentPosition() {
 257         if (mediaPlayer != null) {
 258             return mediaPlayer.getCurrentPosition();
 259         }
 260         return 0;
 261     }
 262 
 263     @Override
 264     public long getDuration() {
 265         if (mediaPlayer != null) {
 266             return mediaPlayer.getDuration();
 267         }
 268         return 0;
 269     }
 270 
 271     @Override
 272     public int getVideoSarNum() {
 273         if (mediaPlayer != null) {
 274             return mediaPlayer.getVideoSarNum();
 275         }
 276         return 1;
 277     }
 278 
 279     @Override
 280     public int getVideoSarDen() {
 281         if (mediaPlayer != null) {
 282             return mediaPlayer.getVideoSarDen();
 283         }
 284         return 1;
 285     }
 286 
 287     @Override
 288     public boolean isSurfaceSupportLockCanvas() {
 289         return false;
 290     }
 291 }</pre></td>
                            <td><pre>   1 package com.example.gsyvideoplayer.exo;
   2 
   3 import android.content.Context;
   4 import android.media.AudioManager;
   5 import android.os.Message;
   6 import android.view.Surface;
   7 import com.google.android.exoplayer2.video.DummySurface;
   8 import com.shuyu.gsyvideoplayer.cache.ICacheManager;
   9 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  10 import com.shuyu.gsyvideoplayer.player.BasePlayerManager;
  11 import com.shuyu.gsyvideoplayer.utils.Debuger;
  12 import java.util.List;
  13 import tv.danmaku.ijk.media.exo2.IjkExo2MediaPlayer;
  14 import tv.danmaku.ijk.media.player.IMediaPlayer;
  15 
  16 
  17 /**
  18  * Created by guoshuyu on 2018/5/16.
  19  * 自定义player管理器，装载自定义exo player，实现无缝切换效果
  20  */
  21 public class GSYExoPlayerManager extends BasePlayerManager {
  22     private GSYExo2MediaPlayer mediaPlayer;
  23 
  24     private Surface surface;
  25 
  26     private DummySurface dummySurface;
  27 
  28     @Override
  29     public IMediaPlayer getMediaPlayer() {
  30         return mediaPlayer;
  31     }
  32 
  33     @Override
<abbr title="  34     public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICacheManager cacheManager) {">  34     public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICa🔵</abbr>
  35         mediaPlayer = new GSYExo2MediaPlayer(context);
  36         mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
  37         if (dummySurface == null) {
  38             dummySurface = DummySurface.newInstanceV17(context, false);
  39         }
  40         try {
  41             mediaPlayer.setLooping(((GSYExoModel) msg.obj).isLooping());
  42             Debuger.printfError(&quot;###### &quot; + ((GSYExoModel) msg.obj).getOverrideExtension());
  43             mediaPlayer.setOverrideExtension(((GSYExoModel) msg.obj).getOverrideExtension());
<abbr title="  44             mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(), ((GSYExoModel) msg.obj).index, ((GSYExoModel) msg.obj).isCache());">  44             mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHe🔵</abbr>
  45             //很遗憾，EXO2的setSpeed只能在播放前生效
  46             if (((GSYExoModel) msg.obj).getSpeed() != 1 &amp;&amp; ((GSYExoModel) msg.obj).getSpeed() &gt; 0) {
  47                 mediaPlayer.setSpeed(((GSYExoModel) msg.obj).getSpeed(), 1);
  48             }
  49         } catch (Exception e) {
  50             e.printStackTrace();
  51         }
  52     }
  53 
  54     @Override
  55     public void showDisplay(Message msg) {
  56         if (mediaPlayer == null) {
  57             return;
  58         }
  59         if (msg.obj == null) {
  60             mediaPlayer.setSurface(dummySurface);
  61         } else {
  62             Surface holder = (Surface) msg.obj;
  63             surface = holder;
  64             mediaPlayer.setSurface(holder);
  65         }
  66     }
  67 
  68     @Override
  69     public void setSpeed(float speed, boolean soundTouch) {
  70         //很遗憾，EXO2的setSpeed只能在播放前生效
  71         //Debuger.printfError(&quot;很遗憾，目前EXO2的setSpeed只能在播放前设置生效&quot;);
  72         if (mediaPlayer != null) {
  73             try {
  74                 mediaPlayer.setSpeed(speed, 1);
  75             } catch (Exception e) {
  76                 e.printStackTrace();
  77             }
  78         }
  79     }
  80 
  81     @Override
  82     public void setNeedMute(boolean needMute) {
  83         if (mediaPlayer != null) {
  84             if (needMute) {
  85                 mediaPlayer.setVolume(0, 0);
  86             } else {
  87                 mediaPlayer.setVolume(1, 1);
  88             }
  89         }
  90     }
  91 
  92     @Override
  93     public void setVolume(float left, float right) {
  94         if (mediaPlayer != null) {
  95             mediaPlayer.setVolume(left, right);
  96         }
  97     }
  98 
  99     @Override
 100     public void releaseSurface() {
 101         if (surface != null) {
 102             //surface.release();
 103             surface = null;
 104         }
 105     }
 106 
 107     /**
 108      * 测试异步释放
 109      * */
 110     @Override
 111     public void release() {
 112         if (mediaPlayer != null) {
 113             final IjkExo2MediaPlayer mm = mediaPlayer;
 114             /// todo 测试异步，可能会收到警告
<abbr title=" 115             /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-accessed-on-wrong-thread"> 115             /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-acce🔵</abbr>
 116             mm.setSurface(null);
 117             mm.release();
 118 //
 119 //                        }
 120 //
 121 //                    }
 122 //            ).start();
 123             mediaPlayer = null;
 124         }
 125         if (dummySurface != null) {
 126             dummySurface.release();
 127             dummySurface = null;
 128         }
 129     }
 130 
 131     @Override
 132     public int getBufferedPercentage() {
 133         return -1;
 134     }
 135 
 136     /**
 137      * 上一集
 138      */
 139     public void previous() {
 140         if (mediaPlayer == null) {
 141             return;
 142         }
 143         mediaPlayer.previous();
 144     }
 145 
 146     /**
 147      * 下一集
 148      */
 149     public void next() {
 150         if (mediaPlayer == null) {
 151             return;
 152         }
 153         mediaPlayer.next();
 154     }
 155 
 156     @Override
 157     public long getNetSpeed() {
 158         return 0;
 159     }
 160 
 161     @Override
 162     public void setSpeedPlaying(float speed, boolean soundTouch) {
 163 
 164     }
 165 
 166     @Override
 167     public void start() {
 168         if (mediaPlayer != null) {
 169             mediaPlayer.start();
 170         }
 171     }
 172 
 173     @Override
 174     public void stop() {
 175         if (mediaPlayer != null) {
 176             mediaPlayer.stop();
 177         }
 178     }
 179 
 180     @Override
 181     public void pause() {
 182         if (mediaPlayer != null) {
 183             mediaPlayer.pause();
 184         }
 185     }
 186 
 187     @Override
 188     public int getVideoWidth() {
 189         if (mediaPlayer != null) {
 190             return mediaPlayer.getVideoWidth();
 191         }
 192         return 0;
 193     }
 194 
 195     @Override
 196     public int getVideoHeight() {
 197         if (mediaPlayer != null) {
 198             return mediaPlayer.getVideoHeight();
 199         }
 200         return 0;
 201     }
 202 
 203     @Override
 204     public boolean isPlaying() {
 205         if (mediaPlayer != null) {
 206             return mediaPlayer.isPlaying();
 207         }
 208         return false;
 209     }
 210 
 211     @Override
 212     public void seekTo(long time) {
 213         if (mediaPlayer != null) {
 214             mediaPlayer.seekTo(time);
 215         }
 216     }
 217 
 218     @Override
 219     public long getCurrentPosition() {
 220         if (mediaPlayer != null) {
 221             return mediaPlayer.getCurrentPosition();
 222         }
 223         return 0;
 224     }
 225 
 226     @Override
 227     public long getDuration() {
 228         if (mediaPlayer != null) {
 229             return mediaPlayer.getDuration();
 230         }
 231         return 0;
 232     }
 233 
 234     @Override
 235     public int getVideoSarNum() {
 236         if (mediaPlayer != null) {
 237             return mediaPlayer.getVideoSarNum();
 238         }
 239         return 1;
 240     }
 241 
 242     @Override
 243     public int getVideoSarDen() {
 244         if (mediaPlayer != null) {
 245             return mediaPlayer.getVideoSarDen();
 246         }
 247         return 1;
 248     }
 249 
 250     @Override
 251     public boolean isSurfaceSupportLockCanvas() {
 252         return false;
 253     }
 254 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  package com.example.gsyvideoplayer.exo;
   2  
   3  import android.content.Context;
   4  import android.media.AudioManager;
   5  import android.os.Message;
   6  import android.view.Surface;
   7  
   8  import com.google.android.exoplayer2.video.DummySurface;
   9  import com.shuyu.gsyvideoplayer.cache.ICacheManager;
  10  import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  11  import com.shuyu.gsyvideoplayer.player.BasePlayerManager;
  12  import com.shuyu.gsyvideoplayer.utils.Debuger;
  13  
  14  import java.util.List;
  15  
  16  import tv.danmaku.ijk.media.exo2.IjkExo2MediaPlayer;
  17  import tv.danmaku.ijk.media.player.IMediaPlayer;
  18  
  19  /**
  20   * Created by guoshuyu on 2018/5/16.
  21   * 自定义player管理器，装载自定义exo player，实现无缝切换效果
  22   */
  23  public class GSYExoPlayerManager extends BasePlayerManager {
  24  
  25      private GSYExo2MediaPlayer mediaPlayer;
  26  
  27      private Surface surface;
  28  
  29      private DummySurface dummySurface;
  30  
  31      @Override
  32      public IMediaPlayer getMediaPlayer() {
  33          return mediaPlayer;
  34      }
  35  
  36      @Override
<abbr title="  37      public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICacheManager cacheManager) {">  37      public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICacheManage🔵</abbr>
  38          mediaPlayer = new GSYExo2MediaPlayer(context);
  39          mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
  40          if (dummySurface == null) {
  41              dummySurface = DummySurface.newInstanceV17(context, false);
  42          }
  43          try {
  44              mediaPlayer.setLooping(((GSYExoModel) msg.obj).isLooping());
  45              Debuger.printfError(&quot;###### &quot; + ((GSYExoModel) msg.obj).getOverrideExtension());
  46              mediaPlayer.setOverrideExtension(((GSYExoModel) msg.obj).getOverrideExtension());
<abbr title="  47              mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(), ((GSYExoModel) msg.obj).index, ((GSYExoModel) msg.obj).isCache());">  47              mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(),🔵</abbr>
  48              //很遗憾，EXO2的setSpeed只能在播放前生效
  49              if (((GSYExoModel) msg.obj).getSpeed() != 1 &amp;&amp; ((GSYExoModel) msg.obj).getSpeed() &gt; 0) {
  50                  mediaPlayer.setSpeed(((GSYExoModel) msg.obj).getSpeed(), 1);
  51              }
  52          } catch (Exception e) {
  53              e.printStackTrace();
  54          }
  55      }
  56  
  57      @Override
  58      public void showDisplay(Message msg) {
  59          if (mediaPlayer == null) {
  60              return;
  61          }
  62          if (msg.obj == null) {
  63              mediaPlayer.setSurface(dummySurface);
  64          } else {
  65              Surface holder = (Surface) msg.obj;
  66              surface = holder;
  67              mediaPlayer.setSurface(holder);
  68          }
  69      }
  70  
  71      @Override
  72      public void setSpeed(float speed, boolean soundTouch) {
  73          //很遗憾，EXO2的setSpeed只能在播放前生效
  74          //Debuger.printfError(&quot;很遗憾，目前EXO2的setSpeed只能在播放前设置生效&quot;);
  75          if (mediaPlayer != null) {
  76              try {
  77                  mediaPlayer.setSpeed(speed, 1);
  78              } catch (Exception e) {
  79                  e.printStackTrace();
  80              }
  81          }
  82      }
  83  
  84      @Override
  85      public void setNeedMute(boolean needMute) {
  86          if (mediaPlayer != null) {
  87              if (needMute) {
  88                  mediaPlayer.setVolume(0, 0);
  89              } else {
  90                  mediaPlayer.setVolume(1, 1);
  91              }
  92          }
  93      }
  94  
  95      @Override
  96      public void setVolume(float left, float right) {
  97          if (mediaPlayer != null) {
  98              mediaPlayer.setVolume(left, right);
  99          }
 100      }
 101  
 102      @Override
 103      public void releaseSurface() {
 104          if (surface != null) {
 105              //surface.release();
 106              surface = null;
 107          }
 108      }
 109  
 110      /**
 111       * 测试异步释放
 112       * */
 113      @Override
 114      public void release() {
 115          if (mediaPlayer != null) {
 116              final IjkExo2MediaPlayer mm = mediaPlayer;
 117              /// todo 测试异步，可能会收到警告
<abbr title=" 118              /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-accessed-on-wrong-thread"> 118              /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-accessed-on-w🔵</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -            new Thread(</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -                    new Runnable() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -                        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -                        public void run() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -                            mm.setSurface(null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -                            mm.release();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -                        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -            ).start();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +//            new Thread(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +//                    new Runnable() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +//                        @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +//                        public void run() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +                           mm.setSurface(null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +                           mm.release();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +//</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +//                        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +//</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +//                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +//            ).start();</span>
 141              mediaPlayer = null;
 142          }
 143          if (dummySurface != null) {
 144              dummySurface.release();
 145              dummySurface = null;
 146          }
 147      }
 148  
 149      @Override
 150      public int getBufferedPercentage() {
 151          return -1;
 152      }
 153  
 154      /**
 155       * 上一集
 156       */
 157      public void previous() {
 158          if (mediaPlayer == null) {
 159              return;
 160          }
 161          mediaPlayer.previous();
 162      }
 163  
 164      /**
 165       * 下一集
 166       */
 167      public void next() {
 168          if (mediaPlayer == null) {
 169              return;
 170          }
 171          mediaPlayer.next();
 172      }
 173  
 174      @Override
 175      public long getNetSpeed() {
 176          return 0;
 177      }
 178  
 179      @Override
 180      public void setSpeedPlaying(float speed, boolean soundTouch) {
 181  
 182      }
 183  
 184      @Override
 185      public void start() {
 186          if (mediaPlayer != null) {
 187              mediaPlayer.start();
 188          }
 189      }
 190  
 191      @Override
 192      public void stop() {
 193          if (mediaPlayer != null) {
 194              mediaPlayer.stop();
 195          }
 196      }
 197  
 198      @Override
 199      public void pause() {
 200          if (mediaPlayer != null) {
 201              mediaPlayer.pause();
 202          }
 203      }
 204  
 205      @Override
 206      public int getVideoWidth() {
 207          if (mediaPlayer != null) {
 208              return mediaPlayer.getVideoWidth();
 209          }
 210          return 0;
 211      }
 212  
 213      @Override
 214      public int getVideoHeight() {
 215          if (mediaPlayer != null) {
 216              return mediaPlayer.getVideoHeight();
 217          }
 218          return 0;
 219      }
 220  
 221      @Override
 222      public boolean isPlaying() {
 223          if (mediaPlayer != null) {
 224              return mediaPlayer.isPlaying();
 225          }
 226          return false;
 227      }
 228  
 229      @Override
 230      public void seekTo(long time) {
 231          if (mediaPlayer != null) {
 232              mediaPlayer.seekTo(time);
 233          }
 234      }
 235  
 236      @Override
 237      public long getCurrentPosition() {
 238          if (mediaPlayer != null) {
 239              return mediaPlayer.getCurrentPosition();
 240          }
 241          return 0;
 242      }
 243  
 244      @Override
 245      public long getDuration() {
 246          if (mediaPlayer != null) {
 247              return mediaPlayer.getDuration();
 248          }
 249          return 0;
 250      }
 251  
 252      @Override
 253      public int getVideoSarNum() {
 254          if (mediaPlayer != null) {
 255              return mediaPlayer.getVideoSarNum();
 256          }
 257          return 1;
 258      }
 259  
 260      @Override
 261      public int getVideoSarDen() {
 262          if (mediaPlayer != null) {
 263              return mediaPlayer.getVideoSarDen();
 264          }
 265          return 1;
 266      }
 267  
 268      @Override
 269      public boolean isSurfaceSupportLockCanvas() {
 270          return false;
 271      }
 272  }</pre></td>
                            <td><pre>   1  package com.example.gsyvideoplayer.exo;
   2  
   3  import android.content.Context;
   4  import android.media.AudioManager;
   5  import android.os.Message;
   6  import android.view.Surface;
   7  
   8  import com.google.android.exoplayer2.video.DummySurface;
   9  import com.shuyu.gsyvideoplayer.cache.ICacheManager;
  10  import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  11  import com.shuyu.gsyvideoplayer.player.BasePlayerManager;
  12  import com.shuyu.gsyvideoplayer.utils.Debuger;
  13  
  14  import java.util.List;
  15  
  16  import tv.danmaku.ijk.media.exo2.IjkExo2MediaPlayer;
  17  import tv.danmaku.ijk.media.player.IMediaPlayer;
  18  
  19  /**
  20   * Created by guoshuyu on 2018/5/16.
  21   * 自定义player管理器，装载自定义exo player，实现无缝切换效果
  22   */
  23  public class GSYExoPlayerManager extends BasePlayerManager {
  24  
  25      private GSYExo2MediaPlayer mediaPlayer;
  26  
  27      private Surface surface;
  28  
  29      private DummySurface dummySurface;
  30  
  31      @Override
  32      public IMediaPlayer getMediaPlayer() {
  33          return mediaPlayer;
  34      }
  35  
  36      @Override
<abbr title="  37      public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICacheManager cacheManager) {">  37      public void initVideoPlayer(Context context, Message msg, List&lt;VideoOptionModel&gt; optionModelList, ICacheManage🔵</abbr>
  38          mediaPlayer = new GSYExo2MediaPlayer(context);
  39          mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
  40          if (dummySurface == null) {
  41              dummySurface = DummySurface.newInstanceV17(context, false);
  42          }
  43          try {
  44              mediaPlayer.setLooping(((GSYExoModel) msg.obj).isLooping());
  45              Debuger.printfError(&quot;###### &quot; + ((GSYExoModel) msg.obj).getOverrideExtension());
  46              mediaPlayer.setOverrideExtension(((GSYExoModel) msg.obj).getOverrideExtension());
<abbr title="  47              mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(), ((GSYExoModel) msg.obj).index, ((GSYExoModel) msg.obj).isCache());">  47              mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(),🔵</abbr>
  48              //很遗憾，EXO2的setSpeed只能在播放前生效
  49              if (((GSYExoModel) msg.obj).getSpeed() != 1 &amp;&amp; ((GSYExoModel) msg.obj).getSpeed() &gt; 0) {
  50                  mediaPlayer.setSpeed(((GSYExoModel) msg.obj).getSpeed(), 1);
  51              }
  52          } catch (Exception e) {
  53              e.printStackTrace();
  54          }
  55      }
  56  
  57      @Override
  58      public void showDisplay(Message msg) {
  59          if (mediaPlayer == null) {
  60              return;
  61          }
  62          if (msg.obj == null) {
  63              mediaPlayer.setSurface(dummySurface);
  64          } else {
  65              Surface holder = (Surface) msg.obj;
  66              surface = holder;
  67              mediaPlayer.setSurface(holder);
  68          }
  69      }
  70  
  71      @Override
  72      public void setSpeed(float speed, boolean soundTouch) {
  73          //很遗憾，EXO2的setSpeed只能在播放前生效
  74          //Debuger.printfError(&quot;很遗憾，目前EXO2的setSpeed只能在播放前设置生效&quot;);
  75          if (mediaPlayer != null) {
  76              try {
  77                  mediaPlayer.setSpeed(speed, 1);
  78              } catch (Exception e) {
  79                  e.printStackTrace();
  80              }
  81          }
  82      }
  83  
  84      @Override
  85      public void setNeedMute(boolean needMute) {
  86          if (mediaPlayer != null) {
  87              if (needMute) {
  88                  mediaPlayer.setVolume(0, 0);
  89              } else {
  90                  mediaPlayer.setVolume(1, 1);
  91              }
  92          }
  93      }
  94  
  95      @Override
  96      public void setVolume(float left, float right) {
  97          if (mediaPlayer != null) {
  98              mediaPlayer.setVolume(left, right);
  99          }
 100      }
 101  
 102      @Override
 103      public void releaseSurface() {
 104          if (surface != null) {
 105              //surface.release();
 106              surface = null;
 107          }
 108      }
 109  
 110      /**
 111       * 测试异步释放
 112       * */
 113      @Override
 114      public void release() {
 115          if (mediaPlayer != null) {
 116              final IjkExo2MediaPlayer mm = mediaPlayer;
 117              /// todo 测试异步，可能会收到警告
<abbr title=" 118              /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-accessed-on-wrong-thread"> 118              /// todo Player is accessed on the wrong thread. See https://exoplayer.dev/issues/player-accessed-on-w🔵</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -            new Thread(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +            /*new Thread(</span>
 121                      new Runnable() {
 122                          @Override
 123                          public void run() {
 124                              mm.setSurface(null);
 125                              mm.release();
 126  
 127                          }
 128  
 129                      }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -            ).start();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +            ).start();*/</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +            mm.setSurface(null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +            mm.release();</span>








 134              mediaPlayer = null;
 135          }
 136          if (dummySurface != null) {
 137              dummySurface.release();
 138              dummySurface = null;
 139          }
 140      }
 141  
 142      @Override
 143      public int getBufferedPercentage() {
 144          return -1;
 145      }
 146  
 147      /**
 148       * 上一集
 149       */
 150      public void previous() {
 151          if (mediaPlayer == null) {
 152              return;
 153          }
 154          mediaPlayer.previous();
 155      }
 156  
 157      /**
 158       * 下一集
 159       */
 160      public void next() {
 161          if (mediaPlayer == null) {
 162              return;
 163          }
 164          mediaPlayer.next();
 165      }
 166  
 167      @Override
 168      public long getNetSpeed() {
 169          return 0;
 170      }
 171  
 172      @Override
 173      public void setSpeedPlaying(float speed, boolean soundTouch) {
 174  
 175      }
 176  
 177      @Override
 178      public void start() {
 179          if (mediaPlayer != null) {
 180              mediaPlayer.start();
 181          }
 182      }
 183  
 184      @Override
 185      public void stop() {
 186          if (mediaPlayer != null) {
 187              mediaPlayer.stop();
 188          }
 189      }
 190  
 191      @Override
 192      public void pause() {
 193          if (mediaPlayer != null) {
 194              mediaPlayer.pause();
 195          }
 196      }
 197  
 198      @Override
 199      public int getVideoWidth() {
 200          if (mediaPlayer != null) {
 201              return mediaPlayer.getVideoWidth();
 202          }
 203          return 0;
 204      }
 205  
 206      @Override
 207      public int getVideoHeight() {
 208          if (mediaPlayer != null) {
 209              return mediaPlayer.getVideoHeight();
 210          }
 211          return 0;
 212      }
 213  
 214      @Override
 215      public boolean isPlaying() {
 216          if (mediaPlayer != null) {
 217              return mediaPlayer.isPlaying();
 218          }
 219          return false;
 220      }
 221  
 222      @Override
 223      public void seekTo(long time) {
 224          if (mediaPlayer != null) {
 225              mediaPlayer.seekTo(time);
 226          }
 227      }
 228  
 229      @Override
 230      public long getCurrentPosition() {
 231          if (mediaPlayer != null) {
 232              return mediaPlayer.getCurrentPosition();
 233          }
 234          return 0;
 235      }
 236  
 237      @Override
 238      public long getDuration() {
 239          if (mediaPlayer != null) {
 240              return mediaPlayer.getDuration();
 241          }
 242          return 0;
 243      }
 244  
 245      @Override
 246      public int getVideoSarNum() {
 247          if (mediaPlayer != null) {
 248              return mediaPlayer.getVideoSarNum();
 249          }
 250          return 1;
 251      }
 252  
 253      @Override
 254      public int getVideoSarDen() {
 255          if (mediaPlayer != null) {
 256              return mediaPlayer.getVideoSarDen();
 257          }
 258          return 1;
 259      }
 260  
 261      @Override
 262      public boolean isSurfaceSupportLockCanvas() {
 263          return false;
 264      }
 265  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            