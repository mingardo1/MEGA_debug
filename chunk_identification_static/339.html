<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>339</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    339
                    <a href="338.html">prev</a>
                    <a href="340.html">next</a>
                    <a href="339_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_f7d94b0cb7419e571db1874a7057f7fbba096a17_impala/impala-sink/src/main/java/com/dtstack/flink/sql/sink/impala/ImpalaOutputFormat.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d94b0cb7419e571db1874a7057f7fbba096a17:impala/impala-sink/src/main/java/com/dtstack/flink/sql/sink/impala/ImpalaOutputFormat.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d94b0cb7419e571db1874a7057f7fbba096a17^1:impala/impala-sink/src/main/java/com/dtstack/flink/sql/sink/impala/ImpalaOutputFormat.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d94b0cb7419e571db1874a7057f7fbba096a17^2:impala/impala-sink/src/main/java/com/dtstack/flink/sql/sink/impala/ImpalaOutputFormat.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;c46cb5c6d0d0b3ed0124fd05b1e4a0e71984bd54:impala/impala-sink/src/main/java/com/dtstack/flink/sql/sink/impala/ImpalaOutputFormat.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b]], subset: [[b], [b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-6349807778844055730" onmouseenter="enter('-6349807778844055730');" onmouseout="out('-6349807778844055730');" style="">  19 package com.dtstack.flink.sql.sink.impala;                                                               </span>
<span  style="">  20                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  21 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="1128057574573805325" onmouseenter="enter('1128057574573805325');" onmouseout="out('1128057574573805325');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import com.dtstack.flink.sql.classloader.ClassLoaderManager;                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  23 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  25 =======                                                                                                  </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  27 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  28 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  29 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-8930056125403642162" onmouseenter="enter('-8930056125403642162');" onmouseout="out('-8930056125403642162');" style="">  30 import com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils;                                              </span>
<span class="-692023547870128618" onmouseenter="enter('-692023547870128618');" onmouseout="out('-692023547870128618');" style="">  31 import com.dtstack.flink.sql.table.AbstractTableInfo;                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  32 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  33 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="6538493847244355843" onmouseenter="enter('6538493847244355843');" onmouseout="out('6538493847244355843');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.dtstack.flink.sql.util.KrbUtils;                                                              </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.google.common.collect.Maps;                                                                   </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  36 =======                                                                                                  </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import com.dtstack.flink.sql.util.DtStringUtil;                                                          </span>
<span class="2068796536125305875" onmouseenter="enter('2068796536125305875');" onmouseout="out('2068796536125305875');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import com.dtstack.flink.sql.util.JDBCUtils;                                                             </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  39 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="6538493847244355843" onmouseenter="enter('6538493847244355843');" onmouseout="out('6538493847244355843');" style="">  40 import com.dtstack.flink.sql.util.KrbUtils;                                                              </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  41 import com.google.common.collect.Maps;                                                                   </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  42 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  43 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  44 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  45 import org.apache.flink.types.Row;                                                                       </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  46 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  47 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  48 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  49                                                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  50 import java.io.IOException;                                                                              </span>
<span class="7889752473047782369" onmouseenter="enter('7889752473047782369');" onmouseout="out('7889752473047782369');" style="">  51 import java.security.PrivilegedExceptionAction;                                                          </span>
<span class="-7136330293413175449" onmouseenter="enter('-7136330293413175449');" onmouseout="out('-7136330293413175449');" style="">  52 import java.sql.Connection;                                                                              </span>
<span class="7894029524760905232" onmouseenter="enter('7894029524760905232');" onmouseout="out('7894029524760905232');" style="">  53 import java.sql.DriverManager;                                                                           </span>
<span class="-3337023324264694028" onmouseenter="enter('-3337023324264694028');" onmouseout="out('-3337023324264694028');" style="">  54 import java.sql.PreparedStatement;                                                                       </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  55 import java.sql.SQLException;                                                                            </span>
<span class="6402527026259660908" onmouseenter="enter('6402527026259660908');" onmouseout="out('6402527026259660908');" style="">  56 import java.sql.Statement;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  57 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  58 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  59 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  60 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  61 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  62 import java.util.Set;                                                                                    </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  63 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  64 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  65 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  66 import java.util.concurrent.TimeUnit;                                                                    </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  67 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  68 import java.util.regex.Pattern;                                                                          </span>
<span class="-6051894930872477589" onmouseenter="enter('-6051894930872477589');" onmouseout="out('-6051894930872477589');" style="">  69 import java.util.stream.Collectors;                                                                      </span>
<span  style="">  70                                                                                                          </span>
<span class="1455633447019431220" onmouseenter="enter('1455633447019431220');" onmouseout="out('1455633447019431220');" style="">  71 import static com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils.setRecordToStatement;                  </span>
<span class="-6257877604578820371" onmouseenter="enter('-6257877604578820371');" onmouseout="out('-6257877604578820371');" style="">  72 import static org.apache.flink.util.Preconditions.checkNotNull;                                          </span>
<span  style="">  73                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  74 /**                                                                                                      </span>
<span class="7153001641478282104" onmouseenter="enter('7153001641478282104');" onmouseout="out('7153001641478282104');" style="">  75  * Date: 2020/10/14                                                                                      </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  76  * Company: www.dtstack.com                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  77  *                                                                                                       </span>
<span class="-4100502199450942834" onmouseenter="enter('-4100502199450942834');" onmouseout="out('-4100502199450942834');" style="">  78  * @author tiezhu                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  79  */                                                                                                      </span>
<span class="-4121149390422149560" onmouseenter="enter('-4121149390422149560');" onmouseout="out('-4121149390422149560');" style="">  80 public class ImpalaOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {               </span>
<span  style="">  81                                                                                                          </span>
<span class="-5870848474790717720" onmouseenter="enter('-5870848474790717720');" onmouseout="out('-5870848474790717720');" style="">  82     private static final Logger LOG = LoggerFactory.getLogger(ImpalaOutputFormat.class);                 </span>
<span  style="">  83                                                                                                          </span>
<span class="-4645219268431852454" onmouseenter="enter('-4645219268431852454');" onmouseout="out('-4645219268431852454');" style="">  84     private static final long serialVersionUID = 1L;                                                     </span>
<span  style="">  85                                                                                                          </span>
<span class="-9068282285967712029" onmouseenter="enter('-9068282285967712029');" onmouseout="out('-9068282285967712029');" style="">  86     // ${field}                                                                                          </span>
<span class="-5949646080202310183" onmouseenter="enter('-5949646080202310183');" onmouseout="out('-5949646080202310183');" style="">  87     private static final Pattern STATIC_PARTITION_PATTERN = Pattern.compile(&quot;\\$\\{([^}]*)}&quot;);           </span>
<span class="6992730206516090107" onmouseenter="enter('6992730206516090107');" onmouseout="out('6992730206516090107');" style="">  88     //specific type which values need to be quoted                                                       </span>
<span class="-2884666096421851487" onmouseenter="enter('-2884666096421851487');" onmouseout="out('-2884666096421851487');" style="">  89     private static final String[] NEED_QUOTE_TYPE = {&quot;string&quot;, &quot;timestamp&quot;, &quot;varchar&quot;};                  </span>
<span  style="">  90                                                                                                          </span>
<span class="191207487610103693" onmouseenter="enter('191207487610103693');" onmouseout="out('191207487610103693');" style="">  91     private static final Integer DEFAULT_CONN_TIME_OUT = 60;                                             </span>
<span class="-1388186840411616756" onmouseenter="enter('-1388186840411616756');" onmouseout="out('-1388186840411616756');" style="">  92     private static final int RECEIVE_DATA_PRINT_FREQUENCY = 1000;                                        </span>
<span class="-4268888009857984730" onmouseenter="enter('-4268888009857984730');" onmouseout="out('-4268888009857984730');" style="">  93     private static final int DIRTY_DATA_PRINT_FREQUENCY = 1000;                                          </span>
<span  style="">  94                                                                                                          </span>
<span class="-588818051573867979" onmouseenter="enter('-588818051573867979');" onmouseout="out('-588818051573867979');" style="">  95     private static final String KUDU_TYPE = &quot;kudu&quot;;                                                      </span>
<span class="-6769623881035360393" onmouseenter="enter('-6769623881035360393');" onmouseout="out('-6769623881035360393');" style="">  96     private static final String UPDATE_MODE = &quot;update&quot;;                                                  </span>
<span class="-7709014261424944614" onmouseenter="enter('-7709014261424944614');" onmouseout="out('-7709014261424944614');" style="">  97     private static final String PARTITION_CONSTANT = &quot;PARTITION&quot;;                                        </span>
<span class="1441081326157561113" onmouseenter="enter('1441081326157561113');" onmouseout="out('1441081326157561113');" style="">  98     private static final String DRIVER_NAME = &quot;com.cloudera.impala.jdbc41.Driver&quot;;                       </span>
<span  style="">  99                                                                                                          </span>
<span class="-2689163518074835497" onmouseenter="enter('-2689163518074835497');" onmouseout="out('-2689163518074835497');" style=""> 100     private static final String VALUES_CONDITION = &quot;${valuesCondition}&quot;;                                 </span>
<span class="3062777246713899037" onmouseenter="enter('3062777246713899037');" onmouseout="out('3062777246713899037');" style=""> 101     private static final String PARTITION_CONDITION = &quot;${partitionCondition}&quot;;                           </span>
<span class="2401236240707522557" onmouseenter="enter('2401236240707522557');" onmouseout="out('2401236240707522557');" style=""> 102     private static final String TABLE_FIELDS_CONDITION = &quot;${tableFieldsCondition}&quot;;                      </span>
<span class="3255739684264436552" onmouseenter="enter('3255739684264436552');" onmouseout="out('3255739684264436552');" style=""> 103     private static final String NO_PARTITION = &quot;noPartition&quot;;                                            </span>
<span class="-2123205835999557493" onmouseenter="enter('-2123205835999557493');" onmouseout="out('-2123205835999557493');" style=""> 104     // partition field of static partition which matched by ${field}                                     </span>
<span class="-976040292573398488" onmouseenter="enter('-976040292573398488');" onmouseout="out('-976040292573398488');" style=""> 105     private final List&lt;String&gt; staticPartitionFields = new ArrayList&lt;&gt;();                                </span>
<span class="8729932671243795004" onmouseenter="enter('8729932671243795004');" onmouseout="out('8729932671243795004');" style=""> 106     public List&lt;String&gt; fieldNames;                                                                      </span>
<span class="5323664213258183290" onmouseenter="enter('5323664213258183290');" onmouseout="out('5323664213258183290');" style=""> 107     public List&lt;String&gt; fieldTypes;                                                                      </span>
<span class="589573262942162938" onmouseenter="enter('589573262942162938');" onmouseout="out('589573262942162938');" style=""> 108     public List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList;                                    </span>
<span class="-7445073777200404714" onmouseenter="enter('-7445073777200404714');" onmouseout="out('-7445073777200404714');" style=""> 109     protected transient Connection connection;                                                           </span>
<span class="-2184169902108079684" onmouseenter="enter('-2184169902108079684');" onmouseout="out('-2184169902108079684');" style=""> 110     protected transient Statement statement;                                                             </span>
<span class="6238382839663594696" onmouseenter="enter('6238382839663594696');" onmouseout="out('6238382839663594696');" style=""> 111     protected transient PreparedStatement updateStatement;                                               </span>
<span class="-4172535577750872346" onmouseenter="enter('-4172535577750872346');" onmouseout="out('-4172535577750872346');" style=""> 112     protected String keytabPath;                                                                         </span>
<span class="1987487277257130103" onmouseenter="enter('1987487277257130103');" onmouseout="out('1987487277257130103');" style=""> 113     protected String krb5confPath;                                                                       </span>
<span class="3478885111338451838" onmouseenter="enter('3478885111338451838');" onmouseout="out('3478885111338451838');" style=""> 114     protected String principal;                                                                          </span>
<span class="-2673327721248325609" onmouseenter="enter('-2673327721248325609');" onmouseout="out('-2673327721248325609');" style=""> 115     protected Integer authMech;                                                                          </span>
<span class="-8834882937031238604" onmouseenter="enter('-8834882937031238604');" onmouseout="out('-8834882937031238604');" style=""> 116     protected String dbUrl;                                                                              </span>
<span class="4348689613054045460" onmouseenter="enter('4348689613054045460');" onmouseout="out('4348689613054045460');" style=""> 117     protected String userName;                                                                           </span>
<span class="519247125889688558" onmouseenter="enter('519247125889688558');" onmouseout="out('519247125889688558');" style=""> 118     protected String password;                                                                           </span>
<span class="-7554929939288236010" onmouseenter="enter('-7554929939288236010');" onmouseout="out('-7554929939288236010');" style=""> 119     protected int batchSize = 100;                                                                       </span>
<span class="8848445520039039194" onmouseenter="enter('8848445520039039194');" onmouseout="out('8848445520039039194');" style=""> 120     protected long batchWaitInterval = 60 * 1000L;                                                       </span>
<span class="6924126392600265325" onmouseenter="enter('6924126392600265325');" onmouseout="out('6924126392600265325');" style=""> 121     protected String tableName;                                                                          </span>
<span class="-8067881189136281922" onmouseenter="enter('-8067881189136281922');" onmouseout="out('-8067881189136281922');" style=""> 122     protected List&lt;String&gt; primaryKeys;                                                                  </span>
<span class="-1238809985534246985" onmouseenter="enter('-1238809985534246985');" onmouseout="out('-1238809985534246985');" style=""> 123     protected String partitionFields;                                                                    </span>
<span class="-2843446813182919439" onmouseenter="enter('-2843446813182919439');" onmouseout="out('-2843446813182919439');" style=""> 124     protected Boolean enablePartition;                                                                   </span>
<span class="3349082107931708476" onmouseenter="enter('3349082107931708476');" onmouseout="out('3349082107931708476');" style=""> 125     protected String schema;                                                                             </span>
<span class="-2869920961807604939" onmouseenter="enter('-2869920961807604939');" onmouseout="out('-2869920961807604939');" style=""> 126     protected String storeType;                                                                          </span>
<span class="-7730622042083062639" onmouseenter="enter('-7730622042083062639');" onmouseout="out('-7730622042083062639');" style=""> 127     protected String updateMode;                                                                         </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style=""> 128     private transient volatile boolean closed = false;                                                   </span>
<span class="8220840984571392918" onmouseenter="enter('8220840984571392918');" onmouseout="out('8220840984571392918');" style=""> 129     private int batchCount = 0;                                                                          </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 130     // |------------------------------------------------|                                                </span>
<span class="-789927222958732888" onmouseenter="enter('-789927222958732888');" onmouseout="out('-789927222958732888');" style=""> 131     // |   partitionCondition   |Array of valueCondition|                                                </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 132     // |------------------------------------------------|                                                </span>
<span class="-8825804998995953162" onmouseenter="enter('-8825804998995953162');" onmouseout="out('-8825804998995953162');" style=""> 133     // | ptOne, ptTwo, ptThree  | [(v1, v2, v3, v4, v5)]|   DP                                           </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 134     // |------------------------------------------------|                                                </span>
<span class="-5802382310877164118" onmouseenter="enter('-5802382310877164118');" onmouseout="out('-5802382310877164118');" style=""> 135     // | ptOne = v1, ptTwo = v2 | [(v3, v4, v5)]        |   SP                                           </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 136     // |------------------------------------------------|                                                </span>
<span class="2984234039288316275" onmouseenter="enter('2984234039288316275');" onmouseout="out('2984234039288316275');" style=""> 137     // | ptOne, ptTwo = v2      | [(v1, v3, v4, v5)]    |   DP and SP                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 138     // |------------------------------------------------|                                                </span>
<span class="7219405512764117222" onmouseenter="enter('7219405512764117222');" onmouseout="out('7219405512764117222');" style=""> 139     // | noPartition            | [(v1, v2, v3, v4, v5)]|   kudu or disablePartition                     </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 140     // |------------------------------------------------|                                                </span>
<span class="9020411500856357590" onmouseenter="enter('9020411500856357590');" onmouseout="out('9020411500856357590');" style=""> 141     private transient Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap;                                         </span>
<span class="8461763253073029471" onmouseenter="enter('8461763253073029471');" onmouseout="out('8461763253073029471');" style=""> 142     // valueFieldsName -&gt; 重组之后的fieldNames，为了重组row data字段值对应                                              </span>
<span class="-5473349939362349748" onmouseenter="enter('-5473349939362349748');" onmouseout="out('-5473349939362349748');" style=""> 143     // 需要对partition字段做特殊处理，比如原来的字段顺序为(age, name, id)，但是因为partition，写入的SQL为                               </span>
<span class="888010466316090175" onmouseenter="enter('888010466316090175');" onmouseout="out('888010466316090175');" style=""> 144     // INSERT INTO tableName(name, id) PARTITION(age) VALUES(?, ?, ?)                                    </span>
<span class="1229277488566704041" onmouseenter="enter('1229277488566704041');" onmouseout="out('1229277488566704041');" style=""> 145     // 那么实际executeSql设置字段的顺序应该为(name, id, age)，同时，字段对应的type顺序也需要重组                                       </span>
<span class="6098973354216055964" onmouseenter="enter('6098973354216055964');" onmouseout="out('6098973354216055964');" style=""> 146     private List&lt;String&gt; valueFieldNames;                                                                </span>
<span class="-7108089166418781511" onmouseenter="enter('-7108089166418781511');" onmouseout="out('-7108089166418781511');" style=""> 147     private transient AbstractDtRichOutputFormat&lt;?&gt; metricOutputFormat;                                  </span>
<span class="273368026714901275" onmouseenter="enter('273368026714901275');" onmouseout="out('273368026714901275');" style=""> 148     private List&lt;Row&gt; rows;                                                                              </span>
<span  style=""> 149                                                                                                          </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style=""> 150     private transient ScheduledExecutorService scheduler;                                                </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style=""> 151     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style=""> 152                                                                                                          </span>
<span class="-2481914402933088399" onmouseenter="enter('-2481914402933088399');" onmouseout="out('-2481914402933088399');" style=""> 153     public static Builder getImpalaBuilder() {                                                           </span>
<span class="-1926211775479526780" onmouseenter="enter('-1926211775479526780');" onmouseout="out('-1926211775479526780');" style=""> 154         return new Builder();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155     }                                                                                                    </span>
<span  style=""> 156                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 157     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 158     public void configure(Configuration parameters) {                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159     }                                                                                                    </span>
<span  style=""> 160                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 161     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 162     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 163         try {                                                                                            </span>
<span class="4324779626821739975" onmouseenter="enter('4324779626821739975');" onmouseout="out('4324779626821739975');" style=""> 164             rowDataMap = new HashMap&lt;&gt;();                                                                </span>
<span class="-6551372933934183741" onmouseenter="enter('-6551372933934183741');" onmouseout="out('-6551372933934183741');" style=""> 165             rows = new ArrayList&lt;&gt;();                                                                    </span>
<span class="-7937337195293668220" onmouseenter="enter('-7937337195293668220');" onmouseout="out('-7937337195293668220');" style=""> 166             metricOutputFormat = this;                                                                   </span>
<span class="-8035752082134444550" onmouseenter="enter('-8035752082134444550');" onmouseout="out('-8035752082134444550');" style=""> 167             openConnect();                                                                               </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 168             initScheduledTask(batchWaitInterval);                                                        </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style=""> 169             init();                                                                                      </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 170             initMetric();                                                                                </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 171         } catch (Exception e) {                                                                          </span>
<span class="-105883012207117402" onmouseenter="enter('-105883012207117402');" onmouseout="out('-105883012207117402');" style=""> 172             throw new RuntimeException(&quot;impala output format open error!&quot;, e);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174     }                                                                                                    </span>
<span  style=""> 175                                                                                                          </span>
<span class="-8578201295687943948" onmouseenter="enter('-8578201295687943948');" onmouseout="out('-8578201295687943948');" style=""> 176     private void init() throws SQLException {                                                            </span>
<span class="-8350145873279772804" onmouseenter="enter('-8350145873279772804');" onmouseout="out('-8350145873279772804');" style=""> 177         if (Objects.nonNull(partitionFields)) {                                                          </span>
<span class="8590422903839909721" onmouseenter="enter('8590422903839909721');" onmouseout="out('8590422903839909721');" style=""> 178             // match ${field} from partitionFields                                                       </span>
<span class="399614494149678967" onmouseenter="enter('399614494149678967');" onmouseout="out('399614494149678967');" style=""> 179             Matcher matcher = STATIC_PARTITION_PATTERN.matcher(partitionFields);                         </span>
<span class="-5488916631119752457" onmouseenter="enter('-5488916631119752457');" onmouseout="out('-5488916631119752457');" style=""> 180             while (matcher.find()) {                                                                     </span>
<span class="-1180668930060799754" onmouseenter="enter('-1180668930060799754');" onmouseout="out('-1180668930060799754');" style=""> 181                 LOG.info(&quot;find static partition field: {}&quot;, matcher.group(1));                           </span>
<span class="5933786634924389530" onmouseenter="enter('5933786634924389530');" onmouseout="out('5933786634924389530');" style=""> 182                 staticPartitionFields.add(matcher.group(1));                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span  style=""> 185                                                                                                          </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 186         if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                  </span>
<span class="-511688609314859464" onmouseenter="enter('-511688609314859464');" onmouseout="out('-511688609314859464');" style=""> 187             if (!storeType.equalsIgnoreCase(KUDU_TYPE)) {                                                </span>
<span class="7738691828431171650" onmouseenter="enter('7738691828431171650');" onmouseout="out('7738691828431171650');" style=""> 188                 throw new IllegalArgumentException(&quot;update mode not support for non-kudu table!&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189             }                                                                                            </span>
<span class="-1926567860735108753" onmouseenter="enter('-1926567860735108753');" onmouseout="out('-1926567860735108753');" style=""><abbr title=" 190             updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, primaryKeys));"> 190             updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, p🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 191         } else {                                                                                         </span>
<span class="5264299831364970974" onmouseenter="enter('5264299831364970974');" onmouseout="out('5264299831364970974');" style=""><abbr title=" 192             valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTypes, partitionFields);"> 192             valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTyp🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193         }                                                                                                </span>
<span  style=""> 194                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 197     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 198         try {                                                                                            </span>
<span class="-5481453632006175071" onmouseenter="enter('-5481453632006175071');" onmouseout="out('-5481453632006175071');" style=""> 199             if (batchWaitInterval != 0) {                                                                </span>
<span class="777682131179381780" onmouseenter="enter('777682131179381780');" onmouseout="out('777682131179381780');" style=""> 200                 this.scheduler = new ScheduledThreadPoolExecutor(1,                                      </span>
<span class="714213466749562787" onmouseenter="enter('714213466749562787');" onmouseout="out('714213466749562787');" style=""> 201                         new DTThreadFactory(&quot;impala-upsert-output-format&quot;));                             </span>
<span class="-7149116985444787635" onmouseenter="enter('-7149116985444787635');" onmouseout="out('-7149116985444787635');" style=""> 202                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(() -&gt; {                     </span>
<span class="-940414522275968791" onmouseenter="enter('-940414522275968791');" onmouseout="out('-940414522275968791');" style=""> 203                     synchronized (ImpalaOutputFormat.this) {                                             </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 204                         flush();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205                     }                                                                                    </span>
<span class="8465771028460365894" onmouseenter="enter('8465771028460365894');" onmouseout="out('8465771028460365894');" style=""> 206                 }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 208         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 209             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211     }                                                                                                    </span>
<span  style=""> 212                                                                                                          </span>
<span class="-2844613068709206340" onmouseenter="enter('-2844613068709206340');" onmouseout="out('-2844613068709206340');" style=""> 213     private void openConnect() throws IOException {                                                      </span>
<span class="-2394055578891206899" onmouseenter="enter('-2394055578891206899');" onmouseout="out('-2394055578891206899');" style=""> 214         if (authMech == 1) {                                                                             </span>
<span class="-7445609792053649263" onmouseenter="enter('-7445609792053649263');" onmouseout="out('-7445609792053649263');" style=""> 215             UserGroupInformation ugi = KrbUtils.loginAndReturnUgi(principal, keytabPath, krb5confPath);  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 216             try {                                                                                        </span>
<span class="1057249312142684394" onmouseenter="enter('1057249312142684394');" onmouseout="out('1057249312142684394');" style=""> 217                 ugi.doAs((PrivilegedExceptionAction&lt;Void&gt;) () -&gt; {                                       </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 218                     openJdbc();                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 219                     return null;                                                                         </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 220                 });                                                                                      </span>
<span class="3693318474890767753" onmouseenter="enter('3693318474890767753');" onmouseout="out('3693318474890767753');" style=""> 221             } catch (InterruptedException | IOException e) {                                             </span>
<span class="-3216725393010457363" onmouseenter="enter('-3216725393010457363');" onmouseout="out('-3216725393010457363');" style=""> 222                 throw new IllegalArgumentException(&quot;connect impala error!&quot;, e);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 224         } else {                                                                                         </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 225             openJdbc();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 229     /**                                                                                                  </span>
<span class="-4019084214603833891" onmouseenter="enter('-4019084214603833891');" onmouseout="out('-4019084214603833891');" style=""> 230      * get jdbc connection                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 231      */                                                                                                  </span>
<span class="6517717324631316532" onmouseenter="enter('6517717324631316532');" onmouseout="out('6517717324631316532');" style=""> 232     private void openJdbc() {                                                                            </span>
<span class="7396081792504852616" onmouseenter="enter('7396081792504852616');" onmouseout="out('7396081792504852616');" style=""> 233         ClassLoaderManager.forName(DRIVER_NAME, getClass().getClassLoader());                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 234         try {                                                                                            </span>
<span class="-4188974437029144237" onmouseenter="enter('-4188974437029144237');" onmouseout="out('-4188974437029144237');" style=""> 235             connection = DriverManager.getConnection(dbUrl, userName, password);                         </span>
<span class="-3909190598463408725" onmouseenter="enter('-3909190598463408725');" onmouseout="out('-3909190598463408725');" style=""> 236             statement = connection.createStatement();                                                    </span>
<span class="1164602517684291637" onmouseenter="enter('1164602517684291637');" onmouseout="out('1164602517684291637');" style=""> 237             connection.setAutoCommit(false);                                                             </span>
<span class="-2037802754415730828" onmouseenter="enter('-2037802754415730828');" onmouseout="out('-2037802754415730828');" style=""> 238         } catch (SQLException sqlException) {                                                            </span>
<span class="8417232372887360387" onmouseenter="enter('8417232372887360387');" onmouseout="out('8417232372887360387');" style=""> 239             throw new RuntimeException(&quot;get impala jdbc connection failed!&quot;, sqlException);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241     }                                                                                                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="4897761129654612880" onmouseenter="enter('4897761129654612880');" onmouseout="out('4897761129654612880');" style=""> 243     private synchronized void flush() {                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 244         try {                                                                                            </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 245             if (batchCount &gt; 0) {                                                                        </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 246                 if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                          </span>
<span class="-7210745719484505959" onmouseenter="enter('-7210745719484505959');" onmouseout="out('-7210745719484505959');" style=""> 247                     executeUpdateBatch();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248                 }                                                                                        </span>
<span class="-5565980137871755476" onmouseenter="enter('-5565980137871755476');" onmouseout="out('-5565980137871755476');" style=""> 249                 if (!rowDataMap.isEmpty()) {                                                             </span>
<span class="8546814641173072756" onmouseenter="enter('8546814641173072756');" onmouseout="out('8546814641173072756');" style=""> 250                     String templateSql =                                                                 </span>
<span class="-1766017053596733683" onmouseenter="enter('-1766017053596733683');" onmouseout="out('-1766017053596733683');" style=""><abbr title=" 251                         &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VALUES ${valuesCondition}&quot;;"> 251                         &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VA🔵</abbr></span>
<span class="7007887973141057675" onmouseenter="enter('7007887973141057675');" onmouseout="out('7007887973141057675');" style=""> 252                     executeBatchSql(                                                                     </span>
<span class="-8931083358346849072" onmouseenter="enter('-8931083358346849072');" onmouseout="out('-8931083358346849072');" style=""> 253                         templateSql,                                                                     </span>
<span class="5582129011297069726" onmouseenter="enter('5582129011297069726');" onmouseout="out('5582129011297069726');" style=""> 254                         schema,                                                                          </span>
<span class="8599198975592615021" onmouseenter="enter('8599198975592615021');" onmouseout="out('8599198975592615021');" style=""> 255                         tableName,                                                                       </span>
<span class="7739930709415439240" onmouseenter="enter('7739930709415439240');" onmouseout="out('7739930709415439240');" style=""> 256                         storeType,                                                                       </span>
<span class="4460343981916954231" onmouseenter="enter('4460343981916954231');" onmouseout="out('4460343981916954231');" style=""> 257                         enablePartition,                                                                 </span>
<span class="-232795436679668454" onmouseenter="enter('-232795436679668454');" onmouseout="out('-232795436679668454');" style=""> 258                         valueFieldNames,                                                                 </span>
<span class="2377300059169474736" onmouseenter="enter('2377300059169474736');" onmouseout="out('2377300059169474736');" style=""> 259                         partitionFields,                                                                 </span>
<span class="-163268273074797630" onmouseenter="enter('-163268273074797630');" onmouseout="out('-163268273074797630');" style=""> 260                         rowDataMap                                                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 261                     );                                                                                   </span>
<span class="1629791312198735010" onmouseenter="enter('1629791312198735010');" onmouseout="out('1629791312198735010');" style=""> 262                     rowDataMap.clear();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264             }                                                                                            </span>
<span class="-5311733944590264805" onmouseenter="enter('-5311733944590264805');" onmouseout="out('-5311733944590264805');" style=""> 265             batchCount = 0;                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 266         } catch (Exception e) {                                                                          </span>
<span class="-5628183046854957718" onmouseenter="enter('-5628183046854957718');" onmouseout="out('-5628183046854957718');" style=""> 267             LOG.error(&quot;Writing records to impala jdbc failed.&quot;, e);                                      </span>
<span class="-7023774051195191894" onmouseenter="enter('-7023774051195191894');" onmouseout="out('-7023774051195191894');" style=""> 268             throw new RuntimeException(&quot;Writing records to impala jdbc failed.&quot;, e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270     }                                                                                                    </span>
<span  style=""> 271                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 272     /**                                                                                                  </span>
<span class="-1106181825212481278" onmouseenter="enter('-1106181825212481278');" onmouseout="out('-1106181825212481278');" style=""> 273      * execute batch update statement                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 274      *                                                                                                   </span>
<span class="3560665881375675274" onmouseenter="enter('3560665881375675274');" onmouseout="out('3560665881375675274');" style=""> 275      * @throws SQLException throw sql exception                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 276      */                                                                                                  </span>
<span class="3206601587144870407" onmouseenter="enter('3206601587144870407');" onmouseout="out('3206601587144870407');" style=""> 277     private void executeUpdateBatch() throws SQLException {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 278         try {                                                                                            </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 279             rows.forEach(row -&gt; {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 280                 try {                                                                                    </span>
<span class="-1215139546593028546" onmouseenter="enter('-1215139546593028546');" onmouseout="out('-1215139546593028546');" style=""> 281                     JDBCTypeConvertUtils.setRecordToStatement(                                           </span>
<span class="-4710389352980966846" onmouseenter="enter('-4710389352980966846');" onmouseout="out('-4710389352980966846');" style=""> 282                             updateStatement,                                                             </span>
<span class="4668718668329814914" onmouseenter="enter('4668718668329814914');" onmouseout="out('4668718668329814914');" style=""> 283                             JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes),                    </span>
<span class="-7576027683765873339" onmouseenter="enter('-7576027683765873339');" onmouseout="out('-7576027683765873339');" style=""> 284                             row,                                                                         </span>
<span class="-255277236311302851" onmouseenter="enter('-255277236311302851');" onmouseout="out('-255277236311302851');" style=""> 285                             primaryKeys.stream().mapToInt(fieldNames::indexOf).toArray()                 </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 286                     );                                                                                   </span>
<span class="-4238050377414791796" onmouseenter="enter('-4238050377414791796');" onmouseout="out('-4238050377414791796');" style=""> 287                     updateStatement.addBatch();                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 288                 } catch (Exception e) {                                                                  </span>
<span class="5068376771892501659" onmouseenter="enter('5068376771892501659');" onmouseout="out('5068376771892501659');" style=""> 289                     throw new RuntimeException(&quot;impala jdbc execute batch error!&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 291             });                                                                                          </span>
<span class="-3747739502872154032" onmouseenter="enter('-3747739502872154032');" onmouseout="out('-3747739502872154032');" style=""> 292             updateStatement.executeBatch();                                                              </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 293             connection.commit();                                                                         </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 294             rows.clear();                                                                                </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 295         } catch (Exception e) {                                                                          </span>
<span class="1715728751446881781" onmouseenter="enter('1715728751446881781');" onmouseout="out('1715728751446881781');" style=""> 296             LOG.debug(&quot;impala jdbc execute batch error &quot;, e);                                            </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 297             JDBCUtils.rollBack(connection);                                                              </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 298             JDBCUtils.commit(connection);                                                                </span>
<span class="-4187732730208785389" onmouseenter="enter('-4187732730208785389');" onmouseout="out('-4187732730208785389');" style=""> 299             updateStatement.clearBatch();                                                                </span>
<span class="-8814080953460465644" onmouseenter="enter('-8814080953460465644');" onmouseout="out('-8814080953460465644');" style=""> 300             executeUpdate(connection);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302     }                                                                                                    </span>
<span  style=""> 303                                                                                                          </span>
<span class="-4847686400566224446" onmouseenter="enter('-4847686400566224446');" onmouseout="out('-4847686400566224446');" style=""> 304     public void executeUpdate(Connection connection) {                                                   </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 305         rows.forEach(row -&gt; {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 306             try {                                                                                        </span>
<span class="3018395377218617369" onmouseenter="enter('3018395377218617369');" onmouseout="out('3018395377218617369');" style=""><abbr title=" 307                 setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), row);"> 307                 setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldT🔵</abbr></span>
<span class="-6547782628025070914" onmouseenter="enter('-6547782628025070914');" onmouseout="out('-6547782628025070914');" style=""> 308                 updateStatement.executeUpdate();                                                         </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 309                 JDBCUtils.commit(connection);                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 310             } catch (Exception e) {                                                                      </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 311                 JDBCUtils.rollBack(connection);                                                          </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 312                 JDBCUtils.commit(connection);                                                            </span>
<span class="-4808081927273297919" onmouseenter="enter('-4808081927273297919');" onmouseout="out('-4808081927273297919');" style=""><abbr title=" 313                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {"> 313                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LO🔵</abbr></span>
<span class="-2764908242367356599" onmouseenter="enter('-2764908242367356599');" onmouseout="out('-2764908242367356599');" style=""> 314                     LOG.error(&quot;record insert failed ,this row is {}&quot;, row.toString());                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 315                     LOG.error(&quot;&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316                 }                                                                                        </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 317                 metricOutputFormat.outDirtyRecords.inc();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 319         });                                                                                              </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 320         rows.clear();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321     }                                                                                                    </span>
<span  style=""> 322                                                                                                          </span>
<span class="5541545914698662583" onmouseenter="enter('5541545914698662583');" onmouseout="out('5541545914698662583');" style=""><abbr title=" 323     private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData) {"> 323     private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData)🔵</abbr></span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 324         Set&lt;String&gt; keySet = rowDataMap.keySet();                                                        </span>
<span class="-4115511162008757651" onmouseenter="enter('-4115511162008757651');" onmouseout="out('-4115511162008757651');" style=""> 325         ArrayList&lt;String&gt; tempRowArray;                                                                  </span>
<span class="-6312285345137005178" onmouseenter="enter('-6312285345137005178');" onmouseout="out('-6312285345137005178');" style=""> 326         if (keySet.contains(rowData.f0)) {                                                               </span>
<span class="2063657660163215007" onmouseenter="enter('2063657660163215007');" onmouseout="out('2063657660163215007');" style=""> 327             tempRowArray = rowDataMap.get(rowData.f0);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 328         } else {                                                                                         </span>
<span class="7109917545131433172" onmouseenter="enter('7109917545131433172');" onmouseout="out('7109917545131433172');" style=""> 329             tempRowArray = new ArrayList&lt;&gt;();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330         }                                                                                                </span>
<span class="1467529594977533778" onmouseenter="enter('1467529594977533778');" onmouseout="out('1467529594977533778');" style=""> 331         tempRowArray.add(rowData.f1);                                                                    </span>
<span class="6767865840186405987" onmouseenter="enter('6767865840186405987');" onmouseout="out('6767865840186405987');" style=""> 332         rowDataMap.put(rowData.f0, tempRowArray);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333     }                                                                                                    </span>
<span  style=""> 334                                                                                                          </span>
<span class="3578278218776325408" onmouseenter="enter('3578278218776325408');" onmouseout="out('3578278218776325408');" style=""><abbr title=" 335     private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPartitionFields, List&lt;String&gt; fieldTypes, String partitionFields) {"> 335     private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPart🔵</abbr></span>
<span class="-4698577817001148605" onmouseenter="enter('-4698577817001148605');" onmouseout="out('-4698577817001148605');" style=""> 336         if (partitionFields == null || partitionFields.isEmpty()) {                                      </span>
<span class="2916035488958294792" onmouseenter="enter('2916035488958294792');" onmouseout="out('2916035488958294792');" style=""> 337             return fieldNames;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338         }                                                                                                </span>
<span  style=""> 339                                                                                                          </span>
<span class="7990418778069769767" onmouseenter="enter('7990418778069769767');" onmouseout="out('7990418778069769767');" style=""> 340         List&lt;String&gt; valueFields = new ArrayList&lt;&gt;(fieldNames);                                          </span>
<span  style=""> 341                                                                                                          </span>
<span class="2302239674432319726" onmouseenter="enter('2302239674432319726');" onmouseout="out('2302239674432319726');" style=""> 342         for (int i = valueFields.size() - 1; i &gt;= 0; i--) {                                              </span>
<span class="-8004931019804249555" onmouseenter="enter('-8004931019804249555');" onmouseout="out('-8004931019804249555');" style=""> 343             if (staticPartitionFields.contains(fieldNames.get(i))) {                                     </span>
<span class="-3872161480019783193" onmouseenter="enter('-3872161480019783193');" onmouseout="out('-3872161480019783193');" style=""> 344                 valueFields.remove(i);                                                                   </span>
<span class="5504621354582269117" onmouseenter="enter('5504621354582269117');" onmouseout="out('5504621354582269117');" style=""> 345                 fieldTypes.remove(i);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347         }                                                                                                </span>
<span  style=""> 348                                                                                                          </span>
<span class="8724369392835521335" onmouseenter="enter('8724369392835521335');" onmouseout="out('8724369392835521335');" style=""> 349         for (int i = 0; i &lt; valueFields.size(); i++) {                                                   </span>
<span class="4573573241123850638" onmouseenter="enter('4573573241123850638');" onmouseout="out('4573573241123850638');" style=""> 350             if (partitionFields.contains(fieldNames.get(i))) {                                           </span>
<span class="-6733214010943616061" onmouseenter="enter('-6733214010943616061');" onmouseout="out('-6733214010943616061');" style=""> 351                 valueFields.add(valueFields.remove(i));                                                  </span>
<span class="3100686975272655596" onmouseenter="enter('3100686975272655596');" onmouseout="out('3100686975272655596');" style=""> 352                 fieldTypes.add(fieldTypes.remove(i));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354         }                                                                                                </span>
<span  style=""> 355                                                                                                          </span>
<span class="-4055330890426471630" onmouseenter="enter('-4055330890426471630');" onmouseout="out('-4055330890426471630');" style=""> 356         return valueFields;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357     }                                                                                                    </span>
<span  style=""> 358                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 359     @Override                                                                                            </span>
<span class="-8766503565464123288" onmouseenter="enter('-8766503565464123288');" onmouseout="out('-8766503565464123288');" style=""> 360     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) throws IOException {                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 361         try {                                                                                            </span>
<span class="-1438543337409690372" onmouseenter="enter('-1438543337409690372');" onmouseout="out('-1438543337409690372');" style=""> 362             if (!record.f0) {                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 363                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364             }                                                                                            </span>
<span  style=""> 365                                                                                                          </span>
<span class="-8847095116449263406" onmouseenter="enter('-8847095116449263406');" onmouseout="out('-8847095116449263406');" style=""> 366             if (outRecords.getCount() % RECEIVE_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {     </span>
<span class="867853870420543335" onmouseenter="enter('867853870420543335');" onmouseout="out('867853870420543335');" style=""> 367                 LOG.info(&quot;Receive data : {}&quot;, record);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368             }                                                                                            </span>
<span  style=""> 369                                                                                                          </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 370             if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                              </span>
<span class="-4538110507205524162" onmouseenter="enter('-4538110507205524162');" onmouseout="out('-4538110507205524162');" style=""> 371                 rows.add(Row.copy(record.f1));                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 372             } else {                                                                                     </span>
<span class="-7917205410914838057" onmouseenter="enter('-7917205410914838057');" onmouseout="out('-7917205410914838057');" style=""> 373                 Map&lt;String, Object&gt; valueMap = Maps.newHashMap();                                        </span>
<span class="1869446492779313508" onmouseenter="enter('1869446492779313508');" onmouseout="out('1869446492779313508');" style=""> 374                 Row row = Row.copy(record.f1);                                                           </span>
<span  style=""> 375                                                                                                          </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 376                 for (int i = 0; i &lt; row.getArity(); i++) {                                               </span>
<span class="5876572039273015428" onmouseenter="enter('5876572039273015428');" onmouseout="out('5876572039273015428');" style=""> 377                     valueMap.put(fieldNames.get(i), row.getField(i));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378                 }                                                                                        </span>
<span  style=""> 379                                                                                                          </span>
<span class="-991390362203857814" onmouseenter="enter('-991390362203857814');" onmouseout="out('-991390362203857814');" style=""> 380                 Tuple2&lt;String, String&gt; rowTuple2 = new Tuple2&lt;&gt;();                                       </span>
<span class="-209542121488547867" onmouseenter="enter('-209542121488547867');" onmouseout="out('-209542121488547867');" style=""> 381                 if (storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition) {                         </span>
<span class="-4830782679838689768" onmouseenter="enter('-4830782679838689768');" onmouseout="out('-4830782679838689768');" style=""> 382                     rowTuple2.f0 = NO_PARTITION;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 383                 } else {                                                                                 </span>
<span class="5139395380358692168" onmouseenter="enter('5139395380358692168');" onmouseout="out('5139395380358692168');" style=""><abbr title=" 384                     rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFields);"> 384                     rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFiel🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385                 }                                                                                        </span>
<span  style=""> 386                                                                                                          </span>
<span class="-484968884065413564" onmouseenter="enter('-484968884065413564');" onmouseout="out('-484968884065413564');" style=""> 387                 // 根据字段名对 row data 重组, 比如，原始 row data : (1, xxx, 20) -&gt; (id, name, age)                  </span>
<span class="2038150889857603205" onmouseenter="enter('2038150889857603205');" onmouseout="out('2038150889857603205');" style=""> 388                 // 但是由于 partition，写入的field 顺序变成了 (name, id, age)，则需要对 row data 重组变成 (xxx, 1, 20)         </span>
<span class="5421203580895226953" onmouseenter="enter('5421203580895226953');" onmouseout="out('5421203580895226953');" style=""> 389                 Row rowValue = new Row(fieldTypes.size());                                               </span>
<span class="-7699243670258396145" onmouseenter="enter('-7699243670258396145');" onmouseout="out('-7699243670258396145');" style=""> 390                 for (int i = 0; i &lt; fieldTypes.size(); i++) {                                            </span>
<span class="2312799749991659832" onmouseenter="enter('2312799749991659832');" onmouseout="out('2312799749991659832');" style=""> 391                     rowValue.setField(i, valueMap.get(valueFieldNames.get(i)));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392                 }                                                                                        </span>
<span class="2914199757449377543" onmouseenter="enter('2914199757449377543');" onmouseout="out('2914199757449377543');" style=""> 393                 rowTuple2.f1 = buildValuesCondition(fieldTypes, rowValue);                               </span>
<span class="8896132355788887171" onmouseenter="enter('8896132355788887171');" onmouseout="out('8896132355788887171');" style=""> 394                 putRowIntoMap(rowDataMap, rowTuple2);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395             }                                                                                            </span>
<span  style=""> 396                                                                                                          </span>
<span class="-1784546571648451896" onmouseenter="enter('-1784546571648451896');" onmouseout="out('-1784546571648451896');" style=""> 397             batchCount++;                                                                                </span>
<span  style=""> 398                                                                                                          </span>
<span class="2059038061408804342" onmouseenter="enter('2059038061408804342');" onmouseout="out('2059038061408804342');" style=""> 399             if (batchCount &gt;= batchSize) {                                                               </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 400                 flush();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401             }                                                                                            </span>
<span  style=""> 402                                                                                                          </span>
<span class="-2147939016446724954" onmouseenter="enter('-2147939016446724954');" onmouseout="out('-2147939016446724954');" style=""> 403             // Receive data                                                                              </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 404             outRecords.inc();                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 405         } catch (Exception e) {                                                                          </span>
<span class="-6314596404725474749" onmouseenter="enter('-6314596404725474749');" onmouseout="out('-6314596404725474749');" style=""> 406             throw new IOException(&quot;Writing records to impala failed.&quot;, e);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408     }                                                                                                    </span>
<span  style=""> 409                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 410     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 411     public void close() throws IOException {                                                             </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 412         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 413             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414         }                                                                                                </span>
<span class="-8247099019020917877" onmouseenter="enter('-8247099019020917877');" onmouseout="out('-8247099019020917877');" style=""> 415         // 将还未执行的SQL flush                                                                               </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 416         if (batchCount &gt; 0) {                                                                            </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 417             flush();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418         }                                                                                                </span>
<span class="4306800238416480323" onmouseenter="enter('4306800238416480323');" onmouseout="out('4306800238416480323');" style=""> 419         // cancel scheduled task                                                                         </span>
<span class="-1257031862697527304" onmouseenter="enter('-1257031862697527304');" onmouseout="out('-1257031862697527304');" style=""> 420         if (this.scheduledFuture != null) {                                                              </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 421             scheduledFuture.cancel(false);                                                               </span>
<span class="-3367227577965762682" onmouseenter="enter('-3367227577965762682');" onmouseout="out('-3367227577965762682');" style=""> 422             this.scheduler.shutdown();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423         }                                                                                                </span>
<span class="-6918026600162299955" onmouseenter="enter('-6918026600162299955');" onmouseout="out('-6918026600162299955');" style=""> 424         // close connection                                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 425         try {                                                                                            </span>
<span class="7850482504012729998" onmouseenter="enter('7850482504012729998');" onmouseout="out('7850482504012729998');" style=""> 426             if (connection != null &amp;&amp; connection.isValid(DEFAULT_CONN_TIME_OUT)) {                       </span>
<span class="9071602856049240163" onmouseenter="enter('9071602856049240163');" onmouseout="out('9071602856049240163');" style=""> 427                 connection.close();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428             }                                                                                            </span>
<span  style=""> 429                                                                                                          </span>
<span class="5036557091369948437" onmouseenter="enter('5036557091369948437');" onmouseout="out('5036557091369948437');" style=""> 430             if (statement != null &amp;&amp; !statement.isClosed()) {                                            </span>
<span class="-4290000005499431342" onmouseenter="enter('-4290000005499431342');" onmouseout="out('-4290000005499431342');" style=""> 431                 statement.close();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432             }                                                                                            </span>
<span  style=""> 433                                                                                                          </span>
<span class="-3745862640690712208" onmouseenter="enter('-3745862640690712208');" onmouseout="out('-3745862640690712208');" style=""> 434             if (updateStatement != null &amp;&amp; !updateStatement.isClosed()) {                                </span>
<span class="6285223499122042502" onmouseenter="enter('6285223499122042502');" onmouseout="out('6285223499122042502');" style=""> 435                 updateStatement.close();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436             }                                                                                            </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 437         } catch (SQLException e) {                                                                       </span>
<span class="-8800633426745397107" onmouseenter="enter('-8800633426745397107');" onmouseout="out('-8800633426745397107');" style=""> 438             throw new RuntimeException(&quot;impala connection close failed!&quot;, e);                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 439         } finally {                                                                                      </span>
<span class="8335594207613379924" onmouseenter="enter('8335594207613379924');" onmouseout="out('8335594207613379924');" style=""> 440             connection = null;                                                                           </span>
<span class="-8855760725718402841" onmouseenter="enter('-8855760725718402841');" onmouseout="out('-8855760725718402841');" style=""> 441             statement = null;                                                                            </span>
<span class="-7841270215011717932" onmouseenter="enter('-7841270215011717932');" onmouseout="out('-7841270215011717932');" style=""> 442             updateStatement = null;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443         }                                                                                                </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 444         closed = true;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445     }                                                                                                    </span>
<span  style=""> 446                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 447     /**                                                                                                  </span>
<span class="1296337810927918625" onmouseenter="enter('1296337810927918625');" onmouseout="out('1296337810927918625');" style=""> 448      * execute batch sql from row data map                                                               </span>
<span class="-5974232274386764846" onmouseenter="enter('-5974232274386764846');" onmouseout="out('-5974232274386764846');" style=""><abbr title=" 449      * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)...."> 449      * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 450      *                                                                                                   </span>
<span class="4252025712922498493" onmouseenter="enter('4252025712922498493');" onmouseout="out('4252025712922498493');" style=""> 451      * @param tempSql         template sql                                                               </span>
<span class="-888616451537648959" onmouseenter="enter('-888616451537648959');" onmouseout="out('-888616451537648959');" style=""> 452      * @param storeType       the store type of data                                                     </span>
<span class="-5301096736775778703" onmouseenter="enter('-5301096736775778703');" onmouseout="out('-5301096736775778703');" style=""> 453      * @param enablePartition enable partition or not                                                    </span>
<span class="-7243431631208061298" onmouseenter="enter('-7243431631208061298');" onmouseout="out('-7243431631208061298');" style=""> 454      * @param fieldNames      field name list                                                            </span>
<span class="991482749163976330" onmouseenter="enter('991482749163976330');" onmouseout="out('991482749163976330');" style=""> 455      * @param partitionFields partition fields                                                           </span>
<span class="5552251290683891506" onmouseenter="enter('5552251290683891506');" onmouseout="out('5552251290683891506');" style=""> 456      * @param rowDataMap      row data map                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 457      */                                                                                                  </span>
<span class="-999744234218262965" onmouseenter="enter('-999744234218262965');" onmouseout="out('-999744234218262965');" style=""> 458     private void executeBatchSql(String tempSql,                                                         </span>
<span class="-1880214364205558871" onmouseenter="enter('-1880214364205558871');" onmouseout="out('-1880214364205558871');" style=""> 459                                  String schema,                                                          </span>
<span class="6859219661302664351" onmouseenter="enter('6859219661302664351');" onmouseout="out('6859219661302664351');" style=""> 460                                  String tableName,                                                       </span>
<span class="3305030788069730493" onmouseenter="enter('3305030788069730493');" onmouseout="out('3305030788069730493');" style=""> 461                                  String storeType,                                                       </span>
<span class="3282308130032253418" onmouseenter="enter('3282308130032253418');" onmouseout="out('3282308130032253418');" style=""> 462                                  Boolean enablePartition,                                                </span>
<span class="-3269341593111050509" onmouseenter="enter('-3269341593111050509');" onmouseout="out('-3269341593111050509');" style=""> 463                                  List&lt;String&gt; fieldNames,                                                </span>
<span class="-152366337684528954" onmouseenter="enter('-152366337684528954');" onmouseout="out('-152366337684528954');" style=""> 464                                  String partitionFields,                                                 </span>
<span class="5702355489208114022" onmouseenter="enter('5702355489208114022');" onmouseout="out('5702355489208114022');" style=""> 465                                  Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap) {                            </span>
<span class="-1699639020719600437" onmouseenter="enter('-1699639020719600437');" onmouseout="out('-1699639020719600437');" style=""> 466         StringBuilder partitionCondition = new StringBuilder();                                          </span>
<span class="4484344279813579809" onmouseenter="enter('4484344279813579809');" onmouseout="out('4484344279813579809');" style=""> 467         String tableFieldsCondition = buildTableFieldsCondition(fieldNames, partitionFields);            </span>
<span class="6980371482153070193" onmouseenter="enter('6980371482153070193');" onmouseout="out('6980371482153070193');" style=""> 468         ArrayList&lt;String&gt; rowData = new ArrayList&lt;&gt;();                                                   </span>
<span class="3545700907988930339" onmouseenter="enter('3545700907988930339');" onmouseout="out('3545700907988930339');" style=""> 469         String tableNameInfo = Objects.isNull(schema) ?                                                  </span>
<span class="1480493120427294696" onmouseenter="enter('1480493120427294696');" onmouseout="out('1480493120427294696');" style=""> 470                 tableName : quoteIdentifier(schema) + &quot;.&quot; + tableName;                                   </span>
<span class="-7586945217349428495" onmouseenter="enter('-7586945217349428495');" onmouseout="out('-7586945217349428495');" style=""> 471         tempSql = tempSql.replace(&quot;tableName&quot;, tableNameInfo);                                           </span>
<span class="-3470966760283073144" onmouseenter="enter('-3470966760283073144');" onmouseout="out('-3470966760283073144');" style=""> 472         boolean isPartitioned = storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition;               </span>
<span  style=""> 473                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 474         try {                                                                                            </span>
<span class="-739313269293547881" onmouseenter="enter('-739313269293547881');" onmouseout="out('-739313269293547881');" style=""> 475             // kudu ${partitionCondition} is null                                                        </span>
<span class="-196943023254075124" onmouseenter="enter('-196943023254075124');" onmouseout="out('-196943023254075124');" style=""> 476             if (isPartitioned) {                                                                         </span>
<span class="-8595336617081209901" onmouseenter="enter('-8595336617081209901');" onmouseout="out('-8595336617081209901');" style=""> 477                 tempSql = tempSql                                                                        </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style=""> 478                     .replace(PARTITION_CONDITION, partitionCondition.toString())                         </span>
<span class="1939264830691633930" onmouseenter="enter('1939264830691633930');" onmouseout="out('1939264830691633930');" style=""> 479                     .replace(PARTITION_CONSTANT, &quot;&quot;)                                                     </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style=""> 480                     .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                              </span>
<span class="-3048945956628717740" onmouseenter="enter('-3048945956628717740');" onmouseout="out('-3048945956628717740');" style=""> 481                 rowData.addAll(rowDataMap.get(NO_PARTITION));                                            </span>
<span class="-5061257777486987691" onmouseenter="enter('-5061257777486987691');" onmouseout="out('-5061257777486987691');" style=""> 482                 String executeSql = tempSql.replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));       </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 483                 statement.execute(executeSql);                                                           </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style=""> 484                 rowData.clear();                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 485             } else {                                                                                     </span>
<span class="6613720697354939567" onmouseenter="enter('6613720697354939567');" onmouseout="out('6613720697354939567');" style=""> 486                 // partition sql                                                                         </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 487                 Set&lt;String&gt; keySet = rowDataMap.keySet();                                                </span>
<span class="5286500476222551862" onmouseenter="enter('5286500476222551862');" onmouseout="out('5286500476222551862');" style=""> 488                 for (String key : keySet) {                                                              </span>
<span class="2862511654232329090" onmouseenter="enter('2862511654232329090');" onmouseout="out('2862511654232329090');" style=""> 489                     rowData.addAll(rowDataMap.get(key));                                                 </span>
<span class="3266960038838022824" onmouseenter="enter('3266960038838022824');" onmouseout="out('3266960038838022824');" style=""> 490                     partitionCondition.append(key);                                                      </span>
<span class="-8595336617081209901" onmouseenter="enter('-8595336617081209901');" onmouseout="out('-8595336617081209901');" style=""> 491                     tempSql = tempSql                                                                    </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style=""> 492                         .replace(PARTITION_CONDITION, partitionCondition.toString())                     </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style=""> 493                         .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                          </span>
<span class="8433888294385954668" onmouseenter="enter('8433888294385954668');" onmouseout="out('8433888294385954668');" style=""> 494                     String executeSql = tempSql                                                          </span>
<span class="-7707177917460131297" onmouseenter="enter('-7707177917460131297');" onmouseout="out('-7707177917460131297');" style=""> 495                         .replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));                          </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 496                     statement.execute(executeSql);                                                       </span>
<span class="-3000902343706299075" onmouseenter="enter('-3000902343706299075');" onmouseout="out('-3000902343706299075');" style=""> 497                     partitionCondition.delete(0, partitionCondition.length());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 500         } catch (Exception e) {                                                                          </span>
<span class="2735729731347220182" onmouseenter="enter('2735729731347220182');" onmouseout="out('2735729731347220182');" style=""> 501             if (e instanceof SQLException) {                                                             </span>
<span class="-4009259436355561175" onmouseenter="enter('-4009259436355561175');" onmouseout="out('-4009259436355561175');" style=""> 502                 dealBatchSqlError(rowData, connection, statement, tempSql);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 503             } else {                                                                                     </span>
<span class="1776368734984517953" onmouseenter="enter('1776368734984517953');" onmouseout="out('1776368734984517953');" style=""> 504                 throw new RuntimeException(&quot;Insert into impala error!&quot;, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 506         } finally {                                                                                      </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style=""> 507             rowData.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 509     }                                                                                                    </span>
<span  style=""> 510                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 511     /**                                                                                                  </span>
<span class="5187728543542090149" onmouseenter="enter('5187728543542090149');" onmouseout="out('5187728543542090149');" style=""> 512      * 当批量写入失败时，把批量的sql拆解为单条sql提交，对于单条写入的sql记做脏数据                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 513      *                                                                                                   </span>
<span class="-4511533979925052485" onmouseenter="enter('-4511533979925052485');" onmouseout="out('-4511533979925052485');" style=""> 514      * @param rowData 批量的values                                                                          </span>
<span class="-2225365195706675086" onmouseenter="enter('-2225365195706675086');" onmouseout="out('-2225365195706675086');" style=""> 515      * @param connection 当前数据库connect                                                                    </span>
<span class="-1332857843479914544" onmouseenter="enter('-1332857843479914544');" onmouseout="out('-1332857843479914544');" style=""> 516      * @param statement 当前statement                                                                      </span>
<span class="-5986970410224412108" onmouseenter="enter('-5986970410224412108');" onmouseout="out('-5986970410224412108');" style=""> 517      * @param templateSql 模版sql，例如insert into tableName(f1, f2, f3) [partition] values $valueCondition   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 518      */                                                                                                  </span>
<span class="-2268452263184113170" onmouseenter="enter('-2268452263184113170');" onmouseout="out('-2268452263184113170');" style=""> 519     private void dealBatchSqlError(List&lt;String&gt; rowData,                                                 </span>
<span class="6863083743086916101" onmouseenter="enter('6863083743086916101');" onmouseout="out('6863083743086916101');" style=""> 520                                    Connection connection,                                                </span>
<span class="5184541356270987154" onmouseenter="enter('5184541356270987154');" onmouseout="out('5184541356270987154');" style=""> 521                                    Statement statement,                                                  </span>
<span class="-3308663832752701650" onmouseenter="enter('-3308663832752701650');" onmouseout="out('-3308663832752701650');" style=""> 522                                    String templateSql) {                                                 </span>
<span class="-7725538089846589979" onmouseenter="enter('-7725538089846589979');" onmouseout="out('-7725538089846589979');" style=""> 523         String errorMsg = &quot;Insert into impala error. \nCause: [%s]\nRow: [%s]&quot;;                          </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 524         JDBCUtils.rollBack(connection);                                                                  </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 525         JDBCUtils.commit(connection);                                                                    </span>
<span class="-7816936101366912926" onmouseenter="enter('-7816936101366912926');" onmouseout="out('-7816936101366912926');" style=""> 526         for (String rowDatum : rowData) {                                                                </span>
<span class="-2842345043798651788" onmouseenter="enter('-2842345043798651788');" onmouseout="out('-2842345043798651788');" style=""> 527             String executeSql = templateSql.replace(VALUES_CONDITION, rowDatum);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 528             try {                                                                                        </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 529                 statement.execute(executeSql);                                                           </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 530                 JDBCUtils.commit(connection);                                                            </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 531             } catch (SQLException e) {                                                                   </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 532                 JDBCUtils.rollBack(connection);                                                          </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 533                 JDBCUtils.commit(connection);                                                            </span>
<span class="-4808081927273297919" onmouseenter="enter('-4808081927273297919');" onmouseout="out('-4808081927273297919');" style=""><abbr title=" 534                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {"> 534                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LO🔵</abbr></span>
<span class="-6393238717567631745" onmouseenter="enter('-6393238717567631745');" onmouseout="out('-6393238717567631745');" style=""> 535                     LOG.error(                                                                           </span>
<span class="-6108141239353831940" onmouseenter="enter('-6108141239353831940');" onmouseout="out('-6108141239353831940');" style=""> 536                         String.format(                                                                   </span>
<span class="-7558476617034981134" onmouseenter="enter('-7558476617034981134');" onmouseout="out('-7558476617034981134');" style=""> 537                             errorMsg,                                                                    </span>
<span class="-8675169859989204616" onmouseenter="enter('-8675169859989204616');" onmouseout="out('-8675169859989204616');" style=""> 538                             ExceptionTrace.traceOriginalCause(e),                                        </span>
<span class="-2790175153725866914" onmouseenter="enter('-2790175153725866914');" onmouseout="out('-2790175153725866914');" style=""> 539                             rowDatum)                                                                    </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 540                     );                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541                 }                                                                                        </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 542                 metricOutputFormat.outDirtyRecords.inc();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545     }                                                                                                    </span>
<span  style=""> 546                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 547     /**                                                                                                  </span>
<span class="-7756927092547658158" onmouseenter="enter('-7756927092547658158');" onmouseout="out('-7756927092547658158');" style=""> 548      * build partition condition with row data                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 549      *                                                                                                   </span>
<span class="3326420447531983720" onmouseenter="enter('3326420447531983720');" onmouseout="out('3326420447531983720');" style=""> 550      * @param rowData              row data                                                              </span>
<span class="-4527404320823727170" onmouseenter="enter('-4527404320823727170');" onmouseout="out('-4527404320823727170');" style=""> 551      * @param partitionFields      partition fields                                                      </span>
<span class="-1776173940247734574" onmouseenter="enter('-1776173940247734574');" onmouseout="out('-1776173940247734574');" style=""> 552      * @param staticPartitionField static partition fields                                               </span>
<span class="-1132708759906563110" onmouseenter="enter('-1132708759906563110');" onmouseout="out('-1132708759906563110');" style=""> 553      * @return condition like &#x27;(ptOne, ptTwo=v2)&#x27;                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 554      */                                                                                                  </span>
<span class="-3866187778893382496" onmouseenter="enter('-3866187778893382496');" onmouseout="out('-3866187778893382496');" style=""><abbr title=" 555     private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;String&gt; staticPartitionField) {"> 555     private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;Stri🔵</abbr></span>
<span class="1267423885187171547" onmouseenter="enter('1267423885187171547');" onmouseout="out('1267423885187171547');" style=""> 556         for (String key : staticPartitionField) {                                                        </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 557             StringBuilder sb = new StringBuilder();                                                      </span>
<span class="-5505398468694975344" onmouseenter="enter('-5505398468694975344');" onmouseout="out('-5505398468694975344');" style=""> 558             Object value = rowData.get(key);                                                             </span>
<span class="-3546349567435071552" onmouseenter="enter('-3546349567435071552');" onmouseout="out('-3546349567435071552');" style=""> 559             sb.append(key).append(&quot;=&quot;).append(value);                                                    </span>
<span class="7571464430142538701" onmouseenter="enter('7571464430142538701');" onmouseout="out('7571464430142538701');" style=""> 560             partitionFields = partitionFields.replace(&quot;${&quot; + key + &quot;}&quot;, sb.toString());                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561         }                                                                                                </span>
<span class="-6125585623196674116" onmouseenter="enter('-6125585623196674116');" onmouseout="out('-6125585623196674116');" style=""> 562         return &quot;(&quot; + partitionFields + &quot;)&quot;;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563     }                                                                                                    </span>
<span  style=""> 564                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 565     /**                                                                                                  </span>
<span class="1604816269765986224" onmouseenter="enter('1604816269765986224');" onmouseout="out('1604816269765986224');" style=""> 566      * build field condition according to field names                                                    </span>
<span class="-8005762898157210848" onmouseenter="enter('-8005762898157210848');" onmouseout="out('-8005762898157210848');" style=""> 567      * replace ${tableFieldCondition}                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 568      *                                                                                                   </span>
<span class="-3045974832751459167" onmouseenter="enter('-3045974832751459167');" onmouseout="out('-3045974832751459167');" style=""> 569      * @param fieldNames      the selected field names                                                   </span>
<span class="-2115580236801058408" onmouseenter="enter('-2115580236801058408');" onmouseout="out('-2115580236801058408');" style=""> 570      * @param partitionFields the partition fields                                                       </span>
<span class="-2587093228749928778" onmouseenter="enter('-2587093228749928778');" onmouseout="out('-2587093228749928778');" style=""> 571      * @return condition like &#x27;(id, name, age)&#x27;                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 572      */                                                                                                  </span>
<span class="-1478951256156574678" onmouseenter="enter('-1478951256156574678');" onmouseout="out('-1478951256156574678');" style=""> 573     private String buildTableFieldsCondition(List&lt;String&gt; fieldNames, String partitionFields) {          </span>
<span class="-8730756422155226372" onmouseenter="enter('-8730756422155226372');" onmouseout="out('-8730756422155226372');" style=""> 574         return &quot;(&quot; + fieldNames.stream()                                                                 </span>
<span class="-1124201215121024792" onmouseenter="enter('-1124201215121024792');" onmouseout="out('-1124201215121024792');" style=""> 575                 .filter(f -&gt; !partitionFields.contains(f))                                               </span>
<span class="4761076759122573536" onmouseenter="enter('4761076759122573536');" onmouseout="out('4761076759122573536');" style=""> 576                 .map(this::quoteIdentifier)                                                              </span>
<span class="-1385468130735042246" onmouseenter="enter('-1385468130735042246');" onmouseout="out('-1385468130735042246');" style=""> 577                 .collect(Collectors.joining(&quot;, &quot;)) + &quot;)&quot;;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578     }                                                                                                    </span>
<span  style=""> 579                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 580     /**                                                                                                  </span>
<span class="-1930125657620201419" onmouseenter="enter('-1930125657620201419');" onmouseout="out('-1930125657620201419');" style=""> 581      * according to field types, build the values condition                                              </span>
<span class="-5328431915012470826" onmouseenter="enter('-5328431915012470826');" onmouseout="out('-5328431915012470826');" style=""> 582      * replace ${valuesCondition}                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 583      *                                                                                                   </span>
<span class="889997534505017973" onmouseenter="enter('889997534505017973');" onmouseout="out('889997534505017973');" style=""> 584      * @param fieldTypes field types                                                                     </span>
<span class="-5325426707615499755" onmouseenter="enter('-5325426707615499755');" onmouseout="out('-5325426707615499755');" style=""> 585      * @return condition like &#x27;(?, ?, cast(&#x27;?&#x27; as string))&#x27; and &#x27;?&#x27; will be replaced with row data       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 586      */                                                                                                  </span>
<span class="-8753268388884688793" onmouseenter="enter('-8753268388884688793');" onmouseout="out('-8753268388884688793');" style=""> 587     private String buildValuesCondition(List&lt;String&gt; fieldTypes, Row row) {                              </span>
<span class="9451785702271217" onmouseenter="enter('9451785702271217');" onmouseout="out('9451785702271217');" style=""> 588         String valuesCondition = fieldTypes.stream().map(                                                </span>
<span class="-744834501831992668" onmouseenter="enter('-744834501831992668');" onmouseout="out('-744834501831992668');" style=""> 589                 f -&gt; {                                                                                   </span>
<span class="9071647551805886291" onmouseenter="enter('9071647551805886291');" onmouseout="out('9071647551805886291');" style=""> 590                     for (String item : NEED_QUOTE_TYPE) {                                                </span>
<span class="9108011392601680881" onmouseenter="enter('9108011392601680881');" onmouseout="out('9108011392601680881');" style=""> 591                         if (f.toLowerCase().contains(item)) {                                            </span>
<span class="2591906565241238134" onmouseenter="enter('2591906565241238134');" onmouseout="out('2591906565241238134');" style=""> 592                             return String.format(&quot;cast(&#x27;?&#x27; as %s)&quot;, f.toLowerCase());                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594                     }                                                                                    </span>
<span class="6027958975032523467" onmouseenter="enter('6027958975032523467');" onmouseout="out('6027958975032523467');" style=""> 595                     return &quot;?&quot;;                                                                          </span>
<span class="4654177507103038656" onmouseenter="enter('4654177507103038656');" onmouseout="out('4654177507103038656');" style=""> 596                 }).collect(Collectors.joining(&quot;, &quot;));                                                    </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 597         for (int i = 0; i &lt; row.getArity(); i++) {                                                       </span>
<span class="6605498463591237491" onmouseenter="enter('6605498463591237491');" onmouseout="out('6605498463591237491');" style=""> 598             Object rowField = row.getField(i);                                                           </span>
<span class="4211930808349437126" onmouseenter="enter('4211930808349437126');" onmouseout="out('4211930808349437126');" style=""> 599             if (DtStringUtil.isEmptyOrNull(rowField)) {                                                  </span>
<span class="2887641838186684159" onmouseenter="enter('2887641838186684159');" onmouseout="out('2887641838186684159');" style=""> 600                 valuesCondition = valuesCondition.replaceFirst(&quot;&#x27;\\?&#x27;&quot;, &quot;null&quot;);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 601             } else {                                                                                     </span>
<span class="6578353206956648527" onmouseenter="enter('6578353206956648527');" onmouseout="out('6578353206956648527');" style=""> 602                 valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, rowField.toString());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604         }                                                                                                </span>
<span class="7254264812767145915" onmouseenter="enter('7254264812767145915');" onmouseout="out('7254264812767145915');" style=""> 605         return &quot;(&quot; + valuesCondition + &quot;)&quot;;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606     }                                                                                                    </span>
<span  style=""> 607                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 608     /**                                                                                                  </span>
<span class="2218542669560141576" onmouseenter="enter('2218542669560141576');" onmouseout="out('2218542669560141576');" style=""> 609      * impala update mode SQL                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 610      *                                                                                                   </span>
<span class="-8218292189476554358" onmouseenter="enter('-8218292189476554358');" onmouseout="out('-8218292189476554358');" style=""> 611      * @return UPDATE tableName SET setCondition WHERE whereCondition                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 612      */                                                                                                  </span>
<span class="-3752451701752547882" onmouseenter="enter('-3752451701752547882');" onmouseout="out('-3752451701752547882');" style=""><abbr title=" 613     private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; primaryKeys) {"> 613     private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; 🔵</abbr></span>
<span class="5528853464056789996" onmouseenter="enter('5528853464056789996');" onmouseout="out('5528853464056789996');" style=""> 614         //跳过primary key字段                                                                                </span>
<span class="-8857590287628770183" onmouseenter="enter('-8857590287628770183');" onmouseout="out('-8857590287628770183');" style=""> 615         String setClause = fieldNames.stream()                                                           </span>
<span class="-803297460241064625" onmouseenter="enter('-803297460241064625');" onmouseout="out('-803297460241064625');" style=""> 616                 .filter(f -&gt; !CollectionUtils.isNotEmpty(primaryKeys) || !primaryKeys.contains(f))       </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 617                 .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                     </span>
<span class="-209499088310020597" onmouseenter="enter('-209499088310020597');" onmouseout="out('-209499088310020597');" style=""> 618                 .collect(Collectors.joining(&quot;, &quot;));                                                      </span>
<span  style=""> 619                                                                                                          </span>
<span class="-3669556570443861667" onmouseenter="enter('-3669556570443861667');" onmouseout="out('-3669556570443861667');" style=""> 620         String conditionClause = primaryKeys.stream()                                                    </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 621                 .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                     </span>
<span class="1187060376059521362" onmouseenter="enter('1187060376059521362');" onmouseout="out('1187060376059521362');" style=""> 622                 .collect(Collectors.joining(&quot; AND &quot;));                                                   </span>
<span  style=""> 623                                                                                                          </span>
<span class="-880277003185331688" onmouseenter="enter('-880277003185331688');" onmouseout="out('-880277003185331688');" style=""> 624         return &quot;UPDATE &quot; + (Objects.isNull(schema) ? &quot;&quot; : quoteIdentifier(schema) + &quot;.&quot;)                 </span>
<span class="-2776062363149844820" onmouseenter="enter('-2776062363149844820');" onmouseout="out('-2776062363149844820');" style=""> 625                 + quoteIdentifier(tableName) + &quot; SET &quot; + setClause + &quot; WHERE &quot; + conditionClause;        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626     }                                                                                                    </span>
<span  style=""> 627                                                                                                          </span>
<span class="4659511982989745103" onmouseenter="enter('4659511982989745103');" onmouseout="out('4659511982989745103');" style=""> 628     private String quoteIdentifier(String identifier) {                                                  </span>
<span class="1935684454964464658" onmouseenter="enter('1935684454964464658');" onmouseout="out('1935684454964464658');" style=""> 629         return &quot;`&quot; + identifier + &quot;`&quot;;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630     }                                                                                                    </span>
<span  style=""> 631                                                                                                          </span>
<span class="2010609695383714647" onmouseenter="enter('2010609695383714647');" onmouseout="out('2010609695383714647');" style=""> 632     public static class Builder {                                                                        </span>
<span class="5030308014750517924" onmouseenter="enter('5030308014750517924');" onmouseout="out('5030308014750517924');" style=""> 633         private final ImpalaOutputFormat format = new ImpalaOutputFormat();                              </span>
<span  style=""> 634                                                                                                          </span>
<span class="4847669250945231235" onmouseenter="enter('4847669250945231235');" onmouseout="out('4847669250945231235');" style=""> 635         public Builder setDbUrl(String dbUrl) {                                                          </span>
<span class="-7007213682983262515" onmouseenter="enter('-7007213682983262515');" onmouseout="out('-7007213682983262515');" style=""> 636             format.dbUrl = dbUrl;                                                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 637             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 638         }                                                                                                </span>
<span  style=""> 639                                                                                                          </span>
<span class="-2062625403058053727" onmouseenter="enter('-2062625403058053727');" onmouseout="out('-2062625403058053727');" style=""> 640         public Builder setUserName(String userName) {                                                    </span>
<span class="8996094991043959374" onmouseenter="enter('8996094991043959374');" onmouseout="out('8996094991043959374');" style=""> 641             format.userName = userName;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 642             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643         }                                                                                                </span>
<span  style=""> 644                                                                                                          </span>
<span class="-8917696572465338538" onmouseenter="enter('-8917696572465338538');" onmouseout="out('-8917696572465338538');" style=""> 645         public Builder setPassword(String password) {                                                    </span>
<span class="-5617852808102302847" onmouseenter="enter('-5617852808102302847');" onmouseout="out('-5617852808102302847');" style=""> 646             format.password = password;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 647             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 648         }                                                                                                </span>
<span  style=""> 649                                                                                                          </span>
<span class="-6851628607924303336" onmouseenter="enter('-6851628607924303336');" onmouseout="out('-6851628607924303336');" style=""> 650         public Builder setBatchSize(Integer batchSize) {                                                 </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 651             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 652             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 653         }                                                                                                </span>
<span  style=""> 654                                                                                                          </span>
<span class="5791410845050671235" onmouseenter="enter('5791410845050671235');" onmouseout="out('5791410845050671235');" style=""> 655         public Builder setBatchWaitInterval(Long batchWaitInterval) {                                    </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 656             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 657             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658         }                                                                                                </span>
<span  style=""> 659                                                                                                          </span>
<span class="-8777589626278372083" onmouseenter="enter('-8777589626278372083');" onmouseout="out('-8777589626278372083');" style=""> 660         public Builder setTableName(String tableName) {                                                  </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 661             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 662             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663         }                                                                                                </span>
<span  style=""> 664                                                                                                          </span>
<span class="221724127870954269" onmouseenter="enter('221724127870954269');" onmouseout="out('221724127870954269');" style=""> 665         public Builder setPartitionFields(String partitionFields) {                                      </span>
<span class="-8055214001591864073" onmouseenter="enter('-8055214001591864073');" onmouseout="out('-8055214001591864073');" style=""> 666             format.partitionFields = Objects.isNull(partitionFields) ?                                   </span>
<span class="6173943982789028324" onmouseenter="enter('6173943982789028324');" onmouseout="out('6173943982789028324');" style=""> 667                     &quot;&quot; : partitionFields;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 668             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 669         }                                                                                                </span>
<span  style=""> 670                                                                                                          </span>
<span class="-6994787811007556212" onmouseenter="enter('-6994787811007556212');" onmouseout="out('-6994787811007556212');" style=""> 671         public Builder setPrimaryKeys(List&lt;String&gt; primaryKeys) {                                        </span>
<span class="1909693990286542032" onmouseenter="enter('1909693990286542032');" onmouseout="out('1909693990286542032');" style=""> 672             format.primaryKeys = primaryKeys;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 673             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674         }                                                                                                </span>
<span  style=""> 675                                                                                                          </span>
<span class="7512351963685249159" onmouseenter="enter('7512351963685249159');" onmouseout="out('7512351963685249159');" style=""> 676         public Builder setSchema(String schema) {                                                        </span>
<span class="306599522236782764" onmouseenter="enter('306599522236782764');" onmouseout="out('306599522236782764');" style=""> 677             format.schema = schema;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 678             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679         }                                                                                                </span>
<span  style=""> 680                                                                                                          </span>
<span class="4541611662116992338" onmouseenter="enter('4541611662116992338');" onmouseout="out('4541611662116992338');" style=""> 681         public Builder setEnablePartition(Boolean enablePartition) {                                     </span>
<span class="-6976631596761488792" onmouseenter="enter('-6976631596761488792');" onmouseout="out('-6976631596761488792');" style=""> 682             format.enablePartition = enablePartition;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 683             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684         }                                                                                                </span>
<span  style=""> 685                                                                                                          </span>
<span class="-8865383825618932145" onmouseenter="enter('-8865383825618932145');" onmouseout="out('-8865383825618932145');" style=""> 686         public Builder setUpdateMode(String updateMode) {                                                </span>
<span class="-2281017119849044621" onmouseenter="enter('-2281017119849044621');" onmouseout="out('-2281017119849044621');" style=""> 687             format.updateMode = updateMode;                                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 688             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689         }                                                                                                </span>
<span  style=""> 690                                                                                                          </span>
<span class="8081013001489210313" onmouseenter="enter('8081013001489210313');" onmouseout="out('8081013001489210313');" style=""> 691         public Builder setFieldList(List&lt;String&gt; fieldList) {                                            </span>
<span class="-818074055946993480" onmouseenter="enter('-818074055946993480');" onmouseout="out('-818074055946993480');" style=""> 692             format.fieldNames = fieldList;                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 693             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 694         }                                                                                                </span>
<span  style=""> 695                                                                                                          </span>
<span class="3974737416393184735" onmouseenter="enter('3974737416393184735');" onmouseout="out('3974737416393184735');" style=""> 696         public Builder setFieldTypeList(List&lt;String&gt; fieldTypeList) {                                    </span>
<span class="1448747188656744713" onmouseenter="enter('1448747188656744713');" onmouseout="out('1448747188656744713');" style=""> 697             format.fieldTypes = fieldTypeList;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 698             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699         }                                                                                                </span>
<span  style=""> 700                                                                                                          </span>
<span class="2244927175574628655" onmouseenter="enter('2244927175574628655');" onmouseout="out('2244927175574628655');" style=""> 701         public Builder setStoreType(String storeType) {                                                  </span>
<span class="-5818885152026709969" onmouseenter="enter('-5818885152026709969');" onmouseout="out('-5818885152026709969');" style=""> 702             format.storeType = storeType;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 703             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704         }                                                                                                </span>
<span  style=""> 705                                                                                                          </span>
<span class="-5487489987508961941" onmouseenter="enter('-5487489987508961941');" onmouseout="out('-5487489987508961941');" style=""> 706         public Builder setFieldExtraInfoList(List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList) {</span>
<span class="160167467316759360" onmouseenter="enter('160167467316759360');" onmouseout="out('160167467316759360');" style=""> 707             format.fieldExtraInfoList = fieldExtraInfoList;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 708             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709         }                                                                                                </span>
<span  style=""> 710                                                                                                          </span>
<span class="1366044936846496088" onmouseenter="enter('1366044936846496088');" onmouseout="out('1366044936846496088');" style=""> 711         public Builder setKeyTabPath(String keyTabPath) {                                                </span>
<span class="8755357456701014681" onmouseenter="enter('8755357456701014681');" onmouseout="out('8755357456701014681');" style=""> 712             format.keytabPath = keyTabPath;                                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 713             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714         }                                                                                                </span>
<span  style=""> 715                                                                                                          </span>
<span class="1807007964631867819" onmouseenter="enter('1807007964631867819');" onmouseout="out('1807007964631867819');" style=""> 716         public Builder setKrb5ConfPath(String krb5ConfPath) {                                            </span>
<span class="352337563234497723" onmouseenter="enter('352337563234497723');" onmouseout="out('352337563234497723');" style=""> 717             format.krb5confPath = krb5ConfPath;                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 718             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719         }                                                                                                </span>
<span  style=""> 720                                                                                                          </span>
<span class="-8540538228750165144" onmouseenter="enter('-8540538228750165144');" onmouseout="out('-8540538228750165144');" style=""> 721         public Builder setPrincipal(String principal) {                                                  </span>
<span class="6894839552978791309" onmouseenter="enter('6894839552978791309');" onmouseout="out('6894839552978791309');" style=""> 722             format.principal = principal;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 723             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724         }                                                                                                </span>
<span  style=""> 725                                                                                                          </span>
<span class="-8991908924314829739" onmouseenter="enter('-8991908924314829739');" onmouseout="out('-8991908924314829739');" style=""> 726         public Builder setAuthMech(Integer authMech) {                                                   </span>
<span class="-1412915325814520049" onmouseenter="enter('-1412915325814520049');" onmouseout="out('-1412915325814520049');" style=""> 727             format.authMech = authMech;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 728             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729         }                                                                                                </span>
<span  style=""> 730                                                                                                          </span>
<span class="1564959121680510141" onmouseenter="enter('1564959121680510141');" onmouseout="out('1564959121680510141');" style=""> 731         private boolean canHandle(String url) {                                                          </span>
<span class="842511305287615009" onmouseenter="enter('842511305287615009');" onmouseout="out('842511305287615009');" style=""> 732             return url.startsWith(&quot;jdbc:impala:&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733         }                                                                                                </span>
<span  style=""> 734                                                                                                          </span>
<span class="-8521575333201954447" onmouseenter="enter('-8521575333201954447');" onmouseout="out('-8521575333201954447');" style=""> 735         public ImpalaOutputFormat build() {                                                              </span>
<span class="1659683170431033048" onmouseenter="enter('1659683170431033048');" onmouseout="out('1659683170431033048');" style=""> 736             if (!canHandle(format.dbUrl)) {                                                              </span>
<span class="-4870909491096243891" onmouseenter="enter('-4870909491096243891');" onmouseout="out('-4870909491096243891');" style=""><abbr title=" 737                 throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl);"> 737                 throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738             }                                                                                            </span>
<span  style=""> 739                                                                                                          </span>
<span class="-4505121258189477360" onmouseenter="enter('-4505121258189477360');" onmouseout="out('-4505121258189477360');" style=""> 740             if (format.authMech == EAuthMech.Kerberos.getType()) {                                       </span>
<span class="-6183848778016991336" onmouseenter="enter('-6183848778016991336');" onmouseout="out('-6183848778016991336');" style=""> 741                 checkNotNull(format.krb5confPath,                                                        </span>
<span class="-4038272028328025626" onmouseenter="enter('-4038272028328025626');" onmouseout="out('-4038272028328025626');" style=""> 742                         &quot;When kerberos authentication is enabled, krb5confPath is required！&quot;);           </span>
<span class="-1753032521002756428" onmouseenter="enter('-1753032521002756428');" onmouseout="out('-1753032521002756428');" style=""> 743                 checkNotNull(format.principal,                                                           </span>
<span class="-5219129049333790569" onmouseenter="enter('-5219129049333790569');" onmouseout="out('-5219129049333790569');" style=""> 744                         &quot;When kerberos authentication is enabled, principal is required！&quot;);              </span>
<span class="-3070330065691611476" onmouseenter="enter('-3070330065691611476');" onmouseout="out('-3070330065691611476');" style=""> 745                 checkNotNull(format.keytabPath,                                                          </span>
<span class="-393994981289522477" onmouseenter="enter('-393994981289522477');" onmouseout="out('-393994981289522477');" style=""> 746                         &quot;When kerberos authentication is enabled, keytabPath is required！&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747             }                                                                                            </span>
<span  style=""> 748                                                                                                          </span>
<span class="-5111581416826137591" onmouseenter="enter('-5111581416826137591');" onmouseout="out('-5111581416826137591');" style=""> 749             if (format.authMech == EAuthMech.UserName.getType()) {                                       </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 750                 checkNotNull(format.userName, &quot;userName is required!&quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751             }                                                                                            </span>
<span  style=""> 752                                                                                                          </span>
<span class="-3238564706659558925" onmouseenter="enter('-3238564706659558925');" onmouseout="out('-3238564706659558925');" style=""> 753             if (format.authMech == EAuthMech.NameANDPassword.getType()) {                                </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 754                 checkNotNull(format.userName, &quot;userName is required!&quot;);                                  </span>
<span class="-9040493906648204146" onmouseenter="enter('-9040493906648204146');" onmouseout="out('-9040493906648204146');" style=""> 755                 checkNotNull(format.password, &quot;password is required!&quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 756             }                                                                                            </span>
<span  style=""> 757                                                                                                          </span>
<span class="1310568763423505425" onmouseenter="enter('1310568763423505425');" onmouseout="out('1310568763423505425');" style=""> 758             checkNotNull(format.storeType, &quot;storeType is required!&quot;);                                    </span>
<span  style=""> 759                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 760             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-6349807778844055730" onmouseenter="enter('-6349807778844055730');" onmouseout="out('-6349807778844055730');" style="">  19 package com.dtstack.flink.sql.sink.impala;                                                               </span>
<span  style="">  20                                                                                                          </span>
<span class="1128057574573805325" onmouseenter="enter('1128057574573805325');" onmouseout="out('1128057574573805325');" style="">  21 import com.dtstack.flink.sql.classloader.ClassLoaderManager;                                             </span>
<span  style="">  22                                                                                                          </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  23 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  24 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  25 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-8930056125403642162" onmouseenter="enter('-8930056125403642162');" onmouseout="out('-8930056125403642162');" style="">  26 import com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils;                                              </span>
<span class="-692023547870128618" onmouseenter="enter('-692023547870128618');" onmouseout="out('-692023547870128618');" style="">  27 import com.dtstack.flink.sql.table.AbstractTableInfo;                                                    </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="">  28 import com.dtstack.flink.sql.util.DtStringUtil;                                                          </span>
<span class="6538493847244355843" onmouseenter="enter('6538493847244355843');" onmouseout="out('6538493847244355843');" style="">  29 import com.dtstack.flink.sql.util.KrbUtils;                                                              </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  30 import com.google.common.collect.Maps;                                                                   </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  31 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  32 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  33 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  34 import org.apache.flink.types.Row;                                                                       </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  35 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  36 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  37 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  39 import java.io.IOException;                                                                              </span>
<span class="7889752473047782369" onmouseenter="enter('7889752473047782369');" onmouseout="out('7889752473047782369');" style="">  40 import java.security.PrivilegedExceptionAction;                                                          </span>
<span class="-7136330293413175449" onmouseenter="enter('-7136330293413175449');" onmouseout="out('-7136330293413175449');" style="">  41 import java.sql.Connection;                                                                              </span>
<span class="7894029524760905232" onmouseenter="enter('7894029524760905232');" onmouseout="out('7894029524760905232');" style="">  42 import java.sql.DriverManager;                                                                           </span>
<span class="-3337023324264694028" onmouseenter="enter('-3337023324264694028');" onmouseout="out('-3337023324264694028');" style="">  43 import java.sql.PreparedStatement;                                                                       </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  44 import java.sql.SQLException;                                                                            </span>
<span class="6402527026259660908" onmouseenter="enter('6402527026259660908');" onmouseout="out('6402527026259660908');" style="">  45 import java.sql.Statement;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  46 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  47 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  48 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  49 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  50 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  51 import java.util.Set;                                                                                    </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  52 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  53 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  54 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  55 import java.util.concurrent.TimeUnit;                                                                    </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  56 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  57 import java.util.regex.Pattern;                                                                          </span>
<span class="-6051894930872477589" onmouseenter="enter('-6051894930872477589');" onmouseout="out('-6051894930872477589');" style="">  58 import java.util.stream.Collectors;                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="1455633447019431220" onmouseenter="enter('1455633447019431220');" onmouseout="out('1455633447019431220');" style="">  60 import static com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils.setRecordToStatement;                  </span>
<span class="-6257877604578820371" onmouseenter="enter('-6257877604578820371');" onmouseout="out('-6257877604578820371');" style="">  61 import static org.apache.flink.util.Preconditions.checkNotNull;                                          </span>
<span  style="">  62                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  63 /**                                                                                                      </span>
<span class="7153001641478282104" onmouseenter="enter('7153001641478282104');" onmouseout="out('7153001641478282104');" style="">  64  * Date: 2020/10/14                                                                                      </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  65  * Company: www.dtstack.com                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  66  *                                                                                                       </span>
<span class="-4100502199450942834" onmouseenter="enter('-4100502199450942834');" onmouseout="out('-4100502199450942834');" style="">  67  * @author tiezhu                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  68  */                                                                                                      </span>
<span class="-4121149390422149560" onmouseenter="enter('-4121149390422149560');" onmouseout="out('-4121149390422149560');" style="">  69 public class ImpalaOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {               </span>
<span  style="">  70                                                                                                          </span>
<span class="-5870848474790717720" onmouseenter="enter('-5870848474790717720');" onmouseout="out('-5870848474790717720');" style="">  71     private static final Logger LOG = LoggerFactory.getLogger(ImpalaOutputFormat.class);                 </span>
<span  style="">  72                                                                                                          </span>
<span class="-4645219268431852454" onmouseenter="enter('-4645219268431852454');" onmouseout="out('-4645219268431852454');" style="">  73     private static final long serialVersionUID = 1L;                                                     </span>
<span  style="">  74                                                                                                          </span>
<span class="-9068282285967712029" onmouseenter="enter('-9068282285967712029');" onmouseout="out('-9068282285967712029');" style="">  75     // ${field}                                                                                          </span>
<span class="-5949646080202310183" onmouseenter="enter('-5949646080202310183');" onmouseout="out('-5949646080202310183');" style="">  76     private static final Pattern STATIC_PARTITION_PATTERN = Pattern.compile(&quot;\\$\\{([^}]*)}&quot;);           </span>
<span class="6992730206516090107" onmouseenter="enter('6992730206516090107');" onmouseout="out('6992730206516090107');" style="">  77     //specific type which values need to be quoted                                                       </span>
<span class="-2884666096421851487" onmouseenter="enter('-2884666096421851487');" onmouseout="out('-2884666096421851487');" style="">  78     private static final String[] NEED_QUOTE_TYPE = {&quot;string&quot;, &quot;timestamp&quot;, &quot;varchar&quot;};                  </span>
<span  style="">  79                                                                                                          </span>
<span class="191207487610103693" onmouseenter="enter('191207487610103693');" onmouseout="out('191207487610103693');" style="">  80     private static final Integer DEFAULT_CONN_TIME_OUT = 60;                                             </span>
<span class="-1388186840411616756" onmouseenter="enter('-1388186840411616756');" onmouseout="out('-1388186840411616756');" style="">  81     private static final int RECEIVE_DATA_PRINT_FREQUENCY = 1000;                                        </span>
<span class="-4268888009857984730" onmouseenter="enter('-4268888009857984730');" onmouseout="out('-4268888009857984730');" style="">  82     private static final int DIRTY_DATA_PRINT_FREQUENCY = 1000;                                          </span>
<span  style="">  83                                                                                                          </span>
<span class="-588818051573867979" onmouseenter="enter('-588818051573867979');" onmouseout="out('-588818051573867979');" style="">  84     private static final String KUDU_TYPE = &quot;kudu&quot;;                                                      </span>
<span class="-6769623881035360393" onmouseenter="enter('-6769623881035360393');" onmouseout="out('-6769623881035360393');" style="">  85     private static final String UPDATE_MODE = &quot;update&quot;;                                                  </span>
<span class="-7709014261424944614" onmouseenter="enter('-7709014261424944614');" onmouseout="out('-7709014261424944614');" style="">  86     private static final String PARTITION_CONSTANT = &quot;PARTITION&quot;;                                        </span>
<span class="1441081326157561113" onmouseenter="enter('1441081326157561113');" onmouseout="out('1441081326157561113');" style="">  87     private static final String DRIVER_NAME = &quot;com.cloudera.impala.jdbc41.Driver&quot;;                       </span>
<span  style="">  88                                                                                                          </span>
<span class="-2689163518074835497" onmouseenter="enter('-2689163518074835497');" onmouseout="out('-2689163518074835497');" style="">  89     private static final String VALUES_CONDITION = &quot;${valuesCondition}&quot;;                                 </span>
<span class="3062777246713899037" onmouseenter="enter('3062777246713899037');" onmouseout="out('3062777246713899037');" style="">  90     private static final String PARTITION_CONDITION = &quot;${partitionCondition}&quot;;                           </span>
<span class="2401236240707522557" onmouseenter="enter('2401236240707522557');" onmouseout="out('2401236240707522557');" style="">  91     private static final String TABLE_FIELDS_CONDITION = &quot;${tableFieldsCondition}&quot;;                      </span>
<span class="3255739684264436552" onmouseenter="enter('3255739684264436552');" onmouseout="out('3255739684264436552');" style="">  92     private static final String NO_PARTITION = &quot;noPartition&quot;;                                            </span>
<span class="-7445073777200404714" onmouseenter="enter('-7445073777200404714');" onmouseout="out('-7445073777200404714');" style="">  93     protected transient Connection connection;                                                           </span>
<span class="-2184169902108079684" onmouseenter="enter('-2184169902108079684');" onmouseout="out('-2184169902108079684');" style="">  94     protected transient Statement statement;                                                             </span>
<span class="6238382839663594696" onmouseenter="enter('6238382839663594696');" onmouseout="out('6238382839663594696');" style="">  95     protected transient PreparedStatement updateStatement;                                               </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  96     private transient volatile boolean closed = false;                                                   </span>
<span class="8220840984571392918" onmouseenter="enter('8220840984571392918');" onmouseout="out('8220840984571392918');" style="">  97     private int batchCount = 0;                                                                          </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="">  98     // |------------------------------------------------|                                                </span>
<span class="-789927222958732888" onmouseenter="enter('-789927222958732888');" onmouseout="out('-789927222958732888');" style="">  99     // |   partitionCondition   |Array of valueCondition|                                                </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 100     // |------------------------------------------------|                                                </span>
<span class="-8825804998995953162" onmouseenter="enter('-8825804998995953162');" onmouseout="out('-8825804998995953162');" style=""> 101     // | ptOne, ptTwo, ptThree  | [(v1, v2, v3, v4, v5)]|   DP                                           </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 102     // |------------------------------------------------|                                                </span>
<span class="-5802382310877164118" onmouseenter="enter('-5802382310877164118');" onmouseout="out('-5802382310877164118');" style=""> 103     // | ptOne = v1, ptTwo = v2 | [(v3, v4, v5)]        |   SP                                           </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 104     // |------------------------------------------------|                                                </span>
<span class="2984234039288316275" onmouseenter="enter('2984234039288316275');" onmouseout="out('2984234039288316275');" style=""> 105     // | ptOne, ptTwo = v2      | [(v1, v3, v4, v5)]    |   DP and SP                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 106     // |------------------------------------------------|                                                </span>
<span class="7219405512764117222" onmouseenter="enter('7219405512764117222');" onmouseout="out('7219405512764117222');" style=""> 107     // | noPartition            | [(v1, v2, v3, v4, v5)]|   kudu or disablePartition                     </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 108     // |------------------------------------------------|                                                </span>
<span class="9020411500856357590" onmouseenter="enter('9020411500856357590');" onmouseout="out('9020411500856357590');" style=""> 109     private transient Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap;                                         </span>
<span class="-4172535577750872346" onmouseenter="enter('-4172535577750872346');" onmouseout="out('-4172535577750872346');" style=""> 110     protected String keytabPath;                                                                         </span>
<span class="1987487277257130103" onmouseenter="enter('1987487277257130103');" onmouseout="out('1987487277257130103');" style=""> 111     protected String krb5confPath;                                                                       </span>
<span class="3478885111338451838" onmouseenter="enter('3478885111338451838');" onmouseout="out('3478885111338451838');" style=""> 112     protected String principal;                                                                          </span>
<span class="-2673327721248325609" onmouseenter="enter('-2673327721248325609');" onmouseout="out('-2673327721248325609');" style=""> 113     protected Integer authMech;                                                                          </span>
<span class="-8834882937031238604" onmouseenter="enter('-8834882937031238604');" onmouseout="out('-8834882937031238604');" style=""> 114     protected String dbUrl;                                                                              </span>
<span class="4348689613054045460" onmouseenter="enter('4348689613054045460');" onmouseout="out('4348689613054045460');" style=""> 115     protected String userName;                                                                           </span>
<span class="519247125889688558" onmouseenter="enter('519247125889688558');" onmouseout="out('519247125889688558');" style=""> 116     protected String password;                                                                           </span>
<span class="-7554929939288236010" onmouseenter="enter('-7554929939288236010');" onmouseout="out('-7554929939288236010');" style=""> 117     protected int batchSize = 100;                                                                       </span>
<span class="8848445520039039194" onmouseenter="enter('8848445520039039194');" onmouseout="out('8848445520039039194');" style=""> 118     protected long batchWaitInterval = 60 * 1000L;                                                       </span>
<span class="6924126392600265325" onmouseenter="enter('6924126392600265325');" onmouseout="out('6924126392600265325');" style=""> 119     protected String tableName;                                                                          </span>
<span class="-8067881189136281922" onmouseenter="enter('-8067881189136281922');" onmouseout="out('-8067881189136281922');" style=""> 120     protected List&lt;String&gt; primaryKeys;                                                                  </span>
<span class="-1238809985534246985" onmouseenter="enter('-1238809985534246985');" onmouseout="out('-1238809985534246985');" style=""> 121     protected String partitionFields;                                                                    </span>
<span class="-2843446813182919439" onmouseenter="enter('-2843446813182919439');" onmouseout="out('-2843446813182919439');" style=""> 122     protected Boolean enablePartition;                                                                   </span>
<span class="3349082107931708476" onmouseenter="enter('3349082107931708476');" onmouseout="out('3349082107931708476');" style=""> 123     protected String schema;                                                                             </span>
<span class="-2869920961807604939" onmouseenter="enter('-2869920961807604939');" onmouseout="out('-2869920961807604939');" style=""> 124     protected String storeType;                                                                          </span>
<span class="-7730622042083062639" onmouseenter="enter('-7730622042083062639');" onmouseout="out('-7730622042083062639');" style=""> 125     protected String updateMode;                                                                         </span>
<span class="8729932671243795004" onmouseenter="enter('8729932671243795004');" onmouseout="out('8729932671243795004');" style=""> 126     public List&lt;String&gt; fieldNames;                                                                      </span>
<span class="5323664213258183290" onmouseenter="enter('5323664213258183290');" onmouseout="out('5323664213258183290');" style=""> 127     public List&lt;String&gt; fieldTypes;                                                                      </span>
<span class="589573262942162938" onmouseenter="enter('589573262942162938');" onmouseout="out('589573262942162938');" style=""> 128     public List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList;                                    </span>
<span class="-2123205835999557493" onmouseenter="enter('-2123205835999557493');" onmouseout="out('-2123205835999557493');" style=""> 129     // partition field of static partition which matched by ${field}                                     </span>
<span class="-976040292573398488" onmouseenter="enter('-976040292573398488');" onmouseout="out('-976040292573398488');" style=""> 130     private final List&lt;String&gt; staticPartitionFields = new ArrayList&lt;&gt;();                                </span>
<span class="8461763253073029471" onmouseenter="enter('8461763253073029471');" onmouseout="out('8461763253073029471');" style=""> 131     // valueFieldsName -&gt; 重组之后的fieldNames，为了重组row data字段值对应                                              </span>
<span class="-5473349939362349748" onmouseenter="enter('-5473349939362349748');" onmouseout="out('-5473349939362349748');" style=""> 132     // 需要对partition字段做特殊处理，比如原来的字段顺序为(age, name, id)，但是因为partition，写入的SQL为                               </span>
<span class="888010466316090175" onmouseenter="enter('888010466316090175');" onmouseout="out('888010466316090175');" style=""> 133     // INSERT INTO tableName(name, id) PARTITION(age) VALUES(?, ?, ?)                                    </span>
<span class="1229277488566704041" onmouseenter="enter('1229277488566704041');" onmouseout="out('1229277488566704041');" style=""> 134     // 那么实际executeSql设置字段的顺序应该为(name, id, age)，同时，字段对应的type顺序也需要重组                                       </span>
<span class="6098973354216055964" onmouseenter="enter('6098973354216055964');" onmouseout="out('6098973354216055964');" style=""> 135     private List&lt;String&gt; valueFieldNames;                                                                </span>
<span class="-7108089166418781511" onmouseenter="enter('-7108089166418781511');" onmouseout="out('-7108089166418781511');" style=""> 136     private transient AbstractDtRichOutputFormat&lt;?&gt; metricOutputFormat;                                  </span>
<span class="273368026714901275" onmouseenter="enter('273368026714901275');" onmouseout="out('273368026714901275');" style=""> 137     private List&lt;Row&gt; rows;                                                                              </span>
<span  style=""> 138                                                                                                          </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style=""> 139     private transient ScheduledExecutorService scheduler;                                                </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style=""> 140     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style=""> 141                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 142     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 143     public void configure(Configuration parameters) {                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144     }                                                                                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 146     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 147     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148         try {                                                                                            </span>
<span class="4324779626821739975" onmouseenter="enter('4324779626821739975');" onmouseout="out('4324779626821739975');" style=""> 149             rowDataMap = new HashMap&lt;&gt;();                                                                </span>
<span class="-6551372933934183741" onmouseenter="enter('-6551372933934183741');" onmouseout="out('-6551372933934183741');" style=""> 150             rows = new ArrayList&lt;&gt;();                                                                    </span>
<span class="-7937337195293668220" onmouseenter="enter('-7937337195293668220');" onmouseout="out('-7937337195293668220');" style=""> 151             metricOutputFormat = this;                                                                   </span>
<span class="-8035752082134444550" onmouseenter="enter('-8035752082134444550');" onmouseout="out('-8035752082134444550');" style=""> 152             openConnect();                                                                               </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 153             initScheduledTask(batchWaitInterval);                                                        </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style=""> 154             init();                                                                                      </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 155             initMetric();                                                                                </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 156         } catch (Exception e) {                                                                          </span>
<span class="-105883012207117402" onmouseenter="enter('-105883012207117402');" onmouseout="out('-105883012207117402');" style=""> 157             throw new RuntimeException(&quot;impala output format open error!&quot;, e);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159     }                                                                                                    </span>
<span  style=""> 160                                                                                                          </span>
<span class="-8578201295687943948" onmouseenter="enter('-8578201295687943948');" onmouseout="out('-8578201295687943948');" style=""> 161     private void init() throws SQLException {                                                            </span>
<span class="-8350145873279772804" onmouseenter="enter('-8350145873279772804');" onmouseout="out('-8350145873279772804');" style=""> 162         if (Objects.nonNull(partitionFields)) {                                                          </span>
<span class="8590422903839909721" onmouseenter="enter('8590422903839909721');" onmouseout="out('8590422903839909721');" style=""> 163             // match ${field} from partitionFields                                                       </span>
<span class="399614494149678967" onmouseenter="enter('399614494149678967');" onmouseout="out('399614494149678967');" style=""> 164             Matcher matcher = STATIC_PARTITION_PATTERN.matcher(partitionFields);                         </span>
<span class="-5488916631119752457" onmouseenter="enter('-5488916631119752457');" onmouseout="out('-5488916631119752457');" style=""> 165             while (matcher.find()) {                                                                     </span>
<span class="-1180668930060799754" onmouseenter="enter('-1180668930060799754');" onmouseout="out('-1180668930060799754');" style=""> 166                 LOG.info(&quot;find static partition field: {}&quot;, matcher.group(1));                           </span>
<span class="5933786634924389530" onmouseenter="enter('5933786634924389530');" onmouseout="out('5933786634924389530');" style=""> 167                 staticPartitionFields.add(matcher.group(1));                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169         }                                                                                                </span>
<span  style=""> 170                                                                                                          </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 171         if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                  </span>
<span class="-511688609314859464" onmouseenter="enter('-511688609314859464');" onmouseout="out('-511688609314859464');" style=""> 172             if (!storeType.equalsIgnoreCase(KUDU_TYPE)) {                                                </span>
<span class="7738691828431171650" onmouseenter="enter('7738691828431171650');" onmouseout="out('7738691828431171650');" style=""> 173                 throw new IllegalArgumentException(&quot;update mode not support for non-kudu table!&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174             }                                                                                            </span>
<span class="-1926567860735108753" onmouseenter="enter('-1926567860735108753');" onmouseout="out('-1926567860735108753');" style=""><abbr title=" 175             updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, primaryKeys));"> 175             updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, p🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 176         } else {                                                                                         </span>
<span class="5264299831364970974" onmouseenter="enter('5264299831364970974');" onmouseout="out('5264299831364970974');" style=""><abbr title=" 177             valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTypes, partitionFields);"> 177             valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTyp🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178         }                                                                                                </span>
<span  style=""> 179                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span  style=""> 181                                                                                                          </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 182     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 183         try {                                                                                            </span>
<span class="-5481453632006175071" onmouseenter="enter('-5481453632006175071');" onmouseout="out('-5481453632006175071');" style=""> 184             if (batchWaitInterval != 0) {                                                                </span>
<span class="777682131179381780" onmouseenter="enter('777682131179381780');" onmouseout="out('777682131179381780');" style=""> 185                 this.scheduler = new ScheduledThreadPoolExecutor(1,                                      </span>
<span class="714213466749562787" onmouseenter="enter('714213466749562787');" onmouseout="out('714213466749562787');" style=""> 186                         new DTThreadFactory(&quot;impala-upsert-output-format&quot;));                             </span>
<span class="-7149116985444787635" onmouseenter="enter('-7149116985444787635');" onmouseout="out('-7149116985444787635');" style=""> 187                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(() -&gt; {                     </span>
<span class="-940414522275968791" onmouseenter="enter('-940414522275968791');" onmouseout="out('-940414522275968791');" style=""> 188                     synchronized (ImpalaOutputFormat.this) {                                             </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 189                             flush();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190                     }                                                                                    </span>
<span class="8465771028460365894" onmouseenter="enter('8465771028460365894');" onmouseout="out('8465771028460365894');" style=""> 191                 }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 193         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 194             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span  style=""> 197                                                                                                          </span>
<span class="-2844613068709206340" onmouseenter="enter('-2844613068709206340');" onmouseout="out('-2844613068709206340');" style=""> 198     private void openConnect() throws IOException {                                                      </span>
<span class="-2394055578891206899" onmouseenter="enter('-2394055578891206899');" onmouseout="out('-2394055578891206899');" style=""> 199         if (authMech == 1) {                                                                             </span>
<span class="-7445609792053649263" onmouseenter="enter('-7445609792053649263');" onmouseout="out('-7445609792053649263');" style=""> 200             UserGroupInformation ugi = KrbUtils.loginAndReturnUgi(principal, keytabPath, krb5confPath);  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 201             try {                                                                                        </span>
<span class="1057249312142684394" onmouseenter="enter('1057249312142684394');" onmouseout="out('1057249312142684394');" style=""> 202                 ugi.doAs((PrivilegedExceptionAction&lt;Void&gt;) () -&gt; {                                       </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 203                     openJdbc();                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 204                     return null;                                                                         </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 205                 });                                                                                      </span>
<span class="3693318474890767753" onmouseenter="enter('3693318474890767753');" onmouseout="out('3693318474890767753');" style=""> 206             } catch (InterruptedException | IOException e) {                                             </span>
<span class="-3216725393010457363" onmouseenter="enter('-3216725393010457363');" onmouseout="out('-3216725393010457363');" style=""> 207                 throw new IllegalArgumentException(&quot;connect impala error!&quot;, e);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 209         } else {                                                                                         </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 210             openJdbc();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212     }                                                                                                    </span>
<span  style=""> 213                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 214     /**                                                                                                  </span>
<span class="-4019084214603833891" onmouseenter="enter('-4019084214603833891');" onmouseout="out('-4019084214603833891');" style=""> 215      * get jdbc connection                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 216      */                                                                                                  </span>
<span class="6517717324631316532" onmouseenter="enter('6517717324631316532');" onmouseout="out('6517717324631316532');" style=""> 217     private void openJdbc() {                                                                            </span>
<span class="7396081792504852616" onmouseenter="enter('7396081792504852616');" onmouseout="out('7396081792504852616');" style=""> 218         ClassLoaderManager.forName(DRIVER_NAME, getClass().getClassLoader());                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 219         try {                                                                                            </span>
<span class="-4188974437029144237" onmouseenter="enter('-4188974437029144237');" onmouseout="out('-4188974437029144237');" style=""> 220             connection = DriverManager.getConnection(dbUrl, userName, password);                         </span>
<span class="-3909190598463408725" onmouseenter="enter('-3909190598463408725');" onmouseout="out('-3909190598463408725');" style=""> 221             statement = connection.createStatement();                                                    </span>
<span class="1164602517684291637" onmouseenter="enter('1164602517684291637');" onmouseout="out('1164602517684291637');" style=""> 222             connection.setAutoCommit(false);                                                             </span>
<span class="-2037802754415730828" onmouseenter="enter('-2037802754415730828');" onmouseout="out('-2037802754415730828');" style=""> 223         } catch (SQLException sqlException) {                                                            </span>
<span class="8417232372887360387" onmouseenter="enter('8417232372887360387');" onmouseout="out('8417232372887360387');" style=""> 224             throw new RuntimeException(&quot;get impala jdbc connection failed!&quot;, sqlException);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226     }                                                                                                    </span>
<span  style=""> 227                                                                                                          </span>
<span class="4897761129654612880" onmouseenter="enter('4897761129654612880');" onmouseout="out('4897761129654612880');" style=""> 228     private synchronized void flush() {                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 229         try {                                                                                            </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 230         if (batchCount &gt; 0) {                                                                            </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 231             if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                              </span>
<span class="-7210745719484505959" onmouseenter="enter('-7210745719484505959');" onmouseout="out('-7210745719484505959');" style=""> 232                 executeUpdateBatch();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233             }                                                                                            </span>
<span class="-5565980137871755476" onmouseenter="enter('-5565980137871755476');" onmouseout="out('-5565980137871755476');" style=""> 234             if (!rowDataMap.isEmpty()) {                                                                 </span>
<span class="8546814641173072756" onmouseenter="enter('8546814641173072756');" onmouseout="out('8546814641173072756');" style=""> 235                 String templateSql =                                                                     </span>
<span class="-1766017053596733683" onmouseenter="enter('-1766017053596733683');" onmouseout="out('-1766017053596733683');" style=""><abbr title=" 236                         &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VALUES ${valuesCondition}&quot;;"> 236                         &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VA🔵</abbr></span>
<span class="7007887973141057675" onmouseenter="enter('7007887973141057675');" onmouseout="out('7007887973141057675');" style=""> 237                 executeBatchSql(                                                                         </span>
<span class="-8931083358346849072" onmouseenter="enter('-8931083358346849072');" onmouseout="out('-8931083358346849072');" style=""> 238                         templateSql,                                                                     </span>
<span class="5582129011297069726" onmouseenter="enter('5582129011297069726');" onmouseout="out('5582129011297069726');" style=""> 239                         schema,                                                                          </span>
<span class="8599198975592615021" onmouseenter="enter('8599198975592615021');" onmouseout="out('8599198975592615021');" style=""> 240                         tableName,                                                                       </span>
<span class="7739930709415439240" onmouseenter="enter('7739930709415439240');" onmouseout="out('7739930709415439240');" style=""> 241                         storeType,                                                                       </span>
<span class="4460343981916954231" onmouseenter="enter('4460343981916954231');" onmouseout="out('4460343981916954231');" style=""> 242                         enablePartition,                                                                 </span>
<span class="-232795436679668454" onmouseenter="enter('-232795436679668454');" onmouseout="out('-232795436679668454');" style=""> 243                         valueFieldNames,                                                                 </span>
<span class="2377300059169474736" onmouseenter="enter('2377300059169474736');" onmouseout="out('2377300059169474736');" style=""> 244                         partitionFields,                                                                 </span>
<span class="-163268273074797630" onmouseenter="enter('-163268273074797630');" onmouseout="out('-163268273074797630');" style=""> 245                         rowDataMap                                                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 246                 );                                                                                       </span>
<span class="1629791312198735010" onmouseenter="enter('1629791312198735010');" onmouseout="out('1629791312198735010');" style=""> 247                 rowDataMap.clear();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span class="-5311733944590264805" onmouseenter="enter('-5311733944590264805');" onmouseout="out('-5311733944590264805');" style=""> 250         batchCount = 0;                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 251         } catch (Exception e) {                                                                          </span>
<span class="-5628183046854957718" onmouseenter="enter('-5628183046854957718');" onmouseout="out('-5628183046854957718');" style=""> 252             LOG.error(&quot;Writing records to impala jdbc failed.&quot;, e);                                      </span>
<span class="-7023774051195191894" onmouseenter="enter('-7023774051195191894');" onmouseout="out('-7023774051195191894');" style=""> 253             throw new RuntimeException(&quot;Writing records to impala jdbc failed.&quot;, e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255     }                                                                                                    </span>
<span  style=""> 256                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 257     /**                                                                                                  </span>
<span class="-1106181825212481278" onmouseenter="enter('-1106181825212481278');" onmouseout="out('-1106181825212481278');" style=""> 258      * execute batch update statement                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 259      *                                                                                                   </span>
<span class="3560665881375675274" onmouseenter="enter('3560665881375675274');" onmouseout="out('3560665881375675274');" style=""> 260      * @throws SQLException throw sql exception                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 261      */                                                                                                  </span>
<span class="3206601587144870407" onmouseenter="enter('3206601587144870407');" onmouseout="out('3206601587144870407');" style=""> 262     private void executeUpdateBatch() throws SQLException {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 263         try {                                                                                            </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 264             rows.forEach(row -&gt; {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 265                 try {                                                                                    </span>
<span class="-1215139546593028546" onmouseenter="enter('-1215139546593028546');" onmouseout="out('-1215139546593028546');" style=""> 266                     JDBCTypeConvertUtils.setRecordToStatement(                                           </span>
<span class="-4710389352980966846" onmouseenter="enter('-4710389352980966846');" onmouseout="out('-4710389352980966846');" style=""> 267                             updateStatement,                                                             </span>
<span class="4668718668329814914" onmouseenter="enter('4668718668329814914');" onmouseout="out('4668718668329814914');" style=""> 268                             JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes),                    </span>
<span class="-7576027683765873339" onmouseenter="enter('-7576027683765873339');" onmouseout="out('-7576027683765873339');" style=""> 269                             row,                                                                         </span>
<span class="-255277236311302851" onmouseenter="enter('-255277236311302851');" onmouseout="out('-255277236311302851');" style=""> 270                             primaryKeys.stream().mapToInt(fieldNames::indexOf).toArray()                 </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 271                     );                                                                                   </span>
<span class="-4238050377414791796" onmouseenter="enter('-4238050377414791796');" onmouseout="out('-4238050377414791796');" style=""> 272                     updateStatement.addBatch();                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 273                 } catch (Exception e) {                                                                  </span>
<span class="5068376771892501659" onmouseenter="enter('5068376771892501659');" onmouseout="out('5068376771892501659');" style=""> 274                     throw new RuntimeException(&quot;impala jdbc execute batch error!&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 276             });                                                                                          </span>
<span class="-3747739502872154032" onmouseenter="enter('-3747739502872154032');" onmouseout="out('-3747739502872154032');" style=""> 277             updateStatement.executeBatch();                                                              </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 278             connection.commit();                                                                         </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 279             rows.clear();                                                                                </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 280         } catch (Exception e) {                                                                          </span>
<span class="1715728751446881781" onmouseenter="enter('1715728751446881781');" onmouseout="out('1715728751446881781');" style=""> 281             LOG.debug(&quot;impala jdbc execute batch error &quot;, e);                                            </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 282             JDBCUtils.rollBack(connection);                                                              </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 283             JDBCUtils.commit(connection);                                                                </span>
<span class="-4187732730208785389" onmouseenter="enter('-4187732730208785389');" onmouseout="out('-4187732730208785389');" style=""> 284             updateStatement.clearBatch();                                                                </span>
<span class="-8814080953460465644" onmouseenter="enter('-8814080953460465644');" onmouseout="out('-8814080953460465644');" style=""> 285             executeUpdate(connection);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287     }                                                                                                    </span>
<span  style=""> 288                                                                                                          </span>
<span class="-4847686400566224446" onmouseenter="enter('-4847686400566224446');" onmouseout="out('-4847686400566224446');" style=""> 289     public void executeUpdate(Connection connection) {                                                   </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 290         rows.forEach(row -&gt; {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 291             try {                                                                                        </span>
<span class="3018395377218617369" onmouseenter="enter('3018395377218617369');" onmouseout="out('3018395377218617369');" style=""><abbr title=" 292                 setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), row);"> 292                 setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldT🔵</abbr></span>
<span class="-6547782628025070914" onmouseenter="enter('-6547782628025070914');" onmouseout="out('-6547782628025070914');" style=""> 293                 updateStatement.executeUpdate();                                                         </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 294                 JDBCUtils.commit(connection);                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 295             } catch (Exception e) {                                                                      </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 296                 JDBCUtils.rollBack(connection);                                                          </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 297                 JDBCUtils.commit(connection);                                                            </span>
<span class="-4808081927273297919" onmouseenter="enter('-4808081927273297919');" onmouseout="out('-4808081927273297919');" style=""><abbr title=" 298                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {"> 298                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LO🔵</abbr></span>
<span class="-2764908242367356599" onmouseenter="enter('-2764908242367356599');" onmouseout="out('-2764908242367356599');" style=""> 299                     LOG.error(&quot;record insert failed ,this row is {}&quot;, row.toString());                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 300                     LOG.error(&quot;&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301                 }                                                                                        </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 302                 metricOutputFormat.outDirtyRecords.inc();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 304         });                                                                                              </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 305         rows.clear();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="5541545914698662583" onmouseenter="enter('5541545914698662583');" onmouseout="out('5541545914698662583');" style=""><abbr title=" 308     private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData) {"> 308     private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData)🔵</abbr></span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 309         Set&lt;String&gt; keySet = rowDataMap.keySet();                                                        </span>
<span class="-4115511162008757651" onmouseenter="enter('-4115511162008757651');" onmouseout="out('-4115511162008757651');" style=""> 310         ArrayList&lt;String&gt; tempRowArray;                                                                  </span>
<span class="-6312285345137005178" onmouseenter="enter('-6312285345137005178');" onmouseout="out('-6312285345137005178');" style=""> 311         if (keySet.contains(rowData.f0)) {                                                               </span>
<span class="2063657660163215007" onmouseenter="enter('2063657660163215007');" onmouseout="out('2063657660163215007');" style=""> 312             tempRowArray = rowDataMap.get(rowData.f0);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 313         } else {                                                                                         </span>
<span class="7109917545131433172" onmouseenter="enter('7109917545131433172');" onmouseout="out('7109917545131433172');" style=""> 314             tempRowArray = new ArrayList&lt;&gt;();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315         }                                                                                                </span>
<span class="1467529594977533778" onmouseenter="enter('1467529594977533778');" onmouseout="out('1467529594977533778');" style=""> 316         tempRowArray.add(rowData.f1);                                                                    </span>
<span class="6767865840186405987" onmouseenter="enter('6767865840186405987');" onmouseout="out('6767865840186405987');" style=""> 317         rowDataMap.put(rowData.f0, tempRowArray);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318     }                                                                                                    </span>
<span  style=""> 319                                                                                                          </span>
<span class="3578278218776325408" onmouseenter="enter('3578278218776325408');" onmouseout="out('3578278218776325408');" style=""><abbr title=" 320     private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPartitionFields, List&lt;String&gt; fieldTypes, String partitionFields) {"> 320     private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPart🔵</abbr></span>
<span class="-4698577817001148605" onmouseenter="enter('-4698577817001148605');" onmouseout="out('-4698577817001148605');" style=""> 321         if (partitionFields == null || partitionFields.isEmpty()) {                                      </span>
<span class="2916035488958294792" onmouseenter="enter('2916035488958294792');" onmouseout="out('2916035488958294792');" style=""> 322             return fieldNames;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323         }                                                                                                </span>
<span  style=""> 324                                                                                                          </span>
<span class="7990418778069769767" onmouseenter="enter('7990418778069769767');" onmouseout="out('7990418778069769767');" style=""> 325         List&lt;String&gt; valueFields = new ArrayList&lt;&gt;(fieldNames);                                          </span>
<span  style=""> 326                                                                                                          </span>
<span class="2302239674432319726" onmouseenter="enter('2302239674432319726');" onmouseout="out('2302239674432319726');" style=""> 327         for (int i = valueFields.size() - 1; i &gt;= 0; i--) {                                              </span>
<span class="-8004931019804249555" onmouseenter="enter('-8004931019804249555');" onmouseout="out('-8004931019804249555');" style=""> 328             if (staticPartitionFields.contains(fieldNames.get(i))) {                                     </span>
<span class="-3872161480019783193" onmouseenter="enter('-3872161480019783193');" onmouseout="out('-3872161480019783193');" style=""> 329                 valueFields.remove(i);                                                                   </span>
<span class="5504621354582269117" onmouseenter="enter('5504621354582269117');" onmouseout="out('5504621354582269117');" style=""> 330                 fieldTypes.remove(i);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332         }                                                                                                </span>
<span  style=""> 333                                                                                                          </span>
<span class="8724369392835521335" onmouseenter="enter('8724369392835521335');" onmouseout="out('8724369392835521335');" style=""> 334         for (int i = 0; i &lt; valueFields.size(); i++) {                                                   </span>
<span class="4573573241123850638" onmouseenter="enter('4573573241123850638');" onmouseout="out('4573573241123850638');" style=""> 335             if (partitionFields.contains(fieldNames.get(i))) {                                           </span>
<span class="-6733214010943616061" onmouseenter="enter('-6733214010943616061');" onmouseout="out('-6733214010943616061');" style=""> 336                 valueFields.add(valueFields.remove(i));                                                  </span>
<span class="3100686975272655596" onmouseenter="enter('3100686975272655596');" onmouseout="out('3100686975272655596');" style=""> 337                 fieldTypes.add(fieldTypes.remove(i));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339         }                                                                                                </span>
<span  style=""> 340                                                                                                          </span>
<span class="-4055330890426471630" onmouseenter="enter('-4055330890426471630');" onmouseout="out('-4055330890426471630');" style=""> 341         return valueFields;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342     }                                                                                                    </span>
<span  style=""> 343                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 344     @Override                                                                                            </span>
<span class="-8766503565464123288" onmouseenter="enter('-8766503565464123288');" onmouseout="out('-8766503565464123288');" style=""> 345     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) throws IOException {                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 346         try {                                                                                            </span>
<span class="-1438543337409690372" onmouseenter="enter('-1438543337409690372');" onmouseout="out('-1438543337409690372');" style=""> 347             if (!record.f0) {                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 348                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349             }                                                                                            </span>
<span  style=""> 350                                                                                                          </span>
<span class="-8847095116449263406" onmouseenter="enter('-8847095116449263406');" onmouseout="out('-8847095116449263406');" style=""> 351             if (outRecords.getCount() % RECEIVE_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {     </span>
<span class="867853870420543335" onmouseenter="enter('867853870420543335');" onmouseout="out('867853870420543335');" style=""> 352                 LOG.info(&quot;Receive data : {}&quot;, record);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353             }                                                                                            </span>
<span  style=""> 354                                                                                                          </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 355             if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                              </span>
<span class="-4538110507205524162" onmouseenter="enter('-4538110507205524162');" onmouseout="out('-4538110507205524162');" style=""> 356                 rows.add(Row.copy(record.f1));                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 357             } else {                                                                                     </span>
<span class="-7917205410914838057" onmouseenter="enter('-7917205410914838057');" onmouseout="out('-7917205410914838057');" style=""> 358                 Map&lt;String, Object&gt; valueMap = Maps.newHashMap();                                        </span>
<span class="1869446492779313508" onmouseenter="enter('1869446492779313508');" onmouseout="out('1869446492779313508');" style=""> 359                 Row row = Row.copy(record.f1);                                                           </span>
<span  style=""> 360                                                                                                          </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 361                 for (int i = 0; i &lt; row.getArity(); i++) {                                               </span>
<span class="5876572039273015428" onmouseenter="enter('5876572039273015428');" onmouseout="out('5876572039273015428');" style=""> 362                     valueMap.put(fieldNames.get(i), row.getField(i));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363                 }                                                                                        </span>
<span  style=""> 364                                                                                                          </span>
<span class="-991390362203857814" onmouseenter="enter('-991390362203857814');" onmouseout="out('-991390362203857814');" style=""> 365                 Tuple2&lt;String, String&gt; rowTuple2 = new Tuple2&lt;&gt;();                                       </span>
<span class="-209542121488547867" onmouseenter="enter('-209542121488547867');" onmouseout="out('-209542121488547867');" style=""> 366                 if (storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition) {                         </span>
<span class="-4830782679838689768" onmouseenter="enter('-4830782679838689768');" onmouseout="out('-4830782679838689768');" style=""> 367                     rowTuple2.f0 = NO_PARTITION;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 368                 } else {                                                                                 </span>
<span class="5139395380358692168" onmouseenter="enter('5139395380358692168');" onmouseout="out('5139395380358692168');" style=""><abbr title=" 369                     rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFields);"> 369                     rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFiel🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370                 }                                                                                        </span>
<span  style=""> 371                                                                                                          </span>
<span class="-484968884065413564" onmouseenter="enter('-484968884065413564');" onmouseout="out('-484968884065413564');" style=""> 372                 // 根据字段名对 row data 重组, 比如，原始 row data : (1, xxx, 20) -&gt; (id, name, age)                  </span>
<span class="2038150889857603205" onmouseenter="enter('2038150889857603205');" onmouseout="out('2038150889857603205');" style=""> 373                 // 但是由于 partition，写入的field 顺序变成了 (name, id, age)，则需要对 row data 重组变成 (xxx, 1, 20)         </span>
<span class="5421203580895226953" onmouseenter="enter('5421203580895226953');" onmouseout="out('5421203580895226953');" style=""> 374                 Row rowValue = new Row(fieldTypes.size());                                               </span>
<span class="-7699243670258396145" onmouseenter="enter('-7699243670258396145');" onmouseout="out('-7699243670258396145');" style=""> 375                 for (int i = 0; i &lt; fieldTypes.size(); i++) {                                            </span>
<span class="2312799749991659832" onmouseenter="enter('2312799749991659832');" onmouseout="out('2312799749991659832');" style=""> 376                     rowValue.setField(i, valueMap.get(valueFieldNames.get(i)));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377                 }                                                                                        </span>
<span class="2914199757449377543" onmouseenter="enter('2914199757449377543');" onmouseout="out('2914199757449377543');" style=""> 378                 rowTuple2.f1 = buildValuesCondition(fieldTypes, rowValue);                               </span>
<span class="8896132355788887171" onmouseenter="enter('8896132355788887171');" onmouseout="out('8896132355788887171');" style=""> 379                 putRowIntoMap(rowDataMap, rowTuple2);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380             }                                                                                            </span>
<span  style=""> 381                                                                                                          </span>
<span class="-1784546571648451896" onmouseenter="enter('-1784546571648451896');" onmouseout="out('-1784546571648451896');" style=""> 382             batchCount++;                                                                                </span>
<span  style=""> 383                                                                                                          </span>
<span class="2059038061408804342" onmouseenter="enter('2059038061408804342');" onmouseout="out('2059038061408804342');" style=""> 384             if (batchCount &gt;= batchSize) {                                                               </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 385                 flush();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386             }                                                                                            </span>
<span  style=""> 387                                                                                                          </span>
<span class="-2147939016446724954" onmouseenter="enter('-2147939016446724954');" onmouseout="out('-2147939016446724954');" style=""> 388             // Receive data                                                                              </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 389             outRecords.inc();                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 390         } catch (Exception e) {                                                                          </span>
<span class="-6314596404725474749" onmouseenter="enter('-6314596404725474749');" onmouseout="out('-6314596404725474749');" style=""> 391             throw new IOException(&quot;Writing records to impala failed.&quot;, e);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393     }                                                                                                    </span>
<span  style=""> 394                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 395     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 396     public void close() throws IOException {                                                             </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 397         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 398             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399         }                                                                                                </span>
<span class="-8247099019020917877" onmouseenter="enter('-8247099019020917877');" onmouseout="out('-8247099019020917877');" style=""> 400         // 将还未执行的SQL flush                                                                               </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 401         if (batchCount &gt; 0) {                                                                            </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 402                 flush();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span class="4306800238416480323" onmouseenter="enter('4306800238416480323');" onmouseout="out('4306800238416480323');" style=""> 404         // cancel scheduled task                                                                         </span>
<span class="-1257031862697527304" onmouseenter="enter('-1257031862697527304');" onmouseout="out('-1257031862697527304');" style=""> 405         if (this.scheduledFuture != null) {                                                              </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 406             scheduledFuture.cancel(false);                                                               </span>
<span class="-3367227577965762682" onmouseenter="enter('-3367227577965762682');" onmouseout="out('-3367227577965762682');" style=""> 407             this.scheduler.shutdown();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408         }                                                                                                </span>
<span class="-6918026600162299955" onmouseenter="enter('-6918026600162299955');" onmouseout="out('-6918026600162299955');" style=""> 409         // close connection                                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 410         try {                                                                                            </span>
<span class="7850482504012729998" onmouseenter="enter('7850482504012729998');" onmouseout="out('7850482504012729998');" style=""> 411             if (connection != null &amp;&amp; connection.isValid(DEFAULT_CONN_TIME_OUT)) {                       </span>
<span class="9071602856049240163" onmouseenter="enter('9071602856049240163');" onmouseout="out('9071602856049240163');" style=""> 412                 connection.close();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413             }                                                                                            </span>
<span  style=""> 414                                                                                                          </span>
<span class="5036557091369948437" onmouseenter="enter('5036557091369948437');" onmouseout="out('5036557091369948437');" style=""> 415             if (statement != null &amp;&amp; !statement.isClosed()) {                                            </span>
<span class="-4290000005499431342" onmouseenter="enter('-4290000005499431342');" onmouseout="out('-4290000005499431342');" style=""> 416                 statement.close();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417             }                                                                                            </span>
<span  style=""> 418                                                                                                          </span>
<span class="-3745862640690712208" onmouseenter="enter('-3745862640690712208');" onmouseout="out('-3745862640690712208');" style=""> 419             if (updateStatement != null &amp;&amp; !updateStatement.isClosed()) {                                </span>
<span class="6285223499122042502" onmouseenter="enter('6285223499122042502');" onmouseout="out('6285223499122042502');" style=""> 420                 updateStatement.close();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421             }                                                                                            </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 422         } catch (SQLException e) {                                                                       </span>
<span class="-8800633426745397107" onmouseenter="enter('-8800633426745397107');" onmouseout="out('-8800633426745397107');" style=""> 423             throw new RuntimeException(&quot;impala connection close failed!&quot;, e);                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 424         } finally {                                                                                      </span>
<span class="8335594207613379924" onmouseenter="enter('8335594207613379924');" onmouseout="out('8335594207613379924');" style=""> 425             connection = null;                                                                           </span>
<span class="-8855760725718402841" onmouseenter="enter('-8855760725718402841');" onmouseout="out('-8855760725718402841');" style=""> 426             statement = null;                                                                            </span>
<span class="-7841270215011717932" onmouseenter="enter('-7841270215011717932');" onmouseout="out('-7841270215011717932');" style=""> 427             updateStatement = null;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428         }                                                                                                </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 429         closed = true;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430     }                                                                                                    </span>
<span  style=""> 431                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 432     /**                                                                                                  </span>
<span class="1296337810927918625" onmouseenter="enter('1296337810927918625');" onmouseout="out('1296337810927918625');" style=""> 433      * execute batch sql from row data map                                                               </span>
<span class="-5974232274386764846" onmouseenter="enter('-5974232274386764846');" onmouseout="out('-5974232274386764846');" style=""><abbr title=" 434      * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)...."> 434      * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 435      *                                                                                                   </span>
<span class="4252025712922498493" onmouseenter="enter('4252025712922498493');" onmouseout="out('4252025712922498493');" style=""> 436      * @param tempSql         template sql                                                               </span>
<span class="-888616451537648959" onmouseenter="enter('-888616451537648959');" onmouseout="out('-888616451537648959');" style=""> 437      * @param storeType       the store type of data                                                     </span>
<span class="-5301096736775778703" onmouseenter="enter('-5301096736775778703');" onmouseout="out('-5301096736775778703');" style=""> 438      * @param enablePartition enable partition or not                                                    </span>
<span class="-7243431631208061298" onmouseenter="enter('-7243431631208061298');" onmouseout="out('-7243431631208061298');" style=""> 439      * @param fieldNames      field name list                                                            </span>
<span class="991482749163976330" onmouseenter="enter('991482749163976330');" onmouseout="out('991482749163976330');" style=""> 440      * @param partitionFields partition fields                                                           </span>
<span class="5552251290683891506" onmouseenter="enter('5552251290683891506');" onmouseout="out('5552251290683891506');" style=""> 441      * @param rowDataMap      row data map                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 442      */                                                                                                  </span>
<span class="-999744234218262965" onmouseenter="enter('-999744234218262965');" onmouseout="out('-999744234218262965');" style=""> 443     private void executeBatchSql(String tempSql,                                                         </span>
<span class="-1880214364205558871" onmouseenter="enter('-1880214364205558871');" onmouseout="out('-1880214364205558871');" style=""> 444                                  String schema,                                                          </span>
<span class="6859219661302664351" onmouseenter="enter('6859219661302664351');" onmouseout="out('6859219661302664351');" style=""> 445                                  String tableName,                                                       </span>
<span class="3305030788069730493" onmouseenter="enter('3305030788069730493');" onmouseout="out('3305030788069730493');" style=""> 446                                  String storeType,                                                       </span>
<span class="3282308130032253418" onmouseenter="enter('3282308130032253418');" onmouseout="out('3282308130032253418');" style=""> 447                                  Boolean enablePartition,                                                </span>
<span class="-3269341593111050509" onmouseenter="enter('-3269341593111050509');" onmouseout="out('-3269341593111050509');" style=""> 448                                  List&lt;String&gt; fieldNames,                                                </span>
<span class="-152366337684528954" onmouseenter="enter('-152366337684528954');" onmouseout="out('-152366337684528954');" style=""> 449                                  String partitionFields,                                                 </span>
<span class="5702355489208114022" onmouseenter="enter('5702355489208114022');" onmouseout="out('5702355489208114022');" style=""> 450                                  Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap) {                            </span>
<span class="-1699639020719600437" onmouseenter="enter('-1699639020719600437');" onmouseout="out('-1699639020719600437');" style=""> 451         StringBuilder partitionCondition = new StringBuilder();                                          </span>
<span class="4484344279813579809" onmouseenter="enter('4484344279813579809');" onmouseout="out('4484344279813579809');" style=""> 452         String tableFieldsCondition = buildTableFieldsCondition(fieldNames, partitionFields);            </span>
<span class="6980371482153070193" onmouseenter="enter('6980371482153070193');" onmouseout="out('6980371482153070193');" style=""> 453         ArrayList&lt;String&gt; rowData = new ArrayList&lt;&gt;();                                                   </span>
<span class="3545700907988930339" onmouseenter="enter('3545700907988930339');" onmouseout="out('3545700907988930339');" style=""> 454         String tableNameInfo = Objects.isNull(schema) ?                                                  </span>
<span class="1480493120427294696" onmouseenter="enter('1480493120427294696');" onmouseout="out('1480493120427294696');" style=""> 455                 tableName : quoteIdentifier(schema) + &quot;.&quot; + tableName;                                   </span>
<span class="-7586945217349428495" onmouseenter="enter('-7586945217349428495');" onmouseout="out('-7586945217349428495');" style=""> 456         tempSql = tempSql.replace(&quot;tableName&quot;, tableNameInfo);                                           </span>
<span class="-3470966760283073144" onmouseenter="enter('-3470966760283073144');" onmouseout="out('-3470966760283073144');" style=""> 457         boolean isPartitioned = storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition;               </span>
<span  style=""> 458                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 459         try {                                                                                            </span>
<span class="-739313269293547881" onmouseenter="enter('-739313269293547881');" onmouseout="out('-739313269293547881');" style=""> 460             // kudu ${partitionCondition} is null                                                        </span>
<span class="-196943023254075124" onmouseenter="enter('-196943023254075124');" onmouseout="out('-196943023254075124');" style=""> 461             if (isPartitioned) {                                                                         </span>
<span class="-8595336617081209901" onmouseenter="enter('-8595336617081209901');" onmouseout="out('-8595336617081209901');" style=""> 462                 tempSql = tempSql                                                                        </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style=""> 463                     .replace(PARTITION_CONDITION, partitionCondition.toString())                         </span>
<span class="1939264830691633930" onmouseenter="enter('1939264830691633930');" onmouseout="out('1939264830691633930');" style=""> 464                     .replace(PARTITION_CONSTANT, &quot;&quot;)                                                     </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style=""> 465                     .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                              </span>
<span class="-3048945956628717740" onmouseenter="enter('-3048945956628717740');" onmouseout="out('-3048945956628717740');" style=""> 466                 rowData.addAll(rowDataMap.get(NO_PARTITION));                                            </span>
<span class="-5061257777486987691" onmouseenter="enter('-5061257777486987691');" onmouseout="out('-5061257777486987691');" style=""> 467                 String executeSql = tempSql.replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));       </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 468                 statement.execute(executeSql);                                                           </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style=""> 469                 rowData.clear();                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 470             } else {                                                                                     </span>
<span class="6613720697354939567" onmouseenter="enter('6613720697354939567');" onmouseout="out('6613720697354939567');" style=""> 471                 // partition sql                                                                         </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 472                 Set&lt;String&gt; keySet = rowDataMap.keySet();                                                </span>
<span class="5286500476222551862" onmouseenter="enter('5286500476222551862');" onmouseout="out('5286500476222551862');" style=""> 473                 for (String key : keySet) {                                                              </span>
<span class="2862511654232329090" onmouseenter="enter('2862511654232329090');" onmouseout="out('2862511654232329090');" style=""> 474                     rowData.addAll(rowDataMap.get(key));                                                 </span>
<span class="3266960038838022824" onmouseenter="enter('3266960038838022824');" onmouseout="out('3266960038838022824');" style=""> 475                     partitionCondition.append(key);                                                      </span>
<span class="-8595336617081209901" onmouseenter="enter('-8595336617081209901');" onmouseout="out('-8595336617081209901');" style=""> 476                     tempSql = tempSql                                                                    </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style=""> 477                         .replace(PARTITION_CONDITION, partitionCondition.toString())                     </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style=""> 478                         .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                          </span>
<span class="8433888294385954668" onmouseenter="enter('8433888294385954668');" onmouseout="out('8433888294385954668');" style=""> 479                     String executeSql = tempSql                                                          </span>
<span class="-7707177917460131297" onmouseenter="enter('-7707177917460131297');" onmouseout="out('-7707177917460131297');" style=""> 480                         .replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));                          </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 481                     statement.execute(executeSql);                                                       </span>
<span class="-3000902343706299075" onmouseenter="enter('-3000902343706299075');" onmouseout="out('-3000902343706299075');" style=""> 482                     partitionCondition.delete(0, partitionCondition.length());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 485         } catch (Exception e) {                                                                          </span>
<span class="2735729731347220182" onmouseenter="enter('2735729731347220182');" onmouseout="out('2735729731347220182');" style=""> 486             if (e instanceof SQLException) {                                                             </span>
<span class="-4009259436355561175" onmouseenter="enter('-4009259436355561175');" onmouseout="out('-4009259436355561175');" style=""> 487                 dealBatchSqlError(rowData, connection, statement, tempSql);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 488             } else {                                                                                     </span>
<span class="1776368734984517953" onmouseenter="enter('1776368734984517953');" onmouseout="out('1776368734984517953');" style=""> 489                 throw new RuntimeException(&quot;Insert into impala error!&quot;, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 491         } finally {                                                                                      </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style=""> 492             rowData.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494     }                                                                                                    </span>
<span  style=""> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 496     /**                                                                                                  </span>
<span class="5187728543542090149" onmouseenter="enter('5187728543542090149');" onmouseout="out('5187728543542090149');" style=""> 497      * 当批量写入失败时，把批量的sql拆解为单条sql提交，对于单条写入的sql记做脏数据                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 498      *                                                                                                   </span>
<span class="-4511533979925052485" onmouseenter="enter('-4511533979925052485');" onmouseout="out('-4511533979925052485');" style=""> 499      * @param rowData 批量的values                                                                          </span>
<span class="-2225365195706675086" onmouseenter="enter('-2225365195706675086');" onmouseout="out('-2225365195706675086');" style=""> 500      * @param connection 当前数据库connect                                                                    </span>
<span class="-1332857843479914544" onmouseenter="enter('-1332857843479914544');" onmouseout="out('-1332857843479914544');" style=""> 501      * @param statement 当前statement                                                                      </span>
<span class="-5986970410224412108" onmouseenter="enter('-5986970410224412108');" onmouseout="out('-5986970410224412108');" style=""> 502      * @param templateSql 模版sql，例如insert into tableName(f1, f2, f3) [partition] values $valueCondition   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 503      */                                                                                                  </span>
<span class="-2268452263184113170" onmouseenter="enter('-2268452263184113170');" onmouseout="out('-2268452263184113170');" style=""> 504     private void dealBatchSqlError(List&lt;String&gt; rowData,                                                 </span>
<span class="6863083743086916101" onmouseenter="enter('6863083743086916101');" onmouseout="out('6863083743086916101');" style=""> 505                                    Connection connection,                                                </span>
<span class="5184541356270987154" onmouseenter="enter('5184541356270987154');" onmouseout="out('5184541356270987154');" style=""> 506                                    Statement statement,                                                  </span>
<span class="-3308663832752701650" onmouseenter="enter('-3308663832752701650');" onmouseout="out('-3308663832752701650');" style=""> 507                                    String templateSql) {                                                 </span>
<span class="-7725538089846589979" onmouseenter="enter('-7725538089846589979');" onmouseout="out('-7725538089846589979');" style=""> 508         String errorMsg = &quot;Insert into impala error. \nCause: [%s]\nRow: [%s]&quot;;                          </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 509         JDBCUtils.rollBack(connection);                                                                  </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 510         JDBCUtils.commit(connection);                                                                    </span>
<span class="-7816936101366912926" onmouseenter="enter('-7816936101366912926');" onmouseout="out('-7816936101366912926');" style=""> 511         for (String rowDatum : rowData) {                                                                </span>
<span class="-2842345043798651788" onmouseenter="enter('-2842345043798651788');" onmouseout="out('-2842345043798651788');" style=""> 512             String executeSql = templateSql.replace(VALUES_CONDITION, rowDatum);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 513             try {                                                                                        </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 514                 statement.execute(executeSql);                                                           </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 515                 JDBCUtils.commit(connection);                                                            </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 516             } catch (SQLException e) {                                                                   </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 517                 JDBCUtils.rollBack(connection);                                                          </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 518                 JDBCUtils.commit(connection);                                                            </span>
<span class="-4808081927273297919" onmouseenter="enter('-4808081927273297919');" onmouseout="out('-4808081927273297919');" style=""><abbr title=" 519                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {"> 519                 if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LO🔵</abbr></span>
<span class="-6393238717567631745" onmouseenter="enter('-6393238717567631745');" onmouseout="out('-6393238717567631745');" style=""> 520                     LOG.error(                                                                           </span>
<span class="-6108141239353831940" onmouseenter="enter('-6108141239353831940');" onmouseout="out('-6108141239353831940');" style=""> 521                         String.format(                                                                   </span>
<span class="-7558476617034981134" onmouseenter="enter('-7558476617034981134');" onmouseout="out('-7558476617034981134');" style=""> 522                             errorMsg,                                                                    </span>
<span class="-8675169859989204616" onmouseenter="enter('-8675169859989204616');" onmouseout="out('-8675169859989204616');" style=""> 523                             ExceptionTrace.traceOriginalCause(e),                                        </span>
<span class="-2790175153725866914" onmouseenter="enter('-2790175153725866914');" onmouseout="out('-2790175153725866914');" style=""> 524                             rowDatum)                                                                    </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 525                     );                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526                 }                                                                                        </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 527                 metricOutputFormat.outDirtyRecords.inc();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530     }                                                                                                    </span>
<span  style=""> 531                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 532     /**                                                                                                  </span>
<span class="-7756927092547658158" onmouseenter="enter('-7756927092547658158');" onmouseout="out('-7756927092547658158');" style=""> 533      * build partition condition with row data                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 534      *                                                                                                   </span>
<span class="3326420447531983720" onmouseenter="enter('3326420447531983720');" onmouseout="out('3326420447531983720');" style=""> 535      * @param rowData              row data                                                              </span>
<span class="-4527404320823727170" onmouseenter="enter('-4527404320823727170');" onmouseout="out('-4527404320823727170');" style=""> 536      * @param partitionFields      partition fields                                                      </span>
<span class="-1776173940247734574" onmouseenter="enter('-1776173940247734574');" onmouseout="out('-1776173940247734574');" style=""> 537      * @param staticPartitionField static partition fields                                               </span>
<span class="-1132708759906563110" onmouseenter="enter('-1132708759906563110');" onmouseout="out('-1132708759906563110');" style=""> 538      * @return condition like &#x27;(ptOne, ptTwo=v2)&#x27;                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 539      */                                                                                                  </span>
<span class="-3866187778893382496" onmouseenter="enter('-3866187778893382496');" onmouseout="out('-3866187778893382496');" style=""><abbr title=" 540     private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;String&gt; staticPartitionField) {"> 540     private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;Stri🔵</abbr></span>
<span class="1267423885187171547" onmouseenter="enter('1267423885187171547');" onmouseout="out('1267423885187171547');" style=""> 541         for (String key : staticPartitionField) {                                                        </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 542             StringBuilder sb = new StringBuilder();                                                      </span>
<span class="-5505398468694975344" onmouseenter="enter('-5505398468694975344');" onmouseout="out('-5505398468694975344');" style=""> 543             Object value = rowData.get(key);                                                             </span>
<span class="-3546349567435071552" onmouseenter="enter('-3546349567435071552');" onmouseout="out('-3546349567435071552');" style=""> 544             sb.append(key).append(&quot;=&quot;).append(value);                                                    </span>
<span class="7571464430142538701" onmouseenter="enter('7571464430142538701');" onmouseout="out('7571464430142538701');" style=""> 545             partitionFields = partitionFields.replace(&quot;${&quot; + key + &quot;}&quot;, sb.toString());                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546         }                                                                                                </span>
<span class="-6125585623196674116" onmouseenter="enter('-6125585623196674116');" onmouseout="out('-6125585623196674116');" style=""> 547         return &quot;(&quot; + partitionFields + &quot;)&quot;;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548     }                                                                                                    </span>
<span  style=""> 549                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 550     /**                                                                                                  </span>
<span class="1604816269765986224" onmouseenter="enter('1604816269765986224');" onmouseout="out('1604816269765986224');" style=""> 551      * build field condition according to field names                                                    </span>
<span class="-8005762898157210848" onmouseenter="enter('-8005762898157210848');" onmouseout="out('-8005762898157210848');" style=""> 552      * replace ${tableFieldCondition}                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 553      *                                                                                                   </span>
<span class="-3045974832751459167" onmouseenter="enter('-3045974832751459167');" onmouseout="out('-3045974832751459167');" style=""> 554      * @param fieldNames      the selected field names                                                   </span>
<span class="-2115580236801058408" onmouseenter="enter('-2115580236801058408');" onmouseout="out('-2115580236801058408');" style=""> 555      * @param partitionFields the partition fields                                                       </span>
<span class="-2587093228749928778" onmouseenter="enter('-2587093228749928778');" onmouseout="out('-2587093228749928778');" style=""> 556      * @return condition like &#x27;(id, name, age)&#x27;                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 557      */                                                                                                  </span>
<span class="-1478951256156574678" onmouseenter="enter('-1478951256156574678');" onmouseout="out('-1478951256156574678');" style=""> 558     private String buildTableFieldsCondition(List&lt;String&gt; fieldNames, String partitionFields) {          </span>
<span class="-8730756422155226372" onmouseenter="enter('-8730756422155226372');" onmouseout="out('-8730756422155226372');" style=""> 559         return &quot;(&quot; + fieldNames.stream()                                                                 </span>
<span class="-1124201215121024792" onmouseenter="enter('-1124201215121024792');" onmouseout="out('-1124201215121024792');" style=""> 560                 .filter(f -&gt; !partitionFields.contains(f))                                               </span>
<span class="4761076759122573536" onmouseenter="enter('4761076759122573536');" onmouseout="out('4761076759122573536');" style=""> 561                 .map(this::quoteIdentifier)                                                              </span>
<span class="-1385468130735042246" onmouseenter="enter('-1385468130735042246');" onmouseout="out('-1385468130735042246');" style=""> 562                 .collect(Collectors.joining(&quot;, &quot;)) + &quot;)&quot;;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563     }                                                                                                    </span>
<span  style=""> 564                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 565     /**                                                                                                  </span>
<span class="-1930125657620201419" onmouseenter="enter('-1930125657620201419');" onmouseout="out('-1930125657620201419');" style=""> 566      * according to field types, build the values condition                                              </span>
<span class="-5328431915012470826" onmouseenter="enter('-5328431915012470826');" onmouseout="out('-5328431915012470826');" style=""> 567      * replace ${valuesCondition}                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 568      *                                                                                                   </span>
<span class="889997534505017973" onmouseenter="enter('889997534505017973');" onmouseout="out('889997534505017973');" style=""> 569      * @param fieldTypes field types                                                                     </span>
<span class="-5325426707615499755" onmouseenter="enter('-5325426707615499755');" onmouseout="out('-5325426707615499755');" style=""> 570      * @return condition like &#x27;(?, ?, cast(&#x27;?&#x27; as string))&#x27; and &#x27;?&#x27; will be replaced with row data       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 571      */                                                                                                  </span>
<span class="-8753268388884688793" onmouseenter="enter('-8753268388884688793');" onmouseout="out('-8753268388884688793');" style=""> 572     private String buildValuesCondition(List&lt;String&gt; fieldTypes, Row row) {                              </span>
<span class="9451785702271217" onmouseenter="enter('9451785702271217');" onmouseout="out('9451785702271217');" style=""> 573         String valuesCondition = fieldTypes.stream().map(                                                </span>
<span class="-744834501831992668" onmouseenter="enter('-744834501831992668');" onmouseout="out('-744834501831992668');" style=""> 574                 f -&gt; {                                                                                   </span>
<span class="9071647551805886291" onmouseenter="enter('9071647551805886291');" onmouseout="out('9071647551805886291');" style=""> 575                     for (String item : NEED_QUOTE_TYPE) {                                                </span>
<span class="9108011392601680881" onmouseenter="enter('9108011392601680881');" onmouseout="out('9108011392601680881');" style=""> 576                         if (f.toLowerCase().contains(item)) {                                            </span>
<span class="2591906565241238134" onmouseenter="enter('2591906565241238134');" onmouseout="out('2591906565241238134');" style=""> 577                             return String.format(&quot;cast(&#x27;?&#x27; as %s)&quot;, f.toLowerCase());                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579                     }                                                                                    </span>
<span class="6027958975032523467" onmouseenter="enter('6027958975032523467');" onmouseout="out('6027958975032523467');" style=""> 580                     return &quot;?&quot;;                                                                          </span>
<span class="4654177507103038656" onmouseenter="enter('4654177507103038656');" onmouseout="out('4654177507103038656');" style=""> 581                 }).collect(Collectors.joining(&quot;, &quot;));                                                    </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 582         for (int i = 0; i &lt; row.getArity(); i++) {                                                       </span>
<span class="6605498463591237491" onmouseenter="enter('6605498463591237491');" onmouseout="out('6605498463591237491');" style=""> 583             Object rowField = row.getField(i);                                                           </span>
<span class="4211930808349437126" onmouseenter="enter('4211930808349437126');" onmouseout="out('4211930808349437126');" style=""> 584             if (DtStringUtil.isEmptyOrNull(rowField)) {                                                  </span>
<span class="2887641838186684159" onmouseenter="enter('2887641838186684159');" onmouseout="out('2887641838186684159');" style=""> 585                 valuesCondition = valuesCondition.replaceFirst(&quot;&#x27;\\?&#x27;&quot;, &quot;null&quot;);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 586             } else {                                                                                     </span>
<span class="6578353206956648527" onmouseenter="enter('6578353206956648527');" onmouseout="out('6578353206956648527');" style=""> 587                 valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, rowField.toString());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589         }                                                                                                </span>
<span class="7254264812767145915" onmouseenter="enter('7254264812767145915');" onmouseout="out('7254264812767145915');" style=""> 590         return &quot;(&quot; + valuesCondition + &quot;)&quot;;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591     }                                                                                                    </span>
<span  style=""> 592                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 593     /**                                                                                                  </span>
<span class="2218542669560141576" onmouseenter="enter('2218542669560141576');" onmouseout="out('2218542669560141576');" style=""> 594      * impala update mode SQL                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 595      *                                                                                                   </span>
<span class="-8218292189476554358" onmouseenter="enter('-8218292189476554358');" onmouseout="out('-8218292189476554358');" style=""> 596      * @return UPDATE tableName SET setCondition WHERE whereCondition                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 597      */                                                                                                  </span>
<span class="-3752451701752547882" onmouseenter="enter('-3752451701752547882');" onmouseout="out('-3752451701752547882');" style=""><abbr title=" 598     private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; primaryKeys) {"> 598     private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; 🔵</abbr></span>
<span class="5528853464056789996" onmouseenter="enter('5528853464056789996');" onmouseout="out('5528853464056789996');" style=""> 599         //跳过primary key字段                                                                                </span>
<span class="-8857590287628770183" onmouseenter="enter('-8857590287628770183');" onmouseout="out('-8857590287628770183');" style=""> 600         String setClause = fieldNames.stream()                                                           </span>
<span class="-803297460241064625" onmouseenter="enter('-803297460241064625');" onmouseout="out('-803297460241064625');" style=""> 601                 .filter(f -&gt; !CollectionUtils.isNotEmpty(primaryKeys) || !primaryKeys.contains(f))       </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 602                 .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                     </span>
<span class="-209499088310020597" onmouseenter="enter('-209499088310020597');" onmouseout="out('-209499088310020597');" style=""> 603                 .collect(Collectors.joining(&quot;, &quot;));                                                      </span>
<span  style=""> 604                                                                                                          </span>
<span class="-3669556570443861667" onmouseenter="enter('-3669556570443861667');" onmouseout="out('-3669556570443861667');" style=""> 605         String conditionClause = primaryKeys.stream()                                                    </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 606                 .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                     </span>
<span class="1187060376059521362" onmouseenter="enter('1187060376059521362');" onmouseout="out('1187060376059521362');" style=""> 607                 .collect(Collectors.joining(&quot; AND &quot;));                                                   </span>
<span  style=""> 608                                                                                                          </span>
<span class="-880277003185331688" onmouseenter="enter('-880277003185331688');" onmouseout="out('-880277003185331688');" style=""> 609         return &quot;UPDATE &quot; + (Objects.isNull(schema) ? &quot;&quot; : quoteIdentifier(schema) + &quot;.&quot;)                 </span>
<span class="-2776062363149844820" onmouseenter="enter('-2776062363149844820');" onmouseout="out('-2776062363149844820');" style=""> 610                 + quoteIdentifier(tableName) + &quot; SET &quot; + setClause + &quot; WHERE &quot; + conditionClause;        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 611     }                                                                                                    </span>
<span  style=""> 612                                                                                                          </span>
<span class="4659511982989745103" onmouseenter="enter('4659511982989745103');" onmouseout="out('4659511982989745103');" style=""> 613     private String quoteIdentifier(String identifier) {                                                  </span>
<span class="1935684454964464658" onmouseenter="enter('1935684454964464658');" onmouseout="out('1935684454964464658');" style=""> 614         return &quot;`&quot; + identifier + &quot;`&quot;;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615     }                                                                                                    </span>
<span  style=""> 616                                                                                                          </span>
<span class="-2481914402933088399" onmouseenter="enter('-2481914402933088399');" onmouseout="out('-2481914402933088399');" style=""> 617     public static Builder getImpalaBuilder() {                                                           </span>
<span class="-1926211775479526780" onmouseenter="enter('-1926211775479526780');" onmouseout="out('-1926211775479526780');" style=""> 618         return new Builder();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619     }                                                                                                    </span>
<span  style=""> 620                                                                                                          </span>
<span class="2010609695383714647" onmouseenter="enter('2010609695383714647');" onmouseout="out('2010609695383714647');" style=""> 621     public static class Builder {                                                                        </span>
<span class="5030308014750517924" onmouseenter="enter('5030308014750517924');" onmouseout="out('5030308014750517924');" style=""> 622         private final ImpalaOutputFormat format = new ImpalaOutputFormat();                              </span>
<span  style=""> 623                                                                                                          </span>
<span class="4847669250945231235" onmouseenter="enter('4847669250945231235');" onmouseout="out('4847669250945231235');" style=""> 624         public Builder setDbUrl(String dbUrl) {                                                          </span>
<span class="-7007213682983262515" onmouseenter="enter('-7007213682983262515');" onmouseout="out('-7007213682983262515');" style=""> 625             format.dbUrl = dbUrl;                                                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 626             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627         }                                                                                                </span>
<span  style=""> 628                                                                                                          </span>
<span class="-2062625403058053727" onmouseenter="enter('-2062625403058053727');" onmouseout="out('-2062625403058053727');" style=""> 629         public Builder setUserName(String userName) {                                                    </span>
<span class="8996094991043959374" onmouseenter="enter('8996094991043959374');" onmouseout="out('8996094991043959374');" style=""> 630             format.userName = userName;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 631             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632         }                                                                                                </span>
<span  style=""> 633                                                                                                          </span>
<span class="-8917696572465338538" onmouseenter="enter('-8917696572465338538');" onmouseout="out('-8917696572465338538');" style=""> 634         public Builder setPassword(String password) {                                                    </span>
<span class="-5617852808102302847" onmouseenter="enter('-5617852808102302847');" onmouseout="out('-5617852808102302847');" style=""> 635             format.password = password;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 636             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637         }                                                                                                </span>
<span  style=""> 638                                                                                                          </span>
<span class="-6851628607924303336" onmouseenter="enter('-6851628607924303336');" onmouseout="out('-6851628607924303336');" style=""> 639         public Builder setBatchSize(Integer batchSize) {                                                 </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 640             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 641             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642         }                                                                                                </span>
<span  style=""> 643                                                                                                          </span>
<span class="5791410845050671235" onmouseenter="enter('5791410845050671235');" onmouseout="out('5791410845050671235');" style=""> 644         public Builder setBatchWaitInterval(Long batchWaitInterval) {                                    </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 645             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 646             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647         }                                                                                                </span>
<span  style=""> 648                                                                                                          </span>
<span class="-8777589626278372083" onmouseenter="enter('-8777589626278372083');" onmouseout="out('-8777589626278372083');" style=""> 649         public Builder setTableName(String tableName) {                                                  </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 650             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 651             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652         }                                                                                                </span>
<span  style=""> 653                                                                                                          </span>
<span class="221724127870954269" onmouseenter="enter('221724127870954269');" onmouseout="out('221724127870954269');" style=""> 654         public Builder setPartitionFields(String partitionFields) {                                      </span>
<span class="-8055214001591864073" onmouseenter="enter('-8055214001591864073');" onmouseout="out('-8055214001591864073');" style=""> 655             format.partitionFields = Objects.isNull(partitionFields) ?                                   </span>
<span class="6173943982789028324" onmouseenter="enter('6173943982789028324');" onmouseout="out('6173943982789028324');" style=""> 656                     &quot;&quot; : partitionFields;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 657             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658         }                                                                                                </span>
<span  style=""> 659                                                                                                          </span>
<span class="-6994787811007556212" onmouseenter="enter('-6994787811007556212');" onmouseout="out('-6994787811007556212');" style=""> 660         public Builder setPrimaryKeys(List&lt;String&gt; primaryKeys) {                                        </span>
<span class="1909693990286542032" onmouseenter="enter('1909693990286542032');" onmouseout="out('1909693990286542032');" style=""> 661             format.primaryKeys = primaryKeys;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 662             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663         }                                                                                                </span>
<span  style=""> 664                                                                                                          </span>
<span class="7512351963685249159" onmouseenter="enter('7512351963685249159');" onmouseout="out('7512351963685249159');" style=""> 665         public Builder setSchema(String schema) {                                                        </span>
<span class="306599522236782764" onmouseenter="enter('306599522236782764');" onmouseout="out('306599522236782764');" style=""> 666             format.schema = schema;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 667             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668         }                                                                                                </span>
<span  style=""> 669                                                                                                          </span>
<span class="4541611662116992338" onmouseenter="enter('4541611662116992338');" onmouseout="out('4541611662116992338');" style=""> 670         public Builder setEnablePartition(Boolean enablePartition) {                                     </span>
<span class="-6976631596761488792" onmouseenter="enter('-6976631596761488792');" onmouseout="out('-6976631596761488792');" style=""> 671             format.enablePartition = enablePartition;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 672             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 673         }                                                                                                </span>
<span  style=""> 674                                                                                                          </span>
<span class="-8865383825618932145" onmouseenter="enter('-8865383825618932145');" onmouseout="out('-8865383825618932145');" style=""> 675         public Builder setUpdateMode(String updateMode) {                                                </span>
<span class="-2281017119849044621" onmouseenter="enter('-2281017119849044621');" onmouseout="out('-2281017119849044621');" style=""> 676             format.updateMode = updateMode;                                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 677             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678         }                                                                                                </span>
<span  style=""> 679                                                                                                          </span>
<span class="8081013001489210313" onmouseenter="enter('8081013001489210313');" onmouseout="out('8081013001489210313');" style=""> 680         public Builder setFieldList(List&lt;String&gt; fieldList) {                                            </span>
<span class="-818074055946993480" onmouseenter="enter('-818074055946993480');" onmouseout="out('-818074055946993480');" style=""> 681             format.fieldNames = fieldList;                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 682             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683         }                                                                                                </span>
<span  style=""> 684                                                                                                          </span>
<span class="3974737416393184735" onmouseenter="enter('3974737416393184735');" onmouseout="out('3974737416393184735');" style=""> 685         public Builder setFieldTypeList(List&lt;String&gt; fieldTypeList) {                                    </span>
<span class="1448747188656744713" onmouseenter="enter('1448747188656744713');" onmouseout="out('1448747188656744713');" style=""> 686             format.fieldTypes = fieldTypeList;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 687             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 688         }                                                                                                </span>
<span  style=""> 689                                                                                                          </span>
<span class="2244927175574628655" onmouseenter="enter('2244927175574628655');" onmouseout="out('2244927175574628655');" style=""> 690         public Builder setStoreType(String storeType) {                                                  </span>
<span class="-5818885152026709969" onmouseenter="enter('-5818885152026709969');" onmouseout="out('-5818885152026709969');" style=""> 691             format.storeType = storeType;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 692             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693         }                                                                                                </span>
<span  style=""> 694                                                                                                          </span>
<span class="-5487489987508961941" onmouseenter="enter('-5487489987508961941');" onmouseout="out('-5487489987508961941');" style=""> 695         public Builder setFieldExtraInfoList(List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList) {</span>
<span class="160167467316759360" onmouseenter="enter('160167467316759360');" onmouseout="out('160167467316759360');" style=""> 696             format.fieldExtraInfoList = fieldExtraInfoList;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 697             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698         }                                                                                                </span>
<span  style=""> 699                                                                                                          </span>
<span class="1366044936846496088" onmouseenter="enter('1366044936846496088');" onmouseout="out('1366044936846496088');" style=""> 700         public Builder setKeyTabPath(String keyTabPath) {                                                </span>
<span class="8755357456701014681" onmouseenter="enter('8755357456701014681');" onmouseout="out('8755357456701014681');" style=""> 701             format.keytabPath = keyTabPath;                                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 702             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703         }                                                                                                </span>
<span  style=""> 704                                                                                                          </span>
<span class="1807007964631867819" onmouseenter="enter('1807007964631867819');" onmouseout="out('1807007964631867819');" style=""> 705         public Builder setKrb5ConfPath(String krb5ConfPath) {                                            </span>
<span class="352337563234497723" onmouseenter="enter('352337563234497723');" onmouseout="out('352337563234497723');" style=""> 706             format.krb5confPath = krb5ConfPath;                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 707             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 708         }                                                                                                </span>
<span  style=""> 709                                                                                                          </span>
<span class="-8540538228750165144" onmouseenter="enter('-8540538228750165144');" onmouseout="out('-8540538228750165144');" style=""> 710         public Builder setPrincipal(String principal) {                                                  </span>
<span class="6894839552978791309" onmouseenter="enter('6894839552978791309');" onmouseout="out('6894839552978791309');" style=""> 711             format.principal = principal;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 712             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713         }                                                                                                </span>
<span  style=""> 714                                                                                                          </span>
<span class="-8991908924314829739" onmouseenter="enter('-8991908924314829739');" onmouseout="out('-8991908924314829739');" style=""> 715         public Builder setAuthMech(Integer authMech) {                                                   </span>
<span class="-1412915325814520049" onmouseenter="enter('-1412915325814520049');" onmouseout="out('-1412915325814520049');" style=""> 716             format.authMech = authMech;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 717             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718         }                                                                                                </span>
<span  style=""> 719                                                                                                          </span>
<span class="1564959121680510141" onmouseenter="enter('1564959121680510141');" onmouseout="out('1564959121680510141');" style=""> 720         private boolean canHandle(String url) {                                                          </span>
<span class="842511305287615009" onmouseenter="enter('842511305287615009');" onmouseout="out('842511305287615009');" style=""> 721             return url.startsWith(&quot;jdbc:impala:&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 722         }                                                                                                </span>
<span  style=""> 723                                                                                                          </span>
<span class="-8521575333201954447" onmouseenter="enter('-8521575333201954447');" onmouseout="out('-8521575333201954447');" style=""> 724         public ImpalaOutputFormat build() {                                                              </span>
<span class="1659683170431033048" onmouseenter="enter('1659683170431033048');" onmouseout="out('1659683170431033048');" style=""> 725             if (!canHandle(format.dbUrl)) {                                                              </span>
<span class="-4870909491096243891" onmouseenter="enter('-4870909491096243891');" onmouseout="out('-4870909491096243891');" style=""><abbr title=" 726                 throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl);"> 726                 throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727             }                                                                                            </span>
<span  style=""> 728                                                                                                          </span>
<span class="-4505121258189477360" onmouseenter="enter('-4505121258189477360');" onmouseout="out('-4505121258189477360');" style=""> 729             if (format.authMech == EAuthMech.Kerberos.getType()) {                                       </span>
<span class="-6183848778016991336" onmouseenter="enter('-6183848778016991336');" onmouseout="out('-6183848778016991336');" style=""> 730                 checkNotNull(format.krb5confPath,                                                        </span>
<span class="-4038272028328025626" onmouseenter="enter('-4038272028328025626');" onmouseout="out('-4038272028328025626');" style=""> 731                         &quot;When kerberos authentication is enabled, krb5confPath is required！&quot;);           </span>
<span class="-1753032521002756428" onmouseenter="enter('-1753032521002756428');" onmouseout="out('-1753032521002756428');" style=""> 732                 checkNotNull(format.principal,                                                           </span>
<span class="-5219129049333790569" onmouseenter="enter('-5219129049333790569');" onmouseout="out('-5219129049333790569');" style=""> 733                         &quot;When kerberos authentication is enabled, principal is required！&quot;);              </span>
<span class="-3070330065691611476" onmouseenter="enter('-3070330065691611476');" onmouseout="out('-3070330065691611476');" style=""> 734                 checkNotNull(format.keytabPath,                                                          </span>
<span class="-393994981289522477" onmouseenter="enter('-393994981289522477');" onmouseout="out('-393994981289522477');" style=""> 735                         &quot;When kerberos authentication is enabled, keytabPath is required！&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736             }                                                                                            </span>
<span  style=""> 737                                                                                                          </span>
<span class="-5111581416826137591" onmouseenter="enter('-5111581416826137591');" onmouseout="out('-5111581416826137591');" style=""> 738             if (format.authMech == EAuthMech.UserName.getType()) {                                       </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 739                 checkNotNull(format.userName, &quot;userName is required!&quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740             }                                                                                            </span>
<span  style=""> 741                                                                                                          </span>
<span class="-3238564706659558925" onmouseenter="enter('-3238564706659558925');" onmouseout="out('-3238564706659558925');" style=""> 742             if (format.authMech == EAuthMech.NameANDPassword.getType()) {                                </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 743                 checkNotNull(format.userName, &quot;userName is required!&quot;);                                  </span>
<span class="-9040493906648204146" onmouseenter="enter('-9040493906648204146');" onmouseout="out('-9040493906648204146');" style=""> 744                 checkNotNull(format.password, &quot;password is required!&quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 745             }                                                                                            </span>
<span  style=""> 746                                                                                                          </span>
<span class="1310568763423505425" onmouseenter="enter('1310568763423505425');" onmouseout="out('1310568763423505425');" style=""> 747             checkNotNull(format.storeType, &quot;storeType is required!&quot;);                                    </span>
<span  style=""> 748                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 749             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 752 }                                                                                                        </span>









</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-6349807778844055730" onmouseenter="enter('-6349807778844055730');" onmouseout="out('-6349807778844055730');" style="">  18 package com.dtstack.flink.sql.sink.impala;                                                               </span>
<span  style="">  19                                                                                                          </span>
<span class="1128057574573805325" onmouseenter="enter('1128057574573805325');" onmouseout="out('1128057574573805325');" style="">  20 import com.dtstack.flink.sql.classloader.ClassLoaderManager;                                             </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  21 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  22 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-8930056125403642162" onmouseenter="enter('-8930056125403642162');" onmouseout="out('-8930056125403642162');" style="">  24 import com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils;                                              </span>
<span class="-692023547870128618" onmouseenter="enter('-692023547870128618');" onmouseout="out('-692023547870128618');" style="">  25 import com.dtstack.flink.sql.table.AbstractTableInfo;                                                    </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="">  26 import com.dtstack.flink.sql.util.DtStringUtil;                                                          </span>
<span class="6538493847244355843" onmouseenter="enter('6538493847244355843');" onmouseout="out('6538493847244355843');" style="">  27 import com.dtstack.flink.sql.util.KrbUtils;                                                              </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  28 import com.google.common.collect.Maps;                                                                   </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  29 import java.io.IOException;                                                                              </span>
<span class="7889752473047782369" onmouseenter="enter('7889752473047782369');" onmouseout="out('7889752473047782369');" style="">  30 import java.security.PrivilegedExceptionAction;                                                          </span>
<span class="-7136330293413175449" onmouseenter="enter('-7136330293413175449');" onmouseout="out('-7136330293413175449');" style="">  31 import java.sql.Connection;                                                                              </span>
<span class="7894029524760905232" onmouseenter="enter('7894029524760905232');" onmouseout="out('7894029524760905232');" style="">  32 import java.sql.DriverManager;                                                                           </span>
<span class="-3337023324264694028" onmouseenter="enter('-3337023324264694028');" onmouseout="out('-3337023324264694028');" style="">  33 import java.sql.PreparedStatement;                                                                       </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  34 import java.sql.SQLException;                                                                            </span>
<span class="6402527026259660908" onmouseenter="enter('6402527026259660908');" onmouseout="out('6402527026259660908');" style="">  35 import java.sql.Statement;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  36 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  37 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  39 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  40 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  41 import java.util.Set;                                                                                    </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  42 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  43 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  44 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  45 import java.util.concurrent.TimeUnit;                                                                    </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  46 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  47 import java.util.regex.Pattern;                                                                          </span>
<span class="-6051894930872477589" onmouseenter="enter('-6051894930872477589');" onmouseout="out('-6051894930872477589');" style="">  48 import java.util.stream.Collectors;                                                                      </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  49 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  50 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  51 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  52 import org.apache.flink.types.Row;                                                                       </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  53 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  54 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  55 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="1455633447019431220" onmouseenter="enter('1455633447019431220');" onmouseout="out('1455633447019431220');" style="">  56 import static com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils.setRecordToStatement;                  </span>
<span class="-6257877604578820371" onmouseenter="enter('-6257877604578820371');" onmouseout="out('-6257877604578820371');" style="">  57 import static org.apache.flink.util.Preconditions.checkNotNull;                                          </span>
<span  style="">  58                                                                                                          </span>
<span  style="">  59                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  60 /**                                                                                                      </span>
<span class="7153001641478282104" onmouseenter="enter('7153001641478282104');" onmouseout="out('7153001641478282104');" style="">  61  * Date: 2020/10/14                                                                                      </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  62  * Company: www.dtstack.com                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  63  *                                                                                                       </span>
<span class="-4100502199450942834" onmouseenter="enter('-4100502199450942834');" onmouseout="out('-4100502199450942834');" style="">  64  * @author tiezhu                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  65  */                                                                                                      </span>
<span class="-4121149390422149560" onmouseenter="enter('-4121149390422149560');" onmouseout="out('-4121149390422149560');" style="">  66 public class ImpalaOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {               </span>
<span class="-5870848474790717720" onmouseenter="enter('-5870848474790717720');" onmouseout="out('-5870848474790717720');" style="">  67     private static final Logger LOG = LoggerFactory.getLogger(ImpalaOutputFormat.class);                 </span>
<span  style="">  68                                                                                                          </span>
<span class="-4645219268431852454" onmouseenter="enter('-4645219268431852454');" onmouseout="out('-4645219268431852454');" style="">  69     private static final long serialVersionUID = 1L;                                                     </span>
<span  style="">  70                                                                                                          </span>
<span class="-9068282285967712029" onmouseenter="enter('-9068282285967712029');" onmouseout="out('-9068282285967712029');" style="">  71     // ${field}                                                                                          </span>
<span class="-9068282285967712029" onmouseenter="enter('-9068282285967712029');" onmouseout="out('-9068282285967712029');" style="">  72     // ${field}                                                                                          </span>
<span class="-5949646080202310183" onmouseenter="enter('-5949646080202310183');" onmouseout="out('-5949646080202310183');" style="">  73     private static final Pattern STATIC_PARTITION_PATTERN = Pattern.compile(&quot;\\$\\{([^}]*)}&quot;);           </span>
<span  style="">  74                                                                                                          </span>
<span class="-7138373001176335296" onmouseenter="enter('-7138373001176335296');" onmouseout="out('-7138373001176335296');" style="">  75     // specific type which values need to be quoted                                                      </span>
<span class="-3819896996042674452" onmouseenter="enter('-3819896996042674452');" onmouseout="out('-3819896996042674452');" style=""><abbr title="  76     private static final String[] NEED_QUOTE_TYPE = new java.lang.String[]{ &quot;string&quot;, &quot;timestamp&quot;, &quot;varchar&quot; };">  76     private static final String[] NEED_QUOTE_TYPE = new java.lang.String[]{ &quot;string&quot;, &quot;timestamp&quot;, &quot;varch🔵</abbr></span>
<span  style="">  77                                                                                                          </span>
<span class="191207487610103693" onmouseenter="enter('191207487610103693');" onmouseout="out('191207487610103693');" style="">  78     private static final Integer DEFAULT_CONN_TIME_OUT = 60;                                             </span>
<span  style="">  79                                                                                                          </span>
<span class="-1388186840411616756" onmouseenter="enter('-1388186840411616756');" onmouseout="out('-1388186840411616756');" style="">  80     private static final int RECEIVE_DATA_PRINT_FREQUENCY = 1000;                                        </span>
<span  style="">  81                                                                                                          </span>
<span class="-4268888009857984730" onmouseenter="enter('-4268888009857984730');" onmouseout="out('-4268888009857984730');" style="">  82     private static final int DIRTY_DATA_PRINT_FREQUENCY = 1000;                                          </span>
<span  style="">  83                                                                                                          </span>
<span class="-588818051573867979" onmouseenter="enter('-588818051573867979');" onmouseout="out('-588818051573867979');" style="">  84     private static final String KUDU_TYPE = &quot;kudu&quot;;                                                      </span>
<span  style="">  85                                                                                                          </span>
<span class="-6769623881035360393" onmouseenter="enter('-6769623881035360393');" onmouseout="out('-6769623881035360393');" style="">  86     private static final String UPDATE_MODE = &quot;update&quot;;                                                  </span>
<span  style="">  87                                                                                                          </span>
<span class="-7709014261424944614" onmouseenter="enter('-7709014261424944614');" onmouseout="out('-7709014261424944614');" style="">  88     private static final String PARTITION_CONSTANT = &quot;PARTITION&quot;;                                        </span>
<span  style="">  89                                                                                                          </span>
<span class="1441081326157561113" onmouseenter="enter('1441081326157561113');" onmouseout="out('1441081326157561113');" style="">  90     private static final String DRIVER_NAME = &quot;com.cloudera.impala.jdbc41.Driver&quot;;                       </span>
<span  style="">  91                                                                                                          </span>
<span class="-2689163518074835497" onmouseenter="enter('-2689163518074835497');" onmouseout="out('-2689163518074835497');" style="">  92     private static final String VALUES_CONDITION = &quot;${valuesCondition}&quot;;                                 </span>
<span  style="">  93                                                                                                          </span>
<span class="3062777246713899037" onmouseenter="enter('3062777246713899037');" onmouseout="out('3062777246713899037');" style="">  94     private static final String PARTITION_CONDITION = &quot;${partitionCondition}&quot;;                           </span>
<span  style="">  95                                                                                                          </span>
<span class="2401236240707522557" onmouseenter="enter('2401236240707522557');" onmouseout="out('2401236240707522557');" style="">  96     private static final String TABLE_FIELDS_CONDITION = &quot;${tableFieldsCondition}&quot;;                      </span>
<span  style="">  97                                                                                                          </span>
<span class="3255739684264436552" onmouseenter="enter('3255739684264436552');" onmouseout="out('3255739684264436552');" style="">  98     private static final String NO_PARTITION = &quot;noPartition&quot;;                                            </span>
<span  style="">  99                                                                                                          </span>
<span class="-2123205835999557493" onmouseenter="enter('-2123205835999557493');" onmouseout="out('-2123205835999557493');" style=""> 100     // partition field of static partition which matched by ${field}                                     </span>
<span class="-2123205835999557493" onmouseenter="enter('-2123205835999557493');" onmouseout="out('-2123205835999557493');" style=""> 101     // partition field of static partition which matched by ${field}                                     </span>
<span class="-976040292573398488" onmouseenter="enter('-976040292573398488');" onmouseout="out('-976040292573398488');" style=""> 102     private final List&lt;String&gt; staticPartitionFields = new ArrayList&lt;&gt;();                                </span>
<span  style=""> 103                                                                                                          </span>
<span class="8729932671243795004" onmouseenter="enter('8729932671243795004');" onmouseout="out('8729932671243795004');" style=""> 104     public List&lt;String&gt; fieldNames;                                                                      </span>
<span  style=""> 105                                                                                                          </span>
<span class="5323664213258183290" onmouseenter="enter('5323664213258183290');" onmouseout="out('5323664213258183290');" style=""> 106     public List&lt;String&gt; fieldTypes;                                                                      </span>
<span  style=""> 107                                                                                                          </span>
<span class="589573262942162938" onmouseenter="enter('589573262942162938');" onmouseout="out('589573262942162938');" style=""> 108     public List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList;                                    </span>
<span  style=""> 109                                                                                                          </span>
<span class="-7445073777200404714" onmouseenter="enter('-7445073777200404714');" onmouseout="out('-7445073777200404714');" style=""> 110     protected transient Connection connection;                                                           </span>
<span  style=""> 111                                                                                                          </span>
<span class="-2184169902108079684" onmouseenter="enter('-2184169902108079684');" onmouseout="out('-2184169902108079684');" style=""> 112     protected transient Statement statement;                                                             </span>
<span  style=""> 113                                                                                                          </span>
<span class="6238382839663594696" onmouseenter="enter('6238382839663594696');" onmouseout="out('6238382839663594696');" style=""> 114     protected transient PreparedStatement updateStatement;                                               </span>
<span  style=""> 115                                                                                                          </span>
<span class="-4172535577750872346" onmouseenter="enter('-4172535577750872346');" onmouseout="out('-4172535577750872346');" style=""> 116     protected String keytabPath;                                                                         </span>
<span  style=""> 117                                                                                                          </span>
<span class="1987487277257130103" onmouseenter="enter('1987487277257130103');" onmouseout="out('1987487277257130103');" style=""> 118     protected String krb5confPath;                                                                       </span>
<span  style=""> 119                                                                                                          </span>
<span class="3478885111338451838" onmouseenter="enter('3478885111338451838');" onmouseout="out('3478885111338451838');" style=""> 120     protected String principal;                                                                          </span>
<span  style=""> 121                                                                                                          </span>
<span class="-2673327721248325609" onmouseenter="enter('-2673327721248325609');" onmouseout="out('-2673327721248325609');" style=""> 122     protected Integer authMech;                                                                          </span>
<span  style=""> 123                                                                                                          </span>
<span class="-8834882937031238604" onmouseenter="enter('-8834882937031238604');" onmouseout="out('-8834882937031238604');" style=""> 124     protected String dbUrl;                                                                              </span>
<span  style=""> 125                                                                                                          </span>
<span class="4348689613054045460" onmouseenter="enter('4348689613054045460');" onmouseout="out('4348689613054045460');" style=""> 126     protected String userName;                                                                           </span>
<span  style=""> 127                                                                                                          </span>
<span class="519247125889688558" onmouseenter="enter('519247125889688558');" onmouseout="out('519247125889688558');" style=""> 128     protected String password;                                                                           </span>
<span  style=""> 129                                                                                                          </span>
<span class="-7554929939288236010" onmouseenter="enter('-7554929939288236010');" onmouseout="out('-7554929939288236010');" style=""> 130     protected int batchSize = 100;                                                                       </span>
<span  style=""> 131                                                                                                          </span>
<span class="8848445520039039194" onmouseenter="enter('8848445520039039194');" onmouseout="out('8848445520039039194');" style=""> 132     protected long batchWaitInterval = 60 * 1000L;                                                       </span>
<span  style=""> 133                                                                                                          </span>
<span class="6924126392600265325" onmouseenter="enter('6924126392600265325');" onmouseout="out('6924126392600265325');" style=""> 134     protected String tableName;                                                                          </span>
<span  style=""> 135                                                                                                          </span>
<span class="-8067881189136281922" onmouseenter="enter('-8067881189136281922');" onmouseout="out('-8067881189136281922');" style=""> 136     protected List&lt;String&gt; primaryKeys;                                                                  </span>
<span  style=""> 137                                                                                                          </span>
<span class="-1238809985534246985" onmouseenter="enter('-1238809985534246985');" onmouseout="out('-1238809985534246985');" style=""> 138     protected String partitionFields;                                                                    </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2843446813182919439" onmouseenter="enter('-2843446813182919439');" onmouseout="out('-2843446813182919439');" style=""> 140     protected Boolean enablePartition;                                                                   </span>
<span  style=""> 141                                                                                                          </span>
<span class="3349082107931708476" onmouseenter="enter('3349082107931708476');" onmouseout="out('3349082107931708476');" style=""> 142     protected String schema;                                                                             </span>
<span  style=""> 143                                                                                                          </span>
<span class="-2869920961807604939" onmouseenter="enter('-2869920961807604939');" onmouseout="out('-2869920961807604939');" style=""> 144     protected String storeType;                                                                          </span>
<span  style=""> 145                                                                                                          </span>
<span class="-7730622042083062639" onmouseenter="enter('-7730622042083062639');" onmouseout="out('-7730622042083062639');" style=""> 146     protected String updateMode;                                                                         </span>
<span  style=""> 147                                                                                                          </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style=""> 148     private transient volatile boolean closed = false;                                                   </span>
<span  style=""> 149                                                                                                          </span>
<span class="8220840984571392918" onmouseenter="enter('8220840984571392918');" onmouseout="out('8220840984571392918');" style=""> 150     private int batchCount = 0;                                                                          </span>
<span  style=""> 151                                                                                                          </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 152     // |------------------------------------------------|                                                </span>
<span class="-789927222958732888" onmouseenter="enter('-789927222958732888');" onmouseout="out('-789927222958732888');" style=""> 153     // |   partitionCondition   |Array of valueCondition|                                                </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 154     // |------------------------------------------------|                                                </span>
<span class="-8825804998995953162" onmouseenter="enter('-8825804998995953162');" onmouseout="out('-8825804998995953162');" style=""> 155     // | ptOne, ptTwo, ptThree  | [(v1, v2, v3, v4, v5)]|   DP                                           </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 156     // |------------------------------------------------|                                                </span>
<span class="-5802382310877164118" onmouseenter="enter('-5802382310877164118');" onmouseout="out('-5802382310877164118');" style=""> 157     // | ptOne = v1, ptTwo = v2 | [(v3, v4, v5)]        |   SP                                           </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 158     // |------------------------------------------------|                                                </span>
<span class="2984234039288316275" onmouseenter="enter('2984234039288316275');" onmouseout="out('2984234039288316275');" style=""> 159     // | ptOne, ptTwo = v2      | [(v1, v3, v4, v5)]    |   DP and SP                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 160     // |------------------------------------------------|                                                </span>
<span class="7219405512764117222" onmouseenter="enter('7219405512764117222');" onmouseout="out('7219405512764117222');" style=""> 161     // | noPartition            | [(v1, v2, v3, v4, v5)]|   kudu or disablePartition                     </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 162     // |------------------------------------------------|                                                </span>
<span class="9020411500856357590" onmouseenter="enter('9020411500856357590');" onmouseout="out('9020411500856357590');" style=""> 163     private transient Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap;                                         </span>
<span  style=""> 164                                                                                                          </span>
<span class="8461763253073029471" onmouseenter="enter('8461763253073029471');" onmouseout="out('8461763253073029471');" style=""> 165     // valueFieldsName -&gt; 重组之后的fieldNames，为了重组row data字段值对应                                              </span>
<span class="-5473349939362349748" onmouseenter="enter('-5473349939362349748');" onmouseout="out('-5473349939362349748');" style=""> 166     // 需要对partition字段做特殊处理，比如原来的字段顺序为(age, name, id)，但是因为partition，写入的SQL为                               </span>
<span class="888010466316090175" onmouseenter="enter('888010466316090175');" onmouseout="out('888010466316090175');" style=""> 167     // INSERT INTO tableName(name, id) PARTITION(age) VALUES(?, ?, ?)                                    </span>
<span class="1229277488566704041" onmouseenter="enter('1229277488566704041');" onmouseout="out('1229277488566704041');" style=""> 168     // 那么实际executeSql设置字段的顺序应该为(name, id, age)，同时，字段对应的type顺序也需要重组                                       </span>
<span class="6098973354216055964" onmouseenter="enter('6098973354216055964');" onmouseout="out('6098973354216055964');" style=""> 169     private List&lt;String&gt; valueFieldNames;                                                                </span>
<span  style=""> 170                                                                                                          </span>
<span class="-7108089166418781511" onmouseenter="enter('-7108089166418781511');" onmouseout="out('-7108089166418781511');" style=""> 171     private transient AbstractDtRichOutputFormat&lt;?&gt; metricOutputFormat;                                  </span>
<span  style=""> 172                                                                                                          </span>
<span class="273368026714901275" onmouseenter="enter('273368026714901275');" onmouseout="out('273368026714901275');" style=""> 173     private List&lt;Row&gt; rows;                                                                              </span>
<span  style=""> 174                                                                                                          </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style=""> 175     private transient ScheduledExecutorService scheduler;                                                </span>
<span  style=""> 176                                                                                                          </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style=""> 177     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style=""> 178                                                                                                          </span>
<span class="-2481914402933088399" onmouseenter="enter('-2481914402933088399');" onmouseout="out('-2481914402933088399');" style=""> 179     public static Builder getImpalaBuilder() {                                                           </span>
<span class="-1926211775479526780" onmouseenter="enter('-1926211775479526780');" onmouseout="out('-1926211775479526780');" style=""> 180         return new Builder();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181     }                                                                                                    </span>
<span  style=""> 182                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 183     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 184     public void configure(Configuration parameters) {                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185     }                                                                                                    </span>
<span  style=""> 186                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 187     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 188     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 189         try {                                                                                            </span>
<span class="4324779626821739975" onmouseenter="enter('4324779626821739975');" onmouseout="out('4324779626821739975');" style=""> 190             rowDataMap = new HashMap&lt;&gt;();                                                                </span>
<span class="-6551372933934183741" onmouseenter="enter('-6551372933934183741');" onmouseout="out('-6551372933934183741');" style=""> 191             rows = new ArrayList&lt;&gt;();                                                                    </span>
<span class="-7937337195293668220" onmouseenter="enter('-7937337195293668220');" onmouseout="out('-7937337195293668220');" style=""> 192             metricOutputFormat = this;                                                                   </span>
<span class="-8035752082134444550" onmouseenter="enter('-8035752082134444550');" onmouseout="out('-8035752082134444550');" style=""> 193             openConnect();                                                                               </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 194             initScheduledTask(batchWaitInterval);                                                        </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style=""> 195             init();                                                                                      </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 196             initMetric();                                                                                </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 197         } catch (Exception e) {                                                                          </span>
<span class="-105883012207117402" onmouseenter="enter('-105883012207117402');" onmouseout="out('-105883012207117402');" style=""> 198             throw new RuntimeException(&quot;impala output format open error!&quot;, e);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200     }                                                                                                    </span>
<span  style=""> 201                                                                                                          </span>
<span class="-8578201295687943948" onmouseenter="enter('-8578201295687943948');" onmouseout="out('-8578201295687943948');" style=""> 202     private void init() throws SQLException {                                                            </span>
<span class="-8350145873279772804" onmouseenter="enter('-8350145873279772804');" onmouseout="out('-8350145873279772804');" style=""> 203         if (Objects.nonNull(partitionFields)) {                                                          </span>
<span class="8590422903839909721" onmouseenter="enter('8590422903839909721');" onmouseout="out('8590422903839909721');" style=""> 204             // match ${field} from partitionFields                                                       </span>
<span class="399614494149678967" onmouseenter="enter('399614494149678967');" onmouseout="out('399614494149678967');" style=""> 205             Matcher matcher = STATIC_PARTITION_PATTERN.matcher(partitionFields);                         </span>
<span class="-5488916631119752457" onmouseenter="enter('-5488916631119752457');" onmouseout="out('-5488916631119752457');" style=""> 206             while (matcher.find()) {                                                                     </span>
<span class="-1180668930060799754" onmouseenter="enter('-1180668930060799754');" onmouseout="out('-1180668930060799754');" style=""> 207                 LOG.info(&quot;find static partition field: {}&quot;, matcher.group(1));                           </span>
<span class="5933786634924389530" onmouseenter="enter('5933786634924389530');" onmouseout="out('5933786634924389530');" style=""> 208                 staticPartitionFields.add(matcher.group(1));                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210         }                                                                                                </span>
<span  style=""> 211                                                                                                          </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 212         if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                  </span>
<span class="-511688609314859464" onmouseenter="enter('-511688609314859464');" onmouseout="out('-511688609314859464');" style=""> 213             if (!storeType.equalsIgnoreCase(KUDU_TYPE)) {                                                </span>
<span class="7738691828431171650" onmouseenter="enter('7738691828431171650');" onmouseout="out('7738691828431171650');" style=""> 214                 throw new IllegalArgumentException(&quot;update mode not support for non-kudu table!&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215             }                                                                                            </span>
<span class="-1926567860735108753" onmouseenter="enter('-1926567860735108753');" onmouseout="out('-1926567860735108753');" style=""><abbr title=" 216             updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, primaryKeys));"> 216             updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, p🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 217         } else {                                                                                         </span>
<span class="5264299831364970974" onmouseenter="enter('5264299831364970974');" onmouseout="out('5264299831364970974');" style=""><abbr title=" 218             valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTypes, partitionFields);"> 218             valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTyp🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219         }                                                                                                </span>
<span  style=""> 220                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span  style=""> 222                                                                                                          </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 223     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 224         try {                                                                                            </span>
<span class="-5481453632006175071" onmouseenter="enter('-5481453632006175071');" onmouseout="out('-5481453632006175071');" style=""> 225             if (batchWaitInterval != 0) {                                                                </span>
<span class="4268939604870549239" onmouseenter="enter('4268939604870549239');" onmouseout="out('4268939604870549239');" style=""><abbr title=" 226                 this.scheduler = new ScheduledThreadPoolExecutor(1, new DTThreadFactory(&quot;impala-upsert-output-format&quot;));"> 226                 this.scheduler = new ScheduledThreadPoolExecutor(1, new DTThreadFactory(&quot;impala-upsert-ou🔵</abbr></span>
<span class="-7149116985444787635" onmouseenter="enter('-7149116985444787635');" onmouseout="out('-7149116985444787635');" style=""> 227                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(() -&gt; {                     </span>
<span class="2782390661741246227" onmouseenter="enter('2782390661741246227');" onmouseout="out('2782390661741246227');" style=""> 228                     synchronized(this) {                                                                 </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 229                         flush();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230                     }                                                                                    </span>
<span class="8465771028460365894" onmouseenter="enter('8465771028460365894');" onmouseout="out('8465771028460365894');" style=""> 231                 }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232             }                                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 233         } catch (java.lang.Exception e) {                                                                </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 234             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236     }                                                                                                    </span>
<span  style=""> 237                                                                                                          </span>
<span class="-2844613068709206340" onmouseenter="enter('-2844613068709206340');" onmouseout="out('-2844613068709206340');" style=""> 238     private void openConnect() throws IOException {                                                      </span>
<span class="-2394055578891206899" onmouseenter="enter('-2394055578891206899');" onmouseout="out('-2394055578891206899');" style=""> 239         if (authMech == 1) {                                                                             </span>
<span class="-7445609792053649263" onmouseenter="enter('-7445609792053649263');" onmouseout="out('-7445609792053649263');" style=""> 240             UserGroupInformation ugi = KrbUtils.loginAndReturnUgi(principal, keytabPath, krb5confPath);  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 241             try {                                                                                        </span>
<span class="1057249312142684394" onmouseenter="enter('1057249312142684394');" onmouseout="out('1057249312142684394');" style=""> 242                 ugi.doAs((PrivilegedExceptionAction&lt;Void&gt;) () -&gt; {                                       </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 243                     openJdbc();                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 244                     return null;                                                                         </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 245                 });                                                                                      </span>
<span class="3693318474890767753" onmouseenter="enter('3693318474890767753');" onmouseout="out('3693318474890767753');" style=""> 246             } catch (InterruptedException | IOException e) {                                             </span>
<span class="-3216725393010457363" onmouseenter="enter('-3216725393010457363');" onmouseout="out('-3216725393010457363');" style=""> 247                 throw new IllegalArgumentException(&quot;connect impala error!&quot;, e);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 249         } else {                                                                                         </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 250             openJdbc();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252     }                                                                                                    </span>
<span  style=""> 253                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 254     /**                                                                                                  </span>
<span class="-4019084214603833891" onmouseenter="enter('-4019084214603833891');" onmouseout="out('-4019084214603833891');" style=""> 255      * get jdbc connection                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 256      */                                                                                                  </span>
<span class="6517717324631316532" onmouseenter="enter('6517717324631316532');" onmouseout="out('6517717324631316532');" style=""> 257     private void openJdbc() {                                                                            </span>
<span class="7396081792504852616" onmouseenter="enter('7396081792504852616');" onmouseout="out('7396081792504852616');" style=""> 258         ClassLoaderManager.forName(DRIVER_NAME, getClass().getClassLoader());                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 259         try {                                                                                            </span>
<span class="-4188974437029144237" onmouseenter="enter('-4188974437029144237');" onmouseout="out('-4188974437029144237');" style=""> 260             connection = DriverManager.getConnection(dbUrl, userName, password);                         </span>
<span class="-3909190598463408725" onmouseenter="enter('-3909190598463408725');" onmouseout="out('-3909190598463408725');" style=""> 261             statement = connection.createStatement();                                                    </span>
<span class="1164602517684291637" onmouseenter="enter('1164602517684291637');" onmouseout="out('1164602517684291637');" style=""> 262             connection.setAutoCommit(false);                                                             </span>
<span class="-2037802754415730828" onmouseenter="enter('-2037802754415730828');" onmouseout="out('-2037802754415730828');" style=""> 263         } catch (SQLException sqlException) {                                                            </span>
<span class="8417232372887360387" onmouseenter="enter('8417232372887360387');" onmouseout="out('8417232372887360387');" style=""> 264             throw new RuntimeException(&quot;get impala jdbc connection failed!&quot;, sqlException);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266     }                                                                                                    </span>
<span  style=""> 267                                                                                                          </span>
<span class="4897761129654612880" onmouseenter="enter('4897761129654612880');" onmouseout="out('4897761129654612880');" style=""> 268     private synchronized void flush() {                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 269         try {                                                                                            </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 270             if (batchCount &gt; 0) {                                                                        </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 271                 if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                          </span>
<span class="-7210745719484505959" onmouseenter="enter('-7210745719484505959');" onmouseout="out('-7210745719484505959');" style=""> 272                     executeUpdateBatch();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                 }                                                                                        </span>
<span class="-5565980137871755476" onmouseenter="enter('-5565980137871755476');" onmouseout="out('-5565980137871755476');" style=""> 274                 if (!rowDataMap.isEmpty()) {                                                             </span>
<span class="-688569850648277758" onmouseenter="enter('-688569850648277758');" onmouseout="out('-688569850648277758');" style=""><abbr title=" 275                     String templateSql = &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VALUES ${valuesCondition}&quot;;"> 275                     String templateSql = &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${parti🔵</abbr></span>
<span class="-7483445949807957179" onmouseenter="enter('-7483445949807957179');" onmouseout="out('-7483445949807957179');" style=""><abbr title=" 276                     executeBatchSql(templateSql, schema, tableName, storeType, enablePartition, valueFieldNames, partitionFields, rowDataMap);"> 276                     executeBatchSql(templateSql, schema, tableName, storeType, enablePartition, valueFiel🔵</abbr></span>
<span class="1629791312198735010" onmouseenter="enter('1629791312198735010');" onmouseout="out('1629791312198735010');" style=""> 277                     rowDataMap.clear();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279             }                                                                                            </span>
<span class="-5311733944590264805" onmouseenter="enter('-5311733944590264805');" onmouseout="out('-5311733944590264805');" style=""> 280             batchCount = 0;                                                                              </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 281         } catch (java.lang.Exception e) {                                                                </span>
<span class="-5628183046854957718" onmouseenter="enter('-5628183046854957718');" onmouseout="out('-5628183046854957718');" style=""> 282             LOG.error(&quot;Writing records to impala jdbc failed.&quot;, e);                                      </span>
<span class="-7023774051195191894" onmouseenter="enter('-7023774051195191894');" onmouseout="out('-7023774051195191894');" style=""> 283             throw new RuntimeException(&quot;Writing records to impala jdbc failed.&quot;, e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285     }                                                                                                    </span>
<span  style=""> 286                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 287     /**                                                                                                  </span>
<span class="-1106181825212481278" onmouseenter="enter('-1106181825212481278');" onmouseout="out('-1106181825212481278');" style=""> 288      * execute batch update statement                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 289      *                                                                                                   </span>
<span class="3560665881375675274" onmouseenter="enter('3560665881375675274');" onmouseout="out('3560665881375675274');" style=""> 290      * @throws SQLException throw sql exception                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 291      */                                                                                                  </span>
<span class="3206601587144870407" onmouseenter="enter('3206601587144870407');" onmouseout="out('3206601587144870407');" style=""> 292     private void executeUpdateBatch() throws SQLException {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 293         try {                                                                                            </span>
<span class="294367744346812076" onmouseenter="enter('294367744346812076');" onmouseout="out('294367744346812076');" style=""> 294             rows.forEach(( row) -&gt; {                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 295                 try {                                                                                    </span>
<span class="322153516506883022" onmouseenter="enter('322153516506883022');" onmouseout="out('322153516506883022');" style=""><abbr title=" 296                     JDBCTypeConvertUtils.setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), row, primaryKeys.stream().mapToInt(fieldNames::indexOf).toArray());"> 296                     JDBCTypeConvertUtils.setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSq🔵</abbr></span>
<span class="-4238050377414791796" onmouseenter="enter('-4238050377414791796');" onmouseout="out('-4238050377414791796');" style=""> 297                     updateStatement.addBatch();                                                          </span>
<span class="6077291764686690243" onmouseenter="enter('6077291764686690243');" onmouseout="out('6077291764686690243');" style=""> 298                 } catch ( e) {                                                                           </span>
<span class="4029187348433504343" onmouseenter="enter('4029187348433504343');" onmouseout="out('4029187348433504343');" style=""> 299                     throw new &lt;e&gt;RuntimeException(&quot;impala jdbc execute batch error!&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 301             });                                                                                          </span>
<span class="-3747739502872154032" onmouseenter="enter('-3747739502872154032');" onmouseout="out('-3747739502872154032');" style=""> 302             updateStatement.executeBatch();                                                              </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 303             connection.commit();                                                                         </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 304             rows.clear();                                                                                </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 305         } catch (java.lang.Exception e) {                                                                </span>
<span class="1715728751446881781" onmouseenter="enter('1715728751446881781');" onmouseout="out('1715728751446881781');" style=""> 306             LOG.debug(&quot;impala jdbc execute batch error &quot;, e);                                            </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 307             JDBCUtils.rollBack(connection);                                                              </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 308             JDBCUtils.commit(connection);                                                                </span>
<span class="-4187732730208785389" onmouseenter="enter('-4187732730208785389');" onmouseout="out('-4187732730208785389');" style=""> 309             updateStatement.clearBatch();                                                                </span>
<span class="-8814080953460465644" onmouseenter="enter('-8814080953460465644');" onmouseout="out('-8814080953460465644');" style=""> 310             executeUpdate(connection);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312     }                                                                                                    </span>
<span  style=""> 313                                                                                                          </span>
<span class="-4847686400566224446" onmouseenter="enter('-4847686400566224446');" onmouseout="out('-4847686400566224446');" style=""> 314     public void executeUpdate(Connection connection) {                                                   </span>
<span class="294367744346812076" onmouseenter="enter('294367744346812076');" onmouseout="out('294367744346812076');" style=""> 315         rows.forEach(( row) -&gt; {                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 316             try {                                                                                        </span>
<span class="3018395377218617369" onmouseenter="enter('3018395377218617369');" onmouseout="out('3018395377218617369');" style=""><abbr title=" 317                 setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), row);"> 317                 setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldT🔵</abbr></span>
<span class="-6547782628025070914" onmouseenter="enter('-6547782628025070914');" onmouseout="out('-6547782628025070914');" style=""> 318                 updateStatement.executeUpdate();                                                         </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 319                 JDBCUtils.commit(connection);                                                            </span>
<span class="6077291764686690243" onmouseenter="enter('6077291764686690243');" onmouseout="out('6077291764686690243');" style=""> 320             } catch ( e) {                                                                               </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 321                 JDBCUtils.rollBack(connection);                                                          </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 322                 JDBCUtils.commit(connection);                                                            </span>
<span class="1935230544356834562" onmouseenter="enter('1935230544356834562');" onmouseout="out('1935230544356834562');" style=""><abbr title=" 323                 if (((metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY) == 0) || LOG.isDebugEnabled()) {"> 323                 if (((metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY) == 0) |🔵</abbr></span>
<span class="-2764908242367356599" onmouseenter="enter('-2764908242367356599');" onmouseout="out('-2764908242367356599');" style=""> 324                     LOG.error(&quot;record insert failed ,this row is {}&quot;, row.toString());                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 325                     LOG.error(&quot;&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326                 }                                                                                        </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 327                 metricOutputFormat.outDirtyRecords.inc();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 329         });                                                                                              </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 330         rows.clear();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331     }                                                                                                    </span>
<span  style=""> 332                                                                                                          </span>
<span class="5541545914698662583" onmouseenter="enter('5541545914698662583');" onmouseout="out('5541545914698662583');" style=""><abbr title=" 333     private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData) {"> 333     private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData)🔵</abbr></span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 334         Set&lt;String&gt; keySet = rowDataMap.keySet();                                                        </span>
<span class="-4115511162008757651" onmouseenter="enter('-4115511162008757651');" onmouseout="out('-4115511162008757651');" style=""> 335         ArrayList&lt;String&gt; tempRowArray;                                                                  </span>
<span class="-6312285345137005178" onmouseenter="enter('-6312285345137005178');" onmouseout="out('-6312285345137005178');" style=""> 336         if (keySet.contains(rowData.f0)) {                                                               </span>
<span class="2063657660163215007" onmouseenter="enter('2063657660163215007');" onmouseout="out('2063657660163215007');" style=""> 337             tempRowArray = rowDataMap.get(rowData.f0);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 338         } else {                                                                                         </span>
<span class="7109917545131433172" onmouseenter="enter('7109917545131433172');" onmouseout="out('7109917545131433172');" style=""> 339             tempRowArray = new ArrayList&lt;&gt;();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340         }                                                                                                </span>
<span class="1467529594977533778" onmouseenter="enter('1467529594977533778');" onmouseout="out('1467529594977533778');" style=""> 341         tempRowArray.add(rowData.f1);                                                                    </span>
<span class="6767865840186405987" onmouseenter="enter('6767865840186405987');" onmouseout="out('6767865840186405987');" style=""> 342         rowDataMap.put(rowData.f0, tempRowArray);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343     }                                                                                                    </span>
<span  style=""> 344                                                                                                          </span>
<span class="3578278218776325408" onmouseenter="enter('3578278218776325408');" onmouseout="out('3578278218776325408');" style=""><abbr title=" 345     private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPartitionFields, List&lt;String&gt; fieldTypes, String partitionFields) {"> 345     private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPart🔵</abbr></span>
<span class="-4698577817001148605" onmouseenter="enter('-4698577817001148605');" onmouseout="out('-4698577817001148605');" style=""> 346         if (partitionFields == null || partitionFields.isEmpty()) {                                      </span>
<span class="2916035488958294792" onmouseenter="enter('2916035488958294792');" onmouseout="out('2916035488958294792');" style=""> 347             return fieldNames;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348         }                                                                                                </span>
<span  style=""> 349                                                                                                          </span>
<span class="7990418778069769767" onmouseenter="enter('7990418778069769767');" onmouseout="out('7990418778069769767');" style=""> 350         List&lt;String&gt; valueFields = new ArrayList&lt;&gt;(fieldNames);                                          </span>
<span  style=""> 351                                                                                                          </span>
<span class="2302239674432319726" onmouseenter="enter('2302239674432319726');" onmouseout="out('2302239674432319726');" style=""> 352         for (int i = valueFields.size() - 1; i &gt;= 0; i--) {                                              </span>
<span class="-8004931019804249555" onmouseenter="enter('-8004931019804249555');" onmouseout="out('-8004931019804249555');" style=""> 353             if (staticPartitionFields.contains(fieldNames.get(i))) {                                     </span>
<span class="-3872161480019783193" onmouseenter="enter('-3872161480019783193');" onmouseout="out('-3872161480019783193');" style=""> 354                 valueFields.remove(i);                                                                   </span>
<span class="5504621354582269117" onmouseenter="enter('5504621354582269117');" onmouseout="out('5504621354582269117');" style=""> 355                 fieldTypes.remove(i);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="8724369392835521335" onmouseenter="enter('8724369392835521335');" onmouseout="out('8724369392835521335');" style=""> 359         for (int i = 0; i &lt; valueFields.size(); i++) {                                                   </span>
<span class="4573573241123850638" onmouseenter="enter('4573573241123850638');" onmouseout="out('4573573241123850638');" style=""> 360             if (partitionFields.contains(fieldNames.get(i))) {                                           </span>
<span class="-6733214010943616061" onmouseenter="enter('-6733214010943616061');" onmouseout="out('-6733214010943616061');" style=""> 361                 valueFields.add(valueFields.remove(i));                                                  </span>
<span class="3100686975272655596" onmouseenter="enter('3100686975272655596');" onmouseout="out('3100686975272655596');" style=""> 362                 fieldTypes.add(fieldTypes.remove(i));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span  style=""> 365                                                                                                          </span>
<span class="-4055330890426471630" onmouseenter="enter('-4055330890426471630');" onmouseout="out('-4055330890426471630');" style=""> 366         return valueFields;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367     }                                                                                                    </span>
<span  style=""> 368                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 369     @Override                                                                                            </span>
<span class="-8766503565464123288" onmouseenter="enter('-8766503565464123288');" onmouseout="out('-8766503565464123288');" style=""> 370     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) throws IOException {                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 371         try {                                                                                            </span>
<span class="-1438543337409690372" onmouseenter="enter('-1438543337409690372');" onmouseout="out('-1438543337409690372');" style=""> 372             if (!record.f0) {                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 373                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374             }                                                                                            </span>
<span class="1798702739735824608" onmouseenter="enter('1798702739735824608');" onmouseout="out('1798702739735824608');" style=""> 375             if (((outRecords.getCount() % RECEIVE_DATA_PRINT_FREQUENCY) == 0) || LOG.isDebugEnabled()) { </span>
<span class="867853870420543335" onmouseenter="enter('867853870420543335');" onmouseout="out('867853870420543335');" style=""> 376                 LOG.info(&quot;Receive data : {}&quot;, record);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377             }                                                                                            </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 378             if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                              </span>
<span class="-4538110507205524162" onmouseenter="enter('-4538110507205524162');" onmouseout="out('-4538110507205524162');" style=""> 379                 rows.add(Row.copy(record.f1));                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 380             } else {                                                                                     </span>
<span class="-7917205410914838057" onmouseenter="enter('-7917205410914838057');" onmouseout="out('-7917205410914838057');" style=""> 381                 Map&lt;String, Object&gt; valueMap = Maps.newHashMap();                                        </span>
<span class="1869446492779313508" onmouseenter="enter('1869446492779313508');" onmouseout="out('1869446492779313508');" style=""> 382                 Row row = Row.copy(record.f1);                                                           </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 383                 for (int i = 0; i &lt; row.getArity(); i++) {                                               </span>
<span class="5876572039273015428" onmouseenter="enter('5876572039273015428');" onmouseout="out('5876572039273015428');" style=""> 384                     valueMap.put(fieldNames.get(i), row.getField(i));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385                 }                                                                                        </span>
<span class="-991390362203857814" onmouseenter="enter('-991390362203857814');" onmouseout="out('-991390362203857814');" style=""> 386                 Tuple2&lt;String, String&gt; rowTuple2 = new Tuple2&lt;&gt;();                                       </span>
<span class="2982710714467139286" onmouseenter="enter('2982710714467139286');" onmouseout="out('2982710714467139286');" style=""> 387                 if (storeType.equalsIgnoreCase(KUDU_TYPE) || (!enablePartition)) {                       </span>
<span class="-4830782679838689768" onmouseenter="enter('-4830782679838689768');" onmouseout="out('-4830782679838689768');" style=""> 388                     rowTuple2.f0 = NO_PARTITION;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 389                 } else {                                                                                 </span>
<span class="5139395380358692168" onmouseenter="enter('5139395380358692168');" onmouseout="out('5139395380358692168');" style=""><abbr title=" 390                     rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFields);"> 390                     rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFiel🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391                 }                                                                                        </span>
<span class="-484968884065413564" onmouseenter="enter('-484968884065413564');" onmouseout="out('-484968884065413564');" style=""> 392                 // 根据字段名对 row data 重组, 比如，原始 row data : (1, xxx, 20) -&gt; (id, name, age)                  </span>
<span class="2038150889857603205" onmouseenter="enter('2038150889857603205');" onmouseout="out('2038150889857603205');" style=""> 393                 // 但是由于 partition，写入的field 顺序变成了 (name, id, age)，则需要对 row data 重组变成 (xxx, 1, 20)         </span>
<span class="5421203580895226953" onmouseenter="enter('5421203580895226953');" onmouseout="out('5421203580895226953');" style=""> 394                 Row rowValue = new Row(fieldTypes.size());                                               </span>
<span class="-7699243670258396145" onmouseenter="enter('-7699243670258396145');" onmouseout="out('-7699243670258396145');" style=""> 395                 for (int i = 0; i &lt; fieldTypes.size(); i++) {                                            </span>
<span class="2312799749991659832" onmouseenter="enter('2312799749991659832');" onmouseout="out('2312799749991659832');" style=""> 396                     rowValue.setField(i, valueMap.get(valueFieldNames.get(i)));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397                 }                                                                                        </span>
<span class="2914199757449377543" onmouseenter="enter('2914199757449377543');" onmouseout="out('2914199757449377543');" style=""> 398                 rowTuple2.f1 = buildValuesCondition(fieldTypes, rowValue);                               </span>
<span class="8896132355788887171" onmouseenter="enter('8896132355788887171');" onmouseout="out('8896132355788887171');" style=""> 399                 putRowIntoMap(rowDataMap, rowTuple2);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400             }                                                                                            </span>
<span class="-1784546571648451896" onmouseenter="enter('-1784546571648451896');" onmouseout="out('-1784546571648451896');" style=""> 401             batchCount++;                                                                                </span>
<span class="2059038061408804342" onmouseenter="enter('2059038061408804342');" onmouseout="out('2059038061408804342');" style=""> 402             if (batchCount &gt;= batchSize) {                                                               </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 403                 flush();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404             }                                                                                            </span>
<span class="-2147939016446724954" onmouseenter="enter('-2147939016446724954');" onmouseout="out('-2147939016446724954');" style=""> 405             // Receive data                                                                              </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 406             outRecords.inc();                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 407         } catch (java.lang.Exception e) {                                                                </span>
<span class="-6314596404725474749" onmouseenter="enter('-6314596404725474749');" onmouseout="out('-6314596404725474749');" style=""> 408             throw new IOException(&quot;Writing records to impala failed.&quot;, e);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410     }                                                                                                    </span>
<span  style=""> 411                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 412     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 413     public void close() throws IOException {                                                             </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 414         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 415             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416         }                                                                                                </span>
<span class="-8247099019020917877" onmouseenter="enter('-8247099019020917877');" onmouseout="out('-8247099019020917877');" style=""> 417         // 将还未执行的SQL flush                                                                               </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 418         if (batchCount &gt; 0) {                                                                            </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 419             flush();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span class="4306800238416480323" onmouseenter="enter('4306800238416480323');" onmouseout="out('4306800238416480323');" style=""> 421         // cancel scheduled task                                                                         </span>
<span class="-1257031862697527304" onmouseenter="enter('-1257031862697527304');" onmouseout="out('-1257031862697527304');" style=""> 422         if (this.scheduledFuture != null) {                                                              </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 423             scheduledFuture.cancel(false);                                                               </span>
<span class="-3367227577965762682" onmouseenter="enter('-3367227577965762682');" onmouseout="out('-3367227577965762682');" style=""> 424             this.scheduler.shutdown();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425         }                                                                                                </span>
<span class="-6918026600162299955" onmouseenter="enter('-6918026600162299955');" onmouseout="out('-6918026600162299955');" style=""> 426         // close connection                                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 427         try {                                                                                            </span>
<span class="2047921360780686601" onmouseenter="enter('2047921360780686601');" onmouseout="out('2047921360780686601');" style=""> 428             if ((connection != null) &amp;&amp; connection.isValid(DEFAULT_CONN_TIME_OUT)) {                     </span>
<span class="9071602856049240163" onmouseenter="enter('9071602856049240163');" onmouseout="out('9071602856049240163');" style=""> 429                 connection.close();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430             }                                                                                            </span>
<span class="8429322953702249735" onmouseenter="enter('8429322953702249735');" onmouseout="out('8429322953702249735');" style=""> 431             if ((statement != null) &amp;&amp; (!statement.isClosed())) {                                        </span>
<span class="-4290000005499431342" onmouseenter="enter('-4290000005499431342');" onmouseout="out('-4290000005499431342');" style=""> 432                 statement.close();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433             }                                                                                            </span>
<span class="174875997820390122" onmouseenter="enter('174875997820390122');" onmouseout="out('174875997820390122');" style=""> 434             if ((updateStatement != null) &amp;&amp; (!updateStatement.isClosed())) {                            </span>
<span class="6285223499122042502" onmouseenter="enter('6285223499122042502');" onmouseout="out('6285223499122042502');" style=""> 435                 updateStatement.close();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436             }                                                                                            </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 437         } catch (SQLException e) {                                                                       </span>
<span class="-8800633426745397107" onmouseenter="enter('-8800633426745397107');" onmouseout="out('-8800633426745397107');" style=""> 438             throw new RuntimeException(&quot;impala connection close failed!&quot;, e);                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 439         } finally {                                                                                      </span>
<span class="8335594207613379924" onmouseenter="enter('8335594207613379924');" onmouseout="out('8335594207613379924');" style=""> 440             connection = null;                                                                           </span>
<span class="-8855760725718402841" onmouseenter="enter('-8855760725718402841');" onmouseout="out('-8855760725718402841');" style=""> 441             statement = null;                                                                            </span>
<span class="-7841270215011717932" onmouseenter="enter('-7841270215011717932');" onmouseout="out('-7841270215011717932');" style=""> 442             updateStatement = null;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443         }                                                                                                </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 444         closed = true;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445     }                                                                                                    </span>
<span  style=""> 446                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 447     /**                                                                                                  </span>
<span class="1296337810927918625" onmouseenter="enter('1296337810927918625');" onmouseout="out('1296337810927918625');" style=""> 448      * execute batch sql from row data map                                                               </span>
<span class="-5974232274386764846" onmouseenter="enter('-5974232274386764846');" onmouseout="out('-5974232274386764846');" style=""><abbr title=" 449      * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)...."> 449      * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 450      *                                                                                                   </span>
<span class="4252025712922498493" onmouseenter="enter('4252025712922498493');" onmouseout="out('4252025712922498493');" style=""> 451      * @param tempSql         template sql                                                               </span>
<span class="-888616451537648959" onmouseenter="enter('-888616451537648959');" onmouseout="out('-888616451537648959');" style=""> 452      * @param storeType       the store type of data                                                     </span>
<span class="-5301096736775778703" onmouseenter="enter('-5301096736775778703');" onmouseout="out('-5301096736775778703');" style=""> 453      * @param enablePartition enable partition or not                                                    </span>
<span class="-7243431631208061298" onmouseenter="enter('-7243431631208061298');" onmouseout="out('-7243431631208061298');" style=""> 454      * @param fieldNames      field name list                                                            </span>
<span class="991482749163976330" onmouseenter="enter('991482749163976330');" onmouseout="out('991482749163976330');" style=""> 455      * @param partitionFields partition fields                                                           </span>
<span class="5552251290683891506" onmouseenter="enter('5552251290683891506');" onmouseout="out('5552251290683891506');" style=""> 456      * @param rowDataMap      row data map                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 457      */                                                                                                  </span>
<span class="-2755740653535965782" onmouseenter="enter('-2755740653535965782');" onmouseout="out('-2755740653535965782');" style=""><abbr title=" 458     private void executeBatchSql(String tempSql, String schema, String tableName, String storeType, Boolean enablePartition, List&lt;String&gt; fieldNames, String partitionFields, Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap) {"> 458     private void executeBatchSql(String tempSql, String schema, String tableName, String storeType, Boole🔵</abbr></span>
<span class="-1699639020719600437" onmouseenter="enter('-1699639020719600437');" onmouseout="out('-1699639020719600437');" style=""> 459         StringBuilder partitionCondition = new StringBuilder();                                          </span>
<span class="4484344279813579809" onmouseenter="enter('4484344279813579809');" onmouseout="out('4484344279813579809');" style=""> 460         String tableFieldsCondition = buildTableFieldsCondition(fieldNames, partitionFields);            </span>
<span class="6980371482153070193" onmouseenter="enter('6980371482153070193');" onmouseout="out('6980371482153070193');" style=""> 461         ArrayList&lt;String&gt; rowData = new ArrayList&lt;&gt;();                                                   </span>
<span class="2367553030081763438" onmouseenter="enter('2367553030081763438');" onmouseout="out('2367553030081763438');" style=""><abbr title=" 462         String tableNameInfo = (Objects.isNull(schema)) ? tableName : (quoteIdentifier(schema) + &quot;.&quot;) + tableName;"> 462         String tableNameInfo = (Objects.isNull(schema)) ? tableName : (quoteIdentifier(schema) + &quot;.&quot;) + t🔵</abbr></span>
<span class="-7586945217349428495" onmouseenter="enter('-7586945217349428495');" onmouseout="out('-7586945217349428495');" style=""> 463         tempSql = tempSql.replace(&quot;tableName&quot;, tableNameInfo);                                           </span>
<span class="3906438926033639164" onmouseenter="enter('3906438926033639164');" onmouseout="out('3906438926033639164');" style=""> 464         boolean isPartitioned = storeType.equalsIgnoreCase(KUDU_TYPE) || (!enablePartition);             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 465         try {                                                                                            </span>
<span class="-739313269293547881" onmouseenter="enter('-739313269293547881');" onmouseout="out('-739313269293547881');" style=""> 466             // kudu ${partitionCondition} is null                                                        </span>
<span class="-196943023254075124" onmouseenter="enter('-196943023254075124');" onmouseout="out('-196943023254075124');" style=""> 467             if (isPartitioned) {                                                                         </span>
<span class="3782788685030095104" onmouseenter="enter('3782788685030095104');" onmouseout="out('3782788685030095104');" style=""><abbr title=" 468                 tempSql = tempSql.replace(PARTITION_CONDITION, partitionCondition.toString()).replace(PARTITION_CONSTANT, &quot;&quot;).replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);"> 468                 tempSql = tempSql.replace(PARTITION_CONDITION, partitionCondition.toString()).replace(PAR🔵</abbr></span>
<span class="-3048945956628717740" onmouseenter="enter('-3048945956628717740');" onmouseout="out('-3048945956628717740');" style=""> 469                 rowData.addAll(rowDataMap.get(NO_PARTITION));                                            </span>
<span class="-5061257777486987691" onmouseenter="enter('-5061257777486987691');" onmouseout="out('-5061257777486987691');" style=""> 470                 String executeSql = tempSql.replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));       </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 471                 statement.execute(executeSql);                                                           </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style=""> 472                 rowData.clear();                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 473             } else {                                                                                     </span>
<span class="6613720697354939567" onmouseenter="enter('6613720697354939567');" onmouseout="out('6613720697354939567');" style=""> 474                 // partition sql                                                                         </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 475                 Set&lt;String&gt; keySet = rowDataMap.keySet();                                                </span>
<span class="5286500476222551862" onmouseenter="enter('5286500476222551862');" onmouseout="out('5286500476222551862');" style=""> 476                 for (String key : keySet) {                                                              </span>
<span class="2862511654232329090" onmouseenter="enter('2862511654232329090');" onmouseout="out('2862511654232329090');" style=""> 477                     rowData.addAll(rowDataMap.get(key));                                                 </span>
<span class="3266960038838022824" onmouseenter="enter('3266960038838022824');" onmouseout="out('3266960038838022824');" style=""> 478                     partitionCondition.append(key);                                                      </span>
<span class="6363178911899855065" onmouseenter="enter('6363178911899855065');" onmouseout="out('6363178911899855065');" style=""><abbr title=" 479                     tempSql = tempSql.replace(PARTITION_CONDITION, partitionCondition.toString()).replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);"> 479                     tempSql = tempSql.replace(PARTITION_CONDITION, partitionCondition.toString()).replace🔵</abbr></span>
<span class="-5061257777486987691" onmouseenter="enter('-5061257777486987691');" onmouseout="out('-5061257777486987691');" style=""> 480                     String executeSql = tempSql.replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));   </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 481                     statement.execute(executeSql);                                                       </span>
<span class="-3000902343706299075" onmouseenter="enter('-3000902343706299075');" onmouseout="out('-3000902343706299075');" style=""> 482                     partitionCondition.delete(0, partitionCondition.length());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484             }                                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 485         } catch (java.lang.Exception e) {                                                                </span>
<span class="2735729731347220182" onmouseenter="enter('2735729731347220182');" onmouseout="out('2735729731347220182');" style=""> 486             if (e instanceof SQLException) {                                                             </span>
<span class="-4009259436355561175" onmouseenter="enter('-4009259436355561175');" onmouseout="out('-4009259436355561175');" style=""> 487                 dealBatchSqlError(rowData, connection, statement, tempSql);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 488             } else {                                                                                     </span>
<span class="1776368734984517953" onmouseenter="enter('1776368734984517953');" onmouseout="out('1776368734984517953');" style=""> 489                 throw new RuntimeException(&quot;Insert into impala error!&quot;, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 491         } finally {                                                                                      </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style=""> 492             rowData.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494     }                                                                                                    </span>
<span  style=""> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 496     /**                                                                                                  </span>
<span class="5187728543542090149" onmouseenter="enter('5187728543542090149');" onmouseout="out('5187728543542090149');" style=""> 497      * 当批量写入失败时，把批量的sql拆解为单条sql提交，对于单条写入的sql记做脏数据                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 498      *                                                                                                   </span>
<span class="1818199964066233402" onmouseenter="enter('1818199964066233402');" onmouseout="out('1818199964066233402');" style=""> 499      * @param statement                                                                                  </span>
<span class="-4482442250131362858" onmouseenter="enter('-4482442250131362858');" onmouseout="out('-4482442250131362858');" style=""> 500      * 		execute statement                                                                               </span>
<span class="-2733108396532084386" onmouseenter="enter('-2733108396532084386');" onmouseout="out('-2733108396532084386');" style=""> 501      * @param tempSql                                                                                    </span>
<span class="-3627706401020154103" onmouseenter="enter('-3627706401020154103');" onmouseout="out('-3627706401020154103');" style=""> 502      * 		template sql                                                                                    </span>
<span class="5753875416790965951" onmouseenter="enter('5753875416790965951');" onmouseout="out('5753875416790965951');" style=""> 503      * @param storeType                                                                                  </span>
<span class="-4790810105283065734" onmouseenter="enter('-4790810105283065734');" onmouseout="out('-4790810105283065734');" style=""> 504      * 		the store type of data                                                                          </span>
<span class="-63939125741909150" onmouseenter="enter('-63939125741909150');" onmouseout="out('-63939125741909150');" style=""> 505      * @param enablePartition                                                                            </span>
<span class="-8803991651764488445" onmouseenter="enter('-8803991651764488445');" onmouseout="out('-8803991651764488445');" style=""> 506      * 		enable partition or not                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 507      */                                                                                                  </span>
<span class="-8401513151945564505" onmouseenter="enter('-8401513151945564505');" onmouseout="out('-8401513151945564505');" style=""><abbr title=" 508     private void dealBatchSqlError(List&lt;String&gt; rowData, Connection connection, Statement statement, String templateSql) {"> 508     private void dealBatchSqlError(List&lt;String&gt; rowData, Connection connection, Statement statement, Stri🔵</abbr></span>
<span class="-7725538089846589979" onmouseenter="enter('-7725538089846589979');" onmouseout="out('-7725538089846589979');" style=""> 509         String errorMsg = &quot;Insert into impala error. \nCause: [%s]\nRow: [%s]&quot;;                          </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 510         JDBCUtils.rollBack(connection);                                                                  </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 511         JDBCUtils.commit(connection);                                                                    </span>
<span class="-7816936101366912926" onmouseenter="enter('-7816936101366912926');" onmouseout="out('-7816936101366912926');" style=""> 512         for (String rowDatum : rowData) {                                                                </span>
<span class="-2842345043798651788" onmouseenter="enter('-2842345043798651788');" onmouseout="out('-2842345043798651788');" style=""> 513             String executeSql = templateSql.replace(VALUES_CONDITION, rowDatum);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 514             try {                                                                                        </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 515                 statement.execute(executeSql);                                                           </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 516                 JDBCUtils.commit(connection);                                                            </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 517             } catch (SQLException e) {                                                                   </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style=""> 518                 JDBCUtils.rollBack(connection);                                                          </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style=""> 519                 JDBCUtils.commit(connection);                                                            </span>
<span class="1935230544356834562" onmouseenter="enter('1935230544356834562');" onmouseout="out('1935230544356834562');" style=""><abbr title=" 520                 if (((metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY) == 0) || LOG.isDebugEnabled()) {"> 520                 if (((metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY) == 0) |🔵</abbr></span>
<span class="4822588713321057869" onmouseenter="enter('4822588713321057869');" onmouseout="out('4822588713321057869');" style=""> 521                     LOG.error(String.format(errorMsg, ExceptionTrace.traceOriginalCause(e), rowDatum));  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522                 }                                                                                        </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 523                 metricOutputFormat.outDirtyRecords.inc();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526     }                                                                                                    </span>
<span  style=""> 527                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 528     /**                                                                                                  </span>
<span class="-7756927092547658158" onmouseenter="enter('-7756927092547658158');" onmouseout="out('-7756927092547658158');" style=""> 529      * build partition condition with row data                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 530      *                                                                                                   </span>
<span class="3326420447531983720" onmouseenter="enter('3326420447531983720');" onmouseout="out('3326420447531983720');" style=""> 531      * @param rowData              row data                                                              </span>
<span class="-4527404320823727170" onmouseenter="enter('-4527404320823727170');" onmouseout="out('-4527404320823727170');" style=""> 532      * @param partitionFields      partition fields                                                      </span>
<span class="-1776173940247734574" onmouseenter="enter('-1776173940247734574');" onmouseout="out('-1776173940247734574');" style=""> 533      * @param staticPartitionField static partition fields                                               </span>
<span class="-1132708759906563110" onmouseenter="enter('-1132708759906563110');" onmouseout="out('-1132708759906563110');" style=""> 534      * @return condition like &#x27;(ptOne, ptTwo=v2)&#x27;                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 535      */                                                                                                  </span>
<span class="-3866187778893382496" onmouseenter="enter('-3866187778893382496');" onmouseout="out('-3866187778893382496');" style=""><abbr title=" 536     private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;String&gt; staticPartitionField) {"> 536     private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;Stri🔵</abbr></span>
<span class="1267423885187171547" onmouseenter="enter('1267423885187171547');" onmouseout="out('1267423885187171547');" style=""> 537         for (String key : staticPartitionField) {                                                        </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 538             StringBuilder sb = new StringBuilder();                                                      </span>
<span class="-5505398468694975344" onmouseenter="enter('-5505398468694975344');" onmouseout="out('-5505398468694975344');" style=""> 539             Object value = rowData.get(key);                                                             </span>
<span class="-3546349567435071552" onmouseenter="enter('-3546349567435071552');" onmouseout="out('-3546349567435071552');" style=""> 540             sb.append(key).append(&quot;=&quot;).append(value);                                                    </span>
<span class="7571464430142538701" onmouseenter="enter('7571464430142538701');" onmouseout="out('7571464430142538701');" style=""> 541             partitionFields = partitionFields.replace(&quot;${&quot; + key + &quot;}&quot;, sb.toString());                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542         }                                                                                                </span>
<span class="-6125585623196674116" onmouseenter="enter('-6125585623196674116');" onmouseout="out('-6125585623196674116');" style=""> 543         return &quot;(&quot; + partitionFields + &quot;)&quot;;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544     }                                                                                                    </span>
<span  style=""> 545                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 546     /**                                                                                                  </span>
<span class="1604816269765986224" onmouseenter="enter('1604816269765986224');" onmouseout="out('1604816269765986224');" style=""> 547      * build field condition according to field names                                                    </span>
<span class="-8005762898157210848" onmouseenter="enter('-8005762898157210848');" onmouseout="out('-8005762898157210848');" style=""> 548      * replace ${tableFieldCondition}                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 549      *                                                                                                   </span>
<span class="-3045974832751459167" onmouseenter="enter('-3045974832751459167');" onmouseout="out('-3045974832751459167');" style=""> 550      * @param fieldNames      the selected field names                                                   </span>
<span class="-2115580236801058408" onmouseenter="enter('-2115580236801058408');" onmouseout="out('-2115580236801058408');" style=""> 551      * @param partitionFields the partition fields                                                       </span>
<span class="-2587093228749928778" onmouseenter="enter('-2587093228749928778');" onmouseout="out('-2587093228749928778');" style=""> 552      * @return condition like &#x27;(id, name, age)&#x27;                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 553      */                                                                                                  </span>
<span class="-1478951256156574678" onmouseenter="enter('-1478951256156574678');" onmouseout="out('-1478951256156574678');" style=""> 554     private String buildTableFieldsCondition(List&lt;String&gt; fieldNames, String partitionFields) {          </span>
<span class="4052063814556408334" onmouseenter="enter('4052063814556408334');" onmouseout="out('4052063814556408334');" style=""><abbr title=" 555         return (&quot;(&quot; + fieldNames.stream().filter(( f) -&gt; !partitionFields.contains(f)).map(this::quoteIdentifier).collect(Collectors.joining(&quot;, &quot;))) + &quot;)&quot;;"> 555         return (&quot;(&quot; + fieldNames.stream().filter(( f) -&gt; !partitionFields.contains(f)).map(this::quoteIde🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556     }                                                                                                    </span>
<span  style=""> 557                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 558     /**                                                                                                  </span>
<span class="-1930125657620201419" onmouseenter="enter('-1930125657620201419');" onmouseout="out('-1930125657620201419');" style=""> 559      * according to field types, build the values condition                                              </span>
<span class="-5328431915012470826" onmouseenter="enter('-5328431915012470826');" onmouseout="out('-5328431915012470826');" style=""> 560      * replace ${valuesCondition}                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 561      *                                                                                                   </span>
<span class="889997534505017973" onmouseenter="enter('889997534505017973');" onmouseout="out('889997534505017973');" style=""> 562      * @param fieldTypes field types                                                                     </span>
<span class="-5792744344160442542" onmouseenter="enter('-5792744344160442542');" onmouseout="out('-5792744344160442542');" style=""> 563      * @return condition like &#x27;(?, ?, cast(? as string))&#x27; and &#x27;?&#x27; will be replaced with row data         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 564      */                                                                                                  </span>
<span class="-8753268388884688793" onmouseenter="enter('-8753268388884688793');" onmouseout="out('-8753268388884688793');" style=""> 565     private String buildValuesCondition(List&lt;String&gt; fieldTypes, Row row) {                              </span>
<span class="4540472329022285554" onmouseenter="enter('4540472329022285554');" onmouseout="out('4540472329022285554');" style=""> 566         String valuesCondition = fieldTypes.stream().map(( f) -&gt; {                                       </span>
<span class="9071647551805886291" onmouseenter="enter('9071647551805886291');" onmouseout="out('9071647551805886291');" style=""> 567             for (String item : NEED_QUOTE_TYPE) {                                                        </span>
<span class="9108011392601680881" onmouseenter="enter('9108011392601680881');" onmouseout="out('9108011392601680881');" style=""> 568                 if (f.toLowerCase().contains(item)) {                                                    </span>
<span class="4986243018565820248" onmouseenter="enter('4986243018565820248');" onmouseout="out('4986243018565820248');" style=""> 569                     return String.format(&quot;cast(\&#x27;?\&#x27; as %s)&quot;, f.toLowerCase());                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571             }                                                                                            </span>
<span class="6027958975032523467" onmouseenter="enter('6027958975032523467');" onmouseout="out('6027958975032523467');" style=""> 572             return &quot;?&quot;;                                                                                  </span>
<span class="4654177507103038656" onmouseenter="enter('4654177507103038656');" onmouseout="out('4654177507103038656');" style=""> 573         }).collect(Collectors.joining(&quot;, &quot;));                                                            </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 574         for (int i = 0; i &lt; row.getArity(); i++) {                                                       </span>
<span class="6605498463591237491" onmouseenter="enter('6605498463591237491');" onmouseout="out('6605498463591237491');" style=""> 575             Object rowField = row.getField(i);                                                           </span>
<span class="4211930808349437126" onmouseenter="enter('4211930808349437126');" onmouseout="out('4211930808349437126');" style=""> 576             if (DtStringUtil.isEmptyOrNull(rowField)) {                                                  </span>
<span class="7649934488606896071" onmouseenter="enter('7649934488606896071');" onmouseout="out('7649934488606896071');" style=""> 577                 valuesCondition = valuesCondition.replaceFirst(&quot;\&#x27;\\?\&#x27;&quot;, &quot;null&quot;);                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 578             } else {                                                                                     </span>
<span class="6578353206956648527" onmouseenter="enter('6578353206956648527');" onmouseout="out('6578353206956648527');" style=""> 579                 valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, rowField.toString());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581         }                                                                                                </span>
<span class="8932803258953020947" onmouseenter="enter('8932803258953020947');" onmouseout="out('8932803258953020947');" style=""> 582         return (&quot;(&quot; + valuesCondition) + &quot;)&quot;;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 583     }                                                                                                    </span>
<span  style=""> 584                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 585     /**                                                                                                  </span>
<span class="2218542669560141576" onmouseenter="enter('2218542669560141576');" onmouseout="out('2218542669560141576');" style=""> 586      * impala update mode SQL                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 587      *                                                                                                   </span>
<span class="-8218292189476554358" onmouseenter="enter('-8218292189476554358');" onmouseout="out('-8218292189476554358');" style=""> 588      * @return UPDATE tableName SET setCondition WHERE whereCondition                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 589      */                                                                                                  </span>
<span class="-3752451701752547882" onmouseenter="enter('-3752451701752547882');" onmouseout="out('-3752451701752547882');" style=""><abbr title=" 590     private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; primaryKeys) {"> 590     private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; 🔵</abbr></span>
<span class="5528853464056789996" onmouseenter="enter('5528853464056789996');" onmouseout="out('5528853464056789996');" style=""> 591         //跳过primary key字段                                                                                </span>
<span class="-1196447964125190541" onmouseenter="enter('-1196447964125190541');" onmouseout="out('-1196447964125190541');" style=""><abbr title=" 592         String setClause = fieldNames.stream().filter(( f) -&gt; (!CollectionUtils.isNotEmpty(primaryKeys)) || (!primaryKeys.contains(f))).map(( f) -&gt; quoteIdentifier(f) + &quot;=?&quot;).collect(Collectors.joining(&quot;, &quot;));"> 592         String setClause = fieldNames.stream().filter(( f) -&gt; (!CollectionUtils.isNotEmpty(primaryKeys)) 🔵</abbr></span>
<span class="2016680299480363966" onmouseenter="enter('2016680299480363966');" onmouseout="out('2016680299480363966');" style=""><abbr title=" 593         String conditionClause = primaryKeys.stream().map(( f) -&gt; quoteIdentifier(f) + &quot;=?&quot;).collect(Collectors.joining(&quot; AND &quot;));"> 593         String conditionClause = primaryKeys.stream().map(( f) -&gt; quoteIdentifier(f) + &quot;=?&quot;).collect(Coll🔵</abbr></span>
<span class="7339912941504895326" onmouseenter="enter('7339912941504895326');" onmouseout="out('7339912941504895326');" style=""><abbr title=" 594         return (((((&quot;UPDATE &quot; + (Objects.isNull(schema) ? &quot;&quot; : quoteIdentifier(schema) + &quot;.&quot;)) + quoteIdentifier(tableName)) + &quot; SET &quot;) + setClause) + &quot; WHERE &quot;) + conditionClause;"> 594         return (((((&quot;UPDATE &quot; + (Objects.isNull(schema) ? &quot;&quot; : quoteIdentifier(schema) + &quot;.&quot;)) + quoteIde🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595     }                                                                                                    </span>
<span  style=""> 596                                                                                                          </span>
<span class="4659511982989745103" onmouseenter="enter('4659511982989745103');" onmouseout="out('4659511982989745103');" style=""> 597     private String quoteIdentifier(String identifier) {                                                  </span>
<span class="1935684454964464658" onmouseenter="enter('1935684454964464658');" onmouseout="out('1935684454964464658');" style=""> 598         return &quot;`&quot; + identifier + &quot;`&quot;;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599     }                                                                                                    </span>
<span  style=""> 600                                                                                                          </span>
<span class="2010609695383714647" onmouseenter="enter('2010609695383714647');" onmouseout="out('2010609695383714647');" style=""> 601     public static class Builder {                                                                        </span>
<span class="5030308014750517924" onmouseenter="enter('5030308014750517924');" onmouseout="out('5030308014750517924');" style=""> 602         private final ImpalaOutputFormat format = new ImpalaOutputFormat();                              </span>
<span  style=""> 603                                                                                                          </span>
<span class="4847669250945231235" onmouseenter="enter('4847669250945231235');" onmouseout="out('4847669250945231235');" style=""> 604         public Builder setDbUrl(String dbUrl) {                                                          </span>
<span class="-7007213682983262515" onmouseenter="enter('-7007213682983262515');" onmouseout="out('-7007213682983262515');" style=""> 605             format.dbUrl = dbUrl;                                                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 606             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607         }                                                                                                </span>
<span  style=""> 608                                                                                                          </span>
<span class="-2062625403058053727" onmouseenter="enter('-2062625403058053727');" onmouseout="out('-2062625403058053727');" style=""> 609         public Builder setUserName(String userName) {                                                    </span>
<span class="8996094991043959374" onmouseenter="enter('8996094991043959374');" onmouseout="out('8996094991043959374');" style=""> 610             format.userName = userName;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 611             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612         }                                                                                                </span>
<span  style=""> 613                                                                                                          </span>
<span class="-8917696572465338538" onmouseenter="enter('-8917696572465338538');" onmouseout="out('-8917696572465338538');" style=""> 614         public Builder setPassword(String password) {                                                    </span>
<span class="-5617852808102302847" onmouseenter="enter('-5617852808102302847');" onmouseout="out('-5617852808102302847');" style=""> 615             format.password = password;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 616             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617         }                                                                                                </span>
<span  style=""> 618                                                                                                          </span>
<span class="-6851628607924303336" onmouseenter="enter('-6851628607924303336');" onmouseout="out('-6851628607924303336');" style=""> 619         public Builder setBatchSize(Integer batchSize) {                                                 </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 620             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 621             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622         }                                                                                                </span>
<span  style=""> 623                                                                                                          </span>
<span class="5791410845050671235" onmouseenter="enter('5791410845050671235');" onmouseout="out('5791410845050671235');" style=""> 624         public Builder setBatchWaitInterval(Long batchWaitInterval) {                                    </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 625             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 626             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627         }                                                                                                </span>
<span  style=""> 628                                                                                                          </span>
<span class="-8777589626278372083" onmouseenter="enter('-8777589626278372083');" onmouseout="out('-8777589626278372083');" style=""> 629         public Builder setTableName(String tableName) {                                                  </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 630             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 631             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632         }                                                                                                </span>
<span  style=""> 633                                                                                                          </span>
<span class="221724127870954269" onmouseenter="enter('221724127870954269');" onmouseout="out('221724127870954269');" style=""> 634         public Builder setPartitionFields(String partitionFields) {                                      </span>
<span class="-5496492743746707432" onmouseenter="enter('-5496492743746707432');" onmouseout="out('-5496492743746707432');" style=""> 635             format.partitionFields = (Objects.isNull(partitionFields)) ? &quot;&quot; : partitionFields;           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 636             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637         }                                                                                                </span>
<span  style=""> 638                                                                                                          </span>
<span class="-6994787811007556212" onmouseenter="enter('-6994787811007556212');" onmouseout="out('-6994787811007556212');" style=""> 639         public Builder setPrimaryKeys(List&lt;String&gt; primaryKeys) {                                        </span>
<span class="1909693990286542032" onmouseenter="enter('1909693990286542032');" onmouseout="out('1909693990286542032');" style=""> 640             format.primaryKeys = primaryKeys;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 641             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642         }                                                                                                </span>
<span  style=""> 643                                                                                                          </span>
<span class="7512351963685249159" onmouseenter="enter('7512351963685249159');" onmouseout="out('7512351963685249159');" style=""> 644         public Builder setSchema(String schema) {                                                        </span>
<span class="306599522236782764" onmouseenter="enter('306599522236782764');" onmouseout="out('306599522236782764');" style=""> 645             format.schema = schema;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 646             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647         }                                                                                                </span>
<span  style=""> 648                                                                                                          </span>
<span class="4541611662116992338" onmouseenter="enter('4541611662116992338');" onmouseout="out('4541611662116992338');" style=""> 649         public Builder setEnablePartition(Boolean enablePartition) {                                     </span>
<span class="-6976631596761488792" onmouseenter="enter('-6976631596761488792');" onmouseout="out('-6976631596761488792');" style=""> 650             format.enablePartition = enablePartition;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 651             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652         }                                                                                                </span>
<span  style=""> 653                                                                                                          </span>
<span class="-8865383825618932145" onmouseenter="enter('-8865383825618932145');" onmouseout="out('-8865383825618932145');" style=""> 654         public Builder setUpdateMode(String updateMode) {                                                </span>
<span class="-2281017119849044621" onmouseenter="enter('-2281017119849044621');" onmouseout="out('-2281017119849044621');" style=""> 655             format.updateMode = updateMode;                                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 656             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657         }                                                                                                </span>
<span  style=""> 658                                                                                                          </span>
<span class="8081013001489210313" onmouseenter="enter('8081013001489210313');" onmouseout="out('8081013001489210313');" style=""> 659         public Builder setFieldList(List&lt;String&gt; fieldList) {                                            </span>
<span class="-818074055946993480" onmouseenter="enter('-818074055946993480');" onmouseout="out('-818074055946993480');" style=""> 660             format.fieldNames = fieldList;                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 661             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662         }                                                                                                </span>
<span  style=""> 663                                                                                                          </span>
<span class="3974737416393184735" onmouseenter="enter('3974737416393184735');" onmouseout="out('3974737416393184735');" style=""> 664         public Builder setFieldTypeList(List&lt;String&gt; fieldTypeList) {                                    </span>
<span class="1448747188656744713" onmouseenter="enter('1448747188656744713');" onmouseout="out('1448747188656744713');" style=""> 665             format.fieldTypes = fieldTypeList;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 666             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667         }                                                                                                </span>
<span  style=""> 668                                                                                                          </span>
<span class="2244927175574628655" onmouseenter="enter('2244927175574628655');" onmouseout="out('2244927175574628655');" style=""> 669         public Builder setStoreType(String storeType) {                                                  </span>
<span class="-5818885152026709969" onmouseenter="enter('-5818885152026709969');" onmouseout="out('-5818885152026709969');" style=""> 670             format.storeType = storeType;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 671             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672         }                                                                                                </span>
<span  style=""> 673                                                                                                          </span>
<span class="-5487489987508961941" onmouseenter="enter('-5487489987508961941');" onmouseout="out('-5487489987508961941');" style=""> 674         public Builder setFieldExtraInfoList(List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList) {</span>
<span class="160167467316759360" onmouseenter="enter('160167467316759360');" onmouseout="out('160167467316759360');" style=""> 675             format.fieldExtraInfoList = fieldExtraInfoList;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 676             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677         }                                                                                                </span>
<span  style=""> 678                                                                                                          </span>
<span class="1366044936846496088" onmouseenter="enter('1366044936846496088');" onmouseout="out('1366044936846496088');" style=""> 679         public Builder setKeyTabPath(String keyTabPath) {                                                </span>
<span class="8755357456701014681" onmouseenter="enter('8755357456701014681');" onmouseout="out('8755357456701014681');" style=""> 680             format.keytabPath = keyTabPath;                                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 681             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 682         }                                                                                                </span>
<span  style=""> 683                                                                                                          </span>
<span class="1807007964631867819" onmouseenter="enter('1807007964631867819');" onmouseout="out('1807007964631867819');" style=""> 684         public Builder setKrb5ConfPath(String krb5ConfPath) {                                            </span>
<span class="352337563234497723" onmouseenter="enter('352337563234497723');" onmouseout="out('352337563234497723');" style=""> 685             format.krb5confPath = krb5ConfPath;                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 686             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687         }                                                                                                </span>
<span  style=""> 688                                                                                                          </span>
<span class="-8540538228750165144" onmouseenter="enter('-8540538228750165144');" onmouseout="out('-8540538228750165144');" style=""> 689         public Builder setPrincipal(String principal) {                                                  </span>
<span class="6894839552978791309" onmouseenter="enter('6894839552978791309');" onmouseout="out('6894839552978791309');" style=""> 690             format.principal = principal;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 691             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692         }                                                                                                </span>
<span  style=""> 693                                                                                                          </span>
<span class="-8991908924314829739" onmouseenter="enter('-8991908924314829739');" onmouseout="out('-8991908924314829739');" style=""> 694         public Builder setAuthMech(Integer authMech) {                                                   </span>
<span class="-1412915325814520049" onmouseenter="enter('-1412915325814520049');" onmouseout="out('-1412915325814520049');" style=""> 695             format.authMech = authMech;                                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 696             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697         }                                                                                                </span>
<span  style=""> 698                                                                                                          </span>
<span class="1564959121680510141" onmouseenter="enter('1564959121680510141');" onmouseout="out('1564959121680510141');" style=""> 699         private boolean canHandle(String url) {                                                          </span>
<span class="842511305287615009" onmouseenter="enter('842511305287615009');" onmouseout="out('842511305287615009');" style=""> 700             return url.startsWith(&quot;jdbc:impala:&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701         }                                                                                                </span>
<span  style=""> 702                                                                                                          </span>
<span class="-8521575333201954447" onmouseenter="enter('-8521575333201954447');" onmouseout="out('-8521575333201954447');" style=""> 703         public ImpalaOutputFormat build() {                                                              </span>
<span class="1659683170431033048" onmouseenter="enter('1659683170431033048');" onmouseout="out('1659683170431033048');" style=""> 704             if (!canHandle(format.dbUrl)) {                                                              </span>
<span class="-4870909491096243891" onmouseenter="enter('-4870909491096243891');" onmouseout="out('-4870909491096243891');" style=""><abbr title=" 705                 throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl);"> 705                 throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706             }                                                                                            </span>
<span class="-4505121258189477360" onmouseenter="enter('-4505121258189477360');" onmouseout="out('-4505121258189477360');" style=""> 707             if (format.authMech == EAuthMech.Kerberos.getType()) {                                       </span>
<span class="6602839569397321565" onmouseenter="enter('6602839569397321565');" onmouseout="out('6602839569397321565');" style=""><abbr title=" 708                 checkNotNull(format.krb5confPath, &quot;When kerberos authentication is enabled, krb5confPath is required！&quot;);"> 708                 checkNotNull(format.krb5confPath, &quot;When kerberos authentication is enabled, krb5confPath 🔵</abbr></span>
<span class="2501395209161425855" onmouseenter="enter('2501395209161425855');" onmouseout="out('2501395209161425855');" style=""><abbr title=" 709                 checkNotNull(format.principal, &quot;When kerberos authentication is enabled, principal is required！&quot;);"> 709                 checkNotNull(format.principal, &quot;When kerberos authentication is enabled, principal is req🔵</abbr></span>
<span class="2944052019736374588" onmouseenter="enter('2944052019736374588');" onmouseout="out('2944052019736374588');" style=""><abbr title=" 710                 checkNotNull(format.keytabPath, &quot;When kerberos authentication is enabled, keytabPath is required！&quot;);"> 710                 checkNotNull(format.keytabPath, &quot;When kerberos authentication is enabled, keytabPath is r🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711             }                                                                                            </span>
<span class="-5111581416826137591" onmouseenter="enter('-5111581416826137591');" onmouseout="out('-5111581416826137591');" style=""> 712             if (format.authMech == EAuthMech.UserName.getType()) {                                       </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 713                 checkNotNull(format.userName, &quot;userName is required!&quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714             }                                                                                            </span>
<span class="-3238564706659558925" onmouseenter="enter('-3238564706659558925');" onmouseout="out('-3238564706659558925');" style=""> 715             if (format.authMech == EAuthMech.NameANDPassword.getType()) {                                </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 716                 checkNotNull(format.userName, &quot;userName is required!&quot;);                                  </span>
<span class="-9040493906648204146" onmouseenter="enter('-9040493906648204146');" onmouseout="out('-9040493906648204146');" style=""> 717                 checkNotNull(format.password, &quot;password is required!&quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718             }                                                                                            </span>
<span class="1310568763423505425" onmouseenter="enter('1310568763423505425');" onmouseout="out('1310568763423505425');" style=""> 719             checkNotNull(format.storeType, &quot;storeType is required!&quot;);                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 720             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 722     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723 }                                                                                                        </span>






































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-6349807778844055730" onmouseenter="enter('-6349807778844055730');" onmouseout="out('-6349807778844055730');" style="">  19  package com.dtstack.flink.sql.sink.impala;                                                                        </span>
<span  style="">  20                                                                                                                    </span>
<span class="1128057574573805325" onmouseenter="enter('1128057574573805325');" onmouseout="out('1128057574573805325');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import com.dtstack.flink.sql.classloader.ClassLoaderManager;                                                      </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  22  import com.dtstack.flink.sql.factory.DTThreadFactory;                                                             </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-8930056125403642162" onmouseenter="enter('-8930056125403642162');" onmouseout="out('-8930056125403642162');" style="">  24  import com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils;                                                       </span>
<span class="-692023547870128618" onmouseenter="enter('-692023547870128618');" onmouseout="out('-692023547870128618');" style="">  25  import com.dtstack.flink.sql.table.AbstractTableInfo;                                                             </span>

<span class="2068796536125305875" onmouseenter="enter('2068796536125305875');" onmouseout="out('2068796536125305875');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import com.dtstack.flink.sql.util.JDBCUtils;                                                                      </span>
<span class="6538493847244355843" onmouseenter="enter('6538493847244355843');" onmouseout="out('6538493847244355843');" style="">  27  import com.dtstack.flink.sql.util.KrbUtils;                                                                       </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  28  import com.google.common.collect.Maps;                                                                            </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  29  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  30  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  31  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  32  import org.apache.flink.types.Row;                                                                                </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  33  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  34  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  35  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  36                                                                                                                    </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  37  import java.io.IOException;                                                                                       </span>
<span class="7889752473047782369" onmouseenter="enter('7889752473047782369');" onmouseout="out('7889752473047782369');" style="">  38  import java.security.PrivilegedExceptionAction;                                                                   </span>
<span class="-7136330293413175449" onmouseenter="enter('-7136330293413175449');" onmouseout="out('-7136330293413175449');" style="">  39  import java.sql.Connection;                                                                                       </span>
<span class="7894029524760905232" onmouseenter="enter('7894029524760905232');" onmouseout="out('7894029524760905232');" style="">  40  import java.sql.DriverManager;                                                                                    </span>
<span class="-3337023324264694028" onmouseenter="enter('-3337023324264694028');" onmouseout="out('-3337023324264694028');" style="">  41  import java.sql.PreparedStatement;                                                                                </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  42  import java.sql.SQLException;                                                                                     </span>
<span class="6402527026259660908" onmouseenter="enter('6402527026259660908');" onmouseout="out('6402527026259660908');" style="">  43  import java.sql.Statement;                                                                                        </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  44  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  45  import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  46  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  47  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  48  import java.util.Map;                                                                                             </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  49  import java.util.Objects;                                                                                         </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  50  import java.util.Set;                                                                                             </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  51  import java.util.concurrent.ScheduledExecutorService;                                                             </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  52  import java.util.concurrent.ScheduledFuture;                                                                      </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  53  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  54  import java.util.concurrent.TimeUnit;                                                                             </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  55  import java.util.regex.Matcher;                                                                                   </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  56  import java.util.regex.Pattern;                                                                                   </span>
<span class="-6051894930872477589" onmouseenter="enter('-6051894930872477589');" onmouseout="out('-6051894930872477589');" style="">  57  import java.util.stream.Collectors;                                                                               </span>
<span  style="">  58                                                                                                                    </span>
<span class="1455633447019431220" onmouseenter="enter('1455633447019431220');" onmouseout="out('1455633447019431220');" style="">  59  import static com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils.setRecordToStatement;                           </span>
<span class="-6257877604578820371" onmouseenter="enter('-6257877604578820371');" onmouseout="out('-6257877604578820371');" style="">  60  import static org.apache.flink.util.Preconditions.checkNotNull;                                                   </span>
<span  style="">  61                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  62  /**                                                                                                               </span>
<span class="7153001641478282104" onmouseenter="enter('7153001641478282104');" onmouseout="out('7153001641478282104');" style="">  63   * Date: 2020/10/14                                                                                               </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  64   * Company: www.dtstack.com                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  65   *                                                                                                                </span>
<span class="-4100502199450942834" onmouseenter="enter('-4100502199450942834');" onmouseout="out('-4100502199450942834');" style="">  66   * @author tiezhu                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  67   */                                                                                                               </span>
<span class="-4121149390422149560" onmouseenter="enter('-4121149390422149560');" onmouseout="out('-4121149390422149560');" style="">  68  public class ImpalaOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                        </span>
<span  style="">  69                                                                                                                    </span>
<span class="-5870848474790717720" onmouseenter="enter('-5870848474790717720');" onmouseout="out('-5870848474790717720');" style="">  70      private static final Logger LOG = LoggerFactory.getLogger(ImpalaOutputFormat.class);                          </span>
<span  style="">  71                                                                                                                    </span>
<span class="-4645219268431852454" onmouseenter="enter('-4645219268431852454');" onmouseout="out('-4645219268431852454');" style="">  72      private static final long serialVersionUID = 1L;                                                              </span>
<span  style="">  73                                                                                                                    </span>
<span class="-9068282285967712029" onmouseenter="enter('-9068282285967712029');" onmouseout="out('-9068282285967712029');" style="">  74      // ${field}                                                                                                   </span>
<span class="-5949646080202310183" onmouseenter="enter('-5949646080202310183');" onmouseout="out('-5949646080202310183');" style="">  75      private static final Pattern STATIC_PARTITION_PATTERN = Pattern.compile(&quot;\\$\\{([^}]*)}&quot;);                    </span>
<span class="5956354208608974741" onmouseenter="enter('5956354208608974741');" onmouseout="out('5956354208608974741');" style="">  76      // cast(value as string) -&gt; cast(&#x27;value&#x27; as string)  cast(value as timestamp) -&gt; cast(&#x27;value&#x27; as timestamp)   </span>
<span class="1953221153478650066" onmouseenter="enter('1953221153478650066');" onmouseout="out('1953221153478650066');" style="">  77      private static final Pattern TYPE_PATTERN = Pattern.compile(&quot;cast\\((.*) as (.*)\\)&quot;);                        </span>
<span class="6992730206516090107" onmouseenter="enter('6992730206516090107');" onmouseout="out('6992730206516090107');" style="">  78      //specific type which values need to be quoted                                                                </span>
<span class="-2884666096421851487" onmouseenter="enter('-2884666096421851487');" onmouseout="out('-2884666096421851487');" style="">  79      private static final String[] NEED_QUOTE_TYPE = {&quot;string&quot;, &quot;timestamp&quot;, &quot;varchar&quot;};                           </span>
<span  style="">  80                                                                                                                    </span>
<span class="191207487610103693" onmouseenter="enter('191207487610103693');" onmouseout="out('191207487610103693');" style="">  81      private static final Integer DEFAULT_CONN_TIME_OUT = 60;                                                      </span>
<span class="-1388186840411616756" onmouseenter="enter('-1388186840411616756');" onmouseout="out('-1388186840411616756');" style="">  82      private static final int RECEIVE_DATA_PRINT_FREQUENCY = 1000;                                                 </span>
<span class="-4268888009857984730" onmouseenter="enter('-4268888009857984730');" onmouseout="out('-4268888009857984730');" style="">  83      private static final int DIRTY_DATA_PRINT_FREQUENCY = 1000;                                                   </span>
<span  style="">  84                                                                                                                    </span>
<span class="-588818051573867979" onmouseenter="enter('-588818051573867979');" onmouseout="out('-588818051573867979');" style="">  85      private static final String KUDU_TYPE = &quot;kudu&quot;;                                                               </span>
<span class="-6769623881035360393" onmouseenter="enter('-6769623881035360393');" onmouseout="out('-6769623881035360393');" style="">  86      private static final String UPDATE_MODE = &quot;update&quot;;                                                           </span>
<span class="-7709014261424944614" onmouseenter="enter('-7709014261424944614');" onmouseout="out('-7709014261424944614');" style="">  87      private static final String PARTITION_CONSTANT = &quot;PARTITION&quot;;                                                 </span>
<span class="1441081326157561113" onmouseenter="enter('1441081326157561113');" onmouseout="out('1441081326157561113');" style="">  88      private static final String DRIVER_NAME = &quot;com.cloudera.impala.jdbc41.Driver&quot;;                                </span>
<span  style="">  89                                                                                                                    </span>
<span class="-2689163518074835497" onmouseenter="enter('-2689163518074835497');" onmouseout="out('-2689163518074835497');" style="">  90      private static final String VALUES_CONDITION = &quot;${valuesCondition}&quot;;                                          </span>
<span class="3062777246713899037" onmouseenter="enter('3062777246713899037');" onmouseout="out('3062777246713899037');" style="">  91      private static final String PARTITION_CONDITION = &quot;${partitionCondition}&quot;;                                    </span>
<span class="2401236240707522557" onmouseenter="enter('2401236240707522557');" onmouseout="out('2401236240707522557');" style="">  92      private static final String TABLE_FIELDS_CONDITION = &quot;${tableFieldsCondition}&quot;;                               </span>
<span class="3255739684264436552" onmouseenter="enter('3255739684264436552');" onmouseout="out('3255739684264436552');" style="">  93      private static final String NO_PARTITION = &quot;noPartition&quot;;                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -                                                                                                                  </span>
<span class="-2123205835999557493" onmouseenter="enter('-2123205835999557493');" onmouseout="out('-2123205835999557493');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +    // partition field of static partition which matched by ${field}                                              </span>
<span class="-976040292573398488" onmouseenter="enter('-976040292573398488');" onmouseout="out('-976040292573398488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +    private final List&lt;String&gt; staticPartitionFields = new ArrayList&lt;&gt;();                                         </span>
<span class="8729932671243795004" onmouseenter="enter('8729932671243795004');" onmouseout="out('8729932671243795004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +    public List&lt;String&gt; fieldNames;                                                                               </span>
<span class="5323664213258183290" onmouseenter="enter('5323664213258183290');" onmouseout="out('5323664213258183290');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +    public List&lt;String&gt; fieldTypes;                                                                               </span>
<span class="589573262942162938" onmouseenter="enter('589573262942162938');" onmouseout="out('589573262942162938');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +    public List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList;                                             </span>
<span class="-7445073777200404714" onmouseenter="enter('-7445073777200404714');" onmouseout="out('-7445073777200404714');" style=""> 100      protected transient Connection connection;                                                                    </span>
<span class="-2184169902108079684" onmouseenter="enter('-2184169902108079684');" onmouseout="out('-2184169902108079684');" style=""> 101      protected transient Statement statement;                                                                      </span>
<span class="6238382839663594696" onmouseenter="enter('6238382839663594696');" onmouseout="out('6238382839663594696');" style=""> 102      protected transient PreparedStatement updateStatement;                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -                                                                                                                  </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -    private transient volatile boolean closed = false;                                                            </span>
<span class="8220840984571392918" onmouseenter="enter('8220840984571392918');" onmouseout="out('8220840984571392918');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -    private int batchCount = 0;                                                                                   </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -                                                                                                                  </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 107 -    // |------------------------------------------------|                                                         </span>
<span class="-789927222958732888" onmouseenter="enter('-789927222958732888');" onmouseout="out('-789927222958732888');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -    // |   partitionCondition   |Array of valueCondition|                                                         </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -    // |------------------------------------------------|                                                         </span>
<span class="-8825804998995953162" onmouseenter="enter('-8825804998995953162');" onmouseout="out('-8825804998995953162');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -    // | ptOne, ptTwo, ptThree  | [(v1, v2, v3, v4, v5)]|   DP                                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -    // |------------------------------------------------|                                                         </span>
<span class="-5802382310877164118" onmouseenter="enter('-5802382310877164118');" onmouseout="out('-5802382310877164118');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -    // | ptOne = v1, ptTwo = v2 | [(v3, v4, v5)]        |   SP                                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -    // |------------------------------------------------|                                                         </span>
<span class="2984234039288316275" onmouseenter="enter('2984234039288316275');" onmouseout="out('2984234039288316275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -    // | ptOne, ptTwo = v2      | [(v1, v3, v4, v5)]    |   DP and SP                                             </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -    // |------------------------------------------------|                                                         </span>
<span class="7219405512764117222" onmouseenter="enter('7219405512764117222');" onmouseout="out('7219405512764117222');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -    // | noPartition            | [(v1, v2, v3, v4, v5)]|   kudu or disablePartition                              </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -    // |------------------------------------------------|                                                         </span>
<span class="9020411500856357590" onmouseenter="enter('9020411500856357590');" onmouseout="out('9020411500856357590');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -    private transient Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap;                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -                                                                                                                  </span>
<span class="-4172535577750872346" onmouseenter="enter('-4172535577750872346');" onmouseout="out('-4172535577750872346');" style=""> 120      protected String keytabPath;                                                                                  </span>
<span class="1987487277257130103" onmouseenter="enter('1987487277257130103');" onmouseout="out('1987487277257130103');" style=""> 121      protected String krb5confPath;                                                                                </span>
<span class="3478885111338451838" onmouseenter="enter('3478885111338451838');" onmouseout="out('3478885111338451838');" style=""> 122      protected String principal;                                                                                   </span>
<span class="-2673327721248325609" onmouseenter="enter('-2673327721248325609');" onmouseout="out('-2673327721248325609');" style=""> 123      protected Integer authMech;                                                                                   </span>
<span class="-8834882937031238604" onmouseenter="enter('-8834882937031238604');" onmouseout="out('-8834882937031238604');" style=""> 124      protected String dbUrl;                                                                                       </span>
<span class="4348689613054045460" onmouseenter="enter('4348689613054045460');" onmouseout="out('4348689613054045460');" style=""> 125      protected String userName;                                                                                    </span>
<span class="519247125889688558" onmouseenter="enter('519247125889688558');" onmouseout="out('519247125889688558');" style=""> 126      protected String password;                                                                                    </span>
<span class="-7554929939288236010" onmouseenter="enter('-7554929939288236010');" onmouseout="out('-7554929939288236010');" style=""> 127      protected int batchSize = 100;                                                                                </span>
<span class="8848445520039039194" onmouseenter="enter('8848445520039039194');" onmouseout="out('8848445520039039194');" style=""> 128      protected long batchWaitInterval = 60 * 1000L;                                                                </span>
<span class="6924126392600265325" onmouseenter="enter('6924126392600265325');" onmouseout="out('6924126392600265325');" style=""> 129      protected String tableName;                                                                                   </span>
<span class="-8067881189136281922" onmouseenter="enter('-8067881189136281922');" onmouseout="out('-8067881189136281922');" style=""> 130      protected List&lt;String&gt; primaryKeys;                                                                           </span>
<span class="-1238809985534246985" onmouseenter="enter('-1238809985534246985');" onmouseout="out('-1238809985534246985');" style=""> 131      protected String partitionFields;                                                                             </span>
<span class="-2843446813182919439" onmouseenter="enter('-2843446813182919439');" onmouseout="out('-2843446813182919439');" style=""> 132      protected Boolean enablePartition;                                                                            </span>
<span class="3349082107931708476" onmouseenter="enter('3349082107931708476');" onmouseout="out('3349082107931708476');" style=""> 133      protected String schema;                                                                                      </span>
<span class="-2869920961807604939" onmouseenter="enter('-2869920961807604939');" onmouseout="out('-2869920961807604939');" style=""> 134      protected String storeType;                                                                                   </span>
<span class="-7730622042083062639" onmouseenter="enter('-7730622042083062639');" onmouseout="out('-7730622042083062639');" style=""> 135      protected String updateMode;                                                                                  </span>
<span class="8729932671243795004" onmouseenter="enter('8729932671243795004');" onmouseout="out('8729932671243795004');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -    public List&lt;String&gt; fieldNames;                                                                               </span>
<span class="5323664213258183290" onmouseenter="enter('5323664213258183290');" onmouseout="out('5323664213258183290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -    public List&lt;String&gt; fieldTypes;                                                                               </span>
<span class="589573262942162938" onmouseenter="enter('589573262942162938');" onmouseout="out('589573262942162938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -    public List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList;                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -                                                                                                                  </span>
<span class="-2123205835999557493" onmouseenter="enter('-2123205835999557493');" onmouseout="out('-2123205835999557493');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -    // partition field of static partition which matched by ${field}                                              </span>
<span class="-976040292573398488" onmouseenter="enter('-976040292573398488');" onmouseout="out('-976040292573398488');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -    private final List&lt;String&gt; staticPartitionFields = new ArrayList&lt;&gt;();                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -                                                                                                                  </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +    private transient volatile boolean closed = false;                                                            </span>
<span class="8220840984571392918" onmouseenter="enter('8220840984571392918');" onmouseout="out('8220840984571392918');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +    private int batchCount = 0;                                                                                   </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +    // |------------------------------------------------|                                                         </span>
<span class="-789927222958732888" onmouseenter="enter('-789927222958732888');" onmouseout="out('-789927222958732888');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +    // |   partitionCondition   |Array of valueCondition|                                                         </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +    // |------------------------------------------------|                                                         </span>
<span class="-8825804998995953162" onmouseenter="enter('-8825804998995953162');" onmouseout="out('-8825804998995953162');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +    // | ptOne, ptTwo, ptThree  | [(v1, v2, v3, v4, v5)]|   DP                                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +    // |------------------------------------------------|                                                         </span>
<span class="-5802382310877164118" onmouseenter="enter('-5802382310877164118');" onmouseout="out('-5802382310877164118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +    // | ptOne = v1, ptTwo = v2 | [(v3, v4, v5)]        |   SP                                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +    // |------------------------------------------------|                                                         </span>
<span class="2984234039288316275" onmouseenter="enter('2984234039288316275');" onmouseout="out('2984234039288316275');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +    // | ptOne, ptTwo = v2      | [(v1, v3, v4, v5)]    |   DP and SP                                             </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +    // |------------------------------------------------|                                                         </span>
<span class="7219405512764117222" onmouseenter="enter('7219405512764117222');" onmouseout="out('7219405512764117222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +    // | noPartition            | [(v1, v2, v3, v4, v5)]|   kudu or disablePartition                              </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +    // |------------------------------------------------|                                                         </span>
<span class="9020411500856357590" onmouseenter="enter('9020411500856357590');" onmouseout="out('9020411500856357590');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +    private transient Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap;                                                  </span>
<span class="8461763253073029471" onmouseenter="enter('8461763253073029471');" onmouseout="out('8461763253073029471');" style=""> 157      // valueFieldsName -&gt; 重组之后的fieldNames，为了重组row data字段值对应                                                       </span>
<span class="-5473349939362349748" onmouseenter="enter('-5473349939362349748');" onmouseout="out('-5473349939362349748');" style=""> 158      // 需要对partition字段做特殊处理，比如原来的字段顺序为(age, name, id)，但是因为partition，写入的SQL为                                        </span>
<span class="888010466316090175" onmouseenter="enter('888010466316090175');" onmouseout="out('888010466316090175');" style=""> 159      // INSERT INTO tableName(name, id) PARTITION(age) VALUES(?, ?, ?)                                             </span>
<span class="1229277488566704041" onmouseenter="enter('1229277488566704041');" onmouseout="out('1229277488566704041');" style=""> 160      // 那么实际executeSql设置字段的顺序应该为(name, id, age)，同时，字段对应的type顺序也需要重组                                                </span>
<span class="6098973354216055964" onmouseenter="enter('6098973354216055964');" onmouseout="out('6098973354216055964');" style=""> 161      private List&lt;String&gt; valueFieldNames;                                                                         </span>
<span class="-7108089166418781511" onmouseenter="enter('-7108089166418781511');" onmouseout="out('-7108089166418781511');" style=""> 162      private transient AbstractDtRichOutputFormat&lt;?&gt; metricOutputFormat;                                           </span>
<span class="273368026714901275" onmouseenter="enter('273368026714901275');" onmouseout="out('273368026714901275');" style=""> 163      private List&lt;Row&gt; rows;                                                                                       </span>
<span  style=""> 164                                                                                                                    </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style=""> 165      private transient ScheduledExecutorService scheduler;                                                         </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style=""> 166      private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +                                                                                                                  </span>
<span class="-2481914402933088399" onmouseenter="enter('-2481914402933088399');" onmouseout="out('-2481914402933088399');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +    public static Builder getImpalaBuilder() {                                                                    </span>
<span class="-1926211775479526780" onmouseenter="enter('-1926211775479526780');" onmouseout="out('-1926211775479526780');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +        return new Builder();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +    }                                                                                                             </span>
<span  style=""> 171                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 172      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 173      public void configure(Configuration parameters) {                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174      }                                                                                                             </span>
<span  style=""> 175                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 176      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 177      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 178          try {                                                                                                     </span>
<span class="4324779626821739975" onmouseenter="enter('4324779626821739975');" onmouseout="out('4324779626821739975');" style=""> 179              rowDataMap = new HashMap&lt;&gt;();                                                                         </span>
<span class="-6551372933934183741" onmouseenter="enter('-6551372933934183741');" onmouseout="out('-6551372933934183741');" style=""> 180              rows = new ArrayList&lt;&gt;();                                                                             </span>
<span class="-7937337195293668220" onmouseenter="enter('-7937337195293668220');" onmouseout="out('-7937337195293668220');" style=""> 181              metricOutputFormat = this;                                                                            </span>
<span class="-8035752082134444550" onmouseenter="enter('-8035752082134444550');" onmouseout="out('-8035752082134444550');" style=""> 182              openConnect();                                                                                        </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 183              initScheduledTask(batchWaitInterval);                                                                 </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style=""> 184              init();                                                                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 185              initMetric();                                                                                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 186          } catch (Exception e) {                                                                                   </span>
<span class="-105883012207117402" onmouseenter="enter('-105883012207117402');" onmouseout="out('-105883012207117402');" style=""> 187              throw new RuntimeException(&quot;impala output format open error!&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189      }                                                                                                             </span>
<span  style=""> 190                                                                                                                    </span>
<span class="-8578201295687943948" onmouseenter="enter('-8578201295687943948');" onmouseout="out('-8578201295687943948');" style=""> 191      private void init() throws SQLException {                                                                     </span>
<span class="-8350145873279772804" onmouseenter="enter('-8350145873279772804');" onmouseout="out('-8350145873279772804');" style=""> 192          if (Objects.nonNull(partitionFields)) {                                                                   </span>
<span class="8590422903839909721" onmouseenter="enter('8590422903839909721');" onmouseout="out('8590422903839909721');" style=""> 193              // match ${field} from partitionFields                                                                </span>
<span class="399614494149678967" onmouseenter="enter('399614494149678967');" onmouseout="out('399614494149678967');" style=""> 194              Matcher matcher = STATIC_PARTITION_PATTERN.matcher(partitionFields);                                  </span>
<span class="-5488916631119752457" onmouseenter="enter('-5488916631119752457');" onmouseout="out('-5488916631119752457');" style=""> 195              while (matcher.find()) {                                                                              </span>
<span class="-1180668930060799754" onmouseenter="enter('-1180668930060799754');" onmouseout="out('-1180668930060799754');" style=""> 196                  LOG.info(&quot;find static partition field: {}&quot;, matcher.group(1));                                    </span>
<span class="5933786634924389530" onmouseenter="enter('5933786634924389530');" onmouseout="out('5933786634924389530');" style=""> 197                  staticPartitionFields.add(matcher.group(1));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199          }                                                                                                         </span>
<span  style=""> 200                                                                                                                    </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 201          if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                           </span>
<span class="-511688609314859464" onmouseenter="enter('-511688609314859464');" onmouseout="out('-511688609314859464');" style=""> 202              if (!storeType.equalsIgnoreCase(KUDU_TYPE)) {                                                         </span>
<span class="7738691828431171650" onmouseenter="enter('7738691828431171650');" onmouseout="out('7738691828431171650');" style=""> 203                  throw new IllegalArgumentException(&quot;update mode not support for non-kudu table!&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204              }                                                                                                     </span>
<span class="-1926567860735108753" onmouseenter="enter('-1926567860735108753');" onmouseout="out('-1926567860735108753');" style=""><abbr title=" 205              updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, primaryKeys));"> 205              updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, primaryKey🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 206          } else {                                                                                                  </span>
<span class="5264299831364970974" onmouseenter="enter('5264299831364970974');" onmouseout="out('5264299831364970974');" style=""><abbr title=" 207              valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTypes, partitionFields);"> 207              valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTypes, parti🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208          }                                                                                                         </span>
<span  style=""> 209                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210      }                                                                                                             </span>
<span  style=""> 211                                                                                                                    </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 212      private void initScheduledTask(Long batchWaitInterval) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 213          try {                                                                                                     </span>
<span class="-5481453632006175071" onmouseenter="enter('-5481453632006175071');" onmouseout="out('-5481453632006175071');" style=""> 214              if (batchWaitInterval != 0) {                                                                         </span>
<span class="777682131179381780" onmouseenter="enter('777682131179381780');" onmouseout="out('777682131179381780');" style=""> 215                  this.scheduler = new ScheduledThreadPoolExecutor(1,                                               </span>
<span class="714213466749562787" onmouseenter="enter('714213466749562787');" onmouseout="out('714213466749562787');" style=""> 216                          new DTThreadFactory(&quot;impala-upsert-output-format&quot;));                                      </span>
<span class="-7149116985444787635" onmouseenter="enter('-7149116985444787635');" onmouseout="out('-7149116985444787635');" style=""> 217                  this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(() -&gt; {                              </span>
<span class="-940414522275968791" onmouseenter="enter('-940414522275968791');" onmouseout="out('-940414522275968791');" style=""> 218                      synchronized (ImpalaOutputFormat.this) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 219                          try {                                                                                     </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 220                              flush();                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 221                          } catch (Exception e) {                                                                   </span>
<span class="-5628183046854957718" onmouseenter="enter('-5628183046854957718');" onmouseout="out('-5628183046854957718');" style=""> 222                              LOG.error(&quot;Writing records to impala jdbc failed.&quot;, e);                               </span>
<span class="-7023774051195191894" onmouseenter="enter('-7023774051195191894');" onmouseout="out('-7023774051195191894');" style=""> 223                              throw new RuntimeException(&quot;Writing records to impala jdbc failed.&quot;, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224                          }                                                                                         </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                      }                                                                                             </span>
<span class="8465771028460365894" onmouseenter="enter('8465771028460365894');" onmouseout="out('8465771028460365894');" style=""> 226                  }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 228          } catch (Exception e) {                                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 229              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231      }                                                                                                             </span>
<span  style=""> 232                                                                                                                    </span>
<span class="-2844613068709206340" onmouseenter="enter('-2844613068709206340');" onmouseout="out('-2844613068709206340');" style=""> 233      private void openConnect() throws IOException {                                                               </span>
<span class="-2394055578891206899" onmouseenter="enter('-2394055578891206899');" onmouseout="out('-2394055578891206899');" style=""> 234          if (authMech == 1) {                                                                                      </span>
<span class="-7445609792053649263" onmouseenter="enter('-7445609792053649263');" onmouseout="out('-7445609792053649263');" style=""> 235              UserGroupInformation ugi = KrbUtils.loginAndReturnUgi(principal, keytabPath, krb5confPath);           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 236              try {                                                                                                 </span>
<span class="1057249312142684394" onmouseenter="enter('1057249312142684394');" onmouseout="out('1057249312142684394');" style=""> 237                  ugi.doAs((PrivilegedExceptionAction&lt;Void&gt;) () -&gt; {                                                </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 238                      openJdbc();                                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 239                      return null;                                                                                  </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 240                  });                                                                                               </span>
<span class="3693318474890767753" onmouseenter="enter('3693318474890767753');" onmouseout="out('3693318474890767753');" style=""> 241              } catch (InterruptedException | IOException e) {                                                      </span>
<span class="-3216725393010457363" onmouseenter="enter('-3216725393010457363');" onmouseout="out('-3216725393010457363');" style=""> 242                  throw new IllegalArgumentException(&quot;connect impala error!&quot;, e);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 244          } else {                                                                                                  </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 245              openJdbc();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247      }                                                                                                             </span>
<span  style=""> 248                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 249      /**                                                                                                           </span>
<span class="-4019084214603833891" onmouseenter="enter('-4019084214603833891');" onmouseout="out('-4019084214603833891');" style=""> 250       * get jdbc connection                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 251       */                                                                                                           </span>
<span class="6517717324631316532" onmouseenter="enter('6517717324631316532');" onmouseout="out('6517717324631316532');" style=""> 252      private void openJdbc() {                                                                                     </span>
<span class="-5989471214664392944" onmouseenter="enter('-5989471214664392944');" onmouseout="out('-5989471214664392944');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 253 -        JDBCUtils.forName(DRIVER_NAME, getClass().getClassLoader());                                              </span>
<span class="7396081792504852616" onmouseenter="enter('7396081792504852616');" onmouseout="out('7396081792504852616');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +        ClassLoaderManager.forName(DRIVER_NAME, getClass().getClassLoader());                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 255          try {                                                                                                     </span>
<span class="-4188974437029144237" onmouseenter="enter('-4188974437029144237');" onmouseout="out('-4188974437029144237');" style=""> 256              connection = DriverManager.getConnection(dbUrl, userName, password);                                  </span>
<span class="-3909190598463408725" onmouseenter="enter('-3909190598463408725');" onmouseout="out('-3909190598463408725');" style=""> 257              statement = connection.createStatement();                                                             </span>
<span class="1164602517684291637" onmouseenter="enter('1164602517684291637');" onmouseout="out('1164602517684291637');" style=""> 258              connection.setAutoCommit(false);                                                                      </span>
<span class="-2037802754415730828" onmouseenter="enter('-2037802754415730828');" onmouseout="out('-2037802754415730828');" style=""> 259          } catch (SQLException sqlException) {                                                                     </span>
<span class="8417232372887360387" onmouseenter="enter('8417232372887360387');" onmouseout="out('8417232372887360387');" style=""> 260              throw new RuntimeException(&quot;get impala jdbc connection failed!&quot;, sqlException);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262      }                                                                                                             </span>
<span  style=""> 263                                                                                                                    </span>
<span class="7521208138226245516" onmouseenter="enter('7521208138226245516');" onmouseout="out('7521208138226245516');" style=""> 264      private void flush() throws Exception {                                                                       </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 265          if (batchCount &gt; 0) {                                                                                     </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 266              if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                       </span>
<span class="-7210745719484505959" onmouseenter="enter('-7210745719484505959');" onmouseout="out('-7210745719484505959');" style=""> 267                  executeUpdateBatch();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268              }                                                                                                     </span>
<span class="-5565980137871755476" onmouseenter="enter('-5565980137871755476');" onmouseout="out('-5565980137871755476');" style=""> 269              if (!rowDataMap.isEmpty()) {                                                                          </span>
<span class="8546814641173072756" onmouseenter="enter('8546814641173072756');" onmouseout="out('8546814641173072756');" style=""> 270                  String templateSql =                                                                              </span>








<span class="-1766017053596733683" onmouseenter="enter('-1766017053596733683');" onmouseout="out('-1766017053596733683');" style=""><abbr title=" 271                          &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VALUES ${valuesCondition}&quot;;"> 271                          &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VALUES ${va🔵</abbr></span>
<span class="7007887973141057675" onmouseenter="enter('7007887973141057675');" onmouseout="out('7007887973141057675');" style=""> 272                  executeBatchSql(                                                                                  </span>
<span class="839015566868436312" onmouseenter="enter('839015566868436312');" onmouseout="out('839015566868436312');" style=""> 273                          statement,                                                                                </span>

<span class="-8931083358346849072" onmouseenter="enter('-8931083358346849072');" onmouseout="out('-8931083358346849072');" style=""> 274                          templateSql,                                                                              </span>
<span class="5582129011297069726" onmouseenter="enter('5582129011297069726');" onmouseout="out('5582129011297069726');" style=""> 275                          schema,                                                                                   </span>
<span class="8599198975592615021" onmouseenter="enter('8599198975592615021');" onmouseout="out('8599198975592615021');" style=""> 276                          tableName,                                                                                </span>
<span class="7739930709415439240" onmouseenter="enter('7739930709415439240');" onmouseout="out('7739930709415439240');" style=""> 277                          storeType,                                                                                </span>
<span class="4460343981916954231" onmouseenter="enter('4460343981916954231');" onmouseout="out('4460343981916954231');" style=""> 278                          enablePartition,                                                                          </span>
<span class="-232795436679668454" onmouseenter="enter('-232795436679668454');" onmouseout="out('-232795436679668454');" style=""> 279                          valueFieldNames,                                                                          </span>
<span class="2377300059169474736" onmouseenter="enter('2377300059169474736');" onmouseout="out('2377300059169474736');" style=""> 280                          partitionFields,                                                                          </span>
<span class="-163268273074797630" onmouseenter="enter('-163268273074797630');" onmouseout="out('-163268273074797630');" style=""> 281                          rowDataMap                                                                                </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 282                  );                                                                                                </span>
<span class="1629791312198735010" onmouseenter="enter('1629791312198735010');" onmouseout="out('1629791312198735010');" style=""> 283                  rowDataMap.clear();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285          }                                                                                                         </span>
<span class="-5311733944590264805" onmouseenter="enter('-5311733944590264805');" onmouseout="out('-5311733944590264805');" style=""> 286          batchCount = 0;                                                                                           </span>
<span  style=""> 287                                                                                                                    </span>









<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288      }                                                                                                             </span>
<span  style=""> 289                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 290      /**                                                                                                           </span>
<span class="-1106181825212481278" onmouseenter="enter('-1106181825212481278');" onmouseout="out('-1106181825212481278');" style=""> 291       * execute batch update statement                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 292       *                                                                                                            </span>
<span class="3560665881375675274" onmouseenter="enter('3560665881375675274');" onmouseout="out('3560665881375675274');" style=""> 293       * @throws SQLException throw sql exception                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 294       */                                                                                                           </span>
<span class="3206601587144870407" onmouseenter="enter('3206601587144870407');" onmouseout="out('3206601587144870407');" style=""> 295      private void executeUpdateBatch() throws SQLException {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 296          try {                                                                                                     </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 297              rows.forEach(row -&gt; {                                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 298                  try {                                                                                             </span>
<span class="-1215139546593028546" onmouseenter="enter('-1215139546593028546');" onmouseout="out('-1215139546593028546');" style=""> 299                      JDBCTypeConvertUtils.setRecordToStatement(                                                    </span>
<span class="-4710389352980966846" onmouseenter="enter('-4710389352980966846');" onmouseout="out('-4710389352980966846');" style=""> 300                              updateStatement,                                                                      </span>
<span class="4668718668329814914" onmouseenter="enter('4668718668329814914');" onmouseout="out('4668718668329814914');" style=""> 301                              JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes),                             </span>
<span class="-7576027683765873339" onmouseenter="enter('-7576027683765873339');" onmouseout="out('-7576027683765873339');" style=""> 302                              row,                                                                                  </span>
<span class="-255277236311302851" onmouseenter="enter('-255277236311302851');" onmouseout="out('-255277236311302851');" style=""> 303                              primaryKeys.stream().mapToInt(fieldNames::indexOf).toArray()                          </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 304                      );                                                                                            </span>
<span class="-4238050377414791796" onmouseenter="enter('-4238050377414791796');" onmouseout="out('-4238050377414791796');" style=""> 305                      updateStatement.addBatch();                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 306                  } catch (Exception e) {                                                                           </span>
<span class="5068376771892501659" onmouseenter="enter('5068376771892501659');" onmouseout="out('5068376771892501659');" style=""> 307                      throw new RuntimeException(&quot;impala jdbc execute batch error!&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308                  }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 309              });                                                                                                   </span>
<span class="-3747739502872154032" onmouseenter="enter('-3747739502872154032');" onmouseout="out('-3747739502872154032');" style=""> 310              updateStatement.executeBatch();                                                                       </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 311              connection.commit();                                                                                  </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 312              rows.clear();                                                                                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 313          } catch (Exception e) {                                                                                   </span>
<span class="1715728751446881781" onmouseenter="enter('1715728751446881781');" onmouseout="out('1715728751446881781');" style=""> 314              LOG.debug(&quot;impala jdbc execute batch error &quot;, e);                                                     </span>
<span class="7087468057749493272" onmouseenter="enter('7087468057749493272');" onmouseout="out('7087468057749493272');" style=""> 315              connection.rollback();                                                                                </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 316              connection.commit();                                                                                  </span>


<span class="-4187732730208785389" onmouseenter="enter('-4187732730208785389');" onmouseout="out('-4187732730208785389');" style=""> 317              updateStatement.clearBatch();                                                                         </span>
<span class="-8814080953460465644" onmouseenter="enter('-8814080953460465644');" onmouseout="out('-8814080953460465644');" style=""> 318              executeUpdate(connection);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320      }                                                                                                             </span>
<span  style=""> 321                                                                                                                    </span>
<span class="-4847686400566224446" onmouseenter="enter('-4847686400566224446');" onmouseout="out('-4847686400566224446');" style=""> 322      public void executeUpdate(Connection connection) {                                                            </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 323          rows.forEach(row -&gt; {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 324              try {                                                                                                 </span>
<span class="3018395377218617369" onmouseenter="enter('3018395377218617369');" onmouseout="out('3018395377218617369');" style=""><abbr title=" 325                  setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), row);"> 325                  setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), ro🔵</abbr></span>
<span class="-6547782628025070914" onmouseenter="enter('-6547782628025070914');" onmouseout="out('-6547782628025070914');" style=""> 326                  updateStatement.executeUpdate();                                                                  </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 327                  connection.commit();                                                                              </span>

<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 328              } catch (Exception e) {                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 329                  try {                                                                                             </span>
<span class="7087468057749493272" onmouseenter="enter('7087468057749493272');" onmouseout="out('7087468057749493272');" style=""> 330                      connection.rollback();                                                                        </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 331                      connection.commit();                                                                          </span>
<span class="-9008476763811710828" onmouseenter="enter('-9008476763811710828');" onmouseout="out('-9008476763811710828');" style=""> 332                  } catch (SQLException e1) {                                                                       </span>
<span class="-2635323073569974258" onmouseenter="enter('-2635323073569974258');" onmouseout="out('-2635323073569974258');" style=""> 333                      throw new RuntimeException(e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334                  }                                                                                                 </span>


<span class="-4808081927273297919" onmouseenter="enter('-4808081927273297919');" onmouseout="out('-4808081927273297919');" style=""><abbr title=" 335                  if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {"> 335                  if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebug🔵</abbr></span>
<span class="-2764908242367356599" onmouseenter="enter('-2764908242367356599');" onmouseout="out('-2764908242367356599');" style=""> 336                      LOG.error(&quot;record insert failed ,this row is {}&quot;, row.toString());                            </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 337                      LOG.error(&quot;&quot;, e);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338                  }                                                                                                 </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 339                  metricOutputFormat.outDirtyRecords.inc();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 341          });                                                                                                       </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 342          rows.clear();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343      }                                                                                                             </span>
<span  style=""> 344                                                                                                                    </span>
<span class="5541545914698662583" onmouseenter="enter('5541545914698662583');" onmouseout="out('5541545914698662583');" style=""> 345      private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData) {       </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 346          Set&lt;String&gt; keySet = rowDataMap.keySet();                                                                 </span>
<span class="-4115511162008757651" onmouseenter="enter('-4115511162008757651');" onmouseout="out('-4115511162008757651');" style=""> 347          ArrayList&lt;String&gt; tempRowArray;                                                                           </span>
<span class="-6312285345137005178" onmouseenter="enter('-6312285345137005178');" onmouseout="out('-6312285345137005178');" style=""> 348          if (keySet.contains(rowData.f0)) {                                                                        </span>
<span class="2063657660163215007" onmouseenter="enter('2063657660163215007');" onmouseout="out('2063657660163215007');" style=""> 349              tempRowArray = rowDataMap.get(rowData.f0);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 350          } else {                                                                                                  </span>
<span class="7109917545131433172" onmouseenter="enter('7109917545131433172');" onmouseout="out('7109917545131433172');" style=""> 351              tempRowArray = new ArrayList&lt;&gt;();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352          }                                                                                                         </span>
<span class="1467529594977533778" onmouseenter="enter('1467529594977533778');" onmouseout="out('1467529594977533778');" style=""> 353          tempRowArray.add(rowData.f1);                                                                             </span>
<span class="6767865840186405987" onmouseenter="enter('6767865840186405987');" onmouseout="out('6767865840186405987');" style=""> 354          rowDataMap.put(rowData.f0, tempRowArray);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355      }                                                                                                             </span>
<span  style=""> 356                                                                                                                    </span>
<span class="3578278218776325408" onmouseenter="enter('3578278218776325408');" onmouseout="out('3578278218776325408');" style=""><abbr title=" 357      private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPartitionFields, List&lt;String&gt; fieldTypes, String partitionFields) {"> 357      private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPartitionFiel🔵</abbr></span>
<span class="-4698577817001148605" onmouseenter="enter('-4698577817001148605');" onmouseout="out('-4698577817001148605');" style=""> 358          if (partitionFields == null || partitionFields.isEmpty()) {                                               </span>
<span class="2916035488958294792" onmouseenter="enter('2916035488958294792');" onmouseout="out('2916035488958294792');" style=""> 359              return fieldNames;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360          }                                                                                                         </span>
<span  style=""> 361                                                                                                                    </span>
<span class="7990418778069769767" onmouseenter="enter('7990418778069769767');" onmouseout="out('7990418778069769767');" style=""> 362          List&lt;String&gt; valueFields = new ArrayList&lt;&gt;(fieldNames);                                                   </span>
<span  style=""> 363                                                                                                                    </span>
<span class="2302239674432319726" onmouseenter="enter('2302239674432319726');" onmouseout="out('2302239674432319726');" style=""> 364          for (int i = valueFields.size() - 1; i &gt;= 0; i--) {                                                       </span>
<span class="-8004931019804249555" onmouseenter="enter('-8004931019804249555');" onmouseout="out('-8004931019804249555');" style=""> 365              if (staticPartitionFields.contains(fieldNames.get(i))) {                                              </span>
<span class="-3872161480019783193" onmouseenter="enter('-3872161480019783193');" onmouseout="out('-3872161480019783193');" style=""> 366                  valueFields.remove(i);                                                                            </span>
<span class="5504621354582269117" onmouseenter="enter('5504621354582269117');" onmouseout="out('5504621354582269117');" style=""> 367                  fieldTypes.remove(i);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369          }                                                                                                         </span>
<span  style=""> 370                                                                                                                    </span>
<span class="8724369392835521335" onmouseenter="enter('8724369392835521335');" onmouseout="out('8724369392835521335');" style=""> 371          for (int i = 0; i &lt; valueFields.size(); i++) {                                                            </span>
<span class="4573573241123850638" onmouseenter="enter('4573573241123850638');" onmouseout="out('4573573241123850638');" style=""> 372              if (partitionFields.contains(fieldNames.get(i))) {                                                    </span>
<span class="-6733214010943616061" onmouseenter="enter('-6733214010943616061');" onmouseout="out('-6733214010943616061');" style=""> 373                  valueFields.add(valueFields.remove(i));                                                           </span>
<span class="3100686975272655596" onmouseenter="enter('3100686975272655596');" onmouseout="out('3100686975272655596');" style=""> 374                  fieldTypes.add(fieldTypes.remove(i));                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376          }                                                                                                         </span>
<span  style=""> 377                                                                                                                    </span>
<span class="-4055330890426471630" onmouseenter="enter('-4055330890426471630');" onmouseout="out('-4055330890426471630');" style=""> 378          return valueFields;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379      }                                                                                                             </span>
<span  style=""> 380                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 381      /**                                                                                                           </span>
<span class="-8974785826875952090" onmouseenter="enter('-8974785826875952090');" onmouseout="out('-8974785826875952090');" style=""> 382       * Quote a specific type of value, like string, timestamp                                                     </span>
<span class="-6015231753011783708" onmouseenter="enter('-6015231753011783708');" onmouseout="out('-6015231753011783708');" style=""> 383       * before: 1, cast(tiezhu as string), cast(2001-01-09 01:05:01 as timestamp), cast(123 as int)                </span>
<span class="-9072843877687738552" onmouseenter="enter('-9072843877687738552');" onmouseout="out('-9072843877687738552');" style=""> 384       * after: 1, cast(&#x27;tiezhu&#x27; as string), cast(&#x27;2001-01-09 01:05:01&#x27; as timestamp), cast(123 as int)             </span>
<span class="1334750812652161584" onmouseenter="enter('1334750812652161584');" onmouseout="out('1334750812652161584');" style=""> 385       * if cast value is null, then cast(null as type)                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 386       *                                                                                                            </span>
<span class="-7193371921927395943" onmouseenter="enter('-7193371921927395943');" onmouseout="out('-7193371921927395943');" style=""> 387       * @param valueCondition original value condition                                                             </span>
<span class="-4015247136226058388" onmouseenter="enter('-4015247136226058388');" onmouseout="out('-4015247136226058388');" style=""> 388       * @return quoted condition                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 389       */                                                                                                           </span>
<span class="-8514684189215878898" onmouseenter="enter('-8514684189215878898');" onmouseout="out('-8514684189215878898');" style=""> 390      private String valueConditionAddQuotation(String valueCondition) {                                            </span>
<span class="-7296893889335175056" onmouseenter="enter('-7296893889335175056');" onmouseout="out('-7296893889335175056');" style=""> 391          String[] temps = valueCondition.split(&quot;,&quot;);                                                               </span>
<span class="936116613567496626" onmouseenter="enter('936116613567496626');" onmouseout="out('936116613567496626');" style=""> 392          List&lt;String&gt; replacedItem = new ArrayList&lt;&gt;();                                                            </span>
<span class="-3322970786555187036" onmouseenter="enter('-3322970786555187036');" onmouseout="out('-3322970786555187036');" style=""> 393          Arrays.stream(temps).forEach(                                                                             </span>
<span class="4635365489417489024" onmouseenter="enter('4635365489417489024');" onmouseout="out('4635365489417489024');" style=""> 394                  item -&gt; {                                                                                         </span>
<span class="-4536988729093203149" onmouseenter="enter('-4536988729093203149');" onmouseout="out('-4536988729093203149');" style=""> 395                      Matcher matcher = TYPE_PATTERN.matcher(item);                                                 </span>
<span class="-5488916631119752457" onmouseenter="enter('-5488916631119752457');" onmouseout="out('-5488916631119752457');" style=""> 396                      while (matcher.find()) {                                                                      </span>
<span class="4482463139402405127" onmouseenter="enter('4482463139402405127');" onmouseout="out('4482463139402405127');" style=""> 397                          String value = matcher.group(1);                                                          </span>
<span class="-7401464861945434758" onmouseenter="enter('-7401464861945434758');" onmouseout="out('-7401464861945434758');" style=""> 398                          String type = matcher.group(2);                                                           </span>
<span  style=""> 399                                                                                                                    </span>
<span class="173086077329077799" onmouseenter="enter('173086077329077799');" onmouseout="out('173086077329077799');" style=""> 400                          for (String needQuoteType : NEED_QUOTE_TYPE) {                                            </span>
<span class="-6207157170096749111" onmouseenter="enter('-6207157170096749111');" onmouseout="out('-6207157170096749111');" style=""> 401                              if (type.contains(needQuoteType)) {                                                   </span>
<span class="8347227757103419143" onmouseenter="enter('8347227757103419143');" onmouseout="out('8347227757103419143');" style=""> 402                                  if (!&quot;null&quot;.equals(value)) {                                                      </span>
<span class="-4537434762580953169" onmouseenter="enter('-4537434762580953169');" onmouseout="out('-4537434762580953169');" style=""> 403                                      item = item.replace(value, &quot;&#x27;&quot; + value + &quot;&#x27;&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407                      }                                                                                             </span>
<span class="8193346150481678438" onmouseenter="enter('8193346150481678438');" onmouseout="out('8193346150481678438');" style=""> 408                      replacedItem.add(item);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409                  }                                                                                                 </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 410          );                                                                                                        </span>
<span  style=""> 411                                                                                                                    </span>
<span class="7763750891527797776" onmouseenter="enter('7763750891527797776');" onmouseout="out('7763750891527797776');" style=""> 412          return &quot;(&quot; + String.join(&quot;, &quot;, replacedItem) + &quot;)&quot;;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413      }                                                                                                             </span>
<span  style=""> 414                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 415      @Override                                                                                                     </span>
<span class="-8766503565464123288" onmouseenter="enter('-8766503565464123288');" onmouseout="out('-8766503565464123288');" style=""> 416      public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) throws IOException {                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 417          try {                                                                                                     </span>
<span class="-1438543337409690372" onmouseenter="enter('-1438543337409690372');" onmouseout="out('-1438543337409690372');" style=""> 418              if (!record.f0) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 419                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420              }                                                                                                     </span>
<span  style=""> 421                                                                                                                    </span>
<span class="-8847095116449263406" onmouseenter="enter('-8847095116449263406');" onmouseout="out('-8847095116449263406');" style=""> 422              if (outRecords.getCount() % RECEIVE_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {              </span>
<span class="867853870420543335" onmouseenter="enter('867853870420543335');" onmouseout="out('867853870420543335');" style=""> 423                  LOG.info(&quot;Receive data : {}&quot;, record);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424              }                                                                                                     </span>
<span  style=""> 425                                                                                                                    </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 426              if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                       </span>
<span class="-4538110507205524162" onmouseenter="enter('-4538110507205524162');" onmouseout="out('-4538110507205524162');" style=""> 427                  rows.add(Row.copy(record.f1));                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 428              } else {                                                                                              </span>
<span class="-7917205410914838057" onmouseenter="enter('-7917205410914838057');" onmouseout="out('-7917205410914838057');" style=""> 429                  Map&lt;String, Object&gt; valueMap = Maps.newHashMap();                                                 </span>
<span class="1869446492779313508" onmouseenter="enter('1869446492779313508');" onmouseout="out('1869446492779313508');" style=""> 430                  Row row = Row.copy(record.f1);                                                                    </span>
<span  style=""> 431                                                                                                                    </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 432                  for (int i = 0; i &lt; row.getArity(); i++) {                                                        </span>
<span class="5876572039273015428" onmouseenter="enter('5876572039273015428');" onmouseout="out('5876572039273015428');" style=""> 433                      valueMap.put(fieldNames.get(i), row.getField(i));                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434                  }                                                                                                 </span>
<span  style=""> 435                                                                                                                    </span>
<span class="-991390362203857814" onmouseenter="enter('-991390362203857814');" onmouseout="out('-991390362203857814');" style=""> 436                  Tuple2&lt;String, String&gt; rowTuple2 = new Tuple2&lt;&gt;();                                                </span>
<span class="-209542121488547867" onmouseenter="enter('-209542121488547867');" onmouseout="out('-209542121488547867');" style=""> 437                  if (storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition) {                                  </span>
<span class="-4830782679838689768" onmouseenter="enter('-4830782679838689768');" onmouseout="out('-4830782679838689768');" style=""> 438                      rowTuple2.f0 = NO_PARTITION;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 439                  } else {                                                                                          </span>
<span class="5139395380358692168" onmouseenter="enter('5139395380358692168');" onmouseout="out('5139395380358692168');" style=""> 440                      rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFields);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441                  }                                                                                                 </span>
<span  style=""> 442                                                                                                                    </span>
<span class="-484968884065413564" onmouseenter="enter('-484968884065413564');" onmouseout="out('-484968884065413564');" style=""> 443                  // 根据字段名对 row data 重组, 比如，原始 row data : (1, xxx, 20) -&gt; (id, name, age)                           </span>
<span class="2038150889857603205" onmouseenter="enter('2038150889857603205');" onmouseout="out('2038150889857603205');" style=""> 444                  // 但是由于 partition，写入的field 顺序变成了 (name, id, age)，则需要对 row data 重组变成 (xxx, 1, 20)                  </span>
<span class="5421203580895226953" onmouseenter="enter('5421203580895226953');" onmouseout="out('5421203580895226953');" style=""> 445                  Row rowValue = new Row(fieldTypes.size());                                                        </span>
<span class="-7699243670258396145" onmouseenter="enter('-7699243670258396145');" onmouseout="out('-7699243670258396145');" style=""> 446                  for (int i = 0; i &lt; fieldTypes.size(); i++) {                                                     </span>
<span class="2312799749991659832" onmouseenter="enter('2312799749991659832');" onmouseout="out('2312799749991659832');" style=""> 447                      rowValue.setField(i, valueMap.get(valueFieldNames.get(i)));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448                  }                                                                                                 </span>
<span class="8595450652771675183" onmouseenter="enter('8595450652771675183');" onmouseout="out('8595450652771675183');" style=""> 449                  rowTuple2.f1 = valueConditionAddQuotation(buildValuesCondition(fieldTypes, rowValue));            </span>

<span class="8896132355788887171" onmouseenter="enter('8896132355788887171');" onmouseout="out('8896132355788887171');" style=""> 450                  putRowIntoMap(rowDataMap, rowTuple2);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451              }                                                                                                     </span>
<span  style=""> 452                                                                                                                    </span>
<span class="-1784546571648451896" onmouseenter="enter('-1784546571648451896');" onmouseout="out('-1784546571648451896');" style=""> 453              batchCount++;                                                                                         </span>
<span  style=""> 454                                                                                                                    </span>
<span class="2059038061408804342" onmouseenter="enter('2059038061408804342');" onmouseout="out('2059038061408804342');" style=""> 455              if (batchCount &gt;= batchSize) {                                                                        </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 456                  flush();                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457              }                                                                                                     </span>
<span  style=""> 458                                                                                                                    </span>
<span class="-2147939016446724954" onmouseenter="enter('-2147939016446724954');" onmouseout="out('-2147939016446724954');" style=""> 459              // Receive data                                                                                       </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 460              outRecords.inc();                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 461          } catch (Exception e) {                                                                                   </span>
<span class="-6314596404725474749" onmouseenter="enter('-6314596404725474749');" onmouseout="out('-6314596404725474749');" style=""> 462              throw new IOException(&quot;Writing records to impala failed.&quot;, e);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464      }                                                                                                             </span>
<span  style=""> 465                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 466      @Override                                                                                                     </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 467      public void close() throws IOException {                                                                      </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 468          if (closed) {                                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 469              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470          }                                                                                                         </span>
<span class="-8247099019020917877" onmouseenter="enter('-8247099019020917877');" onmouseout="out('-8247099019020917877');" style=""> 471          // 将还未执行的SQL flush                                                                                        </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 472          if (batchCount &gt; 0) {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 473              try {                                                                                                 </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 474                  flush();                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 475              } catch (Exception e) {                                                                               </span>
<span class="1679153721811128255" onmouseenter="enter('1679153721811128255');" onmouseout="out('1679153721811128255');" style=""> 476                  throw new RuntimeException(&quot;Writing records to impala failed.&quot;, e);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477              }                                                                                                     </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478          }                                                                                                         </span>
<span class="4306800238416480323" onmouseenter="enter('4306800238416480323');" onmouseout="out('4306800238416480323');" style=""> 479          // cancel scheduled task                                                                                  </span>
<span class="-1257031862697527304" onmouseenter="enter('-1257031862697527304');" onmouseout="out('-1257031862697527304');" style=""> 480          if (this.scheduledFuture != null) {                                                                       </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 481              scheduledFuture.cancel(false);                                                                        </span>
<span class="-3367227577965762682" onmouseenter="enter('-3367227577965762682');" onmouseout="out('-3367227577965762682');" style=""> 482              this.scheduler.shutdown();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483          }                                                                                                         </span>
<span class="-6918026600162299955" onmouseenter="enter('-6918026600162299955');" onmouseout="out('-6918026600162299955');" style=""> 484          // close connection                                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 485          try {                                                                                                     </span>
<span class="7850482504012729998" onmouseenter="enter('7850482504012729998');" onmouseout="out('7850482504012729998');" style=""> 486              if (connection != null &amp;&amp; connection.isValid(DEFAULT_CONN_TIME_OUT)) {                                </span>
<span class="9071602856049240163" onmouseenter="enter('9071602856049240163');" onmouseout="out('9071602856049240163');" style=""> 487                  connection.close();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488              }                                                                                                     </span>
<span  style=""> 489                                                                                                                    </span>
<span class="5036557091369948437" onmouseenter="enter('5036557091369948437');" onmouseout="out('5036557091369948437');" style=""> 490              if (statement != null &amp;&amp; !statement.isClosed()) {                                                     </span>
<span class="-4290000005499431342" onmouseenter="enter('-4290000005499431342');" onmouseout="out('-4290000005499431342');" style=""> 491                  statement.close();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492              }                                                                                                     </span>
<span  style=""> 493                                                                                                                    </span>
<span class="-3745862640690712208" onmouseenter="enter('-3745862640690712208');" onmouseout="out('-3745862640690712208');" style=""> 494              if (updateStatement != null &amp;&amp; !updateStatement.isClosed()) {                                         </span>
<span class="6285223499122042502" onmouseenter="enter('6285223499122042502');" onmouseout="out('6285223499122042502');" style=""> 495                  updateStatement.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496              }                                                                                                     </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 497          } catch (SQLException e) {                                                                                </span>
<span class="-8800633426745397107" onmouseenter="enter('-8800633426745397107');" onmouseout="out('-8800633426745397107');" style=""> 498              throw new RuntimeException(&quot;impala connection close failed!&quot;, e);                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 499          } finally {                                                                                               </span>
<span class="8335594207613379924" onmouseenter="enter('8335594207613379924');" onmouseout="out('8335594207613379924');" style=""> 500              connection = null;                                                                                    </span>
<span class="-8855760725718402841" onmouseenter="enter('-8855760725718402841');" onmouseout="out('-8855760725718402841');" style=""> 501              statement = null;                                                                                     </span>
<span class="-7841270215011717932" onmouseenter="enter('-7841270215011717932');" onmouseout="out('-7841270215011717932');" style=""> 502              updateStatement = null;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503          }                                                                                                         </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 504          closed = true;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505      }                                                                                                             </span>
<span  style=""> 506                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 507      /**                                                                                                           </span>
<span class="1296337810927918625" onmouseenter="enter('1296337810927918625');" onmouseout="out('1296337810927918625');" style=""> 508       * execute batch sql from row data map                                                                        </span>
<span class="-5974232274386764846" onmouseenter="enter('-5974232274386764846');" onmouseout="out('-5974232274386764846');" style=""> 509       * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)....     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 510       *                                                                                                            </span>
<span class="3064025681804756869" onmouseenter="enter('3064025681804756869');" onmouseout="out('3064025681804756869');" style=""> 511       * @param statement       execute statement                                                                   </span>
<span class="4252025712922498493" onmouseenter="enter('4252025712922498493');" onmouseout="out('4252025712922498493');" style=""> 512       * @param tempSql         template sql                                                                        </span>
<span class="-888616451537648959" onmouseenter="enter('-888616451537648959');" onmouseout="out('-888616451537648959');" style=""> 513       * @param storeType       the store type of data                                                              </span>
<span class="-5301096736775778703" onmouseenter="enter('-5301096736775778703');" onmouseout="out('-5301096736775778703');" style=""> 514       * @param enablePartition enable partition or not                                                             </span>
<span class="-7243431631208061298" onmouseenter="enter('-7243431631208061298');" onmouseout="out('-7243431631208061298');" style=""> 515       * @param fieldNames      field name list                                                                     </span>
<span class="991482749163976330" onmouseenter="enter('991482749163976330');" onmouseout="out('991482749163976330');" style=""> 516       * @param partitionFields partition fields                                                                    </span>
<span class="5552251290683891506" onmouseenter="enter('5552251290683891506');" onmouseout="out('5552251290683891506');" style=""> 517       * @param rowDataMap      row data map                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 518       */                                                                                                           </span>
<span class="4208908199550530657" onmouseenter="enter('4208908199550530657');" onmouseout="out('4208908199550530657');" style=""> 519      private void executeBatchSql(Statement statement,                                                             </span>
<span class="2680326069917862152" onmouseenter="enter('2680326069917862152');" onmouseout="out('2680326069917862152');" style=""> 520                                   String tempSql,                                                                  </span>

<span class="-1880214364205558871" onmouseenter="enter('-1880214364205558871');" onmouseout="out('-1880214364205558871');" style=""> 521                                   String schema,                                                                   </span>
<span class="6859219661302664351" onmouseenter="enter('6859219661302664351');" onmouseout="out('6859219661302664351');" style=""> 522                                   String tableName,                                                                </span>
<span class="3305030788069730493" onmouseenter="enter('3305030788069730493');" onmouseout="out('3305030788069730493');" style=""> 523                                   String storeType,                                                                </span>
<span class="3282308130032253418" onmouseenter="enter('3282308130032253418');" onmouseout="out('3282308130032253418');" style=""> 524                                   Boolean enablePartition,                                                         </span>
<span class="-3269341593111050509" onmouseenter="enter('-3269341593111050509');" onmouseout="out('-3269341593111050509');" style=""> 525                                   List&lt;String&gt; fieldNames,                                                         </span>
<span class="-152366337684528954" onmouseenter="enter('-152366337684528954');" onmouseout="out('-152366337684528954');" style=""> 526                                   String partitionFields,                                                          </span>
<span class="5702355489208114022" onmouseenter="enter('5702355489208114022');" onmouseout="out('5702355489208114022');" style=""> 527                                   Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap) {                                     </span>
<span class="-8058960308042609674" onmouseenter="enter('-8058960308042609674');" onmouseout="out('-8058960308042609674');" style=""> 528          StringBuilder valuesCondition = new StringBuilder();                                                      </span>
<span class="-1699639020719600437" onmouseenter="enter('-1699639020719600437');" onmouseout="out('-1699639020719600437');" style=""> 529          StringBuilder partitionCondition = new StringBuilder();                                                   </span>
<span class="4484344279813579809" onmouseenter="enter('4484344279813579809');" onmouseout="out('4484344279813579809');" style=""> 530          String tableFieldsCondition = buildTableFieldsCondition(fieldNames, partitionFields);                     </span>
<span class="-2056467323596282224" onmouseenter="enter('-2056467323596282224');" onmouseout="out('-2056467323596282224');" style=""> 531          ArrayList&lt;String&gt; rowData;                                                                                </span>

<span class="3545700907988930339" onmouseenter="enter('3545700907988930339');" onmouseout="out('3545700907988930339');" style=""> 532          String tableNameInfo = Objects.isNull(schema) ?                                                           </span>
<span class="1480493120427294696" onmouseenter="enter('1480493120427294696');" onmouseout="out('1480493120427294696');" style=""> 533                  tableName : quoteIdentifier(schema) + &quot;.&quot; + tableName;                                            </span>
<span class="-7586945217349428495" onmouseenter="enter('-7586945217349428495');" onmouseout="out('-7586945217349428495');" style=""> 534          tempSql = tempSql.replace(&quot;tableName&quot;, tableNameInfo);                                                    </span>
<span  style=""> 535                                                                                                                    </span>
<span class="-739313269293547881" onmouseenter="enter('-739313269293547881');" onmouseout="out('-739313269293547881');" style=""> 536          // kudu ${partitionCondition} is null                                                                     </span>
<span class="-209542121488547867" onmouseenter="enter('-209542121488547867');" onmouseout="out('-209542121488547867');" style=""> 537          if (storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition) {                                          </span>
























































<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 538              try {                                                                                                 </span>
<span class="-2154584329942843601" onmouseenter="enter('-2154584329942843601');" onmouseout="out('-2154584329942843601');" style=""> 539                  rowData = rowDataMap.get(NO_PARTITION);                                                           </span>
<span class="8347805769565999916" onmouseenter="enter('8347805769565999916');" onmouseout="out('8347805769565999916');" style=""> 540                  rowData.forEach(row -&gt; valuesCondition.append(row).append(&quot;, &quot;));                                 </span>
<span class="3083642816500849348" onmouseenter="enter('3083642816500849348');" onmouseout="out('3083642816500849348');" style=""> 541                  String executeSql = tempSql.replace(VALUES_CONDITION, valuesCondition.toString())                 </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style=""> 542                          .replace(PARTITION_CONDITION, partitionCondition.toString())                              </span>
<span class="1939264830691633930" onmouseenter="enter('1939264830691633930');" onmouseout="out('1939264830691633930');" style=""> 543                          .replace(PARTITION_CONSTANT, &quot;&quot;)                                                          </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style=""> 544                          .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                                   </span>
<span class="8541330001607166782" onmouseenter="enter('8541330001607166782');" onmouseout="out('8541330001607166782');" style=""> 545                  String substring = executeSql.substring(0, executeSql.length() - 2);                              </span>
<span class="9213214884061660178" onmouseenter="enter('9213214884061660178');" onmouseout="out('9213214884061660178');" style=""> 546                  statement.execute(substring);                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 547              } catch (Exception e) {                                                                               </span>
<span class="7699356527811265570" onmouseenter="enter('7699356527811265570');" onmouseout="out('7699356527811265570');" style=""> 548                  throw new RuntimeException(&quot;execute impala SQL error!&quot;, e);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549              }                                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 550              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551          }                                                                                                         </span>
<span  style=""> 552                                                                                                                    </span>
<span class="6613720697354939567" onmouseenter="enter('6613720697354939567');" onmouseout="out('6613720697354939567');" style=""> 553          // partition sql                                                                                          </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 554          Set&lt;String&gt; keySet = rowDataMap.keySet();                                                                 </span>
<span class="6439574290523368417" onmouseenter="enter('6439574290523368417');" onmouseout="out('6439574290523368417');" style=""> 555          String finalTempSql = tempSql;                                                                            </span>
<span class="5286500476222551862" onmouseenter="enter('5286500476222551862');" onmouseout="out('5286500476222551862');" style=""> 556          for (String key : keySet) {                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 557              try {                                                                                                 </span>
<span class="-8214047348876131469" onmouseenter="enter('-8214047348876131469');" onmouseout="out('-8214047348876131469');" style=""> 558                  String executeSql = String.copyValueOf(finalTempSql.toCharArray());                               </span>
<span class="225939304905434763" onmouseenter="enter('225939304905434763');" onmouseout="out('225939304905434763');" style=""> 559                  ArrayList&lt;String&gt; valuesConditionList = rowDataMap.get(key);                                      </span>
<span class="3266960038838022824" onmouseenter="enter('3266960038838022824');" onmouseout="out('3266960038838022824');" style=""> 560                  partitionCondition.append(key);                                                                   </span>
<span class="7273478521762013154" onmouseenter="enter('7273478521762013154');" onmouseout="out('7273478521762013154');" style=""> 561                  executeSql = executeSql.replace(PARTITION_CONDITION, partitionCondition.toString())               </span>
<span class="7623710745634070513" onmouseenter="enter('7623710745634070513');" onmouseout="out('7623710745634070513');" style=""> 562                          .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition)                                    </span>
<span class="6339876343455538281" onmouseenter="enter('6339876343455538281');" onmouseout="out('6339876343455538281');" style=""> 563                          .replace(VALUES_CONDITION, String.join(&quot;, &quot;, valuesConditionList));                       </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 564                  statement.execute(executeSql);                                                                    </span>
<span class="-3000902343706299075" onmouseenter="enter('-3000902343706299075');" onmouseout="out('-3000902343706299075');" style=""> 565                  partitionCondition.delete(0, partitionCondition.length());                                        </span>
<span class="-2037802754415730828" onmouseenter="enter('-2037802754415730828');" onmouseout="out('-2037802754415730828');" style=""> 566              } catch (SQLException sqlException) {                                                                 </span>
<span class="-5222513116835107038" onmouseenter="enter('-5222513116835107038');" onmouseout="out('-5222513116835107038');" style=""> 567                  throw new RuntimeException(&quot;execute impala SQL error! &quot;, sqlException);                           </span>













<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570      }                                                                                                             </span>
<span  style=""> 571                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 572      /**                                                                                                           </span>
<span class="-7756927092547658158" onmouseenter="enter('-7756927092547658158');" onmouseout="out('-7756927092547658158');" style=""> 573       * build partition condition with row data                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 574       *                                                                                                            </span>
<span class="3326420447531983720" onmouseenter="enter('3326420447531983720');" onmouseout="out('3326420447531983720');" style=""> 575       * @param rowData              row data                                                                       </span>
<span class="-4527404320823727170" onmouseenter="enter('-4527404320823727170');" onmouseout="out('-4527404320823727170');" style=""> 576       * @param partitionFields      partition fields                                                               </span>
<span class="-1776173940247734574" onmouseenter="enter('-1776173940247734574');" onmouseout="out('-1776173940247734574');" style=""> 577       * @param staticPartitionField static partition fields                                                        </span>
<span class="-1132708759906563110" onmouseenter="enter('-1132708759906563110');" onmouseout="out('-1132708759906563110');" style=""> 578       * @return condition like &#x27;(ptOne, ptTwo=v2)&#x27;                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 579       */                                                                                                           </span>
<span class="-3866187778893382496" onmouseenter="enter('-3866187778893382496');" onmouseout="out('-3866187778893382496');" style=""><abbr title=" 580      private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;String&gt; staticPartitionField) {"> 580      private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;String&gt; stati🔵</abbr></span>
<span class="1267423885187171547" onmouseenter="enter('1267423885187171547');" onmouseout="out('1267423885187171547');" style=""> 581          for (String key : staticPartitionField) {                                                                 </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 582              StringBuilder sb = new StringBuilder();                                                               </span>
<span class="-5505398468694975344" onmouseenter="enter('-5505398468694975344');" onmouseout="out('-5505398468694975344');" style=""> 583              Object value = rowData.get(key);                                                                      </span>
<span class="-3546349567435071552" onmouseenter="enter('-3546349567435071552');" onmouseout="out('-3546349567435071552');" style=""> 584              sb.append(key).append(&quot;=&quot;).append(value);                                                             </span>
<span class="7571464430142538701" onmouseenter="enter('7571464430142538701');" onmouseout="out('7571464430142538701');" style=""> 585              partitionFields = partitionFields.replace(&quot;${&quot; + key + &quot;}&quot;, sb.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586          }                                                                                                         </span>
<span class="-6125585623196674116" onmouseenter="enter('-6125585623196674116');" onmouseout="out('-6125585623196674116');" style=""> 587          return &quot;(&quot; + partitionFields + &quot;)&quot;;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588      }                                                                                                             </span>
<span  style=""> 589                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 590      /**                                                                                                           </span>
<span class="1604816269765986224" onmouseenter="enter('1604816269765986224');" onmouseout="out('1604816269765986224');" style=""> 591       * build field condition according to field names                                                             </span>
<span class="-8005762898157210848" onmouseenter="enter('-8005762898157210848');" onmouseout="out('-8005762898157210848');" style=""> 592       * replace ${tableFieldCondition}                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 593       *                                                                                                            </span>
<span class="-3045974832751459167" onmouseenter="enter('-3045974832751459167');" onmouseout="out('-3045974832751459167');" style=""> 594       * @param fieldNames      the selected field names                                                            </span>
<span class="-2115580236801058408" onmouseenter="enter('-2115580236801058408');" onmouseout="out('-2115580236801058408');" style=""> 595       * @param partitionFields the partition fields                                                                </span>
<span class="-2587093228749928778" onmouseenter="enter('-2587093228749928778');" onmouseout="out('-2587093228749928778');" style=""> 596       * @return condition like &#x27;(id, name, age)&#x27;                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 597       */                                                                                                           </span>
<span class="-1478951256156574678" onmouseenter="enter('-1478951256156574678');" onmouseout="out('-1478951256156574678');" style=""> 598      private String buildTableFieldsCondition(List&lt;String&gt; fieldNames, String partitionFields) {                   </span>
<span class="-8730756422155226372" onmouseenter="enter('-8730756422155226372');" onmouseout="out('-8730756422155226372');" style=""> 599          return &quot;(&quot; + fieldNames.stream()                                                                          </span>
<span class="-1124201215121024792" onmouseenter="enter('-1124201215121024792');" onmouseout="out('-1124201215121024792');" style=""> 600                  .filter(f -&gt; !partitionFields.contains(f))                                                        </span>
<span class="4761076759122573536" onmouseenter="enter('4761076759122573536');" onmouseout="out('4761076759122573536');" style=""> 601                  .map(this::quoteIdentifier)                                                                       </span>
<span class="-1385468130735042246" onmouseenter="enter('-1385468130735042246');" onmouseout="out('-1385468130735042246');" style=""> 602                  .collect(Collectors.joining(&quot;, &quot;)) + &quot;)&quot;;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603      }                                                                                                             </span>
<span  style=""> 604                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 605      /**                                                                                                           </span>
<span class="-1930125657620201419" onmouseenter="enter('-1930125657620201419');" onmouseout="out('-1930125657620201419');" style=""> 606       * according to field types, build the values condition                                                       </span>
<span class="-5328431915012470826" onmouseenter="enter('-5328431915012470826');" onmouseout="out('-5328431915012470826');" style=""> 607       * replace ${valuesCondition}                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 608       *                                                                                                            </span>
<span class="889997534505017973" onmouseenter="enter('889997534505017973');" onmouseout="out('889997534505017973');" style=""> 609       * @param fieldTypes field types                                                                              </span>
<span class="-5792744344160442542" onmouseenter="enter('-5792744344160442542');" onmouseout="out('-5792744344160442542');" style=""> 610       * @return condition like &#x27;(?, ?, cast(? as string))&#x27; and &#x27;?&#x27; will be replaced with row data                  </span>

<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 611       */                                                                                                           </span>
<span class="-8753268388884688793" onmouseenter="enter('-8753268388884688793');" onmouseout="out('-8753268388884688793');" style=""> 612      private String buildValuesCondition(List&lt;String&gt; fieldTypes, Row row) {                                       </span>
<span class="9451785702271217" onmouseenter="enter('9451785702271217');" onmouseout="out('9451785702271217');" style=""> 613          String valuesCondition = fieldTypes.stream().map(                                                         </span>
<span class="-744834501831992668" onmouseenter="enter('-744834501831992668');" onmouseout="out('-744834501831992668');" style=""> 614                  f -&gt; {                                                                                            </span>
<span class="9071647551805886291" onmouseenter="enter('9071647551805886291');" onmouseout="out('9071647551805886291');" style=""> 615                      for (String item : NEED_QUOTE_TYPE) {                                                         </span>
<span class="9108011392601680881" onmouseenter="enter('9108011392601680881');" onmouseout="out('9108011392601680881');" style=""> 616                          if (f.toLowerCase().contains(item)) {                                                     </span>
<span class="-8315565477038260180" onmouseenter="enter('-8315565477038260180');" onmouseout="out('-8315565477038260180');" style=""> 617                              return String.format(&quot;cast(? as %s)&quot;, f.toLowerCase());                               </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619                      }                                                                                             </span>
<span class="6027958975032523467" onmouseenter="enter('6027958975032523467');" onmouseout="out('6027958975032523467');" style=""> 620                      return &quot;?&quot;;                                                                                   </span>
<span class="4654177507103038656" onmouseenter="enter('4654177507103038656');" onmouseout="out('4654177507103038656');" style=""> 621                  }).collect(Collectors.joining(&quot;, &quot;));                                                             </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 622          for (int i = 0; i &lt; row.getArity(); i++) {                                                                </span>
<span class="2602556020493426404" onmouseenter="enter('2602556020493426404');" onmouseout="out('2602556020493426404');" style=""><abbr title=" 623              valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, Objects.isNull(row.getField(i)) ? &quot;null&quot; : row.getField(i).toString());"> 623              valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, Objects.isNull(row.getField(i)) ? &quot;null&quot; : row.g🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624          }                                                                                                         </span>
<span class="6366685022999215739" onmouseenter="enter('6366685022999215739');" onmouseout="out('6366685022999215739');" style=""> 625          return valuesCondition;                                                                                   </span>








<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626      }                                                                                                             </span>
<span  style=""> 627                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 628      /**                                                                                                           </span>
<span class="2218542669560141576" onmouseenter="enter('2218542669560141576');" onmouseout="out('2218542669560141576');" style=""> 629       * impala update mode SQL                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 630       *                                                                                                            </span>
<span class="-8218292189476554358" onmouseenter="enter('-8218292189476554358');" onmouseout="out('-8218292189476554358');" style=""> 631       * @return UPDATE tableName SET setCondition WHERE whereCondition                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 632       */                                                                                                           </span>
<span class="-3752451701752547882" onmouseenter="enter('-3752451701752547882');" onmouseout="out('-3752451701752547882');" style=""><abbr title=" 633      private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; primaryKeys) {"> 633      private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; primaryKe🔵</abbr></span>
<span class="5528853464056789996" onmouseenter="enter('5528853464056789996');" onmouseout="out('5528853464056789996');" style=""> 634          //跳过primary key字段                                                                                         </span>
<span class="-8857590287628770183" onmouseenter="enter('-8857590287628770183');" onmouseout="out('-8857590287628770183');" style=""> 635          String setClause = fieldNames.stream()                                                                    </span>
<span class="-803297460241064625" onmouseenter="enter('-803297460241064625');" onmouseout="out('-803297460241064625');" style=""> 636                  .filter(f -&gt; !CollectionUtils.isNotEmpty(primaryKeys) || !primaryKeys.contains(f))                </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 637                  .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                              </span>
<span class="-209499088310020597" onmouseenter="enter('-209499088310020597');" onmouseout="out('-209499088310020597');" style=""> 638                  .collect(Collectors.joining(&quot;, &quot;));                                                               </span>
<span  style=""> 639                                                                                                                    </span>
<span class="-3669556570443861667" onmouseenter="enter('-3669556570443861667');" onmouseout="out('-3669556570443861667');" style=""> 640          String conditionClause = primaryKeys.stream()                                                             </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 641                  .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                              </span>
<span class="1187060376059521362" onmouseenter="enter('1187060376059521362');" onmouseout="out('1187060376059521362');" style=""> 642                  .collect(Collectors.joining(&quot; AND &quot;));                                                            </span>
<span  style=""> 643                                                                                                                    </span>
<span class="-880277003185331688" onmouseenter="enter('-880277003185331688');" onmouseout="out('-880277003185331688');" style=""> 644          return &quot;UPDATE &quot; + (Objects.isNull(schema) ? &quot;&quot; : quoteIdentifier(schema) + &quot;.&quot;)                          </span>
<span class="-2776062363149844820" onmouseenter="enter('-2776062363149844820');" onmouseout="out('-2776062363149844820');" style=""> 645                  + quoteIdentifier(tableName) + &quot; SET &quot; + setClause + &quot; WHERE &quot; + conditionClause;                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646      }                                                                                                             </span>
<span  style=""> 647                                                                                                                    </span>
<span class="4659511982989745103" onmouseenter="enter('4659511982989745103');" onmouseout="out('4659511982989745103');" style=""> 648      private String quoteIdentifier(String identifier) {                                                           </span>
<span class="1935684454964464658" onmouseenter="enter('1935684454964464658');" onmouseout="out('1935684454964464658');" style=""> 649          return &quot;`&quot; + identifier + &quot;`&quot;;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 650      }                                                                                                             </span>
<span  style=""> 651                                                                                                                    </span>
<span class="-2481914402933088399" onmouseenter="enter('-2481914402933088399');" onmouseout="out('-2481914402933088399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 652 -    public static Builder getImpalaBuilder() {                                                                    </span>
<span class="-1926211775479526780" onmouseenter="enter('-1926211775479526780');" onmouseout="out('-1926211775479526780');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 653 -        return new Builder();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 654 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 655 -                                                                                                                  </span>
<span class="2010609695383714647" onmouseenter="enter('2010609695383714647');" onmouseout="out('2010609695383714647');" style=""> 656      public static class Builder {                                                                                 </span>
<span class="5030308014750517924" onmouseenter="enter('5030308014750517924');" onmouseout="out('5030308014750517924');" style=""> 657          private final ImpalaOutputFormat format = new ImpalaOutputFormat();                                       </span>
<span  style=""> 658                                                                                                                    </span>
<span class="4847669250945231235" onmouseenter="enter('4847669250945231235');" onmouseout="out('4847669250945231235');" style=""> 659          public Builder setDbUrl(String dbUrl) {                                                                   </span>
<span class="-7007213682983262515" onmouseenter="enter('-7007213682983262515');" onmouseout="out('-7007213682983262515');" style=""> 660              format.dbUrl = dbUrl;                                                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 661              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662          }                                                                                                         </span>
<span  style=""> 663                                                                                                                    </span>
<span class="-2062625403058053727" onmouseenter="enter('-2062625403058053727');" onmouseout="out('-2062625403058053727');" style=""> 664          public Builder setUserName(String userName) {                                                             </span>
<span class="8996094991043959374" onmouseenter="enter('8996094991043959374');" onmouseout="out('8996094991043959374');" style=""> 665              format.userName = userName;                                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 666              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667          }                                                                                                         </span>
<span  style=""> 668                                                                                                                    </span>
<span class="-8917696572465338538" onmouseenter="enter('-8917696572465338538');" onmouseout="out('-8917696572465338538');" style=""> 669          public Builder setPassword(String password) {                                                             </span>
<span class="-5617852808102302847" onmouseenter="enter('-5617852808102302847');" onmouseout="out('-5617852808102302847');" style=""> 670              format.password = password;                                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 671              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672          }                                                                                                         </span>
<span  style=""> 673                                                                                                                    </span>
<span class="-6851628607924303336" onmouseenter="enter('-6851628607924303336');" onmouseout="out('-6851628607924303336');" style=""> 674          public Builder setBatchSize(Integer batchSize) {                                                          </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 675              format.batchSize = batchSize;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 676              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677          }                                                                                                         </span>
<span  style=""> 678                                                                                                                    </span>
<span class="5791410845050671235" onmouseenter="enter('5791410845050671235');" onmouseout="out('5791410845050671235');" style=""> 679          public Builder setBatchWaitInterval(Long batchWaitInterval) {                                             </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 680              format.batchWaitInterval = batchWaitInterval;                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 681              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 682          }                                                                                                         </span>
<span  style=""> 683                                                                                                                    </span>
<span class="-8777589626278372083" onmouseenter="enter('-8777589626278372083');" onmouseout="out('-8777589626278372083');" style=""> 684          public Builder setTableName(String tableName) {                                                           </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 685              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 686              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687          }                                                                                                         </span>
<span  style=""> 688                                                                                                                    </span>
<span class="221724127870954269" onmouseenter="enter('221724127870954269');" onmouseout="out('221724127870954269');" style=""> 689          public Builder setPartitionFields(String partitionFields) {                                               </span>
<span class="-8055214001591864073" onmouseenter="enter('-8055214001591864073');" onmouseout="out('-8055214001591864073');" style=""> 690              format.partitionFields = Objects.isNull(partitionFields) ?                                            </span>
<span class="6173943982789028324" onmouseenter="enter('6173943982789028324');" onmouseout="out('6173943982789028324');" style=""> 691                      &quot;&quot; : partitionFields;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 692              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693          }                                                                                                         </span>
<span  style=""> 694                                                                                                                    </span>
<span class="-6994787811007556212" onmouseenter="enter('-6994787811007556212');" onmouseout="out('-6994787811007556212');" style=""> 695          public Builder setPrimaryKeys(List&lt;String&gt; primaryKeys) {                                                 </span>
<span class="1909693990286542032" onmouseenter="enter('1909693990286542032');" onmouseout="out('1909693990286542032');" style=""> 696              format.primaryKeys = primaryKeys;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 697              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698          }                                                                                                         </span>
<span  style=""> 699                                                                                                                    </span>
<span class="7512351963685249159" onmouseenter="enter('7512351963685249159');" onmouseout="out('7512351963685249159');" style=""> 700          public Builder setSchema(String schema) {                                                                 </span>
<span class="306599522236782764" onmouseenter="enter('306599522236782764');" onmouseout="out('306599522236782764');" style=""> 701              format.schema = schema;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 702              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703          }                                                                                                         </span>
<span  style=""> 704                                                                                                                    </span>
<span class="4541611662116992338" onmouseenter="enter('4541611662116992338');" onmouseout="out('4541611662116992338');" style=""> 705          public Builder setEnablePartition(Boolean enablePartition) {                                              </span>
<span class="-6976631596761488792" onmouseenter="enter('-6976631596761488792');" onmouseout="out('-6976631596761488792');" style=""> 706              format.enablePartition = enablePartition;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 707              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 708          }                                                                                                         </span>
<span  style=""> 709                                                                                                                    </span>
<span class="-8865383825618932145" onmouseenter="enter('-8865383825618932145');" onmouseout="out('-8865383825618932145');" style=""> 710          public Builder setUpdateMode(String updateMode) {                                                         </span>
<span class="-2281017119849044621" onmouseenter="enter('-2281017119849044621');" onmouseout="out('-2281017119849044621');" style=""> 711              format.updateMode = updateMode;                                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 712              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713          }                                                                                                         </span>
<span  style=""> 714                                                                                                                    </span>
<span class="8081013001489210313" onmouseenter="enter('8081013001489210313');" onmouseout="out('8081013001489210313');" style=""> 715          public Builder setFieldList(List&lt;String&gt; fieldList) {                                                     </span>
<span class="-818074055946993480" onmouseenter="enter('-818074055946993480');" onmouseout="out('-818074055946993480');" style=""> 716              format.fieldNames = fieldList;                                                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 717              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718          }                                                                                                         </span>
<span  style=""> 719                                                                                                                    </span>
<span class="3974737416393184735" onmouseenter="enter('3974737416393184735');" onmouseout="out('3974737416393184735');" style=""> 720          public Builder setFieldTypeList(List&lt;String&gt; fieldTypeList) {                                             </span>
<span class="1448747188656744713" onmouseenter="enter('1448747188656744713');" onmouseout="out('1448747188656744713');" style=""> 721              format.fieldTypes = fieldTypeList;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 722              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723          }                                                                                                         </span>
<span  style=""> 724                                                                                                                    </span>
<span class="2244927175574628655" onmouseenter="enter('2244927175574628655');" onmouseout="out('2244927175574628655');" style=""> 725          public Builder setStoreType(String storeType) {                                                           </span>
<span class="-5818885152026709969" onmouseenter="enter('-5818885152026709969');" onmouseout="out('-5818885152026709969');" style=""> 726              format.storeType = storeType;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 727              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728          }                                                                                                         </span>
<span  style=""> 729                                                                                                                    </span>
<span class="-5487489987508961941" onmouseenter="enter('-5487489987508961941');" onmouseout="out('-5487489987508961941');" style=""> 730          public Builder setFieldExtraInfoList(List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList) {         </span>
<span class="160167467316759360" onmouseenter="enter('160167467316759360');" onmouseout="out('160167467316759360');" style=""> 731              format.fieldExtraInfoList = fieldExtraInfoList;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 732              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733          }                                                                                                         </span>
<span  style=""> 734                                                                                                                    </span>
<span class="1366044936846496088" onmouseenter="enter('1366044936846496088');" onmouseout="out('1366044936846496088');" style=""> 735          public Builder setKeyTabPath(String keyTabPath) {                                                         </span>
<span class="8755357456701014681" onmouseenter="enter('8755357456701014681');" onmouseout="out('8755357456701014681');" style=""> 736              format.keytabPath = keyTabPath;                                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 737              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738          }                                                                                                         </span>
<span  style=""> 739                                                                                                                    </span>
<span class="1807007964631867819" onmouseenter="enter('1807007964631867819');" onmouseout="out('1807007964631867819');" style=""> 740          public Builder setKrb5ConfPath(String krb5ConfPath) {                                                     </span>
<span class="352337563234497723" onmouseenter="enter('352337563234497723');" onmouseout="out('352337563234497723');" style=""> 741              format.krb5confPath = krb5ConfPath;                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 742              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743          }                                                                                                         </span>
<span  style=""> 744                                                                                                                    </span>
<span class="-8540538228750165144" onmouseenter="enter('-8540538228750165144');" onmouseout="out('-8540538228750165144');" style=""> 745          public Builder setPrincipal(String principal) {                                                           </span>
<span class="6894839552978791309" onmouseenter="enter('6894839552978791309');" onmouseout="out('6894839552978791309');" style=""> 746              format.principal = principal;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 747              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748          }                                                                                                         </span>
<span  style=""> 749                                                                                                                    </span>
<span class="-8991908924314829739" onmouseenter="enter('-8991908924314829739');" onmouseout="out('-8991908924314829739');" style=""> 750          public Builder setAuthMech(Integer authMech) {                                                            </span>
<span class="-1412915325814520049" onmouseenter="enter('-1412915325814520049');" onmouseout="out('-1412915325814520049');" style=""> 751              format.authMech = authMech;                                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 752              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753          }                                                                                                         </span>
<span  style=""> 754                                                                                                                    </span>
<span class="1564959121680510141" onmouseenter="enter('1564959121680510141');" onmouseout="out('1564959121680510141');" style=""> 755          private boolean canHandle(String url) {                                                                   </span>
<span class="842511305287615009" onmouseenter="enter('842511305287615009');" onmouseout="out('842511305287615009');" style=""> 756              return url.startsWith(&quot;jdbc:impala:&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757          }                                                                                                         </span>
<span  style=""> 758                                                                                                                    </span>
<span class="-8521575333201954447" onmouseenter="enter('-8521575333201954447');" onmouseout="out('-8521575333201954447');" style=""> 759          public ImpalaOutputFormat build() {                                                                       </span>
<span class="1659683170431033048" onmouseenter="enter('1659683170431033048');" onmouseout="out('1659683170431033048');" style=""> 760              if (!canHandle(format.dbUrl)) {                                                                       </span>
<span class="-4870909491096243891" onmouseenter="enter('-4870909491096243891');" onmouseout="out('-4870909491096243891');" style=""> 761                  throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762              }                                                                                                     </span>
<span  style=""> 763                                                                                                                    </span>
<span class="-4505121258189477360" onmouseenter="enter('-4505121258189477360');" onmouseout="out('-4505121258189477360');" style=""> 764              if (format.authMech == EAuthMech.Kerberos.getType()) {                                                </span>
<span class="-6183848778016991336" onmouseenter="enter('-6183848778016991336');" onmouseout="out('-6183848778016991336');" style=""> 765                  checkNotNull(format.krb5confPath,                                                                 </span>
<span class="-4038272028328025626" onmouseenter="enter('-4038272028328025626');" onmouseout="out('-4038272028328025626');" style=""> 766                          &quot;When kerberos authentication is enabled, krb5confPath is required！&quot;);                    </span>
<span class="-1753032521002756428" onmouseenter="enter('-1753032521002756428');" onmouseout="out('-1753032521002756428');" style=""> 767                  checkNotNull(format.principal,                                                                    </span>
<span class="-5219129049333790569" onmouseenter="enter('-5219129049333790569');" onmouseout="out('-5219129049333790569');" style=""> 768                          &quot;When kerberos authentication is enabled, principal is required！&quot;);                       </span>
<span class="-3070330065691611476" onmouseenter="enter('-3070330065691611476');" onmouseout="out('-3070330065691611476');" style=""> 769                  checkNotNull(format.keytabPath,                                                                   </span>
<span class="-393994981289522477" onmouseenter="enter('-393994981289522477');" onmouseout="out('-393994981289522477');" style=""> 770                          &quot;When kerberos authentication is enabled, keytabPath is required！&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771              }                                                                                                     </span>
<span  style=""> 772                                                                                                                    </span>
<span class="-5111581416826137591" onmouseenter="enter('-5111581416826137591');" onmouseout="out('-5111581416826137591');" style=""> 773              if (format.authMech == EAuthMech.UserName.getType()) {                                                </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 774                  checkNotNull(format.userName, &quot;userName is required!&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775              }                                                                                                     </span>
<span  style=""> 776                                                                                                                    </span>
<span class="-3238564706659558925" onmouseenter="enter('-3238564706659558925');" onmouseout="out('-3238564706659558925');" style=""> 777              if (format.authMech == EAuthMech.NameANDPassword.getType()) {                                         </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 778                  checkNotNull(format.userName, &quot;userName is required!&quot;);                                           </span>
<span class="-9040493906648204146" onmouseenter="enter('-9040493906648204146');" onmouseout="out('-9040493906648204146');" style=""> 779                  checkNotNull(format.password, &quot;password is required!&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780              }                                                                                                     </span>
<span  style=""> 781                                                                                                                    </span>
<span class="1310568763423505425" onmouseenter="enter('1310568763423505425');" onmouseout="out('1310568763423505425');" style=""> 782              checkNotNull(format.storeType, &quot;storeType is required!&quot;);                                             </span>
<span  style=""> 783                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 784              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 787  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-6349807778844055730" onmouseenter="enter('-6349807778844055730');" onmouseout="out('-6349807778844055730');" style="">  19  package com.dtstack.flink.sql.sink.impala;                                                                        </span>
<span  style="">  20                                                                                                                    </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import com.dtstack.flink.sql.exception.ExceptionTrace;                                                            </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  22  import com.dtstack.flink.sql.factory.DTThreadFactory;                                                             </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-8930056125403642162" onmouseenter="enter('-8930056125403642162');" onmouseout="out('-8930056125403642162');" style="">  24  import com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils;                                                       </span>
<span class="-692023547870128618" onmouseenter="enter('-692023547870128618');" onmouseout="out('-692023547870128618');" style="">  25  import com.dtstack.flink.sql.table.AbstractTableInfo;                                                             </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import com.dtstack.flink.sql.util.DtStringUtil;                                                                   </span>
<span class="2068796536125305875" onmouseenter="enter('2068796536125305875');" onmouseout="out('2068796536125305875');" style="">  27  import com.dtstack.flink.sql.util.JDBCUtils;                                                                      </span>
<span class="6538493847244355843" onmouseenter="enter('6538493847244355843');" onmouseout="out('6538493847244355843');" style="">  28  import com.dtstack.flink.sql.util.KrbUtils;                                                                       </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  29  import com.google.common.collect.Maps;                                                                            </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  30  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  31  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  32  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  33  import org.apache.flink.types.Row;                                                                                </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  34  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  35  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  36  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  37                                                                                                                    </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  38  import java.io.IOException;                                                                                       </span>
<span class="7889752473047782369" onmouseenter="enter('7889752473047782369');" onmouseout="out('7889752473047782369');" style="">  39  import java.security.PrivilegedExceptionAction;                                                                   </span>
<span class="-7136330293413175449" onmouseenter="enter('-7136330293413175449');" onmouseout="out('-7136330293413175449');" style="">  40  import java.sql.Connection;                                                                                       </span>
<span class="7894029524760905232" onmouseenter="enter('7894029524760905232');" onmouseout="out('7894029524760905232');" style="">  41  import java.sql.DriverManager;                                                                                    </span>
<span class="-3337023324264694028" onmouseenter="enter('-3337023324264694028');" onmouseout="out('-3337023324264694028');" style="">  42  import java.sql.PreparedStatement;                                                                                </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  43  import java.sql.SQLException;                                                                                     </span>
<span class="6402527026259660908" onmouseenter="enter('6402527026259660908');" onmouseout="out('6402527026259660908');" style="">  44  import java.sql.Statement;                                                                                        </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  45  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  47  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  48  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  49  import java.util.Map;                                                                                             </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  50  import java.util.Objects;                                                                                         </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  51  import java.util.Set;                                                                                             </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  52  import java.util.concurrent.ScheduledExecutorService;                                                             </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  53  import java.util.concurrent.ScheduledFuture;                                                                      </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  54  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  55  import java.util.concurrent.TimeUnit;                                                                             </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  56  import java.util.regex.Matcher;                                                                                   </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  57  import java.util.regex.Pattern;                                                                                   </span>
<span class="-6051894930872477589" onmouseenter="enter('-6051894930872477589');" onmouseout="out('-6051894930872477589');" style="">  58  import java.util.stream.Collectors;                                                                               </span>
<span  style="">  59                                                                                                                    </span>
<span class="1455633447019431220" onmouseenter="enter('1455633447019431220');" onmouseout="out('1455633447019431220');" style="">  60  import static com.dtstack.flink.sql.sink.rdb.JDBCTypeConvertUtils.setRecordToStatement;                           </span>
<span class="-6257877604578820371" onmouseenter="enter('-6257877604578820371');" onmouseout="out('-6257877604578820371');" style="">  61  import static org.apache.flink.util.Preconditions.checkNotNull;                                                   </span>
<span  style="">  62                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  63  /**                                                                                                               </span>
<span class="7153001641478282104" onmouseenter="enter('7153001641478282104');" onmouseout="out('7153001641478282104');" style="">  64   * Date: 2020/10/14                                                                                               </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  65   * Company: www.dtstack.com                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  66   *                                                                                                                </span>
<span class="-4100502199450942834" onmouseenter="enter('-4100502199450942834');" onmouseout="out('-4100502199450942834');" style="">  67   * @author tiezhu                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  68   */                                                                                                               </span>
<span class="-4121149390422149560" onmouseenter="enter('-4121149390422149560');" onmouseout="out('-4121149390422149560');" style="">  69  public class ImpalaOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                        </span>
<span  style="">  70                                                                                                                    </span>
<span class="-5870848474790717720" onmouseenter="enter('-5870848474790717720');" onmouseout="out('-5870848474790717720');" style="">  71      private static final Logger LOG = LoggerFactory.getLogger(ImpalaOutputFormat.class);                          </span>
<span  style="">  72                                                                                                                    </span>
<span class="-4645219268431852454" onmouseenter="enter('-4645219268431852454');" onmouseout="out('-4645219268431852454');" style="">  73      private static final long serialVersionUID = 1L;                                                              </span>
<span  style="">  74                                                                                                                    </span>
<span class="-9068282285967712029" onmouseenter="enter('-9068282285967712029');" onmouseout="out('-9068282285967712029');" style="">  75      // ${field}                                                                                                   </span>
<span class="-5949646080202310183" onmouseenter="enter('-5949646080202310183');" onmouseout="out('-5949646080202310183');" style="">  76      private static final Pattern STATIC_PARTITION_PATTERN = Pattern.compile(&quot;\\$\\{([^}]*)}&quot;);                    </span>
<span class="5956354208608974741" onmouseenter="enter('5956354208608974741');" onmouseout="out('5956354208608974741');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -    // cast(value as string) -&gt; cast(&#x27;value&#x27; as string)  cast(value as timestamp) -&gt; cast(&#x27;value&#x27; as timestamp)   </span>
<span class="1953221153478650066" onmouseenter="enter('1953221153478650066');" onmouseout="out('1953221153478650066');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -    private static final Pattern TYPE_PATTERN = Pattern.compile(&quot;cast\\((.*) as (.*)\\)&quot;);                        </span>
<span class="6992730206516090107" onmouseenter="enter('6992730206516090107');" onmouseout="out('6992730206516090107');" style="">  79      //specific type which values need to be quoted                                                                </span>
<span class="-2884666096421851487" onmouseenter="enter('-2884666096421851487');" onmouseout="out('-2884666096421851487');" style="">  80      private static final String[] NEED_QUOTE_TYPE = {&quot;string&quot;, &quot;timestamp&quot;, &quot;varchar&quot;};                           </span>
<span  style="">  81                                                                                                                    </span>
<span class="191207487610103693" onmouseenter="enter('191207487610103693');" onmouseout="out('191207487610103693');" style="">  82      private static final Integer DEFAULT_CONN_TIME_OUT = 60;                                                      </span>
<span class="-1388186840411616756" onmouseenter="enter('-1388186840411616756');" onmouseout="out('-1388186840411616756');" style="">  83      private static final int RECEIVE_DATA_PRINT_FREQUENCY = 1000;                                                 </span>
<span class="-4268888009857984730" onmouseenter="enter('-4268888009857984730');" onmouseout="out('-4268888009857984730');" style="">  84      private static final int DIRTY_DATA_PRINT_FREQUENCY = 1000;                                                   </span>
<span  style="">  85                                                                                                                    </span>
<span class="-588818051573867979" onmouseenter="enter('-588818051573867979');" onmouseout="out('-588818051573867979');" style="">  86      private static final String KUDU_TYPE = &quot;kudu&quot;;                                                               </span>
<span class="-6769623881035360393" onmouseenter="enter('-6769623881035360393');" onmouseout="out('-6769623881035360393');" style="">  87      private static final String UPDATE_MODE = &quot;update&quot;;                                                           </span>
<span class="-7709014261424944614" onmouseenter="enter('-7709014261424944614');" onmouseout="out('-7709014261424944614');" style="">  88      private static final String PARTITION_CONSTANT = &quot;PARTITION&quot;;                                                 </span>
<span class="1441081326157561113" onmouseenter="enter('1441081326157561113');" onmouseout="out('1441081326157561113');" style="">  89      private static final String DRIVER_NAME = &quot;com.cloudera.impala.jdbc41.Driver&quot;;                                </span>
<span  style="">  90                                                                                                                    </span>
<span class="-2689163518074835497" onmouseenter="enter('-2689163518074835497');" onmouseout="out('-2689163518074835497');" style="">  91      private static final String VALUES_CONDITION = &quot;${valuesCondition}&quot;;                                          </span>
<span class="3062777246713899037" onmouseenter="enter('3062777246713899037');" onmouseout="out('3062777246713899037');" style="">  92      private static final String PARTITION_CONDITION = &quot;${partitionCondition}&quot;;                                    </span>
<span class="2401236240707522557" onmouseenter="enter('2401236240707522557');" onmouseout="out('2401236240707522557');" style="">  93      private static final String TABLE_FIELDS_CONDITION = &quot;${tableFieldsCondition}&quot;;                               </span>
<span class="3255739684264436552" onmouseenter="enter('3255739684264436552');" onmouseout="out('3255739684264436552');" style="">  94      private static final String NO_PARTITION = &quot;noPartition&quot;;                                                     </span>
<span  style="">  95                                                                                                                    </span>





<span class="-7445073777200404714" onmouseenter="enter('-7445073777200404714');" onmouseout="out('-7445073777200404714');" style="">  96      protected transient Connection connection;                                                                    </span>
<span class="-2184169902108079684" onmouseenter="enter('-2184169902108079684');" onmouseout="out('-2184169902108079684');" style="">  97      protected transient Statement statement;                                                                      </span>
<span class="6238382839663594696" onmouseenter="enter('6238382839663594696');" onmouseout="out('6238382839663594696');" style="">  98      protected transient PreparedStatement updateStatement;                                                        </span>
<span  style="">  99                                                                                                                    </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style=""> 100      private transient volatile boolean closed = false;                                                            </span>
<span class="8220840984571392918" onmouseenter="enter('8220840984571392918');" onmouseout="out('8220840984571392918');" style=""> 101      private int batchCount = 0;                                                                                   </span>
<span  style=""> 102                                                                                                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 103      // |------------------------------------------------|                                                         </span>
<span class="-789927222958732888" onmouseenter="enter('-789927222958732888');" onmouseout="out('-789927222958732888');" style=""> 104      // |   partitionCondition   |Array of valueCondition|                                                         </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 105      // |------------------------------------------------|                                                         </span>
<span class="-8825804998995953162" onmouseenter="enter('-8825804998995953162');" onmouseout="out('-8825804998995953162');" style=""> 106      // | ptOne, ptTwo, ptThree  | [(v1, v2, v3, v4, v5)]|   DP                                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 107      // |------------------------------------------------|                                                         </span>
<span class="-5802382310877164118" onmouseenter="enter('-5802382310877164118');" onmouseout="out('-5802382310877164118');" style=""> 108      // | ptOne = v1, ptTwo = v2 | [(v3, v4, v5)]        |   SP                                                    </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 109      // |------------------------------------------------|                                                         </span>
<span class="2984234039288316275" onmouseenter="enter('2984234039288316275');" onmouseout="out('2984234039288316275');" style=""> 110      // | ptOne, ptTwo = v2      | [(v1, v3, v4, v5)]    |   DP and SP                                             </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 111      // |------------------------------------------------|                                                         </span>
<span class="7219405512764117222" onmouseenter="enter('7219405512764117222');" onmouseout="out('7219405512764117222');" style=""> 112      // | noPartition            | [(v1, v2, v3, v4, v5)]|   kudu or disablePartition                              </span>
<span class="1417511218873382999" onmouseenter="enter('1417511218873382999');" onmouseout="out('1417511218873382999');" style=""> 113      // |------------------------------------------------|                                                         </span>
<span class="9020411500856357590" onmouseenter="enter('9020411500856357590');" onmouseout="out('9020411500856357590');" style=""> 114      private transient Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap;                                                  </span>
<span  style=""> 115                                                                                                                    </span>
<span class="-4172535577750872346" onmouseenter="enter('-4172535577750872346');" onmouseout="out('-4172535577750872346');" style=""> 116      protected String keytabPath;                                                                                  </span>
<span class="1987487277257130103" onmouseenter="enter('1987487277257130103');" onmouseout="out('1987487277257130103');" style=""> 117      protected String krb5confPath;                                                                                </span>
<span class="3478885111338451838" onmouseenter="enter('3478885111338451838');" onmouseout="out('3478885111338451838');" style=""> 118      protected String principal;                                                                                   </span>
<span class="-2673327721248325609" onmouseenter="enter('-2673327721248325609');" onmouseout="out('-2673327721248325609');" style=""> 119      protected Integer authMech;                                                                                   </span>
<span class="-8834882937031238604" onmouseenter="enter('-8834882937031238604');" onmouseout="out('-8834882937031238604');" style=""> 120      protected String dbUrl;                                                                                       </span>
<span class="4348689613054045460" onmouseenter="enter('4348689613054045460');" onmouseout="out('4348689613054045460');" style=""> 121      protected String userName;                                                                                    </span>
<span class="519247125889688558" onmouseenter="enter('519247125889688558');" onmouseout="out('519247125889688558');" style=""> 122      protected String password;                                                                                    </span>
<span class="-7554929939288236010" onmouseenter="enter('-7554929939288236010');" onmouseout="out('-7554929939288236010');" style=""> 123      protected int batchSize = 100;                                                                                </span>
<span class="8848445520039039194" onmouseenter="enter('8848445520039039194');" onmouseout="out('8848445520039039194');" style=""> 124      protected long batchWaitInterval = 60 * 1000L;                                                                </span>
<span class="6924126392600265325" onmouseenter="enter('6924126392600265325');" onmouseout="out('6924126392600265325');" style=""> 125      protected String tableName;                                                                                   </span>
<span class="-8067881189136281922" onmouseenter="enter('-8067881189136281922');" onmouseout="out('-8067881189136281922');" style=""> 126      protected List&lt;String&gt; primaryKeys;                                                                           </span>
<span class="-1238809985534246985" onmouseenter="enter('-1238809985534246985');" onmouseout="out('-1238809985534246985');" style=""> 127      protected String partitionFields;                                                                             </span>
<span class="-2843446813182919439" onmouseenter="enter('-2843446813182919439');" onmouseout="out('-2843446813182919439');" style=""> 128      protected Boolean enablePartition;                                                                            </span>
<span class="3349082107931708476" onmouseenter="enter('3349082107931708476');" onmouseout="out('3349082107931708476');" style=""> 129      protected String schema;                                                                                      </span>
<span class="-2869920961807604939" onmouseenter="enter('-2869920961807604939');" onmouseout="out('-2869920961807604939');" style=""> 130      protected String storeType;                                                                                   </span>
<span class="-7730622042083062639" onmouseenter="enter('-7730622042083062639');" onmouseout="out('-7730622042083062639');" style=""> 131      protected String updateMode;                                                                                  </span>
<span class="8729932671243795004" onmouseenter="enter('8729932671243795004');" onmouseout="out('8729932671243795004');" style=""> 132      public List&lt;String&gt; fieldNames;                                                                               </span>
<span class="5323664213258183290" onmouseenter="enter('5323664213258183290');" onmouseout="out('5323664213258183290');" style=""> 133      public List&lt;String&gt; fieldTypes;                                                                               </span>
<span class="589573262942162938" onmouseenter="enter('589573262942162938');" onmouseout="out('589573262942162938');" style=""> 134      public List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList;                                             </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-2123205835999557493" onmouseenter="enter('-2123205835999557493');" onmouseout="out('-2123205835999557493');" style=""> 136      // partition field of static partition which matched by ${field}                                              </span>
<span class="-976040292573398488" onmouseenter="enter('-976040292573398488');" onmouseout="out('-976040292573398488');" style=""> 137      private final List&lt;String&gt; staticPartitionFields = new ArrayList&lt;&gt;();                                         </span>
<span  style=""> 138                                                                                                                    </span>














<span class="8461763253073029471" onmouseenter="enter('8461763253073029471');" onmouseout="out('8461763253073029471');" style=""> 139      // valueFieldsName -&gt; 重组之后的fieldNames，为了重组row data字段值对应                                                       </span>
<span class="-5473349939362349748" onmouseenter="enter('-5473349939362349748');" onmouseout="out('-5473349939362349748');" style=""> 140      // 需要对partition字段做特殊处理，比如原来的字段顺序为(age, name, id)，但是因为partition，写入的SQL为                                        </span>
<span class="888010466316090175" onmouseenter="enter('888010466316090175');" onmouseout="out('888010466316090175');" style=""> 141      // INSERT INTO tableName(name, id) PARTITION(age) VALUES(?, ?, ?)                                             </span>
<span class="1229277488566704041" onmouseenter="enter('1229277488566704041');" onmouseout="out('1229277488566704041');" style=""> 142      // 那么实际executeSql设置字段的顺序应该为(name, id, age)，同时，字段对应的type顺序也需要重组                                                </span>
<span class="6098973354216055964" onmouseenter="enter('6098973354216055964');" onmouseout="out('6098973354216055964');" style=""> 143      private List&lt;String&gt; valueFieldNames;                                                                         </span>
<span class="-7108089166418781511" onmouseenter="enter('-7108089166418781511');" onmouseout="out('-7108089166418781511');" style=""> 144      private transient AbstractDtRichOutputFormat&lt;?&gt; metricOutputFormat;                                           </span>
<span class="273368026714901275" onmouseenter="enter('273368026714901275');" onmouseout="out('273368026714901275');" style=""> 145      private List&lt;Row&gt; rows;                                                                                       </span>
<span  style=""> 146                                                                                                                    </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style=""> 147      private transient ScheduledExecutorService scheduler;                                                         </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style=""> 148      private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                         </span>




<span  style=""> 149                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 150      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 151      public void configure(Configuration parameters) {                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152      }                                                                                                             </span>
<span  style=""> 153                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 154      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 155      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 156          try {                                                                                                     </span>
<span class="4324779626821739975" onmouseenter="enter('4324779626821739975');" onmouseout="out('4324779626821739975');" style=""> 157              rowDataMap = new HashMap&lt;&gt;();                                                                         </span>
<span class="-6551372933934183741" onmouseenter="enter('-6551372933934183741');" onmouseout="out('-6551372933934183741');" style=""> 158              rows = new ArrayList&lt;&gt;();                                                                             </span>
<span class="-7937337195293668220" onmouseenter="enter('-7937337195293668220');" onmouseout="out('-7937337195293668220');" style=""> 159              metricOutputFormat = this;                                                                            </span>
<span class="-8035752082134444550" onmouseenter="enter('-8035752082134444550');" onmouseout="out('-8035752082134444550');" style=""> 160              openConnect();                                                                                        </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 161              initScheduledTask(batchWaitInterval);                                                                 </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style=""> 162              init();                                                                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 163              initMetric();                                                                                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 164          } catch (Exception e) {                                                                                   </span>
<span class="-105883012207117402" onmouseenter="enter('-105883012207117402');" onmouseout="out('-105883012207117402');" style=""> 165              throw new RuntimeException(&quot;impala output format open error!&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167      }                                                                                                             </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-8578201295687943948" onmouseenter="enter('-8578201295687943948');" onmouseout="out('-8578201295687943948');" style=""> 169      private void init() throws SQLException {                                                                     </span>
<span class="-8350145873279772804" onmouseenter="enter('-8350145873279772804');" onmouseout="out('-8350145873279772804');" style=""> 170          if (Objects.nonNull(partitionFields)) {                                                                   </span>
<span class="8590422903839909721" onmouseenter="enter('8590422903839909721');" onmouseout="out('8590422903839909721');" style=""> 171              // match ${field} from partitionFields                                                                </span>
<span class="399614494149678967" onmouseenter="enter('399614494149678967');" onmouseout="out('399614494149678967');" style=""> 172              Matcher matcher = STATIC_PARTITION_PATTERN.matcher(partitionFields);                                  </span>
<span class="-5488916631119752457" onmouseenter="enter('-5488916631119752457');" onmouseout="out('-5488916631119752457');" style=""> 173              while (matcher.find()) {                                                                              </span>
<span class="-1180668930060799754" onmouseenter="enter('-1180668930060799754');" onmouseout="out('-1180668930060799754');" style=""> 174                  LOG.info(&quot;find static partition field: {}&quot;, matcher.group(1));                                    </span>
<span class="5933786634924389530" onmouseenter="enter('5933786634924389530');" onmouseout="out('5933786634924389530');" style=""> 175                  staticPartitionFields.add(matcher.group(1));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177          }                                                                                                         </span>
<span  style=""> 178                                                                                                                    </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 179          if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                           </span>
<span class="-511688609314859464" onmouseenter="enter('-511688609314859464');" onmouseout="out('-511688609314859464');" style=""> 180              if (!storeType.equalsIgnoreCase(KUDU_TYPE)) {                                                         </span>
<span class="7738691828431171650" onmouseenter="enter('7738691828431171650');" onmouseout="out('7738691828431171650');" style=""> 181                  throw new IllegalArgumentException(&quot;update mode not support for non-kudu table!&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182              }                                                                                                     </span>
<span class="-1926567860735108753" onmouseenter="enter('-1926567860735108753');" onmouseout="out('-1926567860735108753');" style=""><abbr title=" 183              updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, primaryKeys));"> 183              updateStatement = connection.prepareStatement(buildUpdateSql(schema, tableName, fieldNames, primaryKey🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 184          } else {                                                                                                  </span>
<span class="5264299831364970974" onmouseenter="enter('5264299831364970974');" onmouseout="out('5264299831364970974');" style=""><abbr title=" 185              valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTypes, partitionFields);"> 185              valueFieldNames = rebuildFieldNameListAndTypeList(fieldNames, staticPartitionFields, fieldTypes, parti🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186          }                                                                                                         </span>
<span  style=""> 187                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188      }                                                                                                             </span>
<span  style=""> 189                                                                                                                    </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 190      private void initScheduledTask(Long batchWaitInterval) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 191          try {                                                                                                     </span>
<span class="-5481453632006175071" onmouseenter="enter('-5481453632006175071');" onmouseout="out('-5481453632006175071');" style=""> 192              if (batchWaitInterval != 0) {                                                                         </span>
<span class="777682131179381780" onmouseenter="enter('777682131179381780');" onmouseout="out('777682131179381780');" style=""> 193                  this.scheduler = new ScheduledThreadPoolExecutor(1,                                               </span>
<span class="714213466749562787" onmouseenter="enter('714213466749562787');" onmouseout="out('714213466749562787');" style=""> 194                          new DTThreadFactory(&quot;impala-upsert-output-format&quot;));                                      </span>
<span class="-7149116985444787635" onmouseenter="enter('-7149116985444787635');" onmouseout="out('-7149116985444787635');" style=""> 195                  this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(() -&gt; {                              </span>
<span class="-940414522275968791" onmouseenter="enter('-940414522275968791');" onmouseout="out('-940414522275968791');" style=""> 196                      synchronized (ImpalaOutputFormat.this) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 197 -                        try {                                                                                     </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 198 -                            flush();                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -                        } catch (Exception e) {                                                                   </span>
<span class="-5628183046854957718" onmouseenter="enter('-5628183046854957718');" onmouseout="out('-5628183046854957718');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -                            LOG.error(&quot;Writing records to impala jdbc failed.&quot;, e);                               </span>
<span class="-7023774051195191894" onmouseenter="enter('-7023774051195191894');" onmouseout="out('-7023774051195191894');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -                            throw new RuntimeException(&quot;Writing records to impala jdbc failed.&quot;, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -                        }                                                                                         </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +                        flush();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204                      }                                                                                             </span>
<span class="8465771028460365894" onmouseenter="enter('8465771028460365894');" onmouseout="out('8465771028460365894');" style=""> 205                  }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 207          } catch (Exception e) {                                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 208              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210      }                                                                                                             </span>
<span  style=""> 211                                                                                                                    </span>
<span class="-2844613068709206340" onmouseenter="enter('-2844613068709206340');" onmouseout="out('-2844613068709206340');" style=""> 212      private void openConnect() throws IOException {                                                               </span>
<span class="-2394055578891206899" onmouseenter="enter('-2394055578891206899');" onmouseout="out('-2394055578891206899');" style=""> 213          if (authMech == 1) {                                                                                      </span>
<span class="-7445609792053649263" onmouseenter="enter('-7445609792053649263');" onmouseout="out('-7445609792053649263');" style=""> 214              UserGroupInformation ugi = KrbUtils.loginAndReturnUgi(principal, keytabPath, krb5confPath);           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 215              try {                                                                                                 </span>
<span class="1057249312142684394" onmouseenter="enter('1057249312142684394');" onmouseout="out('1057249312142684394');" style=""> 216                  ugi.doAs((PrivilegedExceptionAction&lt;Void&gt;) () -&gt; {                                                </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 217                      openJdbc();                                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 218                      return null;                                                                                  </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 219                  });                                                                                               </span>
<span class="3693318474890767753" onmouseenter="enter('3693318474890767753');" onmouseout="out('3693318474890767753');" style=""> 220              } catch (InterruptedException | IOException e) {                                                      </span>
<span class="-3216725393010457363" onmouseenter="enter('-3216725393010457363');" onmouseout="out('-3216725393010457363');" style=""> 221                  throw new IllegalArgumentException(&quot;connect impala error!&quot;, e);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 223          } else {                                                                                                  </span>
<span class="-8367326114243113305" onmouseenter="enter('-8367326114243113305');" onmouseout="out('-8367326114243113305');" style=""> 224              openJdbc();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226      }                                                                                                             </span>
<span  style=""> 227                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 228      /**                                                                                                           </span>
<span class="-4019084214603833891" onmouseenter="enter('-4019084214603833891');" onmouseout="out('-4019084214603833891');" style=""> 229       * get jdbc connection                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 230       */                                                                                                           </span>
<span class="6517717324631316532" onmouseenter="enter('6517717324631316532');" onmouseout="out('6517717324631316532');" style=""> 231      private void openJdbc() {                                                                                     </span>
<span class="-5989471214664392944" onmouseenter="enter('-5989471214664392944');" onmouseout="out('-5989471214664392944');" style=""> 232          JDBCUtils.forName(DRIVER_NAME, getClass().getClassLoader());                                              </span>

<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 233          try {                                                                                                     </span>
<span class="-4188974437029144237" onmouseenter="enter('-4188974437029144237');" onmouseout="out('-4188974437029144237');" style=""> 234              connection = DriverManager.getConnection(dbUrl, userName, password);                                  </span>
<span class="-3909190598463408725" onmouseenter="enter('-3909190598463408725');" onmouseout="out('-3909190598463408725');" style=""> 235              statement = connection.createStatement();                                                             </span>
<span class="1164602517684291637" onmouseenter="enter('1164602517684291637');" onmouseout="out('1164602517684291637');" style=""> 236              connection.setAutoCommit(false);                                                                      </span>
<span class="-2037802754415730828" onmouseenter="enter('-2037802754415730828');" onmouseout="out('-2037802754415730828');" style=""> 237          } catch (SQLException sqlException) {                                                                     </span>
<span class="8417232372887360387" onmouseenter="enter('8417232372887360387');" onmouseout="out('8417232372887360387');" style=""> 238              throw new RuntimeException(&quot;get impala jdbc connection failed!&quot;, sqlException);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240      }                                                                                                             </span>
<span  style=""> 241                                                                                                                    </span>
<span class="7521208138226245516" onmouseenter="enter('7521208138226245516');" onmouseout="out('7521208138226245516');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 242 -    private void flush() throws Exception {                                                                       </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 243 -        if (batchCount &gt; 0) {                                                                                     </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 244 -            if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                       </span>
<span class="-7210745719484505959" onmouseenter="enter('-7210745719484505959');" onmouseout="out('-7210745719484505959');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 245 -                executeUpdateBatch();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 246 -            }                                                                                                     </span>
<span class="-5565980137871755476" onmouseenter="enter('-5565980137871755476');" onmouseout="out('-5565980137871755476');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 247 -            if (!rowDataMap.isEmpty()) {                                                                          </span>
<span class="8546814641173072756" onmouseenter="enter('8546814641173072756');" onmouseout="out('8546814641173072756');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 248 -                String templateSql =                                                                              </span>
<span class="4897761129654612880" onmouseenter="enter('4897761129654612880');" onmouseout="out('4897761129654612880');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +    private synchronized void flush() {                                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +        try {                                                                                                     </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +            if (batchCount &gt; 0) {                                                                                 </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +                if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                   </span>
<span class="-7210745719484505959" onmouseenter="enter('-7210745719484505959');" onmouseout="out('-7210745719484505959');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +                    executeUpdateBatch();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +                }                                                                                                 </span>
<span class="-5565980137871755476" onmouseenter="enter('-5565980137871755476');" onmouseout="out('-5565980137871755476');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +                if (!rowDataMap.isEmpty()) {                                                                      </span>
<span class="8546814641173072756" onmouseenter="enter('8546814641173072756');" onmouseout="out('8546814641173072756');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +                    String templateSql =                                                                          </span>
<span class="-1766017053596733683" onmouseenter="enter('-1766017053596733683');" onmouseout="out('-1766017053596733683');" style=""><abbr title=" 257                          &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VALUES ${valuesCondition}&quot;;"> 257                          &quot;INSERT INTO tableName ${tableFieldsCondition} PARTITION ${partitionCondition} VALUES ${va🔵</abbr></span>
<span class="7007887973141057675" onmouseenter="enter('7007887973141057675');" onmouseout="out('7007887973141057675');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 258 -                executeBatchSql(                                                                                  </span>
<span class="839015566868436312" onmouseenter="enter('839015566868436312');" onmouseout="out('839015566868436312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 259 -                        statement,                                                                                </span>
<span class="7007887973141057675" onmouseenter="enter('7007887973141057675');" onmouseout="out('7007887973141057675');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +                    executeBatchSql(                                                                              </span>
<span class="-8931083358346849072" onmouseenter="enter('-8931083358346849072');" onmouseout="out('-8931083358346849072');" style=""> 261                          templateSql,                                                                              </span>
<span class="5582129011297069726" onmouseenter="enter('5582129011297069726');" onmouseout="out('5582129011297069726');" style=""> 262                          schema,                                                                                   </span>
<span class="8599198975592615021" onmouseenter="enter('8599198975592615021');" onmouseout="out('8599198975592615021');" style=""> 263                          tableName,                                                                                </span>
<span class="7739930709415439240" onmouseenter="enter('7739930709415439240');" onmouseout="out('7739930709415439240');" style=""> 264                          storeType,                                                                                </span>
<span class="4460343981916954231" onmouseenter="enter('4460343981916954231');" onmouseout="out('4460343981916954231');" style=""> 265                          enablePartition,                                                                          </span>
<span class="-232795436679668454" onmouseenter="enter('-232795436679668454');" onmouseout="out('-232795436679668454');" style=""> 266                          valueFieldNames,                                                                          </span>
<span class="2377300059169474736" onmouseenter="enter('2377300059169474736');" onmouseout="out('2377300059169474736');" style=""> 267                          partitionFields,                                                                          </span>
<span class="-163268273074797630" onmouseenter="enter('-163268273074797630');" onmouseout="out('-163268273074797630');" style=""> 268                          rowDataMap                                                                                </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -                );                                                                                                </span>
<span class="1629791312198735010" onmouseenter="enter('1629791312198735010');" onmouseout="out('1629791312198735010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 270 -                rowDataMap.clear();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 271 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 272 -        }                                                                                                         </span>
<span class="-5311733944590264805" onmouseenter="enter('-5311733944590264805');" onmouseout="out('-5311733944590264805');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 273 -        batchCount = 0;                                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 274 -                                                                                                                  </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +                    );                                                                                            </span>
<span class="1629791312198735010" onmouseenter="enter('1629791312198735010');" onmouseout="out('1629791312198735010');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +                    rowDataMap.clear();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +            }                                                                                                     </span>
<span class="-5311733944590264805" onmouseenter="enter('-5311733944590264805');" onmouseout="out('-5311733944590264805');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +            batchCount = 0;                                                                                       </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +        } catch (Exception e) {                                                                                   </span>
<span class="-5628183046854957718" onmouseenter="enter('-5628183046854957718');" onmouseout="out('-5628183046854957718');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +            LOG.error(&quot;Writing records to impala jdbc failed.&quot;, e);                                               </span>
<span class="-7023774051195191894" onmouseenter="enter('-7023774051195191894');" onmouseout="out('-7023774051195191894');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +            throw new RuntimeException(&quot;Writing records to impala jdbc failed.&quot;, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284      }                                                                                                             </span>
<span  style=""> 285                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 286      /**                                                                                                           </span>
<span class="-1106181825212481278" onmouseenter="enter('-1106181825212481278');" onmouseout="out('-1106181825212481278');" style=""> 287       * execute batch update statement                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 288       *                                                                                                            </span>
<span class="3560665881375675274" onmouseenter="enter('3560665881375675274');" onmouseout="out('3560665881375675274');" style=""> 289       * @throws SQLException throw sql exception                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 290       */                                                                                                           </span>
<span class="3206601587144870407" onmouseenter="enter('3206601587144870407');" onmouseout="out('3206601587144870407');" style=""> 291      private void executeUpdateBatch() throws SQLException {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 292          try {                                                                                                     </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 293              rows.forEach(row -&gt; {                                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 294                  try {                                                                                             </span>
<span class="-1215139546593028546" onmouseenter="enter('-1215139546593028546');" onmouseout="out('-1215139546593028546');" style=""> 295                      JDBCTypeConvertUtils.setRecordToStatement(                                                    </span>
<span class="-4710389352980966846" onmouseenter="enter('-4710389352980966846');" onmouseout="out('-4710389352980966846');" style=""> 296                              updateStatement,                                                                      </span>
<span class="4668718668329814914" onmouseenter="enter('4668718668329814914');" onmouseout="out('4668718668329814914');" style=""> 297                              JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes),                             </span>
<span class="-7576027683765873339" onmouseenter="enter('-7576027683765873339');" onmouseout="out('-7576027683765873339');" style=""> 298                              row,                                                                                  </span>
<span class="-255277236311302851" onmouseenter="enter('-255277236311302851');" onmouseout="out('-255277236311302851');" style=""> 299                              primaryKeys.stream().mapToInt(fieldNames::indexOf).toArray()                          </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 300                      );                                                                                            </span>
<span class="-4238050377414791796" onmouseenter="enter('-4238050377414791796');" onmouseout="out('-4238050377414791796');" style=""> 301                      updateStatement.addBatch();                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 302                  } catch (Exception e) {                                                                           </span>
<span class="5068376771892501659" onmouseenter="enter('5068376771892501659');" onmouseout="out('5068376771892501659');" style=""> 303                      throw new RuntimeException(&quot;impala jdbc execute batch error!&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304                  }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 305              });                                                                                                   </span>
<span class="-3747739502872154032" onmouseenter="enter('-3747739502872154032');" onmouseout="out('-3747739502872154032');" style=""> 306              updateStatement.executeBatch();                                                                       </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style=""> 307              connection.commit();                                                                                  </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 308              rows.clear();                                                                                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 309          } catch (Exception e) {                                                                                   </span>
<span class="1715728751446881781" onmouseenter="enter('1715728751446881781');" onmouseout="out('1715728751446881781');" style=""> 310              LOG.debug(&quot;impala jdbc execute batch error &quot;, e);                                                     </span>
<span class="7087468057749493272" onmouseenter="enter('7087468057749493272');" onmouseout="out('7087468057749493272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -            connection.rollback();                                                                                </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -            connection.commit();                                                                                  </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +            JDBCUtils.rollBack(connection);                                                                       </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +            JDBCUtils.commit(connection);                                                                         </span>
<span class="-4187732730208785389" onmouseenter="enter('-4187732730208785389');" onmouseout="out('-4187732730208785389');" style=""> 315              updateStatement.clearBatch();                                                                         </span>
<span class="-8814080953460465644" onmouseenter="enter('-8814080953460465644');" onmouseout="out('-8814080953460465644');" style=""> 316              executeUpdate(connection);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318      }                                                                                                             </span>
<span  style=""> 319                                                                                                                    </span>
<span class="-4847686400566224446" onmouseenter="enter('-4847686400566224446');" onmouseout="out('-4847686400566224446');" style=""> 320      public void executeUpdate(Connection connection) {                                                            </span>
<span class="-2642147019263217962" onmouseenter="enter('-2642147019263217962');" onmouseout="out('-2642147019263217962');" style=""> 321          rows.forEach(row -&gt; {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 322              try {                                                                                                 </span>
<span class="3018395377218617369" onmouseenter="enter('3018395377218617369');" onmouseout="out('3018395377218617369');" style=""><abbr title=" 323                  setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), row);"> 323                  setRecordToStatement(updateStatement, JDBCTypeConvertUtils.getSqlTypeFromFieldType(fieldTypes), ro🔵</abbr></span>
<span class="-6547782628025070914" onmouseenter="enter('-6547782628025070914');" onmouseout="out('-6547782628025070914');" style=""> 324                  updateStatement.executeUpdate();                                                                  </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -                connection.commit();                                                                              </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +                JDBCUtils.commit(connection);                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 327              } catch (Exception e) {                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -                try {                                                                                             </span>
<span class="7087468057749493272" onmouseenter="enter('7087468057749493272');" onmouseout="out('7087468057749493272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -                    connection.rollback();                                                                        </span>
<span class="2006839820365524481" onmouseenter="enter('2006839820365524481');" onmouseout="out('2006839820365524481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -                    connection.commit();                                                                          </span>
<span class="-9008476763811710828" onmouseenter="enter('-9008476763811710828');" onmouseout="out('-9008476763811710828');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -                } catch (SQLException e1) {                                                                       </span>
<span class="-2635323073569974258" onmouseenter="enter('-2635323073569974258');" onmouseout="out('-2635323073569974258');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -                    throw new RuntimeException(e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -                }                                                                                                 </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 334 +                JDBCUtils.rollBack(connection);                                                                   </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +                JDBCUtils.commit(connection);                                                                     </span>
<span class="-4808081927273297919" onmouseenter="enter('-4808081927273297919');" onmouseout="out('-4808081927273297919');" style=""><abbr title=" 336                  if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {"> 336                  if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebug🔵</abbr></span>
<span class="-2764908242367356599" onmouseenter="enter('-2764908242367356599');" onmouseout="out('-2764908242367356599');" style=""> 337                      LOG.error(&quot;record insert failed ,this row is {}&quot;, row.toString());                            </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 338                      LOG.error(&quot;&quot;, e);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339                  }                                                                                                 </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style=""> 340                  metricOutputFormat.outDirtyRecords.inc();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 341              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 342          });                                                                                                       </span>
<span class="753423689300194539" onmouseenter="enter('753423689300194539');" onmouseout="out('753423689300194539');" style=""> 343          rows.clear();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344      }                                                                                                             </span>
<span  style=""> 345                                                                                                                    </span>
<span class="5541545914698662583" onmouseenter="enter('5541545914698662583');" onmouseout="out('5541545914698662583');" style=""> 346      private void putRowIntoMap(Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap, Tuple2&lt;String, String&gt; rowData) {       </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style=""> 347          Set&lt;String&gt; keySet = rowDataMap.keySet();                                                                 </span>
<span class="-4115511162008757651" onmouseenter="enter('-4115511162008757651');" onmouseout="out('-4115511162008757651');" style=""> 348          ArrayList&lt;String&gt; tempRowArray;                                                                           </span>
<span class="-6312285345137005178" onmouseenter="enter('-6312285345137005178');" onmouseout="out('-6312285345137005178');" style=""> 349          if (keySet.contains(rowData.f0)) {                                                                        </span>
<span class="2063657660163215007" onmouseenter="enter('2063657660163215007');" onmouseout="out('2063657660163215007');" style=""> 350              tempRowArray = rowDataMap.get(rowData.f0);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 351          } else {                                                                                                  </span>
<span class="7109917545131433172" onmouseenter="enter('7109917545131433172');" onmouseout="out('7109917545131433172');" style=""> 352              tempRowArray = new ArrayList&lt;&gt;();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353          }                                                                                                         </span>
<span class="1467529594977533778" onmouseenter="enter('1467529594977533778');" onmouseout="out('1467529594977533778');" style=""> 354          tempRowArray.add(rowData.f1);                                                                             </span>
<span class="6767865840186405987" onmouseenter="enter('6767865840186405987');" onmouseout="out('6767865840186405987');" style=""> 355          rowDataMap.put(rowData.f0, tempRowArray);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356      }                                                                                                             </span>
<span  style=""> 357                                                                                                                    </span>
<span class="3578278218776325408" onmouseenter="enter('3578278218776325408');" onmouseout="out('3578278218776325408');" style=""><abbr title=" 358      private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPartitionFields, List&lt;String&gt; fieldTypes, String partitionFields) {"> 358      private List&lt;String&gt; rebuildFieldNameListAndTypeList(List&lt;String&gt; fieldNames, List&lt;String&gt; staticPartitionFiel🔵</abbr></span>
<span class="-4698577817001148605" onmouseenter="enter('-4698577817001148605');" onmouseout="out('-4698577817001148605');" style=""> 359          if (partitionFields == null || partitionFields.isEmpty()) {                                               </span>
<span class="2916035488958294792" onmouseenter="enter('2916035488958294792');" onmouseout="out('2916035488958294792');" style=""> 360              return fieldNames;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361          }                                                                                                         </span>
<span  style=""> 362                                                                                                                    </span>
<span class="7990418778069769767" onmouseenter="enter('7990418778069769767');" onmouseout="out('7990418778069769767');" style=""> 363          List&lt;String&gt; valueFields = new ArrayList&lt;&gt;(fieldNames);                                                   </span>
<span  style=""> 364                                                                                                                    </span>
<span class="2302239674432319726" onmouseenter="enter('2302239674432319726');" onmouseout="out('2302239674432319726');" style=""> 365          for (int i = valueFields.size() - 1; i &gt;= 0; i--) {                                                       </span>
<span class="-8004931019804249555" onmouseenter="enter('-8004931019804249555');" onmouseout="out('-8004931019804249555');" style=""> 366              if (staticPartitionFields.contains(fieldNames.get(i))) {                                              </span>
<span class="-3872161480019783193" onmouseenter="enter('-3872161480019783193');" onmouseout="out('-3872161480019783193');" style=""> 367                  valueFields.remove(i);                                                                            </span>
<span class="5504621354582269117" onmouseenter="enter('5504621354582269117');" onmouseout="out('5504621354582269117');" style=""> 368                  fieldTypes.remove(i);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370          }                                                                                                         </span>
<span  style=""> 371                                                                                                                    </span>
<span class="8724369392835521335" onmouseenter="enter('8724369392835521335');" onmouseout="out('8724369392835521335');" style=""> 372          for (int i = 0; i &lt; valueFields.size(); i++) {                                                            </span>
<span class="4573573241123850638" onmouseenter="enter('4573573241123850638');" onmouseout="out('4573573241123850638');" style=""> 373              if (partitionFields.contains(fieldNames.get(i))) {                                                    </span>
<span class="-6733214010943616061" onmouseenter="enter('-6733214010943616061');" onmouseout="out('-6733214010943616061');" style=""> 374                  valueFields.add(valueFields.remove(i));                                                           </span>
<span class="3100686975272655596" onmouseenter="enter('3100686975272655596');" onmouseout="out('3100686975272655596');" style=""> 375                  fieldTypes.add(fieldTypes.remove(i));                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377          }                                                                                                         </span>
<span  style=""> 378                                                                                                                    </span>
<span class="-4055330890426471630" onmouseenter="enter('-4055330890426471630');" onmouseout="out('-4055330890426471630');" style=""> 379          return valueFields;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380      }                                                                                                             </span>
<span  style=""> 381                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -    /**                                                                                                           </span>
<span class="-8974785826875952090" onmouseenter="enter('-8974785826875952090');" onmouseout="out('-8974785826875952090');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 383 -     * Quote a specific type of value, like string, timestamp                                                     </span>
<span class="-6015231753011783708" onmouseenter="enter('-6015231753011783708');" onmouseout="out('-6015231753011783708');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -     * before: 1, cast(tiezhu as string), cast(2001-01-09 01:05:01 as timestamp), cast(123 as int)                </span>
<span class="-9072843877687738552" onmouseenter="enter('-9072843877687738552');" onmouseout="out('-9072843877687738552');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 385 -     * after: 1, cast(&#x27;tiezhu&#x27; as string), cast(&#x27;2001-01-09 01:05:01&#x27; as timestamp), cast(123 as int)             </span>
<span class="1334750812652161584" onmouseenter="enter('1334750812652161584');" onmouseout="out('1334750812652161584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -     * if cast value is null, then cast(null as type)                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 387 -     *                                                                                                            </span>
<span class="-7193371921927395943" onmouseenter="enter('-7193371921927395943');" onmouseout="out('-7193371921927395943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 388 -     * @param valueCondition original value condition                                                             </span>
<span class="-4015247136226058388" onmouseenter="enter('-4015247136226058388');" onmouseout="out('-4015247136226058388');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 389 -     * @return quoted condition                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 390 -     */                                                                                                           </span>
<span class="-8514684189215878898" onmouseenter="enter('-8514684189215878898');" onmouseout="out('-8514684189215878898');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 391 -    private String valueConditionAddQuotation(String valueCondition) {                                            </span>
<span class="-7296893889335175056" onmouseenter="enter('-7296893889335175056');" onmouseout="out('-7296893889335175056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 392 -        String[] temps = valueCondition.split(&quot;,&quot;);                                                               </span>
<span class="936116613567496626" onmouseenter="enter('936116613567496626');" onmouseout="out('936116613567496626');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -        List&lt;String&gt; replacedItem = new ArrayList&lt;&gt;();                                                            </span>
<span class="-3322970786555187036" onmouseenter="enter('-3322970786555187036');" onmouseout="out('-3322970786555187036');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 394 -        Arrays.stream(temps).forEach(                                                                             </span>
<span class="4635365489417489024" onmouseenter="enter('4635365489417489024');" onmouseout="out('4635365489417489024');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 395 -                item -&gt; {                                                                                         </span>
<span class="-4536988729093203149" onmouseenter="enter('-4536988729093203149');" onmouseout="out('-4536988729093203149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 396 -                    Matcher matcher = TYPE_PATTERN.matcher(item);                                                 </span>
<span class="-5488916631119752457" onmouseenter="enter('-5488916631119752457');" onmouseout="out('-5488916631119752457');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 397 -                    while (matcher.find()) {                                                                      </span>
<span class="4482463139402405127" onmouseenter="enter('4482463139402405127');" onmouseout="out('4482463139402405127');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 398 -                        String value = matcher.group(1);                                                          </span>
<span class="-7401464861945434758" onmouseenter="enter('-7401464861945434758');" onmouseout="out('-7401464861945434758');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 399 -                        String type = matcher.group(2);                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 400 -                                                                                                                  </span>
<span class="173086077329077799" onmouseenter="enter('173086077329077799');" onmouseout="out('173086077329077799');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 401 -                        for (String needQuoteType : NEED_QUOTE_TYPE) {                                            </span>
<span class="-6207157170096749111" onmouseenter="enter('-6207157170096749111');" onmouseout="out('-6207157170096749111');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 402 -                            if (type.contains(needQuoteType)) {                                                   </span>
<span class="8347227757103419143" onmouseenter="enter('8347227757103419143');" onmouseout="out('8347227757103419143');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 403 -                                if (!&quot;null&quot;.equals(value)) {                                                      </span>
<span class="-4537434762580953169" onmouseenter="enter('-4537434762580953169');" onmouseout="out('-4537434762580953169');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 404 -                                    item = item.replace(value, &quot;&#x27;&quot; + value + &quot;&#x27;&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 405 -                                }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -                            }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -                        }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 408 -                    }                                                                                             </span>
<span class="8193346150481678438" onmouseenter="enter('8193346150481678438');" onmouseout="out('8193346150481678438');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 409 -                    replacedItem.add(item);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -                }                                                                                                 </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 411 -        );                                                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 412 -                                                                                                                  </span>
<span class="7763750891527797776" onmouseenter="enter('7763750891527797776');" onmouseout="out('7763750891527797776');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 413 -        return &quot;(&quot; + String.join(&quot;, &quot;, replacedItem) + &quot;)&quot;;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 414 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 415 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 416      @Override                                                                                                     </span>
<span class="-8766503565464123288" onmouseenter="enter('-8766503565464123288');" onmouseout="out('-8766503565464123288');" style=""> 417      public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) throws IOException {                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 418          try {                                                                                                     </span>
<span class="-1438543337409690372" onmouseenter="enter('-1438543337409690372');" onmouseout="out('-1438543337409690372');" style=""> 419              if (!record.f0) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 420                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421              }                                                                                                     </span>
<span  style=""> 422                                                                                                                    </span>
<span class="-8847095116449263406" onmouseenter="enter('-8847095116449263406');" onmouseout="out('-8847095116449263406');" style=""> 423              if (outRecords.getCount() % RECEIVE_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {              </span>
<span class="867853870420543335" onmouseenter="enter('867853870420543335');" onmouseout="out('867853870420543335');" style=""> 424                  LOG.info(&quot;Receive data : {}&quot;, record);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425              }                                                                                                     </span>
<span  style=""> 426                                                                                                                    </span>
<span class="6938128932061491747" onmouseenter="enter('6938128932061491747');" onmouseout="out('6938128932061491747');" style=""> 427              if (updateMode.equalsIgnoreCase(UPDATE_MODE)) {                                                       </span>
<span class="-4538110507205524162" onmouseenter="enter('-4538110507205524162');" onmouseout="out('-4538110507205524162');" style=""> 428                  rows.add(Row.copy(record.f1));                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 429              } else {                                                                                              </span>
<span class="-7917205410914838057" onmouseenter="enter('-7917205410914838057');" onmouseout="out('-7917205410914838057');" style=""> 430                  Map&lt;String, Object&gt; valueMap = Maps.newHashMap();                                                 </span>
<span class="1869446492779313508" onmouseenter="enter('1869446492779313508');" onmouseout="out('1869446492779313508');" style=""> 431                  Row row = Row.copy(record.f1);                                                                    </span>
<span  style=""> 432                                                                                                                    </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 433                  for (int i = 0; i &lt; row.getArity(); i++) {                                                        </span>
<span class="5876572039273015428" onmouseenter="enter('5876572039273015428');" onmouseout="out('5876572039273015428');" style=""> 434                      valueMap.put(fieldNames.get(i), row.getField(i));                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435                  }                                                                                                 </span>
<span  style=""> 436                                                                                                                    </span>
<span class="-991390362203857814" onmouseenter="enter('-991390362203857814');" onmouseout="out('-991390362203857814');" style=""> 437                  Tuple2&lt;String, String&gt; rowTuple2 = new Tuple2&lt;&gt;();                                                </span>
<span class="-209542121488547867" onmouseenter="enter('-209542121488547867');" onmouseout="out('-209542121488547867');" style=""> 438                  if (storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition) {                                  </span>
<span class="-4830782679838689768" onmouseenter="enter('-4830782679838689768');" onmouseout="out('-4830782679838689768');" style=""> 439                      rowTuple2.f0 = NO_PARTITION;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 440                  } else {                                                                                          </span>
<span class="5139395380358692168" onmouseenter="enter('5139395380358692168');" onmouseout="out('5139395380358692168');" style=""> 441                      rowTuple2.f0 = buildPartitionCondition(valueMap, partitionFields, staticPartitionFields);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442                  }                                                                                                 </span>
<span  style=""> 443                                                                                                                    </span>
<span class="-484968884065413564" onmouseenter="enter('-484968884065413564');" onmouseout="out('-484968884065413564');" style=""> 444                  // 根据字段名对 row data 重组, 比如，原始 row data : (1, xxx, 20) -&gt; (id, name, age)                           </span>
<span class="2038150889857603205" onmouseenter="enter('2038150889857603205');" onmouseout="out('2038150889857603205');" style=""> 445                  // 但是由于 partition，写入的field 顺序变成了 (name, id, age)，则需要对 row data 重组变成 (xxx, 1, 20)                  </span>
<span class="5421203580895226953" onmouseenter="enter('5421203580895226953');" onmouseout="out('5421203580895226953');" style=""> 446                  Row rowValue = new Row(fieldTypes.size());                                                        </span>
<span class="-7699243670258396145" onmouseenter="enter('-7699243670258396145');" onmouseout="out('-7699243670258396145');" style=""> 447                  for (int i = 0; i &lt; fieldTypes.size(); i++) {                                                     </span>
<span class="2312799749991659832" onmouseenter="enter('2312799749991659832');" onmouseout="out('2312799749991659832');" style=""> 448                      rowValue.setField(i, valueMap.get(valueFieldNames.get(i)));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449                  }                                                                                                 </span>
<span class="8595450652771675183" onmouseenter="enter('8595450652771675183');" onmouseout="out('8595450652771675183');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -                rowTuple2.f1 = valueConditionAddQuotation(buildValuesCondition(fieldTypes, rowValue));            </span>
<span class="2914199757449377543" onmouseenter="enter('2914199757449377543');" onmouseout="out('2914199757449377543');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 451 +                rowTuple2.f1 = buildValuesCondition(fieldTypes, rowValue);                                        </span>
<span class="8896132355788887171" onmouseenter="enter('8896132355788887171');" onmouseout="out('8896132355788887171');" style=""> 452                  putRowIntoMap(rowDataMap, rowTuple2);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453              }                                                                                                     </span>
<span  style=""> 454                                                                                                                    </span>
<span class="-1784546571648451896" onmouseenter="enter('-1784546571648451896');" onmouseout="out('-1784546571648451896');" style=""> 455              batchCount++;                                                                                         </span>
<span  style=""> 456                                                                                                                    </span>
<span class="2059038061408804342" onmouseenter="enter('2059038061408804342');" onmouseout="out('2059038061408804342');" style=""> 457              if (batchCount &gt;= batchSize) {                                                                        </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style=""> 458                  flush();                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459              }                                                                                                     </span>
<span  style=""> 460                                                                                                                    </span>
<span class="-2147939016446724954" onmouseenter="enter('-2147939016446724954');" onmouseout="out('-2147939016446724954');" style=""> 461              // Receive data                                                                                       </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 462              outRecords.inc();                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 463          } catch (Exception e) {                                                                                   </span>
<span class="-6314596404725474749" onmouseenter="enter('-6314596404725474749');" onmouseout="out('-6314596404725474749');" style=""> 464              throw new IOException(&quot;Writing records to impala failed.&quot;, e);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466      }                                                                                                             </span>
<span  style=""> 467                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 468      @Override                                                                                                     </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 469      public void close() throws IOException {                                                                      </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 470          if (closed) {                                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 471              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472          }                                                                                                         </span>
<span class="-8247099019020917877" onmouseenter="enter('-8247099019020917877');" onmouseout="out('-8247099019020917877');" style=""> 473          // 将还未执行的SQL flush                                                                                        </span>
<span class="5034389177641676100" onmouseenter="enter('5034389177641676100');" onmouseout="out('5034389177641676100');" style=""> 474          if (batchCount &gt; 0) {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 475 -            try {                                                                                                 </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 476 -                flush();                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 477 -            } catch (Exception e) {                                                                               </span>
<span class="1679153721811128255" onmouseenter="enter('1679153721811128255');" onmouseout="out('1679153721811128255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 478 -                throw new RuntimeException(&quot;Writing records to impala failed.&quot;, e);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -            }                                                                                                     </span>
<span class="-3801963607042405446" onmouseenter="enter('-3801963607042405446');" onmouseout="out('-3801963607042405446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 480 +            flush();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481          }                                                                                                         </span>
<span class="4306800238416480323" onmouseenter="enter('4306800238416480323');" onmouseout="out('4306800238416480323');" style=""> 482          // cancel scheduled task                                                                                  </span>
<span class="-1257031862697527304" onmouseenter="enter('-1257031862697527304');" onmouseout="out('-1257031862697527304');" style=""> 483          if (this.scheduledFuture != null) {                                                                       </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 484              scheduledFuture.cancel(false);                                                                        </span>
<span class="-3367227577965762682" onmouseenter="enter('-3367227577965762682');" onmouseout="out('-3367227577965762682');" style=""> 485              this.scheduler.shutdown();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486          }                                                                                                         </span>
<span class="-6918026600162299955" onmouseenter="enter('-6918026600162299955');" onmouseout="out('-6918026600162299955');" style=""> 487          // close connection                                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 488          try {                                                                                                     </span>
<span class="7850482504012729998" onmouseenter="enter('7850482504012729998');" onmouseout="out('7850482504012729998');" style=""> 489              if (connection != null &amp;&amp; connection.isValid(DEFAULT_CONN_TIME_OUT)) {                                </span>
<span class="9071602856049240163" onmouseenter="enter('9071602856049240163');" onmouseout="out('9071602856049240163');" style=""> 490                  connection.close();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491              }                                                                                                     </span>
<span  style=""> 492                                                                                                                    </span>
<span class="5036557091369948437" onmouseenter="enter('5036557091369948437');" onmouseout="out('5036557091369948437');" style=""> 493              if (statement != null &amp;&amp; !statement.isClosed()) {                                                     </span>
<span class="-4290000005499431342" onmouseenter="enter('-4290000005499431342');" onmouseout="out('-4290000005499431342');" style=""> 494                  statement.close();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495              }                                                                                                     </span>
<span  style=""> 496                                                                                                                    </span>
<span class="-3745862640690712208" onmouseenter="enter('-3745862640690712208');" onmouseout="out('-3745862640690712208');" style=""> 497              if (updateStatement != null &amp;&amp; !updateStatement.isClosed()) {                                         </span>
<span class="6285223499122042502" onmouseenter="enter('6285223499122042502');" onmouseout="out('6285223499122042502');" style=""> 498                  updateStatement.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499              }                                                                                                     </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 500          } catch (SQLException e) {                                                                                </span>
<span class="-8800633426745397107" onmouseenter="enter('-8800633426745397107');" onmouseout="out('-8800633426745397107');" style=""> 501              throw new RuntimeException(&quot;impala connection close failed!&quot;, e);                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 502          } finally {                                                                                               </span>
<span class="8335594207613379924" onmouseenter="enter('8335594207613379924');" onmouseout="out('8335594207613379924');" style=""> 503              connection = null;                                                                                    </span>
<span class="-8855760725718402841" onmouseenter="enter('-8855760725718402841');" onmouseout="out('-8855760725718402841');" style=""> 504              statement = null;                                                                                     </span>
<span class="-7841270215011717932" onmouseenter="enter('-7841270215011717932');" onmouseout="out('-7841270215011717932');" style=""> 505              updateStatement = null;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506          }                                                                                                         </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 507          closed = true;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508      }                                                                                                             </span>
<span  style=""> 509                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 510      /**                                                                                                           </span>
<span class="1296337810927918625" onmouseenter="enter('1296337810927918625');" onmouseout="out('1296337810927918625');" style=""> 511       * execute batch sql from row data map                                                                        </span>
<span class="-5974232274386764846" onmouseenter="enter('-5974232274386764846');" onmouseout="out('-5974232274386764846');" style=""> 512       * sql like &#x27;insert into tableName(f1, f2, f3) ${partitionCondition} values(v1, v2, v3), (v4, v5, v6)....     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 513       *                                                                                                            </span>
<span class="3064025681804756869" onmouseenter="enter('3064025681804756869');" onmouseout="out('3064025681804756869');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 514 -     * @param statement       execute statement                                                                   </span>
<span class="4252025712922498493" onmouseenter="enter('4252025712922498493');" onmouseout="out('4252025712922498493');" style=""> 515       * @param tempSql         template sql                                                                        </span>
<span class="-888616451537648959" onmouseenter="enter('-888616451537648959');" onmouseout="out('-888616451537648959');" style=""> 516       * @param storeType       the store type of data                                                              </span>
<span class="-5301096736775778703" onmouseenter="enter('-5301096736775778703');" onmouseout="out('-5301096736775778703');" style=""> 517       * @param enablePartition enable partition or not                                                             </span>
<span class="-7243431631208061298" onmouseenter="enter('-7243431631208061298');" onmouseout="out('-7243431631208061298');" style=""> 518       * @param fieldNames      field name list                                                                     </span>
<span class="991482749163976330" onmouseenter="enter('991482749163976330');" onmouseout="out('991482749163976330');" style=""> 519       * @param partitionFields partition fields                                                                    </span>
<span class="5552251290683891506" onmouseenter="enter('5552251290683891506');" onmouseout="out('5552251290683891506');" style=""> 520       * @param rowDataMap      row data map                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 521       */                                                                                                           </span>
<span class="4208908199550530657" onmouseenter="enter('4208908199550530657');" onmouseout="out('4208908199550530657');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 522 -    private void executeBatchSql(Statement statement,                                                             </span>
<span class="2680326069917862152" onmouseenter="enter('2680326069917862152');" onmouseout="out('2680326069917862152');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 523 -                                 String tempSql,                                                                  </span>
<span class="-999744234218262965" onmouseenter="enter('-999744234218262965');" onmouseout="out('-999744234218262965');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 524 +    private void executeBatchSql(String tempSql,                                                                  </span>
<span class="-1880214364205558871" onmouseenter="enter('-1880214364205558871');" onmouseout="out('-1880214364205558871');" style=""> 525                                   String schema,                                                                   </span>
<span class="6859219661302664351" onmouseenter="enter('6859219661302664351');" onmouseout="out('6859219661302664351');" style=""> 526                                   String tableName,                                                                </span>
<span class="3305030788069730493" onmouseenter="enter('3305030788069730493');" onmouseout="out('3305030788069730493');" style=""> 527                                   String storeType,                                                                </span>
<span class="3282308130032253418" onmouseenter="enter('3282308130032253418');" onmouseout="out('3282308130032253418');" style=""> 528                                   Boolean enablePartition,                                                         </span>
<span class="-3269341593111050509" onmouseenter="enter('-3269341593111050509');" onmouseout="out('-3269341593111050509');" style=""> 529                                   List&lt;String&gt; fieldNames,                                                         </span>
<span class="-152366337684528954" onmouseenter="enter('-152366337684528954');" onmouseout="out('-152366337684528954');" style=""> 530                                   String partitionFields,                                                          </span>
<span class="5702355489208114022" onmouseenter="enter('5702355489208114022');" onmouseout="out('5702355489208114022');" style=""> 531                                   Map&lt;String, ArrayList&lt;String&gt;&gt; rowDataMap) {                                     </span>
<span class="-8058960308042609674" onmouseenter="enter('-8058960308042609674');" onmouseout="out('-8058960308042609674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 532 -        StringBuilder valuesCondition = new StringBuilder();                                                      </span>
<span class="-1699639020719600437" onmouseenter="enter('-1699639020719600437');" onmouseout="out('-1699639020719600437');" style=""> 533          StringBuilder partitionCondition = new StringBuilder();                                                   </span>
<span class="4484344279813579809" onmouseenter="enter('4484344279813579809');" onmouseout="out('4484344279813579809');" style=""> 534          String tableFieldsCondition = buildTableFieldsCondition(fieldNames, partitionFields);                     </span>
<span class="-2056467323596282224" onmouseenter="enter('-2056467323596282224');" onmouseout="out('-2056467323596282224');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 535 -        ArrayList&lt;String&gt; rowData;                                                                                </span>
<span class="6980371482153070193" onmouseenter="enter('6980371482153070193');" onmouseout="out('6980371482153070193');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 536 +        ArrayList&lt;String&gt; rowData = new ArrayList&lt;&gt;();                                                            </span>
<span class="3545700907988930339" onmouseenter="enter('3545700907988930339');" onmouseout="out('3545700907988930339');" style=""> 537          String tableNameInfo = Objects.isNull(schema) ?                                                           </span>
<span class="1480493120427294696" onmouseenter="enter('1480493120427294696');" onmouseout="out('1480493120427294696');" style=""> 538                  tableName : quoteIdentifier(schema) + &quot;.&quot; + tableName;                                            </span>
<span class="-7586945217349428495" onmouseenter="enter('-7586945217349428495');" onmouseout="out('-7586945217349428495');" style=""> 539          tempSql = tempSql.replace(&quot;tableName&quot;, tableNameInfo);                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 540 -                                                                                                                  </span>
<span class="-739313269293547881" onmouseenter="enter('-739313269293547881');" onmouseout="out('-739313269293547881');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 541 -        // kudu ${partitionCondition} is null                                                                     </span>
<span class="-209542121488547867" onmouseenter="enter('-209542121488547867');" onmouseout="out('-209542121488547867');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 542 -        if (storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition) {                                          </span>
<span class="-3470966760283073144" onmouseenter="enter('-3470966760283073144');" onmouseout="out('-3470966760283073144');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 543 +        boolean isPartitioned = storeType.equalsIgnoreCase(KUDU_TYPE) || !enablePartition;                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 544 +                                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 545 +        try {                                                                                                     </span>
<span class="-739313269293547881" onmouseenter="enter('-739313269293547881');" onmouseout="out('-739313269293547881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 546 +            // kudu ${partitionCondition} is null                                                                 </span>
<span class="-196943023254075124" onmouseenter="enter('-196943023254075124');" onmouseout="out('-196943023254075124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 547 +            if (isPartitioned) {                                                                                  </span>
<span class="-8595336617081209901" onmouseenter="enter('-8595336617081209901');" onmouseout="out('-8595336617081209901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 548 +                tempSql = tempSql                                                                                 </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 549 +                    .replace(PARTITION_CONDITION, partitionCondition.toString())                                  </span>
<span class="1939264830691633930" onmouseenter="enter('1939264830691633930');" onmouseout="out('1939264830691633930');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 550 +                    .replace(PARTITION_CONSTANT, &quot;&quot;)                                                              </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 551 +                    .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                                       </span>
<span class="-3048945956628717740" onmouseenter="enter('-3048945956628717740');" onmouseout="out('-3048945956628717740');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 552 +                rowData.addAll(rowDataMap.get(NO_PARTITION));                                                     </span>
<span class="-5061257777486987691" onmouseenter="enter('-5061257777486987691');" onmouseout="out('-5061257777486987691');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 553 +                String executeSql = tempSql.replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));                </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 554 +                statement.execute(executeSql);                                                                    </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 555 +                rowData.clear();                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 556 +            } else {                                                                                              </span>
<span class="6613720697354939567" onmouseenter="enter('6613720697354939567');" onmouseout="out('6613720697354939567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 557 +                // partition sql                                                                                  </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 558 +                Set&lt;String&gt; keySet = rowDataMap.keySet();                                                         </span>
<span class="5286500476222551862" onmouseenter="enter('5286500476222551862');" onmouseout="out('5286500476222551862');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 559 +                for (String key : keySet) {                                                                       </span>
<span class="2862511654232329090" onmouseenter="enter('2862511654232329090');" onmouseout="out('2862511654232329090');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 560 +                    rowData.addAll(rowDataMap.get(key));                                                          </span>
<span class="3266960038838022824" onmouseenter="enter('3266960038838022824');" onmouseout="out('3266960038838022824');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 561 +                    partitionCondition.append(key);                                                               </span>
<span class="-8595336617081209901" onmouseenter="enter('-8595336617081209901');" onmouseout="out('-8595336617081209901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 562 +                    tempSql = tempSql                                                                             </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 563 +                        .replace(PARTITION_CONDITION, partitionCondition.toString())                              </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 564 +                        .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                                   </span>
<span class="8433888294385954668" onmouseenter="enter('8433888294385954668');" onmouseout="out('8433888294385954668');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 565 +                    String executeSql = tempSql                                                                   </span>
<span class="-7707177917460131297" onmouseenter="enter('-7707177917460131297');" onmouseout="out('-7707177917460131297');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 566 +                        .replace(VALUES_CONDITION, String.join(&quot;, &quot;, rowData));                                   </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 567 +                    statement.execute(executeSql);                                                                </span>
<span class="-3000902343706299075" onmouseenter="enter('-3000902343706299075');" onmouseout="out('-3000902343706299075');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 568 +                    partitionCondition.delete(0, partitionCondition.length());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 569 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 570 +            }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 571 +        } catch (Exception e) {                                                                                   </span>
<span class="2735729731347220182" onmouseenter="enter('2735729731347220182');" onmouseout="out('2735729731347220182');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 572 +            if (e instanceof SQLException) {                                                                      </span>
<span class="-4009259436355561175" onmouseenter="enter('-4009259436355561175');" onmouseout="out('-4009259436355561175');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 573 +                dealBatchSqlError(rowData, connection, statement, tempSql);                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 574 +            } else {                                                                                              </span>
<span class="1776368734984517953" onmouseenter="enter('1776368734984517953');" onmouseout="out('1776368734984517953');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 575 +                throw new RuntimeException(&quot;Insert into impala error!&quot;, e);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 576 +            }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 577 +        } finally {                                                                                               </span>
<span class="-7109895118393620880" onmouseenter="enter('-7109895118393620880');" onmouseout="out('-7109895118393620880');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 578 +            rowData.clear();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 579 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 580 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 581 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 582 +    /**                                                                                                           </span>
<span class="5187728543542090149" onmouseenter="enter('5187728543542090149');" onmouseout="out('5187728543542090149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 583 +     * 当批量写入失败时，把批量的sql拆解为单条sql提交，对于单条写入的sql记做脏数据                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 584 +     *                                                                                                            </span>
<span class="-4511533979925052485" onmouseenter="enter('-4511533979925052485');" onmouseout="out('-4511533979925052485');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 585 +     * @param rowData 批量的values                                                                                   </span>
<span class="-2225365195706675086" onmouseenter="enter('-2225365195706675086');" onmouseout="out('-2225365195706675086');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 586 +     * @param connection 当前数据库connect                                                                             </span>
<span class="-1332857843479914544" onmouseenter="enter('-1332857843479914544');" onmouseout="out('-1332857843479914544');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 587 +     * @param statement 当前statement                                                                               </span>
<span class="-5986970410224412108" onmouseenter="enter('-5986970410224412108');" onmouseout="out('-5986970410224412108');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 588 +     * @param templateSql 模版sql，例如insert into tableName(f1, f2, f3) [partition] values $valueCondition            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 589 +     */                                                                                                           </span>
<span class="-2268452263184113170" onmouseenter="enter('-2268452263184113170');" onmouseout="out('-2268452263184113170');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 590 +    private void dealBatchSqlError(List&lt;String&gt; rowData,                                                          </span>
<span class="6863083743086916101" onmouseenter="enter('6863083743086916101');" onmouseout="out('6863083743086916101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 591 +                                   Connection connection,                                                         </span>
<span class="5184541356270987154" onmouseenter="enter('5184541356270987154');" onmouseout="out('5184541356270987154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 592 +                                   Statement statement,                                                           </span>
<span class="-3308663832752701650" onmouseenter="enter('-3308663832752701650');" onmouseout="out('-3308663832752701650');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 593 +                                   String templateSql) {                                                          </span>
<span class="-7725538089846589979" onmouseenter="enter('-7725538089846589979');" onmouseout="out('-7725538089846589979');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 594 +        String errorMsg = &quot;Insert into impala error. \nCause: [%s]\nRow: [%s]&quot;;                                   </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 595 +        JDBCUtils.rollBack(connection);                                                                           </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 596 +        JDBCUtils.commit(connection);                                                                             </span>
<span class="-7816936101366912926" onmouseenter="enter('-7816936101366912926');" onmouseout="out('-7816936101366912926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +        for (String rowDatum : rowData) {                                                                         </span>
<span class="-2842345043798651788" onmouseenter="enter('-2842345043798651788');" onmouseout="out('-2842345043798651788');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 598 +            String executeSql = templateSql.replace(VALUES_CONDITION, rowDatum);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 599              try {                                                                                                 </span>
<span class="-2154584329942843601" onmouseenter="enter('-2154584329942843601');" onmouseout="out('-2154584329942843601');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 600 -                rowData = rowDataMap.get(NO_PARTITION);                                                           </span>
<span class="8347805769565999916" onmouseenter="enter('8347805769565999916');" onmouseout="out('8347805769565999916');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 601 -                rowData.forEach(row -&gt; valuesCondition.append(row).append(&quot;, &quot;));                                 </span>
<span class="3083642816500849348" onmouseenter="enter('3083642816500849348');" onmouseout="out('3083642816500849348');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 602 -                String executeSql = tempSql.replace(VALUES_CONDITION, valuesCondition.toString())                 </span>
<span class="1750592158576848918" onmouseenter="enter('1750592158576848918');" onmouseout="out('1750592158576848918');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 603 -                        .replace(PARTITION_CONDITION, partitionCondition.toString())                              </span>
<span class="1939264830691633930" onmouseenter="enter('1939264830691633930');" onmouseout="out('1939264830691633930');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 604 -                        .replace(PARTITION_CONSTANT, &quot;&quot;)                                                          </span>
<span class="808490930961205524" onmouseenter="enter('808490930961205524');" onmouseout="out('808490930961205524');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 605 -                        .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition);                                   </span>
<span class="8541330001607166782" onmouseenter="enter('8541330001607166782');" onmouseout="out('8541330001607166782');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 606 -                String substring = executeSql.substring(0, executeSql.length() - 2);                              </span>
<span class="9213214884061660178" onmouseenter="enter('9213214884061660178');" onmouseout="out('9213214884061660178');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 607 -                statement.execute(substring);                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 608 -            } catch (Exception e) {                                                                               </span>
<span class="7699356527811265570" onmouseenter="enter('7699356527811265570');" onmouseout="out('7699356527811265570');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 609 -                throw new RuntimeException(&quot;execute impala SQL error!&quot;, e);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 610 -            }                                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 611 -            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 612 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 613 -                                                                                                                  </span>
<span class="6613720697354939567" onmouseenter="enter('6613720697354939567');" onmouseout="out('6613720697354939567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 614 -        // partition sql                                                                                          </span>
<span class="-4493594082030439612" onmouseenter="enter('-4493594082030439612');" onmouseout="out('-4493594082030439612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 615 -        Set&lt;String&gt; keySet = rowDataMap.keySet();                                                                 </span>
<span class="6439574290523368417" onmouseenter="enter('6439574290523368417');" onmouseout="out('6439574290523368417');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -        String finalTempSql = tempSql;                                                                            </span>
<span class="5286500476222551862" onmouseenter="enter('5286500476222551862');" onmouseout="out('5286500476222551862');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -        for (String key : keySet) {                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 618 -            try {                                                                                                 </span>
<span class="-8214047348876131469" onmouseenter="enter('-8214047348876131469');" onmouseout="out('-8214047348876131469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 619 -                String executeSql = String.copyValueOf(finalTempSql.toCharArray());                               </span>
<span class="225939304905434763" onmouseenter="enter('225939304905434763');" onmouseout="out('225939304905434763');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 620 -                ArrayList&lt;String&gt; valuesConditionList = rowDataMap.get(key);                                      </span>
<span class="3266960038838022824" onmouseenter="enter('3266960038838022824');" onmouseout="out('3266960038838022824');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 621 -                partitionCondition.append(key);                                                                   </span>
<span class="7273478521762013154" onmouseenter="enter('7273478521762013154');" onmouseout="out('7273478521762013154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 622 -                executeSql = executeSql.replace(PARTITION_CONDITION, partitionCondition.toString())               </span>
<span class="7623710745634070513" onmouseenter="enter('7623710745634070513');" onmouseout="out('7623710745634070513');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 623 -                        .replace(TABLE_FIELDS_CONDITION, tableFieldsCondition)                                    </span>
<span class="6339876343455538281" onmouseenter="enter('6339876343455538281');" onmouseout="out('6339876343455538281');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 624 -                        .replace(VALUES_CONDITION, String.join(&quot;, &quot;, valuesConditionList));                       </span>
<span class="7589788358669612006" onmouseenter="enter('7589788358669612006');" onmouseout="out('7589788358669612006');" style=""> 625                  statement.execute(executeSql);                                                                    </span>
<span class="-3000902343706299075" onmouseenter="enter('-3000902343706299075');" onmouseout="out('-3000902343706299075');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 626 -                partitionCondition.delete(0, partitionCondition.length());                                        </span>
<span class="-2037802754415730828" onmouseenter="enter('-2037802754415730828');" onmouseout="out('-2037802754415730828');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 627 -            } catch (SQLException sqlException) {                                                                 </span>
<span class="-5222513116835107038" onmouseenter="enter('-5222513116835107038');" onmouseout="out('-5222513116835107038');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 628 -                throw new RuntimeException(&quot;execute impala SQL error! &quot;, sqlException);                           </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 629 +                JDBCUtils.commit(connection);                                                                     </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 630 +            } catch (SQLException e) {                                                                            </span>
<span class="-5533636330798695847" onmouseenter="enter('-5533636330798695847');" onmouseout="out('-5533636330798695847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 631 +                JDBCUtils.rollBack(connection);                                                                   </span>
<span class="-8487518131555255957" onmouseenter="enter('-8487518131555255957');" onmouseout="out('-8487518131555255957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 632 +                JDBCUtils.commit(connection);                                                                     </span>
<span class="-4808081927273297919" onmouseenter="enter('-4808081927273297919');" onmouseout="out('-4808081927273297919');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 633 +                if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {"> 633 +                if (metricOutputFormat.outDirtyRecords.getCount() % DIRTY_DATA_PRINT_FREQUENCY == 0 || LOG.isDebug🔵</abbr></span>
<span class="-6393238717567631745" onmouseenter="enter('-6393238717567631745');" onmouseout="out('-6393238717567631745');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 634 +                    LOG.error(                                                                                    </span>
<span class="-6108141239353831940" onmouseenter="enter('-6108141239353831940');" onmouseout="out('-6108141239353831940');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 635 +                        String.format(                                                                            </span>
<span class="-7558476617034981134" onmouseenter="enter('-7558476617034981134');" onmouseout="out('-7558476617034981134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 636 +                            errorMsg,                                                                             </span>
<span class="-8675169859989204616" onmouseenter="enter('-8675169859989204616');" onmouseout="out('-8675169859989204616');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 637 +                            ExceptionTrace.traceOriginalCause(e),                                                 </span>
<span class="-2790175153725866914" onmouseenter="enter('-2790175153725866914');" onmouseout="out('-2790175153725866914');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 638 +                            rowDatum)                                                                             </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 639 +                    );                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 640 +                }                                                                                                 </span>
<span class="-8596285303698617705" onmouseenter="enter('-8596285303698617705');" onmouseout="out('-8596285303698617705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 641 +                metricOutputFormat.outDirtyRecords.inc();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644      }                                                                                                             </span>
<span  style=""> 645                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 646      /**                                                                                                           </span>
<span class="-7756927092547658158" onmouseenter="enter('-7756927092547658158');" onmouseout="out('-7756927092547658158');" style=""> 647       * build partition condition with row data                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 648       *                                                                                                            </span>
<span class="3326420447531983720" onmouseenter="enter('3326420447531983720');" onmouseout="out('3326420447531983720');" style=""> 649       * @param rowData              row data                                                                       </span>
<span class="-4527404320823727170" onmouseenter="enter('-4527404320823727170');" onmouseout="out('-4527404320823727170');" style=""> 650       * @param partitionFields      partition fields                                                               </span>
<span class="-1776173940247734574" onmouseenter="enter('-1776173940247734574');" onmouseout="out('-1776173940247734574');" style=""> 651       * @param staticPartitionField static partition fields                                                        </span>
<span class="-1132708759906563110" onmouseenter="enter('-1132708759906563110');" onmouseout="out('-1132708759906563110');" style=""> 652       * @return condition like &#x27;(ptOne, ptTwo=v2)&#x27;                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 653       */                                                                                                           </span>
<span class="-3866187778893382496" onmouseenter="enter('-3866187778893382496');" onmouseout="out('-3866187778893382496');" style=""><abbr title=" 654      private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;String&gt; staticPartitionField) {"> 654      private String buildPartitionCondition(Map&lt;String, Object&gt; rowData, String partitionFields, List&lt;String&gt; stati🔵</abbr></span>
<span class="1267423885187171547" onmouseenter="enter('1267423885187171547');" onmouseout="out('1267423885187171547');" style=""> 655          for (String key : staticPartitionField) {                                                                 </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 656              StringBuilder sb = new StringBuilder();                                                               </span>
<span class="-5505398468694975344" onmouseenter="enter('-5505398468694975344');" onmouseout="out('-5505398468694975344');" style=""> 657              Object value = rowData.get(key);                                                                      </span>
<span class="-3546349567435071552" onmouseenter="enter('-3546349567435071552');" onmouseout="out('-3546349567435071552');" style=""> 658              sb.append(key).append(&quot;=&quot;).append(value);                                                             </span>
<span class="7571464430142538701" onmouseenter="enter('7571464430142538701');" onmouseout="out('7571464430142538701');" style=""> 659              partitionFields = partitionFields.replace(&quot;${&quot; + key + &quot;}&quot;, sb.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660          }                                                                                                         </span>
<span class="-6125585623196674116" onmouseenter="enter('-6125585623196674116');" onmouseout="out('-6125585623196674116');" style=""> 661          return &quot;(&quot; + partitionFields + &quot;)&quot;;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662      }                                                                                                             </span>
<span  style=""> 663                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 664      /**                                                                                                           </span>
<span class="1604816269765986224" onmouseenter="enter('1604816269765986224');" onmouseout="out('1604816269765986224');" style=""> 665       * build field condition according to field names                                                             </span>
<span class="-8005762898157210848" onmouseenter="enter('-8005762898157210848');" onmouseout="out('-8005762898157210848');" style=""> 666       * replace ${tableFieldCondition}                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 667       *                                                                                                            </span>
<span class="-3045974832751459167" onmouseenter="enter('-3045974832751459167');" onmouseout="out('-3045974832751459167');" style=""> 668       * @param fieldNames      the selected field names                                                            </span>
<span class="-2115580236801058408" onmouseenter="enter('-2115580236801058408');" onmouseout="out('-2115580236801058408');" style=""> 669       * @param partitionFields the partition fields                                                                </span>
<span class="-2587093228749928778" onmouseenter="enter('-2587093228749928778');" onmouseout="out('-2587093228749928778');" style=""> 670       * @return condition like &#x27;(id, name, age)&#x27;                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 671       */                                                                                                           </span>
<span class="-1478951256156574678" onmouseenter="enter('-1478951256156574678');" onmouseout="out('-1478951256156574678');" style=""> 672      private String buildTableFieldsCondition(List&lt;String&gt; fieldNames, String partitionFields) {                   </span>
<span class="-8730756422155226372" onmouseenter="enter('-8730756422155226372');" onmouseout="out('-8730756422155226372');" style=""> 673          return &quot;(&quot; + fieldNames.stream()                                                                          </span>
<span class="-1124201215121024792" onmouseenter="enter('-1124201215121024792');" onmouseout="out('-1124201215121024792');" style=""> 674                  .filter(f -&gt; !partitionFields.contains(f))                                                        </span>
<span class="4761076759122573536" onmouseenter="enter('4761076759122573536');" onmouseout="out('4761076759122573536');" style=""> 675                  .map(this::quoteIdentifier)                                                                       </span>
<span class="-1385468130735042246" onmouseenter="enter('-1385468130735042246');" onmouseout="out('-1385468130735042246');" style=""> 676                  .collect(Collectors.joining(&quot;, &quot;)) + &quot;)&quot;;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677      }                                                                                                             </span>
<span  style=""> 678                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 679      /**                                                                                                           </span>
<span class="-1930125657620201419" onmouseenter="enter('-1930125657620201419');" onmouseout="out('-1930125657620201419');" style=""> 680       * according to field types, build the values condition                                                       </span>
<span class="-5328431915012470826" onmouseenter="enter('-5328431915012470826');" onmouseout="out('-5328431915012470826');" style=""> 681       * replace ${valuesCondition}                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 682       *                                                                                                            </span>
<span class="889997534505017973" onmouseenter="enter('889997534505017973');" onmouseout="out('889997534505017973');" style=""> 683       * @param fieldTypes field types                                                                              </span>
<span class="-5792744344160442542" onmouseenter="enter('-5792744344160442542');" onmouseout="out('-5792744344160442542');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 684 -     * @return condition like &#x27;(?, ?, cast(? as string))&#x27; and &#x27;?&#x27; will be replaced with row data                  </span>
<span class="-5325426707615499755" onmouseenter="enter('-5325426707615499755');" onmouseout="out('-5325426707615499755');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 685 +     * @return condition like &#x27;(?, ?, cast(&#x27;?&#x27; as string))&#x27; and &#x27;?&#x27; will be replaced with row data                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 686       */                                                                                                           </span>
<span class="-8753268388884688793" onmouseenter="enter('-8753268388884688793');" onmouseout="out('-8753268388884688793');" style=""> 687      private String buildValuesCondition(List&lt;String&gt; fieldTypes, Row row) {                                       </span>
<span class="9451785702271217" onmouseenter="enter('9451785702271217');" onmouseout="out('9451785702271217');" style=""> 688          String valuesCondition = fieldTypes.stream().map(                                                         </span>
<span class="-744834501831992668" onmouseenter="enter('-744834501831992668');" onmouseout="out('-744834501831992668');" style=""> 689                  f -&gt; {                                                                                            </span>
<span class="9071647551805886291" onmouseenter="enter('9071647551805886291');" onmouseout="out('9071647551805886291');" style=""> 690                      for (String item : NEED_QUOTE_TYPE) {                                                         </span>
<span class="9108011392601680881" onmouseenter="enter('9108011392601680881');" onmouseout="out('9108011392601680881');" style=""> 691                          if (f.toLowerCase().contains(item)) {                                                     </span>
<span class="-8315565477038260180" onmouseenter="enter('-8315565477038260180');" onmouseout="out('-8315565477038260180');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 692 -                            return String.format(&quot;cast(? as %s)&quot;, f.toLowerCase());                               </span>
<span class="2591906565241238134" onmouseenter="enter('2591906565241238134');" onmouseout="out('2591906565241238134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 693 +                            return String.format(&quot;cast(&#x27;?&#x27; as %s)&quot;, f.toLowerCase());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 694                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695                      }                                                                                             </span>
<span class="6027958975032523467" onmouseenter="enter('6027958975032523467');" onmouseout="out('6027958975032523467');" style=""> 696                      return &quot;?&quot;;                                                                                   </span>
<span class="4654177507103038656" onmouseenter="enter('4654177507103038656');" onmouseout="out('4654177507103038656');" style=""> 697                  }).collect(Collectors.joining(&quot;, &quot;));                                                             </span>
<span class="302244605993259711" onmouseenter="enter('302244605993259711');" onmouseout="out('302244605993259711');" style=""> 698          for (int i = 0; i &lt; row.getArity(); i++) {                                                                </span>
<span class="2602556020493426404" onmouseenter="enter('2602556020493426404');" onmouseout="out('2602556020493426404');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 699 -            valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, Objects.isNull(row.getField(i)) ? &quot;null&quot; : row.getField(i).toString());"> 699 -            valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, Objects.isNull(row.getField(i)) ? &quot;null&quot; : row.g🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 700 -        }                                                                                                         </span>
<span class="6366685022999215739" onmouseenter="enter('6366685022999215739');" onmouseout="out('6366685022999215739');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 701 -        return valuesCondition;                                                                                   </span>
<span class="6605498463591237491" onmouseenter="enter('6605498463591237491');" onmouseout="out('6605498463591237491');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 702 +            Object rowField = row.getField(i);                                                                    </span>
<span class="4211930808349437126" onmouseenter="enter('4211930808349437126');" onmouseout="out('4211930808349437126');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 703 +            if (DtStringUtil.isEmptyOrNull(rowField)) {                                                           </span>
<span class="2887641838186684159" onmouseenter="enter('2887641838186684159');" onmouseout="out('2887641838186684159');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 704 +                valuesCondition = valuesCondition.replaceFirst(&quot;&#x27;\\?&#x27;&quot;, &quot;null&quot;);                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 705 +            } else {                                                                                              </span>
<span class="6578353206956648527" onmouseenter="enter('6578353206956648527');" onmouseout="out('6578353206956648527');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 706 +                valuesCondition = valuesCondition.replaceFirst(&quot;\\?&quot;, rowField.toString());                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 707 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 708 +        }                                                                                                         </span>
<span class="7254264812767145915" onmouseenter="enter('7254264812767145915');" onmouseout="out('7254264812767145915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 709 +        return &quot;(&quot; + valuesCondition + &quot;)&quot;;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710      }                                                                                                             </span>
<span  style=""> 711                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 712      /**                                                                                                           </span>
<span class="2218542669560141576" onmouseenter="enter('2218542669560141576');" onmouseout="out('2218542669560141576');" style=""> 713       * impala update mode SQL                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 714       *                                                                                                            </span>
<span class="-8218292189476554358" onmouseenter="enter('-8218292189476554358');" onmouseout="out('-8218292189476554358');" style=""> 715       * @return UPDATE tableName SET setCondition WHERE whereCondition                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 716       */                                                                                                           </span>
<span class="-3752451701752547882" onmouseenter="enter('-3752451701752547882');" onmouseout="out('-3752451701752547882');" style=""><abbr title=" 717      private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; primaryKeys) {"> 717      private String buildUpdateSql(String schema, String tableName, List&lt;String&gt; fieldNames, List&lt;String&gt; primaryKe🔵</abbr></span>
<span class="5528853464056789996" onmouseenter="enter('5528853464056789996');" onmouseout="out('5528853464056789996');" style=""> 718          //跳过primary key字段                                                                                         </span>
<span class="-8857590287628770183" onmouseenter="enter('-8857590287628770183');" onmouseout="out('-8857590287628770183');" style=""> 719          String setClause = fieldNames.stream()                                                                    </span>
<span class="-803297460241064625" onmouseenter="enter('-803297460241064625');" onmouseout="out('-803297460241064625');" style=""> 720                  .filter(f -&gt; !CollectionUtils.isNotEmpty(primaryKeys) || !primaryKeys.contains(f))                </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 721                  .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                              </span>
<span class="-209499088310020597" onmouseenter="enter('-209499088310020597');" onmouseout="out('-209499088310020597');" style=""> 722                  .collect(Collectors.joining(&quot;, &quot;));                                                               </span>
<span  style=""> 723                                                                                                                    </span>
<span class="-3669556570443861667" onmouseenter="enter('-3669556570443861667');" onmouseout="out('-3669556570443861667');" style=""> 724          String conditionClause = primaryKeys.stream()                                                             </span>
<span class="4546972743148585186" onmouseenter="enter('4546972743148585186');" onmouseout="out('4546972743148585186');" style=""> 725                  .map(f -&gt; quoteIdentifier(f) + &quot;=?&quot;)                                                              </span>
<span class="1187060376059521362" onmouseenter="enter('1187060376059521362');" onmouseout="out('1187060376059521362');" style=""> 726                  .collect(Collectors.joining(&quot; AND &quot;));                                                            </span>
<span  style=""> 727                                                                                                                    </span>
<span class="-880277003185331688" onmouseenter="enter('-880277003185331688');" onmouseout="out('-880277003185331688');" style=""> 728          return &quot;UPDATE &quot; + (Objects.isNull(schema) ? &quot;&quot; : quoteIdentifier(schema) + &quot;.&quot;)                          </span>
<span class="-2776062363149844820" onmouseenter="enter('-2776062363149844820');" onmouseout="out('-2776062363149844820');" style=""> 729                  + quoteIdentifier(tableName) + &quot; SET &quot; + setClause + &quot; WHERE &quot; + conditionClause;                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 730      }                                                                                                             </span>
<span  style=""> 731                                                                                                                    </span>
<span class="4659511982989745103" onmouseenter="enter('4659511982989745103');" onmouseout="out('4659511982989745103');" style=""> 732      private String quoteIdentifier(String identifier) {                                                           </span>
<span class="1935684454964464658" onmouseenter="enter('1935684454964464658');" onmouseout="out('1935684454964464658');" style=""> 733          return &quot;`&quot; + identifier + &quot;`&quot;;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734      }                                                                                                             </span>
<span  style=""> 735                                                                                                                    </span>
<span class="-2481914402933088399" onmouseenter="enter('-2481914402933088399');" onmouseout="out('-2481914402933088399');" style=""> 736      public static Builder getImpalaBuilder() {                                                                    </span>
<span class="-1926211775479526780" onmouseenter="enter('-1926211775479526780');" onmouseout="out('-1926211775479526780');" style=""> 737          return new Builder();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738      }                                                                                                             </span>
<span  style=""> 739                                                                                                                    </span>
<span class="2010609695383714647" onmouseenter="enter('2010609695383714647');" onmouseout="out('2010609695383714647');" style=""> 740      public static class Builder {                                                                                 </span>
<span class="5030308014750517924" onmouseenter="enter('5030308014750517924');" onmouseout="out('5030308014750517924');" style=""> 741          private final ImpalaOutputFormat format = new ImpalaOutputFormat();                                       </span>
<span  style=""> 742                                                                                                                    </span>
<span class="4847669250945231235" onmouseenter="enter('4847669250945231235');" onmouseout="out('4847669250945231235');" style=""> 743          public Builder setDbUrl(String dbUrl) {                                                                   </span>
<span class="-7007213682983262515" onmouseenter="enter('-7007213682983262515');" onmouseout="out('-7007213682983262515');" style=""> 744              format.dbUrl = dbUrl;                                                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 745              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746          }                                                                                                         </span>
<span  style=""> 747                                                                                                                    </span>
<span class="-2062625403058053727" onmouseenter="enter('-2062625403058053727');" onmouseout="out('-2062625403058053727');" style=""> 748          public Builder setUserName(String userName) {                                                             </span>
<span class="8996094991043959374" onmouseenter="enter('8996094991043959374');" onmouseout="out('8996094991043959374');" style=""> 749              format.userName = userName;                                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 750              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751          }                                                                                                         </span>
<span  style=""> 752                                                                                                                    </span>
<span class="-8917696572465338538" onmouseenter="enter('-8917696572465338538');" onmouseout="out('-8917696572465338538');" style=""> 753          public Builder setPassword(String password) {                                                             </span>
<span class="-5617852808102302847" onmouseenter="enter('-5617852808102302847');" onmouseout="out('-5617852808102302847');" style=""> 754              format.password = password;                                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 755              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 756          }                                                                                                         </span>
<span  style=""> 757                                                                                                                    </span>
<span class="-6851628607924303336" onmouseenter="enter('-6851628607924303336');" onmouseout="out('-6851628607924303336');" style=""> 758          public Builder setBatchSize(Integer batchSize) {                                                          </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 759              format.batchSize = batchSize;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 760              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761          }                                                                                                         </span>
<span  style=""> 762                                                                                                                    </span>
<span class="5791410845050671235" onmouseenter="enter('5791410845050671235');" onmouseout="out('5791410845050671235');" style=""> 763          public Builder setBatchWaitInterval(Long batchWaitInterval) {                                             </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 764              format.batchWaitInterval = batchWaitInterval;                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 765              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766          }                                                                                                         </span>
<span  style=""> 767                                                                                                                    </span>
<span class="-8777589626278372083" onmouseenter="enter('-8777589626278372083');" onmouseout="out('-8777589626278372083');" style=""> 768          public Builder setTableName(String tableName) {                                                           </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 769              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 770              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771          }                                                                                                         </span>
<span  style=""> 772                                                                                                                    </span>
<span class="221724127870954269" onmouseenter="enter('221724127870954269');" onmouseout="out('221724127870954269');" style=""> 773          public Builder setPartitionFields(String partitionFields) {                                               </span>
<span class="-8055214001591864073" onmouseenter="enter('-8055214001591864073');" onmouseout="out('-8055214001591864073');" style=""> 774              format.partitionFields = Objects.isNull(partitionFields) ?                                            </span>
<span class="6173943982789028324" onmouseenter="enter('6173943982789028324');" onmouseout="out('6173943982789028324');" style=""> 775                      &quot;&quot; : partitionFields;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 776              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777          }                                                                                                         </span>
<span  style=""> 778                                                                                                                    </span>
<span class="-6994787811007556212" onmouseenter="enter('-6994787811007556212');" onmouseout="out('-6994787811007556212');" style=""> 779          public Builder setPrimaryKeys(List&lt;String&gt; primaryKeys) {                                                 </span>
<span class="1909693990286542032" onmouseenter="enter('1909693990286542032');" onmouseout="out('1909693990286542032');" style=""> 780              format.primaryKeys = primaryKeys;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 781              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782          }                                                                                                         </span>
<span  style=""> 783                                                                                                                    </span>
<span class="7512351963685249159" onmouseenter="enter('7512351963685249159');" onmouseout="out('7512351963685249159');" style=""> 784          public Builder setSchema(String schema) {                                                                 </span>
<span class="306599522236782764" onmouseenter="enter('306599522236782764');" onmouseout="out('306599522236782764');" style=""> 785              format.schema = schema;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 786              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 787          }                                                                                                         </span>
<span  style=""> 788                                                                                                                    </span>
<span class="4541611662116992338" onmouseenter="enter('4541611662116992338');" onmouseout="out('4541611662116992338');" style=""> 789          public Builder setEnablePartition(Boolean enablePartition) {                                              </span>
<span class="-6976631596761488792" onmouseenter="enter('-6976631596761488792');" onmouseout="out('-6976631596761488792');" style=""> 790              format.enablePartition = enablePartition;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 791              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792          }                                                                                                         </span>
<span  style=""> 793                                                                                                                    </span>
<span class="-8865383825618932145" onmouseenter="enter('-8865383825618932145');" onmouseout="out('-8865383825618932145');" style=""> 794          public Builder setUpdateMode(String updateMode) {                                                         </span>
<span class="-2281017119849044621" onmouseenter="enter('-2281017119849044621');" onmouseout="out('-2281017119849044621');" style=""> 795              format.updateMode = updateMode;                                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 796              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797          }                                                                                                         </span>
<span  style=""> 798                                                                                                                    </span>
<span class="8081013001489210313" onmouseenter="enter('8081013001489210313');" onmouseout="out('8081013001489210313');" style=""> 799          public Builder setFieldList(List&lt;String&gt; fieldList) {                                                     </span>
<span class="-818074055946993480" onmouseenter="enter('-818074055946993480');" onmouseout="out('-818074055946993480');" style=""> 800              format.fieldNames = fieldList;                                                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 801              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802          }                                                                                                         </span>
<span  style=""> 803                                                                                                                    </span>
<span class="3974737416393184735" onmouseenter="enter('3974737416393184735');" onmouseout="out('3974737416393184735');" style=""> 804          public Builder setFieldTypeList(List&lt;String&gt; fieldTypeList) {                                             </span>
<span class="1448747188656744713" onmouseenter="enter('1448747188656744713');" onmouseout="out('1448747188656744713');" style=""> 805              format.fieldTypes = fieldTypeList;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 806              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807          }                                                                                                         </span>
<span  style=""> 808                                                                                                                    </span>
<span class="2244927175574628655" onmouseenter="enter('2244927175574628655');" onmouseout="out('2244927175574628655');" style=""> 809          public Builder setStoreType(String storeType) {                                                           </span>
<span class="-5818885152026709969" onmouseenter="enter('-5818885152026709969');" onmouseout="out('-5818885152026709969');" style=""> 810              format.storeType = storeType;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 811              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812          }                                                                                                         </span>
<span  style=""> 813                                                                                                                    </span>
<span class="-5487489987508961941" onmouseenter="enter('-5487489987508961941');" onmouseout="out('-5487489987508961941');" style=""> 814          public Builder setFieldExtraInfoList(List&lt;AbstractTableInfo.FieldExtraInfo&gt; fieldExtraInfoList) {         </span>
<span class="160167467316759360" onmouseenter="enter('160167467316759360');" onmouseout="out('160167467316759360');" style=""> 815              format.fieldExtraInfoList = fieldExtraInfoList;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 816              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817          }                                                                                                         </span>
<span  style=""> 818                                                                                                                    </span>
<span class="1366044936846496088" onmouseenter="enter('1366044936846496088');" onmouseout="out('1366044936846496088');" style=""> 819          public Builder setKeyTabPath(String keyTabPath) {                                                         </span>
<span class="8755357456701014681" onmouseenter="enter('8755357456701014681');" onmouseout="out('8755357456701014681');" style=""> 820              format.keytabPath = keyTabPath;                                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 821              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822          }                                                                                                         </span>
<span  style=""> 823                                                                                                                    </span>
<span class="1807007964631867819" onmouseenter="enter('1807007964631867819');" onmouseout="out('1807007964631867819');" style=""> 824          public Builder setKrb5ConfPath(String krb5ConfPath) {                                                     </span>
<span class="352337563234497723" onmouseenter="enter('352337563234497723');" onmouseout="out('352337563234497723');" style=""> 825              format.krb5confPath = krb5ConfPath;                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 826              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827          }                                                                                                         </span>
<span  style=""> 828                                                                                                                    </span>
<span class="-8540538228750165144" onmouseenter="enter('-8540538228750165144');" onmouseout="out('-8540538228750165144');" style=""> 829          public Builder setPrincipal(String principal) {                                                           </span>
<span class="6894839552978791309" onmouseenter="enter('6894839552978791309');" onmouseout="out('6894839552978791309');" style=""> 830              format.principal = principal;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 831              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832          }                                                                                                         </span>
<span  style=""> 833                                                                                                                    </span>
<span class="-8991908924314829739" onmouseenter="enter('-8991908924314829739');" onmouseout="out('-8991908924314829739');" style=""> 834          public Builder setAuthMech(Integer authMech) {                                                            </span>
<span class="-1412915325814520049" onmouseenter="enter('-1412915325814520049');" onmouseout="out('-1412915325814520049');" style=""> 835              format.authMech = authMech;                                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 836              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837          }                                                                                                         </span>
<span  style=""> 838                                                                                                                    </span>
<span class="1564959121680510141" onmouseenter="enter('1564959121680510141');" onmouseout="out('1564959121680510141');" style=""> 839          private boolean canHandle(String url) {                                                                   </span>
<span class="842511305287615009" onmouseenter="enter('842511305287615009');" onmouseout="out('842511305287615009');" style=""> 840              return url.startsWith(&quot;jdbc:impala:&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 841          }                                                                                                         </span>
<span  style=""> 842                                                                                                                    </span>
<span class="-8521575333201954447" onmouseenter="enter('-8521575333201954447');" onmouseout="out('-8521575333201954447');" style=""> 843          public ImpalaOutputFormat build() {                                                                       </span>
<span class="1659683170431033048" onmouseenter="enter('1659683170431033048');" onmouseout="out('1659683170431033048');" style=""> 844              if (!canHandle(format.dbUrl)) {                                                                       </span>
<span class="-4870909491096243891" onmouseenter="enter('-4870909491096243891');" onmouseout="out('-4870909491096243891');" style=""> 845                  throw new IllegalArgumentException(&quot;impala dbUrl is illegal, check url: &quot; + format.dbUrl);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846              }                                                                                                     </span>
<span  style=""> 847                                                                                                                    </span>
<span class="-4505121258189477360" onmouseenter="enter('-4505121258189477360');" onmouseout="out('-4505121258189477360');" style=""> 848              if (format.authMech == EAuthMech.Kerberos.getType()) {                                                </span>
<span class="-6183848778016991336" onmouseenter="enter('-6183848778016991336');" onmouseout="out('-6183848778016991336');" style=""> 849                  checkNotNull(format.krb5confPath,                                                                 </span>
<span class="-4038272028328025626" onmouseenter="enter('-4038272028328025626');" onmouseout="out('-4038272028328025626');" style=""> 850                          &quot;When kerberos authentication is enabled, krb5confPath is required！&quot;);                    </span>
<span class="-1753032521002756428" onmouseenter="enter('-1753032521002756428');" onmouseout="out('-1753032521002756428');" style=""> 851                  checkNotNull(format.principal,                                                                    </span>
<span class="-5219129049333790569" onmouseenter="enter('-5219129049333790569');" onmouseout="out('-5219129049333790569');" style=""> 852                          &quot;When kerberos authentication is enabled, principal is required！&quot;);                       </span>
<span class="-3070330065691611476" onmouseenter="enter('-3070330065691611476');" onmouseout="out('-3070330065691611476');" style=""> 853                  checkNotNull(format.keytabPath,                                                                   </span>
<span class="-393994981289522477" onmouseenter="enter('-393994981289522477');" onmouseout="out('-393994981289522477');" style=""> 854                          &quot;When kerberos authentication is enabled, keytabPath is required！&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855              }                                                                                                     </span>
<span  style=""> 856                                                                                                                    </span>
<span class="-5111581416826137591" onmouseenter="enter('-5111581416826137591');" onmouseout="out('-5111581416826137591');" style=""> 857              if (format.authMech == EAuthMech.UserName.getType()) {                                                </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 858                  checkNotNull(format.userName, &quot;userName is required!&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859              }                                                                                                     </span>
<span  style=""> 860                                                                                                                    </span>
<span class="-3238564706659558925" onmouseenter="enter('-3238564706659558925');" onmouseout="out('-3238564706659558925');" style=""> 861              if (format.authMech == EAuthMech.NameANDPassword.getType()) {                                         </span>
<span class="-5189195878644032060" onmouseenter="enter('-5189195878644032060');" onmouseout="out('-5189195878644032060');" style=""> 862                  checkNotNull(format.userName, &quot;userName is required!&quot;);                                           </span>
<span class="-9040493906648204146" onmouseenter="enter('-9040493906648204146');" onmouseout="out('-9040493906648204146');" style=""> 863                  checkNotNull(format.password, &quot;password is required!&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864              }                                                                                                     </span>
<span  style=""> 865                                                                                                                    </span>
<span class="1310568763423505425" onmouseenter="enter('1310568763423505425');" onmouseout="out('1310568763423505425');" style=""> 866              checkNotNull(format.storeType, &quot;storeType is required!&quot;);                                             </span>
<span  style=""> 867                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 868              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 870      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            