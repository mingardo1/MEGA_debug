<!DOCTYPE html>
<html lang="en">
          <head>
            <meta charset="utf-8">
            <title>318 chunks</title>
                <style>
                    #top {
                        height: 48vh;
                        overflow-y: auto;
                    }
                    #bottom {
                        height: 48vh;
                        overflow-y: auto;
                    }
                </style>
          </head>
          <body>
            <pre>[[{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote.models;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.text.DateFormat;\n&#x27;
                           &#x27;import java.text.SimpleDateFormat;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;import java.util.HashMap;\n&#x27;
                           &#x27;import java.util.Locale;\n&#x27;
                           &#x27;import java.util.Map;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.util.Log;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.R;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.Query.ComparisonType;\n&#x27;
                           &#x27;import com.simperium.client.Query.SortType;\n&#x27;
                           &#x27;import com.simperium.client.BucketObject;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Index;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Indexer;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;public class Note extends BucketObject {\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tpublic static final String BUCKET_NAME=&quot;note&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PINNED_TAG=&quot;pinned&quot;;\n&#x27;
                           &#x27;    public static final String NEW_LINE=&quot;\\n&quot;;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    private static final String &#x27;
                           &#x27;CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;\n&#x27;
                           &#x27;    private static final String BLANK_CONTENT=&quot;&quot;;\n&#x27;
                           &#x27;    private static final String SPACE = &quot; &quot;;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CONTENT_PROPERTY=&quot;content&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;TAGS_PROPERTY=&quot;tags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CREATION_DATE_PROPERTY=&quot;creationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SHARE_URL_PROPERTY=&quot;shareURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;DELETED_PROPERTY=&quot;deleted&quot;;\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tprotected String title = null;\n&#x27;
                           &#x27;\tprotected String contentPreview = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static class Schema extends &#x27;
                           &#x27;BucketSchema&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public Schema(){\n&#x27;
                           &#x27;            autoIndex();\n&#x27;
                           &#x27;            addIndex(noteIndexer);\n&#x27;
                           &#x27;            setDefault(CONTENT_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(SYSTEM_TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(DELETED_PROPERTY, false);\n&#x27;
                           &#x27;            setDefault(SHARE_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private Indexer noteIndexer = new &#x27;
                           &#x27;Indexer&lt;Note&gt;(){\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public List&lt;Index&gt; index(Note note){\n&#x27;
                           &#x27;                List&lt;Index&gt; indexes = new &#x27;
                           &#x27;ArrayList&lt;Index&gt;();\n&#x27;
                           &#x27;                if (note.isPinned()) {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, true));\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, false));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                indexes.add(new &#x27;
                           &#x27;Index(&quot;contentPreview&quot;, &#x27;
                           &#x27;note.getContentPreview()));\n&#x27;
                           &#x27;                indexes.add(new Index(&quot;title&quot;, &#x27;
                           &#x27;note.getTitle()));\n&#x27;
                           &#x27;                return indexes;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        };\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public String getRemoteName(){\n&#x27;
                           &#x27;            return Note.BUCKET_NAME;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tpublic Note build(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;\t\t\tNote note = new Note(key, properties);\n&#x27;
                           &#x27;\t\t\treturn note;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void update(Note note, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;            note.properties = properties;\n&#x27;
                           &#x27;            note.title = null;\n&#x27;
                           &#x27;            note.contentPreview = null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allDeleted(Bucket&lt;Note&gt; noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket, String searchString){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;content&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allInTag(Bucket&lt;Note&gt; noteBucket, String tag){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;tags&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, tag);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public Note(String key){\n&#x27;
                           &#x27;        super(key, new HashMap&lt;String,Object&gt;());\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Note(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties) {\n&#x27;
                           &#x27;\t\tsuper(key, properties);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void updateTitleAndPreview(){\n&#x27;
                           &#x27;        // try to bulid a title and preview &#x27;
                           &#x27;property out of content\n&#x27;
                           &#x27;        String content = getContent();\n&#x27;
                           &#x27;        // title = &quot;Hello World&quot;;\n&#x27;
                           &#x27;        // contentPreview = &quot;This is a preview&quot;;\n&#x27;
                           &#x27;        int location = -1;\n&#x27;
                           &#x27;        int lines = 0;\n&#x27;
                           &#x27;        int content_lines = 0;\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        boolean foundTitle = false;\n&#x27;
                           &#x27;        boolean foundContent = false;\n&#x27;
                           &quot;        // loop until we&#x27;ve found all the new &quot;
                           &#x27;lines\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                if (!foundTitle) {\n&#x27;
                           &#x27;                    foundTitle = true;\n&#x27;
                           &#x27;                    title = possible;\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; &#x27;
                           &#x27;!foundTitle);\n&#x27;
                           &#x27;        lines = 0;\n&#x27;
                           &#x27;        contentPreview = &quot;&quot;;\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                contentPreview = &#x27;
                           &#x27;String.format(CONTENT_CONCAT_FORMAT, &#x27;
                           &#x27;contentPreview, possible);\n&#x27;
                           &#x27;                if (contentPreview.length() &gt;= &#x27;
                           &#x27;300) {\n&#x27;
                           &#x27;                    foundContent = true;\n&#x27;
                           &#x27;                    contentPreview = &#x27;
                           &#x27;contentPreview.substring(0, 300);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; !foundContent);\n&#x27;
                           &#x27;        if (!foundTitle) {\n&#x27;
                           &#x27;            title = content;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (contentPreview.isEmpty()) {\n&#x27;
                           &#x27;            contentPreview = content;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            contentPreview = &#x27;
                           &#x27;contentPreview.trim();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tpublic String getTitle() {\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn title;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    public String getTitle(String ifBlank){\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (title.trim().equals(&quot;&quot;)) {\n&#x27;
                           &#x27;            return ifBlank;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return title;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContent() {\n&#x27;
                           &#x27;        Object content = &#x27;
                           &#x27;getProperty(CONTENT_PROPERTY);\n&#x27;
                           &#x27;        if (content == null) {\n&#x27;
                           &#x27;            return BLANK_CONTENT;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (String) content;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setContent(String content) {\n&#x27;
                           &#x27;        title = null;\n&#x27;
                           &#x27;        contentPreview = null;\n&#x27;
                           &#x27;        setProperty(CONTENT_PROPERTY, content);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tpublic String getContentPreview() {\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn contentPreview;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getContentPreview(int lines){\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return contentPreview;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getCreationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setCreationDate(Calendar &#x27;
                           &#x27;creationDate) {\n&#x27;
                           &#x27;        setProperty(CREATION_DATE_PROPERTY, &#x27;
                           &#x27;creationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getModificationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setModificationDate(Calendar &#x27;
                           &#x27;modificationDate) {\n&#x27;
                           &#x27;        setProperty(MODIFICATION_DATE_PROPERTY, &#x27;
                           &#x27;modificationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean hasTag(Tag tag){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for (String tagKey : tags) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(tag.getSimperiumKey().equals(tagKey)) return &#x27;
                           &#x27;true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getTags() {\n&#x27;
                           &#x27;        Object tags = getProperty(TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            tags = new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;            setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (ArrayList&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setTags(List&lt;String&gt; tags) {\n&#x27;
                           &#x27;        setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * String of tags delimited by a space\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public CharSequence getTagString(){\n&#x27;
                           &#x27;        StringBuilder tagString = new &#x27;
                           &#x27;StringBuilder();\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for(String tag : tags){\n&#x27;
                           &#x27;            if (tagString.length() &gt; 0) {\n&#x27;
                           &#x27;                tagString.append(SPACE);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            tagString.append(tag);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return tagString;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &quot;     * Sets the note&#x27;s tags by providing it with a &quot;
                           &#x27;{@link String} of space\n&#x27;
                           &#x27;     * seperated tags. Filters out duplicate &#x27;
                           &#x27;tags.\n&#x27;
                           &#x27;     * \n&#x27;
                           &#x27;     * @param tagString a space delimited list of &#x27;
                           &#x27;tags\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setTagString(String tagString){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        tags.clear();\n&#x27;
                           &#x27;        if (tagString == null) return;\n&#x27;
                           &#x27;        // for comparing case-insensitive strings, &#x27;
                           &#x27;would like to find a way to\n&#x27;
                           &#x27;        // do this without allocating a new list &#x27;
                           &#x27;and strings\n&#x27;
                           &#x27;        List&lt;String&gt; tagsUpperCase = new &#x27;
                           &#x27;ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        // remove all current tags\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        int next = -1;\n&#x27;
                           &#x27;        String possible;\n&#x27;
                           &#x27;        String possibleUpperCase;\n&#x27;
                           &#x27;        // search tag string for space characters &#x27;
                           &#x27;and pull out individual tags\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            next = tagString.indexOf(SPACE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (next &gt; start) {\n&#x27;
                           &#x27;                possible = &#x27;
                           &#x27;tagString.substring(start, next);\n&#x27;
                           &#x27;                possibleUpperCase = &#x27;
                           &#x27;possible.toUpperCase();\n&#x27;
                           &#x27;                if (!possible.equals(SPACE) &amp;&amp; &#x27;
                           &#x27;!tagsUpperCase.contains(possibleUpperCase)) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;tagsUpperCase.add(possibleUpperCase);\n&#x27;
                           &#x27;                    tags.add(possible);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            start = next + 1;\n&#x27;
                           &#x27;        } while(next &gt; -1);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getSystemTags() {\n&#x27;
                           &#x27;        Object tags = &#x27;
                           &#x27;getProperty(SYSTEM_TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            return new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (List&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Boolean isDeleted() {\n&#x27;
                           &#x27;        Object deleted = &#x27;
                           &#x27;getProperty(DELETED_PROPERTY);\n&#x27;
                           &#x27;        if (deleted == null) {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\tif (deleted instanceof Boolean) {\n&#x27;
                           &#x27;\t\t\treturn (Boolean) deleted;\n&#x27;
                           &#x27;\t\t} else if (deleted instanceof Number) {\n&#x27;
                           &#x27;\t\t\treturn ((Number)deleted).intValue() == 0 ? &#x27;
                           &#x27;false : true;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setDeleted(boolean deleted) {\n&#x27;
                           &#x27;\t\tsetProperty(DELETED_PROPERTY, deleted);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic boolean isPinned() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;getSystemTags().contains(PINNED_TAG);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setPinned(boolean isPinned) {\n&#x27;
                           &#x27;        if (isPinned &amp;&amp; !isPinned()) {\n&#x27;
                           &#x27;            getSystemTags().add(PINNED_TAG);\n&#x27;
                           &#x27;        } else if (!isPinned &amp;&amp; isPinned()){\n&#x27;
                           &#x27;            getSystemTags().remove(PINNED_TAG);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String dateString(Number time, &#x27;
                           &#x27;boolean useShortFormat, Context context){\n&#x27;
                           &#x27;        Calendar c = numberToDate(time);\n&#x27;
                           &#x27;        return dateString(c, useShortFormat, &#x27;
                           &#x27;context);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static String dateString(Calendar c, &#x27;
                           &#x27;boolean useShortFormat, Context context) {\n&#x27;
                           &#x27;\t\tint year, month, day;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tString time, date, retVal;\n&#x27;
                           &#x27;\t\ttime = date = &quot;&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tCalendar diff = Calendar.getInstance();\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(diff.getTimeInMillis() - &#x27;
                           &#x27;c.getTimeInMillis());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tyear = diff.get(Calendar.YEAR);\n&#x27;
                           &#x27;\t\tmonth = diff.get(Calendar.MONTH);\n&#x27;
                           &#x27;\t\tday = diff.get(Calendar.DAY_OF_MONTH);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(0); // starting time\n&#x27;
                           &#x27;\t\ttime = &#x27;
                           &#x27;DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());\n&#x27;
                           &#x27;\t\tif ((year == diff.get(Calendar.YEAR)) &amp;&amp; &#x27;
                           &#x27;(month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;diff.get(Calendar.DAY_OF_MONTH))) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.today);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = time;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else if ((year == diff.get(Calendar.YEAR)) &#x27;
                           &#x27;&amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;1)) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.yesterday);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = date;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else {\n&#x27;
                           &#x27;\t\t\tdate = new SimpleDateFormat(&quot;MMM dd&quot;, &#x27;
                           &#x27;Locale.US).format(c.getTime());\n&#x27;
                           &#x27;\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\treturn retVal;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Object getProperty(String key){\n&#x27;
                           &#x27;        return properties.get(key);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void setProperty(String key, Object &#x27;
                           &#x27;value){\n&#x27;
                           &#x27;        properties.put(key, value);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Calendar numberToDate(Number &#x27;
                           &#x27;time){\n&#x27;
                           &#x27;        Calendar date = Calendar.getInstance();\n&#x27;
                           &#x27;        if (time != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;date.setTimeInMillis(time.longValue()*1000);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return date;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Check if the note has any changes\n&#x27;
                           &#x27;     * @param content the new note content\n&#x27;
                           &#x27;     * @param tags array of tags\n&#x27;
                           &#x27;     * @param isPinned note is pinned\n&#x27;
                           &#x27;     * @return true if note has changes, false if &#x27;
                           &#x27;it is unchanged.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public boolean hasChanges(String content, &#x27;
                           &#x27;boolean isPinned) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (content.equals(this.getContent()) &amp;&amp; &#x27;
                           &#x27;this.isPinned() == isPinned)\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        else\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote.models;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.text.DateFormat;\n&#x27;
                           &#x27;import java.text.SimpleDateFormat;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;import java.util.HashMap;\n&#x27;
                           &#x27;import java.util.Locale;\n&#x27;
                           &#x27;import java.util.Map;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.util.Log;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.R;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.Query.ComparisonType;\n&#x27;
                           &#x27;import com.simperium.client.Query.SortType;\n&#x27;
                           &#x27;import com.simperium.client.BucketObject;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Index;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Indexer;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;public class Note extends BucketObject {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static final String BUCKET_NAME=&quot;note&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PINNED_TAG=&quot;pinned&quot;;\n&#x27;
                           &#x27;    public static final String NEW_LINE=&quot;\\n&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final String &#x27;
                           &#x27;CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;\n&#x27;
                           &#x27;    private static final String BLANK_CONTENT=&quot;&quot;;\n&#x27;
                           &#x27;    private static final String SPACE = &quot; &quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CONTENT_PROPERTY=&quot;content&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;TAGS_PROPERTY=&quot;tags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CREATION_DATE_PROPERTY=&quot;creationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SHARE_URL_PROPERTY=&quot;shareURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;DELETED_PROPERTY=&quot;deleted&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tprotected String title = null;\n&#x27;
                           &#x27;\tprotected String contentPreview = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static class Schema extends &#x27;
                           &#x27;BucketSchema&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public Schema(){\n&#x27;
                           &#x27;            autoIndex();\n&#x27;
                           &#x27;            addIndex(noteIndexer);\n&#x27;
                           &#x27;            setDefault(CONTENT_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(SYSTEM_TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(DELETED_PROPERTY, false);\n&#x27;
                           &#x27;            setDefault(SHARE_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private Indexer noteIndexer = new &#x27;
                           &#x27;Indexer&lt;Note&gt;(){\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public List&lt;Index&gt; index(Note note){\n&#x27;
                           &#x27;                List&lt;Index&gt; indexes = new &#x27;
                           &#x27;ArrayList&lt;Index&gt;();\n&#x27;
                           &#x27;                if (note.isPinned()) {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, true));\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, false));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                indexes.add(new &#x27;
                           &#x27;Index(&quot;contentPreview&quot;, &#x27;
                           &#x27;note.getContentPreview()));\n&#x27;
                           &#x27;                indexes.add(new Index(&quot;title&quot;, &#x27;
                           &#x27;note.getTitle()));\n&#x27;
                           &#x27;                return indexes;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        };\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public String getRemoteName(){\n&#x27;
                           &#x27;            return Note.BUCKET_NAME;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tpublic Note build(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;\t\t\tNote note = new Note(key, properties);\n&#x27;
                           &#x27;\t\t\treturn note;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void update(Note note, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;            note.properties = properties;\n&#x27;
                           &#x27;            note.title = null;\n&#x27;
                           &#x27;            note.contentPreview = null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allDeleted(Bucket&lt;Note&gt; noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket, String searchString){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;content&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allInTag(Bucket&lt;Note&gt; noteBucket, String tag){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;tags&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, tag);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public Note(String key){\n&#x27;
                           &#x27;        super(key, new HashMap&lt;String,Object&gt;());\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Note(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties) {\n&#x27;
                           &#x27;\t\tsuper(key, properties);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void updateTitleAndPreview(){\n&#x27;
                           &#x27;        // try to bulid a title and preview &#x27;
                           &#x27;property out of content\n&#x27;
                           &#x27;        String content = getContent();\n&#x27;
                           &#x27;        // title = &quot;Hello World&quot;;\n&#x27;
                           &#x27;        // contentPreview = &quot;This is a preview&quot;;\n&#x27;
                           &#x27;        int location = -1;\n&#x27;
                           &#x27;        int lines = 0;\n&#x27;
                           &#x27;        int content_lines = 0;\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        boolean foundTitle = false;\n&#x27;
                           &#x27;        boolean foundContent = false;\n&#x27;
                           &quot;        // loop until we&#x27;ve found all the new &quot;
                           &#x27;lines\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                if (!foundTitle) {\n&#x27;
                           &#x27;                    foundTitle = true;\n&#x27;
                           &#x27;                    title = possible;\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; &#x27;
                           &#x27;!foundTitle);\n&#x27;
                           &#x27;        lines = 0;\n&#x27;
                           &#x27;        contentPreview = &quot;&quot;;\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                contentPreview = &#x27;
                           &#x27;String.format(CONTENT_CONCAT_FORMAT, &#x27;
                           &#x27;contentPreview, possible);\n&#x27;
                           &#x27;                if (contentPreview.length() &gt;= &#x27;
                           &#x27;300) {\n&#x27;
                           &#x27;                    foundContent = true;\n&#x27;
                           &#x27;                    contentPreview = &#x27;
                           &#x27;contentPreview.substring(0, 300);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; !foundContent);\n&#x27;
                           &#x27;        if (!foundTitle) {\n&#x27;
                           &#x27;            title = content;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (contentPreview.isEmpty()) {\n&#x27;
                           &#x27;            contentPreview = content;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            contentPreview = &#x27;
                           &#x27;contentPreview.trim();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getTitle() {\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn title;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getTitle(String ifBlank){\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (title.trim().equals(&quot;&quot;)) {\n&#x27;
                           &#x27;            return ifBlank;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return title;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContent() {\n&#x27;
                           &#x27;        Object content = &#x27;
                           &#x27;getProperty(CONTENT_PROPERTY);\n&#x27;
                           &#x27;        if (content == null) {\n&#x27;
                           &#x27;            return BLANK_CONTENT;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (String) content;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setContent(String content) {\n&#x27;
                           &#x27;        title = null;\n&#x27;
                           &#x27;        contentPreview = null;\n&#x27;
                           &#x27;        setProperty(CONTENT_PROPERTY, content);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContentPreview() {\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn contentPreview;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getContentPreview(int lines){\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return contentPreview;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getCreationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setCreationDate(Calendar &#x27;
                           &#x27;creationDate) {\n&#x27;
                           &#x27;        setProperty(CREATION_DATE_PROPERTY, &#x27;
                           &#x27;creationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getModificationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setModificationDate(Calendar &#x27;
                           &#x27;modificationDate) {\n&#x27;
                           &#x27;        setProperty(MODIFICATION_DATE_PROPERTY, &#x27;
                           &#x27;modificationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean hasTag(Tag tag){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for (String tagKey : tags) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(tag.getSimperiumKey().equals(tagKey)) return &#x27;
                           &#x27;true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getTags() {\n&#x27;
                           &#x27;        Object tags = getProperty(TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            tags = new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;            setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (ArrayList&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setTags(List&lt;String&gt; tags) {\n&#x27;
                           &#x27;        setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * String of tags delimited by a space\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public CharSequence getTagString(){\n&#x27;
                           &#x27;        StringBuilder tagString = new &#x27;
                           &#x27;StringBuilder();\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for(String tag : tags){\n&#x27;
                           &#x27;            if (tagString.length() &gt; 0) {\n&#x27;
                           &#x27;                tagString.append(SPACE);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            tagString.append(tag);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return tagString;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &quot;     * Sets the note&#x27;s tags by providing it with a &quot;
                           &#x27;{@link String} of space\n&#x27;
                           &#x27;     * seperated tags. Filters out duplicate &#x27;
                           &#x27;tags.\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param tagString a space delimited list of &#x27;
                           &#x27;tags\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setTagString(String tagString){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        tags.clear();\n&#x27;
                           &#x27;        if (tagString == null) return;\n&#x27;
                           &#x27;        // for comparing case-insensitive strings, &#x27;
                           &#x27;would like to find a way to\n&#x27;
                           &#x27;        // do this without allocating a new list &#x27;
                           &#x27;and strings\n&#x27;
                           &#x27;        List&lt;String&gt; tagsUpperCase = new &#x27;
                           &#x27;ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        // remove all current tags\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        int next = -1;\n&#x27;
                           &#x27;        String possible;\n&#x27;
                           &#x27;        String possibleUpperCase;\n&#x27;
                           &#x27;        // search tag string for space characters &#x27;
                           &#x27;and pull out individual tags\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            next = tagString.indexOf(SPACE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (next &gt; start) {\n&#x27;
                           &#x27;                possible = &#x27;
                           &#x27;tagString.substring(start, next);\n&#x27;
                           &#x27;                possibleUpperCase = &#x27;
                           &#x27;possible.toUpperCase();\n&#x27;
                           &#x27;                if (!possible.equals(SPACE) &amp;&amp; &#x27;
                           &#x27;!tagsUpperCase.contains(possibleUpperCase)) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;tagsUpperCase.add(possibleUpperCase);\n&#x27;
                           &#x27;                    tags.add(possible);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            start = next + 1;\n&#x27;
                           &#x27;        } while(next &gt; -1);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getSystemTags() {\n&#x27;
                           &#x27;        Object tags = &#x27;
                           &#x27;getProperty(SYSTEM_TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            return new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (List&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Boolean isDeleted() {\n&#x27;
                           &#x27;        Object deleted = &#x27;
                           &#x27;getProperty(DELETED_PROPERTY);\n&#x27;
                           &#x27;        if (deleted == null) {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\tif (deleted instanceof Boolean) {\n&#x27;
                           &#x27;\t\t\treturn (Boolean) deleted;\n&#x27;
                           &#x27;\t\t} else if (deleted instanceof Number) {\n&#x27;
                           &#x27;\t\t\treturn ((Number)deleted).intValue() == 0 ? &#x27;
                           &#x27;false : true;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setDeleted(boolean deleted) {\n&#x27;
                           &#x27;\t\tsetProperty(DELETED_PROPERTY, deleted);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic boolean isPinned() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;getSystemTags().contains(PINNED_TAG);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setPinned(boolean isPinned) {\n&#x27;
                           &#x27;        if (isPinned &amp;&amp; !isPinned()) {\n&#x27;
                           &#x27;            getSystemTags().add(PINNED_TAG);\n&#x27;
                           &#x27;        } else if (!isPinned &amp;&amp; isPinned()){\n&#x27;
                           &#x27;            getSystemTags().remove(PINNED_TAG);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String dateString(Number time, &#x27;
                           &#x27;boolean useShortFormat, Context context){\n&#x27;
                           &#x27;        Calendar c = numberToDate(time);\n&#x27;
                           &#x27;        return dateString(c, useShortFormat, &#x27;
                           &#x27;context);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static String dateString(Calendar c, &#x27;
                           &#x27;boolean useShortFormat, Context context) {\n&#x27;
                           &#x27;\t\tint year, month, day;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tString time, date, retVal;\n&#x27;
                           &#x27;\t\ttime = date = &quot;&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tCalendar diff = Calendar.getInstance();\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(diff.getTimeInMillis() - &#x27;
                           &#x27;c.getTimeInMillis());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tyear = diff.get(Calendar.YEAR);\n&#x27;
                           &#x27;\t\tmonth = diff.get(Calendar.MONTH);\n&#x27;
                           &#x27;\t\tday = diff.get(Calendar.DAY_OF_MONTH);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(0); // starting time\n&#x27;
                           &#x27;\t\ttime = &#x27;
                           &#x27;DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());\n&#x27;
                           &#x27;\t\tif ((year == diff.get(Calendar.YEAR)) &amp;&amp; &#x27;
                           &#x27;(month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;diff.get(Calendar.DAY_OF_MONTH))) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.today);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = time;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else if ((year == diff.get(Calendar.YEAR)) &#x27;
                           &#x27;&amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;1)) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.yesterday);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = date;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else {\n&#x27;
                           &#x27;\t\t\tdate = new SimpleDateFormat(&quot;MMM dd&quot;, &#x27;
                           &#x27;Locale.US).format(c.getTime());\n&#x27;
                           &#x27;\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\treturn retVal;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Object getProperty(String key){\n&#x27;
                           &#x27;        return properties.get(key);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void setProperty(String key, Object &#x27;
                           &#x27;value){\n&#x27;
                           &#x27;        properties.put(key, value);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Calendar numberToDate(Number &#x27;
                           &#x27;time){\n&#x27;
                           &#x27;        Calendar date = Calendar.getInstance();\n&#x27;
                           &#x27;        if (time != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;date.setTimeInMillis(time.longValue()*1000);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return date;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Check if the note has any changes\n&#x27;
                           &#x27;     * @param content the new note content\n&#x27;
                           &#x27;     * @param tags array of tags\n&#x27;
                           &#x27;     * @param isPinned note is pinned\n&#x27;
                           &#x27;     * @return true if note has changes, false if &#x27;
                           &#x27;it is unchanged.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public boolean hasChanges(String content, &#x27;
                           &#x27;boolean isPinned) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (content.equals(this.getContent()) &amp;&amp; &#x27;
                           &#x27;this.isPinned() == isPinned)\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        else\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;package com.automattic.simplenote.models;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.text.DateFormat;\n&#x27;
                           &#x27;import java.text.SimpleDateFormat;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;import java.util.HashMap;\n&#x27;
                           &#x27;import java.util.Locale;\n&#x27;
                           &#x27;import java.util.Map;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.util.Log;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.R;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.Query.ComparisonType;\n&#x27;
                           &#x27;import com.simperium.client.Query.SortType;\n&#x27;
                           &#x27;import com.simperium.client.BucketObject;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Index;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Indexer;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;public class Note extends BucketObject {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static final String BUCKET_NAME=&quot;note&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PINNED_TAG=&quot;pinned&quot;;\n&#x27;
                           &#x27;    public static final String NEW_LINE=&quot;\\n&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final String &#x27;
                           &#x27;CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;\n&#x27;
                           &#x27;    private static final String BLANK_CONTENT=&quot;&quot;;\n&#x27;
                           &#x27;    private static final String SPACE = &quot; &quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CONTENT_PROPERTY=&quot;content&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;TAGS_PROPERTY=&quot;tags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CREATION_DATE_PROPERTY=&quot;creationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SHARE_URL_PROPERTY=&quot;shareURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;DELETED_PROPERTY=&quot;deleted&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tprotected String title = null;\n&#x27;
                           &#x27;\tprotected String contentPreview = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static class Schema extends &#x27;
                           &#x27;BucketSchema&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public Schema(){\n&#x27;
                           &#x27;            autoIndex();\n&#x27;
                           &#x27;            addIndex(noteIndexer);\n&#x27;
                           &#x27;            setDefault(CONTENT_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(SYSTEM_TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(DELETED_PROPERTY, false);\n&#x27;
                           &#x27;            setDefault(SHARE_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private Indexer noteIndexer = new &#x27;
                           &#x27;Indexer&lt;Note&gt;(){\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public List&lt;Index&gt; index(Note note){\n&#x27;
                           &#x27;                List&lt;Index&gt; indexes = new &#x27;
                           &#x27;ArrayList&lt;Index&gt;();\n&#x27;
                           &#x27;                if (note.isPinned()) {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, true));\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, false));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                indexes.add(new &#x27;
                           &#x27;Index(&quot;contentPreview&quot;, &#x27;
                           &#x27;note.getContentPreview()));\n&#x27;
                           &#x27;                indexes.add(new Index(&quot;title&quot;, &#x27;
                           &#x27;note.getTitle()));\n&#x27;
                           &#x27;                return indexes;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        };\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public String getRemoteName(){\n&#x27;
                           &#x27;            return Note.BUCKET_NAME;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tpublic Note build(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;\t\t\tNote note = new Note(key, properties);\n&#x27;
                           &#x27;\t\t\treturn note;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void update(Note note, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;            note.properties = properties;\n&#x27;
                           &#x27;            note.title = null;\n&#x27;
                           &#x27;            note.contentPreview = null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allDeleted(Bucket&lt;Note&gt; noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket, String searchString){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;content&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allInTag(Bucket&lt;Note&gt; noteBucket, String tag){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;tags&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, tag);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public Note(String key){\n&#x27;
                           &#x27;        super(key, new HashMap&lt;String,Object&gt;());\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Note(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties) {\n&#x27;
                           &#x27;\t\tsuper(key, properties);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void updateTitleAndPreview(){\n&#x27;
                           &#x27;        // try to bulid a title and preview &#x27;
                           &#x27;property out of content\n&#x27;
                           &#x27;        String content = getContent();\n&#x27;
                           &#x27;        // title = &quot;Hello World&quot;;\n&#x27;
                           &#x27;        // contentPreview = &quot;This is a preview&quot;;\n&#x27;
                           &#x27;        int location = -1;\n&#x27;
                           &#x27;        int lines = 0;\n&#x27;
                           &#x27;        int content_lines = 0;\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        boolean foundTitle = false;\n&#x27;
                           &#x27;        boolean foundContent = false;\n&#x27;
                           &quot;        // loop until we&#x27;ve found all the new &quot;
                           &#x27;lines\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                if (!foundTitle) {\n&#x27;
                           &#x27;                    foundTitle = true;\n&#x27;
                           &#x27;                    title = possible;\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; &#x27;
                           &#x27;!foundTitle);\n&#x27;
                           &#x27;        lines = 0;\n&#x27;
                           &#x27;        contentPreview = &quot;&quot;;\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                contentPreview = &#x27;
                           &#x27;String.format(CONTENT_CONCAT_FORMAT, &#x27;
                           &#x27;contentPreview, possible);\n&#x27;
                           &#x27;                if (contentPreview.length() &gt;= &#x27;
                           &#x27;300) {\n&#x27;
                           &#x27;                    foundContent = true;\n&#x27;
                           &#x27;                    contentPreview = &#x27;
                           &#x27;contentPreview.substring(0, 300);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; !foundContent);\n&#x27;
                           &#x27;        if (!foundTitle) {\n&#x27;
                           &#x27;            title = content;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (contentPreview.isEmpty()) {\n&#x27;
                           &#x27;            contentPreview = content;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            contentPreview = &#x27;
                           &#x27;contentPreview.trim();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getTitle() {\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn title;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getTitle(String ifBlank){\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (title.trim().equals(&quot;&quot;)) {\n&#x27;
                           &#x27;            return ifBlank;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return title;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContent() {\n&#x27;
                           &#x27;        Object content = &#x27;
                           &#x27;getProperty(CONTENT_PROPERTY);\n&#x27;
                           &#x27;        if (content == null) {\n&#x27;
                           &#x27;            return BLANK_CONTENT;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (String) content;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setContent(String content) {\n&#x27;
                           &#x27;        title = null;\n&#x27;
                           &#x27;        contentPreview = null;\n&#x27;
                           &#x27;        setProperty(CONTENT_PROPERTY, content);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContentPreview() {\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn contentPreview;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getContentPreview(int lines){\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return contentPreview;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getCreationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setCreationDate(Calendar &#x27;
                           &#x27;creationDate) {\n&#x27;
                           &#x27;        setProperty(CREATION_DATE_PROPERTY, &#x27;
                           &#x27;creationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getModificationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setModificationDate(Calendar &#x27;
                           &#x27;modificationDate) {\n&#x27;
                           &#x27;        setProperty(MODIFICATION_DATE_PROPERTY, &#x27;
                           &#x27;modificationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean hasTag(Tag tag){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for (String tagKey : tags) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(tag.getSimperiumKey().equals(tagKey)) return &#x27;
                           &#x27;true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getTags() {\n&#x27;
                           &#x27;        Object tags = getProperty(TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            tags = new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;            setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (ArrayList&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setTags(List&lt;String&gt; tags) {\n&#x27;
                           &#x27;        setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * String of tags delimited by a space\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public CharSequence getTagString(){\n&#x27;
                           &#x27;        StringBuilder tagString = new &#x27;
                           &#x27;StringBuilder();\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for(String tag : tags){\n&#x27;
                           &#x27;            if (tagString.length() &gt; 0) {\n&#x27;
                           &#x27;                tagString.append(SPACE);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            tagString.append(tag);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return tagString;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &quot;     * Sets the note&#x27;s tags by providing it with a &quot;
                           &#x27;{@link String} of space\n&#x27;
                           &#x27;     * seperated tags. Filters out duplicate &#x27;
                           &#x27;tags.\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param tagString a space delimited list of &#x27;
                           &#x27;tags\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setTagString(String tagString){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        tags.clear();\n&#x27;
                           &#x27;        if (tagString == null) return;\n&#x27;
                           &#x27;        // for comparing case-insensitive strings, &#x27;
                           &#x27;would like to find a way to\n&#x27;
                           &#x27;        // do this without allocating a new list &#x27;
                           &#x27;and strings\n&#x27;
                           &#x27;        List&lt;String&gt; tagsUpperCase = new &#x27;
                           &#x27;ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        // remove all current tags\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        int next = -1;\n&#x27;
                           &#x27;        String possible;\n&#x27;
                           &#x27;        String possibleUpperCase;\n&#x27;
                           &#x27;        // search tag string for space characters &#x27;
                           &#x27;and pull out individual tags\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            next = tagString.indexOf(SPACE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (next &gt; start) {\n&#x27;
                           &#x27;                possible = &#x27;
                           &#x27;tagString.substring(start, next);\n&#x27;
                           &#x27;                possibleUpperCase = &#x27;
                           &#x27;possible.toUpperCase();\n&#x27;
                           &#x27;                if (!possible.equals(SPACE) &amp;&amp; &#x27;
                           &#x27;!tagsUpperCase.contains(possibleUpperCase)) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;tagsUpperCase.add(possibleUpperCase);\n&#x27;
                           &#x27;                    tags.add(possible);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            start = next + 1;\n&#x27;
                           &#x27;        } while(next &gt; -1);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getSystemTags() {\n&#x27;
                           &#x27;        Object tags = &#x27;
                           &#x27;getProperty(SYSTEM_TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            return new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (List&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Boolean isDeleted() {\n&#x27;
                           &#x27;        Object deleted = &#x27;
                           &#x27;getProperty(DELETED_PROPERTY);\n&#x27;
                           &#x27;        if (deleted == null) {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\tif (deleted instanceof Boolean) {\n&#x27;
                           &#x27;\t\t\treturn (Boolean) deleted;\n&#x27;
                           &#x27;\t\t} else if (deleted instanceof Number) {\n&#x27;
                           &#x27;\t\t\treturn ((Number)deleted).intValue() == 0 ? &#x27;
                           &#x27;false : true;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setDeleted(boolean deleted) {\n&#x27;
                           &#x27;\t\tsetProperty(DELETED_PROPERTY, deleted);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic boolean isPinned() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;getSystemTags().contains(PINNED_TAG);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setPinned(boolean isPinned) {\n&#x27;
                           &#x27;        if (isPinned &amp;&amp; !isPinned()) {\n&#x27;
                           &#x27;            getSystemTags().add(PINNED_TAG);\n&#x27;
                           &#x27;        } else if (!isPinned &amp;&amp; isPinned()){\n&#x27;
                           &#x27;            getSystemTags().remove(PINNED_TAG);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String dateString(Number time, &#x27;
                           &#x27;boolean useShortFormat, Context context){\n&#x27;
                           &#x27;        Calendar c = numberToDate(time);\n&#x27;
                           &#x27;        return dateString(c, useShortFormat, &#x27;
                           &#x27;context);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static String dateString(Calendar c, &#x27;
                           &#x27;boolean useShortFormat, Context context) {\n&#x27;
                           &#x27;\t\tint year, month, day;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tString time, date, retVal;\n&#x27;
                           &#x27;\t\ttime = date = &quot;&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tCalendar diff = Calendar.getInstance();\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(diff.getTimeInMillis() - &#x27;
                           &#x27;c.getTimeInMillis());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tyear = diff.get(Calendar.YEAR);\n&#x27;
                           &#x27;\t\tmonth = diff.get(Calendar.MONTH);\n&#x27;
                           &#x27;\t\tday = diff.get(Calendar.DAY_OF_MONTH);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(0); // starting time\n&#x27;
                           &#x27;\t\ttime = &#x27;
                           &#x27;DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());\n&#x27;
                           &#x27;\t\tif ((year == diff.get(Calendar.YEAR)) &amp;&amp; &#x27;
                           &#x27;(month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;diff.get(Calendar.DAY_OF_MONTH))) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.today);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = time;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else if ((year == diff.get(Calendar.YEAR)) &#x27;
                           &#x27;&amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;1)) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.yesterday);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = date;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else {\n&#x27;
                           &#x27;\t\t\tdate = new SimpleDateFormat(&quot;MMM dd&quot;, &#x27;
                           &#x27;Locale.US).format(c.getTime());\n&#x27;
                           &#x27;\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\treturn retVal;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Object getProperty(String key){\n&#x27;
                           &#x27;        return properties.get(key);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void setProperty(String key, Object &#x27;
                           &#x27;value){\n&#x27;
                           &#x27;        properties.put(key, value);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Calendar numberToDate(Number &#x27;
                           &#x27;time){\n&#x27;
                           &#x27;        Calendar date = Calendar.getInstance();\n&#x27;
                           &#x27;        if (time != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;date.setTimeInMillis(time.longValue()*1000);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return date;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Check if the note has any changes\n&#x27;
                           &#x27;     * @param content the new note content\n&#x27;
                           &#x27;     * @param tags array of tags\n&#x27;
                           &#x27;     * @param isPinned note is pinned\n&#x27;
                           &#x27;     * @return true if note has changes, false if &#x27;
                           &#x27;it is unchanged.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public boolean hasChanges(String content, &#x27;
                           &#x27;boolean isPinned) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (content.equals(this.getContent()) &amp;&amp; &#x27;
                           &#x27;this.isPinned() == isPinned)\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        else\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}],
 [{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote.models;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.text.DateFormat;\n&#x27;
                           &#x27;import java.text.SimpleDateFormat;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;import java.util.HashMap;\n&#x27;
                           &#x27;import java.util.Locale;\n&#x27;
                           &#x27;import java.util.Map;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.util.Log;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.R;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.Query.ComparisonType;\n&#x27;
                           &#x27;import com.simperium.client.Query.SortType;\n&#x27;
                           &#x27;import com.simperium.client.BucketObject;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Index;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Indexer;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;public class Note extends BucketObject {\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tpublic static final String BUCKET_NAME=&quot;note&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PINNED_TAG=&quot;pinned&quot;;\n&#x27;
                           &#x27;    public static final String NEW_LINE=&quot;\\n&quot;;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    private static final String &#x27;
                           &#x27;CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;\n&#x27;
                           &#x27;    private static final String BLANK_CONTENT=&quot;&quot;;\n&#x27;
                           &#x27;    private static final String SPACE = &quot; &quot;;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CONTENT_PROPERTY=&quot;content&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;TAGS_PROPERTY=&quot;tags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CREATION_DATE_PROPERTY=&quot;creationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SHARE_URL_PROPERTY=&quot;shareURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;DELETED_PROPERTY=&quot;deleted&quot;;\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tprotected String title = null;\n&#x27;
                           &#x27;\tprotected String contentPreview = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static class Schema extends &#x27;
                           &#x27;BucketSchema&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public Schema(){\n&#x27;
                           &#x27;            autoIndex();\n&#x27;
                           &#x27;            addIndex(noteIndexer);\n&#x27;
                           &#x27;            setDefault(CONTENT_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(SYSTEM_TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(DELETED_PROPERTY, false);\n&#x27;
                           &#x27;            setDefault(SHARE_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private Indexer noteIndexer = new &#x27;
                           &#x27;Indexer&lt;Note&gt;(){\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public List&lt;Index&gt; index(Note note){\n&#x27;
                           &#x27;                List&lt;Index&gt; indexes = new &#x27;
                           &#x27;ArrayList&lt;Index&gt;();\n&#x27;
                           &#x27;                if (note.isPinned()) {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, true));\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, false));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                indexes.add(new &#x27;
                           &#x27;Index(&quot;contentPreview&quot;, &#x27;
                           &#x27;note.getContentPreview()));\n&#x27;
                           &#x27;                indexes.add(new Index(&quot;title&quot;, &#x27;
                           &#x27;note.getTitle()));\n&#x27;
                           &#x27;                return indexes;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        };\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public String getRemoteName(){\n&#x27;
                           &#x27;            return Note.BUCKET_NAME;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tpublic Note build(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;\t\t\tNote note = new Note(key, properties);\n&#x27;
                           &#x27;\t\t\treturn note;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void update(Note note, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;            note.properties = properties;\n&#x27;
                           &#x27;            note.title = null;\n&#x27;
                           &#x27;            note.contentPreview = null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allDeleted(Bucket&lt;Note&gt; noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket, String searchString){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;content&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allInTag(Bucket&lt;Note&gt; noteBucket, String tag){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;tags&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, tag);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public Note(String key){\n&#x27;
                           &#x27;        super(key, new HashMap&lt;String,Object&gt;());\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Note(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties) {\n&#x27;
                           &#x27;\t\tsuper(key, properties);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void updateTitleAndPreview(){\n&#x27;
                           &#x27;        // try to bulid a title and preview &#x27;
                           &#x27;property out of content\n&#x27;
                           &#x27;        String content = getContent();\n&#x27;
                           &#x27;        // title = &quot;Hello World&quot;;\n&#x27;
                           &#x27;        // contentPreview = &quot;This is a preview&quot;;\n&#x27;
                           &#x27;        int location = -1;\n&#x27;
                           &#x27;        int lines = 0;\n&#x27;
                           &#x27;        int content_lines = 0;\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        boolean foundTitle = false;\n&#x27;
                           &#x27;        boolean foundContent = false;\n&#x27;
                           &quot;        // loop until we&#x27;ve found all the new &quot;
                           &#x27;lines\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                if (!foundTitle) {\n&#x27;
                           &#x27;                    foundTitle = true;\n&#x27;
                           &#x27;                    title = possible;\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; &#x27;
                           &#x27;!foundTitle);\n&#x27;
                           &#x27;        lines = 0;\n&#x27;
                           &#x27;        contentPreview = &quot;&quot;;\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                contentPreview = &#x27;
                           &#x27;String.format(CONTENT_CONCAT_FORMAT, &#x27;
                           &#x27;contentPreview, possible);\n&#x27;
                           &#x27;                if (contentPreview.length() &gt;= &#x27;
                           &#x27;300) {\n&#x27;
                           &#x27;                    foundContent = true;\n&#x27;
                           &#x27;                    contentPreview = &#x27;
                           &#x27;contentPreview.substring(0, 300);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; !foundContent);\n&#x27;
                           &#x27;        if (!foundTitle) {\n&#x27;
                           &#x27;            title = content;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (contentPreview.isEmpty()) {\n&#x27;
                           &#x27;            contentPreview = content;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            contentPreview = &#x27;
                           &#x27;contentPreview.trim();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tpublic String getTitle() {\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn title;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    public String getTitle(String ifBlank){\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (title.trim().equals(&quot;&quot;)) {\n&#x27;
                           &#x27;            return ifBlank;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return title;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContent() {\n&#x27;
                           &#x27;        Object content = &#x27;
                           &#x27;getProperty(CONTENT_PROPERTY);\n&#x27;
                           &#x27;        if (content == null) {\n&#x27;
                           &#x27;            return BLANK_CONTENT;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (String) content;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setContent(String content) {\n&#x27;
                           &#x27;        title = null;\n&#x27;
                           &#x27;        contentPreview = null;\n&#x27;
                           &#x27;        setProperty(CONTENT_PROPERTY, content);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\t\n&#x27;
                           &#x27;\tpublic String getContentPreview() {\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn contentPreview;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getContentPreview(int lines){\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return contentPreview;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getCreationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setCreationDate(Calendar &#x27;
                           &#x27;creationDate) {\n&#x27;
                           &#x27;        setProperty(CREATION_DATE_PROPERTY, &#x27;
                           &#x27;creationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getModificationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setModificationDate(Calendar &#x27;
                           &#x27;modificationDate) {\n&#x27;
                           &#x27;        setProperty(MODIFICATION_DATE_PROPERTY, &#x27;
                           &#x27;modificationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean hasTag(Tag tag){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for (String tagKey : tags) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(tag.getSimperiumKey().equals(tagKey)) return &#x27;
                           &#x27;true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getTags() {\n&#x27;
                           &#x27;        Object tags = getProperty(TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            tags = new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;            setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (ArrayList&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setTags(List&lt;String&gt; tags) {\n&#x27;
                           &#x27;        setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * String of tags delimited by a space\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public CharSequence getTagString(){\n&#x27;
                           &#x27;        StringBuilder tagString = new &#x27;
                           &#x27;StringBuilder();\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for(String tag : tags){\n&#x27;
                           &#x27;            if (tagString.length() &gt; 0) {\n&#x27;
                           &#x27;                tagString.append(SPACE);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            tagString.append(tag);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return tagString;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &quot;     * Sets the note&#x27;s tags by providing it with a &quot;
                           &#x27;{@link String} of space\n&#x27;
                           &#x27;     * seperated tags. Filters out duplicate &#x27;
                           &#x27;tags.\n&#x27;
                           &#x27;     * \n&#x27;
                           &#x27;     * @param tagString a space delimited list of &#x27;
                           &#x27;tags\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setTagString(String tagString){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        tags.clear();\n&#x27;
                           &#x27;        if (tagString == null) return;\n&#x27;
                           &#x27;        // for comparing case-insensitive strings, &#x27;
                           &#x27;would like to find a way to\n&#x27;
                           &#x27;        // do this without allocating a new list &#x27;
                           &#x27;and strings\n&#x27;
                           &#x27;        List&lt;String&gt; tagsUpperCase = new &#x27;
                           &#x27;ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        // remove all current tags\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        int next = -1;\n&#x27;
                           &#x27;        String possible;\n&#x27;
                           &#x27;        String possibleUpperCase;\n&#x27;
                           &#x27;        // search tag string for space characters &#x27;
                           &#x27;and pull out individual tags\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            next = tagString.indexOf(SPACE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (next &gt; start) {\n&#x27;
                           &#x27;                possible = &#x27;
                           &#x27;tagString.substring(start, next);\n&#x27;
                           &#x27;                possibleUpperCase = &#x27;
                           &#x27;possible.toUpperCase();\n&#x27;
                           &#x27;                if (!possible.equals(SPACE) &amp;&amp; &#x27;
                           &#x27;!tagsUpperCase.contains(possibleUpperCase)) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;tagsUpperCase.add(possibleUpperCase);\n&#x27;
                           &#x27;                    tags.add(possible);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            start = next + 1;\n&#x27;
                           &#x27;        } while(next &gt; -1);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getSystemTags() {\n&#x27;
                           &#x27;        Object tags = &#x27;
                           &#x27;getProperty(SYSTEM_TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            return new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (List&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Boolean isDeleted() {\n&#x27;
                           &#x27;        Object deleted = &#x27;
                           &#x27;getProperty(DELETED_PROPERTY);\n&#x27;
                           &#x27;        if (deleted == null) {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\tif (deleted instanceof Boolean) {\n&#x27;
                           &#x27;\t\t\treturn (Boolean) deleted;\n&#x27;
                           &#x27;\t\t} else if (deleted instanceof Number) {\n&#x27;
                           &#x27;\t\t\treturn ((Number)deleted).intValue() == 0 ? &#x27;
                           &#x27;false : true;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setDeleted(boolean deleted) {\n&#x27;
                           &#x27;\t\tsetProperty(DELETED_PROPERTY, deleted);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic boolean isPinned() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;getSystemTags().contains(PINNED_TAG);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setPinned(boolean isPinned) {\n&#x27;
                           &#x27;        if (isPinned &amp;&amp; !isPinned()) {\n&#x27;
                           &#x27;            getSystemTags().add(PINNED_TAG);\n&#x27;
                           &#x27;        } else if (!isPinned &amp;&amp; isPinned()){\n&#x27;
                           &#x27;            getSystemTags().remove(PINNED_TAG);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String dateString(Number time, &#x27;
                           &#x27;boolean useShortFormat, Context context){\n&#x27;
                           &#x27;        Calendar c = numberToDate(time);\n&#x27;
                           &#x27;        return dateString(c, useShortFormat, &#x27;
                           &#x27;context);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static String dateString(Calendar c, &#x27;
                           &#x27;boolean useShortFormat, Context context) {\n&#x27;
                           &#x27;\t\tint year, month, day;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tString time, date, retVal;\n&#x27;
                           &#x27;\t\ttime = date = &quot;&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tCalendar diff = Calendar.getInstance();\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(diff.getTimeInMillis() - &#x27;
                           &#x27;c.getTimeInMillis());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tyear = diff.get(Calendar.YEAR);\n&#x27;
                           &#x27;\t\tmonth = diff.get(Calendar.MONTH);\n&#x27;
                           &#x27;\t\tday = diff.get(Calendar.DAY_OF_MONTH);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(0); // starting time\n&#x27;
                           &#x27;\t\ttime = &#x27;
                           &#x27;DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());\n&#x27;
                           &#x27;\t\tif ((year == diff.get(Calendar.YEAR)) &amp;&amp; &#x27;
                           &#x27;(month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;diff.get(Calendar.DAY_OF_MONTH))) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.today);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = time;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else if ((year == diff.get(Calendar.YEAR)) &#x27;
                           &#x27;&amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;1)) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.yesterday);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = date;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else {\n&#x27;
                           &#x27;\t\t\tdate = new SimpleDateFormat(&quot;MMM dd&quot;, &#x27;
                           &#x27;Locale.US).format(c.getTime());\n&#x27;
                           &#x27;\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\treturn retVal;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Object getProperty(String key){\n&#x27;
                           &#x27;        return properties.get(key);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void setProperty(String key, Object &#x27;
                           &#x27;value){\n&#x27;
                           &#x27;        properties.put(key, value);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Calendar numberToDate(Number &#x27;
                           &#x27;time){\n&#x27;
                           &#x27;        Calendar date = Calendar.getInstance();\n&#x27;
                           &#x27;        if (time != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;date.setTimeInMillis(time.longValue()*1000);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return date;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Check if the note has any changes\n&#x27;
                           &#x27;     * @param content the new note content\n&#x27;
                           &#x27;     * @param tags array of tags\n&#x27;
                           &#x27;     * @param isPinned note is pinned\n&#x27;
                           &#x27;     * @return true if note has changes, false if &#x27;
                           &#x27;it is unchanged.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public boolean hasChanges(String content, &#x27;
                           &#x27;boolean isPinned) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (content.equals(this.getContent()) &amp;&amp; &#x27;
                           &#x27;this.isPinned() == isPinned)\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        else\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote.models;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.text.DateFormat;\n&#x27;
                           &#x27;import java.text.SimpleDateFormat;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;import java.util.HashMap;\n&#x27;
                           &#x27;import java.util.Locale;\n&#x27;
                           &#x27;import java.util.Map;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.util.Log;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.R;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.Query.ComparisonType;\n&#x27;
                           &#x27;import com.simperium.client.Query.SortType;\n&#x27;
                           &#x27;import com.simperium.client.BucketObject;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Index;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Indexer;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;public class Note extends BucketObject {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static final String BUCKET_NAME=&quot;note&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PINNED_TAG=&quot;pinned&quot;;\n&#x27;
                           &#x27;    public static final String NEW_LINE=&quot;\\n&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final String &#x27;
                           &#x27;CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;\n&#x27;
                           &#x27;    private static final String BLANK_CONTENT=&quot;&quot;;\n&#x27;
                           &#x27;    private static final String SPACE = &quot; &quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CONTENT_PROPERTY=&quot;content&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;TAGS_PROPERTY=&quot;tags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CREATION_DATE_PROPERTY=&quot;creationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SHARE_URL_PROPERTY=&quot;shareURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;DELETED_PROPERTY=&quot;deleted&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tprotected String title = null;\n&#x27;
                           &#x27;\tprotected String contentPreview = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static class Schema extends &#x27;
                           &#x27;BucketSchema&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public Schema(){\n&#x27;
                           &#x27;            autoIndex();\n&#x27;
                           &#x27;            addIndex(noteIndexer);\n&#x27;
                           &#x27;            setDefault(CONTENT_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(SYSTEM_TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(DELETED_PROPERTY, false);\n&#x27;
                           &#x27;            setDefault(SHARE_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private Indexer noteIndexer = new &#x27;
                           &#x27;Indexer&lt;Note&gt;(){\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public List&lt;Index&gt; index(Note note){\n&#x27;
                           &#x27;                List&lt;Index&gt; indexes = new &#x27;
                           &#x27;ArrayList&lt;Index&gt;();\n&#x27;
                           &#x27;                if (note.isPinned()) {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, true));\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, false));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                indexes.add(new &#x27;
                           &#x27;Index(&quot;contentPreview&quot;, &#x27;
                           &#x27;note.getContentPreview()));\n&#x27;
                           &#x27;                indexes.add(new Index(&quot;title&quot;, &#x27;
                           &#x27;note.getTitle()));\n&#x27;
                           &#x27;                return indexes;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        };\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public String getRemoteName(){\n&#x27;
                           &#x27;            return Note.BUCKET_NAME;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tpublic Note build(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;\t\t\tNote note = new Note(key, properties);\n&#x27;
                           &#x27;\t\t\treturn note;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void update(Note note, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;            note.properties = properties;\n&#x27;
                           &#x27;            note.title = null;\n&#x27;
                           &#x27;            note.contentPreview = null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allDeleted(Bucket&lt;Note&gt; noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket, String searchString){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;content&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allInTag(Bucket&lt;Note&gt; noteBucket, String tag){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;tags&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, tag);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public Note(String key){\n&#x27;
                           &#x27;        super(key, new HashMap&lt;String,Object&gt;());\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Note(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties) {\n&#x27;
                           &#x27;\t\tsuper(key, properties);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void updateTitleAndPreview(){\n&#x27;
                           &#x27;        // try to bulid a title and preview &#x27;
                           &#x27;property out of content\n&#x27;
                           &#x27;        String content = getContent();\n&#x27;
                           &#x27;        // title = &quot;Hello World&quot;;\n&#x27;
                           &#x27;        // contentPreview = &quot;This is a preview&quot;;\n&#x27;
                           &#x27;        int location = -1;\n&#x27;
                           &#x27;        int lines = 0;\n&#x27;
                           &#x27;        int content_lines = 0;\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        boolean foundTitle = false;\n&#x27;
                           &#x27;        boolean foundContent = false;\n&#x27;
                           &quot;        // loop until we&#x27;ve found all the new &quot;
                           &#x27;lines\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                if (!foundTitle) {\n&#x27;
                           &#x27;                    foundTitle = true;\n&#x27;
                           &#x27;                    title = possible;\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; &#x27;
                           &#x27;!foundTitle);\n&#x27;
                           &#x27;        lines = 0;\n&#x27;
                           &#x27;        contentPreview = &quot;&quot;;\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                contentPreview = &#x27;
                           &#x27;String.format(CONTENT_CONCAT_FORMAT, &#x27;
                           &#x27;contentPreview, possible);\n&#x27;
                           &#x27;                if (contentPreview.length() &gt;= &#x27;
                           &#x27;300) {\n&#x27;
                           &#x27;                    foundContent = true;\n&#x27;
                           &#x27;                    contentPreview = &#x27;
                           &#x27;contentPreview.substring(0, 300);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; !foundContent);\n&#x27;
                           &#x27;        if (!foundTitle) {\n&#x27;
                           &#x27;            title = content;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (contentPreview.isEmpty()) {\n&#x27;
                           &#x27;            contentPreview = content;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            contentPreview = &#x27;
                           &#x27;contentPreview.trim();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getTitle() {\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn title;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getTitle(String ifBlank){\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (title.trim().equals(&quot;&quot;)) {\n&#x27;
                           &#x27;            return ifBlank;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return title;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContent() {\n&#x27;
                           &#x27;        Object content = &#x27;
                           &#x27;getProperty(CONTENT_PROPERTY);\n&#x27;
                           &#x27;        if (content == null) {\n&#x27;
                           &#x27;            return BLANK_CONTENT;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (String) content;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setContent(String content) {\n&#x27;
                           &#x27;        title = null;\n&#x27;
                           &#x27;        contentPreview = null;\n&#x27;
                           &#x27;        setProperty(CONTENT_PROPERTY, content);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContentPreview() {\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn contentPreview;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getContentPreview(int lines){\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return contentPreview;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getCreationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setCreationDate(Calendar &#x27;
                           &#x27;creationDate) {\n&#x27;
                           &#x27;        setProperty(CREATION_DATE_PROPERTY, &#x27;
                           &#x27;creationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getModificationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setModificationDate(Calendar &#x27;
                           &#x27;modificationDate) {\n&#x27;
                           &#x27;        setProperty(MODIFICATION_DATE_PROPERTY, &#x27;
                           &#x27;modificationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean hasTag(Tag tag){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for (String tagKey : tags) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(tag.getSimperiumKey().equals(tagKey)) return &#x27;
                           &#x27;true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getTags() {\n&#x27;
                           &#x27;        Object tags = getProperty(TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            tags = new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;            setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (ArrayList&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setTags(List&lt;String&gt; tags) {\n&#x27;
                           &#x27;        setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * String of tags delimited by a space\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public CharSequence getTagString(){\n&#x27;
                           &#x27;        StringBuilder tagString = new &#x27;
                           &#x27;StringBuilder();\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for(String tag : tags){\n&#x27;
                           &#x27;            if (tagString.length() &gt; 0) {\n&#x27;
                           &#x27;                tagString.append(SPACE);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            tagString.append(tag);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return tagString;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &quot;     * Sets the note&#x27;s tags by providing it with a &quot;
                           &#x27;{@link String} of space\n&#x27;
                           &#x27;     * seperated tags. Filters out duplicate &#x27;
                           &#x27;tags.\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param tagString a space delimited list of &#x27;
                           &#x27;tags\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setTagString(String tagString){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        tags.clear();\n&#x27;
                           &#x27;        if (tagString == null) return;\n&#x27;
                           &#x27;        // for comparing case-insensitive strings, &#x27;
                           &#x27;would like to find a way to\n&#x27;
                           &#x27;        // do this without allocating a new list &#x27;
                           &#x27;and strings\n&#x27;
                           &#x27;        List&lt;String&gt; tagsUpperCase = new &#x27;
                           &#x27;ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        // remove all current tags\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        int next = -1;\n&#x27;
                           &#x27;        String possible;\n&#x27;
                           &#x27;        String possibleUpperCase;\n&#x27;
                           &#x27;        // search tag string for space characters &#x27;
                           &#x27;and pull out individual tags\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            next = tagString.indexOf(SPACE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (next &gt; start) {\n&#x27;
                           &#x27;                possible = &#x27;
                           &#x27;tagString.substring(start, next);\n&#x27;
                           &#x27;                possibleUpperCase = &#x27;
                           &#x27;possible.toUpperCase();\n&#x27;
                           &#x27;                if (!possible.equals(SPACE) &amp;&amp; &#x27;
                           &#x27;!tagsUpperCase.contains(possibleUpperCase)) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;tagsUpperCase.add(possibleUpperCase);\n&#x27;
                           &#x27;                    tags.add(possible);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            start = next + 1;\n&#x27;
                           &#x27;        } while(next &gt; -1);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getSystemTags() {\n&#x27;
                           &#x27;        Object tags = &#x27;
                           &#x27;getProperty(SYSTEM_TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            return new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (List&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Boolean isDeleted() {\n&#x27;
                           &#x27;        Object deleted = &#x27;
                           &#x27;getProperty(DELETED_PROPERTY);\n&#x27;
                           &#x27;        if (deleted == null) {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\tif (deleted instanceof Boolean) {\n&#x27;
                           &#x27;\t\t\treturn (Boolean) deleted;\n&#x27;
                           &#x27;\t\t} else if (deleted instanceof Number) {\n&#x27;
                           &#x27;\t\t\treturn ((Number)deleted).intValue() == 0 ? &#x27;
                           &#x27;false : true;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setDeleted(boolean deleted) {\n&#x27;
                           &#x27;\t\tsetProperty(DELETED_PROPERTY, deleted);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic boolean isPinned() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;getSystemTags().contains(PINNED_TAG);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setPinned(boolean isPinned) {\n&#x27;
                           &#x27;        if (isPinned &amp;&amp; !isPinned()) {\n&#x27;
                           &#x27;            getSystemTags().add(PINNED_TAG);\n&#x27;
                           &#x27;        } else if (!isPinned &amp;&amp; isPinned()){\n&#x27;
                           &#x27;            getSystemTags().remove(PINNED_TAG);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String dateString(Number time, &#x27;
                           &#x27;boolean useShortFormat, Context context){\n&#x27;
                           &#x27;        Calendar c = numberToDate(time);\n&#x27;
                           &#x27;        return dateString(c, useShortFormat, &#x27;
                           &#x27;context);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static String dateString(Calendar c, &#x27;
                           &#x27;boolean useShortFormat, Context context) {\n&#x27;
                           &#x27;\t\tint year, month, day;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tString time, date, retVal;\n&#x27;
                           &#x27;\t\ttime = date = &quot;&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tCalendar diff = Calendar.getInstance();\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(diff.getTimeInMillis() - &#x27;
                           &#x27;c.getTimeInMillis());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tyear = diff.get(Calendar.YEAR);\n&#x27;
                           &#x27;\t\tmonth = diff.get(Calendar.MONTH);\n&#x27;
                           &#x27;\t\tday = diff.get(Calendar.DAY_OF_MONTH);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(0); // starting time\n&#x27;
                           &#x27;\t\ttime = &#x27;
                           &#x27;DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());\n&#x27;
                           &#x27;\t\tif ((year == diff.get(Calendar.YEAR)) &amp;&amp; &#x27;
                           &#x27;(month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;diff.get(Calendar.DAY_OF_MONTH))) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.today);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = time;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else if ((year == diff.get(Calendar.YEAR)) &#x27;
                           &#x27;&amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;1)) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.yesterday);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = date;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else {\n&#x27;
                           &#x27;\t\t\tdate = new SimpleDateFormat(&quot;MMM dd&quot;, &#x27;
                           &#x27;Locale.US).format(c.getTime());\n&#x27;
                           &#x27;\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\treturn retVal;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Object getProperty(String key){\n&#x27;
                           &#x27;        return properties.get(key);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void setProperty(String key, Object &#x27;
                           &#x27;value){\n&#x27;
                           &#x27;        properties.put(key, value);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Calendar numberToDate(Number &#x27;
                           &#x27;time){\n&#x27;
                           &#x27;        Calendar date = Calendar.getInstance();\n&#x27;
                           &#x27;        if (time != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;date.setTimeInMillis(time.longValue()*1000);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return date;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Check if the note has any changes\n&#x27;
                           &#x27;     * @param content the new note content\n&#x27;
                           &#x27;     * @param tags array of tags\n&#x27;
                           &#x27;     * @param isPinned note is pinned\n&#x27;
                           &#x27;     * @return true if note has changes, false if &#x27;
                           &#x27;it is unchanged.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public boolean hasChanges(String content, &#x27;
                           &#x27;boolean isPinned) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (content.equals(this.getContent()) &amp;&amp; &#x27;
                           &#x27;this.isPinned() == isPinned)\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        else\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;package com.automattic.simplenote.models;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.text.DateFormat;\n&#x27;
                           &#x27;import java.text.SimpleDateFormat;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;import java.util.HashMap;\n&#x27;
                           &#x27;import java.util.Locale;\n&#x27;
                           &#x27;import java.util.Map;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.util.Log;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.R;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.Query.ComparisonType;\n&#x27;
                           &#x27;import com.simperium.client.Query.SortType;\n&#x27;
                           &#x27;import com.simperium.client.BucketObject;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Index;\n&#x27;
                           &#x27;import com.simperium.client.BucketSchema.Indexer;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;public class Note extends BucketObject {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static final String BUCKET_NAME=&quot;note&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PINNED_TAG=&quot;pinned&quot;;\n&#x27;
                           &#x27;    public static final String NEW_LINE=&quot;\\n&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final String &#x27;
                           &#x27;CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;\n&#x27;
                           &#x27;    private static final String BLANK_CONTENT=&quot;&quot;;\n&#x27;
                           &#x27;    private static final String SPACE = &quot; &quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CONTENT_PROPERTY=&quot;content&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;TAGS_PROPERTY=&quot;tags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;CREATION_DATE_PROPERTY=&quot;creationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;SHARE_URL_PROPERTY=&quot;shareURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;\n&#x27;
                           &#x27;    public static final String &#x27;
                           &#x27;DELETED_PROPERTY=&quot;deleted&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tprotected String title = null;\n&#x27;
                           &#x27;\tprotected String contentPreview = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static class Schema extends &#x27;
                           &#x27;BucketSchema&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public Schema(){\n&#x27;
                           &#x27;            autoIndex();\n&#x27;
                           &#x27;            addIndex(noteIndexer);\n&#x27;
                           &#x27;            setDefault(CONTENT_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(SYSTEM_TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(TAGS_PROPERTY, new &#x27;
                           &#x27;ArrayList&lt;Object&gt;());\n&#x27;
                           &#x27;            setDefault(DELETED_PROPERTY, false);\n&#x27;
                           &#x27;            setDefault(SHARE_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;            setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private Indexer noteIndexer = new &#x27;
                           &#x27;Indexer&lt;Note&gt;(){\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public List&lt;Index&gt; index(Note note){\n&#x27;
                           &#x27;                List&lt;Index&gt; indexes = new &#x27;
                           &#x27;ArrayList&lt;Index&gt;();\n&#x27;
                           &#x27;                if (note.isPinned()) {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, true));\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    indexes.add(new &#x27;
                           &#x27;Index(&quot;pinned&quot;, false));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                indexes.add(new &#x27;
                           &#x27;Index(&quot;contentPreview&quot;, &#x27;
                           &#x27;note.getContentPreview()));\n&#x27;
                           &#x27;                indexes.add(new Index(&quot;title&quot;, &#x27;
                           &#x27;note.getTitle()));\n&#x27;
                           &#x27;                return indexes;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        };\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public String getRemoteName(){\n&#x27;
                           &#x27;            return Note.BUCKET_NAME;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tpublic Note build(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;\t\t\tNote note = new Note(key, properties);\n&#x27;
                           &#x27;\t\t\treturn note;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void update(Note note, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties){\n&#x27;
                           &#x27;            note.properties = properties;\n&#x27;
                           &#x27;            note.title = null;\n&#x27;
                           &#x27;            note.contentPreview = null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allDeleted(Bucket&lt;Note&gt; noteBucket){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.EQUAL_TO, true);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; &#x27;
                           &#x27;noteBucket, String searchString){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;content&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Query&lt;Note&gt; &#x27;
                           &#x27;allInTag(Bucket&lt;Note&gt; noteBucket, String tag){\n&#x27;
                           &#x27;        return noteBucket.query()\n&#x27;
                           &#x27;                .where(&quot;deleted&quot;, &#x27;
                           &#x27;ComparisonType.NOT_EQUAL_TO, true)\n&#x27;
                           &#x27;                .where(&quot;tags&quot;, &#x27;
                           &#x27;ComparisonType.LIKE, tag);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public Note(String key){\n&#x27;
                           &#x27;        super(key, new HashMap&lt;String,Object&gt;());\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Note(String key, &#x27;
                           &#x27;Map&lt;String,Object&gt;properties) {\n&#x27;
                           &#x27;\t\tsuper(key, properties);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void updateTitleAndPreview(){\n&#x27;
                           &#x27;        // try to bulid a title and preview &#x27;
                           &#x27;property out of content\n&#x27;
                           &#x27;        String content = getContent();\n&#x27;
                           &#x27;        // title = &quot;Hello World&quot;;\n&#x27;
                           &#x27;        // contentPreview = &quot;This is a preview&quot;;\n&#x27;
                           &#x27;        int location = -1;\n&#x27;
                           &#x27;        int lines = 0;\n&#x27;
                           &#x27;        int content_lines = 0;\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        boolean foundTitle = false;\n&#x27;
                           &#x27;        boolean foundContent = false;\n&#x27;
                           &quot;        // loop until we&#x27;ve found all the new &quot;
                           &#x27;lines\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                if (!foundTitle) {\n&#x27;
                           &#x27;                    foundTitle = true;\n&#x27;
                           &#x27;                    title = possible;\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; &#x27;
                           &#x27;!foundTitle);\n&#x27;
                           &#x27;        lines = 0;\n&#x27;
                           &#x27;        contentPreview = &quot;&quot;;\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            start = location + 1;\n&#x27;
                           &#x27;            location = content.indexOf(NEW_LINE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (location &gt; start + 1) {\n&#x27;
                           &#x27;                String possible = &#x27;
                           &#x27;content.substring(start, location);\n&#x27;
                           &#x27;                contentPreview = &#x27;
                           &#x27;String.format(CONTENT_CONCAT_FORMAT, &#x27;
                           &#x27;contentPreview, possible);\n&#x27;
                           &#x27;                if (contentPreview.length() &gt;= &#x27;
                           &#x27;300) {\n&#x27;
                           &#x27;                    foundContent = true;\n&#x27;
                           &#x27;                    contentPreview = &#x27;
                           &#x27;contentPreview.substring(0, 300);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            lines ++;\n&#x27;
                           &#x27;        } while(location &gt;= 0 &amp;&amp; !foundContent);\n&#x27;
                           &#x27;        if (!foundTitle) {\n&#x27;
                           &#x27;            title = content;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (contentPreview.isEmpty()) {\n&#x27;
                           &#x27;            contentPreview = content;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            contentPreview = &#x27;
                           &#x27;contentPreview.trim();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getTitle() {\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn title;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getTitle(String ifBlank){\n&#x27;
                           &#x27;        if (title == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        if (title.trim().equals(&quot;&quot;)) {\n&#x27;
                           &#x27;            return ifBlank;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return title;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContent() {\n&#x27;
                           &#x27;        Object content = &#x27;
                           &#x27;getProperty(CONTENT_PROPERTY);\n&#x27;
                           &#x27;        if (content == null) {\n&#x27;
                           &#x27;            return BLANK_CONTENT;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (String) content;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setContent(String content) {\n&#x27;
                           &#x27;        title = null;\n&#x27;
                           &#x27;        contentPreview = null;\n&#x27;
                           &#x27;        setProperty(CONTENT_PROPERTY, content);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic String getContentPreview() {\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\treturn contentPreview;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getContentPreview(int lines){\n&#x27;
                           &#x27;        if (contentPreview == null) {\n&#x27;
                           &#x27;            updateTitleAndPreview();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return contentPreview;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getCreationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setCreationDate(Calendar &#x27;
                           &#x27;creationDate) {\n&#x27;
                           &#x27;        setProperty(CREATION_DATE_PROPERTY, &#x27;
                           &#x27;creationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Calendar getModificationDate() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setModificationDate(Calendar &#x27;
                           &#x27;modificationDate) {\n&#x27;
                           &#x27;        setProperty(MODIFICATION_DATE_PROPERTY, &#x27;
                           &#x27;modificationDate.getTimeInMillis()/1000);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean hasTag(Tag tag){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for (String tagKey : tags) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(tag.getSimperiumKey().equals(tagKey)) return &#x27;
                           &#x27;true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getTags() {\n&#x27;
                           &#x27;        Object tags = getProperty(TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            tags = new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;            setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (ArrayList&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setTags(List&lt;String&gt; tags) {\n&#x27;
                           &#x27;        setProperty(TAGS_PROPERTY, tags);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * String of tags delimited by a space\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public CharSequence getTagString(){\n&#x27;
                           &#x27;        StringBuilder tagString = new &#x27;
                           &#x27;StringBuilder();\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        for(String tag : tags){\n&#x27;
                           &#x27;            if (tagString.length() &gt; 0) {\n&#x27;
                           &#x27;                tagString.append(SPACE);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            tagString.append(tag);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return tagString;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &quot;     * Sets the note&#x27;s tags by providing it with a &quot;
                           &#x27;{@link String} of space\n&#x27;
                           &#x27;     * seperated tags. Filters out duplicate &#x27;
                           &#x27;tags.\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param tagString a space delimited list of &#x27;
                           &#x27;tags\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setTagString(String tagString){\n&#x27;
                           &#x27;        List&lt;String&gt; tags = getTags();\n&#x27;
                           &#x27;        tags.clear();\n&#x27;
                           &#x27;        if (tagString == null) return;\n&#x27;
                           &#x27;        // for comparing case-insensitive strings, &#x27;
                           &#x27;would like to find a way to\n&#x27;
                           &#x27;        // do this without allocating a new list &#x27;
                           &#x27;and strings\n&#x27;
                           &#x27;        List&lt;String&gt; tagsUpperCase = new &#x27;
                           &#x27;ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        // remove all current tags\n&#x27;
                           &#x27;        int start = 0;\n&#x27;
                           &#x27;        int next = -1;\n&#x27;
                           &#x27;        String possible;\n&#x27;
                           &#x27;        String possibleUpperCase;\n&#x27;
                           &#x27;        // search tag string for space characters &#x27;
                           &#x27;and pull out individual tags\n&#x27;
                           &#x27;        do {\n&#x27;
                           &#x27;            next = tagString.indexOf(SPACE, &#x27;
                           &#x27;start);\n&#x27;
                           &#x27;            if (next &gt; start) {\n&#x27;
                           &#x27;                possible = &#x27;
                           &#x27;tagString.substring(start, next);\n&#x27;
                           &#x27;                possibleUpperCase = &#x27;
                           &#x27;possible.toUpperCase();\n&#x27;
                           &#x27;                if (!possible.equals(SPACE) &amp;&amp; &#x27;
                           &#x27;!tagsUpperCase.contains(possibleUpperCase)) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;tagsUpperCase.add(possibleUpperCase);\n&#x27;
                           &#x27;                    tags.add(possible);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            start = next + 1;\n&#x27;
                           &#x27;        } while(next &gt; -1);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic List&lt;String&gt; getSystemTags() {\n&#x27;
                           &#x27;        Object tags = &#x27;
                           &#x27;getProperty(SYSTEM_TAGS_PROPERTY);\n&#x27;
                           &#x27;        if (tags == null) {\n&#x27;
                           &#x27;            return new ArrayList&lt;String&gt;();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return (List&lt;String&gt;) tags;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic Boolean isDeleted() {\n&#x27;
                           &#x27;        Object deleted = &#x27;
                           &#x27;getProperty(DELETED_PROPERTY);\n&#x27;
                           &#x27;        if (deleted == null) {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t\tif (deleted instanceof Boolean) {\n&#x27;
                           &#x27;\t\t\treturn (Boolean) deleted;\n&#x27;
                           &#x27;\t\t} else if (deleted instanceof Number) {\n&#x27;
                           &#x27;\t\t\treturn ((Number)deleted).intValue() == 0 ? &#x27;
                           &#x27;false : true;\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setDeleted(boolean deleted) {\n&#x27;
                           &#x27;\t\tsetProperty(DELETED_PROPERTY, deleted);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic boolean isPinned() {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;getSystemTags().contains(PINNED_TAG);\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic void setPinned(boolean isPinned) {\n&#x27;
                           &#x27;        if (isPinned &amp;&amp; !isPinned()) {\n&#x27;
                           &#x27;            getSystemTags().add(PINNED_TAG);\n&#x27;
                           &#x27;        } else if (!isPinned &amp;&amp; isPinned()){\n&#x27;
                           &#x27;            getSystemTags().remove(PINNED_TAG);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String dateString(Number time, &#x27;
                           &#x27;boolean useShortFormat, Context context){\n&#x27;
                           &#x27;        Calendar c = numberToDate(time);\n&#x27;
                           &#x27;        return dateString(c, useShortFormat, &#x27;
                           &#x27;context);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\tpublic static String dateString(Calendar c, &#x27;
                           &#x27;boolean useShortFormat, Context context) {\n&#x27;
                           &#x27;\t\tint year, month, day;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tString time, date, retVal;\n&#x27;
                           &#x27;\t\ttime = date = &quot;&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tCalendar diff = Calendar.getInstance();\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(diff.getTimeInMillis() - &#x27;
                           &#x27;c.getTimeInMillis());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tyear = diff.get(Calendar.YEAR);\n&#x27;
                           &#x27;\t\tmonth = diff.get(Calendar.MONTH);\n&#x27;
                           &#x27;\t\tday = diff.get(Calendar.DAY_OF_MONTH);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\tdiff.setTimeInMillis(0); // starting time\n&#x27;
                           &#x27;\t\ttime = &#x27;
                           &#x27;DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());\n&#x27;
                           &#x27;\t\tif ((year == diff.get(Calendar.YEAR)) &amp;&amp; &#x27;
                           &#x27;(month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;diff.get(Calendar.DAY_OF_MONTH))) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.today);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = time;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else if ((year == diff.get(Calendar.YEAR)) &#x27;
                           &#x27;&amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == &#x27;
                           &#x27;1)) {\n&#x27;
                           &#x27;\t\t\tdate = &#x27;
                           &#x27;context.getResources().getString(R.string.yesterday);\n&#x27;
                           &#x27;\t\t\tif (useShortFormat)\n&#x27;
                           &#x27;\t\t\t\tretVal = date;\n&#x27;
                           &#x27;\t\t\telse\n&#x27;
                           &#x27;\t\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t} else {\n&#x27;
                           &#x27;\t\t\tdate = new SimpleDateFormat(&quot;MMM dd&quot;, &#x27;
                           &#x27;Locale.US).format(c.getTime());\n&#x27;
                           &#x27;\t\t\tretVal = date + &quot;, &quot; + time;\n&#x27;
                           &#x27;\t\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\t\treturn retVal;\n&#x27;
                           &#x27;\t}\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Object getProperty(String key){\n&#x27;
                           &#x27;        return properties.get(key);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void setProperty(String key, Object &#x27;
                           &#x27;value){\n&#x27;
                           &#x27;        properties.put(key, value);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static Calendar numberToDate(Number &#x27;
                           &#x27;time){\n&#x27;
                           &#x27;        Calendar date = Calendar.getInstance();\n&#x27;
                           &#x27;        if (time != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;date.setTimeInMillis(time.longValue()*1000);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return date;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Check if the note has any changes\n&#x27;
                           &#x27;     * @param content the new note content\n&#x27;
                           &#x27;     * @param tags array of tags\n&#x27;
                           &#x27;     * @param isPinned note is pinned\n&#x27;
                           &#x27;     * @return true if note has changes, false if &#x27;
                           &#x27;it is unchanged.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public boolean hasChanges(String content, &#x27;
                           &#x27;boolean isPinned) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (content.equals(this.getContent()) &amp;&amp; &#x27;
                           &#x27;this.isPinned() == isPinned)\n&#x27;
                           &#x27;            return false;\n&#x27;
                           &#x27;        else\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}]]</pre>
          </body>
        </html>
        