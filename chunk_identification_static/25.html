<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>25</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    25
                    <a href="24.html">prev</a>
                    <a href="26.html">next</a>
                    <a href="25_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_1469ca1ceaae9c691eee7790de89a3ee1f571403_Aria/src/main/java/com/arialyy/aria/core/common/ThreadStateManager.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403:Aria/src/main/java/com/arialyy/aria/core/common/ThreadStateManager.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^1:Aria/src/main/java/com/arialyy/aria/core/common/ThreadStateManager.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^2:Aria/src/main/java/com/arialyy/aria/core/common/ThreadStateManager.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;39a43c836d3309cbbf82de6d51309fe71fc25292:Aria/src/main/java/com/arialyy/aria/core/common/ThreadStateManager.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bsj]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  18 import android.os.Bundle;                                                                                </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  20 import android.os.Looper;                                                                                </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="">  21 import android.os.Message;                                                                               </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  22 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  23 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  24 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="">  25 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  26 import java.io.File;                                                                                     </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  27 import java.util.ArrayList;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  28 import java.util.List;                                                                                   </span>
<span  style="">  29                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30 /**                                                                                                      </span>
<span class="1158812768732845715" onmouseenter="enter('1158812768732845715');" onmouseout="out('1158812768732845715');" style="">  31  * 线程任务管理器，用于处理多线程下载时任务的状态回调                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  32  */                                                                                                      </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  33 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-4299899579438689924" onmouseenter="enter('-4299899579438689924');" onmouseout="out('-4299899579438689924');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 public class ThreadStateManager implements IThreadState {                                                </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35   private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37   /**                                                                                                    </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38    * 任务状态回调                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39    */                                                                                                    </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   private IEventListener mListener;                                                                      </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   private int mThreadNum;    // 启动的线程总数                                                                  </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42   private int mCancelNum = 0; // 已经取消的线程的数                                                               </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43   private int mStopNum = 0;  // 已经停止的线程数                                                                 </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private int mFailNum = 0;  // 失败的线程数                                                                   </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   private int mCompleteNum = 0;  // 完成的线程数                                                               </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private long mProgress; //当前总进度                                                                        </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private TaskRecord mTaskRecord; // 任务记录                                                                </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   private Looper mLooper;                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   /**                                                                                                    </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51    * @param taskRecord 任务记录                                                                              </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52    * @param listener 任务事件                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53    */                                                                                                    </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                    </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55     mLooper = looper;                                                                                    </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56     mTaskRecord = taskRecord;                                                                            </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57     mThreadNum = mTaskRecord.threadNum;                                                                  </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60                                                                                                          </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   @Override public boolean handleMessage(Message msg) {                                                  </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62     switch (msg.what) {                                                                                  </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63       case STATE_STOP:                                                                                   </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64         mStopNum++;                                                                                      </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65         if (isStop()) {                                                                                  </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66           mListener.onStop(mProgress);                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69         break;                                                                                           </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70       case STATE_CANCEL:                                                                                 </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71         mCancelNum++;                                                                                    </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72         if (isCancel()) {                                                                                </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73           ALog.d(TAG, &quot;icCancel&quot;);                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74           mListener.onCancel();                                                                          </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77         break;                                                                                           </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78       case STATE_FAIL:                                                                                   </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79         mFailNum++;                                                                                      </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80         if (isFail()) {                                                                                  </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81           Bundle b = msg.getData();                                                                      </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82           mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83               (BaseException) b.getSerializable(KEY_ERROR_INFO));                                        </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86         break;                                                                                           </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       case STATE_COMPLETE:                                                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88         mCompleteNum++;                                                                                  </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89         if (isComplete()) {                                                                              </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90           ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                      </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91           if (mTaskRecord.isBlock) {                                                                     </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92             if (mergeFile()) {                                                                           </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93               mListener.onComplete();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94             } else {                                                                                     </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95               mListener.onFail(false, null);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97           } else {                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98             mListener.onComplete();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99           }                                                                                              </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         break;                                                                                           </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103       case STATE_RUNNING:                                                                                </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         mProgress += (long) msg.obj;                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105         break;                                                                                           </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106       case STATE_UPDATE_PROGRESS:                                                                        </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107         if (msg.obj == null) {                                                                           </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108           mProgress = updateBlockProgress();                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109         } else {                                                                                         </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110           mProgress = (long) msg.obj;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117   /**                                                                                                    </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118    * 退出looper循环                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119    */                                                                                                    </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120   private void quitLooper() {                                                                            </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121     mLooper.quit();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124   /**                                                                                                    </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125    * 获取当前任务下载进度                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126    *                                                                                                     </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127    * @return 当前任务下载进度                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129   @Override                                                                                              </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130   public long getCurrentProgress() {                                                                     </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131     return mProgress;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134   /**                                                                                                    </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135    * 所有子线程是否都已经停止                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137   @Override                                                                                              </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138   public boolean isStop() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139     //ALog.d(TAG,                                                                                        </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145   /**                                                                                                    </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146    * 所有子线程是否都已经失败                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148   @Override                                                                                              </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   public boolean isFail() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150     //ALog.d(TAG,                                                                                        </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151     //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153     return mCompleteNum != mThreadNum                                                                    </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154         &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157   /**                                                                                                    </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158    * 所有子线程是否都已经完成                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160   @Override                                                                                              </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161   public boolean isComplete() {                                                                          </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     //ALog.d(TAG,                                                                                        </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163     //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,          </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164     //        mStopNum,                                                                                  </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166     return mCompleteNum == mThreadNum;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169   /**                                                                                                    </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170    * 所有子线程是否都已经取消                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172   @Override                                                                                              </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 173 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 174 =======                                                                                                  </span>
<span class="7382497573847408965" onmouseenter="enter('7382497573847408965');" onmouseout="out('7382497573847408965');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 public class ThreadStateManager implements Handler.Callback {                                            </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176   private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                   </span>
<span class="-4011777087425911246" onmouseenter="enter('-4011777087425911246');" onmouseout="out('-4011777087425911246');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177   public static final int STATE_STOP = 0x01;                                                             </span>
<span class="-8785241425494592068" onmouseenter="enter('-8785241425494592068');" onmouseout="out('-8785241425494592068');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178   public static final int STATE_FAIL = 0x02;                                                             </span>
<span class="3183322182628493305" onmouseenter="enter('3183322182628493305');" onmouseout="out('3183322182628493305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179   public static final int STATE_CANCEL = 0x03;                                                           </span>
<span class="136738906973804026" onmouseenter="enter('136738906973804026');" onmouseout="out('136738906973804026');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180   public static final int STATE_COMPLETE = 0x04;                                                         </span>
<span class="-4958961754625055046" onmouseenter="enter('-4958961754625055046');" onmouseout="out('-4958961754625055046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181   public static final int STATE_RUNNING = 0x05;                                                          </span>
<span class="-9066142431873928680" onmouseenter="enter('-9066142431873928680');" onmouseout="out('-9066142431873928680');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182   public static final int STATE_UPDATE_PROGRESS = 0x06;                                                  </span>
<span class="-5254860985169932841" onmouseenter="enter('-5254860985169932841');" onmouseout="out('-5254860985169932841');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183   public static final String KEY_RETRY = &quot;KEY_RETRY&quot;;                                                    </span>
<span class="3671907362671705317" onmouseenter="enter('3671907362671705317');" onmouseout="out('3671907362671705317');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184   public static final String KEY_ERROR_INFO = &quot;KEY_ERROR_INFO&quot;;                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186   /**                                                                                                    </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187    * 任务状态回调                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188    */                                                                                                    </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189   private IEventListener mListener;                                                                      </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190   private int mThreadNum;    // 启动的线程总数                                                                  </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191   private int mCancelNum = 0; // 已经取消的线程的数                                                               </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192   private int mStopNum = 0;  // 已经停止的线程数                                                                 </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193   private int mFailNum = 0;  // 失败的线程数                                                                   </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194   private int mCompleteNum = 0;  // 完成的线程数                                                               </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195   private long mProgress; //当前总进度                                                                        </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196   private TaskRecord mTaskRecord; // 任务记录                                                                </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197   private Looper mLooper;                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199   /**                                                                                                    </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200    * @param taskRecord 任务记录                                                                              </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201    * @param listener 任务事件                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202    */                                                                                                    </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203   ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                    </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204     mLooper = looper;                                                                                    </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205     mTaskRecord = taskRecord;                                                                            </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206     mThreadNum = mTaskRecord.threadNum;                                                                  </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                                                                                                          </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210   @Override public boolean handleMessage(Message msg) {                                                  </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211     switch (msg.what) {                                                                                  </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212       case STATE_STOP:                                                                                   </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213         mStopNum++;                                                                                      </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214         if (isStop()) {                                                                                  </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215           mListener.onStop(mProgress);                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218         break;                                                                                           </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219       case STATE_CANCEL:                                                                                 </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220         mCancelNum++;                                                                                    </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221         if (isCancel()) {                                                                                </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222           ALog.d(TAG, &quot;icCancel&quot;);                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223           mListener.onCancel();                                                                          </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226         break;                                                                                           </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227       case STATE_FAIL:                                                                                   </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228         mFailNum++;                                                                                      </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229         if (isFail()) {                                                                                  </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230           Bundle b = msg.getData();                                                                      </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231           mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232               (BaseException) b.getSerializable(KEY_ERROR_INFO));                                        </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         break;                                                                                           </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236       case STATE_COMPLETE:                                                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237         mCompleteNum++;                                                                                  </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238         if (isComplete()) {                                                                              </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239           ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                      </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240           if (mTaskRecord.isBlock) {                                                                     </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241             if (mergeFile()) {                                                                           </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242               mListener.onComplete();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243             } else {                                                                                     </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244               mListener.onFail(false, null);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246           } else {                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247             mListener.onComplete();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248           }                                                                                              </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251         break;                                                                                           </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252       case STATE_RUNNING:                                                                                </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253         mProgress += (long) msg.obj;                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254         break;                                                                                           </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255       case STATE_UPDATE_PROGRESS:                                                                        </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256         if (msg.obj == null) {                                                                           </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257           mProgress = updateBlockProgress();                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258         } else {                                                                                         </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259           mProgress = (long) msg.obj;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266   /**                                                                                                    </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267    * 退出looper循环                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268    */                                                                                                    </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269   private void quitLooper() {                                                                            </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270     mLooper.quit();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273   /**                                                                                                    </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274    * 获取当前任务下载进度                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275    *                                                                                                     </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276    * @return 当前任务下载进度                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277    */                                                                                                    </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278   public long getCurrentProgress() {                                                                     </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279     return mProgress;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282   /**                                                                                                    </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283    * 所有子线程是否都已经停止                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284    */                                                                                                    </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285   public boolean isStop() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286     //ALog.d(TAG,                                                                                        </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287     //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289     return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292   /**                                                                                                    </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293    * 所有子线程是否都已经失败                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294    */                                                                                                    </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295   public boolean isFail() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296     //ALog.d(TAG,                                                                                        </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297     //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299     return mCompleteNum != mThreadNum                                                                    </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300         &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303   /**                                                                                                    </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304    * 所有子线程是否都已经完成                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305    */                                                                                                    </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306   public boolean isComplete() {                                                                          </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307     //ALog.d(TAG,                                                                                        </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308     //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,          </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309     //        mStopNum,                                                                                  </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311     return mCompleteNum == mThreadNum;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314   /**                                                                                                    </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315    * 所有子线程是否都已经取消                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316    */                                                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 317 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="8880447242758016570" onmouseenter="enter('8880447242758016570');" onmouseout="out('8880447242758016570');" style=""> 318   public boolean isCancel() {                                                                            </span>
<span class="1778135252999196773" onmouseenter="enter('1778135252999196773');" onmouseout="out('1778135252999196773');" style=""> 319     //ALog.d(TAG, String.format(&quot;isCancel; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,    </span>
<span class="585222587359148719" onmouseenter="enter('585222587359148719');" onmouseout="out('585222587359148719');" style=""> 320     //    mStopNum,                                                                                      </span>
<span class="-2574532893522119459" onmouseenter="enter('-2574532893522119459');" onmouseout="out('-2574532893522119459');" style=""> 321     //    mCancelNum, mFailNum, mCompleteNum));                                                          </span>
<span class="-6123881945738795052" onmouseenter="enter('-6123881945738795052');" onmouseout="out('-6123881945738795052');" style=""> 322     return mCancelNum == mThreadNum;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323   }                                                                                                      </span>
<span  style=""> 324                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 325   /**                                                                                                    </span>
<span class="-6722905692252086257" onmouseenter="enter('-6722905692252086257');" onmouseout="out('-6722905692252086257');" style=""> 326    * 更新分块任务s的真实进度                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 327    */                                                                                                    </span>
<span class="4495633950832895741" onmouseenter="enter('4495633950832895741');" onmouseout="out('4495633950832895741');" style=""> 328   private long updateBlockProgress() {                                                                   </span>
<span class="642216204902078772" onmouseenter="enter('642216204902078772');" onmouseout="out('642216204902078772');" style=""> 329     long size = 0;                                                                                       </span>
<span class="4208836096360237149" onmouseenter="enter('4208836096360237149');" onmouseout="out('4208836096360237149');" style=""> 330     for (int i = 0, len = mTaskRecord.threadRecords.size(); i &lt; len; i++) {                              </span>
<span class="851601071059154606" onmouseenter="enter('851601071059154606');" onmouseout="out('851601071059154606');" style=""> 331       File temp = new File(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));              </span>
<span class="7100992962921282764" onmouseenter="enter('7100992962921282764');" onmouseout="out('7100992962921282764');" style=""> 332       if (temp.exists()) {                                                                               </span>
<span class="9105498611704012504" onmouseenter="enter('9105498611704012504');" onmouseout="out('9105498611704012504');" style=""> 333         size += temp.length();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335     }                                                                                                    </span>
<span class="7808415022879232995" onmouseenter="enter('7808415022879232995');" onmouseout="out('7808415022879232995');" style=""> 336     return size;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337   }                                                                                                      </span>
<span  style=""> 338                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 339   /**                                                                                                    </span>
<span class="-8362313205067342402" onmouseenter="enter('-8362313205067342402');" onmouseout="out('-8362313205067342402');" style=""> 340    * 合并文件                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 341    *                                                                                                     </span>
<span class="7152954986304769445" onmouseenter="enter('7152954986304769445');" onmouseout="out('7152954986304769445');" style=""> 342    * @return {@code true} 合并成功，{@code false}合并失败                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 343    */                                                                                                    </span>
<span class="-8404487487663192466" onmouseenter="enter('-8404487487663192466');" onmouseout="out('-8404487487663192466');" style=""> 344   private boolean mergeFile() {                                                                          </span>
<span class="7604758579765859822" onmouseenter="enter('7604758579765859822');" onmouseout="out('7604758579765859822');" style=""> 345     List&lt;String&gt; partPath = new ArrayList&lt;&gt;();                                                           </span>
<span class="4509036467004247563" onmouseenter="enter('4509036467004247563');" onmouseout="out('4509036467004247563');" style=""> 346     for (int i = 0, len = mTaskRecord.threadNum; i &lt; len; i++) {                                         </span>
<span class="9214251752076948430" onmouseenter="enter('9214251752076948430');" onmouseout="out('9214251752076948430');" style=""> 347       partPath.add(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348     }                                                                                                    </span>
<span class="2318178634808216853" onmouseenter="enter('2318178634808216853');" onmouseout="out('2318178634808216853');" style=""> 349     boolean isSuccess = FileUtil.mergeFile(mTaskRecord.filePath, partPath);                              </span>
<span class="155883027282181251" onmouseenter="enter('155883027282181251');" onmouseout="out('155883027282181251');" style=""> 350     if (isSuccess) {                                                                                     </span>
<span class="-8585313318236954494" onmouseenter="enter('-8585313318236954494');" onmouseout="out('-8585313318236954494');" style=""> 351       for (String pp : partPath) {                                                                       </span>
<span class="528717567100361765" onmouseenter="enter('528717567100361765');" onmouseout="out('528717567100361765');" style=""> 352         File f = new File(pp);                                                                           </span>
<span class="8226260359634022247" onmouseenter="enter('8226260359634022247');" onmouseout="out('8226260359634022247');" style=""> 353         if (f.exists()) {                                                                                </span>
<span class="7682989536937550366" onmouseenter="enter('7682989536937550366');" onmouseout="out('7682989536937550366');" style=""> 354           f.delete();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356       }                                                                                                  </span>
<span class="-5771808859074364721" onmouseenter="enter('-5771808859074364721');" onmouseout="out('-5771808859074364721');" style=""> 357       File targetFile = new File(mTaskRecord.filePath);                                                  </span>
<span class="-6816706015681170049" onmouseenter="enter('-6816706015681170049');" onmouseout="out('-6816706015681170049');" style=""> 358       if (targetFile.exists() &amp;&amp; targetFile.length() &gt; mTaskRecord.fileLength) {                         </span>
<span class="-2471360084270286815" onmouseenter="enter('-2471360084270286815');" onmouseout="out('-2471360084270286815');" style=""> 359         ALog.e(TAG, String.format(&quot;任务【%s】分块文件合并失败，下载长度超出文件真实长度，downloadLen: %s，fileSize: %s&quot;,            </span>
<span class="5883350204200555923" onmouseenter="enter('5883350204200555923');" onmouseout="out('5883350204200555923');" style=""> 360             targetFile.getName(), targetFile.length(), mTaskRecord.fileLength));                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 361         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362       }                                                                                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 363       return true;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 364     } else {                                                                                             </span>
<span class="5288275421299303387" onmouseenter="enter('5288275421299303387');" onmouseout="out('5288275421299303387');" style=""> 365       ALog.e(TAG, &quot;合并失败&quot;);                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 366       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369 }                                                                                                        </span>
</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  18 import android.os.Bundle;                                                                                </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  20 import android.os.Looper;                                                                                </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="">  21 import android.os.Message;                                                                               </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  22 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  23 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  24 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="">  25 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  26 import java.io.File;                                                                                     </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  27 import java.util.ArrayList;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  28 import java.util.List;                                                                                   </span>
<span  style="">  29                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30 /**                                                                                                      </span>
<span class="1158812768732845715" onmouseenter="enter('1158812768732845715');" onmouseout="out('1158812768732845715');" style="">  31  * 线程任务管理器，用于处理多线程下载时任务的状态回调                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  32  */                                                                                                      </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  33 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-4299899579438689924" onmouseenter="enter('-4299899579438689924');" onmouseout="out('-4299899579438689924');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 public class ThreadStateManager implements IThreadState {                                                </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35   private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37   /**                                                                                                    </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38    * 任务状态回调                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39    */                                                                                                    </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   private IEventListener mListener;                                                                      </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   private int mThreadNum;    // 启动的线程总数                                                                  </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42   private int mCancelNum = 0; // 已经取消的线程的数                                                               </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43   private int mStopNum = 0;  // 已经停止的线程数                                                                 </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private int mFailNum = 0;  // 失败的线程数                                                                   </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   private int mCompleteNum = 0;  // 完成的线程数                                                               </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private long mProgress; //当前总进度                                                                        </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private TaskRecord mTaskRecord; // 任务记录                                                                </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   private Looper mLooper;                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   /**                                                                                                    </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51    * @param taskRecord 任务记录                                                                              </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52    * @param listener 任务事件                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53    */                                                                                                    </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                    </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55     mLooper = looper;                                                                                    </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56     mTaskRecord = taskRecord;                                                                            </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57     mThreadNum = mTaskRecord.threadNum;                                                                  </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60                                                                                                          </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   @Override public boolean handleMessage(Message msg) {                                                  </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62     switch (msg.what) {                                                                                  </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63       case STATE_STOP:                                                                                   </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64         mStopNum++;                                                                                      </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65         if (isStop()) {                                                                                  </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66           mListener.onStop(mProgress);                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69         break;                                                                                           </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70       case STATE_CANCEL:                                                                                 </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71         mCancelNum++;                                                                                    </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72         if (isCancel()) {                                                                                </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73           ALog.d(TAG, &quot;icCancel&quot;);                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74           mListener.onCancel();                                                                          </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77         break;                                                                                           </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78       case STATE_FAIL:                                                                                   </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79         mFailNum++;                                                                                      </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80         if (isFail()) {                                                                                  </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81           Bundle b = msg.getData();                                                                      </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82           mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83               (BaseException) b.getSerializable(KEY_ERROR_INFO));                                        </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86         break;                                                                                           </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       case STATE_COMPLETE:                                                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88         mCompleteNum++;                                                                                  </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89         if (isComplete()) {                                                                              </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90           ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                      </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91           if (mTaskRecord.isBlock) {                                                                     </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92             if (mergeFile()) {                                                                           </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93               mListener.onComplete();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94             } else {                                                                                     </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95               mListener.onFail(false, null);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97           } else {                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98             mListener.onComplete();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99           }                                                                                              </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         break;                                                                                           </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103       case STATE_RUNNING:                                                                                </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         mProgress += (long) msg.obj;                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105         break;                                                                                           </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106       case STATE_UPDATE_PROGRESS:                                                                        </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107         if (msg.obj == null) {                                                                           </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108           mProgress = updateBlockProgress();                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109         } else {                                                                                         </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110           mProgress = (long) msg.obj;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117   /**                                                                                                    </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118    * 退出looper循环                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119    */                                                                                                    </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120   private void quitLooper() {                                                                            </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121     mLooper.quit();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124   /**                                                                                                    </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125    * 获取当前任务下载进度                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126    *                                                                                                     </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127    * @return 当前任务下载进度                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129   @Override                                                                                              </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130   public long getCurrentProgress() {                                                                     </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131     return mProgress;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134   /**                                                                                                    </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135    * 所有子线程是否都已经停止                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137   @Override                                                                                              </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138   public boolean isStop() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139     //ALog.d(TAG,                                                                                        </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145   /**                                                                                                    </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146    * 所有子线程是否都已经失败                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148   @Override                                                                                              </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   public boolean isFail() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150     //ALog.d(TAG,                                                                                        </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151     //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153     return mCompleteNum != mThreadNum                                                                    </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154         &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157   /**                                                                                                    </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158    * 所有子线程是否都已经完成                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160   @Override                                                                                              </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161   public boolean isComplete() {                                                                          </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     //ALog.d(TAG,                                                                                        </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163     //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,          </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164     //        mStopNum,                                                                                  </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166     return mCompleteNum == mThreadNum;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169   /**                                                                                                    </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170    * 所有子线程是否都已经取消                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172   @Override                                                                                              </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 173 ||||||| BASE                                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 174 =======                                                                                                  </span>
<span class="7382497573847408965" onmouseenter="enter('7382497573847408965');" onmouseout="out('7382497573847408965');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 public class ThreadStateManager implements Handler.Callback {                                            </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176   private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                   </span>
<span class="-4011777087425911246" onmouseenter="enter('-4011777087425911246');" onmouseout="out('-4011777087425911246');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177   public static final int STATE_STOP = 0x01;                                                             </span>
<span class="-8785241425494592068" onmouseenter="enter('-8785241425494592068');" onmouseout="out('-8785241425494592068');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178   public static final int STATE_FAIL = 0x02;                                                             </span>
<span class="3183322182628493305" onmouseenter="enter('3183322182628493305');" onmouseout="out('3183322182628493305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179   public static final int STATE_CANCEL = 0x03;                                                           </span>
<span class="136738906973804026" onmouseenter="enter('136738906973804026');" onmouseout="out('136738906973804026');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180   public static final int STATE_COMPLETE = 0x04;                                                         </span>
<span class="-4958961754625055046" onmouseenter="enter('-4958961754625055046');" onmouseout="out('-4958961754625055046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181   public static final int STATE_RUNNING = 0x05;                                                          </span>
<span class="-9066142431873928680" onmouseenter="enter('-9066142431873928680');" onmouseout="out('-9066142431873928680');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182   public static final int STATE_UPDATE_PROGRESS = 0x06;                                                  </span>
<span class="-5254860985169932841" onmouseenter="enter('-5254860985169932841');" onmouseout="out('-5254860985169932841');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183   public static final String KEY_RETRY = &quot;KEY_RETRY&quot;;                                                    </span>
<span class="3671907362671705317" onmouseenter="enter('3671907362671705317');" onmouseout="out('3671907362671705317');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184   public static final String KEY_ERROR_INFO = &quot;KEY_ERROR_INFO&quot;;                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186   /**                                                                                                    </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187    * 任务状态回调                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188    */                                                                                                    </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189   private IEventListener mListener;                                                                      </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190   private int mThreadNum;    // 启动的线程总数                                                                  </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191   private int mCancelNum = 0; // 已经取消的线程的数                                                               </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192   private int mStopNum = 0;  // 已经停止的线程数                                                                 </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193   private int mFailNum = 0;  // 失败的线程数                                                                   </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194   private int mCompleteNum = 0;  // 完成的线程数                                                               </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195   private long mProgress; //当前总进度                                                                        </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196   private TaskRecord mTaskRecord; // 任务记录                                                                </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197   private Looper mLooper;                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199   /**                                                                                                    </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200    * @param taskRecord 任务记录                                                                              </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201    * @param listener 任务事件                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202    */                                                                                                    </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203   ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                    </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204     mLooper = looper;                                                                                    </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205     mTaskRecord = taskRecord;                                                                            </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206     mThreadNum = mTaskRecord.threadNum;                                                                  </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                                                                                                          </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210   @Override public boolean handleMessage(Message msg) {                                                  </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211     switch (msg.what) {                                                                                  </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212       case STATE_STOP:                                                                                   </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213         mStopNum++;                                                                                      </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214         if (isStop()) {                                                                                  </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215           mListener.onStop(mProgress);                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218         break;                                                                                           </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219       case STATE_CANCEL:                                                                                 </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220         mCancelNum++;                                                                                    </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221         if (isCancel()) {                                                                                </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222           ALog.d(TAG, &quot;icCancel&quot;);                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223           mListener.onCancel();                                                                          </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226         break;                                                                                           </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227       case STATE_FAIL:                                                                                   </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228         mFailNum++;                                                                                      </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229         if (isFail()) {                                                                                  </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230           Bundle b = msg.getData();                                                                      </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231           mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232               (BaseException) b.getSerializable(KEY_ERROR_INFO));                                        </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         break;                                                                                           </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236       case STATE_COMPLETE:                                                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237         mCompleteNum++;                                                                                  </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238         if (isComplete()) {                                                                              </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239           ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                      </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240           if (mTaskRecord.isBlock) {                                                                     </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241             if (mergeFile()) {                                                                           </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242               mListener.onComplete();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243             } else {                                                                                     </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244               mListener.onFail(false, null);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246           } else {                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247             mListener.onComplete();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248           }                                                                                              </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251         break;                                                                                           </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252       case STATE_RUNNING:                                                                                </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253         mProgress += (long) msg.obj;                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254         break;                                                                                           </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255       case STATE_UPDATE_PROGRESS:                                                                        </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256         if (msg.obj == null) {                                                                           </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257           mProgress = updateBlockProgress();                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258         } else {                                                                                         </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259           mProgress = (long) msg.obj;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266   /**                                                                                                    </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267    * 退出looper循环                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268    */                                                                                                    </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269   private void quitLooper() {                                                                            </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270     mLooper.quit();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273   /**                                                                                                    </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274    * 获取当前任务下载进度                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275    *                                                                                                     </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276    * @return 当前任务下载进度                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277    */                                                                                                    </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278   public long getCurrentProgress() {                                                                     </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279     return mProgress;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282   /**                                                                                                    </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283    * 所有子线程是否都已经停止                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284    */                                                                                                    </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285   public boolean isStop() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286     //ALog.d(TAG,                                                                                        </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287     //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289     return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292   /**                                                                                                    </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293    * 所有子线程是否都已经失败                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294    */                                                                                                    </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295   public boolean isFail() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296     //ALog.d(TAG,                                                                                        </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297     //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299     return mCompleteNum != mThreadNum                                                                    </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300         &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303   /**                                                                                                    </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304    * 所有子线程是否都已经完成                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305    */                                                                                                    </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306   public boolean isComplete() {                                                                          </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307     //ALog.d(TAG,                                                                                        </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308     //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,          </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309     //        mStopNum,                                                                                  </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311     return mCompleteNum == mThreadNum;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314   /**                                                                                                    </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315    * 所有子线程是否都已经取消                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316    */                                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 317 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="8880447242758016570" onmouseenter="enter('8880447242758016570');" onmouseout="out('8880447242758016570');" style=""> 318   public boolean isCancel() {                                                                            </span>
<span class="1778135252999196773" onmouseenter="enter('1778135252999196773');" onmouseout="out('1778135252999196773');" style=""> 319     //ALog.d(TAG, String.format(&quot;isCancel; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,    </span>
<span class="585222587359148719" onmouseenter="enter('585222587359148719');" onmouseout="out('585222587359148719');" style=""> 320     //    mStopNum,                                                                                      </span>
<span class="-2574532893522119459" onmouseenter="enter('-2574532893522119459');" onmouseout="out('-2574532893522119459');" style=""> 321     //    mCancelNum, mFailNum, mCompleteNum));                                                          </span>
<span class="-6123881945738795052" onmouseenter="enter('-6123881945738795052');" onmouseout="out('-6123881945738795052');" style=""> 322     return mCancelNum == mThreadNum;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323   }                                                                                                      </span>
<span  style=""> 324                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 325   /**                                                                                                    </span>
<span class="-6722905692252086257" onmouseenter="enter('-6722905692252086257');" onmouseout="out('-6722905692252086257');" style=""> 326    * 更新分块任务s的真实进度                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 327    */                                                                                                    </span>
<span class="4495633950832895741" onmouseenter="enter('4495633950832895741');" onmouseout="out('4495633950832895741');" style=""> 328   private long updateBlockProgress() {                                                                   </span>
<span class="642216204902078772" onmouseenter="enter('642216204902078772');" onmouseout="out('642216204902078772');" style=""> 329     long size = 0;                                                                                       </span>
<span class="4208836096360237149" onmouseenter="enter('4208836096360237149');" onmouseout="out('4208836096360237149');" style=""> 330     for (int i = 0, len = mTaskRecord.threadRecords.size(); i &lt; len; i++) {                              </span>
<span class="851601071059154606" onmouseenter="enter('851601071059154606');" onmouseout="out('851601071059154606');" style=""> 331       File temp = new File(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));              </span>
<span class="7100992962921282764" onmouseenter="enter('7100992962921282764');" onmouseout="out('7100992962921282764');" style=""> 332       if (temp.exists()) {                                                                               </span>
<span class="9105498611704012504" onmouseenter="enter('9105498611704012504');" onmouseout="out('9105498611704012504');" style=""> 333         size += temp.length();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335     }                                                                                                    </span>
<span class="7808415022879232995" onmouseenter="enter('7808415022879232995');" onmouseout="out('7808415022879232995');" style=""> 336     return size;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337   }                                                                                                      </span>
<span  style=""> 338                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 339   /**                                                                                                    </span>
<span class="-8362313205067342402" onmouseenter="enter('-8362313205067342402');" onmouseout="out('-8362313205067342402');" style=""> 340    * 合并文件                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 341    *                                                                                                     </span>
<span class="7152954986304769445" onmouseenter="enter('7152954986304769445');" onmouseout="out('7152954986304769445');" style=""> 342    * @return {@code true} 合并成功，{@code false}合并失败                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 343    */                                                                                                    </span>
<span class="-8404487487663192466" onmouseenter="enter('-8404487487663192466');" onmouseout="out('-8404487487663192466');" style=""> 344   private boolean mergeFile() {                                                                          </span>
<span class="7604758579765859822" onmouseenter="enter('7604758579765859822');" onmouseout="out('7604758579765859822');" style=""> 345     List&lt;String&gt; partPath = new ArrayList&lt;&gt;();                                                           </span>
<span class="4509036467004247563" onmouseenter="enter('4509036467004247563');" onmouseout="out('4509036467004247563');" style=""> 346     for (int i = 0, len = mTaskRecord.threadNum; i &lt; len; i++) {                                         </span>
<span class="9214251752076948430" onmouseenter="enter('9214251752076948430');" onmouseout="out('9214251752076948430');" style=""> 347       partPath.add(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348     }                                                                                                    </span>
<span class="2318178634808216853" onmouseenter="enter('2318178634808216853');" onmouseout="out('2318178634808216853');" style=""> 349     boolean isSuccess = FileUtil.mergeFile(mTaskRecord.filePath, partPath);                              </span>
<span class="155883027282181251" onmouseenter="enter('155883027282181251');" onmouseout="out('155883027282181251');" style=""> 350     if (isSuccess) {                                                                                     </span>
<span class="-8585313318236954494" onmouseenter="enter('-8585313318236954494');" onmouseout="out('-8585313318236954494');" style=""> 351       for (String pp : partPath) {                                                                       </span>
<span class="528717567100361765" onmouseenter="enter('528717567100361765');" onmouseout="out('528717567100361765');" style=""> 352         File f = new File(pp);                                                                           </span>
<span class="8226260359634022247" onmouseenter="enter('8226260359634022247');" onmouseout="out('8226260359634022247');" style=""> 353         if (f.exists()) {                                                                                </span>
<span class="7682989536937550366" onmouseenter="enter('7682989536937550366');" onmouseout="out('7682989536937550366');" style=""> 354           f.delete();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356       }                                                                                                  </span>
<span class="-5771808859074364721" onmouseenter="enter('-5771808859074364721');" onmouseout="out('-5771808859074364721');" style=""> 357       File targetFile = new File(mTaskRecord.filePath);                                                  </span>
<span class="-6816706015681170049" onmouseenter="enter('-6816706015681170049');" onmouseout="out('-6816706015681170049');" style=""> 358       if (targetFile.exists() &amp;&amp; targetFile.length() &gt; mTaskRecord.fileLength) {                         </span>
<span class="-2471360084270286815" onmouseenter="enter('-2471360084270286815');" onmouseout="out('-2471360084270286815');" style=""> 359         ALog.e(TAG, String.format(&quot;任务【%s】分块文件合并失败，下载长度超出文件真实长度，downloadLen: %s，fileSize: %s&quot;,            </span>
<span class="5883350204200555923" onmouseenter="enter('5883350204200555923');" onmouseout="out('5883350204200555923');" style=""> 360             targetFile.getName(), targetFile.length(), mTaskRecord.fileLength));                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 361         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362       }                                                                                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 363       return true;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 364     } else {                                                                                             </span>
<span class="5288275421299303387" onmouseenter="enter('5288275421299303387');" onmouseout="out('5288275421299303387');" style=""> 365       ALog.e(TAG, &quot;合并失败&quot;);                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 366       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369 }                                                                                                        </span>
</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  18 import android.os.Bundle;                                                                                </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  20 import android.os.Looper;                                                                                </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="">  21 import android.os.Message;                                                                               </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  22 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  23 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  24 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="">  25 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  26 import java.io.File;                                                                                     </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  27 import java.util.ArrayList;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  28 import java.util.List;                                                                                   </span>
<span  style="">  29                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30 /**                                                                                                      </span>
<span class="1158812768732845715" onmouseenter="enter('1158812768732845715');" onmouseout="out('1158812768732845715');" style="">  31  * 线程任务管理器，用于处理多线程下载时任务的状态回调                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  32  */                                                                                                      </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  33 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-4299899579438689924" onmouseenter="enter('-4299899579438689924');" onmouseout="out('-4299899579438689924');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 public class ThreadStateManager implements IThreadState {                                                </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35   private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37   /**                                                                                                    </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38    * 任务状态回调                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39    */                                                                                                    </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   private IEventListener mListener;                                                                      </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   private int mThreadNum;    // 启动的线程总数                                                                  </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42   private int mCancelNum = 0; // 已经取消的线程的数                                                               </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43   private int mStopNum = 0;  // 已经停止的线程数                                                                 </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private int mFailNum = 0;  // 失败的线程数                                                                   </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   private int mCompleteNum = 0;  // 完成的线程数                                                               </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private long mProgress; //当前总进度                                                                        </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private TaskRecord mTaskRecord; // 任务记录                                                                </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   private Looper mLooper;                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   /**                                                                                                    </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51    * @param taskRecord 任务记录                                                                              </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52    * @param listener 任务事件                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53    */                                                                                                    </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                    </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55     mLooper = looper;                                                                                    </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56     mTaskRecord = taskRecord;                                                                            </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57     mThreadNum = mTaskRecord.threadNum;                                                                  </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60                                                                                                          </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   @Override public boolean handleMessage(Message msg) {                                                  </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62     switch (msg.what) {                                                                                  </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63       case STATE_STOP:                                                                                   </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64         mStopNum++;                                                                                      </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65         if (isStop()) {                                                                                  </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66           mListener.onStop(mProgress);                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69         break;                                                                                           </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70       case STATE_CANCEL:                                                                                 </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71         mCancelNum++;                                                                                    </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72         if (isCancel()) {                                                                                </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73           ALog.d(TAG, &quot;icCancel&quot;);                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74           mListener.onCancel();                                                                          </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77         break;                                                                                           </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78       case STATE_FAIL:                                                                                   </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79         mFailNum++;                                                                                      </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80         if (isFail()) {                                                                                  </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81           Bundle b = msg.getData();                                                                      </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82           mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83               (BaseException) b.getSerializable(KEY_ERROR_INFO));                                        </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86         break;                                                                                           </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       case STATE_COMPLETE:                                                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88         mCompleteNum++;                                                                                  </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89         if (isComplete()) {                                                                              </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90           ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                      </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91           if (mTaskRecord.isBlock) {                                                                     </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92             if (mergeFile()) {                                                                           </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93               mListener.onComplete();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94             } else {                                                                                     </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95               mListener.onFail(false, null);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97           } else {                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98             mListener.onComplete();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99           }                                                                                              </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         break;                                                                                           </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103       case STATE_RUNNING:                                                                                </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         mProgress += (long) msg.obj;                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105         break;                                                                                           </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106       case STATE_UPDATE_PROGRESS:                                                                        </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107         if (msg.obj == null) {                                                                           </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108           mProgress = updateBlockProgress();                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109         } else {                                                                                         </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110           mProgress = (long) msg.obj;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117   /**                                                                                                    </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118    * 退出looper循环                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119    */                                                                                                    </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120   private void quitLooper() {                                                                            </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121     mLooper.quit();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124   /**                                                                                                    </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125    * 获取当前任务下载进度                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126    *                                                                                                     </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127    * @return 当前任务下载进度                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129   @Override                                                                                              </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130   public long getCurrentProgress() {                                                                     </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131     return mProgress;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134   /**                                                                                                    </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135    * 所有子线程是否都已经停止                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137   @Override                                                                                              </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138   public boolean isStop() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139     //ALog.d(TAG,                                                                                        </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145   /**                                                                                                    </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146    * 所有子线程是否都已经失败                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148   @Override                                                                                              </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   public boolean isFail() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150     //ALog.d(TAG,                                                                                        </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151     //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153     return mCompleteNum != mThreadNum                                                                    </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154         &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157   /**                                                                                                    </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158    * 所有子线程是否都已经完成                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160   @Override                                                                                              </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161   public boolean isComplete() {                                                                          </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     //ALog.d(TAG,                                                                                        </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163     //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,          </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164     //        mStopNum,                                                                                  </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166     return mCompleteNum == mThreadNum;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169   /**                                                                                                    </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170    * 所有子线程是否都已经取消                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171    */                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172   @Override                                                                                              </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 173 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 174 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 174 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 175 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176                                                                                                          </span>
<span class="7382497573847408965" onmouseenter="enter('7382497573847408965');" onmouseout="out('7382497573847408965');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177 public class ThreadStateManager implements Handler.Callback {                                            </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178   private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                   </span>
<span class="-4011777087425911246" onmouseenter="enter('-4011777087425911246');" onmouseout="out('-4011777087425911246');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179   public static final int STATE_STOP = 0x01;                                                             </span>
<span class="-8785241425494592068" onmouseenter="enter('-8785241425494592068');" onmouseout="out('-8785241425494592068');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180   public static final int STATE_FAIL = 0x02;                                                             </span>
<span class="3183322182628493305" onmouseenter="enter('3183322182628493305');" onmouseout="out('3183322182628493305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181   public static final int STATE_CANCEL = 0x03;                                                           </span>
<span class="136738906973804026" onmouseenter="enter('136738906973804026');" onmouseout="out('136738906973804026');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182   public static final int STATE_COMPLETE = 0x04;                                                         </span>
<span class="-4958961754625055046" onmouseenter="enter('-4958961754625055046');" onmouseout="out('-4958961754625055046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183   public static final int STATE_RUNNING = 0x05;                                                          </span>
<span class="-9066142431873928680" onmouseenter="enter('-9066142431873928680');" onmouseout="out('-9066142431873928680');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184   public static final int STATE_UPDATE_PROGRESS = 0x06;                                                  </span>
<span class="-5254860985169932841" onmouseenter="enter('-5254860985169932841');" onmouseout="out('-5254860985169932841');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185   public static final String KEY_RETRY = &quot;KEY_RETRY&quot;;                                                    </span>
<span class="3671907362671705317" onmouseenter="enter('3671907362671705317');" onmouseout="out('3671907362671705317');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186   public static final String KEY_ERROR_INFO = &quot;KEY_ERROR_INFO&quot;;                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188   /**                                                                                                    </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189    * 任务状态回调                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190    */                                                                                                    </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191   private IEventListener mListener;                                                                      </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192   private int mThreadNum;    // 启动的线程总数                                                                  </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193   private int mCancelNum = 0; // 已经取消的线程的数                                                               </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194   private int mStopNum = 0;  // 已经停止的线程数                                                                 </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195   private int mFailNum = 0;  // 失败的线程数                                                                   </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196   private int mCompleteNum = 0;  // 完成的线程数                                                               </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197   private long mProgress; //当前总进度                                                                        </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198   private TaskRecord mTaskRecord; // 任务记录                                                                </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199   private Looper mLooper;                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201   /**                                                                                                    </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202    * @param taskRecord 任务记录                                                                              </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203    * @param listener 任务事件                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204    */                                                                                                    </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205   ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                    </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206     mLooper = looper;                                                                                    </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207     mTaskRecord = taskRecord;                                                                            </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208     mThreadNum = mTaskRecord.threadNum;                                                                  </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211                                                                                                          </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212   @Override public boolean handleMessage(Message msg) {                                                  </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213     switch (msg.what) {                                                                                  </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214       case STATE_STOP:                                                                                   </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215         mStopNum++;                                                                                      </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216         if (isStop()) {                                                                                  </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217           mListener.onStop(mProgress);                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220         break;                                                                                           </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221       case STATE_CANCEL:                                                                                 </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222         mCancelNum++;                                                                                    </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223         if (isCancel()) {                                                                                </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224           ALog.d(TAG, &quot;icCancel&quot;);                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225           mListener.onCancel();                                                                          </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228         break;                                                                                           </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229       case STATE_FAIL:                                                                                   </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230         mFailNum++;                                                                                      </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231         if (isFail()) {                                                                                  </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232           Bundle b = msg.getData();                                                                      </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233           mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234               (BaseException) b.getSerializable(KEY_ERROR_INFO));                                        </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237         break;                                                                                           </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238       case STATE_COMPLETE:                                                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239         mCompleteNum++;                                                                                  </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240         if (isComplete()) {                                                                              </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241           ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                      </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242           if (mTaskRecord.isBlock) {                                                                     </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243             if (mergeFile()) {                                                                           </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244               mListener.onComplete();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245             } else {                                                                                     </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246               mListener.onFail(false, null);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248           } else {                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249             mListener.onComplete();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250           }                                                                                              </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251           quitLooper();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253         break;                                                                                           </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254       case STATE_RUNNING:                                                                                </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255         mProgress += (long) msg.obj;                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256         break;                                                                                           </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257       case STATE_UPDATE_PROGRESS:                                                                        </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258         if (msg.obj == null) {                                                                           </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259           mProgress = updateBlockProgress();                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260         } else {                                                                                         </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261           mProgress = (long) msg.obj;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262         }                                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268   /**                                                                                                    </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269    * 退出looper循环                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270    */                                                                                                    </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271   private void quitLooper() {                                                                            </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272     mLooper.quit();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275   /**                                                                                                    </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276    * 获取当前任务下载进度                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277    *                                                                                                     </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278    * @return 当前任务下载进度                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279    */                                                                                                    </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280   public long getCurrentProgress() {                                                                     </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281     return mProgress;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284   /**                                                                                                    </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285    * 所有子线程是否都已经停止                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286    */                                                                                                    </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287   public boolean isStop() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     //ALog.d(TAG,                                                                                        </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289     //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291     return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294   /**                                                                                                    </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295    * 所有子线程是否都已经失败                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296    */                                                                                                    </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297   public boolean isFail() {                                                                              </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298     //ALog.d(TAG,                                                                                        </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299     //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,    </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301     return mCompleteNum != mThreadNum                                                                    </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302         &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305   /**                                                                                                    </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306    * 所有子线程是否都已经完成                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307    */                                                                                                    </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308   public boolean isComplete() {                                                                          </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309     //ALog.d(TAG,                                                                                        </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310     //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,          </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311     //        mStopNum,                                                                                  </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312     //        mCancelNum, mFailNum, mCompleteNum));                                                      </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313     return mCompleteNum == mThreadNum;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316   /**                                                                                                    </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317    * 所有子线程是否都已经取消                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318    */                                                                                                    </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 319 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="8880447242758016570" onmouseenter="enter('8880447242758016570');" onmouseout="out('8880447242758016570');" style=""> 320   public boolean isCancel() {                                                                            </span>
<span class="1778135252999196773" onmouseenter="enter('1778135252999196773');" onmouseout="out('1778135252999196773');" style=""> 321     //ALog.d(TAG, String.format(&quot;isCancel; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,    </span>
<span class="585222587359148719" onmouseenter="enter('585222587359148719');" onmouseout="out('585222587359148719');" style=""> 322     //    mStopNum,                                                                                      </span>
<span class="-2574532893522119459" onmouseenter="enter('-2574532893522119459');" onmouseout="out('-2574532893522119459');" style=""> 323     //    mCancelNum, mFailNum, mCompleteNum));                                                          </span>
<span class="-6123881945738795052" onmouseenter="enter('-6123881945738795052');" onmouseout="out('-6123881945738795052');" style=""> 324     return mCancelNum == mThreadNum;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325   }                                                                                                      </span>
<span  style=""> 326                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 327   /**                                                                                                    </span>
<span class="-6722905692252086257" onmouseenter="enter('-6722905692252086257');" onmouseout="out('-6722905692252086257');" style=""> 328    * 更新分块任务s的真实进度                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 329    */                                                                                                    </span>
<span class="4495633950832895741" onmouseenter="enter('4495633950832895741');" onmouseout="out('4495633950832895741');" style=""> 330   private long updateBlockProgress() {                                                                   </span>
<span class="642216204902078772" onmouseenter="enter('642216204902078772');" onmouseout="out('642216204902078772');" style=""> 331     long size = 0;                                                                                       </span>
<span class="4208836096360237149" onmouseenter="enter('4208836096360237149');" onmouseout="out('4208836096360237149');" style=""> 332     for (int i = 0, len = mTaskRecord.threadRecords.size(); i &lt; len; i++) {                              </span>
<span class="851601071059154606" onmouseenter="enter('851601071059154606');" onmouseout="out('851601071059154606');" style=""> 333       File temp = new File(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));              </span>
<span class="7100992962921282764" onmouseenter="enter('7100992962921282764');" onmouseout="out('7100992962921282764');" style=""> 334       if (temp.exists()) {                                                                               </span>
<span class="9105498611704012504" onmouseenter="enter('9105498611704012504');" onmouseout="out('9105498611704012504');" style=""> 335         size += temp.length();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337     }                                                                                                    </span>
<span class="7808415022879232995" onmouseenter="enter('7808415022879232995');" onmouseout="out('7808415022879232995');" style=""> 338     return size;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339   }                                                                                                      </span>
<span  style=""> 340                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 341   /**                                                                                                    </span>
<span class="-8362313205067342402" onmouseenter="enter('-8362313205067342402');" onmouseout="out('-8362313205067342402');" style=""> 342    * 合并文件                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 343    *                                                                                                     </span>
<span class="7152954986304769445" onmouseenter="enter('7152954986304769445');" onmouseout="out('7152954986304769445');" style=""> 344    * @return {@code true} 合并成功，{@code false}合并失败                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 345    */                                                                                                    </span>
<span class="-8404487487663192466" onmouseenter="enter('-8404487487663192466');" onmouseout="out('-8404487487663192466');" style=""> 346   private boolean mergeFile() {                                                                          </span>
<span class="7604758579765859822" onmouseenter="enter('7604758579765859822');" onmouseout="out('7604758579765859822');" style=""> 347     List&lt;String&gt; partPath = new ArrayList&lt;&gt;();                                                           </span>
<span class="4509036467004247563" onmouseenter="enter('4509036467004247563');" onmouseout="out('4509036467004247563');" style=""> 348     for (int i = 0, len = mTaskRecord.threadNum; i &lt; len; i++) {                                         </span>
<span class="9214251752076948430" onmouseenter="enter('9214251752076948430');" onmouseout="out('9214251752076948430');" style=""> 349       partPath.add(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350     }                                                                                                    </span>
<span class="2318178634808216853" onmouseenter="enter('2318178634808216853');" onmouseout="out('2318178634808216853');" style=""> 351     boolean isSuccess = FileUtil.mergeFile(mTaskRecord.filePath, partPath);                              </span>
<span class="155883027282181251" onmouseenter="enter('155883027282181251');" onmouseout="out('155883027282181251');" style=""> 352     if (isSuccess) {                                                                                     </span>
<span class="-8585313318236954494" onmouseenter="enter('-8585313318236954494');" onmouseout="out('-8585313318236954494');" style=""> 353       for (String pp : partPath) {                                                                       </span>
<span class="528717567100361765" onmouseenter="enter('528717567100361765');" onmouseout="out('528717567100361765');" style=""> 354         File f = new File(pp);                                                                           </span>
<span class="8226260359634022247" onmouseenter="enter('8226260359634022247');" onmouseout="out('8226260359634022247');" style=""> 355         if (f.exists()) {                                                                                </span>
<span class="7682989536937550366" onmouseenter="enter('7682989536937550366');" onmouseout="out('7682989536937550366');" style=""> 356           f.delete();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358       }                                                                                                  </span>
<span class="-5771808859074364721" onmouseenter="enter('-5771808859074364721');" onmouseout="out('-5771808859074364721');" style=""> 359       File targetFile = new File(mTaskRecord.filePath);                                                  </span>
<span class="-6816706015681170049" onmouseenter="enter('-6816706015681170049');" onmouseout="out('-6816706015681170049');" style=""> 360       if (targetFile.exists() &amp;&amp; targetFile.length() &gt; mTaskRecord.fileLength) {                         </span>
<span class="-2471360084270286815" onmouseenter="enter('-2471360084270286815');" onmouseout="out('-2471360084270286815');" style=""> 361         ALog.e(TAG, String.format(&quot;任务【%s】分块文件合并失败，下载长度超出文件真实长度，downloadLen: %s，fileSize: %s&quot;,            </span>
<span class="5883350204200555923" onmouseenter="enter('5883350204200555923');" onmouseout="out('5883350204200555923');" style=""> 362             targetFile.getName(), targetFile.length(), mTaskRecord.fileLength));                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 363         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364       }                                                                                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 365       return true;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 366     } else {                                                                                             </span>
<span class="5288275421299303387" onmouseenter="enter('5288275421299303387');" onmouseout="out('5288275421299303387');" style=""> 367       ALog.e(TAG, &quot;合并失败&quot;);                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 368       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371 }                                                                                                        </span></pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   1 +/*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   2 + * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   3 + *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   4 + * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   5 + * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   6 + * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   7 + *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   8 + *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   9 + *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 + * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  11 + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  12 + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  13 + * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  14 + * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  15 + */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  16 +package com.arialyy.aria.core.common;                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  17 +                                                                                                                  </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  18 +import android.os.Bundle;                                                                                         </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import android.os.Handler;                                                                                        </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import android.os.Looper;                                                                                         </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import android.os.Message;                                                                                        </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import com.arialyy.aria.exception.BaseException;                                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  25 +import com.arialyy.aria.util.FileUtil;                                                                            </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import java.util.ArrayList;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import java.util.List;                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +/**                                                                                                               </span>
<span class="1158812768732845715" onmouseenter="enter('1158812768732845715');" onmouseout="out('1158812768732845715');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 + * 线程任务管理器，用于处理多线程下载时任务的状态回调                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 + */                                                                                                               </span>
<span class="-4299899579438689924" onmouseenter="enter('-4299899579438689924');" onmouseout="out('-4299899579438689924');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +public class ThreadStateManager implements IThreadState {                                                         </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  34 +  private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +  /**                                                                                                             </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +   * 任务状态回调                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +   */                                                                                                             </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +  private IEventListener mListener;                                                                               </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +  private int mThreadNum;    // 启动的线程总数                                                                           </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +  private int mCancelNum = 0; // 已经取消的线程的数                                                                        </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +  private int mStopNum = 0;  // 已经停止的线程数                                                                          </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +  private int mFailNum = 0;  // 失败的线程数                                                                            </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +  private int mCompleteNum = 0;  // 完成的线程数                                                                        </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +  private long mProgress; //当前总进度                                                                                 </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +  private TaskRecord mTaskRecord; // 任务记录                                                                         </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +  private Looper mLooper;                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +  /**                                                                                                             </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +   * @param taskRecord 任务记录                                                                                       </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +   * @param listener 任务事件                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +   */                                                                                                             </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +  ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                             </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +    mLooper = looper;                                                                                             </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +    mTaskRecord = taskRecord;                                                                                     </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +    mThreadNum = mTaskRecord.threadNum;                                                                           </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +    mListener = listener;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +                                                                                                                  </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +  @Override public boolean handleMessage(Message msg) {                                                           </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +    switch (msg.what) {                                                                                           </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +      case STATE_STOP:                                                                                            </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +        mStopNum++;                                                                                               </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +        if (isStop()) {                                                                                           </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +          mListener.onStop(mProgress);                                                                            </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +        break;                                                                                                    </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +      case STATE_CANCEL:                                                                                          </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +        mCancelNum++;                                                                                             </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +        if (isCancel()) {                                                                                         </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +          ALog.d(TAG, &quot;icCancel&quot;);                                                                                </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +          mListener.onCancel();                                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +        break;                                                                                                    </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +      case STATE_FAIL:                                                                                            </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  78 +        mFailNum++;                                                                                               </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +        if (isFail()) {                                                                                           </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +          Bundle b = msg.getData();                                                                               </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +          mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                         </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +              (BaseException) b.getSerializable(KEY_ERROR_INFO));                                                 </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +        break;                                                                                                    </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +      case STATE_COMPLETE:                                                                                        </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +        mCompleteNum++;                                                                                           </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +        if (isComplete()) {                                                                                       </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +          ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                               </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +          if (mTaskRecord.isBlock) {                                                                              </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +            if (mergeFile()) {                                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +              mListener.onComplete();                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +            } else {                                                                                              </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +              mListener.onFail(false, null);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +            }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +          } else {                                                                                                </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +            mListener.onComplete();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +          }                                                                                                       </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +        break;                                                                                                    </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +      case STATE_RUNNING:                                                                                         </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +        mProgress += (long) msg.obj;                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +        break;                                                                                                    </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +      case STATE_UPDATE_PROGRESS:                                                                                 </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +        if (msg.obj == null) {                                                                                    </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +          mProgress = updateBlockProgress();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +        } else {                                                                                                  </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +          mProgress = (long) msg.obj;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +        break;                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +    }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +    return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +  /**                                                                                                             </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +   * 退出looper循环                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +   */                                                                                                             </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +  private void quitLooper() {                                                                                     </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +    mLooper.quit();                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +  /**                                                                                                             </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +   * 获取当前任务下载进度                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +   *                                                                                                              </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +   * @return 当前任务下载进度                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +   */                                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +  @Override                                                                                                       </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +  public long getCurrentProgress() {                                                                              </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +    return mProgress;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +  /**                                                                                                             </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +   * 所有子线程是否都已经停止                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +   */                                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +  @Override                                                                                                       </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +  public boolean isStop() {                                                                                       </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +    //ALog.d(TAG,                                                                                                 </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +    //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,             </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +    //        mCancelNum, mFailNum, mCompleteNum));                                                               </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +    return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +  /**                                                                                                             </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +   * 所有子线程是否都已经失败                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +   */                                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +  @Override                                                                                                       </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +  public boolean isFail() {                                                                                       </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +    //ALog.d(TAG,                                                                                                 </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +    //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,             </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +    //        mCancelNum, mFailNum, mCompleteNum));                                                               </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +    return mCompleteNum != mThreadNum                                                                             </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +        &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +  /**                                                                                                             </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +   * 所有子线程是否都已经完成                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +   */                                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +  @Override                                                                                                       </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +  public boolean isComplete() {                                                                                   </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +    //ALog.d(TAG,                                                                                                 </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +    //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,                   </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +    //        mStopNum,                                                                                           </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +    //        mCancelNum, mFailNum, mCompleteNum));                                                               </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +    return mCompleteNum == mThreadNum;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +  /**                                                                                                             </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +   * 所有子线程是否都已经取消                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +   */                                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +  @Override                                                                                                       </span>
<span class="8880447242758016570" onmouseenter="enter('8880447242758016570');" onmouseout="out('8880447242758016570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +  public boolean isCancel() {                                                                                     </span>
<span class="1778135252999196773" onmouseenter="enter('1778135252999196773');" onmouseout="out('1778135252999196773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +    //ALog.d(TAG, String.format(&quot;isCancel; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,             </span>
<span class="585222587359148719" onmouseenter="enter('585222587359148719');" onmouseout="out('585222587359148719');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +    //    mStopNum,                                                                                               </span>
<span class="-2574532893522119459" onmouseenter="enter('-2574532893522119459');" onmouseout="out('-2574532893522119459');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +    //    mCancelNum, mFailNum, mCompleteNum));                                                                   </span>
<span class="-6123881945738795052" onmouseenter="enter('-6123881945738795052');" onmouseout="out('-6123881945738795052');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +    return mCancelNum == mThreadNum;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +  /**                                                                                                             </span>
<span class="-6722905692252086257" onmouseenter="enter('-6722905692252086257');" onmouseout="out('-6722905692252086257');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +   * 更新分块任务s的真实进度                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +   */                                                                                                             </span>
<span class="4495633950832895741" onmouseenter="enter('4495633950832895741');" onmouseout="out('4495633950832895741');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +  private long updateBlockProgress() {                                                                            </span>
<span class="642216204902078772" onmouseenter="enter('642216204902078772');" onmouseout="out('642216204902078772');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +    long size = 0;                                                                                                </span>
<span class="4208836096360237149" onmouseenter="enter('4208836096360237149');" onmouseout="out('4208836096360237149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +    for (int i = 0, len = mTaskRecord.threadRecords.size(); i &lt; len; i++) {                                       </span>
<span class="851601071059154606" onmouseenter="enter('851601071059154606');" onmouseout="out('851601071059154606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +      File temp = new File(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));                       </span>
<span class="7100992962921282764" onmouseenter="enter('7100992962921282764');" onmouseout="out('7100992962921282764');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +      if (temp.exists()) {                                                                                        </span>
<span class="9105498611704012504" onmouseenter="enter('9105498611704012504');" onmouseout="out('9105498611704012504');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +        size += temp.length();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +    }                                                                                                             </span>
<span class="7808415022879232995" onmouseenter="enter('7808415022879232995');" onmouseout="out('7808415022879232995');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +    return size;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +  /**                                                                                                             </span>
<span class="-8362313205067342402" onmouseenter="enter('-8362313205067342402');" onmouseout="out('-8362313205067342402');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +   * 合并文件                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +   *                                                                                                              </span>
<span class="7152954986304769445" onmouseenter="enter('7152954986304769445');" onmouseout="out('7152954986304769445');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +   * @return {@code true} 合并成功，{@code false}合并失败                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +   */                                                                                                             </span>
<span class="-8404487487663192466" onmouseenter="enter('-8404487487663192466');" onmouseout="out('-8404487487663192466');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +  private boolean mergeFile() {                                                                                   </span>
<span class="7604758579765859822" onmouseenter="enter('7604758579765859822');" onmouseout="out('7604758579765859822');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +    List&lt;String&gt; partPath = new ArrayList&lt;&gt;();                                                                    </span>
<span class="4509036467004247563" onmouseenter="enter('4509036467004247563');" onmouseout="out('4509036467004247563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +    for (int i = 0, len = mTaskRecord.threadNum; i &lt; len; i++) {                                                  </span>
<span class="9214251752076948430" onmouseenter="enter('9214251752076948430');" onmouseout="out('9214251752076948430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +      partPath.add(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +    }                                                                                                             </span>
<span class="2318178634808216853" onmouseenter="enter('2318178634808216853');" onmouseout="out('2318178634808216853');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +    boolean isSuccess = FileUtil.mergeFile(mTaskRecord.filePath, partPath);                                       </span>
<span class="155883027282181251" onmouseenter="enter('155883027282181251');" onmouseout="out('155883027282181251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +    if (isSuccess) {                                                                                              </span>
<span class="-8585313318236954494" onmouseenter="enter('-8585313318236954494');" onmouseout="out('-8585313318236954494');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +      for (String pp : partPath) {                                                                                </span>
<span class="528717567100361765" onmouseenter="enter('528717567100361765');" onmouseout="out('528717567100361765');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +        File f = new File(pp);                                                                                    </span>
<span class="8226260359634022247" onmouseenter="enter('8226260359634022247');" onmouseout="out('8226260359634022247');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +        if (f.exists()) {                                                                                         </span>
<span class="7682989536937550366" onmouseenter="enter('7682989536937550366');" onmouseout="out('7682989536937550366');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +          f.delete();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +      }                                                                                                           </span>
<span class="-5771808859074364721" onmouseenter="enter('-5771808859074364721');" onmouseout="out('-5771808859074364721');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +      File targetFile = new File(mTaskRecord.filePath);                                                           </span>
<span class="-6816706015681170049" onmouseenter="enter('-6816706015681170049');" onmouseout="out('-6816706015681170049');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +      if (targetFile.exists() &amp;&amp; targetFile.length() &gt; mTaskRecord.fileLength) {                                  </span>
<span class="-2471360084270286815" onmouseenter="enter('-2471360084270286815');" onmouseout="out('-2471360084270286815');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +        ALog.e(TAG, String.format(&quot;任务【%s】分块文件合并失败，下载长度超出文件真实长度，downloadLen: %s，fileSize: %s&quot;,                     </span>
<span class="5883350204200555923" onmouseenter="enter('5883350204200555923');" onmouseout="out('5883350204200555923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +            targetFile.getName(), targetFile.length(), mTaskRecord.fileLength));                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +        return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +      }                                                                                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +      return true;                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +    } else {                                                                                                      </span>
<span class="5288275421299303387" onmouseenter="enter('5288275421299303387');" onmouseout="out('5288275421299303387');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +      ALog.e(TAG, &quot;合并失败&quot;);                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +      return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +  }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +}                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   1 +/*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   2 + * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   3 + *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   4 + * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   5 + * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   6 + * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   7 + *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   8 + *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   9 + *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 + * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  11 + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  12 + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  13 + * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  14 + * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  15 + */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  16 +package com.arialyy.aria.core.common;                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  17 +                                                                                                                  </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  18 +import android.os.Bundle;                                                                                         </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import android.os.Handler;                                                                                        </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import android.os.Looper;                                                                                         </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import android.os.Message;                                                                                        </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import com.arialyy.aria.exception.BaseException;                                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  25 +import com.arialyy.aria.util.FileUtil;                                                                            </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import java.util.ArrayList;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import java.util.List;                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +/**                                                                                                               </span>
<span class="1158812768732845715" onmouseenter="enter('1158812768732845715');" onmouseout="out('1158812768732845715');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 + * 线程任务管理器，用于处理多线程下载时任务的状态回调                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 + */                                                                                                               </span>
<span class="7382497573847408965" onmouseenter="enter('7382497573847408965');" onmouseout="out('7382497573847408965');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +public class ThreadStateManager implements Handler.Callback {                                                     </span>
<span class="498386727397527410" onmouseenter="enter('498386727397527410');" onmouseout="out('498386727397527410');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  34 +  private final String TAG = &quot;ThreadTaskStateManager&quot;;                                                            </span>
<span class="-4011777087425911246" onmouseenter="enter('-4011777087425911246');" onmouseout="out('-4011777087425911246');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +  public static final int STATE_STOP = 0x01;                                                                      </span>
<span class="-8785241425494592068" onmouseenter="enter('-8785241425494592068');" onmouseout="out('-8785241425494592068');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +  public static final int STATE_FAIL = 0x02;                                                                      </span>
<span class="3183322182628493305" onmouseenter="enter('3183322182628493305');" onmouseout="out('3183322182628493305');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +  public static final int STATE_CANCEL = 0x03;                                                                    </span>
<span class="136738906973804026" onmouseenter="enter('136738906973804026');" onmouseout="out('136738906973804026');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +  public static final int STATE_COMPLETE = 0x04;                                                                  </span>
<span class="-4958961754625055046" onmouseenter="enter('-4958961754625055046');" onmouseout="out('-4958961754625055046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +  public static final int STATE_RUNNING = 0x05;                                                                   </span>
<span class="-9066142431873928680" onmouseenter="enter('-9066142431873928680');" onmouseout="out('-9066142431873928680');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +  public static final int STATE_UPDATE_PROGRESS = 0x06;                                                           </span>
<span class="-5254860985169932841" onmouseenter="enter('-5254860985169932841');" onmouseout="out('-5254860985169932841');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +  public static final String KEY_RETRY = &quot;KEY_RETRY&quot;;                                                             </span>
<span class="3671907362671705317" onmouseenter="enter('3671907362671705317');" onmouseout="out('3671907362671705317');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +  public static final String KEY_ERROR_INFO = &quot;KEY_ERROR_INFO&quot;;                                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +  /**                                                                                                             </span>
<span class="8518313547347686093" onmouseenter="enter('8518313547347686093');" onmouseout="out('8518313547347686093');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +   * 任务状态回调                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +   */                                                                                                             </span>
<span class="-5674697991512742080" onmouseenter="enter('-5674697991512742080');" onmouseout="out('-5674697991512742080');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +  private IEventListener mListener;                                                                               </span>
<span class="8093222136854244937" onmouseenter="enter('8093222136854244937');" onmouseout="out('8093222136854244937');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +  private int mThreadNum;    // 启动的线程总数                                                                           </span>
<span class="3581295022671496053" onmouseenter="enter('3581295022671496053');" onmouseout="out('3581295022671496053');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +  private int mCancelNum = 0; // 已经取消的线程的数                                                                        </span>
<span class="-1259145385369473467" onmouseenter="enter('-1259145385369473467');" onmouseout="out('-1259145385369473467');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +  private int mStopNum = 0;  // 已经停止的线程数                                                                          </span>
<span class="-6321616174795490088" onmouseenter="enter('-6321616174795490088');" onmouseout="out('-6321616174795490088');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +  private int mFailNum = 0;  // 失败的线程数                                                                            </span>
<span class="-8273751044026102486" onmouseenter="enter('-8273751044026102486');" onmouseout="out('-8273751044026102486');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +  private int mCompleteNum = 0;  // 完成的线程数                                                                        </span>
<span class="-2224420554977456554" onmouseenter="enter('-2224420554977456554');" onmouseout="out('-2224420554977456554');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +  private long mProgress; //当前总进度                                                                                 </span>
<span class="1693525481636270619" onmouseenter="enter('1693525481636270619');" onmouseout="out('1693525481636270619');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +  private TaskRecord mTaskRecord; // 任务记录                                                                         </span>
<span class="6876909852164793424" onmouseenter="enter('6876909852164793424');" onmouseout="out('6876909852164793424');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +  private Looper mLooper;                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +  /**                                                                                                             </span>
<span class="-2559535981202037441" onmouseenter="enter('-2559535981202037441');" onmouseout="out('-2559535981202037441');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +   * @param taskRecord 任务记录                                                                                       </span>
<span class="-5115014835242242538" onmouseenter="enter('-5115014835242242538');" onmouseout="out('-5115014835242242538');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +   * @param listener 任务事件                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +   */                                                                                                             </span>
<span class="964015358541166743" onmouseenter="enter('964015358541166743');" onmouseout="out('964015358541166743');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +  ThreadStateManager(Looper looper, TaskRecord taskRecord, IEventListener listener) {                             </span>
<span class="-3348701986099661748" onmouseenter="enter('-3348701986099661748');" onmouseout="out('-3348701986099661748');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +    mLooper = looper;                                                                                             </span>
<span class="179929869096974253" onmouseenter="enter('179929869096974253');" onmouseout="out('179929869096974253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +    mTaskRecord = taskRecord;                                                                                     </span>
<span class="6805071345168731865" onmouseenter="enter('6805071345168731865');" onmouseout="out('6805071345168731865');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +    mThreadNum = mTaskRecord.threadNum;                                                                           </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +    mListener = listener;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +                                                                                                                  </span>
<span class="-5093355790655318910" onmouseenter="enter('-5093355790655318910');" onmouseout="out('-5093355790655318910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +  @Override public boolean handleMessage(Message msg) {                                                           </span>
<span class="-3954437576728056065" onmouseenter="enter('-3954437576728056065');" onmouseout="out('-3954437576728056065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    switch (msg.what) {                                                                                           </span>
<span class="487715538203928485" onmouseenter="enter('487715538203928485');" onmouseout="out('487715538203928485');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +      case STATE_STOP:                                                                                            </span>
<span class="4196237058675382101" onmouseenter="enter('4196237058675382101');" onmouseout="out('4196237058675382101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +        mStopNum++;                                                                                               </span>
<span class="-1338116248199186294" onmouseenter="enter('-1338116248199186294');" onmouseout="out('-1338116248199186294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +        if (isStop()) {                                                                                           </span>
<span class="-1404283741444999403" onmouseenter="enter('-1404283741444999403');" onmouseout="out('-1404283741444999403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +          mListener.onStop(mProgress);                                                                            </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +        break;                                                                                                    </span>
<span class="-1417397524055121145" onmouseenter="enter('-1417397524055121145');" onmouseout="out('-1417397524055121145');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +      case STATE_CANCEL:                                                                                          </span>
<span class="-2002457350329145900" onmouseenter="enter('-2002457350329145900');" onmouseout="out('-2002457350329145900');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  78 +        mCancelNum++;                                                                                             </span>
<span class="-7242251719713840059" onmouseenter="enter('-7242251719713840059');" onmouseout="out('-7242251719713840059');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +        if (isCancel()) {                                                                                         </span>
<span class="2347435638378746110" onmouseenter="enter('2347435638378746110');" onmouseout="out('2347435638378746110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +          ALog.d(TAG, &quot;icCancel&quot;);                                                                                </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +          mListener.onCancel();                                                                                   </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +        break;                                                                                                    </span>
<span class="5698464116197114718" onmouseenter="enter('5698464116197114718');" onmouseout="out('5698464116197114718');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +      case STATE_FAIL:                                                                                            </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +        mFailNum++;                                                                                               </span>
<span class="-195056491251171460" onmouseenter="enter('-195056491251171460');" onmouseout="out('-195056491251171460');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +        if (isFail()) {                                                                                           </span>
<span class="4757560943512463885" onmouseenter="enter('4757560943512463885');" onmouseout="out('4757560943512463885');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +          Bundle b = msg.getData();                                                                               </span>
<span class="-704544690115987523" onmouseenter="enter('-704544690115987523');" onmouseout="out('-704544690115987523');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +          mListener.onFail(b.getBoolean(KEY_RETRY, true),                                                         </span>
<span class="-4869880486659065855" onmouseenter="enter('-4869880486659065855');" onmouseout="out('-4869880486659065855');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +              (BaseException) b.getSerializable(KEY_ERROR_INFO));                                                 </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +        break;                                                                                                    </span>
<span class="-8597191506028275566" onmouseenter="enter('-8597191506028275566');" onmouseout="out('-8597191506028275566');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +      case STATE_COMPLETE:                                                                                        </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +        mCompleteNum++;                                                                                           </span>
<span class="-3428179039573606638" onmouseenter="enter('-3428179039573606638');" onmouseout="out('-3428179039573606638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +        if (isComplete()) {                                                                                       </span>
<span class="-4971725268584284481" onmouseenter="enter('-4971725268584284481');" onmouseout="out('-4971725268584284481');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +          ALog.d(TAG, &quot;isComplete, completeNum = &quot; + mCompleteNum);                                               </span>
<span class="-8293818910390681220" onmouseenter="enter('-8293818910390681220');" onmouseout="out('-8293818910390681220');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +          if (mTaskRecord.isBlock) {                                                                              </span>
<span class="-6726217048357975492" onmouseenter="enter('-6726217048357975492');" onmouseout="out('-6726217048357975492');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +            if (mergeFile()) {                                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +              mListener.onComplete();                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +            } else {                                                                                              </span>
<span class="-7283026629451739910" onmouseenter="enter('-7283026629451739910');" onmouseout="out('-7283026629451739910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +              mListener.onFail(false, null);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +            }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +          } else {                                                                                                </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +            mListener.onComplete();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +          }                                                                                                       </span>
<span class="-2604462709718649137" onmouseenter="enter('-2604462709718649137');" onmouseout="out('-2604462709718649137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +          quitLooper();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +        break;                                                                                                    </span>
<span class="5510734078234604611" onmouseenter="enter('5510734078234604611');" onmouseout="out('5510734078234604611');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +      case STATE_RUNNING:                                                                                         </span>
<span class="-3250383334248887916" onmouseenter="enter('-3250383334248887916');" onmouseout="out('-3250383334248887916');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +        mProgress += (long) msg.obj;                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +        break;                                                                                                    </span>
<span class="3996473805733569706" onmouseenter="enter('3996473805733569706');" onmouseout="out('3996473805733569706');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +      case STATE_UPDATE_PROGRESS:                                                                                 </span>
<span class="-1404942671889158034" onmouseenter="enter('-1404942671889158034');" onmouseout="out('-1404942671889158034');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +        if (msg.obj == null) {                                                                                    </span>
<span class="783965096281731753" onmouseenter="enter('783965096281731753');" onmouseout="out('783965096281731753');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +          mProgress = updateBlockProgress();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +        } else {                                                                                                  </span>
<span class="5461038201045329161" onmouseenter="enter('5461038201045329161');" onmouseout="out('5461038201045329161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +          mProgress = (long) msg.obj;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +        }                                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +        break;                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +    }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +    return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +  /**                                                                                                             </span>
<span class="-7662481936011924276" onmouseenter="enter('-7662481936011924276');" onmouseout="out('-7662481936011924276');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +   * 退出looper循环                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +   */                                                                                                             </span>
<span class="4689788053163118084" onmouseenter="enter('4689788053163118084');" onmouseout="out('4689788053163118084');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +  private void quitLooper() {                                                                                     </span>
<span class="-2451514488511652567" onmouseenter="enter('-2451514488511652567');" onmouseout="out('-2451514488511652567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +    mLooper.quit();                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +  /**                                                                                                             </span>
<span class="-7464860203792088340" onmouseenter="enter('-7464860203792088340');" onmouseout="out('-7464860203792088340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +   * 获取当前任务下载进度                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +   *                                                                                                              </span>
<span class="5283095628400562411" onmouseenter="enter('5283095628400562411');" onmouseout="out('5283095628400562411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +   * @return 当前任务下载进度                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +   */                                                                                                             </span>
<span class="2931491069463764081" onmouseenter="enter('2931491069463764081');" onmouseout="out('2931491069463764081');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +  public long getCurrentProgress() {                                                                              </span>
<span class="-7333812913803043505" onmouseenter="enter('-7333812913803043505');" onmouseout="out('-7333812913803043505');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +    return mProgress;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +  /**                                                                                                             </span>
<span class="-277114886890159250" onmouseenter="enter('-277114886890159250');" onmouseout="out('-277114886890159250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +   * 所有子线程是否都已经停止                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +   */                                                                                                             </span>
<span class="4944438898650073264" onmouseenter="enter('4944438898650073264');" onmouseout="out('4944438898650073264');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +  public boolean isStop() {                                                                                       </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +    //ALog.d(TAG,                                                                                                 </span>
<span class="4986255550832753904" onmouseenter="enter('4986255550832753904');" onmouseout="out('4986255550832753904');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +    //    String.format(&quot;isStop; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,             </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +    //        mCancelNum, mFailNum, mCompleteNum));                                                               </span>
<span class="-5587718265173227985" onmouseenter="enter('-5587718265173227985');" onmouseout="out('-5587718265173227985');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +    return mStopNum == mThreadNum || mStopNum + mCompleteNum == mThreadNum;                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +  /**                                                                                                             </span>
<span class="6261572269133096933" onmouseenter="enter('6261572269133096933');" onmouseout="out('6261572269133096933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +   * 所有子线程是否都已经失败                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +   */                                                                                                             </span>
<span class="-4864065369281096568" onmouseenter="enter('-4864065369281096568');" onmouseout="out('-4864065369281096568');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +  public boolean isFail() {                                                                                       </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +    //ALog.d(TAG,                                                                                                 </span>
<span class="-2108103394003312069" onmouseenter="enter('-2108103394003312069');" onmouseout="out('-2108103394003312069');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +    //    String.format(&quot;isFail; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;, mStopNum,             </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +    //        mCancelNum, mFailNum, mCompleteNum));                                                               </span>
<span class="663799529425265423" onmouseenter="enter('663799529425265423');" onmouseout="out('663799529425265423');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +    return mCompleteNum != mThreadNum                                                                             </span>
<span class="-8051763120909020669" onmouseenter="enter('-8051763120909020669');" onmouseout="out('-8051763120909020669');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +        &amp;&amp; (mFailNum == mThreadNum || mFailNum + mCompleteNum == mThreadNum);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +  /**                                                                                                             </span>
<span class="-5942338254696121413" onmouseenter="enter('-5942338254696121413');" onmouseout="out('-5942338254696121413');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +   * 所有子线程是否都已经完成                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +   */                                                                                                             </span>
<span class="-2117850453350785071" onmouseenter="enter('-2117850453350785071');" onmouseout="out('-2117850453350785071');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +  public boolean isComplete() {                                                                                   </span>
<span class="3733629166512145362" onmouseenter="enter('3733629166512145362');" onmouseout="out('3733629166512145362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +    //ALog.d(TAG,                                                                                                 </span>
<span class="445767475302200106" onmouseenter="enter('445767475302200106');" onmouseout="out('445767475302200106');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +    //    String.format(&quot;isComplete; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,                   </span>
<span class="7955437283523430887" onmouseenter="enter('7955437283523430887');" onmouseout="out('7955437283523430887');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +    //        mStopNum,                                                                                           </span>
<span class="-7962485656507193065" onmouseenter="enter('-7962485656507193065');" onmouseout="out('-7962485656507193065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +    //        mCancelNum, mFailNum, mCompleteNum));                                                               </span>
<span class="1258148616203399621" onmouseenter="enter('1258148616203399621');" onmouseout="out('1258148616203399621');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +    return mCompleteNum == mThreadNum;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +  /**                                                                                                             </span>
<span class="-6436073897298214564" onmouseenter="enter('-6436073897298214564');" onmouseout="out('-6436073897298214564');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +   * 所有子线程是否都已经取消                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +   */                                                                                                             </span>
<span class="8880447242758016570" onmouseenter="enter('8880447242758016570');" onmouseout="out('8880447242758016570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +  public boolean isCancel() {                                                                                     </span>
<span class="1778135252999196773" onmouseenter="enter('1778135252999196773');" onmouseout="out('1778135252999196773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +    //ALog.d(TAG, String.format(&quot;isCancel; stopNum: %s, cancelNum: %s, failNum: %s, completeNum: %s&quot;,             </span>
<span class="585222587359148719" onmouseenter="enter('585222587359148719');" onmouseout="out('585222587359148719');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +    //    mStopNum,                                                                                               </span>
<span class="-2574532893522119459" onmouseenter="enter('-2574532893522119459');" onmouseout="out('-2574532893522119459');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +    //    mCancelNum, mFailNum, mCompleteNum));                                                                   </span>
<span class="-6123881945738795052" onmouseenter="enter('-6123881945738795052');" onmouseout="out('-6123881945738795052');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +    return mCancelNum == mThreadNum;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +  /**                                                                                                             </span>
<span class="-6722905692252086257" onmouseenter="enter('-6722905692252086257');" onmouseout="out('-6722905692252086257');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +   * 更新分块任务s的真实进度                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +   */                                                                                                             </span>
<span class="4495633950832895741" onmouseenter="enter('4495633950832895741');" onmouseout="out('4495633950832895741');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +  private long updateBlockProgress() {                                                                            </span>
<span class="642216204902078772" onmouseenter="enter('642216204902078772');" onmouseout="out('642216204902078772');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +    long size = 0;                                                                                                </span>
<span class="4208836096360237149" onmouseenter="enter('4208836096360237149');" onmouseout="out('4208836096360237149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +    for (int i = 0, len = mTaskRecord.threadRecords.size(); i &lt; len; i++) {                                       </span>
<span class="851601071059154606" onmouseenter="enter('851601071059154606');" onmouseout="out('851601071059154606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +      File temp = new File(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));                       </span>
<span class="7100992962921282764" onmouseenter="enter('7100992962921282764');" onmouseout="out('7100992962921282764');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +      if (temp.exists()) {                                                                                        </span>
<span class="9105498611704012504" onmouseenter="enter('9105498611704012504');" onmouseout="out('9105498611704012504');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        size += temp.length();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +    }                                                                                                             </span>
<span class="7808415022879232995" onmouseenter="enter('7808415022879232995');" onmouseout="out('7808415022879232995');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +    return size;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +  /**                                                                                                             </span>
<span class="-8362313205067342402" onmouseenter="enter('-8362313205067342402');" onmouseout="out('-8362313205067342402');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +   * 合并文件                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +   *                                                                                                              </span>
<span class="7152954986304769445" onmouseenter="enter('7152954986304769445');" onmouseout="out('7152954986304769445');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +   * @return {@code true} 合并成功，{@code false}合并失败                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +   */                                                                                                             </span>
<span class="-8404487487663192466" onmouseenter="enter('-8404487487663192466');" onmouseout="out('-8404487487663192466');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +  private boolean mergeFile() {                                                                                   </span>
<span class="7604758579765859822" onmouseenter="enter('7604758579765859822');" onmouseout="out('7604758579765859822');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +    List&lt;String&gt; partPath = new ArrayList&lt;&gt;();                                                                    </span>
<span class="4509036467004247563" onmouseenter="enter('4509036467004247563');" onmouseout="out('4509036467004247563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +    for (int i = 0, len = mTaskRecord.threadNum; i &lt; len; i++) {                                                  </span>
<span class="9214251752076948430" onmouseenter="enter('9214251752076948430');" onmouseout="out('9214251752076948430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +      partPath.add(String.format(RecordHandler.SUB_PATH, mTaskRecord.filePath, i));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +    }                                                                                                             </span>
<span class="2318178634808216853" onmouseenter="enter('2318178634808216853');" onmouseout="out('2318178634808216853');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +    boolean isSuccess = FileUtil.mergeFile(mTaskRecord.filePath, partPath);                                       </span>
<span class="155883027282181251" onmouseenter="enter('155883027282181251');" onmouseout="out('155883027282181251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +    if (isSuccess) {                                                                                              </span>
<span class="-8585313318236954494" onmouseenter="enter('-8585313318236954494');" onmouseout="out('-8585313318236954494');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +      for (String pp : partPath) {                                                                                </span>
<span class="528717567100361765" onmouseenter="enter('528717567100361765');" onmouseout="out('528717567100361765');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +        File f = new File(pp);                                                                                    </span>
<span class="8226260359634022247" onmouseenter="enter('8226260359634022247');" onmouseout="out('8226260359634022247');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +        if (f.exists()) {                                                                                         </span>
<span class="7682989536937550366" onmouseenter="enter('7682989536937550366');" onmouseout="out('7682989536937550366');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +          f.delete();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +      }                                                                                                           </span>
<span class="-5771808859074364721" onmouseenter="enter('-5771808859074364721');" onmouseout="out('-5771808859074364721');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +      File targetFile = new File(mTaskRecord.filePath);                                                           </span>
<span class="-6816706015681170049" onmouseenter="enter('-6816706015681170049');" onmouseout="out('-6816706015681170049');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +      if (targetFile.exists() &amp;&amp; targetFile.length() &gt; mTaskRecord.fileLength) {                                  </span>
<span class="-2471360084270286815" onmouseenter="enter('-2471360084270286815');" onmouseout="out('-2471360084270286815');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +        ALog.e(TAG, String.format(&quot;任务【%s】分块文件合并失败，下载长度超出文件真实长度，downloadLen: %s，fileSize: %s&quot;,                     </span>
<span class="5883350204200555923" onmouseenter="enter('5883350204200555923');" onmouseout="out('5883350204200555923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +            targetFile.getName(), targetFile.length(), mTaskRecord.fileLength));                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +        return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +      }                                                                                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +      return true;                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +    } else {                                                                                                      </span>
<span class="5288275421299303387" onmouseenter="enter('5288275421299303387');" onmouseout="out('5288275421299303387');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +      ALog.e(TAG, &quot;合并失败&quot;);                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +      return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +  }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +}                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            