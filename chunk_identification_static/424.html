<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>424</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    424
                    <a href="423.html">prev</a>
                    <a href="425.html">next</a>
                    <a href="424_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Evernote/android-job_990c47ba5da81fba1ec423479b571f44f504d473_library/src/main/java/com/evernote/android/job/JobExecutor.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;990c47ba5da81fba1ec423479b571f44f504d473:library/src/main/java/com/evernote/android/job/JobExecutor.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;990c47ba5da81fba1ec423479b571f44f504d473^1:library/src/main/java/com/evernote/android/job/JobExecutor.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;990c47ba5da81fba1ec423479b571f44f504d473^2:library/src/main/java/com/evernote/android/job/JobExecutor.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;796bfe5f3ba9fe53d163919757b3d93d45df0089:library/src/main/java/com/evernote/android/job/JobExecutor.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  28 import android.content.Context;                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  29 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  30 import android.os.PowerManager;                                                                          </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31 import android.support.annotation.NonNull;                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  32 import android.support.annotation.Nullable;                                                              </span>
<span class="551815432473888695" onmouseenter="enter('551815432473888695');" onmouseout="out('551815432473888695');" style="">  33 import android.util.LruCache;                                                                            </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  34 import android.util.SparseArray;                                                                         </span>
<span  style="">  35                                                                                                          </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  36 import com.evernote.android.job.util.JobCat;                                                             </span>
<span  style="">  37                                                                                                          </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  38 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  39                                                                                                          </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  40 import java.util.HashSet;                                                                                </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  41 import java.util.Locale;                                                                                 </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  42 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  43 import java.util.Set;                                                                                    </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  44 import java.util.concurrent.Callable;                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  45 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  46 import java.util.concurrent.Executors;                                                                   </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  47 import java.util.concurrent.Future;                                                                      </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  48 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50 /**                                                                                                      </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  51  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52  */                                                                                                      </span>
<span class="-5429987873611314699" onmouseenter="enter('-5429987873611314699');" onmouseout="out('-5429987873611314699');" style="">  53 @SuppressWarnings(&quot;WeakerAccess&quot;)                                                                        </span>
<span class="-6824039201147728245" onmouseenter="enter('-6824039201147728245');" onmouseout="out('-6824039201147728245');" style="">  54 /*package*/ class JobExecutor {                                                                          </span>
<span  style="">  55                                                                                                          </span>
<span class="576747690139556584" onmouseenter="enter('576747690139556584');" onmouseout="out('576747690139556584');" style="">  56     private static final CatLog CAT = new JobCat(&quot;JobExecutor&quot;);                                         </span>
<span class="-5421707713164059680" onmouseenter="enter('-5421707713164059680');" onmouseout="out('-5421707713164059680');" style="">  57     private static final long WAKE_LOCK_TIMEOUT = TimeUnit.MINUTES.toMillis(3);                          </span>
<span  style="">  58                                                                                                          </span>
<span class="7359818073840972103" onmouseenter="enter('7359818073840972103');" onmouseout="out('7359818073840972103');" style="">  59     private final ExecutorService mExecutorService;                                                      </span>
<span  style="">  60                                                                                                          </span>
<span class="-8963975558179470647" onmouseenter="enter('-8963975558179470647');" onmouseout="out('-8963975558179470647');" style="">  61     private final SparseArray&lt;Job&gt; mJobs; // only cached in memory, that&#x27;s fine                          </span>
<span class="-1720597333174085800" onmouseenter="enter('-1720597333174085800');" onmouseout="out('-1720597333174085800');" style="">  62     private final LruCache&lt;Integer, Job&gt; mFinishedJobsCache;                                             </span>
<span  style="">  63                                                                                                          </span>
<span class="-170958784796080443" onmouseenter="enter('-170958784796080443');" onmouseout="out('-170958784796080443');" style="">  64     private final Set&lt;JobRequest&gt; mStartingRequests;                                                     </span>
<span  style="">  65                                                                                                          </span>
<span class="8108192534285727070" onmouseenter="enter('8108192534285727070');" onmouseout="out('8108192534285727070');" style="">  66     public JobExecutor() {                                                                               </span>
<span class="9104164227028974115" onmouseenter="enter('9104164227028974115');" onmouseout="out('9104164227028974115');" style="">  67         mExecutorService = Executors.newCachedThreadPool(JobProxy.Common.COMMON_THREAD_FACTORY);         </span>
<span class="-8499890188721472813" onmouseenter="enter('-8499890188721472813');" onmouseout="out('-8499890188721472813');" style="">  68         mJobs = new SparseArray&lt;&gt;();                                                                     </span>
<span class="1383362030898242023" onmouseenter="enter('1383362030898242023');" onmouseout="out('1383362030898242023');" style="">  69         mFinishedJobsCache = new LruCache&lt;&gt;(20);                                                         </span>
<span class="8767836813738270555" onmouseenter="enter('8767836813738270555');" onmouseout="out('8767836813738270555');" style="">  70         mStartingRequests = new HashSet&lt;&gt;();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71     }                                                                                                    </span>
<span  style="">  72                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  73 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-7126529935599950105" onmouseenter="enter('-7126529935599950105');" onmouseout="out('-7126529935599950105');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  74     public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job, @NonNull Bundle transientExtras) {">  74     public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request,ðŸ”µ</abbr></span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  75 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-7141982173540135040" onmouseenter="enter('-7141982173540135040');" onmouseout="out('-7141982173540135040');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         if (job == null) {                                                                               </span>
<span class="-4717926091915407836" onmouseenter="enter('-4717926091915407836');" onmouseout="out('-4717926091915407836');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77             CAT.w(&quot;JobCreator returned null for tag %s&quot;, request.getTag());                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79         }                                                                                                </span>
<span class="-4214496584854592723" onmouseenter="enter('-4214496584854592723');" onmouseout="out('-4214496584854592723');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         if (job.isFinished()) {                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  81 =======                                                                                                  </span>
<span class="4956090937900533597" onmouseenter="enter('4956090937900533597');" onmouseout="out('4956090937900533597');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  82     public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job) {">  82     public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request,ðŸ”µ</abbr></span>
<span class="-7948427868544751410" onmouseenter="enter('-7948427868544751410');" onmouseout="out('-7948427868544751410');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83         mStartingRequests.remove(request);                                                               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  85 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-7141982173540135040" onmouseenter="enter('-7141982173540135040');" onmouseout="out('-7141982173540135040');" style="">  86         if (job == null) {                                                                               </span>
<span class="-4717926091915407836" onmouseenter="enter('-4717926091915407836');" onmouseout="out('-4717926091915407836');" style="">  87             CAT.w(&quot;JobCreator returned null for tag %s&quot;, request.getTag());                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  88             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89         }                                                                                                </span>
<span class="-4214496584854592723" onmouseenter="enter('-4214496584854592723');" onmouseout="out('-4214496584854592723');" style="">  90         if (job.isFinished()) {                                                                          </span>
<span class="1641882686740069389" onmouseenter="enter('1641882686740069389');" onmouseout="out('1641882686740069389');" style=""><abbr title="  91             throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already run, a creator should always create a new Job instance&quot;, request.getTag()));">  91             throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already runðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92         }                                                                                                </span>
<span  style="">  93                                                                                                          </span>
<span class="-6551595380421202658" onmouseenter="enter('-6551595380421202658');" onmouseout="out('-6551595380421202658');" style="">  94         job.setContext(context).setRequest(request, transientExtras);                                    </span>
<span  style="">  95                                                                                                          </span>
<span class="-3496389814317983910" onmouseenter="enter('-3496389814317983910');" onmouseout="out('-3496389814317983910');" style="">  96         CAT.i(&quot;Executing %s, context %s&quot;, request, context.getClass().getSimpleName());                  </span>
<span  style="">  97                                                                                                          </span>
<span class="7756124266948558527" onmouseenter="enter('7756124266948558527');" onmouseout="out('7756124266948558527');" style="">  98         mJobs.put(request.getJobId(), job);                                                              </span>
<span class="-2759486010452356572" onmouseenter="enter('-2759486010452356572');" onmouseout="out('-2759486010452356572');" style="">  99         return mExecutorService.submit(new JobCallable(job));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100     }                                                                                                    </span>
<span  style=""> 101                                                                                                          </span>
<span class="6315068224860570324" onmouseenter="enter('6315068224860570324');" onmouseout="out('6315068224860570324');" style=""> 102     public synchronized Job getJob(int jobId) {                                                          </span>
<span class="-4933915928635343379" onmouseenter="enter('-4933915928635343379');" onmouseout="out('-4933915928635343379');" style=""> 103         Job job = mJobs.get(jobId);                                                                      </span>
<span class="9131330920108346670" onmouseenter="enter('9131330920108346670');" onmouseout="out('9131330920108346670');" style=""> 104         return job != null ? job : mFinishedJobsCache.get(jobId);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="-5037647569549536082" onmouseenter="enter('-5037647569549536082');" onmouseout="out('-5037647569549536082');" style=""> 107     public synchronized Set&lt;Job&gt; getAllJobs() {                                                          </span>
<span class="-4329558470024454466" onmouseenter="enter('-4329558470024454466');" onmouseout="out('-4329558470024454466');" style=""> 108         return getAllJobsForTag(null);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109     }                                                                                                    </span>
<span  style=""> 110                                                                                                          </span>
<span class="-3367095245460479768" onmouseenter="enter('-3367095245460479768');" onmouseout="out('-3367095245460479768');" style=""> 111     public synchronized Set&lt;Job&gt; getAllJobsForTag(String tag) {                                          </span>
<span class="-4258991344607162939" onmouseenter="enter('-4258991344607162939');" onmouseout="out('-4258991344607162939');" style=""> 112         Set&lt;Job&gt; result = new HashSet&lt;&gt;();                                                               </span>
<span class="6866939828668136173" onmouseenter="enter('6866939828668136173');" onmouseout="out('6866939828668136173');" style=""> 113         for (int i = 0; i &lt; mJobs.size(); i++) {                                                         </span>
<span class="-3414641758550512724" onmouseenter="enter('-3414641758550512724');" onmouseout="out('-3414641758550512724');" style=""> 114             Job job = mJobs.valueAt(i);                                                                  </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 115             if (tag == null || tag.equals(job.getParams().getTag())) {                                   </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 116                 result.add(job);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118         }                                                                                                </span>
<span  style=""> 119                                                                                                          </span>
<span class="-2264054569659866843" onmouseenter="enter('-2264054569659866843');" onmouseout="out('-2264054569659866843');" style=""> 120         Map&lt;Integer, Job&gt; snapshot = mFinishedJobsCache.snapshot();                                      </span>
<span class="-6322784541538163711" onmouseenter="enter('-6322784541538163711');" onmouseout="out('-6322784541538163711');" style=""> 121         for (Job job : snapshot.values()) {                                                              </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 122             if (tag == null || tag.equals(job.getParams().getTag())) {                                   </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 123                 result.add(job);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125         }                                                                                                </span>
<span  style=""> 126                                                                                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 127         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128     }                                                                                                    </span>
<span  style=""> 129                                                                                                          </span>
<span class="-3311171878734742102" onmouseenter="enter('-3311171878734742102');" onmouseout="out('-3311171878734742102');" style=""> 130     public synchronized void markJobRequestStarting(@NonNull JobRequest request) {                       </span>
<span class="7669417470993648274" onmouseenter="enter('7669417470993648274');" onmouseout="out('7669417470993648274');" style=""> 131         mStartingRequests.add(request);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132     }                                                                                                    </span>
<span  style=""> 133                                                                                                          </span>
<span class="8072868544527549177" onmouseenter="enter('8072868544527549177');" onmouseout="out('8072868544527549177');" style=""> 134     public synchronized boolean isRequestStarting(JobRequest request) {                                  </span>
<span class="-2490254344651127179" onmouseenter="enter('-2490254344651127179');" onmouseout="out('-2490254344651127179');" style=""> 135         return request != null &amp;&amp; mStartingRequests.contains(request);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136     }                                                                                                    </span>
<span  style=""> 137                                                                                                          </span>
<span class="8851173145352107748" onmouseenter="enter('8851173145352107748');" onmouseout="out('8851173145352107748');" style=""> 138     private synchronized void markJobAsFinished(Job job) {                                               </span>
<span class="-8892670731929029868" onmouseenter="enter('-8892670731929029868');" onmouseout="out('-8892670731929029868');" style=""> 139         int id = job.getParams().getId();                                                                </span>
<span class="-2244622938524994118" onmouseenter="enter('-2244622938524994118');" onmouseout="out('-2244622938524994118');" style=""> 140         mJobs.remove(id);                                                                                </span>
<span class="-8975069377911450592" onmouseenter="enter('-8975069377911450592');" onmouseout="out('-8975069377911450592');" style=""> 141         mFinishedJobsCache.put(id, job);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142     }                                                                                                    </span>
<span  style=""> 143                                                                                                          </span>
<span class="-7822796101109017317" onmouseenter="enter('-7822796101109017317');" onmouseout="out('-7822796101109017317');" style=""> 144     private final class JobCallable implements Callable&lt;Job.Result&gt; {                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="315713153710651742" onmouseenter="enter('315713153710651742');" onmouseout="out('315713153710651742');" style=""> 146         private final Job mJob;                                                                          </span>
<span class="-6135444244809655879" onmouseenter="enter('-6135444244809655879');" onmouseout="out('-6135444244809655879');" style=""> 147         private final PowerManager.WakeLock mWakeLock;                                                   </span>
<span  style=""> 148                                                                                                          </span>
<span class="-5126963627044409337" onmouseenter="enter('-5126963627044409337');" onmouseout="out('-5126963627044409337');" style=""> 149         private JobCallable(Job job) {                                                                   </span>
<span class="-3335066324806711319" onmouseenter="enter('-3335066324806711319');" onmouseout="out('-3335066324806711319');" style=""> 150             mJob = job;                                                                                  </span>
<span  style=""> 151                                                                                                          </span>
<span class="-6023636646525680147" onmouseenter="enter('-6023636646525680147');" onmouseout="out('-6023636646525680147');" style=""> 152             Context context = mJob.getContext();                                                         </span>
<span class="2683095074953864920" onmouseenter="enter('2683095074953864920');" onmouseout="out('2683095074953864920');" style=""> 153             mWakeLock = WakeLockUtil.acquireWakeLock(context, &quot;JobExecutor&quot;, WAKE_LOCK_TIMEOUT);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154         }                                                                                                </span>
<span  style=""> 155                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 156         @Override                                                                                        </span>
<span class="6323418417803688808" onmouseenter="enter('6323418417803688808');" onmouseout="out('6323418417803688808');" style=""> 157         public Job.Result call() throws Exception {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 158             try {                                                                                        </span>
<span class="-6011216104504266450" onmouseenter="enter('-6011216104504266450');" onmouseout="out('-6011216104504266450');" style=""> 159                 // just in case something was blocking and the wake lock is no longer acquired           </span>
<span class="-5083937556537798580" onmouseenter="enter('-5083937556537798580');" onmouseout="out('-5083937556537798580');" style=""> 160                 WakeLockUtil.acquireWakeLock(mJob.getContext(), mWakeLock, WAKE_LOCK_TIMEOUT);           </span>
<span class="2621723818868626915" onmouseenter="enter('2621723818868626915');" onmouseout="out('2621723818868626915');" style=""> 161                 return runJob();                                                                         </span>
<span  style=""> 162                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 163             } finally {                                                                                  </span>
<span class="-1515771294888401339" onmouseenter="enter('-1515771294888401339');" onmouseout="out('-1515771294888401339');" style=""> 164                 markJobAsFinished(mJob);                                                                 </span>
<span  style=""> 165                                                                                                          </span>
<span class="-2312673111584342243" onmouseenter="enter('-2312673111584342243');" onmouseout="out('-2312673111584342243');" style=""> 166                 if (mWakeLock == null || !mWakeLock.isHeld()) {                                          </span>
<span class="-4049068033076161723" onmouseenter="enter('-4049068033076161723');" onmouseout="out('-4049068033076161723');" style=""><abbr title=" 167                     CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to complete. This could have unintended side effects on your app.&quot;, mJob);"> 167                     CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to completðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168                 }                                                                                        </span>
<span class="-2456668544624162744" onmouseenter="enter('-2456668544624162744');" onmouseout="out('-2456668544624162744');" style=""> 169                 WakeLockUtil.releaseWakeLock(mWakeLock);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171         }                                                                                                </span>
<span  style=""> 172                                                                                                          </span>
<span class="3483593114331671747" onmouseenter="enter('3483593114331671747');" onmouseout="out('3483593114331671747');" style=""> 173         private Job.Result runJob() {                                                                    </span>
<span class="2461081295092004331" onmouseenter="enter('2461081295092004331');" onmouseout="out('2461081295092004331');" style=""> 174             Job.Result result;                                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 175             try {                                                                                        </span>
<span class="9208532701010688008" onmouseenter="enter('9208532701010688008');" onmouseout="out('9208532701010688008');" style=""> 176                 result = mJob.runJob();                                                                  </span>
<span class="-4624927025006522705" onmouseenter="enter('-4624927025006522705');" onmouseout="out('-4624927025006522705');" style=""> 177                 CAT.i(&quot;Finished %s&quot;, mJob);                                                              </span>
<span  style=""> 178                                                                                                          </span>
<span class="-5322264062003378165" onmouseenter="enter('-5322264062003378165');" onmouseout="out('-5322264062003378165');" style=""> 179                 handleResult(mJob, result);                                                              </span>
<span  style=""> 180                                                                                                          </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 181             } catch (Throwable t) {                                                                      </span>
<span class="8951614835287080134" onmouseenter="enter('8951614835287080134');" onmouseout="out('8951614835287080134');" style=""> 182                 CAT.e(t, &quot;Crashed %s&quot;, mJob);                                                            </span>
<span class="-4148228902169329570" onmouseenter="enter('-4148228902169329570');" onmouseout="out('-4148228902169329570');" style=""> 183                 result = mJob.getResult(); // probably the default value                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184             }                                                                                            </span>
<span  style=""> 185                                                                                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 186             return result;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187         }                                                                                                </span>
<span  style=""> 188                                                                                                          </span>
<span class="-2948063841233397522" onmouseenter="enter('-2948063841233397522');" onmouseout="out('-2948063841233397522');" style=""> 189         private void handleResult(Job job, Job.Result result) {                                          </span>
<span class="-7525907700149424181" onmouseenter="enter('-7525907700149424181');" onmouseout="out('-7525907700149424181');" style=""> 190             JobRequest request = mJob.getParams().getRequest();                                          </span>
<span class="2440857122486788839" onmouseenter="enter('2440857122486788839');" onmouseout="out('2440857122486788839');" style=""> 191             boolean incFailureCount = false;                                                             </span>
<span class="-3873932327052429859" onmouseenter="enter('-3873932327052429859');" onmouseout="out('-3873932327052429859');" style=""> 192             boolean updateLastRun = false;                                                               </span>
<span  style=""> 193                                                                                                          </span>
<span class="-3405704552005865671" onmouseenter="enter('-3405704552005865671');" onmouseout="out('-3405704552005865671');" style=""> 194             if (!request.isPeriodic() &amp;&amp; Job.Result.RESCHEDULE.equals(result)) {                         </span>
<span class="-6622032481340356577" onmouseenter="enter('-6622032481340356577');" onmouseout="out('-6622032481340356577');" style=""> 195                 request = request.reschedule(true, true);                                                </span>
<span class="7935935301832840342" onmouseenter="enter('7935935301832840342');" onmouseout="out('7935935301832840342');" style=""> 196                 mJob.onReschedule(request.getJobId());                                                   </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 197                 updateLastRun = true;                                                                    </span>
<span  style=""> 198                                                                                                          </span>
<span class="-6871259328448204026" onmouseenter="enter('-6871259328448204026');" onmouseout="out('-6871259328448204026');" style=""> 199             } else if (request.isPeriodic()) {                                                           </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 200                 updateLastRun = true;                                                                    </span>
<span class="-2463949442393302720" onmouseenter="enter('-2463949442393302720');" onmouseout="out('-2463949442393302720');" style=""> 201                 if (!Job.Result.SUCCESS.equals(result)) {                                                </span>
<span class="-763742865901626052" onmouseenter="enter('-763742865901626052');" onmouseout="out('-763742865901626052');" style=""> 202                     incFailureCount = true;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203                 }                                                                                        </span>
<span  style=""> 204                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205             }                                                                                            </span>
<span  style=""> 206                                                                                                          </span>
<span class="-8743699515814204118" onmouseenter="enter('-8743699515814204118');" onmouseout="out('-8743699515814204118');" style=""> 207             if (!job.isDeleted()) {                                                                      </span>
<span class="6249431087393884453" onmouseenter="enter('6249431087393884453');" onmouseout="out('6249431087393884453');" style=""> 208                 // otherwise it would be persisted again                                                 </span>
<span class="-7855248345985168704" onmouseenter="enter('-7855248345985168704');" onmouseout="out('-7855248345985168704');" style=""> 209                 if (incFailureCount || updateLastRun) {                                                  </span>
<span class="-155981268798468651" onmouseenter="enter('-155981268798468651');" onmouseout="out('-155981268798468651');" style=""> 210                     //noinspection ConstantConditions                                                    </span>
<span class="8592094849717380902" onmouseenter="enter('8592094849717380902');" onmouseout="out('8592094849717380902');" style=""> 211                     request.updateStats(incFailureCount, updateLastRun);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  28 import android.content.Context;                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  29 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  30 import android.os.PowerManager;                                                                          </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31 import android.support.annotation.NonNull;                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  32 import android.support.annotation.Nullable;                                                              </span>
<span class="551815432473888695" onmouseenter="enter('551815432473888695');" onmouseout="out('551815432473888695');" style="">  33 import android.util.LruCache;                                                                            </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  34 import android.util.SparseArray;                                                                         </span>
<span  style="">  35                                                                                                          </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  36 import com.evernote.android.job.util.JobCat;                                                             </span>
<span  style="">  37                                                                                                          </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  38 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  39                                                                                                          </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  40 import java.util.HashSet;                                                                                </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  41 import java.util.Locale;                                                                                 </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  42 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  43 import java.util.Set;                                                                                    </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  44 import java.util.concurrent.Callable;                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  45 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  46 import java.util.concurrent.Executors;                                                                   </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  47 import java.util.concurrent.Future;                                                                      </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  48 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50 /**                                                                                                      </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  51  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52  */                                                                                                      </span>
<span class="-5429987873611314699" onmouseenter="enter('-5429987873611314699');" onmouseout="out('-5429987873611314699');" style="">  53 @SuppressWarnings(&quot;WeakerAccess&quot;)                                                                        </span>
<span class="-6824039201147728245" onmouseenter="enter('-6824039201147728245');" onmouseout="out('-6824039201147728245');" style="">  54 /*package*/ class JobExecutor {                                                                          </span>
<span  style="">  55                                                                                                          </span>
<span class="576747690139556584" onmouseenter="enter('576747690139556584');" onmouseout="out('576747690139556584');" style="">  56     private static final CatLog CAT = new JobCat(&quot;JobExecutor&quot;);                                         </span>
<span class="-5421707713164059680" onmouseenter="enter('-5421707713164059680');" onmouseout="out('-5421707713164059680');" style="">  57     private static final long WAKE_LOCK_TIMEOUT = TimeUnit.MINUTES.toMillis(3);                          </span>
<span  style="">  58                                                                                                          </span>
<span class="7359818073840972103" onmouseenter="enter('7359818073840972103');" onmouseout="out('7359818073840972103');" style="">  59     private final ExecutorService mExecutorService;                                                      </span>
<span  style="">  60                                                                                                          </span>
<span class="-8963975558179470647" onmouseenter="enter('-8963975558179470647');" onmouseout="out('-8963975558179470647');" style="">  61     private final SparseArray&lt;Job&gt; mJobs; // only cached in memory, that&#x27;s fine                          </span>
<span class="-1720597333174085800" onmouseenter="enter('-1720597333174085800');" onmouseout="out('-1720597333174085800');" style="">  62     private final LruCache&lt;Integer, Job&gt; mFinishedJobsCache;                                             </span>
<span  style="">  63                                                                                                          </span>
<span class="-170958784796080443" onmouseenter="enter('-170958784796080443');" onmouseout="out('-170958784796080443');" style="">  64     private final Set&lt;JobRequest&gt; mStartingRequests;                                                     </span>
<span  style="">  65                                                                                                          </span>
<span class="8108192534285727070" onmouseenter="enter('8108192534285727070');" onmouseout="out('8108192534285727070');" style="">  66     public JobExecutor() {                                                                               </span>
<span class="9104164227028974115" onmouseenter="enter('9104164227028974115');" onmouseout="out('9104164227028974115');" style="">  67         mExecutorService = Executors.newCachedThreadPool(JobProxy.Common.COMMON_THREAD_FACTORY);         </span>
<span class="-8499890188721472813" onmouseenter="enter('-8499890188721472813');" onmouseout="out('-8499890188721472813');" style="">  68         mJobs = new SparseArray&lt;&gt;();                                                                     </span>
<span class="1383362030898242023" onmouseenter="enter('1383362030898242023');" onmouseout="out('1383362030898242023');" style="">  69         mFinishedJobsCache = new LruCache&lt;&gt;(20);                                                         </span>
<span class="8767836813738270555" onmouseenter="enter('8767836813738270555');" onmouseout="out('8767836813738270555');" style="">  70         mStartingRequests = new HashSet&lt;&gt;();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71     }                                                                                                    </span>
<span  style="">  72                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  73 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-7126529935599950105" onmouseenter="enter('-7126529935599950105');" onmouseout="out('-7126529935599950105');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  74 public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job, @NonNull Bundle transientExtras) {">  74 public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @NuðŸ”µ</abbr></span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  75 ||||||| BASE                                                                                             </span>
<span class="4956090937900533597" onmouseenter="enter('4956090937900533597');" onmouseout="out('4956090937900533597');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  76 public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job) {">  76 public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @NuðŸ”µ</abbr></span>
<span class="-7141982173540135040" onmouseenter="enter('-7141982173540135040');" onmouseout="out('-7141982173540135040');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77         if (job == null) {                                                                               </span>
<span class="-4717926091915407836" onmouseenter="enter('-4717926091915407836');" onmouseout="out('-4717926091915407836');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78             CAT.w(&quot;JobCreator returned null for tag %s&quot;, request.getTag());                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  79 =======                                                                                                  </span>
<span class="4956090937900533597" onmouseenter="enter('4956090937900533597');" onmouseout="out('4956090937900533597');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  80 public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job) {">  80 public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @NuðŸ”µ</abbr></span>
<span class="-7948427868544751410" onmouseenter="enter('-7948427868544751410');" onmouseout="out('-7948427868544751410');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81         mStartingRequests.remove(request);                                                               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  83 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-7141982173540135040" onmouseenter="enter('-7141982173540135040');" onmouseout="out('-7141982173540135040');" style="">  84         if (job == null) {                                                                               </span>
<span class="-4717926091915407836" onmouseenter="enter('-4717926091915407836');" onmouseout="out('-4717926091915407836');" style="">  85             CAT.w(&quot;JobCreator returned null for tag %s&quot;, request.getTag());                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  86             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87         }                                                                                                </span>
<span class="-4214496584854592723" onmouseenter="enter('-4214496584854592723');" onmouseout="out('-4214496584854592723');" style="">  88         if (job.isFinished()) {                                                                          </span>
<span class="1641882686740069389" onmouseenter="enter('1641882686740069389');" onmouseout="out('1641882686740069389');" style=""><abbr title="  89             throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already run, a creator should always create a new Job instance&quot;, request.getTag()));">  89             throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already runðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span  style="">  91                                                                                                          </span>
<span class="-6551595380421202658" onmouseenter="enter('-6551595380421202658');" onmouseout="out('-6551595380421202658');" style="">  92         job.setContext(context).setRequest(request, transientExtras);                                    </span>
<span  style="">  93                                                                                                          </span>
<span class="-3496389814317983910" onmouseenter="enter('-3496389814317983910');" onmouseout="out('-3496389814317983910');" style="">  94         CAT.i(&quot;Executing %s, context %s&quot;, request, context.getClass().getSimpleName());                  </span>
<span  style="">  95                                                                                                          </span>
<span class="7756124266948558527" onmouseenter="enter('7756124266948558527');" onmouseout="out('7756124266948558527');" style="">  96         mJobs.put(request.getJobId(), job);                                                              </span>
<span class="-2759486010452356572" onmouseenter="enter('-2759486010452356572');" onmouseout="out('-2759486010452356572');" style="">  97         return mExecutorService.submit(new JobCallable(job));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="6315068224860570324" onmouseenter="enter('6315068224860570324');" onmouseout="out('6315068224860570324');" style=""> 100     public synchronized Job getJob(int jobId) {                                                          </span>
<span class="-4933915928635343379" onmouseenter="enter('-4933915928635343379');" onmouseout="out('-4933915928635343379');" style=""> 101         Job job = mJobs.get(jobId);                                                                      </span>
<span class="9131330920108346670" onmouseenter="enter('9131330920108346670');" onmouseout="out('9131330920108346670');" style=""> 102         return job != null ? job : mFinishedJobsCache.get(jobId);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span  style=""> 104                                                                                                          </span>
<span class="-5037647569549536082" onmouseenter="enter('-5037647569549536082');" onmouseout="out('-5037647569549536082');" style=""> 105     public synchronized Set&lt;Job&gt; getAllJobs() {                                                          </span>
<span class="-4329558470024454466" onmouseenter="enter('-4329558470024454466');" onmouseout="out('-4329558470024454466');" style=""> 106         return getAllJobsForTag(null);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="-3367095245460479768" onmouseenter="enter('-3367095245460479768');" onmouseout="out('-3367095245460479768');" style=""> 109     public synchronized Set&lt;Job&gt; getAllJobsForTag(String tag) {                                          </span>
<span class="-4258991344607162939" onmouseenter="enter('-4258991344607162939');" onmouseout="out('-4258991344607162939');" style=""> 110         Set&lt;Job&gt; result = new HashSet&lt;&gt;();                                                               </span>
<span class="6866939828668136173" onmouseenter="enter('6866939828668136173');" onmouseout="out('6866939828668136173');" style=""> 111         for (int i = 0; i &lt; mJobs.size(); i++) {                                                         </span>
<span class="-3414641758550512724" onmouseenter="enter('-3414641758550512724');" onmouseout="out('-3414641758550512724');" style=""> 112             Job job = mJobs.valueAt(i);                                                                  </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 113             if (tag == null || tag.equals(job.getParams().getTag())) {                                   </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 114                 result.add(job);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116         }                                                                                                </span>
<span  style=""> 117                                                                                                          </span>
<span class="-2264054569659866843" onmouseenter="enter('-2264054569659866843');" onmouseout="out('-2264054569659866843');" style=""> 118         Map&lt;Integer, Job&gt; snapshot = mFinishedJobsCache.snapshot();                                      </span>
<span class="-6322784541538163711" onmouseenter="enter('-6322784541538163711');" onmouseout="out('-6322784541538163711');" style=""> 119         for (Job job : snapshot.values()) {                                                              </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 120             if (tag == null || tag.equals(job.getParams().getTag())) {                                   </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 121                 result.add(job);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123         }                                                                                                </span>
<span  style=""> 124                                                                                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 125         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span  style=""> 127                                                                                                          </span>
<span class="-3311171878734742102" onmouseenter="enter('-3311171878734742102');" onmouseout="out('-3311171878734742102');" style=""> 128     public synchronized void markJobRequestStarting(@NonNull JobRequest request) {                       </span>
<span class="7669417470993648274" onmouseenter="enter('7669417470993648274');" onmouseout="out('7669417470993648274');" style=""> 129         mStartingRequests.add(request);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130     }                                                                                                    </span>
<span  style=""> 131                                                                                                          </span>
<span class="8072868544527549177" onmouseenter="enter('8072868544527549177');" onmouseout="out('8072868544527549177');" style=""> 132     public synchronized boolean isRequestStarting(JobRequest request) {                                  </span>
<span class="-2490254344651127179" onmouseenter="enter('-2490254344651127179');" onmouseout="out('-2490254344651127179');" style=""> 133         return request != null &amp;&amp; mStartingRequests.contains(request);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134     }                                                                                                    </span>
<span  style=""> 135                                                                                                          </span>
<span class="8851173145352107748" onmouseenter="enter('8851173145352107748');" onmouseout="out('8851173145352107748');" style=""> 136     private synchronized void markJobAsFinished(Job job) {                                               </span>
<span class="-8892670731929029868" onmouseenter="enter('-8892670731929029868');" onmouseout="out('-8892670731929029868');" style=""> 137         int id = job.getParams().getId();                                                                </span>
<span class="-2244622938524994118" onmouseenter="enter('-2244622938524994118');" onmouseout="out('-2244622938524994118');" style=""> 138         mJobs.remove(id);                                                                                </span>
<span class="-8975069377911450592" onmouseenter="enter('-8975069377911450592');" onmouseout="out('-8975069377911450592');" style=""> 139         mFinishedJobsCache.put(id, job);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140     }                                                                                                    </span>
<span  style=""> 141                                                                                                          </span>
<span class="-7822796101109017317" onmouseenter="enter('-7822796101109017317');" onmouseout="out('-7822796101109017317');" style=""> 142     private final class JobCallable implements Callable&lt;Job.Result&gt; {                                    </span>
<span  style=""> 143                                                                                                          </span>
<span class="315713153710651742" onmouseenter="enter('315713153710651742');" onmouseout="out('315713153710651742');" style=""> 144         private final Job mJob;                                                                          </span>
<span class="-6135444244809655879" onmouseenter="enter('-6135444244809655879');" onmouseout="out('-6135444244809655879');" style=""> 145         private final PowerManager.WakeLock mWakeLock;                                                   </span>
<span  style=""> 146                                                                                                          </span>
<span class="-5126963627044409337" onmouseenter="enter('-5126963627044409337');" onmouseout="out('-5126963627044409337');" style=""> 147         private JobCallable(Job job) {                                                                   </span>
<span class="-3335066324806711319" onmouseenter="enter('-3335066324806711319');" onmouseout="out('-3335066324806711319');" style=""> 148             mJob = job;                                                                                  </span>
<span  style=""> 149                                                                                                          </span>
<span class="-6023636646525680147" onmouseenter="enter('-6023636646525680147');" onmouseout="out('-6023636646525680147');" style=""> 150             Context context = mJob.getContext();                                                         </span>
<span class="2683095074953864920" onmouseenter="enter('2683095074953864920');" onmouseout="out('2683095074953864920');" style=""> 151             mWakeLock = WakeLockUtil.acquireWakeLock(context, &quot;JobExecutor&quot;, WAKE_LOCK_TIMEOUT);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152         }                                                                                                </span>
<span  style=""> 153                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 154         @Override                                                                                        </span>
<span class="6323418417803688808" onmouseenter="enter('6323418417803688808');" onmouseout="out('6323418417803688808');" style=""> 155         public Job.Result call() throws Exception {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 156             try {                                                                                        </span>
<span class="-6011216104504266450" onmouseenter="enter('-6011216104504266450');" onmouseout="out('-6011216104504266450');" style=""> 157                 // just in case something was blocking and the wake lock is no longer acquired           </span>
<span class="-5083937556537798580" onmouseenter="enter('-5083937556537798580');" onmouseout="out('-5083937556537798580');" style=""> 158                 WakeLockUtil.acquireWakeLock(mJob.getContext(), mWakeLock, WAKE_LOCK_TIMEOUT);           </span>
<span class="2621723818868626915" onmouseenter="enter('2621723818868626915');" onmouseout="out('2621723818868626915');" style=""> 159                 return runJob();                                                                         </span>
<span  style=""> 160                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 161             } finally {                                                                                  </span>
<span class="-1515771294888401339" onmouseenter="enter('-1515771294888401339');" onmouseout="out('-1515771294888401339');" style=""> 162                 markJobAsFinished(mJob);                                                                 </span>
<span  style=""> 163                                                                                                          </span>
<span class="-2312673111584342243" onmouseenter="enter('-2312673111584342243');" onmouseout="out('-2312673111584342243');" style=""> 164                 if (mWakeLock == null || !mWakeLock.isHeld()) {                                          </span>
<span class="-4049068033076161723" onmouseenter="enter('-4049068033076161723');" onmouseout="out('-4049068033076161723');" style=""><abbr title=" 165                     CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to complete. This could have unintended side effects on your app.&quot;, mJob);"> 165                     CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to completðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166                 }                                                                                        </span>
<span class="-2456668544624162744" onmouseenter="enter('-2456668544624162744');" onmouseout="out('-2456668544624162744');" style=""> 167                 WakeLockUtil.releaseWakeLock(mWakeLock);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169         }                                                                                                </span>
<span  style=""> 170                                                                                                          </span>
<span class="3483593114331671747" onmouseenter="enter('3483593114331671747');" onmouseout="out('3483593114331671747');" style=""> 171         private Job.Result runJob() {                                                                    </span>
<span class="2461081295092004331" onmouseenter="enter('2461081295092004331');" onmouseout="out('2461081295092004331');" style=""> 172             Job.Result result;                                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 173             try {                                                                                        </span>
<span class="9208532701010688008" onmouseenter="enter('9208532701010688008');" onmouseout="out('9208532701010688008');" style=""> 174                 result = mJob.runJob();                                                                  </span>
<span class="-4624927025006522705" onmouseenter="enter('-4624927025006522705');" onmouseout="out('-4624927025006522705');" style=""> 175                 CAT.i(&quot;Finished %s&quot;, mJob);                                                              </span>
<span  style=""> 176                                                                                                          </span>
<span class="-5322264062003378165" onmouseenter="enter('-5322264062003378165');" onmouseout="out('-5322264062003378165');" style=""> 177                 handleResult(mJob, result);                                                              </span>
<span  style=""> 178                                                                                                          </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 179             } catch (Throwable t) {                                                                      </span>
<span class="8951614835287080134" onmouseenter="enter('8951614835287080134');" onmouseout="out('8951614835287080134');" style=""> 180                 CAT.e(t, &quot;Crashed %s&quot;, mJob);                                                            </span>
<span class="-4148228902169329570" onmouseenter="enter('-4148228902169329570');" onmouseout="out('-4148228902169329570');" style=""> 181                 result = mJob.getResult(); // probably the default value                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182             }                                                                                            </span>
<span  style=""> 183                                                                                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 184             return result;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185         }                                                                                                </span>
<span  style=""> 186                                                                                                          </span>
<span class="-2948063841233397522" onmouseenter="enter('-2948063841233397522');" onmouseout="out('-2948063841233397522');" style=""> 187         private void handleResult(Job job, Job.Result result) {                                          </span>
<span class="-7525907700149424181" onmouseenter="enter('-7525907700149424181');" onmouseout="out('-7525907700149424181');" style=""> 188             JobRequest request = mJob.getParams().getRequest();                                          </span>
<span class="2440857122486788839" onmouseenter="enter('2440857122486788839');" onmouseout="out('2440857122486788839');" style=""> 189             boolean incFailureCount = false;                                                             </span>
<span class="-3873932327052429859" onmouseenter="enter('-3873932327052429859');" onmouseout="out('-3873932327052429859');" style=""> 190             boolean updateLastRun = false;                                                               </span>
<span  style=""> 191                                                                                                          </span>
<span class="-3405704552005865671" onmouseenter="enter('-3405704552005865671');" onmouseout="out('-3405704552005865671');" style=""> 192             if (!request.isPeriodic() &amp;&amp; Job.Result.RESCHEDULE.equals(result)) {                         </span>
<span class="-6622032481340356577" onmouseenter="enter('-6622032481340356577');" onmouseout="out('-6622032481340356577');" style=""> 193                 request = request.reschedule(true, true);                                                </span>
<span class="7935935301832840342" onmouseenter="enter('7935935301832840342');" onmouseout="out('7935935301832840342');" style=""> 194                 mJob.onReschedule(request.getJobId());                                                   </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 195                 updateLastRun = true;                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="-6871259328448204026" onmouseenter="enter('-6871259328448204026');" onmouseout="out('-6871259328448204026');" style=""> 197             } else if (request.isPeriodic()) {                                                           </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 198                 updateLastRun = true;                                                                    </span>
<span class="-2463949442393302720" onmouseenter="enter('-2463949442393302720');" onmouseout="out('-2463949442393302720');" style=""> 199                 if (!Job.Result.SUCCESS.equals(result)) {                                                </span>
<span class="-763742865901626052" onmouseenter="enter('-763742865901626052');" onmouseout="out('-763742865901626052');" style=""> 200                     incFailureCount = true;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201                 }                                                                                        </span>
<span  style=""> 202                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203             }                                                                                            </span>
<span  style=""> 204                                                                                                          </span>
<span class="-8743699515814204118" onmouseenter="enter('-8743699515814204118');" onmouseout="out('-8743699515814204118');" style=""> 205             if (!job.isDeleted()) {                                                                      </span>
<span class="6249431087393884453" onmouseenter="enter('6249431087393884453');" onmouseout="out('6249431087393884453');" style=""> 206                 // otherwise it would be persisted again                                                 </span>
<span class="-7855248345985168704" onmouseenter="enter('-7855248345985168704');" onmouseout="out('-7855248345985168704');" style=""> 207             if (incFailureCount || updateLastRun) {                                                      </span>
<span class="-155981268798468651" onmouseenter="enter('-155981268798468651');" onmouseout="out('-155981268798468651');" style=""> 208                 //noinspection ConstantConditions                                                        </span>
<span class="8592094849717380902" onmouseenter="enter('8592094849717380902');" onmouseout="out('8592094849717380902');" style=""> 209                 request.updateStats(incFailureCount, updateLastRun);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214 }                                                                                                        </span>
</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  28 import android.content.Context;                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  29 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  30 import android.os.PowerManager;                                                                          </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31 import android.support.annotation.NonNull;                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  32 import android.support.annotation.Nullable;                                                              </span>
<span class="551815432473888695" onmouseenter="enter('551815432473888695');" onmouseout="out('551815432473888695');" style="">  33 import android.util.LruCache;                                                                            </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  34 import android.util.SparseArray;                                                                         </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  35 import com.evernote.android.job.util.JobCat;                                                             </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  36 import java.util.HashSet;                                                                                </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  37 import java.util.Locale;                                                                                 </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  38 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  39 import java.util.Set;                                                                                    </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  40 import java.util.concurrent.Callable;                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  41 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  42 import java.util.concurrent.Executors;                                                                   </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  43 import java.util.concurrent.Future;                                                                      </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  44 import java.util.concurrent.TimeUnit;                                                                    </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  45 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  46                                                                                                          </span>
<span  style="">  47                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  48 /**                                                                                                      </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  49  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  50  */                                                                                                      </span>
<span class="-2942343485984948817" onmouseenter="enter('-2942343485984948817');" onmouseout="out('-2942343485984948817');" style="">  51 /*package*/                                                                                              </span>
<span class="-5429987873611314699" onmouseenter="enter('-5429987873611314699');" onmouseout="out('-5429987873611314699');" style="">  52 @SuppressWarnings(&quot;WeakerAccess&quot;)                                                                        </span>
<span class="5349391072386910749" onmouseenter="enter('5349391072386910749');" onmouseout="out('5349391072386910749');" style="">  53 class JobExecutor {                                                                                      </span>
<span class="576747690139556584" onmouseenter="enter('576747690139556584');" onmouseout="out('576747690139556584');" style="">  54     private static final CatLog CAT = new JobCat(&quot;JobExecutor&quot;);                                         </span>
<span  style="">  55                                                                                                          </span>
<span class="-5421707713164059680" onmouseenter="enter('-5421707713164059680');" onmouseout="out('-5421707713164059680');" style="">  56     private static final long WAKE_LOCK_TIMEOUT = TimeUnit.MINUTES.toMillis(3);                          </span>
<span  style="">  57                                                                                                          </span>
<span class="7359818073840972103" onmouseenter="enter('7359818073840972103');" onmouseout="out('7359818073840972103');" style="">  58     private final ExecutorService mExecutorService;                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="8563677107443486094" onmouseenter="enter('8563677107443486094');" onmouseout="out('8563677107443486094');" style="">  60     // only cached in memory, that&#x27;s fine                                                                </span>
<span class="-8963975558179470647" onmouseenter="enter('-8963975558179470647');" onmouseout="out('-8963975558179470647');" style="">  61     private final SparseArray&lt;Job&gt; mJobs; // only cached in memory, that&#x27;s fine                          </span>
<span  style="">  62                                                                                                          </span>
<span class="-1720597333174085800" onmouseenter="enter('-1720597333174085800');" onmouseout="out('-1720597333174085800');" style="">  63     private final LruCache&lt;Integer, Job&gt; mFinishedJobsCache;                                             </span>
<span  style="">  64                                                                                                          </span>
<span class="-170958784796080443" onmouseenter="enter('-170958784796080443');" onmouseout="out('-170958784796080443');" style="">  65     private final Set&lt;JobRequest&gt; mStartingRequests;                                                     </span>
<span  style="">  66                                                                                                          </span>
<span class="8108192534285727070" onmouseenter="enter('8108192534285727070');" onmouseout="out('8108192534285727070');" style="">  67     public JobExecutor() {                                                                               </span>
<span class="9104164227028974115" onmouseenter="enter('9104164227028974115');" onmouseout="out('9104164227028974115');" style="">  68         mExecutorService = Executors.newCachedThreadPool(JobProxy.Common.COMMON_THREAD_FACTORY);         </span>
<span class="-8499890188721472813" onmouseenter="enter('-8499890188721472813');" onmouseout="out('-8499890188721472813');" style="">  69         mJobs = new SparseArray&lt;&gt;();                                                                     </span>
<span class="1383362030898242023" onmouseenter="enter('1383362030898242023');" onmouseout="out('1383362030898242023');" style="">  70         mFinishedJobsCache = new LruCache&lt;&gt;(20);                                                         </span>
<span class="8767836813738270555" onmouseenter="enter('8767836813738270555');" onmouseout="out('8767836813738270555');" style="">  71         mStartingRequests = new HashSet&lt;&gt;();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="9182735461914860252" onmouseenter="enter('9182735461914860252');" onmouseout="out('9182735461914860252');" style="">  74     public synchronized Future&lt;Job.Result&gt; execute(@NonNull                                              </span>
<span class="969779565910799039" onmouseenter="enter('969779565910799039');" onmouseout="out('969779565910799039');" style="">  75     Context context, @NonNull                                                                            </span>
<span class="-3130935040465667812" onmouseenter="enter('-3130935040465667812');" onmouseout="out('-3130935040465667812');" style="">  76     JobRequest request, @Nullable                                                                        </span>
<span class="5943384871838459719" onmouseenter="enter('5943384871838459719');" onmouseout="out('5943384871838459719');" style="">  77     Job job, @NonNull                                                                                    </span>
<span class="-6818704493118073415" onmouseenter="enter('-6818704493118073415');" onmouseout="out('-6818704493118073415');" style="">  78     Bundle transientExtras) {                                                                            </span>
<span class="-7948427868544751410" onmouseenter="enter('-7948427868544751410');" onmouseout="out('-7948427868544751410');" style="">  79         mStartingRequests.remove(request);                                                               </span>
<span class="-7141982173540135040" onmouseenter="enter('-7141982173540135040');" onmouseout="out('-7141982173540135040');" style="">  80         if (job == null) {                                                                               </span>
<span class="-4717926091915407836" onmouseenter="enter('-4717926091915407836');" onmouseout="out('-4717926091915407836');" style="">  81             CAT.w(&quot;JobCreator returned null for tag %s&quot;, request.getTag());                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  82             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83         }                                                                                                </span>
<span class="-4214496584854592723" onmouseenter="enter('-4214496584854592723');" onmouseout="out('-4214496584854592723');" style="">  84         if (job.isFinished()) {                                                                          </span>
<span class="1641882686740069389" onmouseenter="enter('1641882686740069389');" onmouseout="out('1641882686740069389');" style=""><abbr title="  85             throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already run, a creator should always create a new Job instance&quot;, request.getTag()));">  85             throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already runðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86         }                                                                                                </span>
<span class="-6551595380421202658" onmouseenter="enter('-6551595380421202658');" onmouseout="out('-6551595380421202658');" style="">  87         job.setContext(context).setRequest(request, transientExtras);                                    </span>
<span class="-3496389814317983910" onmouseenter="enter('-3496389814317983910');" onmouseout="out('-3496389814317983910');" style="">  88         CAT.i(&quot;Executing %s, context %s&quot;, request, context.getClass().getSimpleName());                  </span>
<span class="7756124266948558527" onmouseenter="enter('7756124266948558527');" onmouseout="out('7756124266948558527');" style="">  89         mJobs.put(request.getJobId(), job);                                                              </span>
<span class="-2759486010452356572" onmouseenter="enter('-2759486010452356572');" onmouseout="out('-2759486010452356572');" style="">  90         return mExecutorService.submit(new JobCallable(job));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="6315068224860570324" onmouseenter="enter('6315068224860570324');" onmouseout="out('6315068224860570324');" style="">  93     public synchronized Job getJob(int jobId) {                                                          </span>
<span class="-4933915928635343379" onmouseenter="enter('-4933915928635343379');" onmouseout="out('-4933915928635343379');" style="">  94         Job job = mJobs.get(jobId);                                                                      </span>
<span class="9131330920108346670" onmouseenter="enter('9131330920108346670');" onmouseout="out('9131330920108346670');" style="">  95         return job != null ? job : mFinishedJobsCache.get(jobId);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="-5037647569549536082" onmouseenter="enter('-5037647569549536082');" onmouseout="out('-5037647569549536082');" style="">  98     public synchronized Set&lt;Job&gt; getAllJobs() {                                                          </span>
<span class="-4329558470024454466" onmouseenter="enter('-4329558470024454466');" onmouseout="out('-4329558470024454466');" style="">  99         return getAllJobsForTag(null);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100     }                                                                                                    </span>
<span  style=""> 101                                                                                                          </span>
<span class="-3367095245460479768" onmouseenter="enter('-3367095245460479768');" onmouseout="out('-3367095245460479768');" style=""> 102     public synchronized Set&lt;Job&gt; getAllJobsForTag(String tag) {                                          </span>
<span class="-4258991344607162939" onmouseenter="enter('-4258991344607162939');" onmouseout="out('-4258991344607162939');" style=""> 103         Set&lt;Job&gt; result = new HashSet&lt;&gt;();                                                               </span>
<span class="6866939828668136173" onmouseenter="enter('6866939828668136173');" onmouseout="out('6866939828668136173');" style=""> 104         for (int i = 0; i &lt; mJobs.size(); i++) {                                                         </span>
<span class="-3414641758550512724" onmouseenter="enter('-3414641758550512724');" onmouseout="out('-3414641758550512724');" style=""> 105             Job job = mJobs.valueAt(i);                                                                  </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 106             if (tag == null || tag.equals(job.getParams().getTag())) {                                   </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 107                 result.add(job);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109         }                                                                                                </span>
<span  style=""> 110                                                                                                          </span>
<span class="-2264054569659866843" onmouseenter="enter('-2264054569659866843');" onmouseout="out('-2264054569659866843');" style=""> 111         Map&lt;Integer, Job&gt; snapshot = mFinishedJobsCache.snapshot();                                      </span>
<span class="-6322784541538163711" onmouseenter="enter('-6322784541538163711');" onmouseout="out('-6322784541538163711');" style=""> 112         for (Job job : snapshot.values()) {                                                              </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 113             if (tag == null || tag.equals(job.getParams().getTag())) {                                   </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 114                 result.add(job);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116         }                                                                                                </span>
<span  style=""> 117                                                                                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 118         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119     }                                                                                                    </span>
<span  style=""> 120                                                                                                          </span>
<span class="-3311171878734742102" onmouseenter="enter('-3311171878734742102');" onmouseout="out('-3311171878734742102');" style=""> 121     public synchronized void markJobRequestStarting(@NonNull JobRequest request) {                       </span>
<span class="7669417470993648274" onmouseenter="enter('7669417470993648274');" onmouseout="out('7669417470993648274');" style=""> 122         mStartingRequests.add(request);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123     }                                                                                                    </span>
<span  style=""> 124                                                                                                          </span>
<span class="8072868544527549177" onmouseenter="enter('8072868544527549177');" onmouseout="out('8072868544527549177');" style=""> 125     public synchronized boolean isRequestStarting(JobRequest request) {                                  </span>
<span class="-2490254344651127179" onmouseenter="enter('-2490254344651127179');" onmouseout="out('-2490254344651127179');" style=""> 126         return request != null &amp;&amp; mStartingRequests.contains(request);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127     }                                                                                                    </span>
<span  style=""> 128                                                                                                          </span>
<span class="8851173145352107748" onmouseenter="enter('8851173145352107748');" onmouseout="out('8851173145352107748');" style=""> 129     private synchronized void markJobAsFinished(Job job) {                                               </span>
<span class="-8892670731929029868" onmouseenter="enter('-8892670731929029868');" onmouseout="out('-8892670731929029868');" style=""> 130         int id = job.getParams().getId();                                                                </span>
<span class="-2244622938524994118" onmouseenter="enter('-2244622938524994118');" onmouseout="out('-2244622938524994118');" style=""> 131         mJobs.remove(id);                                                                                </span>
<span class="-8975069377911450592" onmouseenter="enter('-8975069377911450592');" onmouseout="out('-8975069377911450592');" style=""> 132         mFinishedJobsCache.put(id, job);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133     }                                                                                                    </span>
<span  style=""> 134                                                                                                          </span>
<span class="-7822796101109017317" onmouseenter="enter('-7822796101109017317');" onmouseout="out('-7822796101109017317');" style=""> 135     private final class JobCallable implements Callable&lt;Job.Result&gt; {                                    </span>
<span class="315713153710651742" onmouseenter="enter('315713153710651742');" onmouseout="out('315713153710651742');" style=""> 136         private final Job mJob;                                                                          </span>
<span  style=""> 137                                                                                                          </span>
<span class="-6135444244809655879" onmouseenter="enter('-6135444244809655879');" onmouseout="out('-6135444244809655879');" style=""> 138         private final PowerManager.WakeLock mWakeLock;                                                   </span>
<span  style=""> 139                                                                                                          </span>
<span class="-5126963627044409337" onmouseenter="enter('-5126963627044409337');" onmouseout="out('-5126963627044409337');" style=""> 140         private JobCallable(Job job) {                                                                   </span>
<span class="-3335066324806711319" onmouseenter="enter('-3335066324806711319');" onmouseout="out('-3335066324806711319');" style=""> 141             mJob = job;                                                                                  </span>
<span class="-6023636646525680147" onmouseenter="enter('-6023636646525680147');" onmouseout="out('-6023636646525680147');" style=""> 142             Context context = mJob.getContext();                                                         </span>
<span class="2683095074953864920" onmouseenter="enter('2683095074953864920');" onmouseout="out('2683095074953864920');" style=""> 143             mWakeLock = WakeLockUtil.acquireWakeLock(context, &quot;JobExecutor&quot;, WAKE_LOCK_TIMEOUT);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144         }                                                                                                </span>
<span  style=""> 145                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 146         @Override                                                                                        </span>
<span class="6323418417803688808" onmouseenter="enter('6323418417803688808');" onmouseout="out('6323418417803688808');" style=""> 147         public Job.Result call() throws Exception {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148             try {                                                                                        </span>
<span class="-6011216104504266450" onmouseenter="enter('-6011216104504266450');" onmouseout="out('-6011216104504266450');" style=""> 149                 // just in case something was blocking and the wake lock is no longer acquired           </span>
<span class="-5083937556537798580" onmouseenter="enter('-5083937556537798580');" onmouseout="out('-5083937556537798580');" style=""> 150                 WakeLockUtil.acquireWakeLock(mJob.getContext(), mWakeLock, WAKE_LOCK_TIMEOUT);           </span>
<span class="2621723818868626915" onmouseenter="enter('2621723818868626915');" onmouseout="out('2621723818868626915');" style=""> 151                 return runJob();                                                                         </span>
<span  style=""> 152                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 153             } finally {                                                                                  </span>
<span class="-1515771294888401339" onmouseenter="enter('-1515771294888401339');" onmouseout="out('-1515771294888401339');" style=""> 154                 markJobAsFinished(mJob);                                                                 </span>
<span  style=""> 155                                                                                                          </span>
<span class="-2312673111584342243" onmouseenter="enter('-2312673111584342243');" onmouseout="out('-2312673111584342243');" style=""> 156                 if (mWakeLock == null || !mWakeLock.isHeld()) {                                          </span>
<span class="-4049068033076161723" onmouseenter="enter('-4049068033076161723');" onmouseout="out('-4049068033076161723');" style=""><abbr title=" 157                     CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to complete. This could have unintended side effects on your app.&quot;, mJob);"> 157                     CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to completðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                 }                                                                                        </span>
<span class="-2456668544624162744" onmouseenter="enter('-2456668544624162744');" onmouseout="out('-2456668544624162744');" style=""> 159                 WakeLockUtil.releaseWakeLock(mWakeLock);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161         }                                                                                                </span>
<span  style=""> 162                                                                                                          </span>
<span class="3483593114331671747" onmouseenter="enter('3483593114331671747');" onmouseout="out('3483593114331671747');" style=""> 163         private Job.Result runJob() {                                                                    </span>
<span class="2461081295092004331" onmouseenter="enter('2461081295092004331');" onmouseout="out('2461081295092004331');" style=""> 164             Job.Result result;                                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 165             try {                                                                                        </span>
<span class="9208532701010688008" onmouseenter="enter('9208532701010688008');" onmouseout="out('9208532701010688008');" style=""> 166                 result = mJob.runJob();                                                                  </span>
<span class="-4624927025006522705" onmouseenter="enter('-4624927025006522705');" onmouseout="out('-4624927025006522705');" style=""> 167                 CAT.i(&quot;Finished %s&quot;, mJob);                                                              </span>
<span class="-5322264062003378165" onmouseenter="enter('-5322264062003378165');" onmouseout="out('-5322264062003378165');" style=""> 168                 handleResult(mJob, result);                                                              </span>
<span class="-7297220256280336710" onmouseenter="enter('-7297220256280336710');" onmouseout="out('-7297220256280336710');" style=""> 169             } catch (java.lang.Throwable t) {                                                            </span>
<span class="8951614835287080134" onmouseenter="enter('8951614835287080134');" onmouseout="out('8951614835287080134');" style=""> 170                 CAT.e(t, &quot;Crashed %s&quot;, mJob);                                                            </span>
<span class="-4534202906344116597" onmouseenter="enter('-4534202906344116597');" onmouseout="out('-4534202906344116597');" style=""> 171                 result = mJob.getResult();// probably the default value                                  </span>
<span  style=""> 172                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173             }                                                                                            </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 174             return result;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span  style=""> 176                                                                                                          </span>
<span class="-2948063841233397522" onmouseenter="enter('-2948063841233397522');" onmouseout="out('-2948063841233397522');" style=""> 177         private void handleResult(Job job, Job.Result result) {                                          </span>
<span class="-7525907700149424181" onmouseenter="enter('-7525907700149424181');" onmouseout="out('-7525907700149424181');" style=""> 178             JobRequest request = mJob.getParams().getRequest();                                          </span>
<span class="2440857122486788839" onmouseenter="enter('2440857122486788839');" onmouseout="out('2440857122486788839');" style=""> 179             boolean incFailureCount = false;                                                             </span>
<span class="-3873932327052429859" onmouseenter="enter('-3873932327052429859');" onmouseout="out('-3873932327052429859');" style=""> 180             boolean updateLastRun = false;                                                               </span>
<span class="3005389923783173371" onmouseenter="enter('3005389923783173371');" onmouseout="out('3005389923783173371');" style=""> 181             if ((!request.isPeriodic()) &amp;&amp; Job.Result.RESCHEDULE.equals(result)) {                       </span>
<span class="-6622032481340356577" onmouseenter="enter('-6622032481340356577');" onmouseout="out('-6622032481340356577');" style=""> 182                 request = request.reschedule(true, true);                                                </span>
<span class="7935935301832840342" onmouseenter="enter('7935935301832840342');" onmouseout="out('7935935301832840342');" style=""> 183                 mJob.onReschedule(request.getJobId());                                                   </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 184                 updateLastRun = true;                                                                    </span>
<span class="-6871259328448204026" onmouseenter="enter('-6871259328448204026');" onmouseout="out('-6871259328448204026');" style=""> 185             } else if (request.isPeriodic()) {                                                           </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 186                 updateLastRun = true;                                                                    </span>
<span class="-2463949442393302720" onmouseenter="enter('-2463949442393302720');" onmouseout="out('-2463949442393302720');" style=""> 187                 if (!Job.Result.SUCCESS.equals(result)) {                                                </span>
<span class="-763742865901626052" onmouseenter="enter('-763742865901626052');" onmouseout="out('-763742865901626052');" style=""> 188                     incFailureCount = true;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190             }                                                                                            </span>
<span class="-8743699515814204118" onmouseenter="enter('-8743699515814204118');" onmouseout="out('-8743699515814204118');" style=""> 191             if (!job.isDeleted()) {                                                                      </span>
<span class="6249431087393884453" onmouseenter="enter('6249431087393884453');" onmouseout="out('6249431087393884453');" style=""> 192                 // otherwise it would be persisted again                                                 </span>
<span class="-7855248345985168704" onmouseenter="enter('-7855248345985168704');" onmouseout="out('-7855248345985168704');" style=""> 193                 if (incFailureCount || updateLastRun) {                                                  </span>
<span class="-1816332608229600478" onmouseenter="enter('-1816332608229600478');" onmouseout="out('-1816332608229600478');" style=""> 194                     // noinspection ConstantConditions                                                   </span>
<span class="8592094849717380902" onmouseenter="enter('8592094849717380902');" onmouseout="out('8592094849717380902');" style=""> 195                     request.updateStats(incFailureCount, updateLastRun);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200 }                                                                                                        </span>














</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2   * Copyright 2007-present Evernote Corporation.                                                                   </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3   * All rights reserved.                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4   *                                                                                                                </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5   * Redistribution and use in source and binary forms, with or without modification,                               </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6   * are permitted provided that the following conditions are met:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8   * 1. Redistributions of source code must retain the above copyright notice, this                                 </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9   *    list of conditions and the following disclaimer.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10   *                                                                                                                </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11   * 2. Redistributions in binary form must reproduce the above copyright notice,                                   </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12   *    this list of conditions and the following disclaimer in the documentation                                   </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13   *    and/or other materials provided with the distribution.                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14   *                                                                                                                </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                                </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                  </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                             </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18   * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                                </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                                 </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                                  </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                                </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22   * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                                </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23   * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                                      </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24   * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25   */                                                                                                               </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26  package com.evernote.android.job;                                                                                 </span>
<span  style="">  27                                                                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  28  import android.content.Context;                                                                                   </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import android.os.Bundle;                                                                                         </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  30  import android.os.PowerManager;                                                                                   </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31  import android.support.annotation.NonNull;                                                                        </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  32  import android.support.annotation.Nullable;                                                                       </span>
<span class="551815432473888695" onmouseenter="enter('551815432473888695');" onmouseout="out('551815432473888695');" style="">  33  import android.util.LruCache;                                                                                     </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  34  import android.util.SparseArray;                                                                                  </span>
<span  style="">  35                                                                                                                    </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  36  import com.evernote.android.job.util.JobCat;                                                                      </span>
<span  style="">  37                                                                                                                    </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  38  import net.vrallev.android.cat.CatLog;                                                                            </span>
<span  style="">  39                                                                                                                    </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  40  import java.util.HashSet;                                                                                         </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  41  import java.util.Locale;                                                                                          </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  42  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  43  import java.util.Set;                                                                                             </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  44  import java.util.concurrent.Callable;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  45  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  46  import java.util.concurrent.Executors;                                                                            </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  47  import java.util.concurrent.Future;                                                                               </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  48  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  49                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50  /**                                                                                                               </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  51   * @author rwondratschek                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52   */                                                                                                               </span>
<span class="-5429987873611314699" onmouseenter="enter('-5429987873611314699');" onmouseout="out('-5429987873611314699');" style="">  53  @SuppressWarnings(&quot;WeakerAccess&quot;)                                                                                 </span>
<span class="-6824039201147728245" onmouseenter="enter('-6824039201147728245');" onmouseout="out('-6824039201147728245');" style="">  54  /*package*/ class JobExecutor {                                                                                   </span>
<span  style="">  55                                                                                                                    </span>
<span class="576747690139556584" onmouseenter="enter('576747690139556584');" onmouseout="out('576747690139556584');" style="">  56      private static final CatLog CAT = new JobCat(&quot;JobExecutor&quot;);                                                  </span>
<span class="-5421707713164059680" onmouseenter="enter('-5421707713164059680');" onmouseout="out('-5421707713164059680');" style="">  57      private static final long WAKE_LOCK_TIMEOUT = TimeUnit.MINUTES.toMillis(3);                                   </span>
<span  style="">  58                                                                                                                    </span>
<span class="7359818073840972103" onmouseenter="enter('7359818073840972103');" onmouseout="out('7359818073840972103');" style="">  59      private final ExecutorService mExecutorService;                                                               </span>
<span  style="">  60                                                                                                                    </span>
<span class="-8963975558179470647" onmouseenter="enter('-8963975558179470647');" onmouseout="out('-8963975558179470647');" style="">  61      private final SparseArray&lt;Job&gt; mJobs; // only cached in memory, that&#x27;s fine                                   </span>
<span class="-1720597333174085800" onmouseenter="enter('-1720597333174085800');" onmouseout="out('-1720597333174085800');" style="">  62      private final LruCache&lt;Integer, Job&gt; mFinishedJobsCache;                                                      </span>
<span  style="">  63                                                                                                                    </span>


<span class="8108192534285727070" onmouseenter="enter('8108192534285727070');" onmouseout="out('8108192534285727070');" style="">  64      public JobExecutor() {                                                                                        </span>
<span class="9104164227028974115" onmouseenter="enter('9104164227028974115');" onmouseout="out('9104164227028974115');" style="">  65          mExecutorService = Executors.newCachedThreadPool(JobProxy.Common.COMMON_THREAD_FACTORY);                  </span>
<span class="-8499890188721472813" onmouseenter="enter('-8499890188721472813');" onmouseout="out('-8499890188721472813');" style="">  66          mJobs = new SparseArray&lt;&gt;();                                                                              </span>
<span class="1383362030898242023" onmouseenter="enter('1383362030898242023');" onmouseout="out('1383362030898242023');" style="">  67          mFinishedJobsCache = new LruCache&lt;&gt;(20);                                                                  </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68      }                                                                                                             </span>
<span  style="">  69                                                                                                                    </span>
<span class="4956090937900533597" onmouseenter="enter('4956090937900533597');" onmouseout="out('4956090937900533597');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  70 -    public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job) {">  70 -    public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @NullablðŸ”µ</abbr></span>
<span class="-7126529935599950105" onmouseenter="enter('-7126529935599950105');" onmouseout="out('-7126529935599950105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  71 +    public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job, @NonNull Bundle transientExtras) {">  71 +    public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @NullablðŸ”µ</abbr></span>

<span class="-7141982173540135040" onmouseenter="enter('-7141982173540135040');" onmouseout="out('-7141982173540135040');" style="">  72          if (job == null) {                                                                                        </span>
<span class="-4717926091915407836" onmouseenter="enter('-4717926091915407836');" onmouseout="out('-4717926091915407836');" style="">  73              CAT.w(&quot;JobCreator returned null for tag %s&quot;, request.getTag());                                       </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  74              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75          }                                                                                                         </span>
<span class="-4214496584854592723" onmouseenter="enter('-4214496584854592723');" onmouseout="out('-4214496584854592723');" style="">  76          if (job.isFinished()) {                                                                                   </span>
<span class="1641882686740069389" onmouseenter="enter('1641882686740069389');" onmouseout="out('1641882686740069389');" style=""><abbr title="  77              throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already run, a creator should always create a new Job instance&quot;, request.getTag()));">  77              throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already run, a creatðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78          }                                                                                                         </span>
<span  style="">  79                                                                                                                    </span>
<span class="5530185459030043342" onmouseenter="enter('5530185459030043342');" onmouseout="out('5530185459030043342');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -        job.setContext(context).setRequest(request);                                                              </span>
<span class="-6551595380421202658" onmouseenter="enter('-6551595380421202658');" onmouseout="out('-6551595380421202658');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +        job.setContext(context).setRequest(request, transientExtras);                                             </span>
<span  style="">  82                                                                                                                    </span>
<span class="-3496389814317983910" onmouseenter="enter('-3496389814317983910');" onmouseout="out('-3496389814317983910');" style="">  83          CAT.i(&quot;Executing %s, context %s&quot;, request, context.getClass().getSimpleName());                           </span>
<span  style="">  84                                                                                                                    </span>
<span class="7756124266948558527" onmouseenter="enter('7756124266948558527');" onmouseout="out('7756124266948558527');" style="">  85          mJobs.put(request.getJobId(), job);                                                                       </span>
<span class="-2759486010452356572" onmouseenter="enter('-2759486010452356572');" onmouseout="out('-2759486010452356572');" style="">  86          return mExecutorService.submit(new JobCallable(job));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87      }                                                                                                             </span>
<span  style="">  88                                                                                                                    </span>
<span class="6315068224860570324" onmouseenter="enter('6315068224860570324');" onmouseout="out('6315068224860570324');" style="">  89      public synchronized Job getJob(int jobId) {                                                                   </span>
<span class="-4933915928635343379" onmouseenter="enter('-4933915928635343379');" onmouseout="out('-4933915928635343379');" style="">  90          Job job = mJobs.get(jobId);                                                                               </span>
<span class="9131330920108346670" onmouseenter="enter('9131330920108346670');" onmouseout="out('9131330920108346670');" style="">  91          return job != null ? job : mFinishedJobsCache.get(jobId);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92      }                                                                                                             </span>
<span  style="">  93                                                                                                                    </span>
<span class="-5037647569549536082" onmouseenter="enter('-5037647569549536082');" onmouseout="out('-5037647569549536082');" style="">  94      public synchronized Set&lt;Job&gt; getAllJobs() {                                                                   </span>
<span class="-4329558470024454466" onmouseenter="enter('-4329558470024454466');" onmouseout="out('-4329558470024454466');" style="">  95          return getAllJobsForTag(null);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96      }                                                                                                             </span>
<span  style="">  97                                                                                                                    </span>
<span class="-3367095245460479768" onmouseenter="enter('-3367095245460479768');" onmouseout="out('-3367095245460479768');" style="">  98      public synchronized Set&lt;Job&gt; getAllJobsForTag(String tag) {                                                   </span>
<span class="-4258991344607162939" onmouseenter="enter('-4258991344607162939');" onmouseout="out('-4258991344607162939');" style="">  99          Set&lt;Job&gt; result = new HashSet&lt;&gt;();                                                                        </span>
<span class="6866939828668136173" onmouseenter="enter('6866939828668136173');" onmouseout="out('6866939828668136173');" style=""> 100          for (int i = 0; i &lt; mJobs.size(); i++) {                                                                  </span>
<span class="-3414641758550512724" onmouseenter="enter('-3414641758550512724');" onmouseout="out('-3414641758550512724');" style=""> 101              Job job = mJobs.valueAt(i);                                                                           </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 102              if (tag == null || tag.equals(job.getParams().getTag())) {                                            </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 103                  result.add(job);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105          }                                                                                                         </span>
<span  style=""> 106                                                                                                                    </span>
<span class="-2264054569659866843" onmouseenter="enter('-2264054569659866843');" onmouseout="out('-2264054569659866843');" style=""> 107          Map&lt;Integer, Job&gt; snapshot = mFinishedJobsCache.snapshot();                                               </span>
<span class="-6322784541538163711" onmouseenter="enter('-6322784541538163711');" onmouseout="out('-6322784541538163711');" style=""> 108          for (Job job : snapshot.values()) {                                                                       </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 109              if (tag == null || tag.equals(job.getParams().getTag())) {                                            </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 110                  result.add(job);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112          }                                                                                                         </span>
<span  style=""> 113                                                                                                                    </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 114          return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115      }                                                                                                             </span>
<span  style=""> 116                                                                                                                    </span>








<span class="8851173145352107748" onmouseenter="enter('8851173145352107748');" onmouseout="out('8851173145352107748');" style=""> 117      private synchronized void markJobAsFinished(Job job) {                                                        </span>
<span class="-8892670731929029868" onmouseenter="enter('-8892670731929029868');" onmouseout="out('-8892670731929029868');" style=""> 118          int id = job.getParams().getId();                                                                         </span>
<span class="-2244622938524994118" onmouseenter="enter('-2244622938524994118');" onmouseout="out('-2244622938524994118');" style=""> 119          mJobs.remove(id);                                                                                         </span>
<span class="-8975069377911450592" onmouseenter="enter('-8975069377911450592');" onmouseout="out('-8975069377911450592');" style=""> 120          mFinishedJobsCache.put(id, job);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121      }                                                                                                             </span>
<span  style=""> 122                                                                                                                    </span>
<span class="-7822796101109017317" onmouseenter="enter('-7822796101109017317');" onmouseout="out('-7822796101109017317');" style=""> 123      private final class JobCallable implements Callable&lt;Job.Result&gt; {                                             </span>
<span  style=""> 124                                                                                                                    </span>
<span class="315713153710651742" onmouseenter="enter('315713153710651742');" onmouseout="out('315713153710651742');" style=""> 125          private final Job mJob;                                                                                   </span>
<span class="-6135444244809655879" onmouseenter="enter('-6135444244809655879');" onmouseout="out('-6135444244809655879');" style=""> 126          private final PowerManager.WakeLock mWakeLock;                                                            </span>
<span  style=""> 127                                                                                                                    </span>
<span class="-5126963627044409337" onmouseenter="enter('-5126963627044409337');" onmouseout="out('-5126963627044409337');" style=""> 128          private JobCallable(Job job) {                                                                            </span>
<span class="-3335066324806711319" onmouseenter="enter('-3335066324806711319');" onmouseout="out('-3335066324806711319');" style=""> 129              mJob = job;                                                                                           </span>
<span  style=""> 130                                                                                                                    </span>
<span class="-6023636646525680147" onmouseenter="enter('-6023636646525680147');" onmouseout="out('-6023636646525680147');" style=""> 131              Context context = mJob.getContext();                                                                  </span>
<span class="2683095074953864920" onmouseenter="enter('2683095074953864920');" onmouseout="out('2683095074953864920');" style=""> 132              mWakeLock = WakeLockUtil.acquireWakeLock(context, &quot;JobExecutor&quot;, WAKE_LOCK_TIMEOUT);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133          }                                                                                                         </span>
<span  style=""> 134                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 135          @Override                                                                                                 </span>
<span class="6323418417803688808" onmouseenter="enter('6323418417803688808');" onmouseout="out('6323418417803688808');" style=""> 136          public Job.Result call() throws Exception {                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 137              try {                                                                                                 </span>
<span class="-6011216104504266450" onmouseenter="enter('-6011216104504266450');" onmouseout="out('-6011216104504266450');" style=""> 138                  // just in case something was blocking and the wake lock is no longer acquired                    </span>
<span class="-5083937556537798580" onmouseenter="enter('-5083937556537798580');" onmouseout="out('-5083937556537798580');" style=""> 139                  WakeLockUtil.acquireWakeLock(mJob.getContext(), mWakeLock, WAKE_LOCK_TIMEOUT);                    </span>
<span class="2621723818868626915" onmouseenter="enter('2621723818868626915');" onmouseout="out('2621723818868626915');" style=""> 140                  return runJob();                                                                                  </span>
<span  style=""> 141                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 142              } finally {                                                                                           </span>
<span class="-1515771294888401339" onmouseenter="enter('-1515771294888401339');" onmouseout="out('-1515771294888401339');" style=""> 143                  markJobAsFinished(mJob);                                                                          </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2312673111584342243" onmouseenter="enter('-2312673111584342243');" onmouseout="out('-2312673111584342243');" style=""> 145                  if (mWakeLock == null || !mWakeLock.isHeld()) {                                                   </span>
<span class="-4049068033076161723" onmouseenter="enter('-4049068033076161723');" onmouseout="out('-4049068033076161723');" style=""><abbr title=" 146                      CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to complete. This could have unintended side effects on your app.&quot;, mJob);"> 146                      CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to complete. This cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                  }                                                                                                 </span>
<span class="-2456668544624162744" onmouseenter="enter('-2456668544624162744');" onmouseout="out('-2456668544624162744');" style=""> 148                  WakeLockUtil.releaseWakeLock(mWakeLock);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150          }                                                                                                         </span>
<span  style=""> 151                                                                                                                    </span>
<span class="3483593114331671747" onmouseenter="enter('3483593114331671747');" onmouseout="out('3483593114331671747');" style=""> 152          private Job.Result runJob() {                                                                             </span>
<span class="2461081295092004331" onmouseenter="enter('2461081295092004331');" onmouseout="out('2461081295092004331');" style=""> 153              Job.Result result;                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 154              try {                                                                                                 </span>
<span class="9208532701010688008" onmouseenter="enter('9208532701010688008');" onmouseout="out('9208532701010688008');" style=""> 155                  result = mJob.runJob();                                                                           </span>
<span class="-4624927025006522705" onmouseenter="enter('-4624927025006522705');" onmouseout="out('-4624927025006522705');" style=""> 156                  CAT.i(&quot;Finished %s&quot;, mJob);                                                                       </span>
<span  style=""> 157                                                                                                                    </span>
<span class="2179321764382153550" onmouseenter="enter('2179321764382153550');" onmouseout="out('2179321764382153550');" style=""> 158                  handleResult(result);                                                                             </span>

<span  style=""> 159                                                                                                                    </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 160              } catch (Throwable t) {                                                                               </span>
<span class="8951614835287080134" onmouseenter="enter('8951614835287080134');" onmouseout="out('8951614835287080134');" style=""> 161                  CAT.e(t, &quot;Crashed %s&quot;, mJob);                                                                     </span>
<span class="-4148228902169329570" onmouseenter="enter('-4148228902169329570');" onmouseout="out('-4148228902169329570');" style=""> 162                  result = mJob.getResult(); // probably the default value                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163              }                                                                                                     </span>
<span  style=""> 164                                                                                                                    </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 165              return result;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166          }                                                                                                         </span>
<span  style=""> 167                                                                                                                    </span>
<span class="6014945314581822918" onmouseenter="enter('6014945314581822918');" onmouseout="out('6014945314581822918');" style=""> 168          private void handleResult(Job.Result result) {                                                            </span>

<span class="-7525907700149424181" onmouseenter="enter('-7525907700149424181');" onmouseout="out('-7525907700149424181');" style=""> 169              JobRequest request = mJob.getParams().getRequest();                                                   </span>
<span class="2440857122486788839" onmouseenter="enter('2440857122486788839');" onmouseout="out('2440857122486788839');" style=""> 170              boolean incFailureCount = false;                                                                      </span>
<span class="-3873932327052429859" onmouseenter="enter('-3873932327052429859');" onmouseout="out('-3873932327052429859');" style=""> 171              boolean updateLastRun = false;                                                                        </span>
<span  style=""> 172                                                                                                                    </span>
<span class="-3405704552005865671" onmouseenter="enter('-3405704552005865671');" onmouseout="out('-3405704552005865671');" style=""> 173              if (!request.isPeriodic() &amp;&amp; Job.Result.RESCHEDULE.equals(result)) {                                  </span>
<span class="-6622032481340356577" onmouseenter="enter('-6622032481340356577');" onmouseout="out('-6622032481340356577');" style=""> 174                  request = request.reschedule(true, true);                                                         </span>
<span class="7935935301832840342" onmouseenter="enter('7935935301832840342');" onmouseout="out('7935935301832840342');" style=""> 175                  mJob.onReschedule(request.getJobId());                                                            </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 176                  updateLastRun = true;                                                                             </span>
<span  style=""> 177                                                                                                                    </span>
<span class="-6871259328448204026" onmouseenter="enter('-6871259328448204026');" onmouseout="out('-6871259328448204026');" style=""> 178              } else if (request.isPeriodic()) {                                                                    </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 179                  updateLastRun = true;                                                                             </span>
<span class="-2463949442393302720" onmouseenter="enter('-2463949442393302720');" onmouseout="out('-2463949442393302720');" style=""> 180                  if (!Job.Result.SUCCESS.equals(result)) {                                                         </span>
<span class="-763742865901626052" onmouseenter="enter('-763742865901626052');" onmouseout="out('-763742865901626052');" style=""> 181                      incFailureCount = true;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182                  }                                                                                                 </span>
<span  style=""> 183                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184              }                                                                                                     </span>
<span  style=""> 185                                                                                                                    </span>
<span class="-7855248345985168704" onmouseenter="enter('-7855248345985168704');" onmouseout="out('-7855248345985168704');" style=""> 186              if (incFailureCount || updateLastRun) {                                                               </span>
<span class="-155981268798468651" onmouseenter="enter('-155981268798468651');" onmouseout="out('-155981268798468651');" style=""> 187                  //noinspection ConstantConditions                                                                 </span>
<span class="8592094849717380902" onmouseenter="enter('8592094849717380902');" onmouseout="out('8592094849717380902');" style=""> 188                  request.updateStats(incFailureCount, updateLastRun);                                              </span>






<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2   * Copyright 2007-present Evernote Corporation.                                                                   </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3   * All rights reserved.                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4   *                                                                                                                </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5   * Redistribution and use in source and binary forms, with or without modification,                               </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6   * are permitted provided that the following conditions are met:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8   * 1. Redistributions of source code must retain the above copyright notice, this                                 </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9   *    list of conditions and the following disclaimer.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10   *                                                                                                                </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11   * 2. Redistributions in binary form must reproduce the above copyright notice,                                   </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12   *    this list of conditions and the following disclaimer in the documentation                                   </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13   *    and/or other materials provided with the distribution.                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14   *                                                                                                                </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                                </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                  </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                             </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18   * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                                </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                                 </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                                  </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                                </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22   * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                                </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23   * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                                      </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24   * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25   */                                                                                                               </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26  package com.evernote.android.job;                                                                                 </span>
<span  style="">  27                                                                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  28  import android.content.Context;                                                                                   </span>

<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  29  import android.os.PowerManager;                                                                                   </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  30  import android.support.annotation.NonNull;                                                                        </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  31  import android.support.annotation.Nullable;                                                                       </span>
<span class="551815432473888695" onmouseenter="enter('551815432473888695');" onmouseout="out('551815432473888695');" style="">  32  import android.util.LruCache;                                                                                     </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  33  import android.util.SparseArray;                                                                                  </span>
<span  style="">  34                                                                                                                    </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  35  import com.evernote.android.job.util.JobCat;                                                                      </span>
<span  style="">  36                                                                                                                    </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  37  import net.vrallev.android.cat.CatLog;                                                                            </span>
<span  style="">  38                                                                                                                    </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  39  import java.util.HashSet;                                                                                         </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  40  import java.util.Locale;                                                                                          </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  41  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  42  import java.util.Set;                                                                                             </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  43  import java.util.concurrent.Callable;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  44  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  45  import java.util.concurrent.Executors;                                                                            </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  46  import java.util.concurrent.Future;                                                                               </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  47  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  48                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49  /**                                                                                                               </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  50   * @author rwondratschek                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  51   */                                                                                                               </span>
<span class="-5429987873611314699" onmouseenter="enter('-5429987873611314699');" onmouseout="out('-5429987873611314699');" style="">  52  @SuppressWarnings(&quot;WeakerAccess&quot;)                                                                                 </span>
<span class="-6824039201147728245" onmouseenter="enter('-6824039201147728245');" onmouseout="out('-6824039201147728245');" style="">  53  /*package*/ class JobExecutor {                                                                                   </span>
<span  style="">  54                                                                                                                    </span>
<span class="576747690139556584" onmouseenter="enter('576747690139556584');" onmouseout="out('576747690139556584');" style="">  55      private static final CatLog CAT = new JobCat(&quot;JobExecutor&quot;);                                                  </span>
<span class="-5421707713164059680" onmouseenter="enter('-5421707713164059680');" onmouseout="out('-5421707713164059680');" style="">  56      private static final long WAKE_LOCK_TIMEOUT = TimeUnit.MINUTES.toMillis(3);                                   </span>
<span  style="">  57                                                                                                                    </span>
<span class="7359818073840972103" onmouseenter="enter('7359818073840972103');" onmouseout="out('7359818073840972103');" style="">  58      private final ExecutorService mExecutorService;                                                               </span>
<span  style="">  59                                                                                                                    </span>
<span class="-8963975558179470647" onmouseenter="enter('-8963975558179470647');" onmouseout="out('-8963975558179470647');" style="">  60      private final SparseArray&lt;Job&gt; mJobs; // only cached in memory, that&#x27;s fine                                   </span>
<span class="-1720597333174085800" onmouseenter="enter('-1720597333174085800');" onmouseout="out('-1720597333174085800');" style="">  61      private final LruCache&lt;Integer, Job&gt; mFinishedJobsCache;                                                      </span>
<span  style="">  62                                                                                                                    </span>
<span class="-170958784796080443" onmouseenter="enter('-170958784796080443');" onmouseout="out('-170958784796080443');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +    private final Set&lt;JobRequest&gt; mStartingRequests;                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +                                                                                                                  </span>
<span class="8108192534285727070" onmouseenter="enter('8108192534285727070');" onmouseout="out('8108192534285727070');" style="">  65      public JobExecutor() {                                                                                        </span>
<span class="9104164227028974115" onmouseenter="enter('9104164227028974115');" onmouseout="out('9104164227028974115');" style="">  66          mExecutorService = Executors.newCachedThreadPool(JobProxy.Common.COMMON_THREAD_FACTORY);                  </span>
<span class="-8499890188721472813" onmouseenter="enter('-8499890188721472813');" onmouseout="out('-8499890188721472813');" style="">  67          mJobs = new SparseArray&lt;&gt;();                                                                              </span>
<span class="1383362030898242023" onmouseenter="enter('1383362030898242023');" onmouseout="out('1383362030898242023');" style="">  68          mFinishedJobsCache = new LruCache&lt;&gt;(20);                                                                  </span>
<span class="8767836813738270555" onmouseenter="enter('8767836813738270555');" onmouseout="out('8767836813738270555');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +        mStartingRequests = new HashSet&lt;&gt;();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70      }                                                                                                             </span>
<span  style="">  71                                                                                                                    </span>
<span class="4956090937900533597" onmouseenter="enter('4956090937900533597');" onmouseout="out('4956090937900533597');" style=""><abbr title="  72      public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @Nullable Job job) {">  72      public synchronized Future&lt;Job.Result&gt; execute(@NonNull Context context, @NonNull JobRequest request, @NullablðŸ”µ</abbr></span>
<span class="-7948427868544751410" onmouseenter="enter('-7948427868544751410');" onmouseout="out('-7948427868544751410');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +        mStartingRequests.remove(request);                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +                                                                                                                  </span>
<span class="-7141982173540135040" onmouseenter="enter('-7141982173540135040');" onmouseout="out('-7141982173540135040');" style="">  75          if (job == null) {                                                                                        </span>
<span class="-4717926091915407836" onmouseenter="enter('-4717926091915407836');" onmouseout="out('-4717926091915407836');" style="">  76              CAT.w(&quot;JobCreator returned null for tag %s&quot;, request.getTag());                                       </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  77              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78          }                                                                                                         </span>
<span class="-4214496584854592723" onmouseenter="enter('-4214496584854592723');" onmouseout="out('-4214496584854592723');" style="">  79          if (job.isFinished()) {                                                                                   </span>
<span class="1641882686740069389" onmouseenter="enter('1641882686740069389');" onmouseout="out('1641882686740069389');" style=""><abbr title="  80              throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already run, a creator should always create a new Job instance&quot;, request.getTag()));">  80              throw new IllegalStateException(String.format(Locale.ENGLISH, &quot;Job for tag %s was already run, a creatðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81          }                                                                                                         </span>
<span  style="">  82                                                                                                                    </span>
<span class="5530185459030043342" onmouseenter="enter('5530185459030043342');" onmouseout="out('5530185459030043342');" style="">  83          job.setContext(context).setRequest(request);                                                              </span>

<span  style="">  84                                                                                                                    </span>
<span class="-3496389814317983910" onmouseenter="enter('-3496389814317983910');" onmouseout="out('-3496389814317983910');" style="">  85          CAT.i(&quot;Executing %s, context %s&quot;, request, context.getClass().getSimpleName());                           </span>
<span  style="">  86                                                                                                                    </span>
<span class="7756124266948558527" onmouseenter="enter('7756124266948558527');" onmouseout="out('7756124266948558527');" style="">  87          mJobs.put(request.getJobId(), job);                                                                       </span>
<span class="-2759486010452356572" onmouseenter="enter('-2759486010452356572');" onmouseout="out('-2759486010452356572');" style="">  88          return mExecutorService.submit(new JobCallable(job));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89      }                                                                                                             </span>
<span  style="">  90                                                                                                                    </span>
<span class="6315068224860570324" onmouseenter="enter('6315068224860570324');" onmouseout="out('6315068224860570324');" style="">  91      public synchronized Job getJob(int jobId) {                                                                   </span>
<span class="-4933915928635343379" onmouseenter="enter('-4933915928635343379');" onmouseout="out('-4933915928635343379');" style="">  92          Job job = mJobs.get(jobId);                                                                               </span>
<span class="9131330920108346670" onmouseenter="enter('9131330920108346670');" onmouseout="out('9131330920108346670');" style="">  93          return job != null ? job : mFinishedJobsCache.get(jobId);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94      }                                                                                                             </span>
<span  style="">  95                                                                                                                    </span>
<span class="-5037647569549536082" onmouseenter="enter('-5037647569549536082');" onmouseout="out('-5037647569549536082');" style="">  96      public synchronized Set&lt;Job&gt; getAllJobs() {                                                                   </span>
<span class="-4329558470024454466" onmouseenter="enter('-4329558470024454466');" onmouseout="out('-4329558470024454466');" style="">  97          return getAllJobsForTag(null);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98      }                                                                                                             </span>
<span  style="">  99                                                                                                                    </span>
<span class="-3367095245460479768" onmouseenter="enter('-3367095245460479768');" onmouseout="out('-3367095245460479768');" style=""> 100      public synchronized Set&lt;Job&gt; getAllJobsForTag(String tag) {                                                   </span>
<span class="-4258991344607162939" onmouseenter="enter('-4258991344607162939');" onmouseout="out('-4258991344607162939');" style=""> 101          Set&lt;Job&gt; result = new HashSet&lt;&gt;();                                                                        </span>
<span class="6866939828668136173" onmouseenter="enter('6866939828668136173');" onmouseout="out('6866939828668136173');" style=""> 102          for (int i = 0; i &lt; mJobs.size(); i++) {                                                                  </span>
<span class="-3414641758550512724" onmouseenter="enter('-3414641758550512724');" onmouseout="out('-3414641758550512724');" style=""> 103              Job job = mJobs.valueAt(i);                                                                           </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 104              if (tag == null || tag.equals(job.getParams().getTag())) {                                            </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 105                  result.add(job);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107          }                                                                                                         </span>
<span  style=""> 108                                                                                                                    </span>
<span class="-2264054569659866843" onmouseenter="enter('-2264054569659866843');" onmouseout="out('-2264054569659866843');" style=""> 109          Map&lt;Integer, Job&gt; snapshot = mFinishedJobsCache.snapshot();                                               </span>
<span class="-6322784541538163711" onmouseenter="enter('-6322784541538163711');" onmouseout="out('-6322784541538163711');" style=""> 110          for (Job job : snapshot.values()) {                                                                       </span>
<span class="-7402795638304833627" onmouseenter="enter('-7402795638304833627');" onmouseout="out('-7402795638304833627');" style=""> 111              if (tag == null || tag.equals(job.getParams().getTag())) {                                            </span>
<span class="8030485672297709905" onmouseenter="enter('8030485672297709905');" onmouseout="out('8030485672297709905');" style=""> 112                  result.add(job);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114          }                                                                                                         </span>
<span  style=""> 115                                                                                                                    </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 116          return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117      }                                                                                                             </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-3311171878734742102" onmouseenter="enter('-3311171878734742102');" onmouseout="out('-3311171878734742102');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +    public synchronized void markJobRequestStarting(@NonNull JobRequest request) {                                </span>
<span class="7669417470993648274" onmouseenter="enter('7669417470993648274');" onmouseout="out('7669417470993648274');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +        mStartingRequests.add(request);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                                                                                                                  </span>
<span class="8072868544527549177" onmouseenter="enter('8072868544527549177');" onmouseout="out('8072868544527549177');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +    public synchronized boolean isRequestStarting(JobRequest request) {                                           </span>
<span class="-2490254344651127179" onmouseenter="enter('-2490254344651127179');" onmouseout="out('-2490254344651127179');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +        return request != null &amp;&amp; mStartingRequests.contains(request);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                                                                                                                  </span>
<span class="8851173145352107748" onmouseenter="enter('8851173145352107748');" onmouseout="out('8851173145352107748');" style=""> 127      private synchronized void markJobAsFinished(Job job) {                                                        </span>
<span class="-8892670731929029868" onmouseenter="enter('-8892670731929029868');" onmouseout="out('-8892670731929029868');" style=""> 128          int id = job.getParams().getId();                                                                         </span>
<span class="-2244622938524994118" onmouseenter="enter('-2244622938524994118');" onmouseout="out('-2244622938524994118');" style=""> 129          mJobs.remove(id);                                                                                         </span>
<span class="-8975069377911450592" onmouseenter="enter('-8975069377911450592');" onmouseout="out('-8975069377911450592');" style=""> 130          mFinishedJobsCache.put(id, job);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131      }                                                                                                             </span>
<span  style=""> 132                                                                                                                    </span>
<span class="-7822796101109017317" onmouseenter="enter('-7822796101109017317');" onmouseout="out('-7822796101109017317');" style=""> 133      private final class JobCallable implements Callable&lt;Job.Result&gt; {                                             </span>
<span  style=""> 134                                                                                                                    </span>
<span class="315713153710651742" onmouseenter="enter('315713153710651742');" onmouseout="out('315713153710651742');" style=""> 135          private final Job mJob;                                                                                   </span>
<span class="-6135444244809655879" onmouseenter="enter('-6135444244809655879');" onmouseout="out('-6135444244809655879');" style=""> 136          private final PowerManager.WakeLock mWakeLock;                                                            </span>
<span  style=""> 137                                                                                                                    </span>
<span class="-5126963627044409337" onmouseenter="enter('-5126963627044409337');" onmouseout="out('-5126963627044409337');" style=""> 138          private JobCallable(Job job) {                                                                            </span>
<span class="-3335066324806711319" onmouseenter="enter('-3335066324806711319');" onmouseout="out('-3335066324806711319');" style=""> 139              mJob = job;                                                                                           </span>
<span  style=""> 140                                                                                                                    </span>
<span class="-6023636646525680147" onmouseenter="enter('-6023636646525680147');" onmouseout="out('-6023636646525680147');" style=""> 141              Context context = mJob.getContext();                                                                  </span>
<span class="2683095074953864920" onmouseenter="enter('2683095074953864920');" onmouseout="out('2683095074953864920');" style=""> 142              mWakeLock = WakeLockUtil.acquireWakeLock(context, &quot;JobExecutor&quot;, WAKE_LOCK_TIMEOUT);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143          }                                                                                                         </span>
<span  style=""> 144                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 145          @Override                                                                                                 </span>
<span class="6323418417803688808" onmouseenter="enter('6323418417803688808');" onmouseout="out('6323418417803688808');" style=""> 146          public Job.Result call() throws Exception {                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 147              try {                                                                                                 </span>
<span class="-6011216104504266450" onmouseenter="enter('-6011216104504266450');" onmouseout="out('-6011216104504266450');" style=""> 148                  // just in case something was blocking and the wake lock is no longer acquired                    </span>
<span class="-5083937556537798580" onmouseenter="enter('-5083937556537798580');" onmouseout="out('-5083937556537798580');" style=""> 149                  WakeLockUtil.acquireWakeLock(mJob.getContext(), mWakeLock, WAKE_LOCK_TIMEOUT);                    </span>
<span class="2621723818868626915" onmouseenter="enter('2621723818868626915');" onmouseout="out('2621723818868626915');" style=""> 150                  return runJob();                                                                                  </span>
<span  style=""> 151                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 152              } finally {                                                                                           </span>
<span class="-1515771294888401339" onmouseenter="enter('-1515771294888401339');" onmouseout="out('-1515771294888401339');" style=""> 153                  markJobAsFinished(mJob);                                                                          </span>
<span  style=""> 154                                                                                                                    </span>
<span class="-2312673111584342243" onmouseenter="enter('-2312673111584342243');" onmouseout="out('-2312673111584342243');" style=""> 155                  if (mWakeLock == null || !mWakeLock.isHeld()) {                                                   </span>
<span class="-4049068033076161723" onmouseenter="enter('-4049068033076161723');" onmouseout="out('-4049068033076161723');" style=""><abbr title=" 156                      CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to complete. This could have unintended side effects on your app.&quot;, mJob);"> 156                      CAT.w(&quot;Wake lock was not held after job %s was done. The job took too long to complete. This cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                  }                                                                                                 </span>
<span class="-2456668544624162744" onmouseenter="enter('-2456668544624162744');" onmouseout="out('-2456668544624162744');" style=""> 158                  WakeLockUtil.releaseWakeLock(mWakeLock);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160          }                                                                                                         </span>
<span  style=""> 161                                                                                                                    </span>
<span class="3483593114331671747" onmouseenter="enter('3483593114331671747');" onmouseout="out('3483593114331671747');" style=""> 162          private Job.Result runJob() {                                                                             </span>
<span class="2461081295092004331" onmouseenter="enter('2461081295092004331');" onmouseout="out('2461081295092004331');" style=""> 163              Job.Result result;                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 164              try {                                                                                                 </span>
<span class="9208532701010688008" onmouseenter="enter('9208532701010688008');" onmouseout="out('9208532701010688008');" style=""> 165                  result = mJob.runJob();                                                                           </span>
<span class="-4624927025006522705" onmouseenter="enter('-4624927025006522705');" onmouseout="out('-4624927025006522705');" style=""> 166                  CAT.i(&quot;Finished %s&quot;, mJob);                                                                       </span>
<span  style=""> 167                                                                                                                    </span>
<span class="2179321764382153550" onmouseenter="enter('2179321764382153550');" onmouseout="out('2179321764382153550');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -                handleResult(result);                                                                             </span>
<span class="-5322264062003378165" onmouseenter="enter('-5322264062003378165');" onmouseout="out('-5322264062003378165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +                handleResult(mJob, result);                                                                       </span>
<span  style=""> 170                                                                                                                    </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 171              } catch (Throwable t) {                                                                               </span>
<span class="8951614835287080134" onmouseenter="enter('8951614835287080134');" onmouseout="out('8951614835287080134');" style=""> 172                  CAT.e(t, &quot;Crashed %s&quot;, mJob);                                                                     </span>
<span class="-4148228902169329570" onmouseenter="enter('-4148228902169329570');" onmouseout="out('-4148228902169329570');" style=""> 173                  result = mJob.getResult(); // probably the default value                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174              }                                                                                                     </span>
<span  style=""> 175                                                                                                                    </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 176              return result;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177          }                                                                                                         </span>
<span  style=""> 178                                                                                                                    </span>
<span class="6014945314581822918" onmouseenter="enter('6014945314581822918');" onmouseout="out('6014945314581822918');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -        private void handleResult(Job.Result result) {                                                            </span>
<span class="-2948063841233397522" onmouseenter="enter('-2948063841233397522');" onmouseout="out('-2948063841233397522');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +        private void handleResult(Job job, Job.Result result) {                                                   </span>
<span class="-7525907700149424181" onmouseenter="enter('-7525907700149424181');" onmouseout="out('-7525907700149424181');" style=""> 181              JobRequest request = mJob.getParams().getRequest();                                                   </span>
<span class="2440857122486788839" onmouseenter="enter('2440857122486788839');" onmouseout="out('2440857122486788839');" style=""> 182              boolean incFailureCount = false;                                                                      </span>
<span class="-3873932327052429859" onmouseenter="enter('-3873932327052429859');" onmouseout="out('-3873932327052429859');" style=""> 183              boolean updateLastRun = false;                                                                        </span>
<span  style=""> 184                                                                                                                    </span>
<span class="-3405704552005865671" onmouseenter="enter('-3405704552005865671');" onmouseout="out('-3405704552005865671');" style=""> 185              if (!request.isPeriodic() &amp;&amp; Job.Result.RESCHEDULE.equals(result)) {                                  </span>
<span class="-6622032481340356577" onmouseenter="enter('-6622032481340356577');" onmouseout="out('-6622032481340356577');" style=""> 186                  request = request.reschedule(true, true);                                                         </span>
<span class="7935935301832840342" onmouseenter="enter('7935935301832840342');" onmouseout="out('7935935301832840342');" style=""> 187                  mJob.onReschedule(request.getJobId());                                                            </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 188                  updateLastRun = true;                                                                             </span>
<span  style=""> 189                                                                                                                    </span>
<span class="-6871259328448204026" onmouseenter="enter('-6871259328448204026');" onmouseout="out('-6871259328448204026');" style=""> 190              } else if (request.isPeriodic()) {                                                                    </span>
<span class="7223340088576599477" onmouseenter="enter('7223340088576599477');" onmouseout="out('7223340088576599477');" style=""> 191                  updateLastRun = true;                                                                             </span>
<span class="-2463949442393302720" onmouseenter="enter('-2463949442393302720');" onmouseout="out('-2463949442393302720');" style=""> 192                  if (!Job.Result.SUCCESS.equals(result)) {                                                         </span>
<span class="-763742865901626052" onmouseenter="enter('-763742865901626052');" onmouseout="out('-763742865901626052');" style=""> 193                      incFailureCount = true;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194                  }                                                                                                 </span>
<span  style=""> 195                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196              }                                                                                                     </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-7855248345985168704" onmouseenter="enter('-7855248345985168704');" onmouseout="out('-7855248345985168704');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 198 -            if (incFailureCount || updateLastRun) {                                                               </span>
<span class="-155981268798468651" onmouseenter="enter('-155981268798468651');" onmouseout="out('-155981268798468651');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -                //noinspection ConstantConditions                                                                 </span>
<span class="8592094849717380902" onmouseenter="enter('8592094849717380902');" onmouseout="out('8592094849717380902');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -                request.updateStats(incFailureCount, updateLastRun);                                              </span>
<span class="-8743699515814204118" onmouseenter="enter('-8743699515814204118');" onmouseout="out('-8743699515814204118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +            if (!job.isDeleted()) {                                                                               </span>
<span class="6249431087393884453" onmouseenter="enter('6249431087393884453');" onmouseout="out('6249431087393884453');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +                // otherwise it would be persisted again                                                          </span>
<span class="-7855248345985168704" onmouseenter="enter('-7855248345985168704');" onmouseout="out('-7855248345985168704');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +                if (incFailureCount || updateLastRun) {                                                           </span>
<span class="-155981268798468651" onmouseenter="enter('-155981268798468651');" onmouseout="out('-155981268798468651');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +                    //noinspection ConstantConditions                                                             </span>
<span class="8592094849717380902" onmouseenter="enter('8592094849717380902');" onmouseout="out('8592094849717380902');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +                    request.updateStats(incFailureCount, updateLastRun);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            