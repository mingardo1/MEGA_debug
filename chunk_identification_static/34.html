<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>34</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    34
                    <a href="33.html">prev</a>
                    <a href="35.html">next</a>
                    <a href="34_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_2c75967bfc740973ac4528fbffe7752ada171bdf_Aria/src/main/java/com/arialyy/aria/core/upload/UploadUtil.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;2c75967bfc740973ac4528fbffe7752ada171bdf:Aria/src/main/java/com/arialyy/aria/core/upload/UploadUtil.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;2c75967bfc740973ac4528fbffe7752ada171bdf^1:Aria/src/main/java/com/arialyy/aria/core/upload/UploadUtil.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;2c75967bfc740973ac4528fbffe7752ada171bdf^2:Aria/src/main/java/com/arialyy/aria/core/upload/UploadUtil.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;a3cc5e6e4992f0c2b998a53e3e62e2c50960d0fe:Aria/src/main/java/com/arialyy/aria/core/upload/UploadUtil.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="2296433254624375089" onmouseenter="enter('2296433254624375089');" onmouseout="out('2296433254624375089');" style="">  16 package com.arialyy.aria.core.upload;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  18 import android.util.Log;                                                                                 </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  19 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="">  20 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  21 import java.io.File;                                                                                     </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  22 import java.io.FileInputStream;                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  23 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="">  24 import java.io.InputStreamReader;                                                                        </span>
<span class="4621164050749610193" onmouseenter="enter('4621164050749610193');" onmouseout="out('4621164050749610193');" style="">  25 import java.io.OutputStream;                                                                             </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="">  26 import java.io.OutputStreamWriter;                                                                       </span>
<span class="188494595561851451" onmouseenter="enter('188494595561851451');" onmouseout="out('188494595561851451');" style="">  27 import java.io.PrintWriter;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  28 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  29 import java.net.URL;                                                                                     </span>
<span class="-5521468699455618699" onmouseenter="enter('-5521468699455618699');" onmouseout="out('-5521468699455618699');" style="">  30 import java.net.URLConnection;                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  31 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  32 import java.util.UUID;                                                                                   </span>
<span  style="">  33                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  34 /**                                                                                                      </span>
<span class="-6400750417840662839" onmouseenter="enter('-6400750417840662839');" onmouseout="out('-6400750417840662839');" style="">  35  * Created by Aria.Lao on 2017/2/9.                                                                      </span>
<span class="-4299352450658306013" onmouseenter="enter('-4299352450658306013');" onmouseout="out('-4299352450658306013');" style="">  36  * 上传工具                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  37  */                                                                                                      </span>
<span class="-5707704917663703030" onmouseenter="enter('-5707704917663703030');" onmouseout="out('-5707704917663703030');" style="">  38 public class UploadUtil implements Runnable {                                                            </span>
<span class="-3724454848507439391" onmouseenter="enter('-3724454848507439391');" onmouseout="out('-3724454848507439391');" style="">  39   private static final String TAG = &quot;UploadUtil&quot;;                                                        </span>
<span class="4601955423512060976" onmouseenter="enter('4601955423512060976');" onmouseout="out('4601955423512060976');" style="">  40   private final String BOUNDARY = UUID.randomUUID().toString(); // 边界标识 随机生成                             </span>
<span class="-986211549012609109" onmouseenter="enter('-986211549012609109');" onmouseout="out('-986211549012609109');" style="">  41   private final String PREFIX = &quot;--&quot;, LINE_END = &quot;\r\n&quot;;                                                 </span>
<span class="-4895228480728785048" onmouseenter="enter('-4895228480728785048');" onmouseout="out('-4895228480728785048');" style="">  42   private UploadEntity mUploadEntity;                                                                    </span>
<span class="-7667731813459538063" onmouseenter="enter('-7667731813459538063');" onmouseout="out('-7667731813459538063');" style="">  43   private UploadTaskEntity mTaskEntity;                                                                  </span>
<span class="-4450121024944087023" onmouseenter="enter('-4450121024944087023');" onmouseout="out('-4450121024944087023');" style="">  44   private IUploadListener mListener;                                                                     </span>
<span class="-333925809319807249" onmouseenter="enter('-333925809319807249');" onmouseout="out('-333925809319807249');" style="">  45   private HttpURLConnection mHttpConn;                                                                   </span>
<span class="5356975924392872579" onmouseenter="enter('5356975924392872579');" onmouseout="out('5356975924392872579');" style="">  46   private long mCurrentLocation = 0;                                                                     </span>
<span class="6610618430806440993" onmouseenter="enter('6610618430806440993');" onmouseout="out('6610618430806440993');" style="">  47   private boolean isCancel = false;                                                                      </span>
<span class="-7014396160817654560" onmouseenter="enter('-7014396160817654560');" onmouseout="out('-7014396160817654560');" style="">  48   private boolean isRunning = false;                                                                     </span>
<span  style="">  49                                                                                                          </span>
<span class="-4378274624765085007" onmouseenter="enter('-4378274624765085007');" onmouseout="out('-4378274624765085007');" style="">  50   public UploadUtil(UploadTaskEntity taskEntity, IUploadListener listener) {                             </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  51     mTaskEntity = taskEntity;                                                                            </span>
<span class="-5397140926211959544" onmouseenter="enter('-5397140926211959544');" onmouseout="out('-5397140926211959544');" style="">  52     CheckUtil.checkUploadEntity(taskEntity.uploadEntity);                                                </span>
<span class="7818534483611280473" onmouseenter="enter('7818534483611280473');" onmouseout="out('7818534483611280473');" style="">  53     mUploadEntity = taskEntity.uploadEntity;                                                             </span>
<span class="6410471256291283437" onmouseenter="enter('6410471256291283437');" onmouseout="out('6410471256291283437');" style="">  54     if (listener == null) {                                                                              </span>
<span class="-3877746287627857629" onmouseenter="enter('-3877746287627857629');" onmouseout="out('-3877746287627857629');" style="">  55       throw new IllegalArgumentException(&quot;上传监听不能为空&quot;);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56     }                                                                                                    </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  57     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58   }                                                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="-2648331188945203940" onmouseenter="enter('-2648331188945203940');" onmouseout="out('-2648331188945203940');" style="">  60   public void start() {                                                                                  </span>
<span class="7658640897919599872" onmouseenter="enter('7658640897919599872');" onmouseout="out('7658640897919599872');" style="">  61     Log.d(TAG, &quot;start&quot;);                                                                                 </span>
<span class="-5580853241009618205" onmouseenter="enter('-5580853241009618205');" onmouseout="out('-5580853241009618205');" style="">  62     isCancel = false;                                                                                    </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  63     isRunning = false;                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="">  64     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65   }                                                                                                      </span>
<span  style="">  66                                                                                                          </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style="">  67   public void cancel() {                                                                                 </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="">  68     isCancel = true;                                                                                     </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  69     isRunning = false;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70   }                                                                                                      </span>
<span  style="">  71                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  72   @Override public void run() {                                                                          </span>
<span class="-3930199446811223366" onmouseenter="enter('-3930199446811223366');" onmouseout="out('-3930199446811223366');" style="">  73     Log.e(TAG, &quot;run&quot;);                                                                                   </span>
<span class="-4654815309234540461" onmouseenter="enter('-4654815309234540461');" onmouseout="out('-4654815309234540461');" style="">  74     File uploadFile = new File(mUploadEntity.getFilePath());                                             </span>
<span class="-7440468768172298093" onmouseenter="enter('-7440468768172298093');" onmouseout="out('-7440468768172298093');" style="">  75     if (!uploadFile.exists()) {                                                                          </span>
<span class="3670297489558872216" onmouseenter="enter('3670297489558872216');" onmouseout="out('3670297489558872216');" style="">  76       Log.e(TAG, &quot;【&quot; + mUploadEntity.getFilePath() + &quot;】，文件不存在。&quot;);                                        </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style="">  77       fail();                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  78       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79     }                                                                                                    </span>
<span  style="">  80                                                                                                          </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="">  81     mListener.onPre();                                                                                   </span>
<span  style="">  82                                                                                                          </span>
<span class="3442630168795471555" onmouseenter="enter('3442630168795471555');" onmouseout="out('3442630168795471555');" style="">  83     URL url;                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  84     try {                                                                                                </span>
<span class="-3237270879792511864" onmouseenter="enter('-3237270879792511864');" onmouseout="out('-3237270879792511864');" style="">  85       url = new URL(mTaskEntity.uploadUrl);                                                              </span>
<span class="-9098060409631350199" onmouseenter="enter('-9098060409631350199');" onmouseout="out('-9098060409631350199');" style="">  86       mHttpConn = (HttpURLConnection) url.openConnection();                                              </span>
<span class="-8042386604808273921" onmouseenter="enter('-8042386604808273921');" onmouseout="out('-8042386604808273921');" style="">  87       mHttpConn.setUseCaches(false);                                                                     </span>
<span class="-819609990863481625" onmouseenter="enter('-819609990863481625');" onmouseout="out('-819609990863481625');" style="">  88       mHttpConn.setDoOutput(true);                                                                       </span>
<span class="-2828311995571883529" onmouseenter="enter('-2828311995571883529');" onmouseout="out('-2828311995571883529');" style="">  89       mHttpConn.setDoInput(true);                                                                        </span>
<span class="7496337321827260410" onmouseenter="enter('7496337321827260410');" onmouseout="out('7496337321827260410');" style="">  90       mHttpConn.setRequestProperty(&quot;Content-Type&quot;,                                                       </span>
<span class="-6872149995828718188" onmouseenter="enter('-6872149995828718188');" onmouseout="out('-6872149995828718188');" style="">  91           mTaskEntity.contentType + &quot;; boundary=&quot; + BOUNDARY);                                           </span>
<span class="-1152444464189443777" onmouseenter="enter('-1152444464189443777');" onmouseout="out('-1152444464189443777');" style="">  92       mHttpConn.setRequestProperty(&quot;User-Agent&quot;, mTaskEntity.userAgent);                                 </span>
<span class="9024482569447258132" onmouseenter="enter('9024482569447258132');" onmouseout="out('9024482569447258132');" style="">  93       //mHttpConn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot; + &quot;100&quot;);                               </span>
<span class="-7778714341502295972" onmouseenter="enter('-7778714341502295972');" onmouseout="out('-7778714341502295972');" style="">  94       //内部缓冲区---分段上传防止oom                                                                                </span>
<span class="2953946561574030999" onmouseenter="enter('2953946561574030999');" onmouseout="out('2953946561574030999');" style="">  95       mHttpConn.setChunkedStreamingMode(1024);                                                           </span>
<span  style="">  96                                                                                                          </span>
<span class="-8255006708775639880" onmouseenter="enter('-8255006708775639880');" onmouseout="out('-8255006708775639880');" style="">  97       //添加Http请求头部                                                                                       </span>
<span class="2465544298625110221" onmouseenter="enter('2465544298625110221');" onmouseout="out('2465544298625110221');" style="">  98       Set&lt;String&gt; keys = mTaskEntity.headers.keySet();                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  99       for (String key : keys) {                                                                          </span>
<span class="6920539915464580201" onmouseenter="enter('6920539915464580201');" onmouseout="out('6920539915464580201');" style=""> 100         mHttpConn.setRequestProperty(key, mTaskEntity.headers.get(key));                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101       }                                                                                                  </span>
<span  style=""> 102                                                                                                          </span>
<span class="-5663197000219230409" onmouseenter="enter('-5663197000219230409');" onmouseout="out('-5663197000219230409');" style=""> 103       OutputStream outputStream = mHttpConn.getOutputStream();                                           </span>
<span class="-5601399779707962135" onmouseenter="enter('-5601399779707962135');" onmouseout="out('-5601399779707962135');" style=""> 104       PrintWriter writer =                                                                               </span>
<span class="-6867234444748414110" onmouseenter="enter('-6867234444748414110');" onmouseout="out('-6867234444748414110');" style=""> 105           new PrintWriter(new OutputStreamWriter(outputStream, mTaskEntity.charset), true);              </span>
<span  style=""> 106                                                                                                          </span>
<span class="7728457972062474717" onmouseenter="enter('7728457972062474717');" onmouseout="out('7728457972062474717');" style=""> 107       //添加文件上传表单字段                                                                                       </span>
<span class="-8415422093392386204" onmouseenter="enter('-8415422093392386204');" onmouseout="out('-8415422093392386204');" style=""> 108       keys = mTaskEntity.formFields.keySet();                                                            </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 109       for (String key : keys) {                                                                          </span>
<span class="224737586462576596" onmouseenter="enter('224737586462576596');" onmouseout="out('224737586462576596');" style=""> 110         addFormField(writer, key, mTaskEntity.formFields.get(key));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111       }                                                                                                  </span>
<span class="-9034637092129056499" onmouseenter="enter('-9034637092129056499');" onmouseout="out('-9034637092129056499');" style=""> 112       mListener.onStart(uploadFile.length());                                                            </span>
<span class="-699289564828458401" onmouseenter="enter('-699289564828458401');" onmouseout="out('-699289564828458401');" style=""> 113       uploadFile(writer, outputStream, mTaskEntity.attachment, uploadFile);                              </span>
<span class="5762938294954091845" onmouseenter="enter('5762938294954091845');" onmouseout="out('5762938294954091845');" style=""> 114       Log.d(TAG, finish(writer) + &quot;&quot;);                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 115     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 116       e.printStackTrace();                                                                               </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style=""> 117       fail();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119   }                                                                                                      </span>
<span  style=""> 120                                                                                                          </span>
<span class="-905072369765189017" onmouseenter="enter('-905072369765189017');" onmouseout="out('-905072369765189017');" style=""> 121   boolean isRunning() {                                                                                  </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style=""> 122     return isRunning;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123   }                                                                                                      </span>
<span  style=""> 124                                                                                                          </span>
<span class="7398204271322910742" onmouseenter="enter('7398204271322910742');" onmouseout="out('7398204271322910742');" style=""> 125   private void fail() {                                                                                  </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 126     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127   }                                                                                                      </span>
<span  style=""> 128                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 129   /**                                                                                                    </span>
<span class="-1211992867345267355" onmouseenter="enter('-1211992867345267355');" onmouseout="out('-1211992867345267355');" style=""> 130    * 添加文件上传表单字段                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 131    */                                                                                                    </span>
<span class="7619688131485087237" onmouseenter="enter('7619688131485087237');" onmouseout="out('7619688131485087237');" style=""> 132   private void addFormField(PrintWriter writer, String name, String value) {                             </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 133     writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                             </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 134     writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                             </span>
<span class="-1837819835388128060" onmouseenter="enter('-1837819835388128060');" onmouseout="out('-1837819835388128060');" style=""> 135         .append(name)                                                                                    </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 136         .append(&quot;\&quot;&quot;)                                                                                    </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 137         .append(LINE_END);                                                                               </span>
<span class="7160233832927224549" onmouseenter="enter('7160233832927224549');" onmouseout="out('7160233832927224549');" style=""> 138     writer.append(&quot;Content-Type: text/plain; charset=&quot;)                                                  </span>
<span class="-6461379044237878216" onmouseenter="enter('-6461379044237878216');" onmouseout="out('-6461379044237878216');" style=""> 139         .append(mTaskEntity.charset)                                                                     </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 140         .append(LINE_END);                                                                               </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 141     writer.append(LINE_END);                                                                             </span>
<span class="-7994885594903542734" onmouseenter="enter('-7994885594903542734');" onmouseout="out('-7994885594903542734');" style=""> 142     writer.append(value).append(LINE_END);                                                               </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 143     writer.flush();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144   }                                                                                                      </span>
<span  style=""> 145                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 146   /**                                                                                                    </span>
<span class="-5307963093749139145" onmouseenter="enter('-5307963093749139145');" onmouseout="out('-5307963093749139145');" style=""> 147    * 上传文件                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 148    *                                                                                                     </span>
<span class="5235259969989322878" onmouseenter="enter('5235259969989322878');" onmouseout="out('5235259969989322878');" style=""> 149    * @param attachment 文件上传attachment                                                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 150    * @throws IOException                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 151    */                                                                                                    </span>
<span class="-8241348058297716231" onmouseenter="enter('-8241348058297716231');" onmouseout="out('-8241348058297716231');" style=""> 152   private void uploadFile(PrintWriter writer, OutputStream outputStream, String attachment,              </span>
<span class="1882173450944731504" onmouseenter="enter('1882173450944731504');" onmouseout="out('1882173450944731504');" style=""> 153       File uploadFile) throws IOException {                                                              </span>
<span class="4524609431139126841" onmouseenter="enter('4524609431139126841');" onmouseout="out('4524609431139126841');" style=""> 154     Log.e(TAG, &quot;uploadFile&quot;);                                                                            </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 155     writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                             </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 156     writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                             </span>
<span class="-5346981064803419075" onmouseenter="enter('-5346981064803419075');" onmouseout="out('-5346981064803419075');" style=""> 157         .append(attachment)                                                                              </span>
<span class="-7270534301950586768" onmouseenter="enter('-7270534301950586768');" onmouseout="out('-7270534301950586768');" style=""> 158         .append(&quot;\&quot;; filename=\&quot;&quot;)                                                                       </span>
<span class="1019288102601849811" onmouseenter="enter('1019288102601849811');" onmouseout="out('1019288102601849811');" style=""> 159         .append(mTaskEntity.uploadEntity.getFileName())                                                  </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 160         .append(&quot;\&quot;&quot;)                                                                                    </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 161         .append(LINE_END);                                                                               </span>
<span class="8956639741096524789" onmouseenter="enter('8956639741096524789');" onmouseout="out('8956639741096524789');" style=""> 162     writer.append(&quot;Content-Type: &quot;)                                                                      </span>
<span class="8182389533569034942" onmouseenter="enter('8182389533569034942');" onmouseout="out('8182389533569034942');" style=""> 163         .append(URLConnection.guessContentTypeFromName(mTaskEntity.uploadEntity.getFileName()))          </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 164         .append(LINE_END);                                                                               </span>
<span class="-5574607543649470327" onmouseenter="enter('-5574607543649470327');" onmouseout="out('-5574607543649470327');" style=""> 165     writer.append(&quot;Content-Transfer-Encoding: binary&quot;).append(LINE_END);                                 </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 166     writer.append(LINE_END);                                                                             </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 167     writer.flush();                                                                                      </span>
<span  style=""> 168                                                                                                          </span>
<span class="4040387056364667362" onmouseenter="enter('4040387056364667362');" onmouseout="out('4040387056364667362');" style=""> 169     FileInputStream inputStream = new FileInputStream(uploadFile);                                       </span>
<span class="1259808987822838079" onmouseenter="enter('1259808987822838079');" onmouseout="out('1259808987822838079');" style=""> 170     byte[] buffer = new byte[4096];                                                                      </span>
<span class="-7067986891170572893" onmouseenter="enter('-7067986891170572893');" onmouseout="out('-7067986891170572893');" style=""> 171     int bytesRead;                                                                                       </span>
<span class="-9072059992252399296" onmouseenter="enter('-9072059992252399296');" onmouseout="out('-9072059992252399296');" style=""> 172     while ((bytesRead = inputStream.read(buffer)) != -1) {                                               </span>
<span class="1251564898405321462" onmouseenter="enter('1251564898405321462');" onmouseout="out('1251564898405321462');" style=""> 173       mCurrentLocation += bytesRead;                                                                     </span>
<span class="6812214684476640601" onmouseenter="enter('6812214684476640601');" onmouseout="out('6812214684476640601');" style=""> 174       outputStream.write(buffer, 0, bytesRead);                                                          </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 175       if (isCancel) {                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 176         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177       }                                                                                                  </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style=""> 178       isRunning = true;                                                                                  </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style=""> 179       mListener.onProgress(mCurrentLocation);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span  style=""> 181                                                                                                          </span>
<span class="-8060077804843641817" onmouseenter="enter('-8060077804843641817');" onmouseout="out('-8060077804843641817');" style=""> 182     outputStream.flush();                                                                                </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 183 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6170255880024854048" onmouseenter="enter('6170255880024854048');" onmouseout="out('6170255880024854048');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184     //outputStream.close(); //不能调用，否则服务器端异常                                                              </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 185 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-3601486130051957792" onmouseenter="enter('-3601486130051957792');" onmouseout="out('-3601486130051957792');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186     outputStream.close();                                                                                </span>
<span class="338817727459642684" onmouseenter="enter('338817727459642684');" onmouseout="out('338817727459642684');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187     inputStream.close();                                                                                 </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188     writer.append(LINE_END);                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 189 =======                                                                                                  </span>
<span class="3028741211385217417" onmouseenter="enter('3028741211385217417');" onmouseout="out('3028741211385217417');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190     //outputStream.close();                                                                              </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 191 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="338817727459642684" onmouseenter="enter('338817727459642684');" onmouseout="out('338817727459642684');" style=""> 192     inputStream.close();                                                                                 </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 193     writer.append(LINE_END);                                                                             </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 194     writer.flush();                                                                                      </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style=""> 195     isRunning = false;                                                                                   </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 196     if (isCancel) {                                                                                      </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 197       mListener.onCancel();                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 198       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199     }                                                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 200     mListener.onComplete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201   }                                                                                                      </span>
<span  style=""> 202                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 203   /**                                                                                                    </span>
<span class="8090914033664120342" onmouseenter="enter('8090914033664120342');" onmouseout="out('8090914033664120342');" style=""> 204    * 任务结束操作                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 205    *                                                                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 206    * @throws IOException                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 207    */                                                                                                    </span>
<span class="-6712242018334182923" onmouseenter="enter('-6712242018334182923');" onmouseout="out('-6712242018334182923');" style=""> 208   private String finish(PrintWriter writer) throws IOException {                                         </span>
<span class="-3213513309039140359" onmouseenter="enter('-3213513309039140359');" onmouseout="out('-3213513309039140359');" style=""> 209     StringBuilder response = new StringBuilder();                                                        </span>
<span  style=""> 210                                                                                                          </span>
<span class="3673413535200466883" onmouseenter="enter('3673413535200466883');" onmouseout="out('3673413535200466883');" style=""> 211     writer.append(LINE_END).flush();                                                                     </span>
<span class="-6942559868418828891" onmouseenter="enter('-6942559868418828891');" onmouseout="out('-6942559868418828891');" style=""> 212     writer.append(PREFIX).append(BOUNDARY).append(PREFIX).append(LINE_END);                              </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 213     writer.close();                                                                                      </span>
<span  style=""> 214                                                                                                          </span>
<span class="-7766630665701464966" onmouseenter="enter('-7766630665701464966');" onmouseout="out('-7766630665701464966');" style=""> 215     int status = mHttpConn.getResponseCode();                                                            </span>
<span class="3009894602238525978" onmouseenter="enter('3009894602238525978');" onmouseout="out('3009894602238525978');" style=""> 216     if (status == HttpURLConnection.HTTP_OK) {                                                           </span>
<span class="-697229362038129983" onmouseenter="enter('-697229362038129983');" onmouseout="out('-697229362038129983');" style=""> 217       BufferedReader reader = new BufferedReader(new InputStreamReader(mHttpConn.getInputStream()));     </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style=""> 218       String line;                                                                                       </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style=""> 219       while ((line = reader.readLine()) != null) {                                                       </span>
<span class="-7195029802899220801" onmouseenter="enter('-7195029802899220801');" onmouseout="out('-7195029802899220801');" style=""> 220         response.append(line);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221       }                                                                                                  </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style=""> 222       reader.close();                                                                                    </span>
<span class="6290572035394845602" onmouseenter="enter('6290572035394845602');" onmouseout="out('6290572035394845602');" style=""> 223       mHttpConn.disconnect();                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 224     } else {                                                                                             </span>
<span class="-8134780005978126053" onmouseenter="enter('-8134780005978126053');" onmouseout="out('-8134780005978126053');" style=""> 225       Log.w(TAG, &quot;state_code = &quot; + status);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226     }                                                                                                    </span>
<span  style=""> 227                                                                                                          </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 228     writer.flush();                                                                                      </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 229     writer.close();                                                                                      </span>
<span  style=""> 230                                                                                                          </span>
<span class="973858829207738010" onmouseenter="enter('973858829207738010');" onmouseout="out('973858829207738010');" style=""> 231     return response.toString();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="2296433254624375089" onmouseenter="enter('2296433254624375089');" onmouseout="out('2296433254624375089');" style="">  16 package com.arialyy.aria.core.upload;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  18 import android.util.Log;                                                                                 </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  19 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="">  20 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  21 import java.io.File;                                                                                     </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  22 import java.io.FileInputStream;                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  23 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="">  24 import java.io.InputStreamReader;                                                                        </span>
<span class="4621164050749610193" onmouseenter="enter('4621164050749610193');" onmouseout="out('4621164050749610193');" style="">  25 import java.io.OutputStream;                                                                             </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="">  26 import java.io.OutputStreamWriter;                                                                       </span>
<span class="188494595561851451" onmouseenter="enter('188494595561851451');" onmouseout="out('188494595561851451');" style="">  27 import java.io.PrintWriter;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  28 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  29 import java.net.URL;                                                                                     </span>
<span class="-5521468699455618699" onmouseenter="enter('-5521468699455618699');" onmouseout="out('-5521468699455618699');" style="">  30 import java.net.URLConnection;                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  31 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  32 import java.util.UUID;                                                                                   </span>
<span  style="">  33                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  34 /**                                                                                                      </span>
<span class="-6400750417840662839" onmouseenter="enter('-6400750417840662839');" onmouseout="out('-6400750417840662839');" style="">  35  * Created by Aria.Lao on 2017/2/9.                                                                      </span>
<span class="-4299352450658306013" onmouseenter="enter('-4299352450658306013');" onmouseout="out('-4299352450658306013');" style="">  36  * 上传工具                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  37  */                                                                                                      </span>
<span class="-5707704917663703030" onmouseenter="enter('-5707704917663703030');" onmouseout="out('-5707704917663703030');" style="">  38 public class UploadUtil implements Runnable {                                                            </span>
<span class="-3724454848507439391" onmouseenter="enter('-3724454848507439391');" onmouseout="out('-3724454848507439391');" style="">  39   private static final String TAG = &quot;UploadUtil&quot;;                                                        </span>
<span class="4601955423512060976" onmouseenter="enter('4601955423512060976');" onmouseout="out('4601955423512060976');" style="">  40   private final String BOUNDARY = UUID.randomUUID().toString(); // 边界标识 随机生成                             </span>
<span class="-986211549012609109" onmouseenter="enter('-986211549012609109');" onmouseout="out('-986211549012609109');" style="">  41   private final String PREFIX = &quot;--&quot;, LINE_END = &quot;\r\n&quot;;                                                 </span>
<span class="-4895228480728785048" onmouseenter="enter('-4895228480728785048');" onmouseout="out('-4895228480728785048');" style="">  42   private UploadEntity mUploadEntity;                                                                    </span>
<span class="-7667731813459538063" onmouseenter="enter('-7667731813459538063');" onmouseout="out('-7667731813459538063');" style="">  43   private UploadTaskEntity mTaskEntity;                                                                  </span>
<span class="-4450121024944087023" onmouseenter="enter('-4450121024944087023');" onmouseout="out('-4450121024944087023');" style="">  44   private IUploadListener mListener;                                                                     </span>
<span class="-333925809319807249" onmouseenter="enter('-333925809319807249');" onmouseout="out('-333925809319807249');" style="">  45   private HttpURLConnection mHttpConn;                                                                   </span>
<span class="5356975924392872579" onmouseenter="enter('5356975924392872579');" onmouseout="out('5356975924392872579');" style="">  46   private long mCurrentLocation = 0;                                                                     </span>
<span class="6610618430806440993" onmouseenter="enter('6610618430806440993');" onmouseout="out('6610618430806440993');" style="">  47   private boolean isCancel = false;                                                                      </span>
<span class="-7014396160817654560" onmouseenter="enter('-7014396160817654560');" onmouseout="out('-7014396160817654560');" style="">  48   private boolean isRunning = false;                                                                     </span>
<span  style="">  49                                                                                                          </span>
<span class="-4378274624765085007" onmouseenter="enter('-4378274624765085007');" onmouseout="out('-4378274624765085007');" style="">  50   public UploadUtil(UploadTaskEntity taskEntity, IUploadListener listener) {                             </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  51     mTaskEntity = taskEntity;                                                                            </span>
<span class="-5397140926211959544" onmouseenter="enter('-5397140926211959544');" onmouseout="out('-5397140926211959544');" style="">  52     CheckUtil.checkUploadEntity(taskEntity.uploadEntity);                                                </span>
<span class="7818534483611280473" onmouseenter="enter('7818534483611280473');" onmouseout="out('7818534483611280473');" style="">  53     mUploadEntity = taskEntity.uploadEntity;                                                             </span>
<span class="6410471256291283437" onmouseenter="enter('6410471256291283437');" onmouseout="out('6410471256291283437');" style="">  54     if (listener == null) {                                                                              </span>
<span class="-3877746287627857629" onmouseenter="enter('-3877746287627857629');" onmouseout="out('-3877746287627857629');" style="">  55       throw new IllegalArgumentException(&quot;上传监听不能为空&quot;);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56     }                                                                                                    </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  57     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58   }                                                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="-2648331188945203940" onmouseenter="enter('-2648331188945203940');" onmouseout="out('-2648331188945203940');" style="">  60   public void start() {                                                                                  </span>
<span class="7658640897919599872" onmouseenter="enter('7658640897919599872');" onmouseout="out('7658640897919599872');" style="">  61     Log.d(TAG, &quot;start&quot;);                                                                                 </span>
<span class="-5580853241009618205" onmouseenter="enter('-5580853241009618205');" onmouseout="out('-5580853241009618205');" style="">  62     isCancel = false;                                                                                    </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  63     isRunning = false;                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="">  64     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65   }                                                                                                      </span>
<span  style="">  66                                                                                                          </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style="">  67   public void cancel() {                                                                                 </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="">  68     isCancel = true;                                                                                     </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  69     isRunning = false;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70   }                                                                                                      </span>
<span  style="">  71                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  72   @Override public void run() {                                                                          </span>
<span class="-3930199446811223366" onmouseenter="enter('-3930199446811223366');" onmouseout="out('-3930199446811223366');" style="">  73     Log.e(TAG, &quot;run&quot;);                                                                                   </span>
<span class="-4654815309234540461" onmouseenter="enter('-4654815309234540461');" onmouseout="out('-4654815309234540461');" style="">  74     File uploadFile = new File(mUploadEntity.getFilePath());                                             </span>
<span class="-7440468768172298093" onmouseenter="enter('-7440468768172298093');" onmouseout="out('-7440468768172298093');" style="">  75     if (!uploadFile.exists()) {                                                                          </span>
<span class="3670297489558872216" onmouseenter="enter('3670297489558872216');" onmouseout="out('3670297489558872216');" style="">  76       Log.e(TAG, &quot;【&quot; + mUploadEntity.getFilePath() + &quot;】，文件不存在。&quot;);                                        </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style="">  77       fail();                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  78       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79     }                                                                                                    </span>
<span  style="">  80                                                                                                          </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="">  81     mListener.onPre();                                                                                   </span>
<span  style="">  82                                                                                                          </span>
<span class="3442630168795471555" onmouseenter="enter('3442630168795471555');" onmouseout="out('3442630168795471555');" style="">  83     URL url;                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  84     try {                                                                                                </span>
<span class="-3237270879792511864" onmouseenter="enter('-3237270879792511864');" onmouseout="out('-3237270879792511864');" style="">  85       url = new URL(mTaskEntity.uploadUrl);                                                              </span>
<span class="-9098060409631350199" onmouseenter="enter('-9098060409631350199');" onmouseout="out('-9098060409631350199');" style="">  86       mHttpConn = (HttpURLConnection) url.openConnection();                                              </span>
<span class="-8042386604808273921" onmouseenter="enter('-8042386604808273921');" onmouseout="out('-8042386604808273921');" style="">  87       mHttpConn.setUseCaches(false);                                                                     </span>
<span class="-819609990863481625" onmouseenter="enter('-819609990863481625');" onmouseout="out('-819609990863481625');" style="">  88       mHttpConn.setDoOutput(true);                                                                       </span>
<span class="-2828311995571883529" onmouseenter="enter('-2828311995571883529');" onmouseout="out('-2828311995571883529');" style="">  89       mHttpConn.setDoInput(true);                                                                        </span>
<span class="7496337321827260410" onmouseenter="enter('7496337321827260410');" onmouseout="out('7496337321827260410');" style="">  90       mHttpConn.setRequestProperty(&quot;Content-Type&quot;,                                                       </span>
<span class="-6872149995828718188" onmouseenter="enter('-6872149995828718188');" onmouseout="out('-6872149995828718188');" style="">  91           mTaskEntity.contentType + &quot;; boundary=&quot; + BOUNDARY);                                           </span>
<span class="-1152444464189443777" onmouseenter="enter('-1152444464189443777');" onmouseout="out('-1152444464189443777');" style="">  92       mHttpConn.setRequestProperty(&quot;User-Agent&quot;, mTaskEntity.userAgent);                                 </span>
<span class="9024482569447258132" onmouseenter="enter('9024482569447258132');" onmouseout="out('9024482569447258132');" style="">  93       //mHttpConn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot; + &quot;100&quot;);                               </span>
<span class="-7778714341502295972" onmouseenter="enter('-7778714341502295972');" onmouseout="out('-7778714341502295972');" style="">  94       //内部缓冲区---分段上传防止oom                                                                                </span>
<span class="2953946561574030999" onmouseenter="enter('2953946561574030999');" onmouseout="out('2953946561574030999');" style="">  95       mHttpConn.setChunkedStreamingMode(1024);                                                           </span>
<span  style="">  96                                                                                                          </span>
<span class="-8255006708775639880" onmouseenter="enter('-8255006708775639880');" onmouseout="out('-8255006708775639880');" style="">  97       //添加Http请求头部                                                                                       </span>
<span class="2465544298625110221" onmouseenter="enter('2465544298625110221');" onmouseout="out('2465544298625110221');" style="">  98       Set&lt;String&gt; keys = mTaskEntity.headers.keySet();                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  99       for (String key : keys) {                                                                          </span>
<span class="6920539915464580201" onmouseenter="enter('6920539915464580201');" onmouseout="out('6920539915464580201');" style=""> 100         mHttpConn.setRequestProperty(key, mTaskEntity.headers.get(key));                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101       }                                                                                                  </span>
<span  style=""> 102                                                                                                          </span>
<span class="-5663197000219230409" onmouseenter="enter('-5663197000219230409');" onmouseout="out('-5663197000219230409');" style=""> 103       OutputStream outputStream = mHttpConn.getOutputStream();                                           </span>
<span class="-5601399779707962135" onmouseenter="enter('-5601399779707962135');" onmouseout="out('-5601399779707962135');" style=""> 104       PrintWriter writer =                                                                               </span>
<span class="-6867234444748414110" onmouseenter="enter('-6867234444748414110');" onmouseout="out('-6867234444748414110');" style=""> 105           new PrintWriter(new OutputStreamWriter(outputStream, mTaskEntity.charset), true);              </span>
<span  style=""> 106                                                                                                          </span>
<span class="7728457972062474717" onmouseenter="enter('7728457972062474717');" onmouseout="out('7728457972062474717');" style=""> 107       //添加文件上传表单字段                                                                                       </span>
<span class="-8415422093392386204" onmouseenter="enter('-8415422093392386204');" onmouseout="out('-8415422093392386204');" style=""> 108       keys = mTaskEntity.formFields.keySet();                                                            </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 109       for (String key : keys) {                                                                          </span>
<span class="224737586462576596" onmouseenter="enter('224737586462576596');" onmouseout="out('224737586462576596');" style=""> 110         addFormField(writer, key, mTaskEntity.formFields.get(key));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111       }                                                                                                  </span>
<span class="-9034637092129056499" onmouseenter="enter('-9034637092129056499');" onmouseout="out('-9034637092129056499');" style=""> 112       mListener.onStart(uploadFile.length());                                                            </span>
<span class="-699289564828458401" onmouseenter="enter('-699289564828458401');" onmouseout="out('-699289564828458401');" style=""> 113       uploadFile(writer, outputStream, mTaskEntity.attachment, uploadFile);                              </span>
<span class="5762938294954091845" onmouseenter="enter('5762938294954091845');" onmouseout="out('5762938294954091845');" style=""> 114       Log.d(TAG, finish(writer) + &quot;&quot;);                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 115     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 116       e.printStackTrace();                                                                               </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style=""> 117       fail();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119   }                                                                                                      </span>
<span  style=""> 120                                                                                                          </span>
<span class="-905072369765189017" onmouseenter="enter('-905072369765189017');" onmouseout="out('-905072369765189017');" style=""> 121   boolean isRunning() {                                                                                  </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style=""> 122     return isRunning;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123   }                                                                                                      </span>
<span  style=""> 124                                                                                                          </span>
<span class="7398204271322910742" onmouseenter="enter('7398204271322910742');" onmouseout="out('7398204271322910742');" style=""> 125   private void fail() {                                                                                  </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 126     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127   }                                                                                                      </span>
<span  style=""> 128                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 129   /**                                                                                                    </span>
<span class="-1211992867345267355" onmouseenter="enter('-1211992867345267355');" onmouseout="out('-1211992867345267355');" style=""> 130    * 添加文件上传表单字段                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 131    */                                                                                                    </span>
<span class="7619688131485087237" onmouseenter="enter('7619688131485087237');" onmouseout="out('7619688131485087237');" style=""> 132   private void addFormField(PrintWriter writer, String name, String value) {                             </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 133     writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                             </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 134     writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                             </span>
<span class="-1837819835388128060" onmouseenter="enter('-1837819835388128060');" onmouseout="out('-1837819835388128060');" style=""> 135         .append(name)                                                                                    </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 136         .append(&quot;\&quot;&quot;)                                                                                    </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 137         .append(LINE_END);                                                                               </span>
<span class="7160233832927224549" onmouseenter="enter('7160233832927224549');" onmouseout="out('7160233832927224549');" style=""> 138     writer.append(&quot;Content-Type: text/plain; charset=&quot;)                                                  </span>
<span class="-6461379044237878216" onmouseenter="enter('-6461379044237878216');" onmouseout="out('-6461379044237878216');" style=""> 139         .append(mTaskEntity.charset)                                                                     </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 140         .append(LINE_END);                                                                               </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 141     writer.append(LINE_END);                                                                             </span>
<span class="-7994885594903542734" onmouseenter="enter('-7994885594903542734');" onmouseout="out('-7994885594903542734');" style=""> 142     writer.append(value).append(LINE_END);                                                               </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 143     writer.flush();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144   }                                                                                                      </span>
<span  style=""> 145                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 146   /**                                                                                                    </span>
<span class="-5307963093749139145" onmouseenter="enter('-5307963093749139145');" onmouseout="out('-5307963093749139145');" style=""> 147    * 上传文件                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 148    *                                                                                                     </span>
<span class="5235259969989322878" onmouseenter="enter('5235259969989322878');" onmouseout="out('5235259969989322878');" style=""> 149    * @param attachment 文件上传attachment                                                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 150    * @throws IOException                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 151    */                                                                                                    </span>
<span class="-8241348058297716231" onmouseenter="enter('-8241348058297716231');" onmouseout="out('-8241348058297716231');" style=""> 152   private void uploadFile(PrintWriter writer, OutputStream outputStream, String attachment,              </span>
<span class="1882173450944731504" onmouseenter="enter('1882173450944731504');" onmouseout="out('1882173450944731504');" style=""> 153       File uploadFile) throws IOException {                                                              </span>
<span class="4524609431139126841" onmouseenter="enter('4524609431139126841');" onmouseout="out('4524609431139126841');" style=""> 154     Log.e(TAG, &quot;uploadFile&quot;);                                                                            </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 155     writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                             </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 156     writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                             </span>
<span class="-5346981064803419075" onmouseenter="enter('-5346981064803419075');" onmouseout="out('-5346981064803419075');" style=""> 157         .append(attachment)                                                                              </span>
<span class="-7270534301950586768" onmouseenter="enter('-7270534301950586768');" onmouseout="out('-7270534301950586768');" style=""> 158         .append(&quot;\&quot;; filename=\&quot;&quot;)                                                                       </span>
<span class="1019288102601849811" onmouseenter="enter('1019288102601849811');" onmouseout="out('1019288102601849811');" style=""> 159         .append(mTaskEntity.uploadEntity.getFileName())                                                  </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 160         .append(&quot;\&quot;&quot;)                                                                                    </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 161         .append(LINE_END);                                                                               </span>
<span class="8956639741096524789" onmouseenter="enter('8956639741096524789');" onmouseout="out('8956639741096524789');" style=""> 162     writer.append(&quot;Content-Type: &quot;)                                                                      </span>
<span class="8182389533569034942" onmouseenter="enter('8182389533569034942');" onmouseout="out('8182389533569034942');" style=""> 163         .append(URLConnection.guessContentTypeFromName(mTaskEntity.uploadEntity.getFileName()))          </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 164         .append(LINE_END);                                                                               </span>
<span class="-5574607543649470327" onmouseenter="enter('-5574607543649470327');" onmouseout="out('-5574607543649470327');" style=""> 165     writer.append(&quot;Content-Transfer-Encoding: binary&quot;).append(LINE_END);                                 </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 166     writer.append(LINE_END);                                                                             </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 167     writer.flush();                                                                                      </span>
<span  style=""> 168                                                                                                          </span>
<span class="4040387056364667362" onmouseenter="enter('4040387056364667362');" onmouseout="out('4040387056364667362');" style=""> 169     FileInputStream inputStream = new FileInputStream(uploadFile);                                       </span>
<span class="1259808987822838079" onmouseenter="enter('1259808987822838079');" onmouseout="out('1259808987822838079');" style=""> 170     byte[] buffer = new byte[4096];                                                                      </span>
<span class="-7067986891170572893" onmouseenter="enter('-7067986891170572893');" onmouseout="out('-7067986891170572893');" style=""> 171     int bytesRead;                                                                                       </span>
<span class="-9072059992252399296" onmouseenter="enter('-9072059992252399296');" onmouseout="out('-9072059992252399296');" style=""> 172     while ((bytesRead = inputStream.read(buffer)) != -1) {                                               </span>
<span class="1251564898405321462" onmouseenter="enter('1251564898405321462');" onmouseout="out('1251564898405321462');" style=""> 173       mCurrentLocation += bytesRead;                                                                     </span>
<span class="6812214684476640601" onmouseenter="enter('6812214684476640601');" onmouseout="out('6812214684476640601');" style=""> 174       outputStream.write(buffer, 0, bytesRead);                                                          </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 175       if (isCancel) {                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 176         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177       }                                                                                                  </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style=""> 178       isRunning = true;                                                                                  </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style=""> 179       mListener.onProgress(mCurrentLocation);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span  style=""> 181                                                                                                          </span>
<span class="-8060077804843641817" onmouseenter="enter('-8060077804843641817');" onmouseout="out('-8060077804843641817');" style=""> 182     outputStream.flush();                                                                                </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 183 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="6170255880024854048" onmouseenter="enter('6170255880024854048');" onmouseout="out('6170255880024854048');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184     //outputStream.close(); //不能调用，否则服务器端异常                                                              </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 185 ||||||| BASE                                                                                             </span>
<span class="-3601486130051957792" onmouseenter="enter('-3601486130051957792');" onmouseout="out('-3601486130051957792');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186     outputStream.close();                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 187 =======                                                                                                  </span>
<span class="3028741211385217417" onmouseenter="enter('3028741211385217417');" onmouseout="out('3028741211385217417');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188     //outputStream.close();                                                                              </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 189 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="338817727459642684" onmouseenter="enter('338817727459642684');" onmouseout="out('338817727459642684');" style=""> 190     inputStream.close();                                                                                 </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 191     writer.append(LINE_END);                                                                             </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 192     writer.flush();                                                                                      </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style=""> 193     isRunning = false;                                                                                   </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 194     if (isCancel) {                                                                                      </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 195       mListener.onCancel();                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 196       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197     }                                                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 198     mListener.onComplete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199   }                                                                                                      </span>
<span  style=""> 200                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 201   /**                                                                                                    </span>
<span class="8090914033664120342" onmouseenter="enter('8090914033664120342');" onmouseout="out('8090914033664120342');" style=""> 202    * 任务结束操作                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 203    *                                                                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 204    * @throws IOException                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 205    */                                                                                                    </span>
<span class="-6712242018334182923" onmouseenter="enter('-6712242018334182923');" onmouseout="out('-6712242018334182923');" style=""> 206   private String finish(PrintWriter writer) throws IOException {                                         </span>
<span class="-3213513309039140359" onmouseenter="enter('-3213513309039140359');" onmouseout="out('-3213513309039140359');" style=""> 207     StringBuilder response = new StringBuilder();                                                        </span>
<span  style=""> 208                                                                                                          </span>
<span class="3673413535200466883" onmouseenter="enter('3673413535200466883');" onmouseout="out('3673413535200466883');" style=""> 209     writer.append(LINE_END).flush();                                                                     </span>
<span class="-6942559868418828891" onmouseenter="enter('-6942559868418828891');" onmouseout="out('-6942559868418828891');" style=""> 210     writer.append(PREFIX).append(BOUNDARY).append(PREFIX).append(LINE_END);                              </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 211     writer.close();                                                                                      </span>
<span  style=""> 212                                                                                                          </span>
<span class="-7766630665701464966" onmouseenter="enter('-7766630665701464966');" onmouseout="out('-7766630665701464966');" style=""> 213     int status = mHttpConn.getResponseCode();                                                            </span>
<span class="3009894602238525978" onmouseenter="enter('3009894602238525978');" onmouseout="out('3009894602238525978');" style=""> 214     if (status == HttpURLConnection.HTTP_OK) {                                                           </span>
<span class="-697229362038129983" onmouseenter="enter('-697229362038129983');" onmouseout="out('-697229362038129983');" style=""> 215       BufferedReader reader = new BufferedReader(new InputStreamReader(mHttpConn.getInputStream()));     </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style=""> 216       String line;                                                                                       </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style=""> 217       while ((line = reader.readLine()) != null) {                                                       </span>
<span class="-7195029802899220801" onmouseenter="enter('-7195029802899220801');" onmouseout="out('-7195029802899220801');" style=""> 218         response.append(line);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219       }                                                                                                  </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style=""> 220       reader.close();                                                                                    </span>
<span class="6290572035394845602" onmouseenter="enter('6290572035394845602');" onmouseout="out('6290572035394845602');" style=""> 221       mHttpConn.disconnect();                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 222     } else {                                                                                             </span>
<span class="-8134780005978126053" onmouseenter="enter('-8134780005978126053');" onmouseout="out('-8134780005978126053');" style=""> 223       Log.w(TAG, &quot;state_code = &quot; + status);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224     }                                                                                                    </span>
<span  style=""> 225                                                                                                          </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 226     writer.flush();                                                                                      </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 227     writer.close();                                                                                      </span>
<span  style=""> 228                                                                                                          </span>
<span class="973858829207738010" onmouseenter="enter('973858829207738010');" onmouseout="out('973858829207738010');" style=""> 229     return response.toString();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231 }                                                                                                        </span>
</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="2296433254624375089" onmouseenter="enter('2296433254624375089');" onmouseout="out('2296433254624375089');" style="">  16 package com.arialyy.aria.core.upload;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  18 import android.util.Log;                                                                                 </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  19 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="">  20 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  21 import java.io.File;                                                                                     </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  22 import java.io.FileInputStream;                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  23 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="">  24 import java.io.InputStreamReader;                                                                        </span>
<span class="4621164050749610193" onmouseenter="enter('4621164050749610193');" onmouseout="out('4621164050749610193');" style="">  25 import java.io.OutputStream;                                                                             </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="">  26 import java.io.OutputStreamWriter;                                                                       </span>
<span class="188494595561851451" onmouseenter="enter('188494595561851451');" onmouseout="out('188494595561851451');" style="">  27 import java.io.PrintWriter;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  28 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  29 import java.net.URL;                                                                                     </span>
<span class="-5521468699455618699" onmouseenter="enter('-5521468699455618699');" onmouseout="out('-5521468699455618699');" style="">  30 import java.net.URLConnection;                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  31 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  32 import java.util.UUID;                                                                                   </span>
<span  style="">  33                                                                                                          </span>
<span  style="">  34                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  35 /**                                                                                                      </span>
<span class="-6400750417840662839" onmouseenter="enter('-6400750417840662839');" onmouseout="out('-6400750417840662839');" style="">  36  * Created by Aria.Lao on 2017/2/9.                                                                      </span>
<span class="-4299352450658306013" onmouseenter="enter('-4299352450658306013');" onmouseout="out('-4299352450658306013');" style="">  37  * 上传工具                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  38  */                                                                                                      </span>
<span class="-5707704917663703030" onmouseenter="enter('-5707704917663703030');" onmouseout="out('-5707704917663703030');" style="">  39 public class UploadUtil implements Runnable {                                                            </span>
<span class="-3724454848507439391" onmouseenter="enter('-3724454848507439391');" onmouseout="out('-3724454848507439391');" style="">  40   private static final String TAG = &quot;UploadUtil&quot;;                                                        </span>
<span  style="">  41                                                                                                          </span>
<span class="4578917446438164841" onmouseenter="enter('4578917446438164841');" onmouseout="out('4578917446438164841');" style="">  42   // 边界标识 随机生成                                                                                           </span>
<span class="4601955423512060976" onmouseenter="enter('4601955423512060976');" onmouseout="out('4601955423512060976');" style="">  43   private final String BOUNDARY = UUID.randomUUID().toString(); // 边界标识 随机生成                             </span>
<span  style="">  44                                                                                                          </span>
<span class="-3758584270257973790" onmouseenter="enter('-3758584270257973790');" onmouseout="out('-3758584270257973790');" style="">  45   private final String PREFIX = &quot;--&quot;;                                                                    </span>
<span  style="">  46                                                                                                          </span>
<span class="-5257559193934118506" onmouseenter="enter('-5257559193934118506');" onmouseout="out('-5257559193934118506');" style="">  47   private final String LINE_END = &quot;\r\n&quot;;                                                                </span>
<span  style="">  48                                                                                                          </span>
<span class="-4895228480728785048" onmouseenter="enter('-4895228480728785048');" onmouseout="out('-4895228480728785048');" style="">  49   private UploadEntity mUploadEntity;                                                                    </span>
<span  style="">  50                                                                                                          </span>
<span class="-7667731813459538063" onmouseenter="enter('-7667731813459538063');" onmouseout="out('-7667731813459538063');" style="">  51   private UploadTaskEntity mTaskEntity;                                                                  </span>
<span  style="">  52                                                                                                          </span>
<span class="-4450121024944087023" onmouseenter="enter('-4450121024944087023');" onmouseout="out('-4450121024944087023');" style="">  53   private IUploadListener mListener;                                                                     </span>
<span  style="">  54                                                                                                          </span>
<span class="-333925809319807249" onmouseenter="enter('-333925809319807249');" onmouseout="out('-333925809319807249');" style="">  55   private HttpURLConnection mHttpConn;                                                                   </span>
<span  style="">  56                                                                                                          </span>
<span class="5356975924392872579" onmouseenter="enter('5356975924392872579');" onmouseout="out('5356975924392872579');" style="">  57   private long mCurrentLocation = 0;                                                                     </span>
<span  style="">  58                                                                                                          </span>
<span class="6610618430806440993" onmouseenter="enter('6610618430806440993');" onmouseout="out('6610618430806440993');" style="">  59   private boolean isCancel = false;                                                                      </span>
<span  style="">  60                                                                                                          </span>
<span class="-7014396160817654560" onmouseenter="enter('-7014396160817654560');" onmouseout="out('-7014396160817654560');" style="">  61   private boolean isRunning = false;                                                                     </span>
<span  style="">  62                                                                                                          </span>
<span class="-4378274624765085007" onmouseenter="enter('-4378274624765085007');" onmouseout="out('-4378274624765085007');" style="">  63   public UploadUtil(UploadTaskEntity taskEntity, IUploadListener listener) {                             </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  64     mTaskEntity = taskEntity;                                                                            </span>
<span class="-5397140926211959544" onmouseenter="enter('-5397140926211959544');" onmouseout="out('-5397140926211959544');" style="">  65     CheckUtil.checkUploadEntity(taskEntity.uploadEntity);                                                </span>
<span class="7818534483611280473" onmouseenter="enter('7818534483611280473');" onmouseout="out('7818534483611280473');" style="">  66     mUploadEntity = taskEntity.uploadEntity;                                                             </span>
<span class="6410471256291283437" onmouseenter="enter('6410471256291283437');" onmouseout="out('6410471256291283437');" style="">  67     if (listener == null) {                                                                              </span>
<span class="-3877746287627857629" onmouseenter="enter('-3877746287627857629');" onmouseout="out('-3877746287627857629');" style="">  68       throw new IllegalArgumentException(&quot;上传监听不能为空&quot;);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69     }                                                                                                    </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  70     mListener = listener;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71   }                                                                                                      </span>
<span  style="">  72                                                                                                          </span>
<span class="-2648331188945203940" onmouseenter="enter('-2648331188945203940');" onmouseout="out('-2648331188945203940');" style="">  73   public void start() {                                                                                  </span>
<span class="7658640897919599872" onmouseenter="enter('7658640897919599872');" onmouseout="out('7658640897919599872');" style="">  74     Log.d(TAG, &quot;start&quot;);                                                                                 </span>
<span class="-5580853241009618205" onmouseenter="enter('-5580853241009618205');" onmouseout="out('-5580853241009618205');" style="">  75     isCancel = false;                                                                                    </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  76     isRunning = false;                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="">  77     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78   }                                                                                                      </span>
<span  style="">  79                                                                                                          </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style="">  80   public void cancel() {                                                                                 </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="">  81     isCancel = true;                                                                                     </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  82     isRunning = false;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83   }                                                                                                      </span>
<span  style="">  84                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  85   @Override                                                                                              </span>
<span class="5292860430507443886" onmouseenter="enter('5292860430507443886');" onmouseout="out('5292860430507443886');" style="">  86   public void run() {                                                                                    </span>
<span class="-3930199446811223366" onmouseenter="enter('-3930199446811223366');" onmouseout="out('-3930199446811223366');" style="">  87     Log.e(TAG, &quot;run&quot;);                                                                                   </span>
<span class="-4654815309234540461" onmouseenter="enter('-4654815309234540461');" onmouseout="out('-4654815309234540461');" style="">  88     File uploadFile = new File(mUploadEntity.getFilePath());                                             </span>
<span class="-7440468768172298093" onmouseenter="enter('-7440468768172298093');" onmouseout="out('-7440468768172298093');" style="">  89     if (!uploadFile.exists()) {                                                                          </span>
<span class="-8026408449707044112" onmouseenter="enter('-8026408449707044112');" onmouseout="out('-8026408449707044112');" style="">  90       Log.e(TAG, (&quot;【&quot; + mUploadEntity.getFilePath()) + &quot;】，文件不存在。&quot;);                                      </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style="">  91       fail();                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  92       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="">  94     mListener.onPre();                                                                                   </span>
<span class="3442630168795471555" onmouseenter="enter('3442630168795471555');" onmouseout="out('3442630168795471555');" style="">  95     URL url;                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  96     try {                                                                                                </span>
<span class="-3237270879792511864" onmouseenter="enter('-3237270879792511864');" onmouseout="out('-3237270879792511864');" style="">  97       url = new URL(mTaskEntity.uploadUrl);                                                              </span>
<span class="-8130962814587680772" onmouseenter="enter('-8130962814587680772');" onmouseout="out('-8130962814587680772');" style="">  98       mHttpConn = ((HttpURLConnection) (url.openConnection()));                                          </span>
<span class="-8042386604808273921" onmouseenter="enter('-8042386604808273921');" onmouseout="out('-8042386604808273921');" style="">  99       mHttpConn.setUseCaches(false);                                                                     </span>
<span class="-819609990863481625" onmouseenter="enter('-819609990863481625');" onmouseout="out('-819609990863481625');" style=""> 100       mHttpConn.setDoOutput(true);                                                                       </span>
<span class="-2828311995571883529" onmouseenter="enter('-2828311995571883529');" onmouseout="out('-2828311995571883529');" style=""> 101       mHttpConn.setDoInput(true);                                                                        </span>
<span class="7318879423539909535" onmouseenter="enter('7318879423539909535');" onmouseout="out('7318879423539909535');" style=""> 102       mHttpConn.setRequestProperty(&quot;Content-Type&quot;, (mTaskEntity.contentType + &quot;; boundary=&quot;) + BOUNDARY);</span>
<span class="-1152444464189443777" onmouseenter="enter('-1152444464189443777');" onmouseout="out('-1152444464189443777');" style=""> 103       mHttpConn.setRequestProperty(&quot;User-Agent&quot;, mTaskEntity.userAgent);                                 </span>
<span class="5669352548796456606" onmouseenter="enter('5669352548796456606');" onmouseout="out('5669352548796456606');" style=""> 104       // mHttpConn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot; + &quot;100&quot;);                              </span>
<span class="3738093347881674152" onmouseenter="enter('3738093347881674152');" onmouseout="out('3738093347881674152');" style=""> 105       // 内部缓冲区---分段上传防止oom                                                                               </span>
<span class="2953946561574030999" onmouseenter="enter('2953946561574030999');" onmouseout="out('2953946561574030999');" style=""> 106       mHttpConn.setChunkedStreamingMode(1024);                                                           </span>
<span class="-8308679123888298665" onmouseenter="enter('-8308679123888298665');" onmouseout="out('-8308679123888298665');" style=""> 107       // 添加Http请求头部                                                                                      </span>
<span class="2465544298625110221" onmouseenter="enter('2465544298625110221');" onmouseout="out('2465544298625110221');" style=""> 108       Set&lt;String&gt; keys = mTaskEntity.headers.keySet();                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 109       for (String key : keys) {                                                                          </span>
<span class="6920539915464580201" onmouseenter="enter('6920539915464580201');" onmouseout="out('6920539915464580201');" style=""> 110         mHttpConn.setRequestProperty(key, mTaskEntity.headers.get(key));                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111       }                                                                                                  </span>
<span class="-5663197000219230409" onmouseenter="enter('-5663197000219230409');" onmouseout="out('-5663197000219230409');" style=""> 112       OutputStream outputStream = mHttpConn.getOutputStream();                                           </span>
<span class="-2237997656836894312" onmouseenter="enter('-2237997656836894312');" onmouseout="out('-2237997656836894312');" style=""><abbr title=" 113       PrintWriter writer = new PrintWriter(new OutputStreamWriter(outputStream, mTaskEntity.charset), true);"> 113       PrintWriter writer = new PrintWriter(new OutputStreamWriter(outputStream, mTaskEntity.charset), tru🔵</abbr></span>
<span class="2625805632113564734" onmouseenter="enter('2625805632113564734');" onmouseout="out('2625805632113564734');" style=""> 114       // 添加文件上传表单字段                                                                                      </span>
<span class="-8415422093392386204" onmouseenter="enter('-8415422093392386204');" onmouseout="out('-8415422093392386204');" style=""> 115       keys = mTaskEntity.formFields.keySet();                                                            </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 116       for (String key : keys) {                                                                          </span>
<span class="224737586462576596" onmouseenter="enter('224737586462576596');" onmouseout="out('224737586462576596');" style=""> 117         addFormField(writer, key, mTaskEntity.formFields.get(key));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118       }                                                                                                  </span>
<span class="-9034637092129056499" onmouseenter="enter('-9034637092129056499');" onmouseout="out('-9034637092129056499');" style=""> 119       mListener.onStart(uploadFile.length());                                                            </span>
<span class="-699289564828458401" onmouseenter="enter('-699289564828458401');" onmouseout="out('-699289564828458401');" style=""> 120       uploadFile(writer, outputStream, mTaskEntity.attachment, uploadFile);                              </span>
<span class="5762938294954091845" onmouseenter="enter('5762938294954091845');" onmouseout="out('5762938294954091845');" style=""> 121       Log.d(TAG, finish(writer) + &quot;&quot;);                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 122     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 123       e.printStackTrace();                                                                               </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style=""> 124       fail();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126   }                                                                                                      </span>
<span  style=""> 127                                                                                                          </span>
<span class="-905072369765189017" onmouseenter="enter('-905072369765189017');" onmouseout="out('-905072369765189017');" style=""> 128   boolean isRunning() {                                                                                  </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style=""> 129     return isRunning;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130   }                                                                                                      </span>
<span  style=""> 131                                                                                                          </span>
<span class="7398204271322910742" onmouseenter="enter('7398204271322910742');" onmouseout="out('7398204271322910742');" style=""> 132   private void fail() {                                                                                  </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 133     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134   }                                                                                                      </span>
<span  style=""> 135                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 136   /**                                                                                                    </span>
<span class="-1211992867345267355" onmouseenter="enter('-1211992867345267355');" onmouseout="out('-1211992867345267355');" style=""> 137    * 添加文件上传表单字段                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 138    */                                                                                                    </span>
<span class="7619688131485087237" onmouseenter="enter('7619688131485087237');" onmouseout="out('7619688131485087237');" style=""> 139   private void addFormField(PrintWriter writer, String name, String value) {                             </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 140     writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                             </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 141     writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                             </span>
<span class="-1837819835388128060" onmouseenter="enter('-1837819835388128060');" onmouseout="out('-1837819835388128060');" style=""> 142         .append(name)                                                                                    </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 143         .append(&quot;\&quot;&quot;)                                                                                    </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 144         .append(LINE_END);                                                                               </span>
<span class="7160233832927224549" onmouseenter="enter('7160233832927224549');" onmouseout="out('7160233832927224549');" style=""> 145     writer.append(&quot;Content-Type: text/plain; charset=&quot;)                                                  </span>
<span class="-6461379044237878216" onmouseenter="enter('-6461379044237878216');" onmouseout="out('-6461379044237878216');" style=""> 146         .append(mTaskEntity.charset)                                                                     </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 147         .append(LINE_END);                                                                               </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 148     writer.append(LINE_END);                                                                             </span>
<span class="-7994885594903542734" onmouseenter="enter('-7994885594903542734');" onmouseout="out('-7994885594903542734');" style=""> 149     writer.append(value).append(LINE_END);                                                               </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 150     writer.flush();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151   }                                                                                                      </span>
<span  style=""> 152                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 153   /**                                                                                                    </span>
<span class="-5307963093749139145" onmouseenter="enter('-5307963093749139145');" onmouseout="out('-5307963093749139145');" style=""> 154    * 上传文件                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 155    *                                                                                                     </span>
<span class="5235259969989322878" onmouseenter="enter('5235259969989322878');" onmouseout="out('5235259969989322878');" style=""> 156    * @param attachment 文件上传attachment                                                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 157    * @throws IOException                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 158    */                                                                                                    </span>
<span class="-2879337732003757617" onmouseenter="enter('-2879337732003757617');" onmouseout="out('-2879337732003757617');" style=""><abbr title=" 159   private void uploadFile(PrintWriter writer, OutputStream outputStream, String attachment, File uploadFile) throws IOException {"> 159   private void uploadFile(PrintWriter writer, OutputStream outputStream, String attachment, File uploadFi🔵</abbr></span>
<span class="4524609431139126841" onmouseenter="enter('4524609431139126841');" onmouseout="out('4524609431139126841');" style=""> 160     Log.e(TAG, &quot;uploadFile&quot;);                                                                            </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 161     writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                             </span>
<span class="-3972509359744819912" onmouseenter="enter('-3972509359744819912');" onmouseout="out('-3972509359744819912');" style=""><abbr title=" 162     writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;).append(attachment).append(&quot;\&quot;; filename=\&quot;&quot;).append(mTaskEntity.uploadEntity.getFileName()).append(&quot;\&quot;&quot;).append(LINE_END);"> 162     writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;).append(attachment).append(&quot;\&quot;; filename=\&quot;&quot;)🔵</abbr></span>
<span class="-665400197139622701" onmouseenter="enter('-665400197139622701');" onmouseout="out('-665400197139622701');" style=""><abbr title=" 163     writer.append(&quot;Content-Type: &quot;).append(URLConnection.guessContentTypeFromName(mTaskEntity.uploadEntity.getFileName())).append(LINE_END);"> 163     writer.append(&quot;Content-Type: &quot;).append(URLConnection.guessContentTypeFromName(mTaskEntity.uploadEntit🔵</abbr></span>
<span class="-5574607543649470327" onmouseenter="enter('-5574607543649470327');" onmouseout="out('-5574607543649470327');" style=""> 164     writer.append(&quot;Content-Transfer-Encoding: binary&quot;).append(LINE_END);                                 </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 165     writer.append(LINE_END);                                                                             </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 166     writer.flush();                                                                                      </span>
<span class="4040387056364667362" onmouseenter="enter('4040387056364667362');" onmouseout="out('4040387056364667362');" style=""> 167     FileInputStream inputStream = new FileInputStream(uploadFile);                                       </span>
<span class="1259808987822838079" onmouseenter="enter('1259808987822838079');" onmouseout="out('1259808987822838079');" style=""> 168     byte[] buffer = new byte[4096];                                                                      </span>
<span class="-7067986891170572893" onmouseenter="enter('-7067986891170572893');" onmouseout="out('-7067986891170572893');" style=""> 169     int bytesRead;                                                                                       </span>
<span class="-4274103819161190886" onmouseenter="enter('-4274103819161190886');" onmouseout="out('-4274103819161190886');" style=""> 170     while ((bytesRead = inputStream.read(buffer)) != (-1)) {                                             </span>
<span class="1251564898405321462" onmouseenter="enter('1251564898405321462');" onmouseout="out('1251564898405321462');" style=""> 171       mCurrentLocation += bytesRead;                                                                     </span>
<span class="6812214684476640601" onmouseenter="enter('6812214684476640601');" onmouseout="out('6812214684476640601');" style=""> 172       outputStream.write(buffer, 0, bytesRead);                                                          </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 173       if (isCancel) {                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 174         break;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175       }                                                                                                  </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style=""> 176       isRunning = true;                                                                                  </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style=""> 177       mListener.onProgress(mCurrentLocation);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178     }                                                                                                    </span>
<span class="-8060077804843641817" onmouseenter="enter('-8060077804843641817');" onmouseout="out('-8060077804843641817');" style=""> 179     outputStream.flush();                                                                                </span>
<span class="338817727459642684" onmouseenter="enter('338817727459642684');" onmouseout="out('338817727459642684');" style=""> 180     inputStream.close();                                                                                 </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 181     writer.append(LINE_END);                                                                             </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 182     writer.flush();                                                                                      </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style=""> 183     isRunning = false;                                                                                   </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 184     if (isCancel) {                                                                                      </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 185       mListener.onCancel();                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 186       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187     }                                                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 188     mListener.onComplete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189   }                                                                                                      </span>
<span  style=""> 190                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 191   /**                                                                                                    </span>
<span class="8090914033664120342" onmouseenter="enter('8090914033664120342');" onmouseout="out('8090914033664120342');" style=""> 192    * 任务结束操作                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 193    *                                                                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 194    * @throws IOException                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 195    */                                                                                                    </span>
<span class="-6712242018334182923" onmouseenter="enter('-6712242018334182923');" onmouseout="out('-6712242018334182923');" style=""> 196   private String finish(PrintWriter writer) throws IOException {                                         </span>
<span class="-3213513309039140359" onmouseenter="enter('-3213513309039140359');" onmouseout="out('-3213513309039140359');" style=""> 197     StringBuilder response = new StringBuilder();                                                        </span>
<span  style=""> 198                                                                                                          </span>
<span class="3673413535200466883" onmouseenter="enter('3673413535200466883');" onmouseout="out('3673413535200466883');" style=""> 199     writer.append(LINE_END).flush();                                                                     </span>
<span class="-6942559868418828891" onmouseenter="enter('-6942559868418828891');" onmouseout="out('-6942559868418828891');" style=""> 200     writer.append(PREFIX).append(BOUNDARY).append(PREFIX).append(LINE_END);                              </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 201     writer.close();                                                                                      </span>
<span  style=""> 202                                                                                                          </span>
<span class="-7766630665701464966" onmouseenter="enter('-7766630665701464966');" onmouseout="out('-7766630665701464966');" style=""> 203     int status = mHttpConn.getResponseCode();                                                            </span>
<span class="3009894602238525978" onmouseenter="enter('3009894602238525978');" onmouseout="out('3009894602238525978');" style=""> 204     if (status == HttpURLConnection.HTTP_OK) {                                                           </span>
<span class="-697229362038129983" onmouseenter="enter('-697229362038129983');" onmouseout="out('-697229362038129983');" style=""> 205       BufferedReader reader = new BufferedReader(new InputStreamReader(mHttpConn.getInputStream()));     </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style=""> 206       String line;                                                                                       </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style=""> 207       while ((line = reader.readLine()) != null) {                                                       </span>
<span class="-7195029802899220801" onmouseenter="enter('-7195029802899220801');" onmouseout="out('-7195029802899220801');" style=""> 208         response.append(line);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209       }                                                                                                  </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style=""> 210       reader.close();                                                                                    </span>
<span class="6290572035394845602" onmouseenter="enter('6290572035394845602');" onmouseout="out('6290572035394845602');" style=""> 211       mHttpConn.disconnect();                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 212     } else {                                                                                             </span>
<span class="-8134780005978126053" onmouseenter="enter('-8134780005978126053');" onmouseout="out('-8134780005978126053');" style=""> 213       Log.w(TAG, &quot;state_code = &quot; + status);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 216     writer.flush();                                                                                      </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 217     writer.close();                                                                                      </span>
<span  style=""> 218                                                                                                          </span>
<span class="973858829207738010" onmouseenter="enter('973858829207738010');" onmouseout="out('973858829207738010');" style=""> 219     return response.toString();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221 }                                                                                                        </span>










</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="2296433254624375089" onmouseenter="enter('2296433254624375089');" onmouseout="out('2296433254624375089');" style="">  16  package com.arialyy.aria.core.upload;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  18  import android.util.Log;                                                                                          </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  19  import com.arialyy.aria.util.CheckUtil;                                                                           </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="">  20  import java.io.BufferedReader;                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  21  import java.io.File;                                                                                              </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  22  import java.io.FileInputStream;                                                                                   </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  23  import java.io.IOException;                                                                                       </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="">  24  import java.io.InputStreamReader;                                                                                 </span>
<span class="4621164050749610193" onmouseenter="enter('4621164050749610193');" onmouseout="out('4621164050749610193');" style="">  25  import java.io.OutputStream;                                                                                      </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="">  26  import java.io.OutputStreamWriter;                                                                                </span>
<span class="188494595561851451" onmouseenter="enter('188494595561851451');" onmouseout="out('188494595561851451');" style="">  27  import java.io.PrintWriter;                                                                                       </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  28  import java.net.HttpURLConnection;                                                                                </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  29  import java.net.URL;                                                                                              </span>
<span class="-5521468699455618699" onmouseenter="enter('-5521468699455618699');" onmouseout="out('-5521468699455618699');" style="">  30  import java.net.URLConnection;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  31  import java.util.Set;                                                                                             </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  32  import java.util.UUID;                                                                                            </span>
<span  style="">  33                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  34  /**                                                                                                               </span>
<span class="-6400750417840662839" onmouseenter="enter('-6400750417840662839');" onmouseout="out('-6400750417840662839');" style="">  35   * Created by Aria.Lao on 2017/2/9.                                                                               </span>
<span class="-4299352450658306013" onmouseenter="enter('-4299352450658306013');" onmouseout="out('-4299352450658306013');" style="">  36   * 上传工具                                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  37   */                                                                                                               </span>
<span class="-5707704917663703030" onmouseenter="enter('-5707704917663703030');" onmouseout="out('-5707704917663703030');" style="">  38  public class UploadUtil implements Runnable {                                                                     </span>
<span class="-3724454848507439391" onmouseenter="enter('-3724454848507439391');" onmouseout="out('-3724454848507439391');" style="">  39    private static final String TAG = &quot;UploadUtil&quot;;                                                                 </span>
<span class="4601955423512060976" onmouseenter="enter('4601955423512060976');" onmouseout="out('4601955423512060976');" style="">  40    private final String BOUNDARY = UUID.randomUUID().toString(); // 边界标识 随机生成                                      </span>
<span class="-986211549012609109" onmouseenter="enter('-986211549012609109');" onmouseout="out('-986211549012609109');" style="">  41    private final String PREFIX = &quot;--&quot;, LINE_END = &quot;\r\n&quot;;                                                          </span>
<span class="-4895228480728785048" onmouseenter="enter('-4895228480728785048');" onmouseout="out('-4895228480728785048');" style="">  42    private UploadEntity mUploadEntity;                                                                             </span>
<span class="-7667731813459538063" onmouseenter="enter('-7667731813459538063');" onmouseout="out('-7667731813459538063');" style="">  43    private UploadTaskEntity mTaskEntity;                                                                           </span>
<span class="-4450121024944087023" onmouseenter="enter('-4450121024944087023');" onmouseout="out('-4450121024944087023');" style="">  44    private IUploadListener mListener;                                                                              </span>
<span class="-333925809319807249" onmouseenter="enter('-333925809319807249');" onmouseout="out('-333925809319807249');" style="">  45    private HttpURLConnection mHttpConn;                                                                            </span>
<span class="5356975924392872579" onmouseenter="enter('5356975924392872579');" onmouseout="out('5356975924392872579');" style="">  46    private long mCurrentLocation = 0;                                                                              </span>
<span class="6610618430806440993" onmouseenter="enter('6610618430806440993');" onmouseout="out('6610618430806440993');" style="">  47    private boolean isCancel = false;                                                                               </span>
<span class="-7014396160817654560" onmouseenter="enter('-7014396160817654560');" onmouseout="out('-7014396160817654560');" style="">  48    private boolean isRunning = false;                                                                              </span>
<span  style="">  49                                                                                                                    </span>
<span class="-4378274624765085007" onmouseenter="enter('-4378274624765085007');" onmouseout="out('-4378274624765085007');" style="">  50    public UploadUtil(UploadTaskEntity taskEntity, IUploadListener listener) {                                      </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  51      mTaskEntity = taskEntity;                                                                                     </span>
<span class="-5397140926211959544" onmouseenter="enter('-5397140926211959544');" onmouseout="out('-5397140926211959544');" style="">  52      CheckUtil.checkUploadEntity(taskEntity.uploadEntity);                                                         </span>
<span class="7818534483611280473" onmouseenter="enter('7818534483611280473');" onmouseout="out('7818534483611280473');" style="">  53      mUploadEntity = taskEntity.uploadEntity;                                                                      </span>
<span class="6410471256291283437" onmouseenter="enter('6410471256291283437');" onmouseout="out('6410471256291283437');" style="">  54      if (listener == null) {                                                                                       </span>
<span class="-3877746287627857629" onmouseenter="enter('-3877746287627857629');" onmouseout="out('-3877746287627857629');" style="">  55        throw new IllegalArgumentException(&quot;上传监听不能为空&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56      }                                                                                                             </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  57      mListener = listener;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58    }                                                                                                               </span>
<span  style="">  59                                                                                                                    </span>
<span class="-2648331188945203940" onmouseenter="enter('-2648331188945203940');" onmouseout="out('-2648331188945203940');" style="">  60    public void start() {                                                                                           </span>
<span class="7658640897919599872" onmouseenter="enter('7658640897919599872');" onmouseout="out('7658640897919599872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +    Log.d(TAG, &quot;start&quot;);                                                                                          </span>
<span class="-5580853241009618205" onmouseenter="enter('-5580853241009618205');" onmouseout="out('-5580853241009618205');" style="">  62      isCancel = false;                                                                                             </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  63      isRunning = false;                                                                                            </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="">  64      new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65    }                                                                                                               </span>
<span  style="">  66                                                                                                                    </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style="">  67    public void cancel() {                                                                                          </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="">  68      isCancel = true;                                                                                              </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  69      isRunning = false;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70    }                                                                                                               </span>
<span  style="">  71                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  72    @Override public void run() {                                                                                   </span>
<span class="-3930199446811223366" onmouseenter="enter('-3930199446811223366');" onmouseout="out('-3930199446811223366');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +    Log.e(TAG, &quot;run&quot;);                                                                                            </span>
<span class="-4654815309234540461" onmouseenter="enter('-4654815309234540461');" onmouseout="out('-4654815309234540461');" style="">  74      File uploadFile = new File(mUploadEntity.getFilePath());                                                      </span>
<span class="-7440468768172298093" onmouseenter="enter('-7440468768172298093');" onmouseout="out('-7440468768172298093');" style="">  75      if (!uploadFile.exists()) {                                                                                   </span>
<span class="3670297489558872216" onmouseenter="enter('3670297489558872216');" onmouseout="out('3670297489558872216');" style="">  76        Log.e(TAG, &quot;【&quot; + mUploadEntity.getFilePath() + &quot;】，文件不存在。&quot;);                                                 </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style="">  77        fail();                                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  78        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79      }                                                                                                             </span>
<span  style="">  80                                                                                                                    </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="">  81      mListener.onPre();                                                                                            </span>
<span  style="">  82                                                                                                                    </span>
<span class="3442630168795471555" onmouseenter="enter('3442630168795471555');" onmouseout="out('3442630168795471555');" style="">  83      URL url;                                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  84      try {                                                                                                         </span>
<span class="-3237270879792511864" onmouseenter="enter('-3237270879792511864');" onmouseout="out('-3237270879792511864');" style="">  85        url = new URL(mTaskEntity.uploadUrl);                                                                       </span>
<span class="-9098060409631350199" onmouseenter="enter('-9098060409631350199');" onmouseout="out('-9098060409631350199');" style="">  86        mHttpConn = (HttpURLConnection) url.openConnection();                                                       </span>
<span class="-8042386604808273921" onmouseenter="enter('-8042386604808273921');" onmouseout="out('-8042386604808273921');" style="">  87        mHttpConn.setUseCaches(false);                                                                              </span>
<span class="-819609990863481625" onmouseenter="enter('-819609990863481625');" onmouseout="out('-819609990863481625');" style="">  88        mHttpConn.setDoOutput(true);                                                                                </span>
<span class="-2828311995571883529" onmouseenter="enter('-2828311995571883529');" onmouseout="out('-2828311995571883529');" style="">  89        mHttpConn.setDoInput(true);                                                                                 </span>
<span class="7496337321827260410" onmouseenter="enter('7496337321827260410');" onmouseout="out('7496337321827260410');" style="">  90        mHttpConn.setRequestProperty(&quot;Content-Type&quot;,                                                                </span>
<span class="-6872149995828718188" onmouseenter="enter('-6872149995828718188');" onmouseout="out('-6872149995828718188');" style="">  91            mTaskEntity.contentType + &quot;; boundary=&quot; + BOUNDARY);                                                    </span>
<span class="-1152444464189443777" onmouseenter="enter('-1152444464189443777');" onmouseout="out('-1152444464189443777');" style="">  92        mHttpConn.setRequestProperty(&quot;User-Agent&quot;, mTaskEntity.userAgent);                                          </span>
<span class="9024482569447258132" onmouseenter="enter('9024482569447258132');" onmouseout="out('9024482569447258132');" style="">  93        //mHttpConn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot; + &quot;100&quot;);                                        </span>
<span class="-7778714341502295972" onmouseenter="enter('-7778714341502295972');" onmouseout="out('-7778714341502295972');" style="">  94        //内部缓冲区---分段上传防止oom                                                                                         </span>
<span class="2953946561574030999" onmouseenter="enter('2953946561574030999');" onmouseout="out('2953946561574030999');" style="">  95        mHttpConn.setChunkedStreamingMode(1024);                                                                    </span>
<span  style="">  96                                                                                                                    </span>
<span class="-8255006708775639880" onmouseenter="enter('-8255006708775639880');" onmouseout="out('-8255006708775639880');" style="">  97        //添加Http请求头部                                                                                                </span>
<span class="2465544298625110221" onmouseenter="enter('2465544298625110221');" onmouseout="out('2465544298625110221');" style="">  98        Set&lt;String&gt; keys = mTaskEntity.headers.keySet();                                                            </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  99        for (String key : keys) {                                                                                   </span>
<span class="6920539915464580201" onmouseenter="enter('6920539915464580201');" onmouseout="out('6920539915464580201');" style=""> 100          mHttpConn.setRequestProperty(key, mTaskEntity.headers.get(key));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101        }                                                                                                           </span>
<span  style=""> 102                                                                                                                    </span>
<span class="-5663197000219230409" onmouseenter="enter('-5663197000219230409');" onmouseout="out('-5663197000219230409');" style=""> 103        OutputStream outputStream = mHttpConn.getOutputStream();                                                    </span>
<span class="-5601399779707962135" onmouseenter="enter('-5601399779707962135');" onmouseout="out('-5601399779707962135');" style=""> 104        PrintWriter writer =                                                                                        </span>
<span class="-6867234444748414110" onmouseenter="enter('-6867234444748414110');" onmouseout="out('-6867234444748414110');" style=""> 105            new PrintWriter(new OutputStreamWriter(outputStream, mTaskEntity.charset), true);                       </span>
<span  style=""> 106                                                                                                                    </span>
<span class="7728457972062474717" onmouseenter="enter('7728457972062474717');" onmouseout="out('7728457972062474717');" style=""> 107        //添加文件上传表单字段                                                                                                </span>
<span class="-8415422093392386204" onmouseenter="enter('-8415422093392386204');" onmouseout="out('-8415422093392386204');" style=""> 108        keys = mTaskEntity.formFields.keySet();                                                                     </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 109        for (String key : keys) {                                                                                   </span>
<span class="224737586462576596" onmouseenter="enter('224737586462576596');" onmouseout="out('224737586462576596');" style=""> 110          addFormField(writer, key, mTaskEntity.formFields.get(key));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111        }                                                                                                           </span>
<span class="-9034637092129056499" onmouseenter="enter('-9034637092129056499');" onmouseout="out('-9034637092129056499');" style=""> 112        mListener.onStart(uploadFile.length());                                                                     </span>
<span class="-699289564828458401" onmouseenter="enter('-699289564828458401');" onmouseout="out('-699289564828458401');" style=""> 113        uploadFile(writer, outputStream, mTaskEntity.attachment, uploadFile);                                       </span>
<span class="5762938294954091845" onmouseenter="enter('5762938294954091845');" onmouseout="out('5762938294954091845');" style=""> 114        Log.d(TAG, finish(writer) + &quot;&quot;);                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 115      } catch (IOException e) {                                                                                     </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 116        e.printStackTrace();                                                                                        </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style=""> 117        fail();                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119    }                                                                                                               </span>
<span  style=""> 120                                                                                                                    </span>
<span class="-905072369765189017" onmouseenter="enter('-905072369765189017');" onmouseout="out('-905072369765189017');" style=""> 121    boolean isRunning() {                                                                                           </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style=""> 122      return isRunning;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123    }                                                                                                               </span>
<span  style=""> 124                                                                                                                    </span>
<span class="7398204271322910742" onmouseenter="enter('7398204271322910742');" onmouseout="out('7398204271322910742');" style=""> 125    private void fail() {                                                                                           </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 126      mListener.onFail();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127    }                                                                                                               </span>
<span  style=""> 128                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 129    /**                                                                                                             </span>
<span class="-1211992867345267355" onmouseenter="enter('-1211992867345267355');" onmouseout="out('-1211992867345267355');" style=""> 130     * 添加文件上传表单字段                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 131     */                                                                                                             </span>
<span class="7619688131485087237" onmouseenter="enter('7619688131485087237');" onmouseout="out('7619688131485087237');" style=""> 132    private void addFormField(PrintWriter writer, String name, String value) {                                      </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 133      writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                                      </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 134      writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                                      </span>
<span class="-1837819835388128060" onmouseenter="enter('-1837819835388128060');" onmouseout="out('-1837819835388128060');" style=""> 135          .append(name)                                                                                             </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 136          .append(&quot;\&quot;&quot;)                                                                                             </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 137          .append(LINE_END);                                                                                        </span>
<span class="7160233832927224549" onmouseenter="enter('7160233832927224549');" onmouseout="out('7160233832927224549');" style=""> 138      writer.append(&quot;Content-Type: text/plain; charset=&quot;)                                                           </span>
<span class="-6461379044237878216" onmouseenter="enter('-6461379044237878216');" onmouseout="out('-6461379044237878216');" style=""> 139          .append(mTaskEntity.charset)                                                                              </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 140          .append(LINE_END);                                                                                        </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 141      writer.append(LINE_END);                                                                                      </span>
<span class="-7994885594903542734" onmouseenter="enter('-7994885594903542734');" onmouseout="out('-7994885594903542734');" style=""> 142      writer.append(value).append(LINE_END);                                                                        </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 143      writer.flush();                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144    }                                                                                                               </span>
<span  style=""> 145                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 146    /**                                                                                                             </span>
<span class="-5307963093749139145" onmouseenter="enter('-5307963093749139145');" onmouseout="out('-5307963093749139145');" style=""> 147     * 上传文件                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 148     *                                                                                                              </span>
<span class="5235259969989322878" onmouseenter="enter('5235259969989322878');" onmouseout="out('5235259969989322878');" style=""> 149     * @param attachment 文件上传attachment                                                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 150     * @throws IOException                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 151     */                                                                                                             </span>
<span class="-8241348058297716231" onmouseenter="enter('-8241348058297716231');" onmouseout="out('-8241348058297716231');" style=""> 152    private void uploadFile(PrintWriter writer, OutputStream outputStream, String attachment,                       </span>
<span class="1882173450944731504" onmouseenter="enter('1882173450944731504');" onmouseout="out('1882173450944731504');" style=""> 153        File uploadFile) throws IOException {                                                                       </span>
<span class="4524609431139126841" onmouseenter="enter('4524609431139126841');" onmouseout="out('4524609431139126841');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +    Log.e(TAG, &quot;uploadFile&quot;);                                                                                     </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 155      writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                                      </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 156      writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                                      </span>
<span class="-5346981064803419075" onmouseenter="enter('-5346981064803419075');" onmouseout="out('-5346981064803419075');" style=""> 157          .append(attachment)                                                                                       </span>
<span class="-7270534301950586768" onmouseenter="enter('-7270534301950586768');" onmouseout="out('-7270534301950586768');" style=""> 158          .append(&quot;\&quot;; filename=\&quot;&quot;)                                                                                </span>
<span class="1019288102601849811" onmouseenter="enter('1019288102601849811');" onmouseout="out('1019288102601849811');" style=""> 159          .append(mTaskEntity.uploadEntity.getFileName())                                                           </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 160          .append(&quot;\&quot;&quot;)                                                                                             </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 161          .append(LINE_END);                                                                                        </span>
<span class="8956639741096524789" onmouseenter="enter('8956639741096524789');" onmouseout="out('8956639741096524789');" style=""> 162      writer.append(&quot;Content-Type: &quot;)                                                                               </span>
<span class="164085665237946380" onmouseenter="enter('164085665237946380');" onmouseout="out('164085665237946380');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -        //.append(URLConnection.guessContentTypeFromName(mTaskEntity.uploadEntity.getFileName()))                 </span>
<span class="-3276318543060893757" onmouseenter="enter('-3276318543060893757');" onmouseout="out('-3276318543060893757');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -        .append(mTaskEntity.contentType)                                                                          </span>
<span class="8182389533569034942" onmouseenter="enter('8182389533569034942');" onmouseout="out('8182389533569034942');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +        .append(URLConnection.guessContentTypeFromName(mTaskEntity.uploadEntity.getFileName()))                   </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 166          .append(LINE_END);                                                                                        </span>
<span class="-5574607543649470327" onmouseenter="enter('-5574607543649470327');" onmouseout="out('-5574607543649470327');" style=""> 167      writer.append(&quot;Content-Transfer-Encoding: binary&quot;).append(LINE_END);                                          </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 168      writer.append(LINE_END);                                                                                      </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 169      writer.flush();                                                                                               </span>
<span  style=""> 170                                                                                                                    </span>
<span class="4040387056364667362" onmouseenter="enter('4040387056364667362');" onmouseout="out('4040387056364667362');" style=""> 171      FileInputStream inputStream = new FileInputStream(uploadFile);                                                </span>
<span class="1259808987822838079" onmouseenter="enter('1259808987822838079');" onmouseout="out('1259808987822838079');" style=""> 172      byte[] buffer = new byte[4096];                                                                               </span>
<span class="-7067986891170572893" onmouseenter="enter('-7067986891170572893');" onmouseout="out('-7067986891170572893');" style=""> 173      int bytesRead;                                                                                                </span>
<span class="-9072059992252399296" onmouseenter="enter('-9072059992252399296');" onmouseout="out('-9072059992252399296');" style=""> 174      while ((bytesRead = inputStream.read(buffer)) != -1) {                                                        </span>
<span class="1251564898405321462" onmouseenter="enter('1251564898405321462');" onmouseout="out('1251564898405321462');" style=""> 175        mCurrentLocation += bytesRead;                                                                              </span>
<span class="6812214684476640601" onmouseenter="enter('6812214684476640601');" onmouseout="out('6812214684476640601');" style=""> 176        outputStream.write(buffer, 0, bytesRead);                                                                   </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 177        if (isCancel) {                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 178          break;                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179        }                                                                                                           </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style=""> 180        isRunning = true;                                                                                           </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style=""> 181        mListener.onProgress(mCurrentLocation);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182      }                                                                                                             </span>
<span  style=""> 183                                                                                                                    </span>
<span class="-8060077804843641817" onmouseenter="enter('-8060077804843641817');" onmouseout="out('-8060077804843641817');" style=""> 184      outputStream.flush();                                                                                         </span>
<span class="-3601486130051957792" onmouseenter="enter('-3601486130051957792');" onmouseout="out('-3601486130051957792');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -    outputStream.close();                                                                                         </span>
<span class="6170255880024854048" onmouseenter="enter('6170255880024854048');" onmouseout="out('6170255880024854048');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +    //outputStream.close(); //不能调用，否则服务器端异常                                                                       </span>
<span class="338817727459642684" onmouseenter="enter('338817727459642684');" onmouseout="out('338817727459642684');" style=""> 187      inputStream.close();                                                                                          </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 188      writer.append(LINE_END);                                                                                      </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 189      writer.flush();                                                                                               </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style=""> 190      isRunning = false;                                                                                            </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 191      if (isCancel) {                                                                                               </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 192        mListener.onCancel();                                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 193        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194      }                                                                                                             </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 195      mListener.onComplete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196    }                                                                                                               </span>
<span  style=""> 197                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 198    /**                                                                                                             </span>
<span class="8090914033664120342" onmouseenter="enter('8090914033664120342');" onmouseout="out('8090914033664120342');" style=""> 199     * 任务结束操作                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 200     *                                                                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 201     * @throws IOException                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 202     */                                                                                                             </span>
<span class="-6712242018334182923" onmouseenter="enter('-6712242018334182923');" onmouseout="out('-6712242018334182923');" style=""> 203    private String finish(PrintWriter writer) throws IOException {                                                  </span>
<span class="-3213513309039140359" onmouseenter="enter('-3213513309039140359');" onmouseout="out('-3213513309039140359');" style=""> 204      StringBuilder response = new StringBuilder();                                                                 </span>
<span  style=""> 205                                                                                                                    </span>
<span class="3673413535200466883" onmouseenter="enter('3673413535200466883');" onmouseout="out('3673413535200466883');" style=""> 206      writer.append(LINE_END).flush();                                                                              </span>
<span class="-6942559868418828891" onmouseenter="enter('-6942559868418828891');" onmouseout="out('-6942559868418828891');" style=""> 207      writer.append(PREFIX).append(BOUNDARY).append(PREFIX).append(LINE_END);                                       </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 208      writer.close();                                                                                               </span>
<span  style=""> 209                                                                                                                    </span>
<span class="-7766630665701464966" onmouseenter="enter('-7766630665701464966');" onmouseout="out('-7766630665701464966');" style=""> 210      int status = mHttpConn.getResponseCode();                                                                     </span>
<span class="3009894602238525978" onmouseenter="enter('3009894602238525978');" onmouseout="out('3009894602238525978');" style=""> 211      if (status == HttpURLConnection.HTTP_OK) {                                                                    </span>
<span class="-697229362038129983" onmouseenter="enter('-697229362038129983');" onmouseout="out('-697229362038129983');" style=""> 212        BufferedReader reader = new BufferedReader(new InputStreamReader(mHttpConn.getInputStream()));              </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style=""> 213        String line;                                                                                                </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style=""> 214        while ((line = reader.readLine()) != null) {                                                                </span>
<span class="-7195029802899220801" onmouseenter="enter('-7195029802899220801');" onmouseout="out('-7195029802899220801');" style=""> 215          response.append(line);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216        }                                                                                                           </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style=""> 217        reader.close();                                                                                             </span>
<span class="6290572035394845602" onmouseenter="enter('6290572035394845602');" onmouseout="out('6290572035394845602');" style=""> 218        mHttpConn.disconnect();                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 219      } else {                                                                                                      </span>
<span class="-8134780005978126053" onmouseenter="enter('-8134780005978126053');" onmouseout="out('-8134780005978126053');" style=""> 220        Log.w(TAG, &quot;state_code = &quot; + status);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221      }                                                                                                             </span>
<span  style=""> 222                                                                                                                    </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 223      writer.flush();                                                                                               </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 224      writer.close();                                                                                               </span>
<span  style=""> 225                                                                                                                    </span>
<span class="973858829207738010" onmouseenter="enter('973858829207738010');" onmouseout="out('973858829207738010');" style=""> 226      return response.toString();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="2296433254624375089" onmouseenter="enter('2296433254624375089');" onmouseout="out('2296433254624375089');" style="">  16  package com.arialyy.aria.core.upload;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  18  import android.util.Log;                                                                                          </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  19  import com.arialyy.aria.util.CheckUtil;                                                                           </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="">  20  import java.io.BufferedReader;                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  21  import java.io.File;                                                                                              </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  22  import java.io.FileInputStream;                                                                                   </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  23  import java.io.IOException;                                                                                       </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="">  24  import java.io.InputStreamReader;                                                                                 </span>
<span class="4621164050749610193" onmouseenter="enter('4621164050749610193');" onmouseout="out('4621164050749610193');" style="">  25  import java.io.OutputStream;                                                                                      </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="">  26  import java.io.OutputStreamWriter;                                                                                </span>
<span class="188494595561851451" onmouseenter="enter('188494595561851451');" onmouseout="out('188494595561851451');" style="">  27  import java.io.PrintWriter;                                                                                       </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  28  import java.net.HttpURLConnection;                                                                                </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  29  import java.net.URL;                                                                                              </span>
<span class="-5521468699455618699" onmouseenter="enter('-5521468699455618699');" onmouseout="out('-5521468699455618699');" style="">  30  import java.net.URLConnection;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  31  import java.util.Set;                                                                                             </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  32  import java.util.UUID;                                                                                            </span>
<span  style="">  33                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  34  /**                                                                                                               </span>
<span class="-6400750417840662839" onmouseenter="enter('-6400750417840662839');" onmouseout="out('-6400750417840662839');" style="">  35   * Created by Aria.Lao on 2017/2/9.                                                                               </span>
<span class="-4299352450658306013" onmouseenter="enter('-4299352450658306013');" onmouseout="out('-4299352450658306013');" style="">  36   * 上传工具                                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  37   */                                                                                                               </span>
<span class="-5707704917663703030" onmouseenter="enter('-5707704917663703030');" onmouseout="out('-5707704917663703030');" style="">  38  public class UploadUtil implements Runnable {                                                                     </span>
<span class="-3724454848507439391" onmouseenter="enter('-3724454848507439391');" onmouseout="out('-3724454848507439391');" style="">  39    private static final String TAG = &quot;UploadUtil&quot;;                                                                 </span>
<span class="4601955423512060976" onmouseenter="enter('4601955423512060976');" onmouseout="out('4601955423512060976');" style="">  40    private final String BOUNDARY = UUID.randomUUID().toString(); // 边界标识 随机生成                                      </span>
<span class="-986211549012609109" onmouseenter="enter('-986211549012609109');" onmouseout="out('-986211549012609109');" style="">  41    private final String PREFIX = &quot;--&quot;, LINE_END = &quot;\r\n&quot;;                                                          </span>
<span class="-4895228480728785048" onmouseenter="enter('-4895228480728785048');" onmouseout="out('-4895228480728785048');" style="">  42    private UploadEntity mUploadEntity;                                                                             </span>
<span class="-7667731813459538063" onmouseenter="enter('-7667731813459538063');" onmouseout="out('-7667731813459538063');" style="">  43    private UploadTaskEntity mTaskEntity;                                                                           </span>
<span class="-4450121024944087023" onmouseenter="enter('-4450121024944087023');" onmouseout="out('-4450121024944087023');" style="">  44    private IUploadListener mListener;                                                                              </span>
<span class="-333925809319807249" onmouseenter="enter('-333925809319807249');" onmouseout="out('-333925809319807249');" style="">  45    private HttpURLConnection mHttpConn;                                                                            </span>
<span class="5356975924392872579" onmouseenter="enter('5356975924392872579');" onmouseout="out('5356975924392872579');" style="">  46    private long mCurrentLocation = 0;                                                                              </span>
<span class="6610618430806440993" onmouseenter="enter('6610618430806440993');" onmouseout="out('6610618430806440993');" style="">  47    private boolean isCancel = false;                                                                               </span>
<span class="-7014396160817654560" onmouseenter="enter('-7014396160817654560');" onmouseout="out('-7014396160817654560');" style="">  48    private boolean isRunning = false;                                                                              </span>
<span  style="">  49                                                                                                                    </span>
<span class="-4378274624765085007" onmouseenter="enter('-4378274624765085007');" onmouseout="out('-4378274624765085007');" style="">  50    public UploadUtil(UploadTaskEntity taskEntity, IUploadListener listener) {                                      </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  51      mTaskEntity = taskEntity;                                                                                     </span>
<span class="-5397140926211959544" onmouseenter="enter('-5397140926211959544');" onmouseout="out('-5397140926211959544');" style="">  52      CheckUtil.checkUploadEntity(taskEntity.uploadEntity);                                                         </span>
<span class="7818534483611280473" onmouseenter="enter('7818534483611280473');" onmouseout="out('7818534483611280473');" style="">  53      mUploadEntity = taskEntity.uploadEntity;                                                                      </span>
<span class="6410471256291283437" onmouseenter="enter('6410471256291283437');" onmouseout="out('6410471256291283437');" style="">  54      if (listener == null) {                                                                                       </span>
<span class="-3877746287627857629" onmouseenter="enter('-3877746287627857629');" onmouseout="out('-3877746287627857629');" style="">  55        throw new IllegalArgumentException(&quot;上传监听不能为空&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56      }                                                                                                             </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  57      mListener = listener;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58    }                                                                                                               </span>
<span  style="">  59                                                                                                                    </span>
<span class="-2648331188945203940" onmouseenter="enter('-2648331188945203940');" onmouseout="out('-2648331188945203940');" style="">  60    public void start() {                                                                                           </span>

<span class="-5580853241009618205" onmouseenter="enter('-5580853241009618205');" onmouseout="out('-5580853241009618205');" style="">  61      isCancel = false;                                                                                             </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  62      isRunning = false;                                                                                            </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="">  63      new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  64    }                                                                                                               </span>
<span  style="">  65                                                                                                                    </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style="">  66    public void cancel() {                                                                                          </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="">  67      isCancel = true;                                                                                              </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style="">  68      isRunning = false;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69    }                                                                                                               </span>
<span  style="">  70                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  71    @Override public void run() {                                                                                   </span>

<span class="-4654815309234540461" onmouseenter="enter('-4654815309234540461');" onmouseout="out('-4654815309234540461');" style="">  72      File uploadFile = new File(mUploadEntity.getFilePath());                                                      </span>
<span class="-7440468768172298093" onmouseenter="enter('-7440468768172298093');" onmouseout="out('-7440468768172298093');" style="">  73      if (!uploadFile.exists()) {                                                                                   </span>
<span class="3670297489558872216" onmouseenter="enter('3670297489558872216');" onmouseout="out('3670297489558872216');" style="">  74        Log.e(TAG, &quot;【&quot; + mUploadEntity.getFilePath() + &quot;】，文件不存在。&quot;);                                                 </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style="">  75        fail();                                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  76        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77      }                                                                                                             </span>
<span  style="">  78                                                                                                                    </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="">  79      mListener.onPre();                                                                                            </span>
<span  style="">  80                                                                                                                    </span>
<span class="3442630168795471555" onmouseenter="enter('3442630168795471555');" onmouseout="out('3442630168795471555');" style="">  81      URL url;                                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  82      try {                                                                                                         </span>
<span class="-3237270879792511864" onmouseenter="enter('-3237270879792511864');" onmouseout="out('-3237270879792511864');" style="">  83        url = new URL(mTaskEntity.uploadUrl);                                                                       </span>
<span class="-9098060409631350199" onmouseenter="enter('-9098060409631350199');" onmouseout="out('-9098060409631350199');" style="">  84        mHttpConn = (HttpURLConnection) url.openConnection();                                                       </span>
<span class="-8042386604808273921" onmouseenter="enter('-8042386604808273921');" onmouseout="out('-8042386604808273921');" style="">  85        mHttpConn.setUseCaches(false);                                                                              </span>
<span class="-819609990863481625" onmouseenter="enter('-819609990863481625');" onmouseout="out('-819609990863481625');" style="">  86        mHttpConn.setDoOutput(true);                                                                                </span>
<span class="-2828311995571883529" onmouseenter="enter('-2828311995571883529');" onmouseout="out('-2828311995571883529');" style="">  87        mHttpConn.setDoInput(true);                                                                                 </span>
<span class="7496337321827260410" onmouseenter="enter('7496337321827260410');" onmouseout="out('7496337321827260410');" style="">  88        mHttpConn.setRequestProperty(&quot;Content-Type&quot;,                                                                </span>
<span class="-6872149995828718188" onmouseenter="enter('-6872149995828718188');" onmouseout="out('-6872149995828718188');" style="">  89            mTaskEntity.contentType + &quot;; boundary=&quot; + BOUNDARY);                                                    </span>
<span class="-1152444464189443777" onmouseenter="enter('-1152444464189443777');" onmouseout="out('-1152444464189443777');" style="">  90        mHttpConn.setRequestProperty(&quot;User-Agent&quot;, mTaskEntity.userAgent);                                          </span>
<span class="9024482569447258132" onmouseenter="enter('9024482569447258132');" onmouseout="out('9024482569447258132');" style="">  91        //mHttpConn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot; + &quot;100&quot;);                                        </span>
<span class="-7778714341502295972" onmouseenter="enter('-7778714341502295972');" onmouseout="out('-7778714341502295972');" style="">  92        //内部缓冲区---分段上传防止oom                                                                                         </span>
<span class="2953946561574030999" onmouseenter="enter('2953946561574030999');" onmouseout="out('2953946561574030999');" style="">  93        mHttpConn.setChunkedStreamingMode(1024);                                                                    </span>
<span  style="">  94                                                                                                                    </span>
<span class="-8255006708775639880" onmouseenter="enter('-8255006708775639880');" onmouseout="out('-8255006708775639880');" style="">  95        //添加Http请求头部                                                                                                </span>
<span class="2465544298625110221" onmouseenter="enter('2465544298625110221');" onmouseout="out('2465544298625110221');" style="">  96        Set&lt;String&gt; keys = mTaskEntity.headers.keySet();                                                            </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  97        for (String key : keys) {                                                                                   </span>
<span class="6920539915464580201" onmouseenter="enter('6920539915464580201');" onmouseout="out('6920539915464580201');" style="">  98          mHttpConn.setRequestProperty(key, mTaskEntity.headers.get(key));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99        }                                                                                                           </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-5663197000219230409" onmouseenter="enter('-5663197000219230409');" onmouseout="out('-5663197000219230409');" style=""> 101        OutputStream outputStream = mHttpConn.getOutputStream();                                                    </span>
<span class="-5601399779707962135" onmouseenter="enter('-5601399779707962135');" onmouseout="out('-5601399779707962135');" style=""> 102        PrintWriter writer =                                                                                        </span>
<span class="-6867234444748414110" onmouseenter="enter('-6867234444748414110');" onmouseout="out('-6867234444748414110');" style=""> 103            new PrintWriter(new OutputStreamWriter(outputStream, mTaskEntity.charset), true);                       </span>
<span  style=""> 104                                                                                                                    </span>
<span class="7728457972062474717" onmouseenter="enter('7728457972062474717');" onmouseout="out('7728457972062474717');" style=""> 105        //添加文件上传表单字段                                                                                                </span>
<span class="-8415422093392386204" onmouseenter="enter('-8415422093392386204');" onmouseout="out('-8415422093392386204');" style=""> 106        keys = mTaskEntity.formFields.keySet();                                                                     </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 107        for (String key : keys) {                                                                                   </span>
<span class="224737586462576596" onmouseenter="enter('224737586462576596');" onmouseout="out('224737586462576596');" style=""> 108          addFormField(writer, key, mTaskEntity.formFields.get(key));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109        }                                                                                                           </span>
<span class="-9034637092129056499" onmouseenter="enter('-9034637092129056499');" onmouseout="out('-9034637092129056499');" style=""> 110        mListener.onStart(uploadFile.length());                                                                     </span>
<span class="-699289564828458401" onmouseenter="enter('-699289564828458401');" onmouseout="out('-699289564828458401');" style=""> 111        uploadFile(writer, outputStream, mTaskEntity.attachment, uploadFile);                                       </span>
<span class="5762938294954091845" onmouseenter="enter('5762938294954091845');" onmouseout="out('5762938294954091845');" style=""> 112        Log.d(TAG, finish(writer) + &quot;&quot;);                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 113      } catch (IOException e) {                                                                                     </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 114        e.printStackTrace();                                                                                        </span>
<span class="7509727341363127472" onmouseenter="enter('7509727341363127472');" onmouseout="out('7509727341363127472');" style=""> 115        fail();                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117    }                                                                                                               </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-905072369765189017" onmouseenter="enter('-905072369765189017');" onmouseout="out('-905072369765189017');" style=""> 119    boolean isRunning() {                                                                                           </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style=""> 120      return isRunning;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121    }                                                                                                               </span>
<span  style=""> 122                                                                                                                    </span>
<span class="7398204271322910742" onmouseenter="enter('7398204271322910742');" onmouseout="out('7398204271322910742');" style=""> 123    private void fail() {                                                                                           </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 124      mListener.onFail();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125    }                                                                                                               </span>
<span  style=""> 126                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 127    /**                                                                                                             </span>
<span class="-1211992867345267355" onmouseenter="enter('-1211992867345267355');" onmouseout="out('-1211992867345267355');" style=""> 128     * 添加文件上传表单字段                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 129     */                                                                                                             </span>
<span class="7619688131485087237" onmouseenter="enter('7619688131485087237');" onmouseout="out('7619688131485087237');" style=""> 130    private void addFormField(PrintWriter writer, String name, String value) {                                      </span>
<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 131      writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                                      </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 132      writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                                      </span>
<span class="-1837819835388128060" onmouseenter="enter('-1837819835388128060');" onmouseout="out('-1837819835388128060');" style=""> 133          .append(name)                                                                                             </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 134          .append(&quot;\&quot;&quot;)                                                                                             </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 135          .append(LINE_END);                                                                                        </span>
<span class="7160233832927224549" onmouseenter="enter('7160233832927224549');" onmouseout="out('7160233832927224549');" style=""> 136      writer.append(&quot;Content-Type: text/plain; charset=&quot;)                                                           </span>
<span class="-6461379044237878216" onmouseenter="enter('-6461379044237878216');" onmouseout="out('-6461379044237878216');" style=""> 137          .append(mTaskEntity.charset)                                                                              </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 138          .append(LINE_END);                                                                                        </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 139      writer.append(LINE_END);                                                                                      </span>
<span class="-7994885594903542734" onmouseenter="enter('-7994885594903542734');" onmouseout="out('-7994885594903542734');" style=""> 140      writer.append(value).append(LINE_END);                                                                        </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 141      writer.flush();                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142    }                                                                                                               </span>
<span  style=""> 143                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 144    /**                                                                                                             </span>
<span class="-5307963093749139145" onmouseenter="enter('-5307963093749139145');" onmouseout="out('-5307963093749139145');" style=""> 145     * 上传文件                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 146     *                                                                                                              </span>
<span class="5235259969989322878" onmouseenter="enter('5235259969989322878');" onmouseout="out('5235259969989322878');" style=""> 147     * @param attachment 文件上传attachment                                                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 148     * @throws IOException                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 149     */                                                                                                             </span>
<span class="-8241348058297716231" onmouseenter="enter('-8241348058297716231');" onmouseout="out('-8241348058297716231');" style=""> 150    private void uploadFile(PrintWriter writer, OutputStream outputStream, String attachment,                       </span>
<span class="1882173450944731504" onmouseenter="enter('1882173450944731504');" onmouseout="out('1882173450944731504');" style=""> 151        File uploadFile) throws IOException {                                                                       </span>

<span class="-2878455900339893403" onmouseenter="enter('-2878455900339893403');" onmouseout="out('-2878455900339893403');" style=""> 152      writer.append(PREFIX).append(BOUNDARY).append(LINE_END);                                                      </span>
<span class="5268913419583316826" onmouseenter="enter('5268913419583316826');" onmouseout="out('5268913419583316826');" style=""> 153      writer.append(&quot;Content-Disposition: form-data; name=\&quot;&quot;)                                                      </span>
<span class="-5346981064803419075" onmouseenter="enter('-5346981064803419075');" onmouseout="out('-5346981064803419075');" style=""> 154          .append(attachment)                                                                                       </span>
<span class="-7270534301950586768" onmouseenter="enter('-7270534301950586768');" onmouseout="out('-7270534301950586768');" style=""> 155          .append(&quot;\&quot;; filename=\&quot;&quot;)                                                                                </span>
<span class="1019288102601849811" onmouseenter="enter('1019288102601849811');" onmouseout="out('1019288102601849811');" style=""> 156          .append(mTaskEntity.uploadEntity.getFileName())                                                           </span>
<span class="-1112064704251012575" onmouseenter="enter('-1112064704251012575');" onmouseout="out('-1112064704251012575');" style=""> 157          .append(&quot;\&quot;&quot;)                                                                                             </span>
<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 158          .append(LINE_END);                                                                                        </span>
<span class="8956639741096524789" onmouseenter="enter('8956639741096524789');" onmouseout="out('8956639741096524789');" style=""> 159      writer.append(&quot;Content-Type: &quot;)                                                                               </span>
<span class="164085665237946380" onmouseenter="enter('164085665237946380');" onmouseout="out('164085665237946380');" style=""> 160          //.append(URLConnection.guessContentTypeFromName(mTaskEntity.uploadEntity.getFileName()))                 </span>
<span class="-3276318543060893757" onmouseenter="enter('-3276318543060893757');" onmouseout="out('-3276318543060893757');" style=""> 161          .append(mTaskEntity.contentType)                                                                          </span>

<span class="1600766673023119415" onmouseenter="enter('1600766673023119415');" onmouseout="out('1600766673023119415');" style=""> 162          .append(LINE_END);                                                                                        </span>
<span class="-5574607543649470327" onmouseenter="enter('-5574607543649470327');" onmouseout="out('-5574607543649470327');" style=""> 163      writer.append(&quot;Content-Transfer-Encoding: binary&quot;).append(LINE_END);                                          </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 164      writer.append(LINE_END);                                                                                      </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 165      writer.flush();                                                                                               </span>
<span  style=""> 166                                                                                                                    </span>
<span class="4040387056364667362" onmouseenter="enter('4040387056364667362');" onmouseout="out('4040387056364667362');" style=""> 167      FileInputStream inputStream = new FileInputStream(uploadFile);                                                </span>
<span class="1259808987822838079" onmouseenter="enter('1259808987822838079');" onmouseout="out('1259808987822838079');" style=""> 168      byte[] buffer = new byte[4096];                                                                               </span>
<span class="-7067986891170572893" onmouseenter="enter('-7067986891170572893');" onmouseout="out('-7067986891170572893');" style=""> 169      int bytesRead;                                                                                                </span>
<span class="-9072059992252399296" onmouseenter="enter('-9072059992252399296');" onmouseout="out('-9072059992252399296');" style=""> 170      while ((bytesRead = inputStream.read(buffer)) != -1) {                                                        </span>
<span class="1251564898405321462" onmouseenter="enter('1251564898405321462');" onmouseout="out('1251564898405321462');" style=""> 171        mCurrentLocation += bytesRead;                                                                              </span>
<span class="6812214684476640601" onmouseenter="enter('6812214684476640601');" onmouseout="out('6812214684476640601');" style=""> 172        outputStream.write(buffer, 0, bytesRead);                                                                   </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 173        if (isCancel) {                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 174          break;                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175        }                                                                                                           </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style=""> 176        isRunning = true;                                                                                           </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style=""> 177        mListener.onProgress(mCurrentLocation);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178      }                                                                                                             </span>
<span  style=""> 179                                                                                                                    </span>
<span class="-8060077804843641817" onmouseenter="enter('-8060077804843641817');" onmouseout="out('-8060077804843641817');" style=""> 180      outputStream.flush();                                                                                         </span>
<span class="-3601486130051957792" onmouseenter="enter('-3601486130051957792');" onmouseout="out('-3601486130051957792');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -    outputStream.close();                                                                                         </span>
<span class="3028741211385217417" onmouseenter="enter('3028741211385217417');" onmouseout="out('3028741211385217417');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +    //outputStream.close();                                                                                       </span>
<span class="338817727459642684" onmouseenter="enter('338817727459642684');" onmouseout="out('338817727459642684');" style=""> 183      inputStream.close();                                                                                          </span>
<span class="-6240894487427889504" onmouseenter="enter('-6240894487427889504');" onmouseout="out('-6240894487427889504');" style=""> 184      writer.append(LINE_END);                                                                                      </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 185      writer.flush();                                                                                               </span>
<span class="-6043944427187599310" onmouseenter="enter('-6043944427187599310');" onmouseout="out('-6043944427187599310');" style=""> 186      isRunning = false;                                                                                            </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 187      if (isCancel) {                                                                                               </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 188        mListener.onCancel();                                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 189        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190      }                                                                                                             </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 191      mListener.onComplete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192    }                                                                                                               </span>
<span  style=""> 193                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 194    /**                                                                                                             </span>
<span class="8090914033664120342" onmouseenter="enter('8090914033664120342');" onmouseout="out('8090914033664120342');" style=""> 195     * 任务结束操作                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 196     *                                                                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 197     * @throws IOException                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 198     */                                                                                                             </span>
<span class="-6712242018334182923" onmouseenter="enter('-6712242018334182923');" onmouseout="out('-6712242018334182923');" style=""> 199    private String finish(PrintWriter writer) throws IOException {                                                  </span>
<span class="-3213513309039140359" onmouseenter="enter('-3213513309039140359');" onmouseout="out('-3213513309039140359');" style=""> 200      StringBuilder response = new StringBuilder();                                                                 </span>
<span  style=""> 201                                                                                                                    </span>
<span class="3673413535200466883" onmouseenter="enter('3673413535200466883');" onmouseout="out('3673413535200466883');" style=""> 202      writer.append(LINE_END).flush();                                                                              </span>
<span class="-6942559868418828891" onmouseenter="enter('-6942559868418828891');" onmouseout="out('-6942559868418828891');" style=""> 203      writer.append(PREFIX).append(BOUNDARY).append(PREFIX).append(LINE_END);                                       </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 204      writer.close();                                                                                               </span>
<span  style=""> 205                                                                                                                    </span>
<span class="-7766630665701464966" onmouseenter="enter('-7766630665701464966');" onmouseout="out('-7766630665701464966');" style=""> 206      int status = mHttpConn.getResponseCode();                                                                     </span>
<span class="3009894602238525978" onmouseenter="enter('3009894602238525978');" onmouseout="out('3009894602238525978');" style=""> 207      if (status == HttpURLConnection.HTTP_OK) {                                                                    </span>
<span class="-697229362038129983" onmouseenter="enter('-697229362038129983');" onmouseout="out('-697229362038129983');" style=""> 208        BufferedReader reader = new BufferedReader(new InputStreamReader(mHttpConn.getInputStream()));              </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style=""> 209        String line;                                                                                                </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style=""> 210        while ((line = reader.readLine()) != null) {                                                                </span>
<span class="-7195029802899220801" onmouseenter="enter('-7195029802899220801');" onmouseout="out('-7195029802899220801');" style=""> 211          response.append(line);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212        }                                                                                                           </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style=""> 213        reader.close();                                                                                             </span>
<span class="6290572035394845602" onmouseenter="enter('6290572035394845602');" onmouseout="out('6290572035394845602');" style=""> 214        mHttpConn.disconnect();                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 215      } else {                                                                                                      </span>
<span class="-8134780005978126053" onmouseenter="enter('-8134780005978126053');" onmouseout="out('-8134780005978126053');" style=""> 216        Log.w(TAG, &quot;state_code = &quot; + status);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217      }                                                                                                             </span>
<span  style=""> 218                                                                                                                    </span>
<span class="5452151615775385716" onmouseenter="enter('5452151615775385716');" onmouseout="out('5452151615775385716');" style=""> 219      writer.flush();                                                                                               </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 220      writer.close();                                                                                               </span>
<span  style=""> 221                                                                                                                    </span>
<span class="973858829207738010" onmouseenter="enter('973858829207738010');" onmouseout="out('973858829207738010');" style=""> 222      return response.toString();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            