<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>379</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    379
                    <a href="378.html">prev</a>
                    <a href="380.html">next</a>
                    <a href="379_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_f7d04befb21c26162c7af61911a0e71624243147_core/src/main/java/com/dtstack/flink/sql/environment/MyLocalStreamEnvironment.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d04befb21c26162c7af61911a0e71624243147:core/src/main/java/com/dtstack/flink/sql/environment/MyLocalStreamEnvironment.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d04befb21c26162c7af61911a0e71624243147^1:core/src/main/java/com/dtstack/flink/sql/environment/MyLocalStreamEnvironment.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d04befb21c26162c7af61911a0e71624243147^2:core/src/main/java/com/dtstack/flink/sql/environment/MyLocalStreamEnvironment.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b59ef71c4aa3401fd523d61328334a6bac817e1c:core/src/main/java/com/dtstack/flink/sql/environment/MyLocalStreamEnvironment.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [j]], subset: [[b], [b], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Licensed to the Apache Software Foundation (ASF) under one
   3  * or more contributor license agreements.  See the NOTICE file
   4  * distributed with this work for additional information
   5  * regarding copyright ownership.  The ASF licenses this file
   6  * to you under the Apache License, Version 2.0 (the
   7  * &quot;License&quot;); you may not use this file except in compliance
   8  * with the License.  You may obtain a copy of the License at
   9  *
  10  *     http://www.apache.org/licenses/LICENSE-2.0
  11  *
  12  * Unless required by applicable law or agreed to in writing, software
  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15  * See the License for the specific language governing permissions and
  16  * limitations under the License.
  17  */
  18 
  19 package com.dtstack.flink.sql.environment;
  20 
  21 import org.apache.flink.api.common.InvalidProgramException;
  22 import org.apache.flink.api.common.JobExecutionResult;
  23 import org.apache.flink.api.java.ExecutionEnvironment;
  24 import org.apache.flink.configuration.Configuration;
  25 import org.apache.flink.configuration.RestOptions;
  26 import org.apache.flink.configuration.TaskManagerOptions;
  27 import org.apache.flink.runtime.jobgraph.JobGraph;
  28 import org.apache.flink.runtime.minicluster.MiniCluster;
  29 import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;
  30 import org.apache.flink.streaming.api.environment.LocalStreamEnvironment;
  31 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  32 import org.apache.flink.streaming.api.graph.StreamGraph;
  33 import org.slf4j.Logger;
  34 import org.slf4j.LoggerFactory;
  35 
  36 import java.net.URL;
  37 import java.util.Collections;
  38 import java.util.List;
  39 
  40 /**
  41  * Local Stream Environment
  42  *
  43  * Company: www.dtstack.com
  44  * @author huyifan.zju@163.com
  45  */
  46 public class MyLocalStreamEnvironment extends StreamExecutionEnvironment {
  47     private static final Logger LOG = LoggerFactory.getLogger(LocalStreamEnvironment.class);
  48 
  49     /** The configuration to use for the local cluster. */
  50     private final Configuration conf;
  51 
  52     public List&lt;URL&gt; getClasspaths() {
  53         return classpaths;
  54     }
  55 
  56     public void setClasspaths(List&lt;URL&gt; classpaths) {
  57         this.classpaths = classpaths;
  58     }
  59 
  60     private List&lt;URL&gt; classpaths = Collections.emptyList();
  61 
  62     /**
  63      * Creates a new local stream environment that uses the default configuration.
  64      */
  65     public MyLocalStreamEnvironment() {
  66         this(null);
  67     }
  68 
  69     /**
<abbr title="  70      * Creates a new local stream environment that configures its local executor with the given configuration.">  70      * Creates a new local stream environment that configures its local executor with the given configuraðŸ”µ</abbr>
  71      *
  72      * @param config The configuration used to configure the local executor.
  73      */
  74     public MyLocalStreamEnvironment(Configuration config) {
  75         if (!ExecutionEnvironment.areExplicitEnvironmentsAllowed()) {
  76             throw new InvalidProgramException(
<abbr title="  77                     &quot;The LocalStreamEnvironment cannot be used when submitting a program through a client, &quot; +">  77                     &quot;The LocalStreamEnvironment cannot be used when submitting a program through a clientðŸ”µ</abbr>
  78                             &quot;or running in a TestEnvironment context.&quot;);
  79         }
  80 
  81         this.conf = config == null ? new Configuration() : config;
  82     }
  83 
  84     /**
  85      * Executes the JobGraph of the on a mini cluster of CLusterUtil with a user
  86      * specified name.
  87      *
  88      * @param jobName
  89      *            name of the job
  90      * @return The result of the job execution, containing elapsed time and accumulators.
  91      */
  92     @Override
  93     public JobExecutionResult execute(String jobName) throws Exception {
  94         // transform the streaming program into a JobGraph
  95         StreamGraph streamGraph = getStreamGraph();
  96         streamGraph.setJobName(jobName);
  97         return execute(streamGraph);
  98     }
  99 
 100     public JobExecutionResult execute(StreamGraph streamGraph) throws Exception {
 101 
 102         JobGraph jobGraph = streamGraph.getJobGraph();
 103         jobGraph.setClasspaths(classpaths);
 104         jobGraph.setAllowQueuedScheduling(true);
 105 
 106         Configuration configuration = new Configuration();
 107         configuration.addAll(jobGraph.getJobConfiguration());
 108         configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;0&quot;);
 109 
 110         // add (and override) the settings with what the user defined
 111         configuration.addAll(this.conf);
 112 
 113         if (!configuration.contains(RestOptions.BIND_PORT)) {
 114             configuration.setString(RestOptions.BIND_PORT, &quot;0&quot;);
 115         }
 116 
<abbr title=" 117         int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());"> 117         int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraphðŸ”µ</abbr>
 118 
 119         MiniClusterConfiguration cfg = new MiniClusterConfiguration.Builder()
 120                 .setConfiguration(configuration)
 121                 .setNumSlotsPerTaskManager(numSlotsPerTaskManager)
 122                 .build();
 123 
 124         if (LOG.isInfoEnabled()) {
 125             LOG.info(&quot;Running job on local embedded Flink mini cluster&quot;);
 126         }
 127 
 128 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129         MiniCluster miniCluster = new MiniCluster(cfg);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         try {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132             miniCluster.start();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133             configuration.setInteger(RestOptions.PORT, miniCluster.getRestAddress().get().getPort());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135             return miniCluster.executeJobBlocking(jobGraph);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137         finally {</span>
 138 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139         MiniCluster exec = new MiniCluster(configBuilder.build());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141             exec.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142             return exec.executeJobBlocking(jobGraph);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         finally {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145             transformations.clear();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146             exec.closeAsync();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149 }</span>
 150 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151         try (MiniCluster exec = new MiniCluster(configBuilder.build());) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152             exec.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153             JobExecutionResult jobExecutionResult = exec.executeJobBlocking(jobGraph);</span>
 154 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 155             transformations.clear();
 156 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157             miniCluster.close();</span>
 158 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160         finally {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161             transformations.clear();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162             exec.closeAsync();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 }</span>
 166 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167             return jobExecutionResult;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168         } catch (Exception e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169             throw new RuntimeException(e);</span>
 170 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 171         }
 172     }
 173 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Licensed to the Apache Software Foundation (ASF) under one
   3  * or more contributor license agreements.  See the NOTICE file
   4  * distributed with this work for additional information
   5  * regarding copyright ownership.  The ASF licenses this file
   6  * to you under the Apache License, Version 2.0 (the
   7  * &quot;License&quot;); you may not use this file except in compliance
   8  * with the License.  You may obtain a copy of the License at
   9  *
  10  *     http://www.apache.org/licenses/LICENSE-2.0
  11  *
  12  * Unless required by applicable law or agreed to in writing, software
  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15  * See the License for the specific language governing permissions and
  16  * limitations under the License.
  17  */
  18 
  19 package com.dtstack.flink.sql.environment;
  20 
  21 import org.apache.flink.api.common.InvalidProgramException;
  22 import org.apache.flink.api.common.JobExecutionResult;
  23 import org.apache.flink.api.java.ExecutionEnvironment;
  24 import org.apache.flink.configuration.Configuration;
  25 import org.apache.flink.configuration.RestOptions;
  26 import org.apache.flink.configuration.TaskManagerOptions;
  27 import org.apache.flink.runtime.jobgraph.JobGraph;
  28 import org.apache.flink.runtime.minicluster.MiniCluster;
  29 import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;
  30 import org.apache.flink.streaming.api.environment.LocalStreamEnvironment;
  31 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  32 import org.apache.flink.streaming.api.graph.StreamGraph;
  33 import org.slf4j.Logger;
  34 import org.slf4j.LoggerFactory;
  35 
  36 import java.net.URL;
  37 import java.util.Collections;
  38 import java.util.List;
  39 
  40 /**
  41  * Local Stream Environment
  42  *
  43  * Company: www.dtstack.com
  44  * @author huyifan.zju@163.com
  45  */
  46 public class MyLocalStreamEnvironment extends StreamExecutionEnvironment {
  47     private static final Logger LOG = LoggerFactory.getLogger(LocalStreamEnvironment.class);
  48 
  49     /** The configuration to use for the local cluster. */
  50     private final Configuration conf;
  51 
  52     public List&lt;URL&gt; getClasspaths() {
  53         return classpaths;
  54     }
  55 
  56     public void setClasspaths(List&lt;URL&gt; classpaths) {
  57         this.classpaths = classpaths;
  58     }
  59 
  60     private List&lt;URL&gt; classpaths = Collections.emptyList();
  61 
  62     /**
  63      * Creates a new local stream environment that uses the default configuration.
  64      */
  65     public MyLocalStreamEnvironment() {
  66         this(null);
  67     }
  68 
  69     /**
<abbr title="  70      * Creates a new local stream environment that configures its local executor with the given configuration.">  70      * Creates a new local stream environment that configures its local executor with the given configuraðŸ”µ</abbr>
  71      *
  72      * @param config The configuration used to configure the local executor.
  73      */
  74     public MyLocalStreamEnvironment(Configuration config) {
  75         if (!ExecutionEnvironment.areExplicitEnvironmentsAllowed()) {
  76             throw new InvalidProgramException(
<abbr title="  77                     &quot;The LocalStreamEnvironment cannot be used when submitting a program through a client, &quot; +">  77                     &quot;The LocalStreamEnvironment cannot be used when submitting a program through a clientðŸ”µ</abbr>
  78                             &quot;or running in a TestEnvironment context.&quot;);
  79         }
  80 
  81         this.conf = config == null ? new Configuration() : config;
  82     }
  83 
  84     /**
  85      * Executes the JobGraph of the on a mini cluster of CLusterUtil with a user
  86      * specified name.
  87      *
  88      * @param jobName
  89      *            name of the job
  90      * @return The result of the job execution, containing elapsed time and accumulators.
  91      */
  92     @Override
  93     public JobExecutionResult execute(String jobName) throws Exception {
  94         // transform the streaming program into a JobGraph
  95         StreamGraph streamGraph = getStreamGraph();
  96         streamGraph.setJobName(jobName);
  97 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98         return execute(streamGraph);</span>
  99 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101         JobGraph jobGraph = streamGraph.getJobGraph();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102         jobGraph.setClasspaths(classpaths);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104         Configuration configuration = new Configuration();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105         configuration.addAll(jobGraph.getJobConfiguration());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107         configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;512M&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         configuration.setInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         // add (and override) the settings with what the user defined</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         configuration.addAll(this.conf);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113         MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         configBuilder.setConfiguration(configuration);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         if (LOG.isInfoEnabled()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117             LOG.info(&quot;Running job on local embedded Flink mini cluster&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120         MiniCluster exec = new MiniCluster(configBuilder.build());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122             exec.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123             return exec.executeJobBlocking(jobGraph);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125         finally {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126             transformations.clear();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127             exec.closeAsync();</span>
 128 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130         JobGraph jobGraph = streamGraph.getJobGraph();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131         jobGraph.setClasspaths(classpaths);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133         Configuration configuration = new Configuration();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134         configuration.addAll(jobGraph.getJobConfiguration());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136         configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;512M&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137         configuration.setInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139         // add (and override) the settings with what the user defined</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140         configuration.addAll(this.conf);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142         MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143         configBuilder.setConfiguration(configuration);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145         if (LOG.isInfoEnabled()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146             LOG.info(&quot;Running job on local embedded Flink mini cluster&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149         try (MiniCluster exec = new MiniCluster(configBuilder.build());) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150             exec.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151             JobExecutionResult jobExecutionResult = exec.executeJobBlocking(jobGraph);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152             transformations.clear();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153             return jobExecutionResult;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154         } catch (Exception e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155             throw new RuntimeException(e);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156         }</span>
 157 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 158     }
 159 
 160     public JobExecutionResult execute(StreamGraph streamGraph) throws Exception {
 161 
 162         JobGraph jobGraph = streamGraph.getJobGraph();
 163         jobGraph.setClasspaths(classpaths);
 164         jobGraph.setAllowQueuedScheduling(true);
 165 
 166         Configuration configuration = new Configuration();
 167         configuration.addAll(jobGraph.getJobConfiguration());
 168         configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;0&quot;);
 169 
 170         // add (and override) the settings with what the user defined
 171         configuration.addAll(this.conf);
 172 
 173         if (!configuration.contains(RestOptions.BIND_PORT)) {
 174             configuration.setString(RestOptions.BIND_PORT, &quot;0&quot;);
 175         }
 176 
<abbr title=" 177         int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());"> 177         int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraphðŸ”µ</abbr>
 178 
 179         MiniClusterConfiguration cfg = new MiniClusterConfiguration.Builder()
 180                 .setConfiguration(configuration)
 181                 .setNumSlotsPerTaskManager(numSlotsPerTaskManager)
 182                 .build();
 183 
 184         if (LOG.isInfoEnabled()) {
 185             LOG.info(&quot;Running job on local embedded Flink mini cluster&quot;);
 186         }
 187 
 188         MiniCluster miniCluster = new MiniCluster(cfg);
 189 
 190         try {
 191             miniCluster.start();
 192             configuration.setInteger(RestOptions.PORT, miniCluster.getRestAddress().get().getPort());
 193 
 194             return miniCluster.executeJobBlocking(jobGraph);
 195         }
 196         finally {
 197             transformations.clear();
 198             miniCluster.close();
 199         }
 200     }
 201 }</pre></td>
                            <td><pre>   1 /*
   2  * Licensed to the Apache Software Foundation (ASF) under one
   3  * or more contributor license agreements.  See the NOTICE file
   4  * distributed with this work for additional information
   5  * regarding copyright ownership.  The ASF licenses this file
   6  * to you under the Apache License, Version 2.0 (the
   7  * &quot;License&quot;); you may not use this file except in compliance
   8  * with the License.  You may obtain a copy of the License at
   9  *
  10  *     http://www.apache.org/licenses/LICENSE-2.0
  11  *
  12  * Unless required by applicable law or agreed to in writing, software
  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15  * See the License for the specific language governing permissions and
  16  * limitations under the License.
  17  */
  18 package com.dtstack.flink.sql.environment;
  19 
  20 import java.net.URL;
  21 import java.util.Collections;
  22 import java.util.List;
  23 import org.apache.flink.api.common.InvalidProgramException;
  24 import org.apache.flink.api.common.JobExecutionResult;
  25 import org.apache.flink.api.java.ExecutionEnvironment;
  26 import org.apache.flink.configuration.Configuration;
  27 import org.apache.flink.configuration.RestOptions;
  28 import org.apache.flink.configuration.TaskManagerOptions;
  29 import org.apache.flink.runtime.jobgraph.JobGraph;
  30 import org.apache.flink.runtime.minicluster.MiniCluster;
  31 import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;
  32 import org.apache.flink.streaming.api.environment.LocalStreamEnvironment;
  33 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  34 import org.apache.flink.streaming.api.graph.StreamGraph;
  35 import org.slf4j.Logger;
  36 import org.slf4j.LoggerFactory;
  37 
  38 
  39 /**
  40  * Local Stream Environment
  41  *
  42  * Company: www.dtstack.com
  43  * @author huyifan.zju@163.com
  44  */
  45 public class MyLocalStreamEnvironment extends StreamExecutionEnvironment {
  46     private static final Logger LOG = LoggerFactory.getLogger(LocalStreamEnvironment.class);
  47 
  48     /** The configuration to use for the local cluster. */
  49     private final Configuration conf;
  50 
  51     public List&lt;URL&gt; getClasspaths() {
  52         return classpaths;
  53     }
  54 
  55     public void setClasspaths(List&lt;URL&gt; classpaths) {
  56         this.classpaths = classpaths;
  57     }
  58 
  59     private List&lt;URL&gt; classpaths = Collections.emptyList();
  60 
  61     /**
  62      * Creates a new local stream environment that uses the default configuration.
  63      */
  64     public MyLocalStreamEnvironment() {
  65         this(null);
  66     }
  67 
  68     /**
<abbr title="  69      * Creates a new local stream environment that configures its local executor with the given configuration.">  69      * Creates a new local stream environment that configures its local executor with the given configuraðŸ”µ</abbr>
  70      *
  71      * @param config
  72      * 		The configuration used to configure the local executor.
  73      */
  74     public MyLocalStreamEnvironment(Configuration config) {
  75         if (!ExecutionEnvironment.areExplicitEnvironmentsAllowed()) {
<abbr title="  76             throw new InvalidProgramException(&quot;The LocalStreamEnvironment cannot be used when submitting a program through a client, &quot; + &quot;or running in a TestEnvironment context.&quot;);">  76             throw new InvalidProgramException(&quot;The LocalStreamEnvironment cannot be used when submitting ðŸ”µ</abbr>
  77         }
  78         this.conf = (config == null) ? new Configuration() : config;
  79     }
  80 
  81     /**
  82      * Executes the JobGraph of the on a mini cluster of CLusterUtil with a user
  83      * specified name.
  84      *
  85      * @param jobName
  86      *            name of the job
  87      * @return The result of the job execution, containing elapsed time and accumulators.
  88      */
  89     @Override
  90     public JobExecutionResult execute(String jobName) throws Exception {
  91         // transform the streaming program into a JobGraph
  92         StreamGraph streamGraph = getStreamGraph();
  93         streamGraph.setJobName(jobName);
  94         return execute(streamGraph);
  95     }
  96 
  97     public JobExecutionResult execute(StreamGraph streamGraph) throws Exception {
  98         JobGraph jobGraph = streamGraph.getJobGraph();
  99         jobGraph.setClasspaths(classpaths);
 100         jobGraph.setAllowQueuedScheduling(true);
 101         Configuration configuration = new Configuration();
 102         configuration.addAll(jobGraph.getJobConfiguration());
 103         configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;0&quot;);
 104         // add (and override) the settings with what the user defined
 105         configuration.addAll(this.conf);
 106         if (!configuration.contains(RestOptions.BIND_PORT)) {
 107             configuration.setString(RestOptions.BIND_PORT, &quot;0&quot;);
 108         }
<abbr title=" 109         int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());"> 109         int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraphðŸ”µ</abbr>
<abbr title=" 110         MiniClusterConfiguration cfg = new MiniClusterConfiguration.Builder().setConfiguration(configuration).setNumSlotsPerTaskManager(numSlotsPerTaskManager).build();"> 110         MiniClusterConfiguration cfg = new MiniClusterConfiguration.Builder().setConfiguration(configuratðŸ”µ</abbr>
 111         if (LOG.isInfoEnabled()) {
 112             LOG.info(&quot;Running job on local embedded Flink mini cluster&quot;);
 113         }
 114         try (final MiniCluster exec = new MiniCluster(cfg)) {
 115             exec.start();
 116             JobExecutionResult jobExecutionResult = miniCluster.executeJobBlocking(jobGraph);
 117             transformations.clear();
 118             return jobExecutionResult;
 119         } catch (java.lang.Exception e) {
 120             throw new RuntimeException(e);
 121         }
 122     }
 123 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Licensed to the Apache Software Foundation (ASF) under one
   3   * or more contributor license agreements.  See the NOTICE file
   4   * distributed with this work for additional information
   5   * regarding copyright ownership.  The ASF licenses this file
   6   * to you under the Apache License, Version 2.0 (the
   7   * &quot;License&quot;); you may not use this file except in compliance
   8   * with the License.  You may obtain a copy of the License at
   9   *
  10   *     http://www.apache.org/licenses/LICENSE-2.0
  11   *
  12   * Unless required by applicable law or agreed to in writing, software
  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15   * See the License for the specific language governing permissions and
  16   * limitations under the License.
  17   */
  18  
  19  package com.dtstack.flink.sql.environment;
  20  
  21  import org.apache.flink.api.common.InvalidProgramException;
  22  import org.apache.flink.api.common.JobExecutionResult;
  23  import org.apache.flink.api.java.ExecutionEnvironment;
  24  import org.apache.flink.configuration.Configuration;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  25 +import org.apache.flink.configuration.RestOptions;</span>
  26  import org.apache.flink.configuration.TaskManagerOptions;
  27  import org.apache.flink.runtime.jobgraph.JobGraph;
  28  import org.apache.flink.runtime.minicluster.MiniCluster;
  29  import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;
  30  import org.apache.flink.streaming.api.environment.LocalStreamEnvironment;
  31  import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  32  import org.apache.flink.streaming.api.graph.StreamGraph;
  33  import org.slf4j.Logger;
  34  import org.slf4j.LoggerFactory;
  35  
  36  import java.net.URL;
  37  import java.util.Collections;
  38  import java.util.List;
  39  
  40  /**
  41   * Local Stream Environment
  42   *
  43   * Company: www.dtstack.com
  44   * @author huyifan.zju@163.com
  45   */
  46  public class MyLocalStreamEnvironment extends StreamExecutionEnvironment {
  47      private static final Logger LOG = LoggerFactory.getLogger(LocalStreamEnvironment.class);
  48  
  49      /** The configuration to use for the local cluster. */
  50      private final Configuration conf;
  51  
  52      public List&lt;URL&gt; getClasspaths() {
  53          return classpaths;
  54      }
  55  
  56      public void setClasspaths(List&lt;URL&gt; classpaths) {
  57          this.classpaths = classpaths;
  58      }
  59  
  60      private List&lt;URL&gt; classpaths = Collections.emptyList();
  61  
  62      /**
  63       * Creates a new local stream environment that uses the default configuration.
  64       */
  65      public MyLocalStreamEnvironment() {
  66          this(null);
  67      }
  68  
  69      /**
  70       * Creates a new local stream environment that configures its local executor with the given configuration.
  71       *
  72       * @param config The configuration used to configure the local executor.
  73       */
  74      public MyLocalStreamEnvironment(Configuration config) {
  75          if (!ExecutionEnvironment.areExplicitEnvironmentsAllowed()) {
  76              throw new InvalidProgramException(
  77                      &quot;The LocalStreamEnvironment cannot be used when submitting a program through a client, &quot; +
  78                              &quot;or running in a TestEnvironment context.&quot;);
  79          }
  80  
  81          this.conf = config == null ? new Configuration() : config;
  82      }
  83  
  84      /**
  85       * Executes the JobGraph of the on a mini cluster of CLusterUtil with a user
  86       * specified name.
  87       *
  88       * @param jobName
  89       *            name of the job
  90       * @return The result of the job execution, containing elapsed time and accumulators.
  91       */
  92      @Override
  93      public JobExecutionResult execute(String jobName) throws Exception {
  94          // transform the streaming program into a JobGraph
  95          StreamGraph streamGraph = getStreamGraph();
  96          streamGraph.setJobName(jobName);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +        return execute(streamGraph);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +    public JobExecutionResult execute(StreamGraph streamGraph) throws Exception {</span>
 101  
 102          JobGraph jobGraph = streamGraph.getJobGraph();
 103          jobGraph.setClasspaths(classpaths);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +        jobGraph.setAllowQueuedScheduling(true);</span>
 105  
 106          Configuration configuration = new Configuration();
 107          configuration.addAll(jobGraph.getJobConfiguration());
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -        configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;512M&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -        configuration.setInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +        configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;0&quot;);</span>
 112  
 113          // add (and override) the settings with what the user defined
 114          configuration.addAll(this.conf);
 115  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -        MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -        configBuilder.setConfiguration(configuration);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +        if (!configuration.contains(RestOptions.BIND_PORT)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +            configuration.setString(RestOptions.BIND_PORT, &quot;0&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 122 +        int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());"> 122 +        int numSlotsPerTaskManager = configuration.getInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +        MiniClusterConfiguration cfg = new MiniClusterConfiguration.Builder()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +                .setConfiguration(configuration)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                .setNumSlotsPerTaskManager(numSlotsPerTaskManager)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +                .build();</span>
 128  
 129          if (LOG.isInfoEnabled()) {
 130              LOG.info(&quot;Running job on local embedded Flink mini cluster&quot;);
 131          }
 132  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -        MiniCluster exec = new MiniCluster(configBuilder.build());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +        MiniCluster miniCluster = new MiniCluster(cfg);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +</span>
 136          try {

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -            exec.start();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -            return exec.executeJobBlocking(jobGraph);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +            miniCluster.start();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +            configuration.setInteger(RestOptions.PORT, miniCluster.getRestAddress().get().getPort());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +            return miniCluster.executeJobBlocking(jobGraph);</span>
 143          }
 144          finally {

 145              transformations.clear();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -            exec.closeAsync();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +            miniCluster.close();</span>


 148          }
 149      }
 150  }</pre></td>
                            <td><pre>   1  /*
   2   * Licensed to the Apache Software Foundation (ASF) under one
   3   * or more contributor license agreements.  See the NOTICE file
   4   * distributed with this work for additional information
   5   * regarding copyright ownership.  The ASF licenses this file
   6   * to you under the Apache License, Version 2.0 (the
   7   * &quot;License&quot;); you may not use this file except in compliance
   8   * with the License.  You may obtain a copy of the License at
   9   *
  10   *     http://www.apache.org/licenses/LICENSE-2.0
  11   *
  12   * Unless required by applicable law or agreed to in writing, software
  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15   * See the License for the specific language governing permissions and
  16   * limitations under the License.
  17   */
  18  
  19  package com.dtstack.flink.sql.environment;
  20  
  21  import org.apache.flink.api.common.InvalidProgramException;
  22  import org.apache.flink.api.common.JobExecutionResult;
  23  import org.apache.flink.api.java.ExecutionEnvironment;
  24  import org.apache.flink.configuration.Configuration;

  25  import org.apache.flink.configuration.TaskManagerOptions;
  26  import org.apache.flink.runtime.jobgraph.JobGraph;
  27  import org.apache.flink.runtime.minicluster.MiniCluster;
  28  import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;
  29  import org.apache.flink.streaming.api.environment.LocalStreamEnvironment;
  30  import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  31  import org.apache.flink.streaming.api.graph.StreamGraph;
  32  import org.slf4j.Logger;
  33  import org.slf4j.LoggerFactory;
  34  
  35  import java.net.URL;
  36  import java.util.Collections;
  37  import java.util.List;
  38  
  39  /**
  40   * Local Stream Environment
  41   *
  42   * Company: www.dtstack.com
  43   * @author huyifan.zju@163.com
  44   */
  45  public class MyLocalStreamEnvironment extends StreamExecutionEnvironment {
  46      private static final Logger LOG = LoggerFactory.getLogger(LocalStreamEnvironment.class);
  47  
  48      /** The configuration to use for the local cluster. */
  49      private final Configuration conf;
  50  
  51      public List&lt;URL&gt; getClasspaths() {
  52          return classpaths;
  53      }
  54  
  55      public void setClasspaths(List&lt;URL&gt; classpaths) {
  56          this.classpaths = classpaths;
  57      }
  58  
  59      private List&lt;URL&gt; classpaths = Collections.emptyList();
  60  
  61      /**
  62       * Creates a new local stream environment that uses the default configuration.
  63       */
  64      public MyLocalStreamEnvironment() {
  65          this(null);
  66      }
  67  
  68      /**
  69       * Creates a new local stream environment that configures its local executor with the given configuration.
  70       *
  71       * @param config The configuration used to configure the local executor.
  72       */
  73      public MyLocalStreamEnvironment(Configuration config) {
  74          if (!ExecutionEnvironment.areExplicitEnvironmentsAllowed()) {
  75              throw new InvalidProgramException(
  76                      &quot;The LocalStreamEnvironment cannot be used when submitting a program through a client, &quot; +
  77                              &quot;or running in a TestEnvironment context.&quot;);
  78          }
  79  
  80          this.conf = config == null ? new Configuration() : config;
  81      }
  82  
  83      /**
  84       * Executes the JobGraph of the on a mini cluster of CLusterUtil with a user
  85       * specified name.
  86       *
  87       * @param jobName
  88       *            name of the job
  89       * @return The result of the job execution, containing elapsed time and accumulators.
  90       */
  91      @Override
  92      public JobExecutionResult execute(String jobName) throws Exception {
  93          // transform the streaming program into a JobGraph
  94          StreamGraph streamGraph = getStreamGraph();
  95          streamGraph.setJobName(jobName);




  96  
  97          JobGraph jobGraph = streamGraph.getJobGraph();
  98          jobGraph.setClasspaths(classpaths);

  99  
 100          Configuration configuration = new Configuration();
 101          configuration.addAll(jobGraph.getJobConfiguration());
 102  
 103          configuration.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE, &quot;512M&quot;);
 104          configuration.setInteger(TaskManagerOptions.NUM_TASK_SLOTS, jobGraph.getMaximumParallelism());

 105  
 106          // add (and override) the settings with what the user defined
 107          configuration.addAll(this.conf);
 108  
 109          MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();
 110          configBuilder.setConfiguration(configuration);










 111  
 112          if (LOG.isInfoEnabled()) {
 113              LOG.info(&quot;Running job on local embedded Flink mini cluster&quot;);
 114          }
 115  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -        MiniCluster exec = new MiniCluster(configBuilder.build());</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -        try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +        try (MiniCluster exec = new MiniCluster(configBuilder.build());) {</span>
 119              exec.start();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -            return exec.executeJobBlocking(jobGraph);</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -        finally {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +            JobExecutionResult jobExecutionResult = exec.executeJobBlocking(jobGraph);</span>
 124              transformations.clear();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -            exec.closeAsync();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +            return jobExecutionResult;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +        } catch (Exception e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +            throw new RuntimeException(e);</span>
 129          }
 130      }
 131  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            