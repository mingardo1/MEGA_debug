<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>510</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    510
                    <a href="509.html">prev</a>
                    <a href="511.html">next</a>
                    <a href="510_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Freeyourgadget/Gadgetbridge_71b1a140f6a0afd0bdcec48afa132eedef4d2266_app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;71b1a140f6a0afd0bdcec48afa132eedef4d2266:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;71b1a140f6a0afd0bdcec48afa132eedef4d2266^1:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;71b1a140f6a0afd0bdcec48afa132eedef4d2266^2:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;5e5d8d4dd98c256e86384235fd43d0c271c28080:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="7867943778411854368" onmouseenter="enter('7867943778411854368');" onmouseout="out('7867943778411854368');" style="">   1 /*  Copyright (C) 2019-2021 Andreas Shimokawa, Gordon Williams                                           </span>
<span  style="">   2                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8     (at your option) any later version.                                                                  </span>
<span  style="">   9                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  14                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="-588248541382154970" onmouseenter="enter('-588248541382154970');" onmouseout="out('-588248541382154970');" style="">  17 package nodomain.freeyourgadget.gadgetbridge.service.devices.banglejs;                                   </span>
<span  style="">  18                                                                                                          </span>
<span class="2440823415412133066" onmouseenter="enter('2440823415412133066');" onmouseout="out('2440823415412133066');" style="">  19 import android.bluetooth.BluetoothGatt;                                                                  </span>
<span class="4736969144974683041" onmouseenter="enter('4736969144974683041');" onmouseout="out('4736969144974683041');" style="">  20 import android.bluetooth.BluetoothGattCharacteristic;                                                    </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  21 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  22 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  23 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  24 import android.content.IntentFilter;                                                                     </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  25 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  26 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  27 import android.graphics.Canvas;                                                                          </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  28 import android.graphics.Paint;                                                                           </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  29 import android.graphics.drawable.BitmapDrawable;                                                         </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  30 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="">  31 import android.net.Uri;                                                                                  </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  32 import android.util.Base64;                                                                              </span>
<span class="-4373317539211938720" onmouseenter="enter('-4373317539211938720');" onmouseout="out('-4373317539211938720');" style="">  33 import android.widget.Toast;                                                                             </span>
<span  style="">  34                                                                                                          </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  35 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span  style="">  36                                                                                                          </span>
<span class="3171981379522900271" onmouseenter="enter('3171981379522900271');" onmouseout="out('3171981379522900271');" style="">  37 import com.android.volley.Request;                                                                       </span>
<span class="4430867795468484324" onmouseenter="enter('4430867795468484324');" onmouseout="out('4430867795468484324');" style="">  38 import com.android.volley.Response;                                                                      </span>
<span class="-6875921712592050045" onmouseenter="enter('-6875921712592050045');" onmouseout="out('-6875921712592050045');" style="">  39 import com.android.volley.RequestQueue;                                                                  </span>
<span class="7596528640051210243" onmouseenter="enter('7596528640051210243');" onmouseout="out('7596528640051210243');" style="">  40 import com.android.volley.VolleyError;                                                                   </span>
<span class="-6338542844679972782" onmouseenter="enter('-6338542844679972782');" onmouseout="out('-6338542844679972782');" style="">  41 import com.android.volley.toolbox.StringRequest;                                                         </span>
<span class="4822020902022089151" onmouseenter="enter('4822020902022089151');" onmouseout="out('4822020902022089151');" style="">  42 import com.android.volley.toolbox.Volley;                                                                </span>
<span  style="">  43                                                                                                          </span>
<span class="-9193129351684262878" onmouseenter="enter('-9193129351684262878');" onmouseout="out('-9193129351684262878');" style="">  44 import org.json.JSONArray;                                                                               </span>
<span class="-8573375701834280359" onmouseenter="enter('-8573375701834280359');" onmouseout="out('-8573375701834280359');" style="">  45 import org.json.JSONException;                                                                           </span>
<span class="7232075261178918144" onmouseenter="enter('7232075261178918144');" onmouseout="out('7232075261178918144');" style="">  46 import org.json.JSONObject;                                                                              </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  47 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  48 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="-2051516048009622280" onmouseenter="enter('-2051516048009622280');" onmouseout="out('-2051516048009622280');" style="">  49 import org.xml.sax.InputSource;                                                                          </span>
<span  style="">  50                                                                                                          </span>
<span class="-6983162919371453239" onmouseenter="enter('-6983162919371453239');" onmouseout="out('-6983162919371453239');" style="">  51 import java.io.BufferedWriter;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  52 import java.io.File;                                                                                     </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  53 import java.io.FileOutputStream;                                                                         </span>
<span class="4914725365521379617" onmouseenter="enter('4914725365521379617');" onmouseout="out('4914725365521379617');" style="">  54 import java.io.FileWriter;                                                                               </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  55 import java.io.IOException;                                                                              </span>
<span class="4087034682117787535" onmouseenter="enter('4087034682117787535');" onmouseout="out('4087034682117787535');" style="">  56 import java.io.StringReader;                                                                             </span>
<span class="-2624565711555737384" onmouseenter="enter('-2624565711555737384');" onmouseout="out('-2624565711555737384');" style="">  57 import java.nio.charset.StandardCharsets;                                                                </span>
<span class="54331962280914690" onmouseenter="enter('54331962280914690');" onmouseout="out('54331962280914690');" style="">  58 import java.text.SimpleDateFormat;                                                                       </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  59 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  60 import java.util.Calendar;                                                                               </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  61 import java.util.Date;                                                                                   </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  62 import java.util.GregorianCalendar;                                                                      </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  63 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  64 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  65 import java.util.List;                                                                                   </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  66 import java.util.Locale;                                                                                 </span>
<span class="8860446888132102879" onmouseenter="enter('8860446888132102879');" onmouseout="out('8860446888132102879');" style="">  67 import java.util.SimpleTimeZone;                                                                         </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  68 import java.util.UUID;                                                                                   </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  69 import java.lang.reflect.Field;                                                                          </span>
<span  style="">  70                                                                                                          </span>
<span class="-3163672285055708144" onmouseenter="enter('-3163672285055708144');" onmouseout="out('-3163672285055708144');" style="">  71 import io.wax911.emojify.Emoji;                                                                          </span>
<span class="6994093753897510849" onmouseenter="enter('6994093753897510849');" onmouseout="out('6994093753897510849');" style="">  72 import io.wax911.emojify.EmojiManager;                                                                   </span>
<span class="-2985037039232163872" onmouseenter="enter('-2985037039232163872');" onmouseout="out('-2985037039232163872');" style="">  73 import io.wax911.emojify.EmojiUtils;                                                                     </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  74 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  75 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  76 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="-141107564105590930" onmouseenter="enter('-141107564105590930');" onmouseout="out('-141107564105590930');" style="">  77 import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst;     </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  78 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  79 import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                           </span>
<span class="-3005335786085073829" onmouseenter="enter('-3005335786085073829');" onmouseout="out('-3005335786085073829');" style="">  80 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventBatteryInfo;                       </span>
<span class="7017557905176594961" onmouseenter="enter('7017557905176594961');" onmouseout="out('7017557905176594961');" style="">  81 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventCallControl;                       </span>
<span class="6368471362458763033" onmouseenter="enter('6368471362458763033');" onmouseout="out('6368471362458763033');" style="">  82 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventFindPhone;                         </span>
<span class="4012861689788039008" onmouseenter="enter('4012861689788039008');" onmouseout="out('4012861689788039008');" style="">  83 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventMusicControl;                      </span>
<span class="-5203005511074004401" onmouseenter="enter('-5203005511074004401');" onmouseout="out('-5203005511074004401');" style="">  84 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventNotificationControl;               </span>
<span class="4252572397761323695" onmouseenter="enter('4252572397761323695');" onmouseout="out('4252572397761323695');" style="">  85 import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSConstants;                          </span>
<span class="8687478736174414119" onmouseenter="enter('8687478736174414119');" onmouseout="out('8687478736174414119');" style="">  86 import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSSampleProvider;                     </span>
<span class="-7483974346858162294" onmouseenter="enter('-7483974346858162294');" onmouseout="out('-7483974346858162294');" style="">  87 import nodomain.freeyourgadget.gadgetbridge.devices.qhybrid.NotificationConfiguration;                   </span>
<span class="8046368326334810504" onmouseenter="enter('8046368326334810504');" onmouseout="out('8046368326334810504');" style="">  88 import nodomain.freeyourgadget.gadgetbridge.entities.BangleJSActivitySample;                             </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  89 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                               </span>
<span class="5185434099904652174" onmouseenter="enter('5185434099904652174');" onmouseout="out('5185434099904652174');" style="">  90 import nodomain.freeyourgadget.gadgetbridge.model.ActivityKind;                                          </span>
<span class="-8766238562391910018" onmouseenter="enter('-8766238562391910018');" onmouseout="out('-8766238562391910018');" style="">  91 import nodomain.freeyourgadget.gadgetbridge.model.Alarm;                                                 </span>
<span class="2021957179005285653" onmouseenter="enter('2021957179005285653');" onmouseout="out('2021957179005285653');" style="">  92 import nodomain.freeyourgadget.gadgetbridge.model.BatteryState;                                          </span>
<span class="-3899388208810973608" onmouseenter="enter('-3899388208810973608');" onmouseout="out('-3899388208810973608');" style="">  93 import nodomain.freeyourgadget.gadgetbridge.model.CalendarEventSpec;                                     </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  94 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="-7415926539738049206" onmouseenter="enter('-7415926539738049206');" onmouseout="out('-7415926539738049206');" style="">  95 import nodomain.freeyourgadget.gadgetbridge.model.CannedMessagesSpec;                                    </span>
<span class="308285905299900254" onmouseenter="enter('308285905299900254');" onmouseout="out('308285905299900254');" style="">  96 import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;                                         </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  97 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  98 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  99 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="-3277000154202836222" onmouseenter="enter('-3277000154202836222');" onmouseout="out('-3277000154202836222');" style=""> 100 import nodomain.freeyourgadget.gadgetbridge.model.RecordedDataTypes;                                     </span>
<span class="-40839721936664146" onmouseenter="enter('-40839721936664146');" onmouseout="out('-40839721936664146');" style=""> 101 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;                                           </span>
<span class="4344228987867394358" onmouseenter="enter('4344228987867394358');" onmouseout="out('4344228987867394358');" style=""> 102 import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLEDeviceSupport;                      </span>
<span class="3410519392510510669" onmouseenter="enter('3410519392510510669');" onmouseout="out('3410519392510510669');" style=""> 103 import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;                             </span>
<span class="332482647079918156" onmouseenter="enter('332482647079918156');" onmouseout="out('332482647079918156');" style=""><abbr title=" 104 import nodomain.freeyourgadget.gadgetbridge.service.devices.qhybrid.requests.misfit.PlayNotificationRequest;"> 104 import nodomain.freeyourgadget.gadgetbridge.service.devices.qhybrid.requests.misfit.PlayNotificationRequeðŸ”µ</abbr></span>
<span class="-9148468836908617343" onmouseenter="enter('-9148468836908617343');" onmouseout="out('-9148468836908617343');" style=""> 105 import nodomain.freeyourgadget.gadgetbridge.util.AlarmUtils;                                             </span>
<span class="-8051705910484913631" onmouseenter="enter('-8051705910484913631');" onmouseout="out('-8051705910484913631');" style=""> 106 import nodomain.freeyourgadget.gadgetbridge.util.EmojiConverter;                                         </span>
<span class="-2020231768395052380" onmouseenter="enter('-2020231768395052380');" onmouseout="out('-2020231768395052380');" style=""> 107 import nodomain.freeyourgadget.gadgetbridge.util.FileUtils;                                              </span>
<span class="-3798970344596478499" onmouseenter="enter('-3798970344596478499');" onmouseout="out('-3798970344596478499');" style=""> 108 import nodomain.freeyourgadget.gadgetbridge.util.GB;                                                     </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style=""> 109 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style=""> 110 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span  style=""> 111                                                                                                          </span>
<span class="-2225725182537405146" onmouseenter="enter('-2225725182537405146');" onmouseout="out('-2225725182537405146');" style=""><abbr title=" 112 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_ALLOW_HIGH_MTU;"> 112 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="2440588347549655822" onmouseenter="enter('2440588347549655822');" onmouseout="out('2440588347549655822');" style=""><abbr title=" 113 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTERNET_ACCESS;"> 113 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="-5321063140707926105" onmouseenter="enter('-5321063140707926105');" onmouseout="out('-5321063140707926105');" style=""><abbr title=" 114 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTENTS;"> 114 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="1576087340720410961" onmouseenter="enter('1576087340720410961');" onmouseout="out('1576087340720410961');" style=""><abbr title=" 115 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_BANGLEJS_TEXT_BITMAP;"> 115 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="-7620522862868556032" onmouseenter="enter('-7620522862868556032');" onmouseout="out('-7620522862868556032');" style=""> 116 import static nodomain.freeyourgadget.gadgetbridge.database.DBHelper.*;                                  </span>
<span  style=""> 117                                                                                                          </span>
<span class="-6525955205891456613" onmouseenter="enter('-6525955205891456613');" onmouseout="out('-6525955205891456613');" style=""> 118 import javax.xml.xpath.XPath;                                                                            </span>
<span class="948957029946951050" onmouseenter="enter('948957029946951050');" onmouseout="out('948957029946951050');" style=""> 119 import javax.xml.xpath.XPathFactory;                                                                     </span>
<span  style=""> 120                                                                                                          </span>
<span class="-4540174980983528222" onmouseenter="enter('-4540174980983528222');" onmouseout="out('-4540174980983528222');" style=""> 121 public class BangleJSDeviceSupport extends AbstractBTLEDeviceSupport {                                   </span>
<span class="5737832610637191351" onmouseenter="enter('5737832610637191351');" onmouseout="out('5737832610637191351');" style=""> 122     private static final Logger LOG = LoggerFactory.getLogger(BangleJSDeviceSupport.class);              </span>
<span  style=""> 123                                                                                                          </span>
<span class="-1874769646843493640" onmouseenter="enter('-1874769646843493640');" onmouseout="out('-1874769646843493640');" style=""> 124     private BluetoothGattCharacteristic rxCharacteristic = null;                                         </span>
<span class="3394422526290177606" onmouseenter="enter('3394422526290177606');" onmouseout="out('3394422526290177606');" style=""> 125     private BluetoothGattCharacteristic txCharacteristic = null;                                         </span>
<span class="4278598336110524029" onmouseenter="enter('4278598336110524029');" onmouseout="out('4278598336110524029');" style=""> 126     private boolean allowHighMTU = false;                                                                </span>
<span class="4758769595687694218" onmouseenter="enter('4758769595687694218');" onmouseout="out('4758769595687694218');" style=""> 127     private int mtuSize = 20;                                                                            </span>
<span class="-5210712730292226171" onmouseenter="enter('-5210712730292226171');" onmouseout="out('-5210712730292226171');" style=""> 128     int bangleCommandSeq = 0; // to attempt to stop duplicate packets when sending Local Intents         </span>
<span  style=""> 129                                                                                                          </span>
<span class="1561011760409728503" onmouseenter="enter('1561011760409728503');" onmouseout="out('1561011760409728503');" style=""> 130     /// Current line of data received from Bangle.js                                                     </span>
<span class="-848193569484274658" onmouseenter="enter('-848193569484274658');" onmouseout="out('-848193569484274658');" style=""> 131     private String receivedLine = &quot;&quot;;                                                                    </span>
<span class="7842135007952282839" onmouseenter="enter('7842135007952282839');" onmouseout="out('7842135007952282839');" style=""><abbr title=" 132     /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS). Can be dumped with &#x27;Fetch Device Debug Logs&#x27; from Debug menu"> 132     /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS).ðŸ”µ</abbr></span>
<span class="-7872820322050208046" onmouseenter="enter('-7872820322050208046');" onmouseout="out('-7872820322050208046');" style=""> 133     private String receiveHistory = &quot;&quot;;                                                                  </span>
<span class="-3915326133595600019" onmouseenter="enter('-3915326133595600019');" onmouseout="out('-3915326133595600019');" style=""> 134     private boolean realtimeHRM = false;                                                                 </span>
<span class="-4342711334813376852" onmouseenter="enter('-4342711334813376852');" onmouseout="out('-4342711334813376852');" style=""> 135     private boolean realtimeStep = false;                                                                </span>
<span class="-785214995925481662" onmouseenter="enter('-785214995925481662');" onmouseout="out('-785214995925481662');" style=""> 136     private int realtimeHRMInterval = 30*60;                                                             </span>
<span  style=""> 137                                                                                                          </span>
<span class="7817012674261800607" onmouseenter="enter('7817012674261800607');" onmouseout="out('7817012674261800607');" style=""> 138     private final LimitedQueue/*Long*/ mNotificationReplyAction = new LimitedQueue(16);                  </span>
<span  style=""> 139                                                                                                          </span>
<span class="3035544862292212294" onmouseenter="enter('3035544862292212294');" onmouseout="out('3035544862292212294');" style=""> 140     /// Maximum amount of characters to store in receiveHistory                                          </span>
<span class="-1679828146401541729" onmouseenter="enter('-1679828146401541729');" onmouseout="out('-1679828146401541729');" style=""> 141     public static final int MAX_RECEIVE_HISTORY_CHARS = 100000;                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 142 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 143 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144                         try {                                                                            </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                             TransactionBuilder builder = performInitialized(&quot;TX&quot;);                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 146 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 148 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-4613019613947290640" onmouseenter="enter('-4613019613947290640');" onmouseout="out('-4613019613947290640');" style=""> 149     // Local Intents - for app manager communication                                                     </span>
<span class="-6355985936525602065" onmouseenter="enter('-6355985936525602065');" onmouseout="out('-6355985936525602065');" style=""> 150     public static final String BANGLEJS_COMMAND_TX = &quot;banglejs_command_tx&quot;;                              </span>
<span class="-7611986610894711832" onmouseenter="enter('-7611986610894711832');" onmouseout="out('-7611986610894711832');" style=""> 151     public static final String BANGLEJS_COMMAND_RX = &quot;banglejs_command_rx&quot;;                              </span>
<span class="3928394439815779565" onmouseenter="enter('3928394439815779565');" onmouseout="out('3928394439815779565');" style=""> 152     // Global Intents                                                                                    </span>
<span class="8064114268652999257" onmouseenter="enter('8064114268652999257');" onmouseout="out('8064114268652999257');" style=""> 153     private static final String BANGLE_ACTION_UART_TX = &quot;com.banglejs.uart.tx&quot;;                          </span>
<span  style=""> 154                                                                                                          </span>
<span class="-7141869860994321087" onmouseenter="enter('-7141869860994321087');" onmouseout="out('-7141869860994321087');" style=""> 155     public BangleJSDeviceSupport() {                                                                     </span>
<span class="4463652287758102089" onmouseenter="enter('4463652287758102089');" onmouseout="out('4463652287758102089');" style=""> 156         super(LOG);                                                                                      </span>
<span class="3886704256627163463" onmouseenter="enter('3886704256627163463');" onmouseout="out('3886704256627163463');" style=""> 157         addSupportedService(BangleJSConstants.UUID_SERVICE_NORDIC_UART);                                 </span>
<span  style=""> 158                                                                                                          </span>
<span class="1127284200558372197" onmouseenter="enter('1127284200558372197');" onmouseout="out('1127284200558372197');" style=""> 159         registerLocalIntents();                                                                          </span>
<span class="8826733129991946596" onmouseenter="enter('8826733129991946596');" onmouseout="out('8826733129991946596');" style=""> 160         registerGlobalIntents();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161     }                                                                                                    </span>
<span  style=""> 162                                                                                                          </span>
<span class="3363204271654612484" onmouseenter="enter('3363204271654612484');" onmouseout="out('3363204271654612484');" style=""> 163     private void registerLocalIntents() {                                                                </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 164         IntentFilter commandFilter = new IntentFilter();                                                 </span>
<span class="-7160894414714230309" onmouseenter="enter('-7160894414714230309');" onmouseout="out('-7160894414714230309');" style=""> 165         commandFilter.addAction(GBDevice.ACTION_DEVICE_CHANGED);                                         </span>
<span class="1690174294514698098" onmouseenter="enter('1690174294514698098');" onmouseout="out('1690174294514698098');" style=""> 166         commandFilter.addAction(BANGLEJS_COMMAND_TX);                                                    </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 167         BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 168             @Override                                                                                    </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 169             public void onReceive(Context context, Intent intent) {                                      </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 170                 switch (intent.getAction()) {                                                            </span>
<span class="1707526022738550013" onmouseenter="enter('1707526022738550013');" onmouseout="out('1707526022738550013');" style=""> 171                     case BANGLEJS_COMMAND_TX: {                                                          </span>
<span class="6200259397597608765" onmouseenter="enter('6200259397597608765');" onmouseout="out('6200259397597608765');" style=""> 172                         String data = String.valueOf(intent.getExtras().get(&quot;DATA&quot;));                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 173                         try {                                                                            </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 174                             TransactionBuilder builder = performInitialized(&quot;TX&quot;);                       </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 175                             uartTx(builder, data);                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 176                             builder.queue(getQueue());                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 177                         } catch (IOException e) {                                                        </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 178                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 178                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 180                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                     }                                                                                    </span>
<span class="5219935206621418062" onmouseenter="enter('5219935206621418062');" onmouseout="out('5219935206621418062');" style=""> 182                     case GBDevice.ACTION_DEVICE_CHANGED: {                                               </span>
<span class="-7853573391303433157" onmouseenter="enter('-7853573391303433157');" onmouseout="out('-7853573391303433157');" style=""> 183                         LOG.info(&quot;ACTION_DEVICE_CHANGED &quot; + gbDevice.getStateString());                  </span>
<span class="3462566553438825861" onmouseenter="enter('3462566553438825861');" onmouseout="out('3462566553438825861');" style=""><abbr title=" 184                         receiveHistory += &quot;\n================================================\nACTION_DEVICE_CHANGED &quot;+gbDevice.getStateString()+&quot; &quot;+(new SimpleDateFormat(&quot;yyyy-mm-dd hh:mm:ss&quot;)).format(Calendar.getInstance().getTime())+&quot;\n================================================\n&quot;;"> 184                         receiveHistory += &quot;\n================================================\nACTION_DEVðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 188         };                                                                                               </span>
<span class="-3358010436009942845" onmouseenter="enter('-3358010436009942845');" onmouseout="out('-3358010436009942845');" style=""><abbr title=" 189         LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, commandFilter);"> 189         LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190     }                                                                                                    </span>
<span  style=""> 191                                                                                                          </span>
<span class="-5775866095722777208" onmouseenter="enter('-5775866095722777208');" onmouseout="out('-5775866095722777208');" style=""> 192     private void registerGlobalIntents() {                                                               </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 193         IntentFilter commandFilter = new IntentFilter();                                                 </span>
<span class="312812515367481242" onmouseenter="enter('312812515367481242');" onmouseout="out('312812515367481242');" style=""> 194         commandFilter.addAction(BANGLE_ACTION_UART_TX);                                                  </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 195         BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 196             @Override                                                                                    </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 197             public void onReceive(Context context, Intent intent) {                                      </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 198                 switch (intent.getAction()) {                                                            </span>
<span class="-2247552427419228949" onmouseenter="enter('-2247552427419228949');" onmouseout="out('-2247552427419228949');" style=""> 199                     case BANGLE_ACTION_UART_TX: {                                                        </span>
<span class="1831826963180757129" onmouseenter="enter('1831826963180757129');" onmouseout="out('1831826963180757129');" style=""> 200                         /* In Tasker:                                                                    </span>
<span class="-7864253240443668933" onmouseenter="enter('-7864253240443668933');" onmouseout="out('-7864253240443668933');" style=""> 201                           Action: com.banglejs.uart.tx                                                   </span>
<span class="-8992717920838973367" onmouseenter="enter('-8992717920838973367');" onmouseout="out('-8992717920838973367');" style=""> 202                           Cat: None                                                                      </span>
<span class="7759910949487339439" onmouseenter="enter('7759910949487339439');" onmouseout="out('7759910949487339439');" style=""> 203                           Extra: line:Terminal.println(%avariable)                                       </span>
<span class="1033584491372489972" onmouseenter="enter('1033584491372489972');" onmouseout="out('1033584491372489972');" style=""> 204                           Target: Broadcast Receiver                                                     </span>
<span  style=""> 205                                                                                                          </span>
<span class="8716883358060475580" onmouseenter="enter('8716883358060475580');" onmouseout="out('8716883358060475580');" style=""><abbr title=" 206                           Variable: Number, Configure on Import, NOT structured, Value set, Nothing Exported, NOT Same as value"> 206                           Variable: Number, Configure on Import, NOT structured, Value set, Nothing ExporðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 207                          */                                                                              </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 208                         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 208                         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDeviceðŸ”µ</abbr></span>
<span class="-3486649650498692683" onmouseenter="enter('-3486649650498692683');" onmouseout="out('-3486649650498692683');" style=""> 209                         if (!devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) return;                 </span>
<span class="-5120599586530243425" onmouseenter="enter('-5120599586530243425');" onmouseout="out('-5120599586530243425');" style=""> 210                         String data = intent.getStringExtra(&quot;line&quot;);                                     </span>
<span class="2134003849288272405" onmouseenter="enter('2134003849288272405');" onmouseout="out('2134003849288272405');" style=""> 211                         if (data==null) {                                                                </span>
<span class="-1377387169158373155" onmouseenter="enter('-1377387169158373155');" onmouseout="out('-1377387169158373155');" style=""><abbr title=" 212                             GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 212                             GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTHðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 213                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214                         }                                                                                </span>
<span class="-5300884727268780299" onmouseenter="enter('-5300884727268780299');" onmouseout="out('-5300884727268780299');" style=""> 215                         if (!data.endsWith(&quot;\n&quot;)) data += &quot;\n&quot;;                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 216                         try {                                                                            </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 217                             TransactionBuilder builder = performInitialized(&quot;TX&quot;);                       </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 218                             uartTx(builder, data);                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 219                             builder.queue(getQueue());                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 220                         } catch (IOException e) {                                                        </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 221                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 221                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 223                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 227         };                                                                                               </span>
<span class="-7064134150505035894" onmouseenter="enter('-7064134150505035894');" onmouseout="out('-7064134150505035894');" style=""> 228         GBApplication.getContext().registerReceiver(commandReceiver, commandFilter);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span  style=""> 230                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 231     @Override                                                                                            </span>
<span class="624595386859969795" onmouseenter="enter('624595386859969795');" onmouseout="out('624595386859969795');" style=""> 232     protected TransactionBuilder initializeDevice(TransactionBuilder builder) {                          </span>
<span class="6943102306574884764" onmouseenter="enter('6943102306574884764');" onmouseout="out('6943102306574884764');" style=""> 233         LOG.info(&quot;Initializing&quot;);                                                                        </span>
<span  style=""> 234                                                                                                          </span>
<span class="-5776342764121597122" onmouseenter="enter('-5776342764121597122');" onmouseout="out('-5776342764121597122');" style=""> 235         gbDevice.setState(GBDevice.State.INITIALIZING);                                                  </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 236         gbDevice.sendDeviceUpdateIntent(getContext());                                                   </span>
<span class="-92673263340012587" onmouseenter="enter('-92673263340012587');" onmouseout="out('-92673263340012587');" style=""> 237         gbDevice.setBatteryThresholdPercent((short) 30);                                                 </span>
<span  style=""> 238                                                                                                          </span>
<span class="-8842369873450741446" onmouseenter="enter('-8842369873450741446');" onmouseout="out('-8842369873450741446');" style=""> 239         rxCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX);      </span>
<span class="5321381947985783136" onmouseenter="enter('5321381947985783136');" onmouseout="out('5321381947985783136');" style=""> 240         txCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_TX);      </span>
<span class="8787860057533172177" onmouseenter="enter('8787860057533172177');" onmouseout="out('8787860057533172177');" style=""> 241         builder.setGattCallback(this);                                                                   </span>
<span class="-6644952300158088977" onmouseenter="enter('-6644952300158088977');" onmouseout="out('-6644952300158088977');" style=""> 242         builder.notify(rxCharacteristic, true);                                                          </span>
<span  style=""> 243                                                                                                          </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 244         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));</span>
<span class="-251442064819697046" onmouseenter="enter('-251442064819697046');" onmouseout="out('-251442064819697046');" style=""> 245         allowHighMTU = devicePrefs.getBoolean(PREF_ALLOW_HIGH_MTU, false);                               </span>
<span  style=""> 246                                                                                                          </span>
<span class="-8288238614628464708" onmouseenter="enter('-8288238614628464708');" onmouseout="out('-8288238614628464708');" style=""> 247         uartTx(builder, &quot; \u0003&quot;); // clear active line                                                 </span>
<span  style=""> 248                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 249         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="8819552782192853417" onmouseenter="enter('8819552782192853417');" onmouseout="out('8819552782192853417');" style=""> 250         if (prefs.getBoolean(&quot;datetime_synconconnect&quot;, true))                                            </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 251           transmitTime(builder);                                                                         </span>
<span class="-772823299017939314" onmouseenter="enter('-772823299017939314');" onmouseout="out('-772823299017939314');" style=""> 252         //sendSettings(builder);                                                                         </span>
<span  style=""> 253                                                                                                          </span>
<span class="6222907129579606912" onmouseenter="enter('6222907129579606912');" onmouseout="out('6222907129579606912');" style=""> 254         // get version                                                                                   </span>
<span  style=""> 255                                                                                                          </span>
<span class="6586859092027978564" onmouseenter="enter('6586859092027978564');" onmouseout="out('6586859092027978564');" style=""> 256         gbDevice.setState(GBDevice.State.INITIALIZED);                                                   </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 257         gbDevice.sendDeviceUpdateIntent(getContext());                                                   </span>
<span  style=""> 258                                                                                                          </span>
<span class="-3832688778173104110" onmouseenter="enter('-3832688778173104110');" onmouseout="out('-3832688778173104110');" style=""> 259         getDevice().setFirmwareVersion(&quot;N/A&quot;);                                                           </span>
<span class="-4069256094451065143" onmouseenter="enter('-4069256094451065143');" onmouseout="out('-4069256094451065143');" style=""> 260         getDevice().setFirmwareVersion2(&quot;N/A&quot;);                                                          </span>
<span  style=""> 261                                                                                                          </span>
<span class="8801197429786363323" onmouseenter="enter('8801197429786363323');" onmouseout="out('8801197429786363323');" style=""> 262         LOG.info(&quot;Initialization Done&quot;);                                                                 </span>
<span  style=""> 263                                                                                                          </span>
<span class="4801455624621135639" onmouseenter="enter('4801455624621135639');" onmouseout="out('4801455624621135639');" style=""> 264         return builder;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265     }                                                                                                    </span>
<span  style=""> 266                                                                                                          </span>
<span class="-607913654590177522" onmouseenter="enter('-607913654590177522');" onmouseout="out('-607913654590177522');" style=""> 267     /// Write a string of data, and chunk it up                                                          </span>
<span class="7559000899786781106" onmouseenter="enter('7559000899786781106');" onmouseout="out('7559000899786781106');" style=""> 268     private void uartTx(TransactionBuilder builder, String str) {                                        </span>
<span class="2941836608639998178" onmouseenter="enter('2941836608639998178');" onmouseout="out('2941836608639998178');" style=""> 269         byte[] bytes = str.getBytes(StandardCharsets.ISO_8859_1);                                        </span>
<span class="7973208681748769929" onmouseenter="enter('7973208681748769929');" onmouseout="out('7973208681748769929');" style=""> 270         LOG.info(&quot;UART TX: &quot; + str);                                                                     </span>
<span class="-4351000658882190788" onmouseenter="enter('-4351000658882190788');" onmouseout="out('-4351000658882190788');" style=""><abbr title=" 271         // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.stringify is converting to UTF-8?"> 271         // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.strðŸ”µ</abbr></span>
<span class="-7681259971523215295" onmouseenter="enter('-7681259971523215295');" onmouseout="out('-7681259971523215295');" style=""> 272         for (int i=0;i&lt;bytes.length;i+=mtuSize) {                                                        </span>
<span class="6940458760871247208" onmouseenter="enter('6940458760871247208');" onmouseout="out('6940458760871247208');" style=""> 273             int l = bytes.length-i;                                                                      </span>
<span class="-2771087721762798548" onmouseenter="enter('-2771087721762798548');" onmouseout="out('-2771087721762798548');" style=""> 274             if (l&gt;mtuSize) l=mtuSize;                                                                    </span>
<span class="-7868874671478910733" onmouseenter="enter('-7868874671478910733');" onmouseout="out('-7868874671478910733');" style=""> 275             byte[] packet = new byte[l];                                                                 </span>
<span class="6292978456177043042" onmouseenter="enter('6292978456177043042');" onmouseout="out('6292978456177043042');" style=""> 276             System.arraycopy(bytes, i, packet, 0, l);                                                    </span>
<span class="7692898876807316449" onmouseenter="enter('7692898876807316449');" onmouseout="out('7692898876807316449');" style=""> 277             builder.write(txCharacteristic, packet);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279     }                                                                                                    </span>
<span  style=""> 280                                                                                                          </span>
<span class="-5064235187014244552" onmouseenter="enter('-5064235187014244552');" onmouseout="out('-5064235187014244552');" style=""> 281     /// Converts an object to a JSON string. see jsonToString                                            </span>
<span class="-7371185357421447388" onmouseenter="enter('-7371185357421447388');" onmouseout="out('-7371185357421447388');" style=""> 282     private String jsonToStringInternal(Object v) {                                                      </span>
<span class="-7134941835268720819" onmouseenter="enter('-7134941835268720819');" onmouseout="out('-7134941835268720819');" style=""> 283         if (v instanceof String) {                                                                       </span>
<span class="4695321176266141339" onmouseenter="enter('4695321176266141339');" onmouseout="out('4695321176266141339');" style=""> 284             /* Convert a string, escaping chars we can&#x27;t send over out UART connection */                </span>
<span class="8933833811592559950" onmouseenter="enter('8933833811592559950');" onmouseout="out('8933833811592559950');" style=""> 285             String s = (String)v;                                                                        </span>
<span class="-1195550795921055111" onmouseenter="enter('-1195550795921055111');" onmouseout="out('-1195550795921055111');" style=""> 286             String json = &quot;\&quot;&quot;;                                                                          </span>
<span class="-1996367706551518739" onmouseenter="enter('-1996367706551518739');" onmouseout="out('-1996367706551518739');" style=""> 287             for (int i=0;i&lt;s.length();i++) {                                                             </span>
<span class="-4633521068028742210" onmouseenter="enter('-4633521068028742210');" onmouseout="out('-4633521068028742210');" style=""> 288                 int ch = (int)s.charAt(i);                                                               </span>
<span class="5723330426570993790" onmouseenter="enter('5723330426570993790');" onmouseout="out('5723330426570993790');" style=""> 289                 if (ch&lt;8) json += &quot;\\&quot;+ch;                                                               </span>
<span class="-4350456713444094906" onmouseenter="enter('-4350456713444094906');" onmouseout="out('-4350456713444094906');" style=""> 290                 else if (ch==8) json += &quot;\\b&quot;;                                                           </span>
<span class="6286426041013160143" onmouseenter="enter('6286426041013160143');" onmouseout="out('6286426041013160143');" style=""> 291                 else if (ch==9) json += &quot;\\t&quot;;                                                           </span>
<span class="-1277399730021433556" onmouseenter="enter('-1277399730021433556');" onmouseout="out('-1277399730021433556');" style=""> 292                 else if (ch==10) json += &quot;\\n&quot;;                                                          </span>
<span class="6872609748162055968" onmouseenter="enter('6872609748162055968');" onmouseout="out('6872609748162055968');" style=""> 293                 else if (ch==11) json += &quot;\\v&quot;;                                                          </span>
<span class="7232867159848538970" onmouseenter="enter('7232867159848538970');" onmouseout="out('7232867159848538970');" style=""> 294                 else if (ch==12) json += &quot;\\f&quot;;                                                          </span>
<span class="-9019357013713288321" onmouseenter="enter('-9019357013713288321');" onmouseout="out('-9019357013713288321');" style=""> 295                 else if (ch==34) json += &quot;\\\&quot;&quot;; // quote                                                </span>
<span class="9032098586745803989" onmouseenter="enter('9032098586745803989');" onmouseout="out('9032098586745803989');" style=""> 296                 else if (ch==92) json += &quot;\\\\&quot;; // slash                                                </span>
<span class="6447496634063631908" onmouseenter="enter('6447496634063631908');" onmouseout="out('6447496634063631908');" style=""><abbr title=" 297                 else if (ch&lt;32 || ch==26 || ch==27 || ch==127 || ch==173) json += &quot;\\x&quot;+Integer.toHexString((ch&amp;255)|256).substring(1);"> 297                 else if (ch&lt;32 || ch==26 || ch==27 || ch==127 || ch==173) json += &quot;\\x&quot;+Integer.toHexStriðŸ”µ</abbr></span>
<span class="5586798994544781015" onmouseenter="enter('5586798994544781015');" onmouseout="out('5586798994544781015');" style=""> 298                 else json += s.charAt(i);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299             }                                                                                            </span>
<span class="8650149552652832651" onmouseenter="enter('8650149552652832651');" onmouseout="out('8650149552652832651');" style=""> 300             return json + &quot;\&quot;&quot;;                                                                          </span>
<span class="-7459573803876256213" onmouseenter="enter('-7459573803876256213');" onmouseout="out('-7459573803876256213');" style=""> 301         } else if (v instanceof JSONArray) {                                                             </span>
<span class="20789529080758051" onmouseenter="enter('20789529080758051');" onmouseout="out('20789529080758051');" style=""> 302             JSONArray a = (JSONArray)v;                                                                  </span>
<span class="2941565214382533189" onmouseenter="enter('2941565214382533189');" onmouseout="out('2941565214382533189');" style=""> 303             String json = &quot;[&quot;;                                                                           </span>
<span class="2132510637713046246" onmouseenter="enter('2132510637713046246');" onmouseout="out('2132510637713046246');" style=""> 304             for (int i=0;i&lt;a.length();i++) {                                                             </span>
<span class="-865608346194445464" onmouseenter="enter('-865608346194445464');" onmouseout="out('-865608346194445464');" style=""> 305                 if (i&gt;0) json += &quot;,&quot;;                                                                    </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style=""> 306                 Object o = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 307                 try {                                                                                    </span>
<span class="1204902991279523771" onmouseenter="enter('1204902991279523771');" onmouseout="out('1204902991279523771');" style=""> 308                     o = a.get(i);                                                                        </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 309                 } catch (JSONException e) {                                                              </span>
<span class="5502177219725162371" onmouseenter="enter('5502177219725162371');" onmouseout="out('5502177219725162371');" style=""> 310                     LOG.warn(&quot;jsonToString array error: &quot; + e.getLocalizedMessage());                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311                 }                                                                                        </span>
<span class="-4254234117673713204" onmouseenter="enter('-4254234117673713204');" onmouseout="out('-4254234117673713204');" style=""> 312                 json += jsonToStringInternal(o);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313             }                                                                                            </span>
<span class="-4069907645727934854" onmouseenter="enter('-4069907645727934854');" onmouseout="out('-4069907645727934854');" style=""> 314             return json+&quot;]&quot;;                                                                             </span>
<span class="8699967118061541294" onmouseenter="enter('8699967118061541294');" onmouseout="out('8699967118061541294');" style=""> 315         } else if (v instanceof JSONObject) {                                                            </span>
<span class="5040693240352357389" onmouseenter="enter('5040693240352357389');" onmouseout="out('5040693240352357389');" style=""> 316             JSONObject obj = (JSONObject)v;                                                              </span>
<span class="-6486828837023838756" onmouseenter="enter('-6486828837023838756');" onmouseout="out('-6486828837023838756');" style=""> 317             String json = &quot;{&quot;;                                                                           </span>
<span class="7563206350819307174" onmouseenter="enter('7563206350819307174');" onmouseout="out('7563206350819307174');" style=""> 318             Iterator&lt;String&gt; iter = obj.keys();                                                          </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 319             while (iter.hasNext()) {                                                                     </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 320                 String key = iter.next();                                                                </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style=""> 321                 Object o = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 322                 try {                                                                                    </span>
<span class="8042496106905891292" onmouseenter="enter('8042496106905891292');" onmouseout="out('8042496106905891292');" style=""> 323                     o = obj.get(key);                                                                    </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 324                 } catch (JSONException e) {                                                              </span>
<span class="2953006937969085175" onmouseenter="enter('2953006937969085175');" onmouseout="out('2953006937969085175');" style=""> 325                     LOG.warn(&quot;jsonToString object error: &quot; + e.getLocalizedMessage());                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326                 }                                                                                        </span>
<span class="7562295632169911142" onmouseenter="enter('7562295632169911142');" onmouseout="out('7562295632169911142');" style=""> 327                 json += key+&quot;:&quot;+jsonToStringInternal(o);                                                 </span>
<span class="-775465109238322464" onmouseenter="enter('-775465109238322464');" onmouseout="out('-775465109238322464');" style=""> 328                 if (iter.hasNext()) json+=&quot;,&quot;;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329             }                                                                                            </span>
<span class="1226915701420061298" onmouseenter="enter('1226915701420061298');" onmouseout="out('1226915701420061298');" style=""> 330             return json+&quot;}&quot;;                                                                             </span>
<span class="3600399421666172751" onmouseenter="enter('3600399421666172751');" onmouseout="out('3600399421666172751');" style=""> 331         } // else int/double/null                                                                        </span>
<span class="3525583877034800949" onmouseenter="enter('3525583877034800949');" onmouseout="out('3525583877034800949');" style=""> 332         return v.toString();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333     }                                                                                                    </span>
<span  style=""> 334                                                                                                          </span>
<span class="-4462526562745695882" onmouseenter="enter('-4462526562745695882');" onmouseout="out('-4462526562745695882');" style=""> 335     /// Convert a JSON object to a JSON String (NOT 100% JSON compliant)                                 </span>
<span class="4157561026938027662" onmouseenter="enter('4157561026938027662');" onmouseout="out('4157561026938027662');" style=""> 336     public String jsonToString(JSONObject jsonObj) {                                                     </span>
<span class="-3297195869188929142" onmouseenter="enter('-3297195869188929142');" onmouseout="out('-3297195869188929142');" style=""> 337         /* jsonObj.toString() works but breaks char codes&gt;128 (encodes as UTF8?) and also uses           </span>
<span class="7509381523120718717" onmouseenter="enter('7509381523120718717');" onmouseout="out('7509381523120718717');" style=""> 338         \u0000 when just \0 would do (and so on).                                                        </span>
<span  style=""> 339                                                                                                          </span>
<span class="-1336376992819668396" onmouseenter="enter('-1336376992819668396');" onmouseout="out('-1336376992819668396');" style=""> 340         So we do it manually, which can be more compact anyway.                                          </span>
<span class="-5084316389888644344" onmouseenter="enter('-5084316389888644344');" onmouseout="out('-5084316389888644344');" style=""> 341         This is JSON-ish, so not exactly as per JSON1 spec but good enough for Espruino.                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 342         */                                                                                               </span>
<span class="7796956154837315813" onmouseenter="enter('7796956154837315813');" onmouseout="out('7796956154837315813');" style=""> 343         return jsonToStringInternal(jsonObj);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344     }                                                                                                    </span>
<span  style=""> 345                                                                                                          </span>
<span class="31684629009080209" onmouseenter="enter('31684629009080209');" onmouseout="out('31684629009080209');" style=""> 346     /// Write a JSON object of data                                                                      </span>
<span class="-8756055707520682190" onmouseenter="enter('-8756055707520682190');" onmouseout="out('-8756055707520682190');" style=""> 347     private void uartTxJSON(String taskName, JSONObject json) {                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 348         try {                                                                                            </span>
<span class="-6185382728407385788" onmouseenter="enter('-6185382728407385788');" onmouseout="out('-6185382728407385788');" style=""> 349             TransactionBuilder builder = performInitialized(taskName);                                   </span>
<span class="-5291927674188184215" onmouseenter="enter('-5291927674188184215');" onmouseout="out('-5291927674188184215');" style=""> 350             uartTx(builder, &quot;\u0010GB(&quot;+jsonToString(json)+&quot;)\n&quot;);                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 351             builder.queue(getQueue());                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 352         } catch (IOException e) {                                                                        </span>
<span class="2446652404576165600" onmouseenter="enter('2446652404576165600');" onmouseout="out('2446652404576165600');" style=""><abbr title=" 353             GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 353             GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONGðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355     }                                                                                                    </span>
<span  style=""> 356                                                                                                          </span>
<span class="4290598848752150102" onmouseenter="enter('4290598848752150102');" onmouseout="out('4290598848752150102');" style=""> 357     /// Write JSON object of the form {t:taskName, err:message}                                          </span>
<span  style=""> 358                                                                                                          </span>
<span class="-8058058420395857539" onmouseenter="enter('-8058058420395857539');" onmouseout="out('-8058058420395857539');" style=""> 359     private void uartTxJSONError(String taskName, String message) {                                      </span>
<span class="3966342241212062344" onmouseenter="enter('3966342241212062344');" onmouseout="out('3966342241212062344');" style=""> 360         uartTxJSONError(taskName,message,null);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361     }                                                                                                    </span>
<span  style=""> 362                                                                                                          </span>
<span class="7327259819120083170" onmouseenter="enter('7327259819120083170');" onmouseout="out('7327259819120083170');" style=""> 363     private void uartTxJSONError(String taskName, String message,String id) {                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 364         JSONObject o = new JSONObject();                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 365         try {                                                                                            </span>
<span class="-4736457139552862676" onmouseenter="enter('-4736457139552862676');" onmouseout="out('-4736457139552862676');" style=""> 366             o.put(&quot;t&quot;, taskName);                                                                        </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 367             if( id!=null)                                                                                </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 368                 o.put(&quot;id&quot;, id);                                                                         </span>
<span class="-3362855442851232299" onmouseenter="enter('-3362855442851232299');" onmouseout="out('-3362855442851232299');" style=""> 369             o.put(&quot;err&quot;, message);                                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 370         } catch (JSONException e) {                                                                      </span>
<span class="-293713289384668060" onmouseenter="enter('-293713289384668060');" onmouseout="out('-293713289384668060');" style=""><abbr title=" 371             GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 371             GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.EðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372         }                                                                                                </span>
<span class="-3544369649702046019" onmouseenter="enter('-3544369649702046019');" onmouseout="out('-3544369649702046019');" style=""> 373         uartTxJSON(taskName, o);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374     }                                                                                                    </span>
<span  style=""> 375                                                                                                          </span>
<span  style=""> 376                                                                                                          </span>
<span  style=""> 377                                                                                                          </span>
<span class="3549324304064443217" onmouseenter="enter('3549324304064443217');" onmouseout="out('3549324304064443217');" style=""> 378     private void handleUartRxLine(String line) {                                                         </span>
<span class="7696744219355043330" onmouseenter="enter('7696744219355043330');" onmouseout="out('7696744219355043330');" style=""> 379         LOG.info(&quot;UART RX LINE: &quot; + line);                                                               </span>
<span class="5454828508308371900" onmouseenter="enter('5454828508308371900');" onmouseout="out('5454828508308371900');" style=""> 380         if (line.length()==0) return;                                                                    </span>
<span class="2508923913537480964" onmouseenter="enter('2508923913537480964');" onmouseout="out('2508923913537480964');" style=""> 381         if (&quot;&gt;Uncaught ReferenceError: \&quot;GB\&quot; is not defined&quot;.equals(line))                              </span>
<span class="7158908931448264833" onmouseenter="enter('7158908931448264833');" onmouseout="out('7158908931448264833');" style=""><abbr title=" 382           GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 382           GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GB.ðŸ”µ</abbr></span>
<span class="5685500193458919055" onmouseenter="enter('5685500193458919055');" onmouseout="out('5685500193458919055');" style=""> 383         else if (line.charAt(0)==&#x27;{&#x27;) {                                                                  </span>
<span class="8231786037032554769" onmouseenter="enter('8231786037032554769');" onmouseout="out('8231786037032554769');" style=""> 384             // JSON - we hope!                                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 385             try {                                                                                        </span>
<span class="2411116435363976231" onmouseenter="enter('2411116435363976231');" onmouseout="out('2411116435363976231');" style=""> 386                 JSONObject json = new JSONObject(line);                                                  </span>
<span class="8233558512387133223" onmouseenter="enter('8233558512387133223');" onmouseout="out('8233558512387133223');" style=""> 387                 LOG.info(&quot;UART RX JSON parsed successfully&quot;);                                            </span>
<span class="4509864865787947019" onmouseenter="enter('4509864865787947019');" onmouseout="out('4509864865787947019');" style=""> 388                 handleUartRxJSON(json);                                                                  </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 389             } catch (JSONException e) {                                                                  </span>
<span class="-2414553303058964646" onmouseenter="enter('-2414553303058964646');" onmouseout="out('-2414553303058964646');" style=""> 390                 LOG.info(&quot;UART RX JSON parse failure: &quot;+ e.getLocalizedMessage());                       </span>
<span class="8356145272001509336" onmouseenter="enter('8356145272001509336');" onmouseout="out('8356145272001509336');" style=""><abbr title=" 391                 GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 391                 GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), ToastðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 393         } else {                                                                                         </span>
<span class="3013327231508790922" onmouseenter="enter('3013327231508790922');" onmouseout="out('3013327231508790922');" style=""> 394             LOG.info(&quot;UART RX line started with &quot;+(int)line.charAt(0)+&quot; - ignoring&quot;);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396     }                                                                                                    </span>
<span  style=""> 397                                                                                                          </span>
<span class="-1023302836013344522" onmouseenter="enter('-1023302836013344522');" onmouseout="out('-1023302836013344522');" style=""> 398     private void handleUartRxJSON(JSONObject json) throws JSONException {                                </span>
<span class="7061070849429770108" onmouseenter="enter('7061070849429770108');" onmouseout="out('7061070849429770108');" style=""> 399         String packetType = json.getString(&quot;t&quot;);                                                         </span>
<span class="2121648211711712075" onmouseenter="enter('2121648211711712075');" onmouseout="out('2121648211711712075');" style=""> 400         switch (packetType) {                                                                            </span>
<span class="1154622936863099207" onmouseenter="enter('1154622936863099207');" onmouseout="out('1154622936863099207');" style=""> 401             case &quot;info&quot;:                                                                                 </span>
<span class="6489300233296788049" onmouseenter="enter('6489300233296788049');" onmouseout="out('6489300233296788049');" style=""><abbr title=" 402                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO);"> 402                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO)ðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 403                 break;                                                                                   </span>
<span class="3852677909480408410" onmouseenter="enter('3852677909480408410');" onmouseout="out('3852677909480408410');" style=""> 404             case &quot;warn&quot;:                                                                                 </span>
<span class="-1267997652646506218" onmouseenter="enter('-1267997652646506218');" onmouseout="out('-1267997652646506218');" style=""><abbr title=" 405                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN);"> 405                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN)ðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 406                 break;                                                                                   </span>
<span class="-4027904492374937118" onmouseenter="enter('-4027904492374937118');" onmouseout="out('-4027904492374937118');" style=""> 407             case &quot;error&quot;:                                                                                </span>
<span class="3082648944163426921" onmouseenter="enter('3082648944163426921');" onmouseout="out('3082648944163426921');" style=""><abbr title=" 408                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERROR);"> 408                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERRORðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 409                 break;                                                                                   </span>
<span class="-6550395055022650144" onmouseenter="enter('-6550395055022650144');" onmouseout="out('-6550395055022650144');" style=""> 410             case &quot;ver&quot;: {                                                                                </span>
<span class="1504582788479684724" onmouseenter="enter('1504582788479684724');" onmouseout="out('1504582788479684724');" style=""> 411                 if (json.has(&quot;fw1&quot;))                                                                     </span>
<span class="7809101785256581980" onmouseenter="enter('7809101785256581980');" onmouseout="out('7809101785256581980');" style=""> 412                     getDevice().setFirmwareVersion(json.getString(&quot;fw1&quot;));                               </span>
<span class="-4269189810719037321" onmouseenter="enter('-4269189810719037321');" onmouseout="out('-4269189810719037321');" style=""> 413                 if (json.has(&quot;fw2&quot;))                                                                     </span>
<span class="-1725698584982350052" onmouseenter="enter('-1725698584982350052');" onmouseout="out('-1725698584982350052');" style=""> 414                     getDevice().setFirmwareVersion2(json.getString(&quot;fw2&quot;));                              </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 415             } break;                                                                                     </span>
<span class="-3223445656092502792" onmouseenter="enter('-3223445656092502792');" onmouseout="out('-3223445656092502792');" style=""> 416             case &quot;status&quot;: {                                                                             </span>
<span class="1472249640876064382" onmouseenter="enter('1472249640876064382');" onmouseout="out('1472249640876064382');" style=""> 417                 GBDeviceEventBatteryInfo batteryInfo = new GBDeviceEventBatteryInfo();                   </span>
<span class="-8684865925727857265" onmouseenter="enter('-8684865925727857265');" onmouseout="out('-8684865925727857265');" style=""> 418                 if (json.has(&quot;bat&quot;)) {                                                                   </span>
<span class="3744277214774220447" onmouseenter="enter('3744277214774220447');" onmouseout="out('3744277214774220447');" style=""> 419                     int b = json.getInt(&quot;bat&quot;);                                                          </span>
<span class="5862741907286067284" onmouseenter="enter('5862741907286067284');" onmouseout="out('5862741907286067284');" style=""> 420                     if (b &lt; 0) b = 0;                                                                    </span>
<span class="572226595522417282" onmouseenter="enter('572226595522417282');" onmouseout="out('572226595522417282');" style=""> 421                     if (b &gt; 100) b = 100;                                                                </span>
<span class="6496455062087841098" onmouseenter="enter('6496455062087841098');" onmouseout="out('6496455062087841098');" style=""> 422                     batteryInfo.level = b;                                                               </span>
<span class="-2105719386055198398" onmouseenter="enter('-2105719386055198398');" onmouseout="out('-2105719386055198398');" style=""> 423                     batteryInfo.state = BatteryState.BATTERY_NORMAL;                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424                 }                                                                                        </span>
<span class="-8617525444786471834" onmouseenter="enter('-8617525444786471834');" onmouseout="out('-8617525444786471834');" style=""> 425                 if (json.has(&quot;chg&quot;) &amp;&amp; json.getInt(&quot;chg&quot;) == 1) {                                        </span>
<span class="-936118866357790298" onmouseenter="enter('-936118866357790298');" onmouseout="out('-936118866357790298');" style=""> 426                     batteryInfo.state = BatteryState.BATTERY_CHARGING;                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427                 }                                                                                        </span>
<span class="1514350151524445078" onmouseenter="enter('1514350151524445078');" onmouseout="out('1514350151524445078');" style=""> 428                 if (json.has(&quot;volt&quot;))                                                                    </span>
<span class="-3686044708246396849" onmouseenter="enter('-3686044708246396849');" onmouseout="out('-3686044708246396849');" style=""> 429                     batteryInfo.voltage = (float) json.getDouble(&quot;volt&quot;);                                </span>
<span class="-1573801757390600576" onmouseenter="enter('-1573801757390600576');" onmouseout="out('-1573801757390600576');" style=""> 430                 handleGBDeviceEvent(batteryInfo);                                                        </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 431             } break;                                                                                     </span>
<span class="-7544298044919087691" onmouseenter="enter('-7544298044919087691');" onmouseout="out('-7544298044919087691');" style=""> 432             case &quot;findPhone&quot;: {                                                                          </span>
<span class="-2748392883851010177" onmouseenter="enter('-2748392883851010177');" onmouseout="out('-2748392883851010177');" style=""> 433                 boolean start = json.has(&quot;n&quot;) &amp;&amp; json.getBoolean(&quot;n&quot;);                                   </span>
<span class="6136676704701652580" onmouseenter="enter('6136676704701652580');" onmouseout="out('6136676704701652580');" style=""> 434                 GBDeviceEventFindPhone deviceEventFindPhone = new GBDeviceEventFindPhone();              </span>
<span class="3202169087750798845" onmouseenter="enter('3202169087750798845');" onmouseout="out('3202169087750798845');" style=""><abbr title=" 435                 deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFindPhone.Event.STOP;"> 435                 deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFiðŸ”µ</abbr></span>
<span class="-1455650059425895125" onmouseenter="enter('-1455650059425895125');" onmouseout="out('-1455650059425895125');" style=""> 436                 evaluateGBDeviceEvent(deviceEventFindPhone);                                             </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 437             } break;                                                                                     </span>
<span class="5454487238732594669" onmouseenter="enter('5454487238732594669');" onmouseout="out('5454487238732594669');" style=""> 438             case &quot;music&quot;: {                                                                              </span>
<span class="-5683743334008418698" onmouseenter="enter('-5683743334008418698');" onmouseout="out('-5683743334008418698');" style=""> 439                 GBDeviceEventMusicControl deviceEventMusicControl = new GBDeviceEventMusicControl();     </span>
<span class="5894306574008826676" onmouseenter="enter('5894306574008826676');" onmouseout="out('5894306574008826676');" style=""><abbr title=" 440                 deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 440                 deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;nðŸ”µ</abbr></span>
<span class="8133545861002504946" onmouseenter="enter('8133545861002504946');" onmouseout="out('8133545861002504946');" style=""> 441                 evaluateGBDeviceEvent(deviceEventMusicControl);                                          </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 442             } break;                                                                                     </span>
<span class="-9207173587563143993" onmouseenter="enter('-9207173587563143993');" onmouseout="out('-9207173587563143993');" style=""> 443             case &quot;call&quot;: {                                                                               </span>
<span class="2406734484891175482" onmouseenter="enter('2406734484891175482');" onmouseout="out('2406734484891175482');" style=""> 444                 GBDeviceEventCallControl deviceEventCallControl = new GBDeviceEventCallControl();        </span>
<span class="-5299176663874891056" onmouseenter="enter('-5299176663874891056');" onmouseout="out('-5299176663874891056');" style=""><abbr title=" 445                 deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 445                 deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;)ðŸ”µ</abbr></span>
<span class="-7699727803461656923" onmouseenter="enter('-7699727803461656923');" onmouseout="out('-7699727803461656923');" style=""> 446                 evaluateGBDeviceEvent(deviceEventCallControl);                                           </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 447             } break;                                                                                     </span>
<span class="-337329064960380865" onmouseenter="enter('-337329064960380865');" onmouseout="out('-337329064960380865');" style=""> 448             case &quot;notify&quot; : {                                                                            </span>
<span class="1278038111464368986" onmouseenter="enter('1278038111464368986');" onmouseout="out('1278038111464368986');" style=""><abbr title=" 449                 GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificationControl();"> 449                 GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificaðŸ”µ</abbr></span>
<span class="-6597246807803729732" onmouseenter="enter('-6597246807803729732');" onmouseout="out('-6597246807803729732');" style=""> 450                 // .title appears unused                                                                 </span>
<span class="-3304774628543622498" onmouseenter="enter('-3304774628543622498');" onmouseout="out('-3304774628543622498');" style=""><abbr title=" 451                 deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 451                 deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.ðŸ”µ</abbr></span>
<span class="4338373654190408032" onmouseenter="enter('4338373654190408032');" onmouseout="out('4338373654190408032');" style=""> 452                 if (json.has(&quot;id&quot;))                                                                      </span>
<span class="1062450614172957636" onmouseenter="enter('1062450614172957636');" onmouseout="out('1062450614172957636');" style=""> 453                     deviceEvtNotificationControl.handle = json.getInt(&quot;id&quot;);                             </span>
<span class="658666775109182698" onmouseenter="enter('658666775109182698');" onmouseout="out('658666775109182698');" style=""> 454                 if (json.has(&quot;tel&quot;))                                                                     </span>
<span class="3912257448498793625" onmouseenter="enter('3912257448498793625');" onmouseout="out('3912257448498793625');" style=""> 455                     deviceEvtNotificationControl.phoneNumber = json.getString(&quot;tel&quot;);                    </span>
<span class="-279845848013227661" onmouseenter="enter('-279845848013227661');" onmouseout="out('-279845848013227661');" style=""> 456                 if (json.has(&quot;msg&quot;))                                                                     </span>
<span class="6661039268276828670" onmouseenter="enter('6661039268276828670');" onmouseout="out('6661039268276828670');" style=""> 457                     deviceEvtNotificationControl.reply = json.getString(&quot;msg&quot;);                          </span>
<span class="-1817112681649718085" onmouseenter="enter('-1817112681649718085');" onmouseout="out('-1817112681649718085');" style=""> 458                 /* REPLY responses don&#x27;t use the ID from the event (MUTE/etc seem to), but instead       </span>
<span class="5406797550372080886" onmouseenter="enter('5406797550372080886');" onmouseout="out('5406797550372080886');" style=""> 459                 * they use a handle that was provided in an action list on the onNotification.. event  */</span>
<span class="-4787844253490591897" onmouseenter="enter('-4787844253490591897');" onmouseout="out('-4787844253490591897');" style=""> 460                 if (deviceEvtNotificationControl.event == GBDeviceEventNotificationControl.Event.REPLY) {</span>
<span class="7047790762640343753" onmouseenter="enter('7047790762640343753');" onmouseout="out('7047790762640343753');" style=""><abbr title=" 461                     Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationControl.handle);"> 461                     Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationCoðŸ”µ</abbr></span>
<span class="2363738327135911056" onmouseenter="enter('2363738327135911056');" onmouseout="out('2363738327135911056');" style=""> 462                     if (foundHandle!=null)                                                               </span>
<span class="-5768705298123946646" onmouseenter="enter('-5768705298123946646');" onmouseout="out('-5768705298123946646');" style=""> 463                         deviceEvtNotificationControl.handle = foundHandle;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464                 }                                                                                        </span>
<span class="1799618905473722788" onmouseenter="enter('1799618905473722788');" onmouseout="out('1799618905473722788');" style=""> 465                 evaluateGBDeviceEvent(deviceEvtNotificationControl);                                     </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 466             } break;                                                                                     </span>
<span class="692659105886468257" onmouseenter="enter('692659105886468257');" onmouseout="out('692659105886468257');" style=""> 467             case &quot;act&quot;: {                                                                                </span>
<span class="8371010899036944571" onmouseenter="enter('8371010899036944571');" onmouseout="out('8371010899036944571');" style=""> 468                 BangleJSActivitySample sample = new BangleJSActivitySample();                            </span>
<span class="-1915545881769334236" onmouseenter="enter('-1915545881769334236');" onmouseout="out('-1915545881769334236');" style=""> 469                 sample.setTimestamp((int) (GregorianCalendar.getInstance().getTimeInMillis() / 1000L));  </span>
<span class="-6511180810366476909" onmouseenter="enter('-6511180810366476909');" onmouseout="out('-6511180810366476909');" style=""> 470                 int hrm = 0;                                                                             </span>
<span class="-2794193254662759202" onmouseenter="enter('-2794193254662759202');" onmouseout="out('-2794193254662759202');" style=""> 471                 int steps = 0;                                                                           </span>
<span class="1159991081674058958" onmouseenter="enter('1159991081674058958');" onmouseout="out('1159991081674058958');" style=""> 472                 if (json.has(&quot;hrm&quot;)) hrm = json.getInt(&quot;hrm&quot;);                                           </span>
<span class="2200733451486704836" onmouseenter="enter('2200733451486704836');" onmouseout="out('2200733451486704836');" style=""> 473                 if (json.has(&quot;stp&quot;)) steps = json.getInt(&quot;stp&quot;);                                         </span>
<span class="6603465025108101037" onmouseenter="enter('6603465025108101037');" onmouseout="out('6603465025108101037');" style=""> 474                 int activity = BangleJSSampleProvider.TYPE_ACTIVITY;                                     </span>
<span class="6065424140180877442" onmouseenter="enter('6065424140180877442');" onmouseout="out('6065424140180877442');" style=""> 475                 /*if (json.has(&quot;act&quot;)) {                                                                 </span>
<span class="-2439039461724633138" onmouseenter="enter('-2439039461724633138');" onmouseout="out('-2439039461724633138');" style=""> 476                     String actName = &quot;TYPE_&quot; + json.getString(&quot;act&quot;).toUpperCase();                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 477                     try {                                                                                </span>
<span class="-5191337226244238063" onmouseenter="enter('-5191337226244238063');" onmouseout="out('-5191337226244238063');" style=""> 478                         Field f = ActivityKind.class.getField(actName);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 479                         try {                                                                            </span>
<span class="8672601729845658913" onmouseenter="enter('8672601729845658913');" onmouseout="out('8672601729845658913');" style=""> 480                             activity = f.getInt(null);                                                   </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 481                         } catch (IllegalAccessException e) {                                             </span>
<span class="9211658540801898058" onmouseenter="enter('9211658540801898058');" onmouseout="out('9211658540801898058');" style=""> 482                             LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not readable&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483                         }                                                                                </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 484                     } catch (NoSuchFieldException e) {                                                   </span>
<span class="-4236592020282047640" onmouseenter="enter('-4236592020282047640');" onmouseout="out('-4236592020282047640');" style=""> 485                         LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not found&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486                     }                                                                                    </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 487                 }*/                                                                                      </span>
<span class="8668161863330653058" onmouseenter="enter('8668161863330653058');" onmouseout="out('8668161863330653058');" style=""> 488                 sample.setRawKind(activity);                                                             </span>
<span class="5935105042646692248" onmouseenter="enter('5935105042646692248');" onmouseout="out('5935105042646692248');" style=""> 489                 sample.setHeartRate(hrm);                                                                </span>
<span class="-4745425836300475693" onmouseenter="enter('-4745425836300475693');" onmouseout="out('-4745425836300475693');" style=""> 490                 sample.setSteps(steps);                                                                  </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style=""> 491                 try (DBHandler dbHandler = GBApplication.acquireDB()) {                                  </span>
<span class="1422413790142608640" onmouseenter="enter('1422413790142608640');" onmouseout="out('1422413790142608640');" style=""> 492                     Long userId = getUser(dbHandler.getDaoSession()).getId();                            </span>
<span class="3688300519339275893" onmouseenter="enter('3688300519339275893');" onmouseout="out('3688300519339275893');" style=""> 493                     Long deviceId = DBHelper.getDevice(getDevice(), dbHandler.getDaoSession()).getId();  </span>
<span class="-4884679916644886432" onmouseenter="enter('-4884679916644886432');" onmouseout="out('-4884679916644886432');" style=""><abbr title=" 494                     BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.getDaoSession());"> 494                     BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.gðŸ”µ</abbr></span>
<span class="6444535225867718796" onmouseenter="enter('6444535225867718796');" onmouseout="out('6444535225867718796');" style=""> 495                     sample.setDeviceId(deviceId);                                                        </span>
<span class="292659008851945780" onmouseenter="enter('292659008851945780');" onmouseout="out('292659008851945780');" style=""> 496                     sample.setUserId(userId);                                                            </span>
<span class="4765059548563428130" onmouseenter="enter('4765059548563428130');" onmouseout="out('4765059548563428130');" style=""> 497                     provider.addGBActivitySample(sample);                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 498                 } catch (Exception ex) {                                                                 </span>
<span class="1206810911036844482" onmouseenter="enter('1206810911036844482');" onmouseout="out('1206810911036844482');" style=""> 499                     LOG.warn(&quot;Error saving activity: &quot; + ex.getLocalizedMessage());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500                 }                                                                                        </span>
<span class="5171490897490639183" onmouseenter="enter('5171490897490639183');" onmouseout="out('5171490897490639183');" style=""> 501                 // push realtime data                                                                    </span>
<span class="-6833823710638969612" onmouseenter="enter('-6833823710638969612');" onmouseout="out('-6833823710638969612');" style=""> 502                 if (realtimeHRM || realtimeStep) {                                                       </span>
<span class="-9081146433891434428" onmouseenter="enter('-9081146433891434428');" onmouseout="out('-9081146433891434428');" style=""> 503                     Intent intent = new Intent(DeviceService.ACTION_REALTIME_SAMPLES)                    </span>
<span class="5807466852720832411" onmouseenter="enter('5807466852720832411');" onmouseout="out('5807466852720832411');" style=""> 504                             .putExtra(DeviceService.EXTRA_REALTIME_SAMPLE, sample);                      </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 505                     LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506                 }                                                                                        </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 507             } break;                                                                                     </span>
<span class="-3056288259405338320" onmouseenter="enter('-3056288259405338320');" onmouseout="out('-3056288259405338320');" style=""> 508             case &quot;http&quot;: {                                                                               </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 509                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 509                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddrðŸ”µ</abbr></span>
<span class="4471501014415506100" onmouseenter="enter('4471501014415506100');" onmouseout="out('4471501014415506100');" style=""> 510                 String _id=null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 511                 try {                                                                                    </span>
<span class="4672396922249032002" onmouseenter="enter('4672396922249032002');" onmouseout="out('4672396922249032002');" style=""> 512                     _id = json.getString(&quot;id&quot;);                                                          </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 513                 } catch (JSONException e) {                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514                 }                                                                                        </span>
<span class="5919143370037839830" onmouseenter="enter('5919143370037839830');" onmouseout="out('5919143370037839830');" style=""> 515                 final String id = _id;                                                                   </span>
<span  style=""> 516                                                                                                          </span>
<span  style=""> 517                                                                                                          </span>
<span class="-6992637283999421128" onmouseenter="enter('-6992637283999421128');" onmouseout="out('-6992637283999421128');" style=""><abbr title=" 518                 if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESS, false)) {"> 518                 if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESS, faðŸ”µ</abbr></span>
<span class="3585939051150823686" onmouseenter="enter('3585939051150823686');" onmouseout="out('3585939051150823686');" style=""> 519                     RequestQueue queue = Volley.newRequestQueue(getContext());                           </span>
<span class="5176519532323120311" onmouseenter="enter('5176519532323120311');" onmouseout="out('5176519532323120311');" style=""> 520                     String url = json.getString(&quot;url&quot;);                                                  </span>
<span  style=""> 521                                                                                                          </span>
<span class="-3545396317642083141" onmouseenter="enter('-3545396317642083141');" onmouseout="out('-3545396317642083141');" style=""> 522                     String _xmlPath = &quot;&quot;;                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 523                     try {                                                                                </span>
<span class="-6862471463745020928" onmouseenter="enter('-6862471463745020928');" onmouseout="out('-6862471463745020928');" style=""> 524                         _xmlPath = json.getString(&quot;xpath&quot;);                                              </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 525                     } catch (JSONException e) {                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526                     }                                                                                    </span>
<span class="605766333889403990" onmouseenter="enter('605766333889403990');" onmouseout="out('605766333889403990');" style=""> 527                     final String xmlPath = _xmlPath;                                                     </span>
<span class="-7325827083532572939" onmouseenter="enter('-7325827083532572939');" onmouseout="out('-7325827083532572939');" style=""> 528                     // Request a string response from the provided URL.                                  </span>
<span class="-7080864972701183073" onmouseenter="enter('-7080864972701183073');" onmouseout="out('-7080864972701183073');" style=""> 529                     StringRequest stringRequest = new StringRequest(Request.Method.GET, url,             </span>
<span class="1580018343670400637" onmouseenter="enter('1580018343670400637');" onmouseout="out('1580018343670400637');" style=""> 530                             new Response.Listener&lt;String&gt;() {                                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 531                                 @Override                                                                </span>
<span class="2219137294630149657" onmouseenter="enter('2219137294630149657');" onmouseout="out('2219137294630149657');" style=""> 532                                 public void onResponse(String response) {                                </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 533                                     JSONObject o = new JSONObject();                                     </span>
<span class="3496993666001094453" onmouseenter="enter('3496993666001094453');" onmouseout="out('3496993666001094453');" style=""> 534                                     if (xmlPath.length() != 0) {                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 535                                         try {                                                            </span>
<span class="5597187660883583119" onmouseenter="enter('5597187660883583119');" onmouseout="out('5597187660883583119');" style=""><abbr title=" 536                                             InputSource inputXML = new InputSource(new StringReader(response));"> 536                                             InputSource inputXML = new InputSource(new StringReader(respoðŸ”µ</abbr></span>
<span class="-160158441380049344" onmouseenter="enter('-160158441380049344');" onmouseout="out('-160158441380049344');" style=""> 537                                             XPath xPath = XPathFactory.newInstance().newXPath();         </span>
<span class="-5056989228059087382" onmouseenter="enter('-5056989228059087382');" onmouseout="out('-5056989228059087382');" style=""> 538                                             response = xPath.evaluate(xmlPath, inputXML);                </span>
<span class="6902166904876459873" onmouseenter="enter('6902166904876459873');" onmouseout="out('6902166904876459873');" style=""> 539                                         } catch (Exception error) {                                      </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 540                                             uartTxJSONError(&quot;http&quot;, error.toString(),id);                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 541                                             return;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                                         }                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543                                     }                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 544                                     try {                                                                </span>
<span class="6603605385044119606" onmouseenter="enter('6603605385044119606');" onmouseout="out('6603605385044119606');" style=""> 545                                         o.put(&quot;t&quot;, &quot;http&quot;);                                              </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 546                                         if( id!=null)                                                    </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 547                                             o.put(&quot;id&quot;, id);                                             </span>
<span class="-7019821812941989411" onmouseenter="enter('-7019821812941989411');" onmouseout="out('-7019821812941989411');" style=""> 548                                         o.put(&quot;resp&quot;, response);                                         </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 549                                     } catch (JSONException e) {                                          </span>
<span class="5084509021389731794" onmouseenter="enter('5084509021389731794');" onmouseout="out('5084509021389731794');" style=""><abbr title=" 550                                         GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 550                                         GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551                                     }                                                                    </span>
<span class="-4140114778756524985" onmouseenter="enter('-4140114778756524985');" onmouseout="out('-4140114778756524985');" style=""> 552                                     uartTxJSON(&quot;http&quot;, o);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553                                 }                                                                        </span>
<span class="4760556576659557486" onmouseenter="enter('4760556576659557486');" onmouseout="out('4760556576659557486');" style=""> 554                             }, new Response.ErrorListener() {                                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 555                         @Override                                                                        </span>
<span class="3365806574504816618" onmouseenter="enter('3365806574504816618');" onmouseout="out('3365806574504816618');" style=""> 556                         public void onErrorResponse(VolleyError error) {                                 </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 557                             JSONObject o = new JSONObject();                                             </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 558                             uartTxJSONError(&quot;http&quot;, error.toString(),id);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559                         }                                                                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 560                     });                                                                                  </span>
<span class="-2087140764948748418" onmouseenter="enter('-2087140764948748418');" onmouseout="out('-2087140764948748418');" style=""> 561                     queue.add(stringRequest);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 562                 } else {                                                                                 </span>
<span class="-204746163834141844" onmouseenter="enter('-204746163834141844');" onmouseout="out('-204746163834141844');" style=""> 563                     if (BuildConfig.INTERNET_ACCESS)                                                     </span>
<span class="-1860415774351364303" onmouseenter="enter('-1860415774351364303');" onmouseout="out('-1860415774351364303');" style=""><abbr title=" 564                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device Settings&quot;,id);"> 564                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device SðŸ”µ</abbr></span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 565                     else                                                                                 </span>
<span class="-8529240479352607945" onmouseenter="enter('-8529240479352607945');" onmouseout="out('-8529240479352607945');" style=""><abbr title=" 566                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;,id);"> 566                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567                 }                                                                                        </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 568             } break;                                                                                     </span>
<span class="7434952261878113170" onmouseenter="enter('7434952261878113170');" onmouseout="out('7434952261878113170');" style=""> 569             case &quot;intent&quot;: {                                                                             </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 570                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 570                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddrðŸ”µ</abbr></span>
<span class="-3997484102524704678" onmouseenter="enter('-3997484102524704678');" onmouseout="out('-3997484102524704678');" style=""> 571                 if (devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) {                                </span>
<span class="7885860666276152502" onmouseenter="enter('7885860666276152502');" onmouseout="out('7885860666276152502');" style=""> 572                     String action = json.getString(&quot;action&quot;);                                            </span>
<span class="-6778424845662998727" onmouseenter="enter('-6778424845662998727');" onmouseout="out('-6778424845662998727');" style=""> 573                     JSONObject extra = json.getJSONObject(&quot;extra&quot;);                                      </span>
<span class="5907617214453163300" onmouseenter="enter('5907617214453163300');" onmouseout="out('5907617214453163300');" style=""> 574                     Intent in = new Intent();                                                            </span>
<span class="-8779884887971893320" onmouseenter="enter('-8779884887971893320');" onmouseout="out('-8779884887971893320');" style=""> 575                     in.setAction(action);                                                                </span>
<span class="-5835095174807794521" onmouseenter="enter('-5835095174807794521');" onmouseout="out('-5835095174807794521');" style=""> 576                     if (extra != null) {                                                                 </span>
<span class="7421222014058952195" onmouseenter="enter('7421222014058952195');" onmouseout="out('7421222014058952195');" style=""> 577                         Iterator&lt;String&gt; iter = extra.keys();                                            </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 578                         while (iter.hasNext()) {                                                         </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 579                             String key = iter.next();                                                    </span>
<span class="-6860780283306876147" onmouseenter="enter('-6860780283306876147');" onmouseout="out('-6860780283306876147');" style=""> 580                             in.putExtra(key, extra.getString(key));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 582                     }                                                                                    </span>
<span class="6658078666630545861" onmouseenter="enter('6658078666630545861');" onmouseout="out('6658078666630545861');" style=""> 583                     LOG.info(&quot;Sending intent &quot; + action);                                                </span>
<span class="-5369611568799868297" onmouseenter="enter('-5369611568799868297');" onmouseout="out('-5369611568799868297');" style=""> 584                     this.getContext().getApplicationContext().sendBroadcast(in);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 585                 } else {                                                                                 </span>
<span class="7018402905003983802" onmouseenter="enter('7018402905003983802');" onmouseout="out('7018402905003983802');" style=""><abbr title=" 586                     uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge Device Settings&quot;);"> 586                     uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge Device SetðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 587                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588             }                                                                                            </span>
<span class="-2384932350282687845" onmouseenter="enter('-2384932350282687845');" onmouseout="out('-2384932350282687845');" style=""> 589             default : {                                                                                  </span>
<span class="880605181182979788" onmouseenter="enter('880605181182979788');" onmouseout="out('880605181182979788');" style=""> 590                 LOG.info(&quot;UART RX JSON packet type &#x27;&quot;+packetType+&quot;&#x27; not understood.&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593     }                                                                                                    </span>
<span  style=""> 594                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 595     @Override                                                                                            </span>
<span class="5766835775206074860" onmouseenter="enter('5766835775206074860');" onmouseout="out('5766835775206074860');" style=""> 596     public boolean onCharacteristicChanged(BluetoothGatt gatt,                                           </span>
<span class="-4605279869462858246" onmouseenter="enter('-4605279869462858246');" onmouseout="out('-4605279869462858246');" style=""> 597                                            BluetoothGattCharacteristic characteristic) {                 </span>
<span class="3568353468682512593" onmouseenter="enter('3568353468682512593');" onmouseout="out('3568353468682512593');" style=""> 598         if (super.onCharacteristicChanged(gatt, characteristic)) {                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 599             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600         }                                                                                                </span>
<span class="5227655087294118325" onmouseenter="enter('5227655087294118325');" onmouseout="out('5227655087294118325');" style=""> 601         if (BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX.equals(characteristic.getUuid())) {     </span>
<span class="5982523523606215133" onmouseenter="enter('5982523523606215133');" onmouseout="out('5982523523606215133');" style=""> 602             byte[] chars = characteristic.getValue();                                                    </span>
<span class="616145045349787748" onmouseenter="enter('616145045349787748');" onmouseout="out('616145045349787748');" style=""> 603             // check to see if we get more data - if so, increase out MTU for sending                    </span>
<span class="-514373143088406372" onmouseenter="enter('-514373143088406372');" onmouseout="out('-514373143088406372');" style=""> 604             if (allowHighMTU &amp;&amp; chars.length &gt; mtuSize)                                                  </span>
<span class="4158896835387507605" onmouseenter="enter('4158896835387507605');" onmouseout="out('4158896835387507605');" style=""> 605                 mtuSize = chars.length;                                                                  </span>
<span class="2539938136572489105" onmouseenter="enter('2539938136572489105');" onmouseout="out('2539938136572489105');" style=""> 606             String packetStr = new String(chars);                                                        </span>
<span class="-8749842360460534491" onmouseenter="enter('-8749842360460534491');" onmouseout="out('-8749842360460534491');" style=""> 607             LOG.info(&quot;RX: &quot; + packetStr);                                                                </span>
<span class="6081730255717431423" onmouseenter="enter('6081730255717431423');" onmouseout="out('6081730255717431423');" style=""> 608             // logging                                                                                   </span>
<span class="-5745508240241304992" onmouseenter="enter('-5745508240241304992');" onmouseout="out('-5745508240241304992');" style=""> 609             receiveHistory += packetStr;                                                                 </span>
<span class="3030748261717732019" onmouseenter="enter('3030748261717732019');" onmouseout="out('3030748261717732019');" style=""> 610             if (receiveHistory.length() &gt; MAX_RECEIVE_HISTORY_CHARS)                                     </span>
<span class="2384681518975537665" onmouseenter="enter('2384681518975537665');" onmouseout="out('2384681518975537665');" style=""><abbr title=" 611                 receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CHARS);"> 611                 receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CðŸ”µ</abbr></span>
<span class="4345605670928647371" onmouseenter="enter('4345605670928647371');" onmouseout="out('4345605670928647371');" style=""> 612             // split into input lines                                                                    </span>
<span class="5259079271083901413" onmouseenter="enter('5259079271083901413');" onmouseout="out('5259079271083901413');" style=""> 613             receivedLine += packetStr;                                                                   </span>
<span class="-2556332053060264516" onmouseenter="enter('-2556332053060264516');" onmouseout="out('-2556332053060264516');" style=""> 614             while (receivedLine.contains(&quot;\n&quot;)) {                                                        </span>
<span class="4579450793956603432" onmouseenter="enter('4579450793956603432');" onmouseout="out('4579450793956603432');" style=""> 615                 int p = receivedLine.indexOf(&quot;\n&quot;);                                                      </span>
<span class="-477187957539062569" onmouseenter="enter('-477187957539062569');" onmouseout="out('-477187957539062569');" style=""> 616                 String line =  receivedLine.substring(0,p-1);                                            </span>
<span class="8894037851537473877" onmouseenter="enter('8894037851537473877');" onmouseout="out('8894037851537473877');" style=""> 617                 receivedLine = receivedLine.substring(p+1);                                              </span>
<span class="-3428869778620909618" onmouseenter="enter('-3428869778620909618');" onmouseout="out('-3428869778620909618');" style=""> 618                 handleUartRxLine(line);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619             }                                                                                            </span>
<span class="-7051609494506194757" onmouseenter="enter('-7051609494506194757');" onmouseout="out('-7051609494506194757');" style=""> 620             // Send an intent with new data                                                              </span>
<span class="-223393600950927979" onmouseenter="enter('-223393600950927979');" onmouseout="out('-223393600950927979');" style=""> 621             Intent intent = new Intent(BangleJSDeviceSupport.BANGLEJS_COMMAND_RX);                       </span>
<span class="-5525767627942220600" onmouseenter="enter('-5525767627942220600');" onmouseout="out('-5525767627942220600');" style=""> 622             intent.putExtra(&quot;DATA&quot;, packetStr);                                                          </span>
<span class="5708963109403024105" onmouseenter="enter('5708963109403024105');" onmouseout="out('5708963109403024105');" style=""> 623             intent.putExtra(&quot;SEQ&quot;, bangleCommandSeq++);                                                  </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 624             LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 626         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627     }                                                                                                    </span>
<span  style=""> 628                                                                                                          </span>
<span  style=""> 629                                                                                                          </span>
<span class="3689734917392452830" onmouseenter="enter('3689734917392452830');" onmouseout="out('3689734917392452830');" style=""> 630     void transmitTime(TransactionBuilder builder) {                                                      </span>
<span class="-580696616137890311" onmouseenter="enter('-580696616137890311');" onmouseout="out('-580696616137890311');" style=""> 631       long ts = System.currentTimeMillis();                                                              </span>
<span class="2966270791537104856" onmouseenter="enter('2966270791537104856');" onmouseout="out('2966270791537104856');" style=""> 632       float tz = SimpleTimeZone.getDefault().getOffset(ts) / (1000 * 60 * 60.0f);                        </span>
<span class="3431964532899256755" onmouseenter="enter('3431964532899256755');" onmouseout="out('3431964532899256755');" style=""> 633       // set time                                                                                        </span>
<span class="-1610279467427834467" onmouseenter="enter('-1610279467427834467');" onmouseout="out('-1610279467427834467');" style=""> 634       String cmd = &quot;\u0010setTime(&quot;+(ts/1000)+&quot;);&quot;;                                                      </span>
<span class="-8332305144616549872" onmouseenter="enter('-8332305144616549872');" onmouseout="out('-8332305144616549872');" style=""> 635       // set timezone                                                                                    </span>
<span class="-5517412366789003339" onmouseenter="enter('-5517412366789003339');" onmouseout="out('-5517412366789003339');" style=""> 636       cmd += &quot;E.setTimeZone(&quot;+tz+&quot;);&quot;;                                                                   </span>
<span class="-1545435846395421943" onmouseenter="enter('-1545435846395421943');" onmouseout="out('-1545435846395421943');" style=""> 637       // write timezone to settings                                                                      </span>
<span class="-5908148183258021619" onmouseenter="enter('-5908148183258021619');" onmouseout="out('-5908148183258021619');" style=""><abbr title=" 638       cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;Storage&#x27;).readJSON(&#x27;setting.json&#x27;,1))&quot;;"> 638       cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;StorageðŸ”µ</abbr></span>
<span class="4089130236590622366" onmouseenter="enter('4089130236590622366');" onmouseout="out('4089130236590622366');" style=""> 639       uartTx(builder, cmd+&quot;\n&quot;);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640     }                                                                                                    </span>
<span  style=""> 641                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 642     @Override                                                                                            </span>
<span class="-5141762163842231173" onmouseenter="enter('-5141762163842231173');" onmouseout="out('-5141762163842231173');" style=""> 643     public boolean useAutoConnect() {                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 644         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645     }                                                                                                    </span>
<span  style=""> 646                                                                                                          </span>
<span class="-8620112809460611919" onmouseenter="enter('-8620112809460611919');" onmouseout="out('-8620112809460611919');" style=""> 647     private String renderUnicodeWordAsImage(String word) {                                               </span>
<span class="9035541491240023486" onmouseenter="enter('9035541491240023486');" onmouseout="out('9035541491240023486');" style=""> 648         // check for emoji                                                                               </span>
<span class="5486434163020554131" onmouseenter="enter('5486434163020554131');" onmouseout="out('5486434163020554131');" style=""> 649         boolean hasEmoji = false;                                                                        </span>
<span class="-4354250430909135512" onmouseenter="enter('-4354250430909135512');" onmouseout="out('-4354250430909135512');" style=""> 650         if (EmojiUtils.getAllEmojis()==null)                                                             </span>
<span class="-4263391647615423897" onmouseenter="enter('-4263391647615423897');" onmouseout="out('-4263391647615423897');" style=""> 651             EmojiManager.initEmojiData(GBApplication.getContext());                                      </span>
<span class="7493806979185135357" onmouseenter="enter('7493806979185135357');" onmouseout="out('7493806979185135357');" style=""> 652         for(Emoji emoji : EmojiUtils.getAllEmojis())                                                     </span>
<span class="-5951281087173806711" onmouseenter="enter('-5951281087173806711');" onmouseout="out('-5951281087173806711');" style=""> 653             if (word.contains(emoji.getEmoji())) hasEmoji = true;                                        </span>
<span class="2890001900011943869" onmouseenter="enter('2890001900011943869');" onmouseout="out('2890001900011943869');" style=""> 654         // if we had emoji, ensure we create 3 bit color (not 1 bit B&amp;W)                                 </span>
<span class="-5597957252839048845" onmouseenter="enter('-5597957252839048845');" onmouseout="out('-5597957252839048845');" style=""><abbr title=" 655         return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : BangleJSBitmapStyle.MONOCHROME);"> 655         return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656     }                                                                                                    </span>
<span  style=""> 657                                                                                                          </span>
<span class="8776024667736839740" onmouseenter="enter('8776024667736839740');" onmouseout="out('8776024667736839740');" style=""> 658     public String renderUnicodeAsImage(String txt) {                                                     </span>
<span class="-1342218611990734243" onmouseenter="enter('-1342218611990734243');" onmouseout="out('-1342218611990734243');" style=""> 659         if (txt==null) return null;                                                                      </span>
<span class="-2990212439896506505" onmouseenter="enter('-2990212439896506505');" onmouseout="out('-2990212439896506505');" style=""> 660         /* If we&#x27;re not doing conversion, pass this right back (we use the EmojiConverter                </span>
<span class="-9019482477548156237" onmouseenter="enter('-9019482477548156237');" onmouseout="out('-9019482477548156237');" style=""> 661         As we would have done if BangleJSCoordinator.supportsUnicodeEmojis had reported false */         </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 662         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));</span>
<span class="6036337086743190632" onmouseenter="enter('6036337086743190632');" onmouseout="out('6036337086743190632');" style=""> 663         if (!devicePrefs.getBoolean(PREF_BANGLEJS_TEXT_BITMAP, false))                                   </span>
<span class="-6218899606023063069" onmouseenter="enter('-6218899606023063069');" onmouseout="out('-6218899606023063069');" style=""> 664             return EmojiConverter.convertUnicodeEmojiToAscii(txt, GBApplication.getContext());           </span>
<span class="292577723455835940" onmouseenter="enter('292577723455835940');" onmouseout="out('292577723455835940');" style=""> 665          // Otherwise split up and check each word                                                       </span>
<span class="-5288421538986521183" onmouseenter="enter('-5288421538986521183');" onmouseout="out('-5288421538986521183');" style=""> 666         String word = &quot;&quot;, result = &quot;&quot;;                                                                   </span>
<span class="-760381533077121579" onmouseenter="enter('-760381533077121579');" onmouseout="out('-760381533077121579');" style=""> 667         boolean needsTranslate = false;                                                                  </span>
<span class="-4776297315441687962" onmouseenter="enter('-4776297315441687962');" onmouseout="out('-4776297315441687962');" style=""> 668         for (int i=0;i&lt;txt.length();i++) {                                                               </span>
<span class="-3301384702044321827" onmouseenter="enter('-3301384702044321827');" onmouseout="out('-3301384702044321827');" style=""> 669             char ch = txt.charAt(i);                                                                     </span>
<span class="-3018677457763070108" onmouseenter="enter('-3018677457763070108');" onmouseout="out('-3018677457763070108');" style=""> 670             if (&quot; -_/:.,?!&#x27;\&quot;&amp;*()&quot;.indexOf(ch)&gt;=0) {                                                     </span>
<span class="1318526908393735015" onmouseenter="enter('1318526908393735015');" onmouseout="out('1318526908393735015');" style=""> 671                 // word split                                                                            </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style=""> 672                 if (needsTranslate) { // convert word                                                    </span>
<span class="-3387652020968698915" onmouseenter="enter('-3387652020968698915');" onmouseout="out('-3387652020968698915');" style=""> 673                     result += renderUnicodeWordAsImage(word)+ch;                                         </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style=""> 674                 } else { // or just copy across                                                          </span>
<span class="1121164921789299019" onmouseenter="enter('1121164921789299019');" onmouseout="out('1121164921789299019');" style=""> 675                     result += word+ch;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676                 }                                                                                        </span>
<span class="4599818924517102902" onmouseenter="enter('4599818924517102902');" onmouseout="out('4599818924517102902');" style=""> 677                 word = &quot;&quot;;                                                                               </span>
<span class="1499680785627976825" onmouseenter="enter('1499680785627976825');" onmouseout="out('1499680785627976825');" style=""> 678                 needsTranslate = false;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 679             } else {                                                                                     </span>
<span class="5371833621916626168" onmouseenter="enter('5371833621916626168');" onmouseout="out('5371833621916626168');" style=""> 680                 // TODO: better check?                                                                   </span>
<span class="-123072587783183541" onmouseenter="enter('-123072587783183541');" onmouseout="out('-123072587783183541');" style=""> 681                 if (ch&lt;0 || ch&gt;255) needsTranslate = true;                                               </span>
<span class="2225265087012361140" onmouseenter="enter('2225265087012361140');" onmouseout="out('2225265087012361140');" style=""> 682                 word += ch;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684         }                                                                                                </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style=""> 685         if (needsTranslate) { // convert word                                                            </span>
<span class="-2531563633600833789" onmouseenter="enter('-2531563633600833789');" onmouseout="out('-2531563633600833789');" style=""> 686             result += renderUnicodeWordAsImage(word);                                                    </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style=""> 687         } else { // or just copy across                                                                  </span>
<span class="-4182205432270767968" onmouseenter="enter('-4182205432270767968');" onmouseout="out('-4182205432270767968');" style=""> 688             result += word;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 690         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691     }                                                                                                    </span>
<span  style=""> 692                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 693     @Override                                                                                            </span>
<span class="-116609517646424186" onmouseenter="enter('-116609517646424186');" onmouseout="out('-116609517646424186');" style=""> 694     public void onNotification(NotificationSpec notificationSpec) {                                      </span>
<span class="7244891213408121655" onmouseenter="enter('7244891213408121655');" onmouseout="out('7244891213408121655');" style=""> 695         for (int i=0;i&lt;notificationSpec.attachedActions.size();i++) {                                    </span>
<span class="-1299099168286401629" onmouseenter="enter('-1299099168286401629');" onmouseout="out('-1299099168286401629');" style=""> 696             NotificationSpec.Action action = notificationSpec.attachedActions.get(i);                    </span>
<span class="1218815619539919953" onmouseenter="enter('1218815619539919953');" onmouseout="out('1218815619539919953');" style=""> 697             if (action.type==NotificationSpec.Action.TYPE_WEARABLE_REPLY)                                </span>
<span class="-2487072541266275253" onmouseenter="enter('-2487072541266275253');" onmouseout="out('-2487072541266275253');" style=""><abbr title=" 698                 mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.getId()&lt;&lt;4) + i + 1)); // wow. This should be easier!"> 698                 mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.gðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 700         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 701             JSONObject o = new JSONObject();                                                             </span>
<span class="-3237033879846899756" onmouseenter="enter('-3237033879846899756');" onmouseout="out('-3237033879846899756');" style=""> 702             o.put(&quot;t&quot;, &quot;notify&quot;);                                                                        </span>
<span class="-2996816801319654727" onmouseenter="enter('-2996816801319654727');" onmouseout="out('-2996816801319654727');" style=""> 703             o.put(&quot;id&quot;, notificationSpec.getId());                                                       </span>
<span class="7446549792523373865" onmouseenter="enter('7446549792523373865');" onmouseout="out('7446549792523373865');" style=""> 704             o.put(&quot;src&quot;, notificationSpec.sourceName);                                                   </span>
<span class="-2496842413615993216" onmouseenter="enter('-2496842413615993216');" onmouseout="out('-2496842413615993216');" style=""> 705             o.put(&quot;title&quot;, renderUnicodeAsImage(notificationSpec.title));                                </span>
<span class="8572918879739705875" onmouseenter="enter('8572918879739705875');" onmouseout="out('8572918879739705875');" style=""> 706             o.put(&quot;subject&quot;, renderUnicodeAsImage(notificationSpec.subject));                            </span>
<span class="-1911849092192349426" onmouseenter="enter('-1911849092192349426');" onmouseout="out('-1911849092192349426');" style=""> 707             o.put(&quot;body&quot;, renderUnicodeAsImage(notificationSpec.body));                                  </span>
<span class="-504952153198563265" onmouseenter="enter('-504952153198563265');" onmouseout="out('-504952153198563265');" style=""> 708             o.put(&quot;sender&quot;, renderUnicodeAsImage(notificationSpec.sender));                              </span>
<span class="-5726859549953031700" onmouseenter="enter('-5726859549953031700');" onmouseout="out('-5726859549953031700');" style=""> 709             o.put(&quot;tel&quot;, notificationSpec.phoneNumber);                                                  </span>
<span class="7885351870399476726" onmouseenter="enter('7885351870399476726');" onmouseout="out('7885351870399476726');" style=""> 710             uartTxJSON(&quot;onNotification&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 711         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 712             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714     }                                                                                                    </span>
<span  style=""> 715                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 716     @Override                                                                                            </span>
<span class="-1102873404195143085" onmouseenter="enter('-1102873404195143085');" onmouseout="out('-1102873404195143085');" style=""> 717     public void onDeleteNotification(int id) {                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 718         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 719             JSONObject o = new JSONObject();                                                             </span>
<span class="8475479069823885977" onmouseenter="enter('8475479069823885977');" onmouseout="out('8475479069823885977');" style=""> 720             o.put(&quot;t&quot;, &quot;notify-&quot;);                                                                       </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 721             o.put(&quot;id&quot;, id);                                                                             </span>
<span class="4156835990201809715" onmouseenter="enter('4156835990201809715');" onmouseout="out('4156835990201809715');" style=""> 722             uartTxJSON(&quot;onDeleteNotification&quot;, o);                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 723         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 724             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 725         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726     }                                                                                                    </span>
<span  style=""> 727                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 728     @Override                                                                                            </span>
<span class="7164248173527032001" onmouseenter="enter('7164248173527032001');" onmouseout="out('7164248173527032001');" style=""> 729     public void onSetTime() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 730         try {                                                                                            </span>
<span class="-5785975329698273515" onmouseenter="enter('-5785975329698273515');" onmouseout="out('-5785975329698273515');" style=""> 731             TransactionBuilder builder = performInitialized(&quot;setTime&quot;);                                  </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 732             transmitTime(builder);                                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 733             builder.queue(getQueue());                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 734         } catch (Exception e) {                                                                          </span>
<span class="5000424150373642922" onmouseenter="enter('5000424150373642922');" onmouseout="out('5000424150373642922');" style=""><abbr title=" 735             GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 735             GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737     }                                                                                                    </span>
<span  style=""> 738                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 739     @Override                                                                                            </span>
<span class="-6473317888357330260" onmouseenter="enter('-6473317888357330260');" onmouseout="out('-6473317888357330260');" style=""> 740     public void onSetAlarms(ArrayList&lt;? extends Alarm&gt; alarms) {                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 741         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 742             JSONObject o = new JSONObject();                                                             </span>
<span class="3488284827981638605" onmouseenter="enter('3488284827981638605');" onmouseout="out('3488284827981638605');" style=""> 743             o.put(&quot;t&quot;, &quot;alarm&quot;);                                                                         </span>
<span class="2586106610260987486" onmouseenter="enter('2586106610260987486');" onmouseout="out('2586106610260987486');" style=""> 744             JSONArray jsonalarms = new JSONArray();                                                      </span>
<span class="7012783305172244346" onmouseenter="enter('7012783305172244346');" onmouseout="out('7012783305172244346');" style=""> 745             o.put(&quot;d&quot;, jsonalarms);                                                                      </span>
<span  style=""> 746                                                                                                          </span>
<span class="-7996805109404385335" onmouseenter="enter('-7996805109404385335');" onmouseout="out('-7996805109404385335');" style=""> 747             for (Alarm alarm : alarms) {                                                                 </span>
<span class="-7206413691565762606" onmouseenter="enter('-7206413691565762606');" onmouseout="out('-7206413691565762606');" style=""> 748                 if (!alarm.getEnabled()) continue;                                                       </span>
<span class="1488433958727864154" onmouseenter="enter('1488433958727864154');" onmouseout="out('1488433958727864154');" style=""> 749                 JSONObject jsonalarm = new JSONObject();                                                 </span>
<span class="-2065505732499951357" onmouseenter="enter('-2065505732499951357');" onmouseout="out('-2065505732499951357');" style=""> 750                 jsonalarms.put(jsonalarm);                                                               </span>
<span  style=""> 751                                                                                                          </span>
<span class="169777398048646112" onmouseenter="enter('169777398048646112');" onmouseout="out('169777398048646112');" style=""> 752                 Calendar calendar = AlarmUtils.toCalendar(alarm);                                        </span>
<span  style=""> 753                                                                                                          </span>
<span class="6578593229745866209" onmouseenter="enter('6578593229745866209');" onmouseout="out('6578593229745866209');" style=""> 754                 jsonalarm.put(&quot;h&quot;, alarm.getHour());                                                     </span>
<span class="7461878622333576123" onmouseenter="enter('7461878622333576123');" onmouseout="out('7461878622333576123');" style=""> 755                 jsonalarm.put(&quot;m&quot;, alarm.getMinute());                                                   </span>
<span class="97057399767477313" onmouseenter="enter('97057399767477313');" onmouseout="out('97057399767477313');" style=""> 756                 jsonalarm.put(&quot;rep&quot;, alarm.getRepetition());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757             }                                                                                            </span>
<span class="7288963480750843606" onmouseenter="enter('7288963480750843606');" onmouseout="out('7288963480750843606');" style=""> 758             uartTxJSON(&quot;onSetAlarms&quot;, o);                                                                </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 759         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 760             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762     }                                                                                                    </span>
<span  style=""> 763                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 764     @Override                                                                                            </span>
<span class="8502851833159229707" onmouseenter="enter('8502851833159229707');" onmouseout="out('8502851833159229707');" style=""> 765     public void onSetCallState(CallSpec callSpec) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 766         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 767             JSONObject o = new JSONObject();                                                             </span>
<span class="4158854171585038558" onmouseenter="enter('4158854171585038558');" onmouseout="out('4158854171585038558');" style=""> 768             o.put(&quot;t&quot;, &quot;call&quot;);                                                                          </span>
<span class="3958892663366704764" onmouseenter="enter('3958892663366704764');" onmouseout="out('3958892663366704764');" style=""> 769             String cmdName = &quot;&quot;;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 770             try {                                                                                        </span>
<span class="-9009466648790586927" onmouseenter="enter('-9009466648790586927');" onmouseout="out('-9009466648790586927');" style=""> 771                 Field fields[] = callSpec.getClass().getDeclaredFields();                                </span>
<span class="-8522204470221494922" onmouseenter="enter('-8522204470221494922');" onmouseout="out('-8522204470221494922');" style=""> 772                 for (Field field : fields)                                                               </span>
<span class="-7797368603385788624" onmouseenter="enter('-7797368603385788624');" onmouseout="out('-7797368603385788624');" style=""><abbr title=" 773                     if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.command)"> 773                     if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.commandðŸ”µ</abbr></span>
<span class="8043037183581644681" onmouseenter="enter('8043037183581644681');" onmouseout="out('8043037183581644681');" style=""> 774                         cmdName = field.getName().substring(5).toLowerCase();                            </span>
<span class="-7581013626583319085" onmouseenter="enter('-7581013626583319085');" onmouseout="out('-7581013626583319085');" style=""> 775             } catch (IllegalAccessException e) {}                                                        </span>
<span class="-1085015235935761185" onmouseenter="enter('-1085015235935761185');" onmouseout="out('-1085015235935761185');" style=""> 776             o.put(&quot;cmd&quot;, cmdName);                                                                       </span>
<span class="8637280962137247636" onmouseenter="enter('8637280962137247636');" onmouseout="out('8637280962137247636');" style=""> 777             o.put(&quot;name&quot;, renderUnicodeAsImage(callSpec.name));                                          </span>
<span class="673690437593128793" onmouseenter="enter('673690437593128793');" onmouseout="out('673690437593128793');" style=""> 778             o.put(&quot;number&quot;, callSpec.number);                                                            </span>
<span class="-6546279892320681741" onmouseenter="enter('-6546279892320681741');" onmouseout="out('-6546279892320681741');" style=""> 779             uartTxJSON(&quot;onSetCallState&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 780         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 781             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783 }                                                                                                        </span>
<span  style=""> 784                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 785     @Override                                                                                            </span>
<span class="8238257195410140286" onmouseenter="enter('8238257195410140286');" onmouseout="out('8238257195410140286');" style=""> 786     public void onSetCannedMessages(CannedMessagesSpec cannedMessagesSpec) {                             </span>
<span  style=""> 787                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 788     }                                                                                                    </span>
<span  style=""> 789                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 790     @Override                                                                                            </span>
<span class="8228188929931998548" onmouseenter="enter('8228188929931998548');" onmouseout="out('8228188929931998548');" style=""> 791     public void onSetMusicState(MusicStateSpec stateSpec) {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 792         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 793             JSONObject o = new JSONObject();                                                             </span>
<span class="-92554745071265211" onmouseenter="enter('-92554745071265211');" onmouseout="out('-92554745071265211');" style=""> 794             o.put(&quot;t&quot;, &quot;musicstate&quot;);                                                                    </span>
<span class="8807632241012571777" onmouseenter="enter('8807632241012571777');" onmouseout="out('8807632241012571777');" style=""> 795             int musicState = stateSpec.state;                                                            </span>
<span class="-8234435338877590300" onmouseenter="enter('-8234435338877590300');" onmouseout="out('-8234435338877590300');" style=""> 796             String[] musicStates = {&quot;play&quot;, &quot;pause&quot;, &quot;stop&quot;, &quot;&quot;};                                        </span>
<span class="-9088398443169884235" onmouseenter="enter('-9088398443169884235');" onmouseout="out('-9088398443169884235');" style=""> 797             if (musicState&lt;0) musicState=3;                                                              </span>
<span class="2321591687835617567" onmouseenter="enter('2321591687835617567');" onmouseout="out('2321591687835617567');" style=""> 798             if (musicState&gt;=musicStates.length) musicState = musicStates.length-1;                       </span>
<span class="-1010325962977709940" onmouseenter="enter('-1010325962977709940');" onmouseout="out('-1010325962977709940');" style=""> 799             o.put(&quot;state&quot;, musicStates[musicState]);                                                     </span>
<span class="4362989328077723220" onmouseenter="enter('4362989328077723220');" onmouseout="out('4362989328077723220');" style=""> 800             o.put(&quot;position&quot;, stateSpec.position);                                                       </span>
<span class="-521013622091952719" onmouseenter="enter('-521013622091952719');" onmouseout="out('-521013622091952719');" style=""> 801             o.put(&quot;shuffle&quot;, stateSpec.shuffle);                                                         </span>
<span class="7992510141527813217" onmouseenter="enter('7992510141527813217');" onmouseout="out('7992510141527813217');" style=""> 802             o.put(&quot;repeat&quot;, stateSpec.repeat);                                                           </span>
<span class="-8798301955703322193" onmouseenter="enter('-8798301955703322193');" onmouseout="out('-8798301955703322193');" style=""> 803             uartTxJSON(&quot;onSetMusicState&quot;, o);                                                            </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 804         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 805             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 806         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807     }                                                                                                    </span>
<span  style=""> 808                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 809     @Override                                                                                            </span>
<span class="-4182706906721092498" onmouseenter="enter('-4182706906721092498');" onmouseout="out('-4182706906721092498');" style=""> 810     public void onSetMusicInfo(MusicSpec musicSpec) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 811         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 812             JSONObject o = new JSONObject();                                                             </span>
<span class="-21742499724689403" onmouseenter="enter('-21742499724689403');" onmouseout="out('-21742499724689403');" style=""> 813             o.put(&quot;t&quot;, &quot;musicinfo&quot;);                                                                     </span>
<span class="-7907833892429297395" onmouseenter="enter('-7907833892429297395');" onmouseout="out('-7907833892429297395');" style=""> 814             o.put(&quot;artist&quot;, renderUnicodeAsImage(musicSpec.artist));                                     </span>
<span class="6485281684850333943" onmouseenter="enter('6485281684850333943');" onmouseout="out('6485281684850333943');" style=""> 815             o.put(&quot;album&quot;, renderUnicodeAsImage(musicSpec.album));                                       </span>
<span class="6434659518035718811" onmouseenter="enter('6434659518035718811');" onmouseout="out('6434659518035718811');" style=""> 816             o.put(&quot;track&quot;, renderUnicodeAsImage(musicSpec.track));                                       </span>
<span class="-6589694811644482139" onmouseenter="enter('-6589694811644482139');" onmouseout="out('-6589694811644482139');" style=""> 817             o.put(&quot;dur&quot;, musicSpec.duration);                                                            </span>
<span class="-5969522677742802968" onmouseenter="enter('-5969522677742802968');" onmouseout="out('-5969522677742802968');" style=""> 818             o.put(&quot;c&quot;, musicSpec.trackCount);                                                            </span>
<span class="7704969334649219354" onmouseenter="enter('7704969334649219354');" onmouseout="out('7704969334649219354');" style=""> 819             o.put(&quot;n&quot;, musicSpec.trackNr);                                                               </span>
<span class="-567994157751048073" onmouseenter="enter('-567994157751048073');" onmouseout="out('-567994157751048073');" style=""> 820             uartTxJSON(&quot;onSetMusicInfo&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 821         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 822             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824     }                                                                                                    </span>
<span  style=""> 825                                                                                                          </span>
<span class="1808047972614051455" onmouseenter="enter('1808047972614051455');" onmouseout="out('1808047972614051455');" style=""> 826     private void transmitActivityStatus() {                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 827         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 828             JSONObject o = new JSONObject();                                                             </span>
<span class="-8158526622976442101" onmouseenter="enter('-8158526622976442101');" onmouseout="out('-8158526622976442101');" style=""> 829             o.put(&quot;t&quot;, &quot;act&quot;);                                                                           </span>
<span class="5593394621505017212" onmouseenter="enter('5593394621505017212');" onmouseout="out('5593394621505017212');" style=""> 830             o.put(&quot;hrm&quot;, realtimeHRM);                                                                   </span>
<span class="9069762361832051811" onmouseenter="enter('9069762361832051811');" onmouseout="out('9069762361832051811');" style=""> 831             o.put(&quot;stp&quot;, realtimeStep);                                                                  </span>
<span class="4361099818971426695" onmouseenter="enter('4361099818971426695');" onmouseout="out('4361099818971426695');" style=""> 832             o.put(&quot;int&quot;, realtimeHRMInterval);                                                           </span>
<span class="-8731247564001223528" onmouseenter="enter('-8731247564001223528');" onmouseout="out('-8731247564001223528');" style=""> 833             uartTxJSON(&quot;onEnableRealtimeSteps&quot;, o);                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 834         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 835             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 836         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837     }                                                                                                    </span>
<span  style=""> 838                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 839     @Override                                                                                            </span>
<span class="-8425797677863799500" onmouseenter="enter('-8425797677863799500');" onmouseout="out('-8425797677863799500');" style=""> 840     public void onEnableRealtimeSteps(boolean enable) {                                                  </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 841         if (enable == realtimeHRM) return;                                                               </span>
<span class="-5879371575258185595" onmouseenter="enter('-5879371575258185595');" onmouseout="out('-5879371575258185595');" style=""> 842         realtimeStep = enable;                                                                           </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 843         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844     }                                                                                                    </span>
<span  style=""> 845                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 846     @Override                                                                                            </span>
<span class="-4135655620136168708" onmouseenter="enter('-4135655620136168708');" onmouseout="out('-4135655620136168708');" style=""> 847     public void onInstallApp(Uri uri) {                                                                  </span>
<span  style=""> 848                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849     }                                                                                                    </span>
<span  style=""> 850                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 851     @Override                                                                                            </span>
<span class="-3322711972275217450" onmouseenter="enter('-3322711972275217450');" onmouseout="out('-3322711972275217450');" style=""> 852     public void onAppInfoReq() {                                                                         </span>
<span  style=""> 853                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 854     }                                                                                                    </span>
<span  style=""> 855                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 856     @Override                                                                                            </span>
<span class="1692097554900603024" onmouseenter="enter('1692097554900603024');" onmouseout="out('1692097554900603024');" style=""> 857     public void onAppStart(UUID uuid, boolean start) {                                                   </span>
<span  style=""> 858                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859     }                                                                                                    </span>
<span  style=""> 860                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 861     @Override                                                                                            </span>
<span class="7633110766708892729" onmouseenter="enter('7633110766708892729');" onmouseout="out('7633110766708892729');" style=""> 862     public void onAppDelete(UUID uuid) {                                                                 </span>
<span  style=""> 863                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864     }                                                                                                    </span>
<span  style=""> 865                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 866     @Override                                                                                            </span>
<span class="2176182926116218619" onmouseenter="enter('2176182926116218619');" onmouseout="out('2176182926116218619');" style=""> 867     public void onAppConfiguration(UUID appUuid, String config, Integer id) {                            </span>
<span  style=""> 868                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869     }                                                                                                    </span>
<span  style=""> 870                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 871     @Override                                                                                            </span>
<span class="-2513514137107402976" onmouseenter="enter('-2513514137107402976');" onmouseout="out('-2513514137107402976');" style=""> 872     public void onAppReorder(UUID[] uuids) {                                                             </span>
<span  style=""> 873                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 874     }                                                                                                    </span>
<span  style=""> 875                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 876     @Override                                                                                            </span>
<span class="3881968248613188942" onmouseenter="enter('3881968248613188942');" onmouseout="out('3881968248613188942');" style=""> 877     public void onFetchRecordedData(int dataTypes) {                                                     </span>
<span class="-3849076454550892314" onmouseenter="enter('-3849076454550892314');" onmouseout="out('-3849076454550892314');" style=""> 878         if (dataTypes == RecordedDataTypes.TYPE_DEBUGLOGS) {                                             </span>
<span class="1579212162814293327" onmouseenter="enter('1579212162814293327');" onmouseout="out('1579212162814293327');" style=""> 879             File dir;                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 880             try {                                                                                        </span>
<span class="-3526927992489947407" onmouseenter="enter('-3526927992489947407');" onmouseout="out('-3526927992489947407');" style=""> 881                 dir = FileUtils.getExternalFilesDir();                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 882             } catch (IOException e) {                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 883                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884             }                                                                                            </span>
<span class="-8623321881845197728" onmouseenter="enter('-8623321881845197728');" onmouseout="out('-8623321881845197728');" style=""> 885             SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd-HHmmss&quot;, Locale.US);            </span>
<span class="-3655538185251554118" onmouseenter="enter('-3655538185251554118');" onmouseout="out('-3655538185251554118');" style=""> 886             String filename = &quot;banglejs_debug_&quot; + dateFormat.format(new Date()) + &quot;.log&quot;;                </span>
<span class="2454422670405906587" onmouseenter="enter('2454422670405906587');" onmouseout="out('2454422670405906587');" style=""> 887             File outputFile = new File(dir, filename );                                                  </span>
<span class="6676810503762950417" onmouseenter="enter('6676810503762950417');" onmouseout="out('6676810503762950417');" style=""> 888             LOG.warn(&quot;Writing log to &quot;+outputFile.toString());                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 889             try {                                                                                        </span>
<span class="-8771066680414961708" onmouseenter="enter('-8771066680414961708');" onmouseout="out('-8771066680414961708');" style=""> 890                 BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile));                  </span>
<span class="4633875208200868523" onmouseenter="enter('4633875208200868523');" onmouseout="out('4633875208200868523');" style=""> 891                 writer.write(receiveHistory);                                                            </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 892                 writer.close();                                                                          </span>
<span class="-3019360337557251714" onmouseenter="enter('-3019360337557251714');" onmouseout="out('-3019360337557251714');" style=""> 893                 receiveHistory = &quot;&quot;;                                                                     </span>
<span class="3582332183058181346" onmouseenter="enter('3582332183058181346');" onmouseout="out('3582332183058181346');" style=""> 894                 GB.toast(getContext(), &quot;Log written to &quot;+filename, Toast.LENGTH_LONG, GB.INFO);          </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 895             } catch (IOException e) {                                                                    </span>
<span class="4694495530853371438" onmouseenter="enter('4694495530853371438');" onmouseout="out('4694495530853371438');" style=""> 896                 LOG.warn(&quot;Could not write to file&quot;, e);                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 897                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 898             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 899         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900     }                                                                                                    </span>
<span  style=""> 901                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 902     @Override                                                                                            </span>
<span class="3589048831688325527" onmouseenter="enter('3589048831688325527');" onmouseout="out('3589048831688325527');" style=""> 903     public void onReset(int flags) {                                                                     </span>
<span  style=""> 904                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 905     }                                                                                                    </span>
<span  style=""> 906                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 907     @Override                                                                                            </span>
<span class="-9008385526233139735" onmouseenter="enter('-9008385526233139735');" onmouseout="out('-9008385526233139735');" style=""> 908     public void onHeartRateTest() {                                                                      </span>
<span  style=""> 909                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 910     }                                                                                                    </span>
<span  style=""> 911                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 912     @Override                                                                                            </span>
<span class="2383065190612615413" onmouseenter="enter('2383065190612615413');" onmouseout="out('2383065190612615413');" style=""> 913     public void onEnableRealtimeHeartRateMeasurement(boolean enable) {                                   </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 914         if (enable == realtimeHRM) return;                                                               </span>
<span class="8804907312000263363" onmouseenter="enter('8804907312000263363');" onmouseout="out('8804907312000263363');" style=""> 915         realtimeHRM = enable;                                                                            </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 916         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 917     }                                                                                                    </span>
<span  style=""> 918                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 919     @Override                                                                                            </span>
<span class="-3287587973518064190" onmouseenter="enter('-3287587973518064190');" onmouseout="out('-3287587973518064190');" style=""> 920     public void onFindDevice(boolean start) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 921         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 922             JSONObject o = new JSONObject();                                                             </span>
<span class="4130381404080081417" onmouseenter="enter('4130381404080081417');" onmouseout="out('4130381404080081417');" style=""> 923             o.put(&quot;t&quot;, &quot;find&quot;);                                                                          </span>
<span class="6818313613707459779" onmouseenter="enter('6818313613707459779');" onmouseout="out('6818313613707459779');" style=""> 924             o.put(&quot;n&quot;, start);                                                                           </span>
<span class="5958886073956724015" onmouseenter="enter('5958886073956724015');" onmouseout="out('5958886073956724015');" style=""> 925             uartTxJSON(&quot;onFindDevice&quot;, o);                                                               </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 926         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 927             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 928         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 929     }                                                                                                    </span>
<span  style=""> 930                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 931     @Override                                                                                            </span>
<span class="-1926054327985162362" onmouseenter="enter('-1926054327985162362');" onmouseout="out('-1926054327985162362');" style=""> 932     public void onSetConstantVibration(int integer) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 933         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 934             JSONObject o = new JSONObject();                                                             </span>
<span class="4547736712460874928" onmouseenter="enter('4547736712460874928');" onmouseout="out('4547736712460874928');" style=""> 935             o.put(&quot;t&quot;, &quot;vibrate&quot;);                                                                       </span>
<span class="-4243820256325497798" onmouseenter="enter('-4243820256325497798');" onmouseout="out('-4243820256325497798');" style=""> 936             o.put(&quot;n&quot;, integer);                                                                         </span>
<span class="-1000088439791572503" onmouseenter="enter('-1000088439791572503');" onmouseout="out('-1000088439791572503');" style=""> 937             uartTxJSON(&quot;onSetConstantVibration&quot;, o);                                                     </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 938         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 939             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 940         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 941     }                                                                                                    </span>
<span  style=""> 942                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 943     @Override                                                                                            </span>
<span class="-3293819866797459784" onmouseenter="enter('-3293819866797459784');" onmouseout="out('-3293819866797459784');" style=""> 944     public void onScreenshotReq() {                                                                      </span>
<span  style=""> 945                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 946     }                                                                                                    </span>
<span  style=""> 947                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 948     @Override                                                                                            </span>
<span class="-2597044235576493624" onmouseenter="enter('-2597044235576493624');" onmouseout="out('-2597044235576493624');" style=""> 949     public void onEnableHeartRateSleepSupport(boolean enable) {                                          </span>
<span  style=""> 950                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951     }                                                                                                    </span>
<span  style=""> 952                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 953     @Override                                                                                            </span>
<span class="-5895120009761092080" onmouseenter="enter('-5895120009761092080');" onmouseout="out('-5895120009761092080');" style=""> 954     public void onSetHeartRateMeasurementInterval(int seconds) {                                         </span>
<span class="-1003654780605811203" onmouseenter="enter('-1003654780605811203');" onmouseout="out('-1003654780605811203');" style=""> 955         realtimeHRMInterval = seconds;                                                                   </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 956         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 957     }                                                                                                    </span>
<span  style=""> 958                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 959     @Override                                                                                            </span>
<span class="-7200644583722212481" onmouseenter="enter('-7200644583722212481');" onmouseout="out('-7200644583722212481');" style=""> 960     public void onAddCalendarEvent(CalendarEventSpec calendarEventSpec) {                                </span>
<span  style=""> 961                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962     }                                                                                                    </span>
<span  style=""> 963                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 964     @Override                                                                                            </span>
<span class="2890386202777848228" onmouseenter="enter('2890386202777848228');" onmouseout="out('2890386202777848228');" style=""> 965     public void onDeleteCalendarEvent(byte type, long id) {                                              </span>
<span  style=""> 966                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 967     }                                                                                                    </span>
<span  style=""> 968                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 969     @Override                                                                                            </span>
<span class="349159621018699769" onmouseenter="enter('349159621018699769');" onmouseout="out('349159621018699769');" style=""> 970     public void onSendConfiguration(String config) {                                                     </span>
<span  style=""> 971                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972     }                                                                                                    </span>
<span  style=""> 973                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 974     @Override                                                                                            </span>
<span class="8707097463436604513" onmouseenter="enter('8707097463436604513');" onmouseout="out('8707097463436604513');" style=""> 975     public void onReadConfiguration(String config) {                                                     </span>
<span  style=""> 976                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 977     }                                                                                                    </span>
<span  style=""> 978                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 979     @Override                                                                                            </span>
<span class="-1180224994468071186" onmouseenter="enter('-1180224994468071186');" onmouseout="out('-1180224994468071186');" style=""> 980     public void onTestNewFunction() {                                                                    </span>
<span  style=""> 981                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 982     }                                                                                                    </span>
<span  style=""> 983                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 984     @Override                                                                                            </span>
<span class="-6167041048283935417" onmouseenter="enter('-6167041048283935417');" onmouseout="out('-6167041048283935417');" style=""> 985     public void onSendWeather(WeatherSpec weatherSpec) {                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 986         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 987             JSONObject o = new JSONObject();                                                             </span>
<span class="501109951395943657" onmouseenter="enter('501109951395943657');" onmouseout="out('501109951395943657');" style=""> 988             o.put(&quot;t&quot;, &quot;weather&quot;);                                                                       </span>
<span class="4560755441777004113" onmouseenter="enter('4560755441777004113');" onmouseout="out('4560755441777004113');" style=""> 989             o.put(&quot;temp&quot;, weatherSpec.currentTemp);                                                      </span>
<span class="7333169967933356383" onmouseenter="enter('7333169967933356383');" onmouseout="out('7333169967933356383');" style=""> 990             o.put(&quot;hum&quot;, weatherSpec.currentHumidity);                                                   </span>
<span class="1899511800679765497" onmouseenter="enter('1899511800679765497');" onmouseout="out('1899511800679765497');" style=""> 991             o.put(&quot;code&quot;, weatherSpec.currentConditionCode);                                             </span>
<span class="-4150178137906864023" onmouseenter="enter('-4150178137906864023');" onmouseout="out('-4150178137906864023');" style=""> 992             o.put(&quot;txt&quot;, weatherSpec.currentCondition);                                                  </span>
<span class="2529521996043109426" onmouseenter="enter('2529521996043109426');" onmouseout="out('2529521996043109426');" style=""> 993             o.put(&quot;wind&quot;, weatherSpec.windSpeed);                                                        </span>
<span class="-3531204280741737459" onmouseenter="enter('-3531204280741737459');" onmouseout="out('-3531204280741737459');" style=""> 994             o.put(&quot;wdir&quot;, weatherSpec.windDirection);                                                    </span>
<span class="-5203705012940108393" onmouseenter="enter('-5203705012940108393');" onmouseout="out('-5203705012940108393');" style=""> 995             o.put(&quot;loc&quot;, weatherSpec.location);                                                          </span>
<span class="-7123085564208723174" onmouseenter="enter('-7123085564208723174');" onmouseout="out('-7123085564208723174');" style=""> 996             uartTxJSON(&quot;onSendWeather&quot;, o);                                                              </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 997         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 998             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 999         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1000     }                                                                                                    </span>
<span  style="">1001                                                                                                          </span>
<span class="-2877595281257014330" onmouseenter="enter('-2877595281257014330');" onmouseout="out('-2877595281257014330');" style="">1002     public Bitmap textToBitmap(String text) {                                                            </span>
<span class="8197355036703912915" onmouseenter="enter('8197355036703912915');" onmouseout="out('8197355036703912915');" style="">1003         Paint paint = new Paint(0); // Paint.ANTI_ALIAS_FLAG not wanted as 1bpp                          </span>
<span class="7051721925152008019" onmouseenter="enter('7051721925152008019');" onmouseout="out('7051721925152008019');" style="">1004         paint.setTextSize(18);                                                                           </span>
<span class="3201120031631468052" onmouseenter="enter('3201120031631468052');" onmouseout="out('3201120031631468052');" style="">1005         paint.setColor(0xFFFFFFFF);                                                                      </span>
<span class="-8656814648822962149" onmouseenter="enter('-8656814648822962149');" onmouseout="out('-8656814648822962149');" style="">1006         paint.setTextAlign(Paint.Align.LEFT);                                                            </span>
<span class="-7872377864782888483" onmouseenter="enter('-7872377864782888483');" onmouseout="out('-7872377864782888483');" style="">1007         float baseline = -paint.ascent(); // ascent() is negative                                        </span>
<span class="-8465374828216379200" onmouseenter="enter('-8465374828216379200');" onmouseout="out('-8465374828216379200');" style="">1008         int width = (int) (paint.measureText(text) + 0.5f); // round                                     </span>
<span class="-3854390456573697081" onmouseenter="enter('-3854390456573697081');" onmouseout="out('-3854390456573697081');" style="">1009         int height = (int) (baseline + paint.descent() + 0.5f);                                          </span>
<span class="2906210495000084590" onmouseenter="enter('2906210495000084590');" onmouseout="out('2906210495000084590');" style="">1010         Bitmap image = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);                      </span>
<span class="-8679273566707466475" onmouseenter="enter('-8679273566707466475');" onmouseout="out('-8679273566707466475');" style="">1011         Canvas canvas = new Canvas(image);                                                               </span>
<span class="-1111517440201709382" onmouseenter="enter('-1111517440201709382');" onmouseout="out('-1111517440201709382');" style="">1012         canvas.drawText(text, 0, baseline, paint);                                                       </span>
<span class="-2663644744327296233" onmouseenter="enter('-2663644744327296233');" onmouseout="out('-2663644744327296233');" style="">1013         return image;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1014     }                                                                                                    </span>
<span  style="">1015                                                                                                          </span>
<span class="7074963208724431146" onmouseenter="enter('7074963208724431146');" onmouseout="out('7074963208724431146');" style="">1016     public enum BangleJSBitmapStyle {                                                                    </span>
<span class="6147896096185822433" onmouseenter="enter('6147896096185822433');" onmouseout="out('6147896096185822433');" style="">1017         MONOCHROME,                                                                                      </span>
<span class="4062182762926863582" onmouseenter="enter('4062182762926863582');" onmouseout="out('4062182762926863582');" style="">1018         RGB_3BPP                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="">1019     };                                                                                                   </span>
<span  style="">1020                                                                                                          </span>
<span class="6301558466408951369" onmouseenter="enter('6301558466408951369');" onmouseout="out('6301558466408951369');" style="">1021     /** Used for writing single bits to an array */                                                      </span>
<span class="819222803118860573" onmouseenter="enter('819222803118860573');" onmouseout="out('819222803118860573');" style="">1022     public static class BitWriter {                                                                      </span>
<span class="114498312668931576" onmouseenter="enter('114498312668931576');" onmouseout="out('114498312668931576');" style="">1023         int n;                                                                                           </span>
<span class="2627896913916265726" onmouseenter="enter('2627896913916265726');" onmouseout="out('2627896913916265726');" style="">1024         byte[] bits;                                                                                     </span>
<span class="1763732906692125975" onmouseenter="enter('1763732906692125975');" onmouseout="out('1763732906692125975');" style="">1025         int currentByte, bitIdx;                                                                         </span>
<span  style="">1026                                                                                                          </span>
<span class="4387590414863300883" onmouseenter="enter('4387590414863300883');" onmouseout="out('4387590414863300883');" style="">1027         public BitWriter(byte[] array, int offset) {                                                     </span>
<span class="-2669551821059816380" onmouseenter="enter('-2669551821059816380');" onmouseout="out('-2669551821059816380');" style="">1028             bits = array;                                                                                </span>
<span class="8043804227758168612" onmouseenter="enter('8043804227758168612');" onmouseout="out('8043804227758168612');" style="">1029             n = offset;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1030         }                                                                                                </span>
<span  style="">1031                                                                                                          </span>
<span class="3787308675999271388" onmouseenter="enter('3787308675999271388');" onmouseout="out('3787308675999271388');" style="">1032         public void push(boolean v) {                                                                    </span>
<span class="-3502051617447471385" onmouseenter="enter('-3502051617447471385');" onmouseout="out('-3502051617447471385');" style="">1033             currentByte = (currentByte &lt;&lt; 1) | (v?1:0);                                                  </span>
<span class="-9185751609333789697" onmouseenter="enter('-9185751609333789697');" onmouseout="out('-9185751609333789697');" style="">1034             bitIdx++;                                                                                    </span>
<span class="-4190492491002713547" onmouseenter="enter('-4190492491002713547');" onmouseout="out('-4190492491002713547');" style="">1035             if (bitIdx == 8) {                                                                           </span>
<span class="6079776424871100267" onmouseenter="enter('6079776424871100267');" onmouseout="out('6079776424871100267');" style="">1036                 bits[n++] = (byte)currentByte;                                                           </span>
<span class="7441701714119310800" onmouseenter="enter('7441701714119310800');" onmouseout="out('7441701714119310800');" style="">1037                 bitIdx = 0;                                                                              </span>
<span class="-6334189767708640910" onmouseenter="enter('-6334189767708640910');" onmouseout="out('-6334189767708640910');" style="">1038                 currentByte = 0;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1039             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1040         }                                                                                                </span>
<span  style="">1041                                                                                                          </span>
<span class="-6819029797264174065" onmouseenter="enter('-6819029797264174065');" onmouseout="out('-6819029797264174065');" style="">1042         public void finish() {                                                                           </span>
<span class="-7024656867771236134" onmouseenter="enter('-7024656867771236134');" onmouseout="out('-7024656867771236134');" style="">1043             if (bitIdx &gt; 0) bits[n++] = (byte)currentByte;                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1044         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1045     }                                                                                                    </span>
<span  style="">1046                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1047     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1048      * Currently only 1bpp, no scaling */                                                                </span>
<span class="7395401196912084921" onmouseenter="enter('7395401196912084921');" onmouseout="out('7395401196912084921');" style="">1049     public static byte[] bitmapToEspruinoArray(Bitmap bitmap, BangleJSBitmapStyle style) {               </span>
<span class="-8264578209241474849" onmouseenter="enter('-8264578209241474849');" onmouseout="out('-8264578209241474849');" style="">1050         int width = bitmap.getWidth();                                                                   </span>
<span class="579214017182008882" onmouseenter="enter('579214017182008882');" onmouseout="out('579214017182008882');" style="">1051         int height = bitmap.getHeight();                                                                 </span>
<span class="62095710955205844" onmouseenter="enter('62095710955205844');" onmouseout="out('62095710955205844');" style="">1052         int bpp = (style==BangleJSBitmapStyle.RGB_3BPP) ? 3 : 1;                                         </span>
<span class="2569753333792437088" onmouseenter="enter('2569753333792437088');" onmouseout="out('2569753333792437088');" style="">1053         byte pixels[] = new byte[width * height];                                                        </span>
<span class="-8781894220114795181" onmouseenter="enter('-8781894220114795181');" onmouseout="out('-8781894220114795181');" style="">1054         final byte PIXELCOL_TRANSPARENT = -1;                                                            </span>
<span class="6803383238845196993" onmouseenter="enter('6803383238845196993');" onmouseout="out('6803383238845196993');" style="">1055         final int ditherMatrix[] = {1*16,5*16,7*16,3*16}; // for bayer dithering                         </span>
<span class="7959981185777845703" onmouseenter="enter('7959981185777845703');" onmouseout="out('7959981185777845703');" style="">1056         // if doing 3bpp, check image to see if it&#x27;s transparent                                         </span>
<span class="2206517053249792991" onmouseenter="enter('2206517053249792991');" onmouseout="out('2206517053249792991');" style="">1057         boolean allowTransparency = (style != BangleJSBitmapStyle.MONOCHROME);                           </span>
<span class="-37573379981503148" onmouseenter="enter('-37573379981503148');" onmouseout="out('-37573379981503148');" style="">1058         boolean isTransparent = false;                                                                   </span>
<span class="7994078972417264550" onmouseenter="enter('7994078972417264550');" onmouseout="out('7994078972417264550');" style="">1059         byte transparentColorIndex = 0;                                                                  </span>
<span class="4545384496906809483" onmouseenter="enter('4545384496906809483');" onmouseout="out('4545384496906809483');" style="">1060         /* Work out what colour index each pixel should be and write to pixels.                          </span>
<span class="-816286840416722331" onmouseenter="enter('-816286840416722331');" onmouseout="out('-816286840416722331');" style="">1061          Also figure out if we&#x27;re transparent at all, and how often each color is used */                </span>
<span class="-3015935700404012624" onmouseenter="enter('-3015935700404012624');" onmouseout="out('-3015935700404012624');" style="">1062         int colUsage[] = new int[8];                                                                     </span>
<span class="-1168375646381031328" onmouseenter="enter('-1168375646381031328');" onmouseout="out('-1168375646381031328');" style="">1063         int n = 0;                                                                                       </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1064         for (int y = 0; y &lt; height; y++) {                                                               </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1065             for (int x = 0; x &lt; width; x++) {                                                            </span>
<span class="-2101137108834168285" onmouseenter="enter('-2101137108834168285');" onmouseout="out('-2101137108834168285');" style="">1066                 int pixel = bitmap.getPixel(x, y);                                                       </span>
<span class="-7873265173430592100" onmouseenter="enter('-7873265173430592100');" onmouseout="out('-7873265173430592100');" style="">1067                 int r = pixel &amp; 255;                                                                     </span>
<span class="5214305336064064060" onmouseenter="enter('5214305336064064060');" onmouseout="out('5214305336064064060');" style="">1068                 int g = (pixel &gt;&gt; 8) &amp; 255;                                                              </span>
<span class="-8611762025314058231" onmouseenter="enter('-8611762025314058231');" onmouseout="out('-8611762025314058231');" style="">1069                 int b = (pixel &gt;&gt; 16) &amp; 255;                                                             </span>
<span class="4540615999107180416" onmouseenter="enter('4540615999107180416');" onmouseout="out('4540615999107180416');" style="">1070                 int a = (pixel &gt;&gt; 24) &amp; 255;                                                             </span>
<span class="-7690440557473777446" onmouseenter="enter('-7690440557473777446');" onmouseout="out('-7690440557473777446');" style="">1071                 boolean pixelTransparent = allowTransparency &amp;&amp; (a &lt; 128);                               </span>
<span class="8857737978256656560" onmouseenter="enter('8857737978256656560');" onmouseout="out('8857737978256656560');" style="">1072                 if (pixelTransparent) {                                                                  </span>
<span class="4144053758920166277" onmouseenter="enter('4144053758920166277');" onmouseout="out('4144053758920166277');" style="">1073                     isTransparent = true;                                                                </span>
<span class="-1483564027931343691" onmouseenter="enter('-1483564027931343691');" onmouseout="out('-1483564027931343691');" style="">1074                     r = g = b = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1075                 }                                                                                        </span>
<span class="7892385962647882401" onmouseenter="enter('7892385962647882401');" onmouseout="out('7892385962647882401');" style="">1076                 // do dithering here                                                                     </span>
<span class="-1753549363475258451" onmouseenter="enter('-1753549363475258451');" onmouseout="out('-1753549363475258451');" style="">1077                 int ditherAmt = ditherMatrix[(x&amp;1) + (y&amp;1)*2];                                           </span>
<span class="-5333286516522955764" onmouseenter="enter('-5333286516522955764');" onmouseout="out('-5333286516522955764');" style="">1078                 r += ditherAmt;                                                                          </span>
<span class="-3777395832470098990" onmouseenter="enter('-3777395832470098990');" onmouseout="out('-3777395832470098990');" style="">1079                 g += ditherAmt;                                                                          </span>
<span class="-5891859440152819561" onmouseenter="enter('-5891859440152819561');" onmouseout="out('-5891859440152819561');" style="">1080                 b += ditherAmt;                                                                          </span>
<span class="1554400584909279790" onmouseenter="enter('1554400584909279790');" onmouseout="out('1554400584909279790');" style="">1081                 int col = 0;                                                                             </span>
<span class="418637413535106488" onmouseenter="enter('418637413535106488');" onmouseout="out('418637413535106488');" style="">1082                 if (style == BangleJSBitmapStyle.MONOCHROME)                                             </span>
<span class="7187319285928422906" onmouseenter="enter('7187319285928422906');" onmouseout="out('7187319285928422906');" style="">1083                     col = ((r+g+b) &gt;= 768)?1:0;                                                          </span>
<span class="-9158255213257007445" onmouseenter="enter('-9158255213257007445');" onmouseout="out('-9158255213257007445');" style="">1084                 else if (style == BangleJSBitmapStyle.RGB_3BPP)                                          </span>
<span class="6807772790369921462" onmouseenter="enter('6807772790369921462');" onmouseout="out('6807772790369921462');" style="">1085                     col = ((r&gt;=256)?1:0) | ((g&gt;=256)?2:0) | ((b&gt;=256)?4:0);                              </span>
<span class="-8103715039558456046" onmouseenter="enter('-8103715039558456046');" onmouseout="out('-8103715039558456046');" style="">1086                 if (!pixelTransparent) colUsage[col]++; // if not transparent, record usage              </span>
<span class="4219755117683718437" onmouseenter="enter('4219755117683718437');" onmouseout="out('4219755117683718437');" style="">1087                 // save colour, mark transparent separately                                              </span>
<span class="9129530588794156450" onmouseenter="enter('9129530588794156450');" onmouseout="out('9129530588794156450');" style="">1088                 pixels[n++] = (byte)(pixelTransparent ? PIXELCOL_TRANSPARENT : col);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1089             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1090         }                                                                                                </span>
<span class="-7238986996251945663" onmouseenter="enter('-7238986996251945663');" onmouseout="out('-7238986996251945663');" style="">1091         // if we&#x27;re transparent, find the least-used color, and use that for transparency                </span>
<span class="-3011917059987129784" onmouseenter="enter('-3011917059987129784');" onmouseout="out('-3011917059987129784');" style="">1092         if (isTransparent) {                                                                             </span>
<span class="-8837844203179481085" onmouseenter="enter('-8837844203179481085');" onmouseout="out('-8837844203179481085');" style="">1093             // find least used                                                                           </span>
<span class="-2156609844502175267" onmouseenter="enter('-2156609844502175267');" onmouseout="out('-2156609844502175267');" style="">1094             int minColUsage = -1;                                                                        </span>
<span class="-722001860546824180" onmouseenter="enter('-722001860546824180');" onmouseout="out('-722001860546824180');" style="">1095             for (int c=0;c&lt;8;c++) {                                                                      </span>
<span class="4418845972840093199" onmouseenter="enter('4418845972840093199');" onmouseout="out('4418845972840093199');" style="">1096                 if (minColUsage&lt;0 || colUsage[c]&lt;minColUsage) {                                          </span>
<span class="5318194882336838338" onmouseenter="enter('5318194882336838338');" onmouseout="out('5318194882336838338');" style="">1097                     minColUsage = colUsage[c];                                                           </span>
<span class="1332179475621902578" onmouseenter="enter('1332179475621902578');" onmouseout="out('1332179475621902578');" style="">1098                     transparentColorIndex = (byte)c;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1099                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1100             }                                                                                            </span>
<span class="-6360425578627405201" onmouseenter="enter('-6360425578627405201');" onmouseout="out('-6360425578627405201');" style="">1101             // rewrite any transparent pixels as the correct color for transparency                      </span>
<span class="-6081737035071239023" onmouseenter="enter('-6081737035071239023');" onmouseout="out('-6081737035071239023');" style="">1102             for (n=0;n&lt;pixels.length;n++)                                                                </span>
<span class="-5898303404019142000" onmouseenter="enter('-5898303404019142000');" onmouseout="out('-5898303404019142000');" style="">1103                 if (pixels[n]==PIXELCOL_TRANSPARENT)                                                     </span>
<span class="2866860587696074876" onmouseenter="enter('2866860587696074876');" onmouseout="out('2866860587696074876');" style="">1104                     pixels[n] = transparentColorIndex;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1105         }                                                                                                </span>
<span class="2745980283769036105" onmouseenter="enter('2745980283769036105');" onmouseout="out('2745980283769036105');" style="">1106         // Write the header                                                                              </span>
<span class="-1351042579972959800" onmouseenter="enter('-1351042579972959800');" onmouseout="out('-1351042579972959800');" style="">1107         int headerLen = isTransparent ? 4 : 3;                                                           </span>
<span class="-1842770092995408603" onmouseenter="enter('-1842770092995408603');" onmouseout="out('-1842770092995408603');" style="">1108         byte bmp[] = new byte[(((height * width * bpp) + 7) &gt;&gt; 3) + headerLen];                          </span>
<span class="-2931355111361492552" onmouseenter="enter('-2931355111361492552');" onmouseout="out('-2931355111361492552');" style="">1109         bmp[0] = (byte)width;                                                                            </span>
<span class="7001926567865572655" onmouseenter="enter('7001926567865572655');" onmouseout="out('7001926567865572655');" style="">1110         bmp[1] = (byte)height;                                                                           </span>
<span class="-237013155551245034" onmouseenter="enter('-237013155551245034');" onmouseout="out('-237013155551245034');" style="">1111         bmp[2] = (byte)(bpp + (isTransparent?128:0));                                                    </span>
<span class="6762716390198046926" onmouseenter="enter('6762716390198046926');" onmouseout="out('6762716390198046926');" style="">1112         if (isTransparent) bmp[3] = transparentColorIndex;                                               </span>
<span class="8478354166162352997" onmouseenter="enter('8478354166162352997');" onmouseout="out('8478354166162352997');" style="">1113         // Now write the image out bit by bit                                                            </span>
<span class="344926378213754405" onmouseenter="enter('344926378213754405');" onmouseout="out('344926378213754405');" style="">1114         BitWriter bits = new BitWriter(bmp, headerLen);                                                  </span>
<span class="-3260558023763679626" onmouseenter="enter('-3260558023763679626');" onmouseout="out('-3260558023763679626');" style="">1115         n = 0;                                                                                           </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1116         for (int y = 0; y &lt; height; y++) {                                                               </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1117             for (int x = 0; x &lt; width; x++) {                                                            </span>
<span class="593941254526452666" onmouseenter="enter('593941254526452666');" onmouseout="out('593941254526452666');" style="">1118                 int pixel = pixels[n++];                                                                 </span>
<span class="-1551860236924517479" onmouseenter="enter('-1551860236924517479');" onmouseout="out('-1551860236924517479');" style="">1119                 for (int b=bpp-1;b&gt;=0;b--)                                                               </span>
<span class="-5304162960169081882" onmouseenter="enter('-5304162960169081882');" onmouseout="out('-5304162960169081882');" style="">1120                     bits.push(((pixel&gt;&gt;b)&amp;1) != 0);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1121             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1122         }                                                                                                </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1123         return bmp;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1124     }                                                                                                    </span>
<span  style="">1125                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1126     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1127      * Currently only 1bpp, no scaling */                                                                </span>
<span class="8132909775831713515" onmouseenter="enter('8132909775831713515');" onmouseout="out('8132909775831713515');" style="">1128     public static String bitmapToEspruinoString(Bitmap bitmap, BangleJSBitmapStyle style) {              </span>
<span class="-259762080887441901" onmouseenter="enter('-259762080887441901');" onmouseout="out('-259762080887441901');" style="">1129         return new String(bitmapToEspruinoArray(bitmap, style), StandardCharsets.ISO_8859_1);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1130     }                                                                                                    </span>
<span  style="">1131                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1132     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1133      * Currently only 1bpp, no scaling */                                                                </span>
<span class="3005879465184206786" onmouseenter="enter('3005879465184206786');" onmouseout="out('3005879465184206786');" style="">1134     public static String bitmapToEspruinoBase64(Bitmap bitmap, BangleJSBitmapStyle style) {              </span>
<span class="-5699216721301532414" onmouseenter="enter('-5699216721301532414');" onmouseout="out('-5699216721301532414');" style=""><abbr title="1135         return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\n&quot;,&quot;&quot;);">1135         return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\nðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1136     }                                                                                                    </span>
<span  style="">1137                                                                                                          </span>
<span class="-3553936365177536696" onmouseenter="enter('-3553936365177536696');" onmouseout="out('-3553936365177536696');" style="">1138     /** Convert a drawable to a bitmap, for use with bitmapToEspruino */                                 </span>
<span class="3383127324214077694" onmouseenter="enter('3383127324214077694');" onmouseout="out('3383127324214077694');" style="">1139     public static Bitmap drawableToBitmap(Drawable drawable) {                                           </span>
<span class="5888468731770076773" onmouseenter="enter('5888468731770076773');" onmouseout="out('5888468731770076773');" style="">1140         final int maxWidth = 32;                                                                         </span>
<span class="1045468429082287724" onmouseenter="enter('1045468429082287724');" onmouseout="out('1045468429082287724');" style="">1141         final int maxHeight = 32;                                                                        </span>
<span class="2296952793490653309" onmouseenter="enter('2296952793490653309');" onmouseout="out('2296952793490653309');" style="">1142         /* Return bitmap directly but only if it&#x27;s small enough. It could be                             </span>
<span class="5951543220377437420" onmouseenter="enter('5951543220377437420');" onmouseout="out('5951543220377437420');" style="">1143         we have a bitmap but it&#x27;s just too big to send direct to the bangle */                           </span>
<span class="256873417632096091" onmouseenter="enter('256873417632096091');" onmouseout="out('256873417632096091');" style="">1144         if (drawable instanceof BitmapDrawable) {                                                        </span>
<span class="-5943336945219947575" onmouseenter="enter('-5943336945219947575');" onmouseout="out('-5943336945219947575');" style="">1145             BitmapDrawable bitmapDrawable = (BitmapDrawable) drawable;                                   </span>
<span class="3248690101517469022" onmouseenter="enter('3248690101517469022');" onmouseout="out('3248690101517469022');" style="">1146             Bitmap bmp = bitmapDrawable.getBitmap();                                                     </span>
<span class="-7540961171633243123" onmouseenter="enter('-7540961171633243123');" onmouseout="out('-7540961171633243123');" style="">1147             if (bmp != null &amp;&amp; bmp.getWidth()&lt;=maxWidth &amp;&amp; bmp.getHeight()&lt;=maxHeight)                   </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1148                 return bmp;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1149         }                                                                                                </span>
<span class="-1267243917470848355" onmouseenter="enter('-1267243917470848355');" onmouseout="out('-1267243917470848355');" style="">1150         /* Otherwise render this to a bitmap ourselves.. work out size */                                </span>
<span class="4014031002419706861" onmouseenter="enter('4014031002419706861');" onmouseout="out('4014031002419706861');" style="">1151         int w = maxWidth;                                                                                </span>
<span class="7839465956667040099" onmouseenter="enter('7839465956667040099');" onmouseout="out('7839465956667040099');" style="">1152         int h = maxHeight;                                                                               </span>
<span class="-8364515267334494119" onmouseenter="enter('-8364515267334494119');" onmouseout="out('-8364515267334494119');" style="">1153         if (drawable.getIntrinsicWidth() &gt; 0 &amp;&amp; drawable.getIntrinsicHeight() &gt; 0) {                     </span>
<span class="7888521624075720743" onmouseenter="enter('7888521624075720743');" onmouseout="out('7888521624075720743');" style="">1154             w = drawable.getIntrinsicWidth();                                                            </span>
<span class="-8527253388982325533" onmouseenter="enter('-8527253388982325533');" onmouseout="out('-8527253388982325533');" style="">1155             h = drawable.getIntrinsicHeight();                                                           </span>
<span class="1937935127293972578" onmouseenter="enter('1937935127293972578');" onmouseout="out('1937935127293972578');" style="">1156             // don&#x27;t allocate anything too big, but keep the ratio                                       </span>
<span class="-3040808582930904343" onmouseenter="enter('-3040808582930904343');" onmouseout="out('-3040808582930904343');" style="">1157             if (w&gt;maxWidth) {                                                                            </span>
<span class="3961818778152175494" onmouseenter="enter('3961818778152175494');" onmouseout="out('3961818778152175494');" style="">1158                 h = h * maxWidth / w;                                                                    </span>
<span class="-810617720622075293" onmouseenter="enter('-810617720622075293');" onmouseout="out('-810617720622075293');" style="">1159                 w = maxWidth;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1160             }                                                                                            </span>
<span class="-8361662207911676693" onmouseenter="enter('-8361662207911676693');" onmouseout="out('-8361662207911676693');" style="">1161             if (h&gt;maxHeight) {                                                                           </span>
<span class="-4098427333168952513" onmouseenter="enter('-4098427333168952513');" onmouseout="out('-4098427333168952513');" style="">1162                 w = w * maxHeight / h;                                                                   </span>
<span class="3192577241527884586" onmouseenter="enter('3192577241527884586');" onmouseout="out('3192577241527884586');" style="">1163                 h = maxHeight;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1164             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1165         }                                                                                                </span>
<span class="5796017605604363662" onmouseenter="enter('5796017605604363662');" onmouseout="out('5796017605604363662');" style="">1166         /* render */                                                                                     </span>
<span class="2390903888286128230" onmouseenter="enter('2390903888286128230');" onmouseout="out('2390903888286128230');" style=""><abbr title="1167         Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will be created of 1x1 pixel">1167         Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will bðŸ”µ</abbr></span>
<span class="-8462009662057840967" onmouseenter="enter('-8462009662057840967');" onmouseout="out('-8462009662057840967');" style="">1168         Canvas canvas = new Canvas(bitmap);                                                              </span>
<span class="8202941983594652957" onmouseenter="enter('8202941983594652957');" onmouseout="out('8202941983594652957');" style="">1169         drawable.setBounds(0, 0, canvas.getWidth(), canvas.getHeight());                                 </span>
<span class="-8639362966527052788" onmouseenter="enter('-8639362966527052788');" onmouseout="out('-8639362966527052788');" style="">1170         drawable.draw(canvas);                                                                           </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style="">1171         return bitmap;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1172     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1173 }                                                                                                        </span>





















































































































</pre></td>
                            <td><pre><span class="7867943778411854368" onmouseenter="enter('7867943778411854368');" onmouseout="out('7867943778411854368');" style="">   1 /*  Copyright (C) 2019-2021 Andreas Shimokawa, Gordon Williams                                           </span>
<span  style="">   2                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8     (at your option) any later version.                                                                  </span>
<span  style="">   9                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  14                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="-588248541382154970" onmouseenter="enter('-588248541382154970');" onmouseout="out('-588248541382154970');" style="">  17 package nodomain.freeyourgadget.gadgetbridge.service.devices.banglejs;                                   </span>
<span  style="">  18                                                                                                          </span>
<span class="2440823415412133066" onmouseenter="enter('2440823415412133066');" onmouseout="out('2440823415412133066');" style="">  19 import android.bluetooth.BluetoothGatt;                                                                  </span>
<span class="4736969144974683041" onmouseenter="enter('4736969144974683041');" onmouseout="out('4736969144974683041');" style="">  20 import android.bluetooth.BluetoothGattCharacteristic;                                                    </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  21 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  22 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  23 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  24 import android.content.IntentFilter;                                                                     </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  25 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  26 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  27 import android.graphics.Canvas;                                                                          </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  28 import android.graphics.Paint;                                                                           </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  29 import android.graphics.drawable.BitmapDrawable;                                                         </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  30 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="">  31 import android.net.Uri;                                                                                  </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  32 import android.util.Base64;                                                                              </span>
<span class="-4373317539211938720" onmouseenter="enter('-4373317539211938720');" onmouseout="out('-4373317539211938720');" style="">  33 import android.widget.Toast;                                                                             </span>
<span  style="">  34                                                                                                          </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  35 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span  style="">  36                                                                                                          </span>
<span class="3171981379522900271" onmouseenter="enter('3171981379522900271');" onmouseout="out('3171981379522900271');" style="">  37 import com.android.volley.Request;                                                                       </span>
<span class="4430867795468484324" onmouseenter="enter('4430867795468484324');" onmouseout="out('4430867795468484324');" style="">  38 import com.android.volley.Response;                                                                      </span>
<span class="-6875921712592050045" onmouseenter="enter('-6875921712592050045');" onmouseout="out('-6875921712592050045');" style="">  39 import com.android.volley.RequestQueue;                                                                  </span>
<span class="7596528640051210243" onmouseenter="enter('7596528640051210243');" onmouseout="out('7596528640051210243');" style="">  40 import com.android.volley.VolleyError;                                                                   </span>
<span class="-6338542844679972782" onmouseenter="enter('-6338542844679972782');" onmouseout="out('-6338542844679972782');" style="">  41 import com.android.volley.toolbox.StringRequest;                                                         </span>
<span class="4822020902022089151" onmouseenter="enter('4822020902022089151');" onmouseout="out('4822020902022089151');" style="">  42 import com.android.volley.toolbox.Volley;                                                                </span>
<span  style="">  43                                                                                                          </span>
<span class="-9193129351684262878" onmouseenter="enter('-9193129351684262878');" onmouseout="out('-9193129351684262878');" style="">  44 import org.json.JSONArray;                                                                               </span>
<span class="-8573375701834280359" onmouseenter="enter('-8573375701834280359');" onmouseout="out('-8573375701834280359');" style="">  45 import org.json.JSONException;                                                                           </span>
<span class="7232075261178918144" onmouseenter="enter('7232075261178918144');" onmouseout="out('7232075261178918144');" style="">  46 import org.json.JSONObject;                                                                              </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  47 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  48 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="-2051516048009622280" onmouseenter="enter('-2051516048009622280');" onmouseout="out('-2051516048009622280');" style="">  49 import org.xml.sax.InputSource;                                                                          </span>
<span  style="">  50                                                                                                          </span>
<span class="-6983162919371453239" onmouseenter="enter('-6983162919371453239');" onmouseout="out('-6983162919371453239');" style="">  51 import java.io.BufferedWriter;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  52 import java.io.File;                                                                                     </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  53 import java.io.FileOutputStream;                                                                         </span>
<span class="4914725365521379617" onmouseenter="enter('4914725365521379617');" onmouseout="out('4914725365521379617');" style="">  54 import java.io.FileWriter;                                                                               </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  55 import java.io.IOException;                                                                              </span>
<span class="4087034682117787535" onmouseenter="enter('4087034682117787535');" onmouseout="out('4087034682117787535');" style="">  56 import java.io.StringReader;                                                                             </span>
<span class="-2624565711555737384" onmouseenter="enter('-2624565711555737384');" onmouseout="out('-2624565711555737384');" style="">  57 import java.nio.charset.StandardCharsets;                                                                </span>
<span class="54331962280914690" onmouseenter="enter('54331962280914690');" onmouseout="out('54331962280914690');" style="">  58 import java.text.SimpleDateFormat;                                                                       </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  59 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  60 import java.util.Calendar;                                                                               </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  61 import java.util.Date;                                                                                   </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  62 import java.util.GregorianCalendar;                                                                      </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  63 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  64 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  65 import java.util.List;                                                                                   </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  66 import java.util.Locale;                                                                                 </span>
<span class="8860446888132102879" onmouseenter="enter('8860446888132102879');" onmouseout="out('8860446888132102879');" style="">  67 import java.util.SimpleTimeZone;                                                                         </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  68 import java.util.UUID;                                                                                   </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  69 import java.lang.reflect.Field;                                                                          </span>
<span  style="">  70                                                                                                          </span>
<span class="-3163672285055708144" onmouseenter="enter('-3163672285055708144');" onmouseout="out('-3163672285055708144');" style="">  71 import io.wax911.emojify.Emoji;                                                                          </span>
<span class="6994093753897510849" onmouseenter="enter('6994093753897510849');" onmouseout="out('6994093753897510849');" style="">  72 import io.wax911.emojify.EmojiManager;                                                                   </span>
<span class="-2985037039232163872" onmouseenter="enter('-2985037039232163872');" onmouseout="out('-2985037039232163872');" style="">  73 import io.wax911.emojify.EmojiUtils;                                                                     </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  74 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  75 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  76 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="-141107564105590930" onmouseenter="enter('-141107564105590930');" onmouseout="out('-141107564105590930');" style="">  77 import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst;     </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  78 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  79 import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                           </span>
<span class="-3005335786085073829" onmouseenter="enter('-3005335786085073829');" onmouseout="out('-3005335786085073829');" style="">  80 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventBatteryInfo;                       </span>
<span class="7017557905176594961" onmouseenter="enter('7017557905176594961');" onmouseout="out('7017557905176594961');" style="">  81 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventCallControl;                       </span>
<span class="6368471362458763033" onmouseenter="enter('6368471362458763033');" onmouseout="out('6368471362458763033');" style="">  82 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventFindPhone;                         </span>
<span class="4012861689788039008" onmouseenter="enter('4012861689788039008');" onmouseout="out('4012861689788039008');" style="">  83 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventMusicControl;                      </span>
<span class="-5203005511074004401" onmouseenter="enter('-5203005511074004401');" onmouseout="out('-5203005511074004401');" style="">  84 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventNotificationControl;               </span>
<span class="4252572397761323695" onmouseenter="enter('4252572397761323695');" onmouseout="out('4252572397761323695');" style="">  85 import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSConstants;                          </span>
<span class="8687478736174414119" onmouseenter="enter('8687478736174414119');" onmouseout="out('8687478736174414119');" style="">  86 import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSSampleProvider;                     </span>
<span class="-7483974346858162294" onmouseenter="enter('-7483974346858162294');" onmouseout="out('-7483974346858162294');" style="">  87 import nodomain.freeyourgadget.gadgetbridge.devices.qhybrid.NotificationConfiguration;                   </span>
<span class="8046368326334810504" onmouseenter="enter('8046368326334810504');" onmouseout="out('8046368326334810504');" style="">  88 import nodomain.freeyourgadget.gadgetbridge.entities.BangleJSActivitySample;                             </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  89 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                               </span>
<span class="5185434099904652174" onmouseenter="enter('5185434099904652174');" onmouseout="out('5185434099904652174');" style="">  90 import nodomain.freeyourgadget.gadgetbridge.model.ActivityKind;                                          </span>
<span class="-8766238562391910018" onmouseenter="enter('-8766238562391910018');" onmouseout="out('-8766238562391910018');" style="">  91 import nodomain.freeyourgadget.gadgetbridge.model.Alarm;                                                 </span>
<span class="2021957179005285653" onmouseenter="enter('2021957179005285653');" onmouseout="out('2021957179005285653');" style="">  92 import nodomain.freeyourgadget.gadgetbridge.model.BatteryState;                                          </span>
<span class="-3899388208810973608" onmouseenter="enter('-3899388208810973608');" onmouseout="out('-3899388208810973608');" style="">  93 import nodomain.freeyourgadget.gadgetbridge.model.CalendarEventSpec;                                     </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  94 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="-7415926539738049206" onmouseenter="enter('-7415926539738049206');" onmouseout="out('-7415926539738049206');" style="">  95 import nodomain.freeyourgadget.gadgetbridge.model.CannedMessagesSpec;                                    </span>
<span class="308285905299900254" onmouseenter="enter('308285905299900254');" onmouseout="out('308285905299900254');" style="">  96 import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;                                         </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  97 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  98 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  99 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="-3277000154202836222" onmouseenter="enter('-3277000154202836222');" onmouseout="out('-3277000154202836222');" style=""> 100 import nodomain.freeyourgadget.gadgetbridge.model.RecordedDataTypes;                                     </span>
<span class="-40839721936664146" onmouseenter="enter('-40839721936664146');" onmouseout="out('-40839721936664146');" style=""> 101 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;                                           </span>
<span class="4344228987867394358" onmouseenter="enter('4344228987867394358');" onmouseout="out('4344228987867394358');" style=""> 102 import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLEDeviceSupport;                      </span>
<span class="3410519392510510669" onmouseenter="enter('3410519392510510669');" onmouseout="out('3410519392510510669');" style=""> 103 import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;                             </span>
<span class="332482647079918156" onmouseenter="enter('332482647079918156');" onmouseout="out('332482647079918156');" style=""><abbr title=" 104 import nodomain.freeyourgadget.gadgetbridge.service.devices.qhybrid.requests.misfit.PlayNotificationRequest;"> 104 import nodomain.freeyourgadget.gadgetbridge.service.devices.qhybrid.requests.misfit.PlayNotificationRequeðŸ”µ</abbr></span>
<span class="-9148468836908617343" onmouseenter="enter('-9148468836908617343');" onmouseout="out('-9148468836908617343');" style=""> 105 import nodomain.freeyourgadget.gadgetbridge.util.AlarmUtils;                                             </span>
<span class="-8051705910484913631" onmouseenter="enter('-8051705910484913631');" onmouseout="out('-8051705910484913631');" style=""> 106 import nodomain.freeyourgadget.gadgetbridge.util.EmojiConverter;                                         </span>
<span class="-2020231768395052380" onmouseenter="enter('-2020231768395052380');" onmouseout="out('-2020231768395052380');" style=""> 107 import nodomain.freeyourgadget.gadgetbridge.util.FileUtils;                                              </span>
<span class="-3798970344596478499" onmouseenter="enter('-3798970344596478499');" onmouseout="out('-3798970344596478499');" style=""> 108 import nodomain.freeyourgadget.gadgetbridge.util.GB;                                                     </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style=""> 109 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style=""> 110 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span  style=""> 111                                                                                                          </span>
<span class="-2225725182537405146" onmouseenter="enter('-2225725182537405146');" onmouseout="out('-2225725182537405146');" style=""><abbr title=" 112 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_ALLOW_HIGH_MTU;"> 112 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="2440588347549655822" onmouseenter="enter('2440588347549655822');" onmouseout="out('2440588347549655822');" style=""><abbr title=" 113 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTERNET_ACCESS;"> 113 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="-5321063140707926105" onmouseenter="enter('-5321063140707926105');" onmouseout="out('-5321063140707926105');" style=""><abbr title=" 114 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTENTS;"> 114 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="1576087340720410961" onmouseenter="enter('1576087340720410961');" onmouseout="out('1576087340720410961');" style=""><abbr title=" 115 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_BANGLEJS_TEXT_BITMAP;"> 115 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="-7620522862868556032" onmouseenter="enter('-7620522862868556032');" onmouseout="out('-7620522862868556032');" style=""> 116 import static nodomain.freeyourgadget.gadgetbridge.database.DBHelper.*;                                  </span>
<span  style=""> 117                                                                                                          </span>
<span class="-6525955205891456613" onmouseenter="enter('-6525955205891456613');" onmouseout="out('-6525955205891456613');" style=""> 118 import javax.xml.xpath.XPath;                                                                            </span>
<span class="948957029946951050" onmouseenter="enter('948957029946951050');" onmouseout="out('948957029946951050');" style=""> 119 import javax.xml.xpath.XPathFactory;                                                                     </span>
<span  style=""> 120                                                                                                          </span>
<span class="-4540174980983528222" onmouseenter="enter('-4540174980983528222');" onmouseout="out('-4540174980983528222');" style=""> 121 public class BangleJSDeviceSupport extends AbstractBTLEDeviceSupport {                                   </span>
<span class="5737832610637191351" onmouseenter="enter('5737832610637191351');" onmouseout="out('5737832610637191351');" style=""> 122     private static final Logger LOG = LoggerFactory.getLogger(BangleJSDeviceSupport.class);              </span>
<span  style=""> 123                                                                                                          </span>
<span class="-1874769646843493640" onmouseenter="enter('-1874769646843493640');" onmouseout="out('-1874769646843493640');" style=""> 124     private BluetoothGattCharacteristic rxCharacteristic = null;                                         </span>
<span class="3394422526290177606" onmouseenter="enter('3394422526290177606');" onmouseout="out('3394422526290177606');" style=""> 125     private BluetoothGattCharacteristic txCharacteristic = null;                                         </span>
<span class="4278598336110524029" onmouseenter="enter('4278598336110524029');" onmouseout="out('4278598336110524029');" style=""> 126     private boolean allowHighMTU = false;                                                                </span>
<span class="4758769595687694218" onmouseenter="enter('4758769595687694218');" onmouseout="out('4758769595687694218');" style=""> 127     private int mtuSize = 20;                                                                            </span>
<span class="-5210712730292226171" onmouseenter="enter('-5210712730292226171');" onmouseout="out('-5210712730292226171');" style=""> 128     int bangleCommandSeq = 0; // to attempt to stop duplicate packets when sending Local Intents         </span>
<span  style=""> 129                                                                                                          </span>
<span class="1561011760409728503" onmouseenter="enter('1561011760409728503');" onmouseout="out('1561011760409728503');" style=""> 130     /// Current line of data received from Bangle.js                                                     </span>
<span class="-848193569484274658" onmouseenter="enter('-848193569484274658');" onmouseout="out('-848193569484274658');" style=""> 131     private String receivedLine = &quot;&quot;;                                                                    </span>
<span class="7842135007952282839" onmouseenter="enter('7842135007952282839');" onmouseout="out('7842135007952282839');" style=""><abbr title=" 132     /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS). Can be dumped with &#x27;Fetch Device Debug Logs&#x27; from Debug menu"> 132     /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS).ðŸ”µ</abbr></span>
<span class="-7872820322050208046" onmouseenter="enter('-7872820322050208046');" onmouseout="out('-7872820322050208046');" style=""> 133     private String receiveHistory = &quot;&quot;;                                                                  </span>
<span class="-3915326133595600019" onmouseenter="enter('-3915326133595600019');" onmouseout="out('-3915326133595600019');" style=""> 134     private boolean realtimeHRM = false;                                                                 </span>
<span class="-4342711334813376852" onmouseenter="enter('-4342711334813376852');" onmouseout="out('-4342711334813376852');" style=""> 135     private boolean realtimeStep = false;                                                                </span>
<span class="-785214995925481662" onmouseenter="enter('-785214995925481662');" onmouseout="out('-785214995925481662');" style=""> 136     private int realtimeHRMInterval = 30*60;                                                             </span>
<span  style=""> 137                                                                                                          </span>
<span class="7817012674261800607" onmouseenter="enter('7817012674261800607');" onmouseout="out('7817012674261800607');" style=""> 138     private final LimitedQueue/*Long*/ mNotificationReplyAction = new LimitedQueue(16);                  </span>
<span  style=""> 139                                                                                                          </span>
<span class="3035544862292212294" onmouseenter="enter('3035544862292212294');" onmouseout="out('3035544862292212294');" style=""> 140     /// Maximum amount of characters to store in receiveHistory                                          </span>
<span class="-1679828146401541729" onmouseenter="enter('-1679828146401541729');" onmouseout="out('-1679828146401541729');" style=""> 141     public static final int MAX_RECEIVE_HISTORY_CHARS = 100000;                                          </span>
<span class="-4613019613947290640" onmouseenter="enter('-4613019613947290640');" onmouseout="out('-4613019613947290640');" style=""> 142     // Local Intents - for app manager communication                                                     </span>
<span class="-6355985936525602065" onmouseenter="enter('-6355985936525602065');" onmouseout="out('-6355985936525602065');" style=""> 143     public static final String BANGLEJS_COMMAND_TX = &quot;banglejs_command_tx&quot;;                              </span>
<span class="-7611986610894711832" onmouseenter="enter('-7611986610894711832');" onmouseout="out('-7611986610894711832');" style=""> 144     public static final String BANGLEJS_COMMAND_RX = &quot;banglejs_command_rx&quot;;                              </span>
<span class="3928394439815779565" onmouseenter="enter('3928394439815779565');" onmouseout="out('3928394439815779565');" style=""> 145     // Global Intents                                                                                    </span>
<span class="8064114268652999257" onmouseenter="enter('8064114268652999257');" onmouseout="out('8064114268652999257');" style=""> 146     private static final String BANGLE_ACTION_UART_TX = &quot;com.banglejs.uart.tx&quot;;                          </span>
<span  style=""> 147                                                                                                          </span>
<span class="-7141869860994321087" onmouseenter="enter('-7141869860994321087');" onmouseout="out('-7141869860994321087');" style=""> 148     public BangleJSDeviceSupport() {                                                                     </span>
<span class="4463652287758102089" onmouseenter="enter('4463652287758102089');" onmouseout="out('4463652287758102089');" style=""> 149         super(LOG);                                                                                      </span>
<span class="3886704256627163463" onmouseenter="enter('3886704256627163463');" onmouseout="out('3886704256627163463');" style=""> 150         addSupportedService(BangleJSConstants.UUID_SERVICE_NORDIC_UART);                                 </span>
<span  style=""> 151                                                                                                          </span>
<span class="1127284200558372197" onmouseenter="enter('1127284200558372197');" onmouseout="out('1127284200558372197');" style=""> 152         registerLocalIntents();                                                                          </span>
<span class="8826733129991946596" onmouseenter="enter('8826733129991946596');" onmouseout="out('8826733129991946596');" style=""> 153         registerGlobalIntents();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="3363204271654612484" onmouseenter="enter('3363204271654612484');" onmouseout="out('3363204271654612484');" style=""> 156     private void registerLocalIntents() {                                                                </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 157         IntentFilter commandFilter = new IntentFilter();                                                 </span>
<span class="-7160894414714230309" onmouseenter="enter('-7160894414714230309');" onmouseout="out('-7160894414714230309');" style=""> 158         commandFilter.addAction(GBDevice.ACTION_DEVICE_CHANGED);                                         </span>
<span class="1690174294514698098" onmouseenter="enter('1690174294514698098');" onmouseout="out('1690174294514698098');" style=""> 159         commandFilter.addAction(BANGLEJS_COMMAND_TX);                                                    </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 160         BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 161             @Override                                                                                    </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 162             public void onReceive(Context context, Intent intent) {                                      </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 163                 switch (intent.getAction()) {                                                            </span>
<span class="1707526022738550013" onmouseenter="enter('1707526022738550013');" onmouseout="out('1707526022738550013');" style=""> 164                     case BANGLEJS_COMMAND_TX: {                                                          </span>
<span class="6200259397597608765" onmouseenter="enter('6200259397597608765');" onmouseout="out('6200259397597608765');" style=""> 165                         String data = String.valueOf(intent.getExtras().get(&quot;DATA&quot;));                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 166                         try {                                                                            </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 167                             TransactionBuilder builder = performInitialized(&quot;TX&quot;);                       </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 168                             uartTx(builder, data);                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 169                             builder.queue(getQueue());                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 170                         } catch (IOException e) {                                                        </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 171                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 171                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 173                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174                     }                                                                                    </span>
<span class="5219935206621418062" onmouseenter="enter('5219935206621418062');" onmouseout="out('5219935206621418062');" style=""> 175                     case GBDevice.ACTION_DEVICE_CHANGED: {                                               </span>
<span class="-7853573391303433157" onmouseenter="enter('-7853573391303433157');" onmouseout="out('-7853573391303433157');" style=""> 176                         LOG.info(&quot;ACTION_DEVICE_CHANGED &quot; + gbDevice.getStateString());                  </span>
<span class="3462566553438825861" onmouseenter="enter('3462566553438825861');" onmouseout="out('3462566553438825861');" style=""><abbr title=" 177                         receiveHistory += &quot;\n================================================\nACTION_DEVICE_CHANGED &quot;+gbDevice.getStateString()+&quot; &quot;+(new SimpleDateFormat(&quot;yyyy-mm-dd hh:mm:ss&quot;)).format(Calendar.getInstance().getTime())+&quot;\n================================================\n&quot;;"> 177                         receiveHistory += &quot;\n================================================\nACTION_DEVðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 181         };                                                                                               </span>
<span class="-3358010436009942845" onmouseenter="enter('-3358010436009942845');" onmouseout="out('-3358010436009942845');" style=""><abbr title=" 182         LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, commandFilter);"> 182         LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="-5775866095722777208" onmouseenter="enter('-5775866095722777208');" onmouseout="out('-5775866095722777208');" style=""> 185     private void registerGlobalIntents() {                                                               </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 186         IntentFilter commandFilter = new IntentFilter();                                                 </span>
<span class="312812515367481242" onmouseenter="enter('312812515367481242');" onmouseout="out('312812515367481242');" style=""> 187         commandFilter.addAction(BANGLE_ACTION_UART_TX);                                                  </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 188         BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 189             @Override                                                                                    </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 190             public void onReceive(Context context, Intent intent) {                                      </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 191                 switch (intent.getAction()) {                                                            </span>
<span class="-2247552427419228949" onmouseenter="enter('-2247552427419228949');" onmouseout="out('-2247552427419228949');" style=""> 192                     case BANGLE_ACTION_UART_TX: {                                                        </span>
<span class="1831826963180757129" onmouseenter="enter('1831826963180757129');" onmouseout="out('1831826963180757129');" style=""> 193                         /* In Tasker:                                                                    </span>
<span class="-7864253240443668933" onmouseenter="enter('-7864253240443668933');" onmouseout="out('-7864253240443668933');" style=""> 194                           Action: com.banglejs.uart.tx                                                   </span>
<span class="-8992717920838973367" onmouseenter="enter('-8992717920838973367');" onmouseout="out('-8992717920838973367');" style=""> 195                           Cat: None                                                                      </span>
<span class="7759910949487339439" onmouseenter="enter('7759910949487339439');" onmouseout="out('7759910949487339439');" style=""> 196                           Extra: line:Terminal.println(%avariable)                                       </span>
<span class="1033584491372489972" onmouseenter="enter('1033584491372489972');" onmouseout="out('1033584491372489972');" style=""> 197                           Target: Broadcast Receiver                                                     </span>
<span  style=""> 198                                                                                                          </span>
<span class="8716883358060475580" onmouseenter="enter('8716883358060475580');" onmouseout="out('8716883358060475580');" style=""><abbr title=" 199                           Variable: Number, Configure on Import, NOT structured, Value set, Nothing Exported, NOT Same as value"> 199                           Variable: Number, Configure on Import, NOT structured, Value set, Nothing ExporðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 200                          */                                                                              </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 201                         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 201                         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDeviceðŸ”µ</abbr></span>
<span class="-3486649650498692683" onmouseenter="enter('-3486649650498692683');" onmouseout="out('-3486649650498692683');" style=""> 202                         if (!devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) return;                 </span>
<span class="-5120599586530243425" onmouseenter="enter('-5120599586530243425');" onmouseout="out('-5120599586530243425');" style=""> 203                         String data = intent.getStringExtra(&quot;line&quot;);                                     </span>
<span class="2134003849288272405" onmouseenter="enter('2134003849288272405');" onmouseout="out('2134003849288272405');" style=""> 204                         if (data==null) {                                                                </span>
<span class="-1377387169158373155" onmouseenter="enter('-1377387169158373155');" onmouseout="out('-1377387169158373155');" style=""><abbr title=" 205                             GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 205                             GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTHðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 206                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                         }                                                                                </span>
<span class="-5300884727268780299" onmouseenter="enter('-5300884727268780299');" onmouseout="out('-5300884727268780299');" style=""> 208                         if (!data.endsWith(&quot;\n&quot;)) data += &quot;\n&quot;;                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 209                         try {                                                                            </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 210                             TransactionBuilder builder = performInitialized(&quot;TX&quot;);                       </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 211                             uartTx(builder, data);                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 212                             builder.queue(getQueue());                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 213                         } catch (IOException e) {                                                        </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 214                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 214                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 216                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 220         };                                                                                               </span>
<span class="-7064134150505035894" onmouseenter="enter('-7064134150505035894');" onmouseout="out('-7064134150505035894');" style=""> 221         GBApplication.getContext().registerReceiver(commandReceiver, commandFilter);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span  style=""> 223                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 224     @Override                                                                                            </span>
<span class="624595386859969795" onmouseenter="enter('624595386859969795');" onmouseout="out('624595386859969795');" style=""> 225     protected TransactionBuilder initializeDevice(TransactionBuilder builder) {                          </span>
<span class="6943102306574884764" onmouseenter="enter('6943102306574884764');" onmouseout="out('6943102306574884764');" style=""> 226         LOG.info(&quot;Initializing&quot;);                                                                        </span>
<span  style=""> 227                                                                                                          </span>
<span class="-5776342764121597122" onmouseenter="enter('-5776342764121597122');" onmouseout="out('-5776342764121597122');" style=""> 228         gbDevice.setState(GBDevice.State.INITIALIZING);                                                  </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 229         gbDevice.sendDeviceUpdateIntent(getContext());                                                   </span>
<span class="-92673263340012587" onmouseenter="enter('-92673263340012587');" onmouseout="out('-92673263340012587');" style=""> 230         gbDevice.setBatteryThresholdPercent((short) 30);                                                 </span>
<span  style=""> 231                                                                                                          </span>
<span class="-8842369873450741446" onmouseenter="enter('-8842369873450741446');" onmouseout="out('-8842369873450741446');" style=""> 232         rxCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX);      </span>
<span class="5321381947985783136" onmouseenter="enter('5321381947985783136');" onmouseout="out('5321381947985783136');" style=""> 233         txCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_TX);      </span>
<span class="8787860057533172177" onmouseenter="enter('8787860057533172177');" onmouseout="out('8787860057533172177');" style=""> 234         builder.setGattCallback(this);                                                                   </span>
<span class="-6644952300158088977" onmouseenter="enter('-6644952300158088977');" onmouseout="out('-6644952300158088977');" style=""> 235         builder.notify(rxCharacteristic, true);                                                          </span>
<span  style=""> 236                                                                                                          </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 237         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));</span>
<span class="-251442064819697046" onmouseenter="enter('-251442064819697046');" onmouseout="out('-251442064819697046');" style=""> 238         allowHighMTU = devicePrefs.getBoolean(PREF_ALLOW_HIGH_MTU, false);                               </span>
<span  style=""> 239                                                                                                          </span>
<span class="-8288238614628464708" onmouseenter="enter('-8288238614628464708');" onmouseout="out('-8288238614628464708');" style=""> 240         uartTx(builder, &quot; \u0003&quot;); // clear active line                                                 </span>
<span  style=""> 241                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 242         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="8819552782192853417" onmouseenter="enter('8819552782192853417');" onmouseout="out('8819552782192853417');" style=""> 243         if (prefs.getBoolean(&quot;datetime_synconconnect&quot;, true))                                            </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 244           transmitTime(builder);                                                                         </span>
<span class="-772823299017939314" onmouseenter="enter('-772823299017939314');" onmouseout="out('-772823299017939314');" style=""> 245         //sendSettings(builder);                                                                         </span>
<span  style=""> 246                                                                                                          </span>
<span class="6222907129579606912" onmouseenter="enter('6222907129579606912');" onmouseout="out('6222907129579606912');" style=""> 247         // get version                                                                                   </span>
<span  style=""> 248                                                                                                          </span>
<span class="6586859092027978564" onmouseenter="enter('6586859092027978564');" onmouseout="out('6586859092027978564');" style=""> 249         gbDevice.setState(GBDevice.State.INITIALIZED);                                                   </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 250         gbDevice.sendDeviceUpdateIntent(getContext());                                                   </span>
<span  style=""> 251                                                                                                          </span>
<span class="-3832688778173104110" onmouseenter="enter('-3832688778173104110');" onmouseout="out('-3832688778173104110');" style=""> 252         getDevice().setFirmwareVersion(&quot;N/A&quot;);                                                           </span>
<span class="-4069256094451065143" onmouseenter="enter('-4069256094451065143');" onmouseout="out('-4069256094451065143');" style=""> 253         getDevice().setFirmwareVersion2(&quot;N/A&quot;);                                                          </span>
<span  style=""> 254                                                                                                          </span>
<span class="8801197429786363323" onmouseenter="enter('8801197429786363323');" onmouseout="out('8801197429786363323');" style=""> 255         LOG.info(&quot;Initialization Done&quot;);                                                                 </span>
<span  style=""> 256                                                                                                          </span>
<span class="4801455624621135639" onmouseenter="enter('4801455624621135639');" onmouseout="out('4801455624621135639');" style=""> 257         return builder;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258     }                                                                                                    </span>
<span  style=""> 259                                                                                                          </span>
<span class="-607913654590177522" onmouseenter="enter('-607913654590177522');" onmouseout="out('-607913654590177522');" style=""> 260     /// Write a string of data, and chunk it up                                                          </span>
<span class="7559000899786781106" onmouseenter="enter('7559000899786781106');" onmouseout="out('7559000899786781106');" style=""> 261     private void uartTx(TransactionBuilder builder, String str) {                                        </span>
<span class="2941836608639998178" onmouseenter="enter('2941836608639998178');" onmouseout="out('2941836608639998178');" style=""> 262         byte[] bytes = str.getBytes(StandardCharsets.ISO_8859_1);                                        </span>
<span class="7973208681748769929" onmouseenter="enter('7973208681748769929');" onmouseout="out('7973208681748769929');" style=""> 263         LOG.info(&quot;UART TX: &quot; + str);                                                                     </span>
<span class="-4351000658882190788" onmouseenter="enter('-4351000658882190788');" onmouseout="out('-4351000658882190788');" style=""><abbr title=" 264         // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.stringify is converting to UTF-8?"> 264         // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.strðŸ”µ</abbr></span>
<span class="-7681259971523215295" onmouseenter="enter('-7681259971523215295');" onmouseout="out('-7681259971523215295');" style=""> 265         for (int i=0;i&lt;bytes.length;i+=mtuSize) {                                                        </span>
<span class="6940458760871247208" onmouseenter="enter('6940458760871247208');" onmouseout="out('6940458760871247208');" style=""> 266             int l = bytes.length-i;                                                                      </span>
<span class="-2771087721762798548" onmouseenter="enter('-2771087721762798548');" onmouseout="out('-2771087721762798548');" style=""> 267             if (l&gt;mtuSize) l=mtuSize;                                                                    </span>
<span class="-7868874671478910733" onmouseenter="enter('-7868874671478910733');" onmouseout="out('-7868874671478910733');" style=""> 268             byte[] packet = new byte[l];                                                                 </span>
<span class="6292978456177043042" onmouseenter="enter('6292978456177043042');" onmouseout="out('6292978456177043042');" style=""> 269             System.arraycopy(bytes, i, packet, 0, l);                                                    </span>
<span class="7692898876807316449" onmouseenter="enter('7692898876807316449');" onmouseout="out('7692898876807316449');" style=""> 270             builder.write(txCharacteristic, packet);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span  style=""> 273                                                                                                          </span>
<span class="-5064235187014244552" onmouseenter="enter('-5064235187014244552');" onmouseout="out('-5064235187014244552');" style=""> 274     /// Converts an object to a JSON string. see jsonToString                                            </span>
<span class="-7371185357421447388" onmouseenter="enter('-7371185357421447388');" onmouseout="out('-7371185357421447388');" style=""> 275     private String jsonToStringInternal(Object v) {                                                      </span>
<span class="-7134941835268720819" onmouseenter="enter('-7134941835268720819');" onmouseout="out('-7134941835268720819');" style=""> 276         if (v instanceof String) {                                                                       </span>
<span class="4695321176266141339" onmouseenter="enter('4695321176266141339');" onmouseout="out('4695321176266141339');" style=""> 277             /* Convert a string, escaping chars we can&#x27;t send over out UART connection */                </span>
<span class="8933833811592559950" onmouseenter="enter('8933833811592559950');" onmouseout="out('8933833811592559950');" style=""> 278             String s = (String)v;                                                                        </span>
<span class="-1195550795921055111" onmouseenter="enter('-1195550795921055111');" onmouseout="out('-1195550795921055111');" style=""> 279             String json = &quot;\&quot;&quot;;                                                                          </span>
<span class="-1996367706551518739" onmouseenter="enter('-1996367706551518739');" onmouseout="out('-1996367706551518739');" style=""> 280             for (int i=0;i&lt;s.length();i++) {                                                             </span>
<span class="-4633521068028742210" onmouseenter="enter('-4633521068028742210');" onmouseout="out('-4633521068028742210');" style=""> 281                 int ch = (int)s.charAt(i);                                                               </span>
<span class="5723330426570993790" onmouseenter="enter('5723330426570993790');" onmouseout="out('5723330426570993790');" style=""> 282                 if (ch&lt;8) json += &quot;\\&quot;+ch;                                                               </span>
<span class="-4350456713444094906" onmouseenter="enter('-4350456713444094906');" onmouseout="out('-4350456713444094906');" style=""> 283                 else if (ch==8) json += &quot;\\b&quot;;                                                           </span>
<span class="6286426041013160143" onmouseenter="enter('6286426041013160143');" onmouseout="out('6286426041013160143');" style=""> 284                 else if (ch==9) json += &quot;\\t&quot;;                                                           </span>
<span class="-1277399730021433556" onmouseenter="enter('-1277399730021433556');" onmouseout="out('-1277399730021433556');" style=""> 285                 else if (ch==10) json += &quot;\\n&quot;;                                                          </span>
<span class="6872609748162055968" onmouseenter="enter('6872609748162055968');" onmouseout="out('6872609748162055968');" style=""> 286                 else if (ch==11) json += &quot;\\v&quot;;                                                          </span>
<span class="7232867159848538970" onmouseenter="enter('7232867159848538970');" onmouseout="out('7232867159848538970');" style=""> 287                 else if (ch==12) json += &quot;\\f&quot;;                                                          </span>
<span class="-9019357013713288321" onmouseenter="enter('-9019357013713288321');" onmouseout="out('-9019357013713288321');" style=""> 288                 else if (ch==34) json += &quot;\\\&quot;&quot;; // quote                                                </span>
<span class="9032098586745803989" onmouseenter="enter('9032098586745803989');" onmouseout="out('9032098586745803989');" style=""> 289                 else if (ch==92) json += &quot;\\\\&quot;; // slash                                                </span>
<span class="6447496634063631908" onmouseenter="enter('6447496634063631908');" onmouseout="out('6447496634063631908');" style=""><abbr title=" 290                 else if (ch&lt;32 || ch==26 || ch==27 || ch==127 || ch==173) json += &quot;\\x&quot;+Integer.toHexString((ch&amp;255)|256).substring(1);"> 290                 else if (ch&lt;32 || ch==26 || ch==27 || ch==127 || ch==173) json += &quot;\\x&quot;+Integer.toHexStriðŸ”µ</abbr></span>
<span class="5586798994544781015" onmouseenter="enter('5586798994544781015');" onmouseout="out('5586798994544781015');" style=""> 291                 else json += s.charAt(i);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292             }                                                                                            </span>
<span class="8650149552652832651" onmouseenter="enter('8650149552652832651');" onmouseout="out('8650149552652832651');" style=""> 293             return json + &quot;\&quot;&quot;;                                                                          </span>
<span class="-7459573803876256213" onmouseenter="enter('-7459573803876256213');" onmouseout="out('-7459573803876256213');" style=""> 294         } else if (v instanceof JSONArray) {                                                             </span>
<span class="20789529080758051" onmouseenter="enter('20789529080758051');" onmouseout="out('20789529080758051');" style=""> 295             JSONArray a = (JSONArray)v;                                                                  </span>
<span class="2941565214382533189" onmouseenter="enter('2941565214382533189');" onmouseout="out('2941565214382533189');" style=""> 296             String json = &quot;[&quot;;                                                                           </span>
<span class="2132510637713046246" onmouseenter="enter('2132510637713046246');" onmouseout="out('2132510637713046246');" style=""> 297             for (int i=0;i&lt;a.length();i++) {                                                             </span>
<span class="-865608346194445464" onmouseenter="enter('-865608346194445464');" onmouseout="out('-865608346194445464');" style=""> 298                 if (i&gt;0) json += &quot;,&quot;;                                                                    </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style=""> 299                 Object o = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 300                 try {                                                                                    </span>
<span class="1204902991279523771" onmouseenter="enter('1204902991279523771');" onmouseout="out('1204902991279523771');" style=""> 301                     o = a.get(i);                                                                        </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 302                 } catch (JSONException e) {                                                              </span>
<span class="5502177219725162371" onmouseenter="enter('5502177219725162371');" onmouseout="out('5502177219725162371');" style=""> 303                     LOG.warn(&quot;jsonToString array error: &quot; + e.getLocalizedMessage());                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304                 }                                                                                        </span>
<span class="-4254234117673713204" onmouseenter="enter('-4254234117673713204');" onmouseout="out('-4254234117673713204');" style=""> 305                 json += jsonToStringInternal(o);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306             }                                                                                            </span>
<span class="-4069907645727934854" onmouseenter="enter('-4069907645727934854');" onmouseout="out('-4069907645727934854');" style=""> 307             return json+&quot;]&quot;;                                                                             </span>
<span class="8699967118061541294" onmouseenter="enter('8699967118061541294');" onmouseout="out('8699967118061541294');" style=""> 308         } else if (v instanceof JSONObject) {                                                            </span>
<span class="5040693240352357389" onmouseenter="enter('5040693240352357389');" onmouseout="out('5040693240352357389');" style=""> 309             JSONObject obj = (JSONObject)v;                                                              </span>
<span class="-6486828837023838756" onmouseenter="enter('-6486828837023838756');" onmouseout="out('-6486828837023838756');" style=""> 310             String json = &quot;{&quot;;                                                                           </span>
<span class="7563206350819307174" onmouseenter="enter('7563206350819307174');" onmouseout="out('7563206350819307174');" style=""> 311             Iterator&lt;String&gt; iter = obj.keys();                                                          </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 312             while (iter.hasNext()) {                                                                     </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 313                 String key = iter.next();                                                                </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style=""> 314                 Object o = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 315                 try {                                                                                    </span>
<span class="8042496106905891292" onmouseenter="enter('8042496106905891292');" onmouseout="out('8042496106905891292');" style=""> 316                     o = obj.get(key);                                                                    </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 317                 } catch (JSONException e) {                                                              </span>
<span class="2953006937969085175" onmouseenter="enter('2953006937969085175');" onmouseout="out('2953006937969085175');" style=""> 318                     LOG.warn(&quot;jsonToString object error: &quot; + e.getLocalizedMessage());                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319                 }                                                                                        </span>
<span class="7562295632169911142" onmouseenter="enter('7562295632169911142');" onmouseout="out('7562295632169911142');" style=""> 320                 json += key+&quot;:&quot;+jsonToStringInternal(o);                                                 </span>
<span class="-775465109238322464" onmouseenter="enter('-775465109238322464');" onmouseout="out('-775465109238322464');" style=""> 321                 if (iter.hasNext()) json+=&quot;,&quot;;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322             }                                                                                            </span>
<span class="1226915701420061298" onmouseenter="enter('1226915701420061298');" onmouseout="out('1226915701420061298');" style=""> 323             return json+&quot;}&quot;;                                                                             </span>
<span class="3600399421666172751" onmouseenter="enter('3600399421666172751');" onmouseout="out('3600399421666172751');" style=""> 324         } // else int/double/null                                                                        </span>
<span class="3525583877034800949" onmouseenter="enter('3525583877034800949');" onmouseout="out('3525583877034800949');" style=""> 325         return v.toString();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326     }                                                                                                    </span>
<span  style=""> 327                                                                                                          </span>
<span class="-4462526562745695882" onmouseenter="enter('-4462526562745695882');" onmouseout="out('-4462526562745695882');" style=""> 328     /// Convert a JSON object to a JSON String (NOT 100% JSON compliant)                                 </span>
<span class="4157561026938027662" onmouseenter="enter('4157561026938027662');" onmouseout="out('4157561026938027662');" style=""> 329     public String jsonToString(JSONObject jsonObj) {                                                     </span>
<span class="-3297195869188929142" onmouseenter="enter('-3297195869188929142');" onmouseout="out('-3297195869188929142');" style=""> 330         /* jsonObj.toString() works but breaks char codes&gt;128 (encodes as UTF8?) and also uses           </span>
<span class="7509381523120718717" onmouseenter="enter('7509381523120718717');" onmouseout="out('7509381523120718717');" style=""> 331         \u0000 when just \0 would do (and so on).                                                        </span>
<span  style=""> 332                                                                                                          </span>
<span class="-1336376992819668396" onmouseenter="enter('-1336376992819668396');" onmouseout="out('-1336376992819668396');" style=""> 333         So we do it manually, which can be more compact anyway.                                          </span>
<span class="-5084316389888644344" onmouseenter="enter('-5084316389888644344');" onmouseout="out('-5084316389888644344');" style=""> 334         This is JSON-ish, so not exactly as per JSON1 spec but good enough for Espruino.                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 335         */                                                                                               </span>
<span class="7796956154837315813" onmouseenter="enter('7796956154837315813');" onmouseout="out('7796956154837315813');" style=""> 336         return jsonToStringInternal(jsonObj);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337     }                                                                                                    </span>
<span  style=""> 338                                                                                                          </span>
<span class="31684629009080209" onmouseenter="enter('31684629009080209');" onmouseout="out('31684629009080209');" style=""> 339     /// Write a JSON object of data                                                                      </span>
<span class="-8756055707520682190" onmouseenter="enter('-8756055707520682190');" onmouseout="out('-8756055707520682190');" style=""> 340     private void uartTxJSON(String taskName, JSONObject json) {                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 341         try {                                                                                            </span>
<span class="-6185382728407385788" onmouseenter="enter('-6185382728407385788');" onmouseout="out('-6185382728407385788');" style=""> 342             TransactionBuilder builder = performInitialized(taskName);                                   </span>
<span class="-5291927674188184215" onmouseenter="enter('-5291927674188184215');" onmouseout="out('-5291927674188184215');" style=""> 343             uartTx(builder, &quot;\u0010GB(&quot;+jsonToString(json)+&quot;)\n&quot;);                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 344             builder.queue(getQueue());                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 345         } catch (IOException e) {                                                                        </span>
<span class="2446652404576165600" onmouseenter="enter('2446652404576165600');" onmouseout="out('2446652404576165600');" style=""><abbr title=" 346             GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 346             GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONGðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348     }                                                                                                    </span>
<span  style=""> 349                                                                                                          </span>
<span class="4290598848752150102" onmouseenter="enter('4290598848752150102');" onmouseout="out('4290598848752150102');" style=""> 350     /// Write JSON object of the form {t:taskName, err:message}                                          </span>
<span  style=""> 351                                                                                                          </span>
<span class="-8058058420395857539" onmouseenter="enter('-8058058420395857539');" onmouseout="out('-8058058420395857539');" style=""> 352     private void uartTxJSONError(String taskName, String message) {                                      </span>
<span class="3966342241212062344" onmouseenter="enter('3966342241212062344');" onmouseout="out('3966342241212062344');" style=""> 353         uartTxJSONError(taskName,message,null);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354     }                                                                                                    </span>
<span  style=""> 355                                                                                                          </span>
<span class="7327259819120083170" onmouseenter="enter('7327259819120083170');" onmouseout="out('7327259819120083170');" style=""> 356     private void uartTxJSONError(String taskName, String message,String id) {                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 357         JSONObject o = new JSONObject();                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 358         try {                                                                                            </span>
<span class="-4736457139552862676" onmouseenter="enter('-4736457139552862676');" onmouseout="out('-4736457139552862676');" style=""> 359             o.put(&quot;t&quot;, taskName);                                                                        </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 360             if( id!=null)                                                                                </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 361                 o.put(&quot;id&quot;, id);                                                                         </span>
<span class="-3362855442851232299" onmouseenter="enter('-3362855442851232299');" onmouseout="out('-3362855442851232299');" style=""> 362             o.put(&quot;err&quot;, message);                                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 363         } catch (JSONException e) {                                                                      </span>
<span class="-293713289384668060" onmouseenter="enter('-293713289384668060');" onmouseout="out('-293713289384668060');" style=""><abbr title=" 364             GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 364             GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.EðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365         }                                                                                                </span>
<span class="-3544369649702046019" onmouseenter="enter('-3544369649702046019');" onmouseout="out('-3544369649702046019');" style=""> 366         uartTxJSON(taskName, o);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367     }                                                                                                    </span>
<span  style=""> 368                                                                                                          </span>
<span  style=""> 369                                                                                                          </span>
<span  style=""> 370                                                                                                          </span>
<span class="3549324304064443217" onmouseenter="enter('3549324304064443217');" onmouseout="out('3549324304064443217');" style=""> 371     private void handleUartRxLine(String line) {                                                         </span>
<span class="7696744219355043330" onmouseenter="enter('7696744219355043330');" onmouseout="out('7696744219355043330');" style=""> 372         LOG.info(&quot;UART RX LINE: &quot; + line);                                                               </span>
<span class="5454828508308371900" onmouseenter="enter('5454828508308371900');" onmouseout="out('5454828508308371900');" style=""> 373         if (line.length()==0) return;                                                                    </span>
<span class="2508923913537480964" onmouseenter="enter('2508923913537480964');" onmouseout="out('2508923913537480964');" style=""> 374         if (&quot;&gt;Uncaught ReferenceError: \&quot;GB\&quot; is not defined&quot;.equals(line))                              </span>
<span class="7158908931448264833" onmouseenter="enter('7158908931448264833');" onmouseout="out('7158908931448264833');" style=""><abbr title=" 375           GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 375           GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GB.ðŸ”µ</abbr></span>
<span class="5685500193458919055" onmouseenter="enter('5685500193458919055');" onmouseout="out('5685500193458919055');" style=""> 376         else if (line.charAt(0)==&#x27;{&#x27;) {                                                                  </span>
<span class="8231786037032554769" onmouseenter="enter('8231786037032554769');" onmouseout="out('8231786037032554769');" style=""> 377             // JSON - we hope!                                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 378             try {                                                                                        </span>
<span class="2411116435363976231" onmouseenter="enter('2411116435363976231');" onmouseout="out('2411116435363976231');" style=""> 379                 JSONObject json = new JSONObject(line);                                                  </span>
<span class="8233558512387133223" onmouseenter="enter('8233558512387133223');" onmouseout="out('8233558512387133223');" style=""> 380                 LOG.info(&quot;UART RX JSON parsed successfully&quot;);                                            </span>
<span class="4509864865787947019" onmouseenter="enter('4509864865787947019');" onmouseout="out('4509864865787947019');" style=""> 381                 handleUartRxJSON(json);                                                                  </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 382             } catch (JSONException e) {                                                                  </span>
<span class="-2414553303058964646" onmouseenter="enter('-2414553303058964646');" onmouseout="out('-2414553303058964646');" style=""> 383                 LOG.info(&quot;UART RX JSON parse failure: &quot;+ e.getLocalizedMessage());                       </span>
<span class="8356145272001509336" onmouseenter="enter('8356145272001509336');" onmouseout="out('8356145272001509336');" style=""><abbr title=" 384                 GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 384                 GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), ToastðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 386         } else {                                                                                         </span>
<span class="3013327231508790922" onmouseenter="enter('3013327231508790922');" onmouseout="out('3013327231508790922');" style=""> 387             LOG.info(&quot;UART RX line started with &quot;+(int)line.charAt(0)+&quot; - ignoring&quot;);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389     }                                                                                                    </span>
<span  style=""> 390                                                                                                          </span>
<span class="-1023302836013344522" onmouseenter="enter('-1023302836013344522');" onmouseout="out('-1023302836013344522');" style=""> 391     private void handleUartRxJSON(JSONObject json) throws JSONException {                                </span>
<span class="7061070849429770108" onmouseenter="enter('7061070849429770108');" onmouseout="out('7061070849429770108');" style=""> 392         String packetType = json.getString(&quot;t&quot;);                                                         </span>
<span class="2121648211711712075" onmouseenter="enter('2121648211711712075');" onmouseout="out('2121648211711712075');" style=""> 393         switch (packetType) {                                                                            </span>
<span class="1154622936863099207" onmouseenter="enter('1154622936863099207');" onmouseout="out('1154622936863099207');" style=""> 394             case &quot;info&quot;:                                                                                 </span>
<span class="6489300233296788049" onmouseenter="enter('6489300233296788049');" onmouseout="out('6489300233296788049');" style=""><abbr title=" 395                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO);"> 395                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO)ðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 396                 break;                                                                                   </span>
<span class="3852677909480408410" onmouseenter="enter('3852677909480408410');" onmouseout="out('3852677909480408410');" style=""> 397             case &quot;warn&quot;:                                                                                 </span>
<span class="-1267997652646506218" onmouseenter="enter('-1267997652646506218');" onmouseout="out('-1267997652646506218');" style=""><abbr title=" 398                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN);"> 398                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN)ðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 399                 break;                                                                                   </span>
<span class="-4027904492374937118" onmouseenter="enter('-4027904492374937118');" onmouseout="out('-4027904492374937118');" style=""> 400             case &quot;error&quot;:                                                                                </span>
<span class="3082648944163426921" onmouseenter="enter('3082648944163426921');" onmouseout="out('3082648944163426921');" style=""><abbr title=" 401                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERROR);"> 401                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERRORðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 402                 break;                                                                                   </span>
<span class="-6550395055022650144" onmouseenter="enter('-6550395055022650144');" onmouseout="out('-6550395055022650144');" style=""> 403             case &quot;ver&quot;: {                                                                                </span>
<span class="1504582788479684724" onmouseenter="enter('1504582788479684724');" onmouseout="out('1504582788479684724');" style=""> 404                 if (json.has(&quot;fw1&quot;))                                                                     </span>
<span class="7809101785256581980" onmouseenter="enter('7809101785256581980');" onmouseout="out('7809101785256581980');" style=""> 405                     getDevice().setFirmwareVersion(json.getString(&quot;fw1&quot;));                               </span>
<span class="-4269189810719037321" onmouseenter="enter('-4269189810719037321');" onmouseout="out('-4269189810719037321');" style=""> 406                 if (json.has(&quot;fw2&quot;))                                                                     </span>
<span class="-1725698584982350052" onmouseenter="enter('-1725698584982350052');" onmouseout="out('-1725698584982350052');" style=""> 407                     getDevice().setFirmwareVersion2(json.getString(&quot;fw2&quot;));                              </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 408             } break;                                                                                     </span>
<span class="-3223445656092502792" onmouseenter="enter('-3223445656092502792');" onmouseout="out('-3223445656092502792');" style=""> 409             case &quot;status&quot;: {                                                                             </span>
<span class="1472249640876064382" onmouseenter="enter('1472249640876064382');" onmouseout="out('1472249640876064382');" style=""> 410                 GBDeviceEventBatteryInfo batteryInfo = new GBDeviceEventBatteryInfo();                   </span>
<span class="-8684865925727857265" onmouseenter="enter('-8684865925727857265');" onmouseout="out('-8684865925727857265');" style=""> 411                 if (json.has(&quot;bat&quot;)) {                                                                   </span>
<span class="3744277214774220447" onmouseenter="enter('3744277214774220447');" onmouseout="out('3744277214774220447');" style=""> 412                     int b = json.getInt(&quot;bat&quot;);                                                          </span>
<span class="5862741907286067284" onmouseenter="enter('5862741907286067284');" onmouseout="out('5862741907286067284');" style=""> 413                     if (b &lt; 0) b = 0;                                                                    </span>
<span class="572226595522417282" onmouseenter="enter('572226595522417282');" onmouseout="out('572226595522417282');" style=""> 414                     if (b &gt; 100) b = 100;                                                                </span>
<span class="6496455062087841098" onmouseenter="enter('6496455062087841098');" onmouseout="out('6496455062087841098');" style=""> 415                     batteryInfo.level = b;                                                               </span>
<span class="-2105719386055198398" onmouseenter="enter('-2105719386055198398');" onmouseout="out('-2105719386055198398');" style=""> 416                     batteryInfo.state = BatteryState.BATTERY_NORMAL;                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417                 }                                                                                        </span>
<span class="-8617525444786471834" onmouseenter="enter('-8617525444786471834');" onmouseout="out('-8617525444786471834');" style=""> 418                 if (json.has(&quot;chg&quot;) &amp;&amp; json.getInt(&quot;chg&quot;) == 1) {                                        </span>
<span class="-936118866357790298" onmouseenter="enter('-936118866357790298');" onmouseout="out('-936118866357790298');" style=""> 419                     batteryInfo.state = BatteryState.BATTERY_CHARGING;                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420                 }                                                                                        </span>
<span class="1514350151524445078" onmouseenter="enter('1514350151524445078');" onmouseout="out('1514350151524445078');" style=""> 421                 if (json.has(&quot;volt&quot;))                                                                    </span>
<span class="-3686044708246396849" onmouseenter="enter('-3686044708246396849');" onmouseout="out('-3686044708246396849');" style=""> 422                     batteryInfo.voltage = (float) json.getDouble(&quot;volt&quot;);                                </span>
<span class="-1573801757390600576" onmouseenter="enter('-1573801757390600576');" onmouseout="out('-1573801757390600576');" style=""> 423                 handleGBDeviceEvent(batteryInfo);                                                        </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 424             } break;                                                                                     </span>
<span class="-7544298044919087691" onmouseenter="enter('-7544298044919087691');" onmouseout="out('-7544298044919087691');" style=""> 425             case &quot;findPhone&quot;: {                                                                          </span>
<span class="-2748392883851010177" onmouseenter="enter('-2748392883851010177');" onmouseout="out('-2748392883851010177');" style=""> 426                 boolean start = json.has(&quot;n&quot;) &amp;&amp; json.getBoolean(&quot;n&quot;);                                   </span>
<span class="6136676704701652580" onmouseenter="enter('6136676704701652580');" onmouseout="out('6136676704701652580');" style=""> 427                 GBDeviceEventFindPhone deviceEventFindPhone = new GBDeviceEventFindPhone();              </span>
<span class="3202169087750798845" onmouseenter="enter('3202169087750798845');" onmouseout="out('3202169087750798845');" style=""><abbr title=" 428                 deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFindPhone.Event.STOP;"> 428                 deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFiðŸ”µ</abbr></span>
<span class="-1455650059425895125" onmouseenter="enter('-1455650059425895125');" onmouseout="out('-1455650059425895125');" style=""> 429                 evaluateGBDeviceEvent(deviceEventFindPhone);                                             </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 430             } break;                                                                                     </span>
<span class="5454487238732594669" onmouseenter="enter('5454487238732594669');" onmouseout="out('5454487238732594669');" style=""> 431             case &quot;music&quot;: {                                                                              </span>
<span class="-5683743334008418698" onmouseenter="enter('-5683743334008418698');" onmouseout="out('-5683743334008418698');" style=""> 432                 GBDeviceEventMusicControl deviceEventMusicControl = new GBDeviceEventMusicControl();     </span>
<span class="5894306574008826676" onmouseenter="enter('5894306574008826676');" onmouseout="out('5894306574008826676');" style=""><abbr title=" 433                 deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 433                 deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;nðŸ”µ</abbr></span>
<span class="8133545861002504946" onmouseenter="enter('8133545861002504946');" onmouseout="out('8133545861002504946');" style=""> 434                 evaluateGBDeviceEvent(deviceEventMusicControl);                                          </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 435             } break;                                                                                     </span>
<span class="-9207173587563143993" onmouseenter="enter('-9207173587563143993');" onmouseout="out('-9207173587563143993');" style=""> 436             case &quot;call&quot;: {                                                                               </span>
<span class="2406734484891175482" onmouseenter="enter('2406734484891175482');" onmouseout="out('2406734484891175482');" style=""> 437                 GBDeviceEventCallControl deviceEventCallControl = new GBDeviceEventCallControl();        </span>
<span class="-5299176663874891056" onmouseenter="enter('-5299176663874891056');" onmouseout="out('-5299176663874891056');" style=""><abbr title=" 438                 deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 438                 deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;)ðŸ”µ</abbr></span>
<span class="-7699727803461656923" onmouseenter="enter('-7699727803461656923');" onmouseout="out('-7699727803461656923');" style=""> 439                 evaluateGBDeviceEvent(deviceEventCallControl);                                           </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 440             } break;                                                                                     </span>
<span class="-337329064960380865" onmouseenter="enter('-337329064960380865');" onmouseout="out('-337329064960380865');" style=""> 441             case &quot;notify&quot; : {                                                                            </span>
<span class="1278038111464368986" onmouseenter="enter('1278038111464368986');" onmouseout="out('1278038111464368986');" style=""><abbr title=" 442                 GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificationControl();"> 442                 GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificaðŸ”µ</abbr></span>
<span class="-6597246807803729732" onmouseenter="enter('-6597246807803729732');" onmouseout="out('-6597246807803729732');" style=""> 443                 // .title appears unused                                                                 </span>
<span class="-3304774628543622498" onmouseenter="enter('-3304774628543622498');" onmouseout="out('-3304774628543622498');" style=""><abbr title=" 444                 deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 444                 deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.ðŸ”µ</abbr></span>
<span class="4338373654190408032" onmouseenter="enter('4338373654190408032');" onmouseout="out('4338373654190408032');" style=""> 445                 if (json.has(&quot;id&quot;))                                                                      </span>
<span class="1062450614172957636" onmouseenter="enter('1062450614172957636');" onmouseout="out('1062450614172957636');" style=""> 446                     deviceEvtNotificationControl.handle = json.getInt(&quot;id&quot;);                             </span>
<span class="658666775109182698" onmouseenter="enter('658666775109182698');" onmouseout="out('658666775109182698');" style=""> 447                 if (json.has(&quot;tel&quot;))                                                                     </span>
<span class="3912257448498793625" onmouseenter="enter('3912257448498793625');" onmouseout="out('3912257448498793625');" style=""> 448                     deviceEvtNotificationControl.phoneNumber = json.getString(&quot;tel&quot;);                    </span>
<span class="-279845848013227661" onmouseenter="enter('-279845848013227661');" onmouseout="out('-279845848013227661');" style=""> 449                 if (json.has(&quot;msg&quot;))                                                                     </span>
<span class="6661039268276828670" onmouseenter="enter('6661039268276828670');" onmouseout="out('6661039268276828670');" style=""> 450                     deviceEvtNotificationControl.reply = json.getString(&quot;msg&quot;);                          </span>
<span class="-1817112681649718085" onmouseenter="enter('-1817112681649718085');" onmouseout="out('-1817112681649718085');" style=""> 451                 /* REPLY responses don&#x27;t use the ID from the event (MUTE/etc seem to), but instead       </span>
<span class="5406797550372080886" onmouseenter="enter('5406797550372080886');" onmouseout="out('5406797550372080886');" style=""> 452                 * they use a handle that was provided in an action list on the onNotification.. event  */</span>
<span class="-4787844253490591897" onmouseenter="enter('-4787844253490591897');" onmouseout="out('-4787844253490591897');" style=""> 453                 if (deviceEvtNotificationControl.event == GBDeviceEventNotificationControl.Event.REPLY) {</span>
<span class="7047790762640343753" onmouseenter="enter('7047790762640343753');" onmouseout="out('7047790762640343753');" style=""><abbr title=" 454                     Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationControl.handle);"> 454                     Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationCoðŸ”µ</abbr></span>
<span class="2363738327135911056" onmouseenter="enter('2363738327135911056');" onmouseout="out('2363738327135911056');" style=""> 455                     if (foundHandle!=null)                                                               </span>
<span class="-5768705298123946646" onmouseenter="enter('-5768705298123946646');" onmouseout="out('-5768705298123946646');" style=""> 456                         deviceEvtNotificationControl.handle = foundHandle;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457                 }                                                                                        </span>
<span class="1799618905473722788" onmouseenter="enter('1799618905473722788');" onmouseout="out('1799618905473722788');" style=""> 458                 evaluateGBDeviceEvent(deviceEvtNotificationControl);                                     </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 459             } break;                                                                                     </span>
<span class="692659105886468257" onmouseenter="enter('692659105886468257');" onmouseout="out('692659105886468257');" style=""> 460             case &quot;act&quot;: {                                                                                </span>
<span class="8371010899036944571" onmouseenter="enter('8371010899036944571');" onmouseout="out('8371010899036944571');" style=""> 461                 BangleJSActivitySample sample = new BangleJSActivitySample();                            </span>
<span class="-1915545881769334236" onmouseenter="enter('-1915545881769334236');" onmouseout="out('-1915545881769334236');" style=""> 462                 sample.setTimestamp((int) (GregorianCalendar.getInstance().getTimeInMillis() / 1000L));  </span>
<span class="-6511180810366476909" onmouseenter="enter('-6511180810366476909');" onmouseout="out('-6511180810366476909');" style=""> 463                 int hrm = 0;                                                                             </span>
<span class="-2794193254662759202" onmouseenter="enter('-2794193254662759202');" onmouseout="out('-2794193254662759202');" style=""> 464                 int steps = 0;                                                                           </span>
<span class="1159991081674058958" onmouseenter="enter('1159991081674058958');" onmouseout="out('1159991081674058958');" style=""> 465                 if (json.has(&quot;hrm&quot;)) hrm = json.getInt(&quot;hrm&quot;);                                           </span>
<span class="2200733451486704836" onmouseenter="enter('2200733451486704836');" onmouseout="out('2200733451486704836');" style=""> 466                 if (json.has(&quot;stp&quot;)) steps = json.getInt(&quot;stp&quot;);                                         </span>
<span class="6603465025108101037" onmouseenter="enter('6603465025108101037');" onmouseout="out('6603465025108101037');" style=""> 467                 int activity = BangleJSSampleProvider.TYPE_ACTIVITY;                                     </span>
<span class="6065424140180877442" onmouseenter="enter('6065424140180877442');" onmouseout="out('6065424140180877442');" style=""> 468                 /*if (json.has(&quot;act&quot;)) {                                                                 </span>
<span class="-2439039461724633138" onmouseenter="enter('-2439039461724633138');" onmouseout="out('-2439039461724633138');" style=""> 469                     String actName = &quot;TYPE_&quot; + json.getString(&quot;act&quot;).toUpperCase();                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 470                     try {                                                                                </span>
<span class="-5191337226244238063" onmouseenter="enter('-5191337226244238063');" onmouseout="out('-5191337226244238063');" style=""> 471                         Field f = ActivityKind.class.getField(actName);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 472                         try {                                                                            </span>
<span class="8672601729845658913" onmouseenter="enter('8672601729845658913');" onmouseout="out('8672601729845658913');" style=""> 473                             activity = f.getInt(null);                                                   </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 474                         } catch (IllegalAccessException e) {                                             </span>
<span class="9211658540801898058" onmouseenter="enter('9211658540801898058');" onmouseout="out('9211658540801898058');" style=""> 475                             LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not readable&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476                         }                                                                                </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 477                     } catch (NoSuchFieldException e) {                                                   </span>
<span class="-4236592020282047640" onmouseenter="enter('-4236592020282047640');" onmouseout="out('-4236592020282047640');" style=""> 478                         LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not found&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479                     }                                                                                    </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 480                 }*/                                                                                      </span>
<span class="8668161863330653058" onmouseenter="enter('8668161863330653058');" onmouseout="out('8668161863330653058');" style=""> 481                 sample.setRawKind(activity);                                                             </span>
<span class="5935105042646692248" onmouseenter="enter('5935105042646692248');" onmouseout="out('5935105042646692248');" style=""> 482                 sample.setHeartRate(hrm);                                                                </span>
<span class="-4745425836300475693" onmouseenter="enter('-4745425836300475693');" onmouseout="out('-4745425836300475693');" style=""> 483                 sample.setSteps(steps);                                                                  </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style=""> 484                 try (DBHandler dbHandler = GBApplication.acquireDB()) {                                  </span>
<span class="1422413790142608640" onmouseenter="enter('1422413790142608640');" onmouseout="out('1422413790142608640');" style=""> 485                     Long userId = getUser(dbHandler.getDaoSession()).getId();                            </span>
<span class="3688300519339275893" onmouseenter="enter('3688300519339275893');" onmouseout="out('3688300519339275893');" style=""> 486                     Long deviceId = DBHelper.getDevice(getDevice(), dbHandler.getDaoSession()).getId();  </span>
<span class="-4884679916644886432" onmouseenter="enter('-4884679916644886432');" onmouseout="out('-4884679916644886432');" style=""><abbr title=" 487                     BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.getDaoSession());"> 487                     BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.gðŸ”µ</abbr></span>
<span class="6444535225867718796" onmouseenter="enter('6444535225867718796');" onmouseout="out('6444535225867718796');" style=""> 488                     sample.setDeviceId(deviceId);                                                        </span>
<span class="292659008851945780" onmouseenter="enter('292659008851945780');" onmouseout="out('292659008851945780');" style=""> 489                     sample.setUserId(userId);                                                            </span>
<span class="4765059548563428130" onmouseenter="enter('4765059548563428130');" onmouseout="out('4765059548563428130');" style=""> 490                     provider.addGBActivitySample(sample);                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 491                 } catch (Exception ex) {                                                                 </span>
<span class="1206810911036844482" onmouseenter="enter('1206810911036844482');" onmouseout="out('1206810911036844482');" style=""> 492                     LOG.warn(&quot;Error saving activity: &quot; + ex.getLocalizedMessage());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493                 }                                                                                        </span>
<span class="5171490897490639183" onmouseenter="enter('5171490897490639183');" onmouseout="out('5171490897490639183');" style=""> 494                 // push realtime data                                                                    </span>
<span class="-6833823710638969612" onmouseenter="enter('-6833823710638969612');" onmouseout="out('-6833823710638969612');" style=""> 495                 if (realtimeHRM || realtimeStep) {                                                       </span>
<span class="-9081146433891434428" onmouseenter="enter('-9081146433891434428');" onmouseout="out('-9081146433891434428');" style=""> 496                     Intent intent = new Intent(DeviceService.ACTION_REALTIME_SAMPLES)                    </span>
<span class="5807466852720832411" onmouseenter="enter('5807466852720832411');" onmouseout="out('5807466852720832411');" style=""> 497                             .putExtra(DeviceService.EXTRA_REALTIME_SAMPLE, sample);                      </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 498                     LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499                 }                                                                                        </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 500             } break;                                                                                     </span>
<span class="-3056288259405338320" onmouseenter="enter('-3056288259405338320');" onmouseout="out('-3056288259405338320');" style=""> 501             case &quot;http&quot;: {                                                                               </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 502                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 502                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddrðŸ”µ</abbr></span>
<span class="4471501014415506100" onmouseenter="enter('4471501014415506100');" onmouseout="out('4471501014415506100');" style=""> 503                 String _id=null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 504                 try {                                                                                    </span>
<span class="4672396922249032002" onmouseenter="enter('4672396922249032002');" onmouseout="out('4672396922249032002');" style=""> 505                     _id = json.getString(&quot;id&quot;);                                                          </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 506                 } catch (JSONException e) {                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507                 }                                                                                        </span>
<span class="5919143370037839830" onmouseenter="enter('5919143370037839830');" onmouseout="out('5919143370037839830');" style=""> 508                 final String id = _id;                                                                   </span>
<span  style=""> 509                                                                                                          </span>
<span  style=""> 510                                                                                                          </span>
<span class="-6992637283999421128" onmouseenter="enter('-6992637283999421128');" onmouseout="out('-6992637283999421128');" style=""><abbr title=" 511                 if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESS, false)) {"> 511                 if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESS, faðŸ”µ</abbr></span>
<span class="3585939051150823686" onmouseenter="enter('3585939051150823686');" onmouseout="out('3585939051150823686');" style=""> 512                     RequestQueue queue = Volley.newRequestQueue(getContext());                           </span>
<span class="5176519532323120311" onmouseenter="enter('5176519532323120311');" onmouseout="out('5176519532323120311');" style=""> 513                     String url = json.getString(&quot;url&quot;);                                                  </span>
<span  style=""> 514                                                                                                          </span>
<span class="-3545396317642083141" onmouseenter="enter('-3545396317642083141');" onmouseout="out('-3545396317642083141');" style=""> 515                     String _xmlPath = &quot;&quot;;                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 516                     try {                                                                                </span>
<span class="-6862471463745020928" onmouseenter="enter('-6862471463745020928');" onmouseout="out('-6862471463745020928');" style=""> 517                         _xmlPath = json.getString(&quot;xpath&quot;);                                              </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 518                     } catch (JSONException e) {                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519                     }                                                                                    </span>
<span class="605766333889403990" onmouseenter="enter('605766333889403990');" onmouseout="out('605766333889403990');" style=""> 520                     final String xmlPath = _xmlPath;                                                     </span>
<span class="-7325827083532572939" onmouseenter="enter('-7325827083532572939');" onmouseout="out('-7325827083532572939');" style=""> 521                     // Request a string response from the provided URL.                                  </span>
<span class="-7080864972701183073" onmouseenter="enter('-7080864972701183073');" onmouseout="out('-7080864972701183073');" style=""> 522                     StringRequest stringRequest = new StringRequest(Request.Method.GET, url,             </span>
<span class="1580018343670400637" onmouseenter="enter('1580018343670400637');" onmouseout="out('1580018343670400637');" style=""> 523                             new Response.Listener&lt;String&gt;() {                                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 524                                 @Override                                                                </span>
<span class="2219137294630149657" onmouseenter="enter('2219137294630149657');" onmouseout="out('2219137294630149657');" style=""> 525                                 public void onResponse(String response) {                                </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 526                                     JSONObject o = new JSONObject();                                     </span>
<span class="3496993666001094453" onmouseenter="enter('3496993666001094453');" onmouseout="out('3496993666001094453');" style=""> 527                                     if (xmlPath.length() != 0) {                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 528                                         try {                                                            </span>
<span class="5597187660883583119" onmouseenter="enter('5597187660883583119');" onmouseout="out('5597187660883583119');" style=""><abbr title=" 529                                             InputSource inputXML = new InputSource(new StringReader(response));"> 529                                             InputSource inputXML = new InputSource(new StringReader(respoðŸ”µ</abbr></span>
<span class="-160158441380049344" onmouseenter="enter('-160158441380049344');" onmouseout="out('-160158441380049344');" style=""> 530                                             XPath xPath = XPathFactory.newInstance().newXPath();         </span>
<span class="-5056989228059087382" onmouseenter="enter('-5056989228059087382');" onmouseout="out('-5056989228059087382');" style=""> 531                                             response = xPath.evaluate(xmlPath, inputXML);                </span>
<span class="6902166904876459873" onmouseenter="enter('6902166904876459873');" onmouseout="out('6902166904876459873');" style=""> 532                                         } catch (Exception error) {                                      </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 533                                             uartTxJSONError(&quot;http&quot;, error.toString(),id);                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 534                                             return;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                                         }                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536                                     }                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 537                                     try {                                                                </span>
<span class="6603605385044119606" onmouseenter="enter('6603605385044119606');" onmouseout="out('6603605385044119606');" style=""> 538                                         o.put(&quot;t&quot;, &quot;http&quot;);                                              </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 539                                         if( id!=null)                                                    </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 540                                             o.put(&quot;id&quot;, id);                                             </span>
<span class="-7019821812941989411" onmouseenter="enter('-7019821812941989411');" onmouseout="out('-7019821812941989411');" style=""> 541                                         o.put(&quot;resp&quot;, response);                                         </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 542                                     } catch (JSONException e) {                                          </span>
<span class="5084509021389731794" onmouseenter="enter('5084509021389731794');" onmouseout="out('5084509021389731794');" style=""><abbr title=" 543                                         GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 543                                         GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544                                     }                                                                    </span>
<span class="-4140114778756524985" onmouseenter="enter('-4140114778756524985');" onmouseout="out('-4140114778756524985');" style=""> 545                                     uartTxJSON(&quot;http&quot;, o);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546                                 }                                                                        </span>
<span class="4760556576659557486" onmouseenter="enter('4760556576659557486');" onmouseout="out('4760556576659557486');" style=""> 547                             }, new Response.ErrorListener() {                                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 548                         @Override                                                                        </span>
<span class="3365806574504816618" onmouseenter="enter('3365806574504816618');" onmouseout="out('3365806574504816618');" style=""> 549                         public void onErrorResponse(VolleyError error) {                                 </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 550                             JSONObject o = new JSONObject();                                             </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 551                             uartTxJSONError(&quot;http&quot;, error.toString(),id);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552                         }                                                                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 553                     });                                                                                  </span>
<span class="-2087140764948748418" onmouseenter="enter('-2087140764948748418');" onmouseout="out('-2087140764948748418');" style=""> 554                     queue.add(stringRequest);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 555                 } else {                                                                                 </span>
<span class="-204746163834141844" onmouseenter="enter('-204746163834141844');" onmouseout="out('-204746163834141844');" style=""> 556                     if (BuildConfig.INTERNET_ACCESS)                                                     </span>
<span class="-1860415774351364303" onmouseenter="enter('-1860415774351364303');" onmouseout="out('-1860415774351364303');" style=""><abbr title=" 557                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device Settings&quot;,id);"> 557                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device SðŸ”µ</abbr></span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 558                     else                                                                                 </span>
<span class="-8529240479352607945" onmouseenter="enter('-8529240479352607945');" onmouseout="out('-8529240479352607945');" style=""><abbr title=" 559                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;,id);"> 559                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560                 }                                                                                        </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 561             } break;                                                                                     </span>
<span class="7434952261878113170" onmouseenter="enter('7434952261878113170');" onmouseout="out('7434952261878113170');" style=""> 562             case &quot;intent&quot;: {                                                                             </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 563                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 563                 Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddrðŸ”µ</abbr></span>
<span class="-3997484102524704678" onmouseenter="enter('-3997484102524704678');" onmouseout="out('-3997484102524704678');" style=""> 564                 if (devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) {                                </span>
<span class="7885860666276152502" onmouseenter="enter('7885860666276152502');" onmouseout="out('7885860666276152502');" style=""> 565                     String action = json.getString(&quot;action&quot;);                                            </span>
<span class="-6778424845662998727" onmouseenter="enter('-6778424845662998727');" onmouseout="out('-6778424845662998727');" style=""> 566                     JSONObject extra = json.getJSONObject(&quot;extra&quot;);                                      </span>
<span class="5907617214453163300" onmouseenter="enter('5907617214453163300');" onmouseout="out('5907617214453163300');" style=""> 567                     Intent in = new Intent();                                                            </span>
<span class="-8779884887971893320" onmouseenter="enter('-8779884887971893320');" onmouseout="out('-8779884887971893320');" style=""> 568                     in.setAction(action);                                                                </span>
<span class="-5835095174807794521" onmouseenter="enter('-5835095174807794521');" onmouseout="out('-5835095174807794521');" style=""> 569                     if (extra != null) {                                                                 </span>
<span class="7421222014058952195" onmouseenter="enter('7421222014058952195');" onmouseout="out('7421222014058952195');" style=""> 570                         Iterator&lt;String&gt; iter = extra.keys();                                            </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 571                         while (iter.hasNext()) {                                                         </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 572                             String key = iter.next();                                                    </span>
<span class="-6860780283306876147" onmouseenter="enter('-6860780283306876147');" onmouseout="out('-6860780283306876147');" style=""> 573                             in.putExtra(key, extra.getString(key));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 575                     }                                                                                    </span>
<span class="6658078666630545861" onmouseenter="enter('6658078666630545861');" onmouseout="out('6658078666630545861');" style=""> 576                     LOG.info(&quot;Sending intent &quot; + action);                                                </span>
<span class="-5369611568799868297" onmouseenter="enter('-5369611568799868297');" onmouseout="out('-5369611568799868297');" style=""> 577                     this.getContext().getApplicationContext().sendBroadcast(in);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 578                 } else {                                                                                 </span>
<span class="7018402905003983802" onmouseenter="enter('7018402905003983802');" onmouseout="out('7018402905003983802');" style=""><abbr title=" 579                     uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge Device Settings&quot;);"> 579                     uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge Device SetðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581             }                                                                                            </span>
<span class="-2384932350282687845" onmouseenter="enter('-2384932350282687845');" onmouseout="out('-2384932350282687845');" style=""> 582             default : {                                                                                  </span>
<span class="880605181182979788" onmouseenter="enter('880605181182979788');" onmouseout="out('880605181182979788');" style=""> 583                 LOG.info(&quot;UART RX JSON packet type &#x27;&quot;+packetType+&quot;&#x27; not understood.&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586     }                                                                                                    </span>
<span  style=""> 587                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 588     @Override                                                                                            </span>
<span class="5766835775206074860" onmouseenter="enter('5766835775206074860');" onmouseout="out('5766835775206074860');" style=""> 589     public boolean onCharacteristicChanged(BluetoothGatt gatt,                                           </span>
<span class="-4605279869462858246" onmouseenter="enter('-4605279869462858246');" onmouseout="out('-4605279869462858246');" style=""> 590                                            BluetoothGattCharacteristic characteristic) {                 </span>
<span class="3568353468682512593" onmouseenter="enter('3568353468682512593');" onmouseout="out('3568353468682512593');" style=""> 591         if (super.onCharacteristicChanged(gatt, characteristic)) {                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 592             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593         }                                                                                                </span>
<span class="5227655087294118325" onmouseenter="enter('5227655087294118325');" onmouseout="out('5227655087294118325');" style=""> 594         if (BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX.equals(characteristic.getUuid())) {     </span>
<span class="5982523523606215133" onmouseenter="enter('5982523523606215133');" onmouseout="out('5982523523606215133');" style=""> 595             byte[] chars = characteristic.getValue();                                                    </span>
<span class="616145045349787748" onmouseenter="enter('616145045349787748');" onmouseout="out('616145045349787748');" style=""> 596             // check to see if we get more data - if so, increase out MTU for sending                    </span>
<span class="-514373143088406372" onmouseenter="enter('-514373143088406372');" onmouseout="out('-514373143088406372');" style=""> 597             if (allowHighMTU &amp;&amp; chars.length &gt; mtuSize)                                                  </span>
<span class="4158896835387507605" onmouseenter="enter('4158896835387507605');" onmouseout="out('4158896835387507605');" style=""> 598                 mtuSize = chars.length;                                                                  </span>
<span class="2539938136572489105" onmouseenter="enter('2539938136572489105');" onmouseout="out('2539938136572489105');" style=""> 599             String packetStr = new String(chars);                                                        </span>
<span class="-8749842360460534491" onmouseenter="enter('-8749842360460534491');" onmouseout="out('-8749842360460534491');" style=""> 600             LOG.info(&quot;RX: &quot; + packetStr);                                                                </span>
<span class="6081730255717431423" onmouseenter="enter('6081730255717431423');" onmouseout="out('6081730255717431423');" style=""> 601             // logging                                                                                   </span>
<span class="-5745508240241304992" onmouseenter="enter('-5745508240241304992');" onmouseout="out('-5745508240241304992');" style=""> 602             receiveHistory += packetStr;                                                                 </span>
<span class="3030748261717732019" onmouseenter="enter('3030748261717732019');" onmouseout="out('3030748261717732019');" style=""> 603             if (receiveHistory.length() &gt; MAX_RECEIVE_HISTORY_CHARS)                                     </span>
<span class="2384681518975537665" onmouseenter="enter('2384681518975537665');" onmouseout="out('2384681518975537665');" style=""><abbr title=" 604                 receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CHARS);"> 604                 receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CðŸ”µ</abbr></span>
<span class="4345605670928647371" onmouseenter="enter('4345605670928647371');" onmouseout="out('4345605670928647371');" style=""> 605             // split into input lines                                                                    </span>
<span class="5259079271083901413" onmouseenter="enter('5259079271083901413');" onmouseout="out('5259079271083901413');" style=""> 606             receivedLine += packetStr;                                                                   </span>
<span class="-2556332053060264516" onmouseenter="enter('-2556332053060264516');" onmouseout="out('-2556332053060264516');" style=""> 607             while (receivedLine.contains(&quot;\n&quot;)) {                                                        </span>
<span class="4579450793956603432" onmouseenter="enter('4579450793956603432');" onmouseout="out('4579450793956603432');" style=""> 608                 int p = receivedLine.indexOf(&quot;\n&quot;);                                                      </span>
<span class="-477187957539062569" onmouseenter="enter('-477187957539062569');" onmouseout="out('-477187957539062569');" style=""> 609                 String line =  receivedLine.substring(0,p-1);                                            </span>
<span class="8894037851537473877" onmouseenter="enter('8894037851537473877');" onmouseout="out('8894037851537473877');" style=""> 610                 receivedLine = receivedLine.substring(p+1);                                              </span>
<span class="-3428869778620909618" onmouseenter="enter('-3428869778620909618');" onmouseout="out('-3428869778620909618');" style=""> 611                 handleUartRxLine(line);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612             }                                                                                            </span>
<span class="-7051609494506194757" onmouseenter="enter('-7051609494506194757');" onmouseout="out('-7051609494506194757');" style=""> 613             // Send an intent with new data                                                              </span>
<span class="-223393600950927979" onmouseenter="enter('-223393600950927979');" onmouseout="out('-223393600950927979');" style=""> 614             Intent intent = new Intent(BangleJSDeviceSupport.BANGLEJS_COMMAND_RX);                       </span>
<span class="-5525767627942220600" onmouseenter="enter('-5525767627942220600');" onmouseout="out('-5525767627942220600');" style=""> 615             intent.putExtra(&quot;DATA&quot;, packetStr);                                                          </span>
<span class="5708963109403024105" onmouseenter="enter('5708963109403024105');" onmouseout="out('5708963109403024105');" style=""> 616             intent.putExtra(&quot;SEQ&quot;, bangleCommandSeq++);                                                  </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 617             LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 619         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620     }                                                                                                    </span>
<span  style=""> 621                                                                                                          </span>
<span  style=""> 622                                                                                                          </span>
<span class="3689734917392452830" onmouseenter="enter('3689734917392452830');" onmouseout="out('3689734917392452830');" style=""> 623     void transmitTime(TransactionBuilder builder) {                                                      </span>
<span class="-580696616137890311" onmouseenter="enter('-580696616137890311');" onmouseout="out('-580696616137890311');" style=""> 624       long ts = System.currentTimeMillis();                                                              </span>
<span class="2966270791537104856" onmouseenter="enter('2966270791537104856');" onmouseout="out('2966270791537104856');" style=""> 625       float tz = SimpleTimeZone.getDefault().getOffset(ts) / (1000 * 60 * 60.0f);                        </span>
<span class="3431964532899256755" onmouseenter="enter('3431964532899256755');" onmouseout="out('3431964532899256755');" style=""> 626       // set time                                                                                        </span>
<span class="-1610279467427834467" onmouseenter="enter('-1610279467427834467');" onmouseout="out('-1610279467427834467');" style=""> 627       String cmd = &quot;\u0010setTime(&quot;+(ts/1000)+&quot;);&quot;;                                                      </span>
<span class="-8332305144616549872" onmouseenter="enter('-8332305144616549872');" onmouseout="out('-8332305144616549872');" style=""> 628       // set timezone                                                                                    </span>
<span class="-5517412366789003339" onmouseenter="enter('-5517412366789003339');" onmouseout="out('-5517412366789003339');" style=""> 629       cmd += &quot;E.setTimeZone(&quot;+tz+&quot;);&quot;;                                                                   </span>
<span class="-1545435846395421943" onmouseenter="enter('-1545435846395421943');" onmouseout="out('-1545435846395421943');" style=""> 630       // write timezone to settings                                                                      </span>
<span class="-5908148183258021619" onmouseenter="enter('-5908148183258021619');" onmouseout="out('-5908148183258021619');" style=""><abbr title=" 631       cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;Storage&#x27;).readJSON(&#x27;setting.json&#x27;,1))&quot;;"> 631       cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;StorageðŸ”µ</abbr></span>
<span class="4089130236590622366" onmouseenter="enter('4089130236590622366');" onmouseout="out('4089130236590622366');" style=""> 632       uartTx(builder, cmd+&quot;\n&quot;);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 633     }                                                                                                    </span>
<span  style=""> 634                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 635     @Override                                                                                            </span>
<span class="-5141762163842231173" onmouseenter="enter('-5141762163842231173');" onmouseout="out('-5141762163842231173');" style=""> 636     public boolean useAutoConnect() {                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 637         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 638     }                                                                                                    </span>
<span  style=""> 639                                                                                                          </span>
<span class="-8620112809460611919" onmouseenter="enter('-8620112809460611919');" onmouseout="out('-8620112809460611919');" style=""> 640     private String renderUnicodeWordAsImage(String word) {                                               </span>
<span class="9035541491240023486" onmouseenter="enter('9035541491240023486');" onmouseout="out('9035541491240023486');" style=""> 641         // check for emoji                                                                               </span>
<span class="5486434163020554131" onmouseenter="enter('5486434163020554131');" onmouseout="out('5486434163020554131');" style=""> 642         boolean hasEmoji = false;                                                                        </span>
<span class="-4354250430909135512" onmouseenter="enter('-4354250430909135512');" onmouseout="out('-4354250430909135512');" style=""> 643         if (EmojiUtils.getAllEmojis()==null)                                                             </span>
<span class="-4263391647615423897" onmouseenter="enter('-4263391647615423897');" onmouseout="out('-4263391647615423897');" style=""> 644             EmojiManager.initEmojiData(GBApplication.getContext());                                      </span>
<span class="7493806979185135357" onmouseenter="enter('7493806979185135357');" onmouseout="out('7493806979185135357');" style=""> 645         for(Emoji emoji : EmojiUtils.getAllEmojis())                                                     </span>
<span class="-5951281087173806711" onmouseenter="enter('-5951281087173806711');" onmouseout="out('-5951281087173806711');" style=""> 646             if (word.contains(emoji.getEmoji())) hasEmoji = true;                                        </span>
<span class="2890001900011943869" onmouseenter="enter('2890001900011943869');" onmouseout="out('2890001900011943869');" style=""> 647         // if we had emoji, ensure we create 3 bit color (not 1 bit B&amp;W)                                 </span>
<span class="-5597957252839048845" onmouseenter="enter('-5597957252839048845');" onmouseout="out('-5597957252839048845');" style=""><abbr title=" 648         return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : BangleJSBitmapStyle.MONOCHROME);"> 648         return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649     }                                                                                                    </span>
<span  style=""> 650                                                                                                          </span>
<span class="8776024667736839740" onmouseenter="enter('8776024667736839740');" onmouseout="out('8776024667736839740');" style=""> 651     public String renderUnicodeAsImage(String txt) {                                                     </span>
<span class="-1342218611990734243" onmouseenter="enter('-1342218611990734243');" onmouseout="out('-1342218611990734243');" style=""> 652         if (txt==null) return null;                                                                      </span>
<span class="-2990212439896506505" onmouseenter="enter('-2990212439896506505');" onmouseout="out('-2990212439896506505');" style=""> 653         /* If we&#x27;re not doing conversion, pass this right back (we use the EmojiConverter                </span>
<span class="-9019482477548156237" onmouseenter="enter('-9019482477548156237');" onmouseout="out('-9019482477548156237');" style=""> 654         As we would have done if BangleJSCoordinator.supportsUnicodeEmojis had reported false */         </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 655         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));</span>
<span class="6036337086743190632" onmouseenter="enter('6036337086743190632');" onmouseout="out('6036337086743190632');" style=""> 656         if (!devicePrefs.getBoolean(PREF_BANGLEJS_TEXT_BITMAP, false))                                   </span>
<span class="-6218899606023063069" onmouseenter="enter('-6218899606023063069');" onmouseout="out('-6218899606023063069');" style=""> 657             return EmojiConverter.convertUnicodeEmojiToAscii(txt, GBApplication.getContext());           </span>
<span class="292577723455835940" onmouseenter="enter('292577723455835940');" onmouseout="out('292577723455835940');" style=""> 658         // Otherwise split up and check each word                                                        </span>
<span class="-5288421538986521183" onmouseenter="enter('-5288421538986521183');" onmouseout="out('-5288421538986521183');" style=""> 659         String word = &quot;&quot;, result = &quot;&quot;;                                                                   </span>
<span class="-760381533077121579" onmouseenter="enter('-760381533077121579');" onmouseout="out('-760381533077121579');" style=""> 660         boolean needsTranslate = false;                                                                  </span>
<span class="-4776297315441687962" onmouseenter="enter('-4776297315441687962');" onmouseout="out('-4776297315441687962');" style=""> 661         for (int i=0;i&lt;txt.length();i++) {                                                               </span>
<span class="-3301384702044321827" onmouseenter="enter('-3301384702044321827');" onmouseout="out('-3301384702044321827');" style=""> 662             char ch = txt.charAt(i);                                                                     </span>
<span class="-3018677457763070108" onmouseenter="enter('-3018677457763070108');" onmouseout="out('-3018677457763070108');" style=""> 663             if (&quot; -_/:.,?!&#x27;\&quot;&amp;*()&quot;.indexOf(ch)&gt;=0) {                                                     </span>
<span class="1318526908393735015" onmouseenter="enter('1318526908393735015');" onmouseout="out('1318526908393735015');" style=""> 664                 // word split                                                                            </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style=""> 665                 if (needsTranslate) { // convert word                                                    </span>
<span class="-3387652020968698915" onmouseenter="enter('-3387652020968698915');" onmouseout="out('-3387652020968698915');" style=""> 666                     result += renderUnicodeWordAsImage(word)+ch;                                         </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style=""> 667                 } else { // or just copy across                                                          </span>
<span class="1121164921789299019" onmouseenter="enter('1121164921789299019');" onmouseout="out('1121164921789299019');" style=""> 668                     result += word+ch;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 669                 }                                                                                        </span>
<span class="4599818924517102902" onmouseenter="enter('4599818924517102902');" onmouseout="out('4599818924517102902');" style=""> 670                 word = &quot;&quot;;                                                                               </span>
<span class="1499680785627976825" onmouseenter="enter('1499680785627976825');" onmouseout="out('1499680785627976825');" style=""> 671                 needsTranslate = false;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 672             } else {                                                                                     </span>
<span class="5371833621916626168" onmouseenter="enter('5371833621916626168');" onmouseout="out('5371833621916626168');" style=""> 673                 // TODO: better check?                                                                   </span>
<span class="-123072587783183541" onmouseenter="enter('-123072587783183541');" onmouseout="out('-123072587783183541');" style=""> 674                 if (ch&lt;0 || ch&gt;255) needsTranslate = true;                                               </span>
<span class="2225265087012361140" onmouseenter="enter('2225265087012361140');" onmouseout="out('2225265087012361140');" style=""> 675                 word += ch;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677         }                                                                                                </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style=""> 678         if (needsTranslate) { // convert word                                                            </span>
<span class="-2531563633600833789" onmouseenter="enter('-2531563633600833789');" onmouseout="out('-2531563633600833789');" style=""> 679             result += renderUnicodeWordAsImage(word);                                                    </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style=""> 680         } else { // or just copy across                                                                  </span>
<span class="-4182205432270767968" onmouseenter="enter('-4182205432270767968');" onmouseout="out('-4182205432270767968');" style=""> 681             result += word;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 682         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 683         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684     }                                                                                                    </span>
<span  style=""> 685                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 686     @Override                                                                                            </span>
<span class="-116609517646424186" onmouseenter="enter('-116609517646424186');" onmouseout="out('-116609517646424186');" style=""> 687     public void onNotification(NotificationSpec notificationSpec) {                                      </span>
<span class="7244891213408121655" onmouseenter="enter('7244891213408121655');" onmouseout="out('7244891213408121655');" style=""> 688         for (int i=0;i&lt;notificationSpec.attachedActions.size();i++) {                                    </span>
<span class="-1299099168286401629" onmouseenter="enter('-1299099168286401629');" onmouseout="out('-1299099168286401629');" style=""> 689             NotificationSpec.Action action = notificationSpec.attachedActions.get(i);                    </span>
<span class="1218815619539919953" onmouseenter="enter('1218815619539919953');" onmouseout="out('1218815619539919953');" style=""> 690             if (action.type==NotificationSpec.Action.TYPE_WEARABLE_REPLY)                                </span>
<span class="-2487072541266275253" onmouseenter="enter('-2487072541266275253');" onmouseout="out('-2487072541266275253');" style=""><abbr title=" 691                 mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.getId()&lt;&lt;4) + i + 1)); // wow. This should be easier!"> 691                 mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.gðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 693         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 694             JSONObject o = new JSONObject();                                                             </span>
<span class="-3237033879846899756" onmouseenter="enter('-3237033879846899756');" onmouseout="out('-3237033879846899756');" style=""> 695             o.put(&quot;t&quot;, &quot;notify&quot;);                                                                        </span>
<span class="-2996816801319654727" onmouseenter="enter('-2996816801319654727');" onmouseout="out('-2996816801319654727');" style=""> 696             o.put(&quot;id&quot;, notificationSpec.getId());                                                       </span>
<span class="7446549792523373865" onmouseenter="enter('7446549792523373865');" onmouseout="out('7446549792523373865');" style=""> 697             o.put(&quot;src&quot;, notificationSpec.sourceName);                                                   </span>
<span class="-2496842413615993216" onmouseenter="enter('-2496842413615993216');" onmouseout="out('-2496842413615993216');" style=""> 698             o.put(&quot;title&quot;, renderUnicodeAsImage(notificationSpec.title));                                </span>
<span class="8572918879739705875" onmouseenter="enter('8572918879739705875');" onmouseout="out('8572918879739705875');" style=""> 699             o.put(&quot;subject&quot;, renderUnicodeAsImage(notificationSpec.subject));                            </span>
<span class="-1911849092192349426" onmouseenter="enter('-1911849092192349426');" onmouseout="out('-1911849092192349426');" style=""> 700             o.put(&quot;body&quot;, renderUnicodeAsImage(notificationSpec.body));                                  </span>
<span class="-504952153198563265" onmouseenter="enter('-504952153198563265');" onmouseout="out('-504952153198563265');" style=""> 701             o.put(&quot;sender&quot;, renderUnicodeAsImage(notificationSpec.sender));                              </span>
<span class="-5726859549953031700" onmouseenter="enter('-5726859549953031700');" onmouseout="out('-5726859549953031700');" style=""> 702             o.put(&quot;tel&quot;, notificationSpec.phoneNumber);                                                  </span>
<span class="7885351870399476726" onmouseenter="enter('7885351870399476726');" onmouseout="out('7885351870399476726');" style=""> 703             uartTxJSON(&quot;onNotification&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 704         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 705             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 707     }                                                                                                    </span>
<span  style=""> 708                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 709     @Override                                                                                            </span>
<span class="-1102873404195143085" onmouseenter="enter('-1102873404195143085');" onmouseout="out('-1102873404195143085');" style=""> 710     public void onDeleteNotification(int id) {                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 711         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 712             JSONObject o = new JSONObject();                                                             </span>
<span class="8475479069823885977" onmouseenter="enter('8475479069823885977');" onmouseout="out('8475479069823885977');" style=""> 713             o.put(&quot;t&quot;, &quot;notify-&quot;);                                                                       </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 714             o.put(&quot;id&quot;, id);                                                                             </span>
<span class="4156835990201809715" onmouseenter="enter('4156835990201809715');" onmouseout="out('4156835990201809715');" style=""> 715             uartTxJSON(&quot;onDeleteNotification&quot;, o);                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 716         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 717             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719     }                                                                                                    </span>
<span  style=""> 720                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 721     @Override                                                                                            </span>
<span class="7164248173527032001" onmouseenter="enter('7164248173527032001');" onmouseout="out('7164248173527032001');" style=""> 722     public void onSetTime() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 723         try {                                                                                            </span>
<span class="-5785975329698273515" onmouseenter="enter('-5785975329698273515');" onmouseout="out('-5785975329698273515');" style=""> 724             TransactionBuilder builder = performInitialized(&quot;setTime&quot;);                                  </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 725             transmitTime(builder);                                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 726             builder.queue(getQueue());                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 727         } catch (Exception e) {                                                                          </span>
<span class="5000424150373642922" onmouseenter="enter('5000424150373642922');" onmouseout="out('5000424150373642922');" style=""><abbr title=" 728             GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 728             GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 730     }                                                                                                    </span>
<span  style=""> 731                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 732     @Override                                                                                            </span>
<span class="-6473317888357330260" onmouseenter="enter('-6473317888357330260');" onmouseout="out('-6473317888357330260');" style=""> 733     public void onSetAlarms(ArrayList&lt;? extends Alarm&gt; alarms) {                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 734         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 735             JSONObject o = new JSONObject();                                                             </span>
<span class="3488284827981638605" onmouseenter="enter('3488284827981638605');" onmouseout="out('3488284827981638605');" style=""> 736             o.put(&quot;t&quot;, &quot;alarm&quot;);                                                                         </span>
<span class="2586106610260987486" onmouseenter="enter('2586106610260987486');" onmouseout="out('2586106610260987486');" style=""> 737             JSONArray jsonalarms = new JSONArray();                                                      </span>
<span class="7012783305172244346" onmouseenter="enter('7012783305172244346');" onmouseout="out('7012783305172244346');" style=""> 738             o.put(&quot;d&quot;, jsonalarms);                                                                      </span>
<span  style=""> 739                                                                                                          </span>
<span class="-7996805109404385335" onmouseenter="enter('-7996805109404385335');" onmouseout="out('-7996805109404385335');" style=""> 740             for (Alarm alarm : alarms) {                                                                 </span>
<span class="-7206413691565762606" onmouseenter="enter('-7206413691565762606');" onmouseout="out('-7206413691565762606');" style=""> 741                 if (!alarm.getEnabled()) continue;                                                       </span>
<span class="1488433958727864154" onmouseenter="enter('1488433958727864154');" onmouseout="out('1488433958727864154');" style=""> 742                 JSONObject jsonalarm = new JSONObject();                                                 </span>
<span class="-2065505732499951357" onmouseenter="enter('-2065505732499951357');" onmouseout="out('-2065505732499951357');" style=""> 743                 jsonalarms.put(jsonalarm);                                                               </span>
<span  style=""> 744                                                                                                          </span>
<span class="169777398048646112" onmouseenter="enter('169777398048646112');" onmouseout="out('169777398048646112');" style=""> 745                 Calendar calendar = AlarmUtils.toCalendar(alarm);                                        </span>
<span  style=""> 746                                                                                                          </span>
<span class="6578593229745866209" onmouseenter="enter('6578593229745866209');" onmouseout="out('6578593229745866209');" style=""> 747                 jsonalarm.put(&quot;h&quot;, alarm.getHour());                                                     </span>
<span class="7461878622333576123" onmouseenter="enter('7461878622333576123');" onmouseout="out('7461878622333576123');" style=""> 748                 jsonalarm.put(&quot;m&quot;, alarm.getMinute());                                                   </span>
<span class="97057399767477313" onmouseenter="enter('97057399767477313');" onmouseout="out('97057399767477313');" style=""> 749                 jsonalarm.put(&quot;rep&quot;, alarm.getRepetition());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750             }                                                                                            </span>
<span class="7288963480750843606" onmouseenter="enter('7288963480750843606');" onmouseout="out('7288963480750843606');" style=""> 751             uartTxJSON(&quot;onSetAlarms&quot;, o);                                                                </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 752         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 753             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 754         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755     }                                                                                                    </span>
<span  style=""> 756                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 757     @Override                                                                                            </span>
<span class="8502851833159229707" onmouseenter="enter('8502851833159229707');" onmouseout="out('8502851833159229707');" style=""> 758     public void onSetCallState(CallSpec callSpec) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 759         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 760             JSONObject o = new JSONObject();                                                             </span>
<span class="4158854171585038558" onmouseenter="enter('4158854171585038558');" onmouseout="out('4158854171585038558');" style=""> 761             o.put(&quot;t&quot;, &quot;call&quot;);                                                                          </span>
<span class="3958892663366704764" onmouseenter="enter('3958892663366704764');" onmouseout="out('3958892663366704764');" style=""> 762             String cmdName = &quot;&quot;;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 763             try {                                                                                        </span>
<span class="-9009466648790586927" onmouseenter="enter('-9009466648790586927');" onmouseout="out('-9009466648790586927');" style=""> 764                 Field fields[] = callSpec.getClass().getDeclaredFields();                                </span>
<span class="-8522204470221494922" onmouseenter="enter('-8522204470221494922');" onmouseout="out('-8522204470221494922');" style=""> 765                 for (Field field : fields)                                                               </span>
<span class="-7797368603385788624" onmouseenter="enter('-7797368603385788624');" onmouseout="out('-7797368603385788624');" style=""><abbr title=" 766                     if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.command)"> 766                     if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.commandðŸ”µ</abbr></span>
<span class="8043037183581644681" onmouseenter="enter('8043037183581644681');" onmouseout="out('8043037183581644681');" style=""> 767                         cmdName = field.getName().substring(5).toLowerCase();                            </span>
<span class="-7581013626583319085" onmouseenter="enter('-7581013626583319085');" onmouseout="out('-7581013626583319085');" style=""> 768             } catch (IllegalAccessException e) {}                                                        </span>
<span class="-1085015235935761185" onmouseenter="enter('-1085015235935761185');" onmouseout="out('-1085015235935761185');" style=""> 769             o.put(&quot;cmd&quot;, cmdName);                                                                       </span>
<span class="8637280962137247636" onmouseenter="enter('8637280962137247636');" onmouseout="out('8637280962137247636');" style=""> 770             o.put(&quot;name&quot;, renderUnicodeAsImage(callSpec.name));                                          </span>
<span class="673690437593128793" onmouseenter="enter('673690437593128793');" onmouseout="out('673690437593128793');" style=""> 771             o.put(&quot;number&quot;, callSpec.number);                                                            </span>
<span class="-6546279892320681741" onmouseenter="enter('-6546279892320681741');" onmouseout="out('-6546279892320681741');" style=""> 772             uartTxJSON(&quot;onSetCallState&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 773         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 774             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776 }                                                                                                        </span>
<span  style=""> 777                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 778     @Override                                                                                            </span>
<span class="8238257195410140286" onmouseenter="enter('8238257195410140286');" onmouseout="out('8238257195410140286');" style=""> 779     public void onSetCannedMessages(CannedMessagesSpec cannedMessagesSpec) {                             </span>
<span  style=""> 780                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 781     }                                                                                                    </span>
<span  style=""> 782                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 783     @Override                                                                                            </span>
<span class="8228188929931998548" onmouseenter="enter('8228188929931998548');" onmouseout="out('8228188929931998548');" style=""> 784     public void onSetMusicState(MusicStateSpec stateSpec) {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 785         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 786             JSONObject o = new JSONObject();                                                             </span>
<span class="-92554745071265211" onmouseenter="enter('-92554745071265211');" onmouseout="out('-92554745071265211');" style=""> 787             o.put(&quot;t&quot;, &quot;musicstate&quot;);                                                                    </span>
<span class="8807632241012571777" onmouseenter="enter('8807632241012571777');" onmouseout="out('8807632241012571777');" style=""> 788             int musicState = stateSpec.state;                                                            </span>
<span class="-8234435338877590300" onmouseenter="enter('-8234435338877590300');" onmouseout="out('-8234435338877590300');" style=""> 789             String[] musicStates = {&quot;play&quot;, &quot;pause&quot;, &quot;stop&quot;, &quot;&quot;};                                        </span>
<span class="-9088398443169884235" onmouseenter="enter('-9088398443169884235');" onmouseout="out('-9088398443169884235');" style=""> 790             if (musicState&lt;0) musicState=3;                                                              </span>
<span class="2321591687835617567" onmouseenter="enter('2321591687835617567');" onmouseout="out('2321591687835617567');" style=""> 791             if (musicState&gt;=musicStates.length) musicState = musicStates.length-1;                       </span>
<span class="-1010325962977709940" onmouseenter="enter('-1010325962977709940');" onmouseout="out('-1010325962977709940');" style=""> 792             o.put(&quot;state&quot;, musicStates[musicState]);                                                     </span>
<span class="4362989328077723220" onmouseenter="enter('4362989328077723220');" onmouseout="out('4362989328077723220');" style=""> 793             o.put(&quot;position&quot;, stateSpec.position);                                                       </span>
<span class="-521013622091952719" onmouseenter="enter('-521013622091952719');" onmouseout="out('-521013622091952719');" style=""> 794             o.put(&quot;shuffle&quot;, stateSpec.shuffle);                                                         </span>
<span class="7992510141527813217" onmouseenter="enter('7992510141527813217');" onmouseout="out('7992510141527813217');" style=""> 795             o.put(&quot;repeat&quot;, stateSpec.repeat);                                                           </span>
<span class="-8798301955703322193" onmouseenter="enter('-8798301955703322193');" onmouseout="out('-8798301955703322193');" style=""> 796             uartTxJSON(&quot;onSetMusicState&quot;, o);                                                            </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 797         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 798             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800     }                                                                                                    </span>
<span  style=""> 801                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 802     @Override                                                                                            </span>
<span class="-4182706906721092498" onmouseenter="enter('-4182706906721092498');" onmouseout="out('-4182706906721092498');" style=""> 803     public void onSetMusicInfo(MusicSpec musicSpec) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 804         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 805             JSONObject o = new JSONObject();                                                             </span>
<span class="-21742499724689403" onmouseenter="enter('-21742499724689403');" onmouseout="out('-21742499724689403');" style=""> 806             o.put(&quot;t&quot;, &quot;musicinfo&quot;);                                                                     </span>
<span class="-7907833892429297395" onmouseenter="enter('-7907833892429297395');" onmouseout="out('-7907833892429297395');" style=""> 807             o.put(&quot;artist&quot;, renderUnicodeAsImage(musicSpec.artist));                                     </span>
<span class="6485281684850333943" onmouseenter="enter('6485281684850333943');" onmouseout="out('6485281684850333943');" style=""> 808             o.put(&quot;album&quot;, renderUnicodeAsImage(musicSpec.album));                                       </span>
<span class="6434659518035718811" onmouseenter="enter('6434659518035718811');" onmouseout="out('6434659518035718811');" style=""> 809             o.put(&quot;track&quot;, renderUnicodeAsImage(musicSpec.track));                                       </span>
<span class="-6589694811644482139" onmouseenter="enter('-6589694811644482139');" onmouseout="out('-6589694811644482139');" style=""> 810             o.put(&quot;dur&quot;, musicSpec.duration);                                                            </span>
<span class="-5969522677742802968" onmouseenter="enter('-5969522677742802968');" onmouseout="out('-5969522677742802968');" style=""> 811             o.put(&quot;c&quot;, musicSpec.trackCount);                                                            </span>
<span class="7704969334649219354" onmouseenter="enter('7704969334649219354');" onmouseout="out('7704969334649219354');" style=""> 812             o.put(&quot;n&quot;, musicSpec.trackNr);                                                               </span>
<span class="-567994157751048073" onmouseenter="enter('-567994157751048073');" onmouseout="out('-567994157751048073');" style=""> 813             uartTxJSON(&quot;onSetMusicInfo&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 814         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 815             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 816         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817     }                                                                                                    </span>
<span  style=""> 818                                                                                                          </span>
<span class="1808047972614051455" onmouseenter="enter('1808047972614051455');" onmouseout="out('1808047972614051455');" style=""> 819     private void transmitActivityStatus() {                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 820         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 821             JSONObject o = new JSONObject();                                                             </span>
<span class="-8158526622976442101" onmouseenter="enter('-8158526622976442101');" onmouseout="out('-8158526622976442101');" style=""> 822             o.put(&quot;t&quot;, &quot;act&quot;);                                                                           </span>
<span class="5593394621505017212" onmouseenter="enter('5593394621505017212');" onmouseout="out('5593394621505017212');" style=""> 823             o.put(&quot;hrm&quot;, realtimeHRM);                                                                   </span>
<span class="9069762361832051811" onmouseenter="enter('9069762361832051811');" onmouseout="out('9069762361832051811');" style=""> 824             o.put(&quot;stp&quot;, realtimeStep);                                                                  </span>
<span class="4361099818971426695" onmouseenter="enter('4361099818971426695');" onmouseout="out('4361099818971426695');" style=""> 825             o.put(&quot;int&quot;, realtimeHRMInterval);                                                           </span>
<span class="-8731247564001223528" onmouseenter="enter('-8731247564001223528');" onmouseout="out('-8731247564001223528');" style=""> 826             uartTxJSON(&quot;onEnableRealtimeSteps&quot;, o);                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 827         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 828             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830     }                                                                                                    </span>
<span  style=""> 831                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 832     @Override                                                                                            </span>
<span class="-8425797677863799500" onmouseenter="enter('-8425797677863799500');" onmouseout="out('-8425797677863799500');" style=""> 833     public void onEnableRealtimeSteps(boolean enable) {                                                  </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 834         if (enable == realtimeHRM) return;                                                               </span>
<span class="-5879371575258185595" onmouseenter="enter('-5879371575258185595');" onmouseout="out('-5879371575258185595');" style=""> 835         realtimeStep = enable;                                                                           </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 836         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837     }                                                                                                    </span>
<span  style=""> 838                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 839     @Override                                                                                            </span>
<span class="-4135655620136168708" onmouseenter="enter('-4135655620136168708');" onmouseout="out('-4135655620136168708');" style=""> 840     public void onInstallApp(Uri uri) {                                                                  </span>
<span  style=""> 841                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 842     }                                                                                                    </span>
<span  style=""> 843                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 844     @Override                                                                                            </span>
<span class="-3322711972275217450" onmouseenter="enter('-3322711972275217450');" onmouseout="out('-3322711972275217450');" style=""> 845     public void onAppInfoReq() {                                                                         </span>
<span  style=""> 846                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847     }                                                                                                    </span>
<span  style=""> 848                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 849     @Override                                                                                            </span>
<span class="1692097554900603024" onmouseenter="enter('1692097554900603024');" onmouseout="out('1692097554900603024');" style=""> 850     public void onAppStart(UUID uuid, boolean start) {                                                   </span>
<span  style=""> 851                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852     }                                                                                                    </span>
<span  style=""> 853                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 854     @Override                                                                                            </span>
<span class="7633110766708892729" onmouseenter="enter('7633110766708892729');" onmouseout="out('7633110766708892729');" style=""> 855     public void onAppDelete(UUID uuid) {                                                                 </span>
<span  style=""> 856                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 857     }                                                                                                    </span>
<span  style=""> 858                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 859     @Override                                                                                            </span>
<span class="2176182926116218619" onmouseenter="enter('2176182926116218619');" onmouseout="out('2176182926116218619');" style=""> 860     public void onAppConfiguration(UUID appUuid, String config, Integer id) {                            </span>
<span  style=""> 861                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862     }                                                                                                    </span>
<span  style=""> 863                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 864     @Override                                                                                            </span>
<span class="-2513514137107402976" onmouseenter="enter('-2513514137107402976');" onmouseout="out('-2513514137107402976');" style=""> 865     public void onAppReorder(UUID[] uuids) {                                                             </span>
<span  style=""> 866                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867     }                                                                                                    </span>
<span  style=""> 868                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 869     @Override                                                                                            </span>
<span class="3881968248613188942" onmouseenter="enter('3881968248613188942');" onmouseout="out('3881968248613188942');" style=""> 870     public void onFetchRecordedData(int dataTypes) {                                                     </span>
<span class="-3849076454550892314" onmouseenter="enter('-3849076454550892314');" onmouseout="out('-3849076454550892314');" style=""> 871         if (dataTypes == RecordedDataTypes.TYPE_DEBUGLOGS) {                                             </span>
<span class="1579212162814293327" onmouseenter="enter('1579212162814293327');" onmouseout="out('1579212162814293327');" style=""> 872             File dir;                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 873             try {                                                                                        </span>
<span class="-3526927992489947407" onmouseenter="enter('-3526927992489947407');" onmouseout="out('-3526927992489947407');" style=""> 874                 dir = FileUtils.getExternalFilesDir();                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 875             } catch (IOException e) {                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 876                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877             }                                                                                            </span>
<span class="-8623321881845197728" onmouseenter="enter('-8623321881845197728');" onmouseout="out('-8623321881845197728');" style=""> 878             SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd-HHmmss&quot;, Locale.US);            </span>
<span class="-3655538185251554118" onmouseenter="enter('-3655538185251554118');" onmouseout="out('-3655538185251554118');" style=""> 879             String filename = &quot;banglejs_debug_&quot; + dateFormat.format(new Date()) + &quot;.log&quot;;                </span>
<span class="2454422670405906587" onmouseenter="enter('2454422670405906587');" onmouseout="out('2454422670405906587');" style=""> 880             File outputFile = new File(dir, filename );                                                  </span>
<span class="6676810503762950417" onmouseenter="enter('6676810503762950417');" onmouseout="out('6676810503762950417');" style=""> 881             LOG.warn(&quot;Writing log to &quot;+outputFile.toString());                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 882             try {                                                                                        </span>
<span class="-8771066680414961708" onmouseenter="enter('-8771066680414961708');" onmouseout="out('-8771066680414961708');" style=""> 883                 BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile));                  </span>
<span class="4633875208200868523" onmouseenter="enter('4633875208200868523');" onmouseout="out('4633875208200868523');" style=""> 884                 writer.write(receiveHistory);                                                            </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 885                 writer.close();                                                                          </span>
<span class="-3019360337557251714" onmouseenter="enter('-3019360337557251714');" onmouseout="out('-3019360337557251714');" style=""> 886                 receiveHistory = &quot;&quot;;                                                                     </span>
<span class="3582332183058181346" onmouseenter="enter('3582332183058181346');" onmouseout="out('3582332183058181346');" style=""> 887                 GB.toast(getContext(), &quot;Log written to &quot;+filename, Toast.LENGTH_LONG, GB.INFO);          </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 888             } catch (IOException e) {                                                                    </span>
<span class="4694495530853371438" onmouseenter="enter('4694495530853371438');" onmouseout="out('4694495530853371438');" style=""> 889                 LOG.warn(&quot;Could not write to file&quot;, e);                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 890                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 891             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 892         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 893     }                                                                                                    </span>
<span  style=""> 894                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 895     @Override                                                                                            </span>
<span class="3589048831688325527" onmouseenter="enter('3589048831688325527');" onmouseout="out('3589048831688325527');" style=""> 896     public void onReset(int flags) {                                                                     </span>
<span  style=""> 897                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 898     }                                                                                                    </span>
<span  style=""> 899                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 900     @Override                                                                                            </span>
<span class="-9008385526233139735" onmouseenter="enter('-9008385526233139735');" onmouseout="out('-9008385526233139735');" style=""> 901     public void onHeartRateTest() {                                                                      </span>
<span  style=""> 902                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903     }                                                                                                    </span>
<span  style=""> 904                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 905     @Override                                                                                            </span>
<span class="2383065190612615413" onmouseenter="enter('2383065190612615413');" onmouseout="out('2383065190612615413');" style=""> 906     public void onEnableRealtimeHeartRateMeasurement(boolean enable) {                                   </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 907         if (enable == realtimeHRM) return;                                                               </span>
<span class="8804907312000263363" onmouseenter="enter('8804907312000263363');" onmouseout="out('8804907312000263363');" style=""> 908         realtimeHRM = enable;                                                                            </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 909         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 910     }                                                                                                    </span>
<span  style=""> 911                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 912     @Override                                                                                            </span>
<span class="-3287587973518064190" onmouseenter="enter('-3287587973518064190');" onmouseout="out('-3287587973518064190');" style=""> 913     public void onFindDevice(boolean start) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 914         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 915             JSONObject o = new JSONObject();                                                             </span>
<span class="4130381404080081417" onmouseenter="enter('4130381404080081417');" onmouseout="out('4130381404080081417');" style=""> 916             o.put(&quot;t&quot;, &quot;find&quot;);                                                                          </span>
<span class="6818313613707459779" onmouseenter="enter('6818313613707459779');" onmouseout="out('6818313613707459779');" style=""> 917             o.put(&quot;n&quot;, start);                                                                           </span>
<span class="5958886073956724015" onmouseenter="enter('5958886073956724015');" onmouseout="out('5958886073956724015');" style=""> 918             uartTxJSON(&quot;onFindDevice&quot;, o);                                                               </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 919         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 920             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 921         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 922     }                                                                                                    </span>
<span  style=""> 923                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 924     @Override                                                                                            </span>
<span class="-1926054327985162362" onmouseenter="enter('-1926054327985162362');" onmouseout="out('-1926054327985162362');" style=""> 925     public void onSetConstantVibration(int integer) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 926         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 927             JSONObject o = new JSONObject();                                                             </span>
<span class="4547736712460874928" onmouseenter="enter('4547736712460874928');" onmouseout="out('4547736712460874928');" style=""> 928             o.put(&quot;t&quot;, &quot;vibrate&quot;);                                                                       </span>
<span class="-4243820256325497798" onmouseenter="enter('-4243820256325497798');" onmouseout="out('-4243820256325497798');" style=""> 929             o.put(&quot;n&quot;, integer);                                                                         </span>
<span class="-1000088439791572503" onmouseenter="enter('-1000088439791572503');" onmouseout="out('-1000088439791572503');" style=""> 930             uartTxJSON(&quot;onSetConstantVibration&quot;, o);                                                     </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 931         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 932             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 933         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 934     }                                                                                                    </span>
<span  style=""> 935                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 936     @Override                                                                                            </span>
<span class="-3293819866797459784" onmouseenter="enter('-3293819866797459784');" onmouseout="out('-3293819866797459784');" style=""> 937     public void onScreenshotReq() {                                                                      </span>
<span  style=""> 938                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939     }                                                                                                    </span>
<span  style=""> 940                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 941     @Override                                                                                            </span>
<span class="-2597044235576493624" onmouseenter="enter('-2597044235576493624');" onmouseout="out('-2597044235576493624');" style=""> 942     public void onEnableHeartRateSleepSupport(boolean enable) {                                          </span>
<span  style=""> 943                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 944     }                                                                                                    </span>
<span  style=""> 945                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 946     @Override                                                                                            </span>
<span class="-5895120009761092080" onmouseenter="enter('-5895120009761092080');" onmouseout="out('-5895120009761092080');" style=""> 947     public void onSetHeartRateMeasurementInterval(int seconds) {                                         </span>
<span class="-1003654780605811203" onmouseenter="enter('-1003654780605811203');" onmouseout="out('-1003654780605811203');" style=""> 948         realtimeHRMInterval = seconds;                                                                   </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 949         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 950     }                                                                                                    </span>
<span  style=""> 951                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 952     @Override                                                                                            </span>
<span class="-7200644583722212481" onmouseenter="enter('-7200644583722212481');" onmouseout="out('-7200644583722212481');" style=""> 953     public void onAddCalendarEvent(CalendarEventSpec calendarEventSpec) {                                </span>
<span  style=""> 954                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 955     }                                                                                                    </span>
<span  style=""> 956                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 957     @Override                                                                                            </span>
<span class="2890386202777848228" onmouseenter="enter('2890386202777848228');" onmouseout="out('2890386202777848228');" style=""> 958     public void onDeleteCalendarEvent(byte type, long id) {                                              </span>
<span  style=""> 959                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 960     }                                                                                                    </span>
<span  style=""> 961                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 962     @Override                                                                                            </span>
<span class="349159621018699769" onmouseenter="enter('349159621018699769');" onmouseout="out('349159621018699769');" style=""> 963     public void onSendConfiguration(String config) {                                                     </span>
<span  style=""> 964                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 965     }                                                                                                    </span>
<span  style=""> 966                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 967     @Override                                                                                            </span>
<span class="8707097463436604513" onmouseenter="enter('8707097463436604513');" onmouseout="out('8707097463436604513');" style=""> 968     public void onReadConfiguration(String config) {                                                     </span>
<span  style=""> 969                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 970     }                                                                                                    </span>
<span  style=""> 971                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 972     @Override                                                                                            </span>
<span class="-1180224994468071186" onmouseenter="enter('-1180224994468071186');" onmouseout="out('-1180224994468071186');" style=""> 973     public void onTestNewFunction() {                                                                    </span>
<span  style=""> 974                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975     }                                                                                                    </span>
<span  style=""> 976                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 977     @Override                                                                                            </span>
<span class="-6167041048283935417" onmouseenter="enter('-6167041048283935417');" onmouseout="out('-6167041048283935417');" style=""> 978     public void onSendWeather(WeatherSpec weatherSpec) {                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 979         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 980             JSONObject o = new JSONObject();                                                             </span>
<span class="501109951395943657" onmouseenter="enter('501109951395943657');" onmouseout="out('501109951395943657');" style=""> 981             o.put(&quot;t&quot;, &quot;weather&quot;);                                                                       </span>
<span class="4560755441777004113" onmouseenter="enter('4560755441777004113');" onmouseout="out('4560755441777004113');" style=""> 982             o.put(&quot;temp&quot;, weatherSpec.currentTemp);                                                      </span>
<span class="7333169967933356383" onmouseenter="enter('7333169967933356383');" onmouseout="out('7333169967933356383');" style=""> 983             o.put(&quot;hum&quot;, weatherSpec.currentHumidity);                                                   </span>
<span class="1899511800679765497" onmouseenter="enter('1899511800679765497');" onmouseout="out('1899511800679765497');" style=""> 984             o.put(&quot;code&quot;, weatherSpec.currentConditionCode);                                             </span>
<span class="-4150178137906864023" onmouseenter="enter('-4150178137906864023');" onmouseout="out('-4150178137906864023');" style=""> 985             o.put(&quot;txt&quot;, weatherSpec.currentCondition);                                                  </span>
<span class="2529521996043109426" onmouseenter="enter('2529521996043109426');" onmouseout="out('2529521996043109426');" style=""> 986             o.put(&quot;wind&quot;, weatherSpec.windSpeed);                                                        </span>
<span class="-3531204280741737459" onmouseenter="enter('-3531204280741737459');" onmouseout="out('-3531204280741737459');" style=""> 987             o.put(&quot;wdir&quot;, weatherSpec.windDirection);                                                    </span>
<span class="-5203705012940108393" onmouseenter="enter('-5203705012940108393');" onmouseout="out('-5203705012940108393');" style=""> 988             o.put(&quot;loc&quot;, weatherSpec.location);                                                          </span>
<span class="-7123085564208723174" onmouseenter="enter('-7123085564208723174');" onmouseout="out('-7123085564208723174');" style=""> 989             uartTxJSON(&quot;onSendWeather&quot;, o);                                                              </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 990         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 991             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 992         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 993     }                                                                                                    </span>
<span  style=""> 994                                                                                                          </span>
<span class="-2877595281257014330" onmouseenter="enter('-2877595281257014330');" onmouseout="out('-2877595281257014330');" style=""> 995     public Bitmap textToBitmap(String text) {                                                            </span>
<span class="8197355036703912915" onmouseenter="enter('8197355036703912915');" onmouseout="out('8197355036703912915');" style=""> 996         Paint paint = new Paint(0); // Paint.ANTI_ALIAS_FLAG not wanted as 1bpp                          </span>
<span class="7051721925152008019" onmouseenter="enter('7051721925152008019');" onmouseout="out('7051721925152008019');" style=""> 997         paint.setTextSize(18);                                                                           </span>
<span class="3201120031631468052" onmouseenter="enter('3201120031631468052');" onmouseout="out('3201120031631468052');" style=""> 998         paint.setColor(0xFFFFFFFF);                                                                      </span>
<span class="-8656814648822962149" onmouseenter="enter('-8656814648822962149');" onmouseout="out('-8656814648822962149');" style=""> 999         paint.setTextAlign(Paint.Align.LEFT);                                                            </span>
<span class="-7872377864782888483" onmouseenter="enter('-7872377864782888483');" onmouseout="out('-7872377864782888483');" style="">1000         float baseline = -paint.ascent(); // ascent() is negative                                        </span>
<span class="-8465374828216379200" onmouseenter="enter('-8465374828216379200');" onmouseout="out('-8465374828216379200');" style="">1001         int width = (int) (paint.measureText(text) + 0.5f); // round                                     </span>
<span class="-3854390456573697081" onmouseenter="enter('-3854390456573697081');" onmouseout="out('-3854390456573697081');" style="">1002         int height = (int) (baseline + paint.descent() + 0.5f);                                          </span>
<span class="2906210495000084590" onmouseenter="enter('2906210495000084590');" onmouseout="out('2906210495000084590');" style="">1003         Bitmap image = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);                      </span>
<span class="-8679273566707466475" onmouseenter="enter('-8679273566707466475');" onmouseout="out('-8679273566707466475');" style="">1004         Canvas canvas = new Canvas(image);                                                               </span>
<span class="-1111517440201709382" onmouseenter="enter('-1111517440201709382');" onmouseout="out('-1111517440201709382');" style="">1005         canvas.drawText(text, 0, baseline, paint);                                                       </span>
<span class="-2663644744327296233" onmouseenter="enter('-2663644744327296233');" onmouseout="out('-2663644744327296233');" style="">1006         return image;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1007     }                                                                                                    </span>
<span  style="">1008                                                                                                          </span>
<span class="7074963208724431146" onmouseenter="enter('7074963208724431146');" onmouseout="out('7074963208724431146');" style="">1009     public enum BangleJSBitmapStyle {                                                                    </span>
<span class="6147896096185822433" onmouseenter="enter('6147896096185822433');" onmouseout="out('6147896096185822433');" style="">1010         MONOCHROME,                                                                                      </span>
<span class="4062182762926863582" onmouseenter="enter('4062182762926863582');" onmouseout="out('4062182762926863582');" style="">1011         RGB_3BPP                                                                                         </span>
<span class="-7908154229208946405" onmouseenter="enter('-7908154229208946405');" onmouseout="out('-7908154229208946405');" style="">1012     };;                                                                                                  </span>
<span  style="">1013                                                                                                          </span>
<span class="6301558466408951369" onmouseenter="enter('6301558466408951369');" onmouseout="out('6301558466408951369');" style="">1014     /** Used for writing single bits to an array */                                                      </span>
<span class="819222803118860573" onmouseenter="enter('819222803118860573');" onmouseout="out('819222803118860573');" style="">1015     public static class BitWriter {                                                                      </span>
<span class="114498312668931576" onmouseenter="enter('114498312668931576');" onmouseout="out('114498312668931576');" style="">1016         int n;                                                                                           </span>
<span class="2627896913916265726" onmouseenter="enter('2627896913916265726');" onmouseout="out('2627896913916265726');" style="">1017         byte[] bits;                                                                                     </span>
<span class="1763732906692125975" onmouseenter="enter('1763732906692125975');" onmouseout="out('1763732906692125975');" style="">1018         int currentByte, bitIdx;                                                                         </span>
<span  style="">1019                                                                                                          </span>
<span class="4387590414863300883" onmouseenter="enter('4387590414863300883');" onmouseout="out('4387590414863300883');" style="">1020         public BitWriter(byte[] array, int offset) {                                                     </span>
<span class="-2669551821059816380" onmouseenter="enter('-2669551821059816380');" onmouseout="out('-2669551821059816380');" style="">1021             bits = array;                                                                                </span>
<span class="8043804227758168612" onmouseenter="enter('8043804227758168612');" onmouseout="out('8043804227758168612');" style="">1022             n = offset;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1023         }                                                                                                </span>
<span  style="">1024                                                                                                          </span>
<span class="3787308675999271388" onmouseenter="enter('3787308675999271388');" onmouseout="out('3787308675999271388');" style="">1025         public void push(boolean v) {                                                                    </span>
<span class="-3502051617447471385" onmouseenter="enter('-3502051617447471385');" onmouseout="out('-3502051617447471385');" style="">1026             currentByte = (currentByte &lt;&lt; 1) | (v?1:0);                                                  </span>
<span class="-9185751609333789697" onmouseenter="enter('-9185751609333789697');" onmouseout="out('-9185751609333789697');" style="">1027             bitIdx++;                                                                                    </span>
<span class="-4190492491002713547" onmouseenter="enter('-4190492491002713547');" onmouseout="out('-4190492491002713547');" style="">1028             if (bitIdx == 8) {                                                                           </span>
<span class="6079776424871100267" onmouseenter="enter('6079776424871100267');" onmouseout="out('6079776424871100267');" style="">1029                 bits[n++] = (byte)currentByte;                                                           </span>
<span class="7441701714119310800" onmouseenter="enter('7441701714119310800');" onmouseout="out('7441701714119310800');" style="">1030                 bitIdx = 0;                                                                              </span>
<span class="-6334189767708640910" onmouseenter="enter('-6334189767708640910');" onmouseout="out('-6334189767708640910');" style="">1031                 currentByte = 0;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1032             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1033         }                                                                                                </span>
<span  style="">1034                                                                                                          </span>
<span class="-6819029797264174065" onmouseenter="enter('-6819029797264174065');" onmouseout="out('-6819029797264174065');" style="">1035         public void finish() {                                                                           </span>
<span class="-7024656867771236134" onmouseenter="enter('-7024656867771236134');" onmouseout="out('-7024656867771236134');" style="">1036             if (bitIdx &gt; 0) bits[n++] = (byte)currentByte;                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1037         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1038     }                                                                                                    </span>
<span  style="">1039                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1040     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1041      * Currently only 1bpp, no scaling */                                                                </span>
<span class="7395401196912084921" onmouseenter="enter('7395401196912084921');" onmouseout="out('7395401196912084921');" style="">1042     public static byte[] bitmapToEspruinoArray(Bitmap bitmap, BangleJSBitmapStyle style) {               </span>
<span class="-8264578209241474849" onmouseenter="enter('-8264578209241474849');" onmouseout="out('-8264578209241474849');" style="">1043         int width = bitmap.getWidth();                                                                   </span>
<span class="579214017182008882" onmouseenter="enter('579214017182008882');" onmouseout="out('579214017182008882');" style="">1044         int height = bitmap.getHeight();                                                                 </span>
<span class="62095710955205844" onmouseenter="enter('62095710955205844');" onmouseout="out('62095710955205844');" style="">1045         int bpp = (style==BangleJSBitmapStyle.RGB_3BPP) ? 3 : 1;                                         </span>
<span class="2569753333792437088" onmouseenter="enter('2569753333792437088');" onmouseout="out('2569753333792437088');" style="">1046         byte pixels[] = new byte[width * height];                                                        </span>
<span class="-8781894220114795181" onmouseenter="enter('-8781894220114795181');" onmouseout="out('-8781894220114795181');" style="">1047         final byte PIXELCOL_TRANSPARENT = -1;                                                            </span>
<span class="6803383238845196993" onmouseenter="enter('6803383238845196993');" onmouseout="out('6803383238845196993');" style="">1048         final int ditherMatrix[] = {1*16,5*16,7*16,3*16}; // for bayer dithering                         </span>
<span class="7959981185777845703" onmouseenter="enter('7959981185777845703');" onmouseout="out('7959981185777845703');" style="">1049         // if doing 3bpp, check image to see if it&#x27;s transparent                                         </span>
<span class="2206517053249792991" onmouseenter="enter('2206517053249792991');" onmouseout="out('2206517053249792991');" style="">1050         boolean allowTransparency = (style != BangleJSBitmapStyle.MONOCHROME);                           </span>
<span class="-37573379981503148" onmouseenter="enter('-37573379981503148');" onmouseout="out('-37573379981503148');" style="">1051         boolean isTransparent = false;                                                                   </span>
<span class="7994078972417264550" onmouseenter="enter('7994078972417264550');" onmouseout="out('7994078972417264550');" style="">1052         byte transparentColorIndex = 0;                                                                  </span>
<span class="4545384496906809483" onmouseenter="enter('4545384496906809483');" onmouseout="out('4545384496906809483');" style="">1053         /* Work out what colour index each pixel should be and write to pixels.                          </span>
<span class="-816286840416722331" onmouseenter="enter('-816286840416722331');" onmouseout="out('-816286840416722331');" style="">1054          Also figure out if we&#x27;re transparent at all, and how often each color is used */                </span>
<span class="-3015935700404012624" onmouseenter="enter('-3015935700404012624');" onmouseout="out('-3015935700404012624');" style="">1055         int colUsage[] = new int[8];                                                                     </span>
<span class="-1168375646381031328" onmouseenter="enter('-1168375646381031328');" onmouseout="out('-1168375646381031328');" style="">1056         int n = 0;                                                                                       </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1057         for (int y = 0; y &lt; height; y++) {                                                               </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1058             for (int x = 0; x &lt; width; x++) {                                                            </span>
<span class="-2101137108834168285" onmouseenter="enter('-2101137108834168285');" onmouseout="out('-2101137108834168285');" style="">1059                 int pixel = bitmap.getPixel(x, y);                                                       </span>
<span class="-7873265173430592100" onmouseenter="enter('-7873265173430592100');" onmouseout="out('-7873265173430592100');" style="">1060                 int r = pixel &amp; 255;                                                                     </span>
<span class="5214305336064064060" onmouseenter="enter('5214305336064064060');" onmouseout="out('5214305336064064060');" style="">1061                 int g = (pixel &gt;&gt; 8) &amp; 255;                                                              </span>
<span class="-8611762025314058231" onmouseenter="enter('-8611762025314058231');" onmouseout="out('-8611762025314058231');" style="">1062                 int b = (pixel &gt;&gt; 16) &amp; 255;                                                             </span>
<span class="4540615999107180416" onmouseenter="enter('4540615999107180416');" onmouseout="out('4540615999107180416');" style="">1063                 int a = (pixel &gt;&gt; 24) &amp; 255;                                                             </span>
<span class="-7690440557473777446" onmouseenter="enter('-7690440557473777446');" onmouseout="out('-7690440557473777446');" style="">1064                 boolean pixelTransparent = allowTransparency &amp;&amp; (a &lt; 128);                               </span>
<span class="8857737978256656560" onmouseenter="enter('8857737978256656560');" onmouseout="out('8857737978256656560');" style="">1065                 if (pixelTransparent) {                                                                  </span>
<span class="4144053758920166277" onmouseenter="enter('4144053758920166277');" onmouseout="out('4144053758920166277');" style="">1066                     isTransparent = true;                                                                </span>
<span class="-1483564027931343691" onmouseenter="enter('-1483564027931343691');" onmouseout="out('-1483564027931343691');" style="">1067                     r = g = b = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1068                 }                                                                                        </span>
<span class="7892385962647882401" onmouseenter="enter('7892385962647882401');" onmouseout="out('7892385962647882401');" style="">1069                 // do dithering here                                                                     </span>
<span class="-1753549363475258451" onmouseenter="enter('-1753549363475258451');" onmouseout="out('-1753549363475258451');" style="">1070                 int ditherAmt = ditherMatrix[(x&amp;1) + (y&amp;1)*2];                                           </span>
<span class="-5333286516522955764" onmouseenter="enter('-5333286516522955764');" onmouseout="out('-5333286516522955764');" style="">1071                 r += ditherAmt;                                                                          </span>
<span class="-3777395832470098990" onmouseenter="enter('-3777395832470098990');" onmouseout="out('-3777395832470098990');" style="">1072                 g += ditherAmt;                                                                          </span>
<span class="-5891859440152819561" onmouseenter="enter('-5891859440152819561');" onmouseout="out('-5891859440152819561');" style="">1073                 b += ditherAmt;                                                                          </span>
<span class="1554400584909279790" onmouseenter="enter('1554400584909279790');" onmouseout="out('1554400584909279790');" style="">1074                 int col = 0;                                                                             </span>
<span class="418637413535106488" onmouseenter="enter('418637413535106488');" onmouseout="out('418637413535106488');" style="">1075                 if (style == BangleJSBitmapStyle.MONOCHROME)                                             </span>
<span class="7187319285928422906" onmouseenter="enter('7187319285928422906');" onmouseout="out('7187319285928422906');" style="">1076                     col = ((r+g+b) &gt;= 768)?1:0;                                                          </span>
<span class="-9158255213257007445" onmouseenter="enter('-9158255213257007445');" onmouseout="out('-9158255213257007445');" style="">1077                 else if (style == BangleJSBitmapStyle.RGB_3BPP)                                          </span>
<span class="6807772790369921462" onmouseenter="enter('6807772790369921462');" onmouseout="out('6807772790369921462');" style="">1078                     col = ((r&gt;=256)?1:0) | ((g&gt;=256)?2:0) | ((b&gt;=256)?4:0);                              </span>
<span class="-8103715039558456046" onmouseenter="enter('-8103715039558456046');" onmouseout="out('-8103715039558456046');" style="">1079                 if (!pixelTransparent) colUsage[col]++; // if not transparent, record usage              </span>
<span class="4219755117683718437" onmouseenter="enter('4219755117683718437');" onmouseout="out('4219755117683718437');" style="">1080                 // save colour, mark transparent separately                                              </span>
<span class="9129530588794156450" onmouseenter="enter('9129530588794156450');" onmouseout="out('9129530588794156450');" style="">1081                 pixels[n++] = (byte)(pixelTransparent ? PIXELCOL_TRANSPARENT : col);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1082             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1083         }                                                                                                </span>
<span class="-7238986996251945663" onmouseenter="enter('-7238986996251945663');" onmouseout="out('-7238986996251945663');" style="">1084         // if we&#x27;re transparent, find the least-used color, and use that for transparency                </span>
<span class="-3011917059987129784" onmouseenter="enter('-3011917059987129784');" onmouseout="out('-3011917059987129784');" style="">1085         if (isTransparent) {                                                                             </span>
<span class="-8837844203179481085" onmouseenter="enter('-8837844203179481085');" onmouseout="out('-8837844203179481085');" style="">1086             // find least used                                                                           </span>
<span class="-2156609844502175267" onmouseenter="enter('-2156609844502175267');" onmouseout="out('-2156609844502175267');" style="">1087             int minColUsage = -1;                                                                        </span>
<span class="-722001860546824180" onmouseenter="enter('-722001860546824180');" onmouseout="out('-722001860546824180');" style="">1088             for (int c=0;c&lt;8;c++) {                                                                      </span>
<span class="4418845972840093199" onmouseenter="enter('4418845972840093199');" onmouseout="out('4418845972840093199');" style="">1089                 if (minColUsage&lt;0 || colUsage[c]&lt;minColUsage) {                                          </span>
<span class="5318194882336838338" onmouseenter="enter('5318194882336838338');" onmouseout="out('5318194882336838338');" style="">1090                     minColUsage = colUsage[c];                                                           </span>
<span class="1332179475621902578" onmouseenter="enter('1332179475621902578');" onmouseout="out('1332179475621902578');" style="">1091                     transparentColorIndex = (byte)c;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1092                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1093             }                                                                                            </span>
<span class="-6360425578627405201" onmouseenter="enter('-6360425578627405201');" onmouseout="out('-6360425578627405201');" style="">1094             // rewrite any transparent pixels as the correct color for transparency                      </span>
<span class="-6081737035071239023" onmouseenter="enter('-6081737035071239023');" onmouseout="out('-6081737035071239023');" style="">1095             for (n=0;n&lt;pixels.length;n++)                                                                </span>
<span class="-5898303404019142000" onmouseenter="enter('-5898303404019142000');" onmouseout="out('-5898303404019142000');" style="">1096                 if (pixels[n]==PIXELCOL_TRANSPARENT)                                                     </span>
<span class="2866860587696074876" onmouseenter="enter('2866860587696074876');" onmouseout="out('2866860587696074876');" style="">1097                     pixels[n] = transparentColorIndex;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1098         }                                                                                                </span>
<span class="2745980283769036105" onmouseenter="enter('2745980283769036105');" onmouseout="out('2745980283769036105');" style="">1099         // Write the header                                                                              </span>
<span class="-1351042579972959800" onmouseenter="enter('-1351042579972959800');" onmouseout="out('-1351042579972959800');" style="">1100         int headerLen = isTransparent ? 4 : 3;                                                           </span>
<span class="-1842770092995408603" onmouseenter="enter('-1842770092995408603');" onmouseout="out('-1842770092995408603');" style="">1101         byte bmp[] = new byte[(((height * width * bpp) + 7) &gt;&gt; 3) + headerLen];                          </span>
<span class="-2931355111361492552" onmouseenter="enter('-2931355111361492552');" onmouseout="out('-2931355111361492552');" style="">1102         bmp[0] = (byte)width;                                                                            </span>
<span class="7001926567865572655" onmouseenter="enter('7001926567865572655');" onmouseout="out('7001926567865572655');" style="">1103         bmp[1] = (byte)height;                                                                           </span>
<span class="-237013155551245034" onmouseenter="enter('-237013155551245034');" onmouseout="out('-237013155551245034');" style="">1104         bmp[2] = (byte)(bpp + (isTransparent?128:0));                                                    </span>
<span class="6762716390198046926" onmouseenter="enter('6762716390198046926');" onmouseout="out('6762716390198046926');" style="">1105         if (isTransparent) bmp[3] = transparentColorIndex;                                               </span>
<span class="8478354166162352997" onmouseenter="enter('8478354166162352997');" onmouseout="out('8478354166162352997');" style="">1106         // Now write the image out bit by bit                                                            </span>
<span class="344926378213754405" onmouseenter="enter('344926378213754405');" onmouseout="out('344926378213754405');" style="">1107         BitWriter bits = new BitWriter(bmp, headerLen);                                                  </span>
<span class="-3260558023763679626" onmouseenter="enter('-3260558023763679626');" onmouseout="out('-3260558023763679626');" style="">1108         n = 0;                                                                                           </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1109         for (int y = 0; y &lt; height; y++) {                                                               </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1110             for (int x = 0; x &lt; width; x++) {                                                            </span>
<span class="593941254526452666" onmouseenter="enter('593941254526452666');" onmouseout="out('593941254526452666');" style="">1111                 int pixel = pixels[n++];                                                                 </span>
<span class="-1551860236924517479" onmouseenter="enter('-1551860236924517479');" onmouseout="out('-1551860236924517479');" style="">1112                 for (int b=bpp-1;b&gt;=0;b--)                                                               </span>
<span class="-5304162960169081882" onmouseenter="enter('-5304162960169081882');" onmouseout="out('-5304162960169081882');" style="">1113                     bits.push(((pixel&gt;&gt;b)&amp;1) != 0);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1114             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1115         }                                                                                                </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1116         return bmp;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1117     }                                                                                                    </span>
<span  style="">1118                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1119     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1120      * Currently only 1bpp, no scaling */                                                                </span>
<span class="8132909775831713515" onmouseenter="enter('8132909775831713515');" onmouseout="out('8132909775831713515');" style="">1121     public static String bitmapToEspruinoString(Bitmap bitmap, BangleJSBitmapStyle style) {              </span>
<span class="-259762080887441901" onmouseenter="enter('-259762080887441901');" onmouseout="out('-259762080887441901');" style="">1122         return new String(bitmapToEspruinoArray(bitmap, style), StandardCharsets.ISO_8859_1);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1123     }                                                                                                    </span>
<span  style="">1124                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1125     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1126      * Currently only 1bpp, no scaling */                                                                </span>
<span class="3005879465184206786" onmouseenter="enter('3005879465184206786');" onmouseout="out('3005879465184206786');" style="">1127     public static String bitmapToEspruinoBase64(Bitmap bitmap, BangleJSBitmapStyle style) {              </span>
<span class="-5699216721301532414" onmouseenter="enter('-5699216721301532414');" onmouseout="out('-5699216721301532414');" style=""><abbr title="1128         return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\n&quot;,&quot;&quot;);">1128         return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\nðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1129     }                                                                                                    </span>
<span  style="">1130                                                                                                          </span>
<span class="-3553936365177536696" onmouseenter="enter('-3553936365177536696');" onmouseout="out('-3553936365177536696');" style="">1131     /** Convert a drawable to a bitmap, for use with bitmapToEspruino */                                 </span>
<span class="3383127324214077694" onmouseenter="enter('3383127324214077694');" onmouseout="out('3383127324214077694');" style="">1132     public static Bitmap drawableToBitmap(Drawable drawable) {                                           </span>
<span class="5888468731770076773" onmouseenter="enter('5888468731770076773');" onmouseout="out('5888468731770076773');" style="">1133         final int maxWidth = 32;                                                                         </span>
<span class="1045468429082287724" onmouseenter="enter('1045468429082287724');" onmouseout="out('1045468429082287724');" style="">1134         final int maxHeight = 32;                                                                        </span>
<span class="2296952793490653309" onmouseenter="enter('2296952793490653309');" onmouseout="out('2296952793490653309');" style="">1135         /* Return bitmap directly but only if it&#x27;s small enough. It could be                             </span>
<span class="5951543220377437420" onmouseenter="enter('5951543220377437420');" onmouseout="out('5951543220377437420');" style="">1136         we have a bitmap but it&#x27;s just too big to send direct to the bangle */                           </span>
<span class="256873417632096091" onmouseenter="enter('256873417632096091');" onmouseout="out('256873417632096091');" style="">1137         if (drawable instanceof BitmapDrawable) {                                                        </span>
<span class="-5943336945219947575" onmouseenter="enter('-5943336945219947575');" onmouseout="out('-5943336945219947575');" style="">1138             BitmapDrawable bitmapDrawable = (BitmapDrawable) drawable;                                   </span>
<span class="3248690101517469022" onmouseenter="enter('3248690101517469022');" onmouseout="out('3248690101517469022');" style="">1139             Bitmap bmp = bitmapDrawable.getBitmap();                                                     </span>
<span class="-7540961171633243123" onmouseenter="enter('-7540961171633243123');" onmouseout="out('-7540961171633243123');" style="">1140             if (bmp != null &amp;&amp; bmp.getWidth()&lt;=maxWidth &amp;&amp; bmp.getHeight()&lt;=maxHeight)                   </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1141                 return bmp;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1142         }                                                                                                </span>
<span class="-1267243917470848355" onmouseenter="enter('-1267243917470848355');" onmouseout="out('-1267243917470848355');" style="">1143         /* Otherwise render this to a bitmap ourselves.. work out size */                                </span>
<span class="4014031002419706861" onmouseenter="enter('4014031002419706861');" onmouseout="out('4014031002419706861');" style="">1144         int w = maxWidth;                                                                                </span>
<span class="7839465956667040099" onmouseenter="enter('7839465956667040099');" onmouseout="out('7839465956667040099');" style="">1145         int h = maxHeight;                                                                               </span>
<span class="-8364515267334494119" onmouseenter="enter('-8364515267334494119');" onmouseout="out('-8364515267334494119');" style="">1146         if (drawable.getIntrinsicWidth() &gt; 0 &amp;&amp; drawable.getIntrinsicHeight() &gt; 0) {                     </span>
<span class="7888521624075720743" onmouseenter="enter('7888521624075720743');" onmouseout="out('7888521624075720743');" style="">1147             w = drawable.getIntrinsicWidth();                                                            </span>
<span class="-8527253388982325533" onmouseenter="enter('-8527253388982325533');" onmouseout="out('-8527253388982325533');" style="">1148             h = drawable.getIntrinsicHeight();                                                           </span>
<span class="1937935127293972578" onmouseenter="enter('1937935127293972578');" onmouseout="out('1937935127293972578');" style="">1149             // don&#x27;t allocate anything too big, but keep the ratio                                       </span>
<span class="-3040808582930904343" onmouseenter="enter('-3040808582930904343');" onmouseout="out('-3040808582930904343');" style="">1150             if (w&gt;maxWidth) {                                                                            </span>
<span class="3961818778152175494" onmouseenter="enter('3961818778152175494');" onmouseout="out('3961818778152175494');" style="">1151                 h = h * maxWidth / w;                                                                    </span>
<span class="-810617720622075293" onmouseenter="enter('-810617720622075293');" onmouseout="out('-810617720622075293');" style="">1152                 w = maxWidth;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1153             }                                                                                            </span>
<span class="-8361662207911676693" onmouseenter="enter('-8361662207911676693');" onmouseout="out('-8361662207911676693');" style="">1154             if (h&gt;maxHeight) {                                                                           </span>
<span class="-4098427333168952513" onmouseenter="enter('-4098427333168952513');" onmouseout="out('-4098427333168952513');" style="">1155                 w = w * maxHeight / h;                                                                   </span>
<span class="3192577241527884586" onmouseenter="enter('3192577241527884586');" onmouseout="out('3192577241527884586');" style="">1156                 h = maxHeight;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1157             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1158         }                                                                                                </span>
<span class="5796017605604363662" onmouseenter="enter('5796017605604363662');" onmouseout="out('5796017605604363662');" style="">1159         /* render */                                                                                     </span>
<span class="2390903888286128230" onmouseenter="enter('2390903888286128230');" onmouseout="out('2390903888286128230');" style=""><abbr title="1160         Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will be created of 1x1 pixel">1160         Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will bðŸ”µ</abbr></span>
<span class="-8462009662057840967" onmouseenter="enter('-8462009662057840967');" onmouseout="out('-8462009662057840967');" style="">1161         Canvas canvas = new Canvas(bitmap);                                                              </span>
<span class="8202941983594652957" onmouseenter="enter('8202941983594652957');" onmouseout="out('8202941983594652957');" style="">1162         drawable.setBounds(0, 0, canvas.getWidth(), canvas.getHeight());                                 </span>
<span class="-8639362966527052788" onmouseenter="enter('-8639362966527052788');" onmouseout="out('-8639362966527052788');" style="">1163         drawable.draw(canvas);                                                                           </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style="">1164         return bitmap;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1165     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1166 }                                                                                                        </span>




























































































































</pre></td>
                            <td><pre><span class="7867943778411854368" onmouseenter="enter('7867943778411854368');" onmouseout="out('7867943778411854368');" style="">   1 /*  Copyright (C) 2019-2021 Andreas Shimokawa, Gordon Williams                                           </span>
<span  style="">   2                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8     (at your option) any later version.                                                                  </span>
<span  style="">   9                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  14                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="-588248541382154970" onmouseenter="enter('-588248541382154970');" onmouseout="out('-588248541382154970');" style="">  17 package nodomain.freeyourgadget.gadgetbridge.service.devices.banglejs;                                   </span>
<span  style="">  18                                                                                                          </span>
<span class="2440823415412133066" onmouseenter="enter('2440823415412133066');" onmouseout="out('2440823415412133066');" style="">  19 import android.bluetooth.BluetoothGatt;                                                                  </span>
<span class="4736969144974683041" onmouseenter="enter('4736969144974683041');" onmouseout="out('4736969144974683041');" style="">  20 import android.bluetooth.BluetoothGattCharacteristic;                                                    </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  21 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  22 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  23 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  24 import android.content.IntentFilter;                                                                     </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  25 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  26 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  27 import android.graphics.Canvas;                                                                          </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  28 import android.graphics.Paint;                                                                           </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  29 import android.graphics.drawable.BitmapDrawable;                                                         </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  30 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="">  31 import android.net.Uri;                                                                                  </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  32 import android.util.Base64;                                                                              </span>
<span class="-4373317539211938720" onmouseenter="enter('-4373317539211938720');" onmouseout="out('-4373317539211938720');" style="">  33 import android.widget.Toast;                                                                             </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  34 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span class="3171981379522900271" onmouseenter="enter('3171981379522900271');" onmouseout="out('3171981379522900271');" style="">  35 import com.android.volley.Request;                                                                       </span>
<span class="-6875921712592050045" onmouseenter="enter('-6875921712592050045');" onmouseout="out('-6875921712592050045');" style="">  36 import com.android.volley.RequestQueue;                                                                  </span>
<span class="4430867795468484324" onmouseenter="enter('4430867795468484324');" onmouseout="out('4430867795468484324');" style="">  37 import com.android.volley.Response;                                                                      </span>
<span class="7596528640051210243" onmouseenter="enter('7596528640051210243');" onmouseout="out('7596528640051210243');" style="">  38 import com.android.volley.VolleyError;                                                                   </span>
<span class="-6338542844679972782" onmouseenter="enter('-6338542844679972782');" onmouseout="out('-6338542844679972782');" style="">  39 import com.android.volley.toolbox.StringRequest;                                                         </span>
<span class="4822020902022089151" onmouseenter="enter('4822020902022089151');" onmouseout="out('4822020902022089151');" style="">  40 import com.android.volley.toolbox.Volley;                                                                </span>
<span class="-3163672285055708144" onmouseenter="enter('-3163672285055708144');" onmouseout="out('-3163672285055708144');" style="">  41 import io.wax911.emojify.Emoji;                                                                          </span>
<span class="6994093753897510849" onmouseenter="enter('6994093753897510849');" onmouseout="out('6994093753897510849');" style="">  42 import io.wax911.emojify.EmojiManager;                                                                   </span>
<span class="-2985037039232163872" onmouseenter="enter('-2985037039232163872');" onmouseout="out('-2985037039232163872');" style="">  43 import io.wax911.emojify.EmojiUtils;                                                                     </span>
<span class="-6983162919371453239" onmouseenter="enter('-6983162919371453239');" onmouseout="out('-6983162919371453239');" style="">  44 import java.io.BufferedWriter;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  45 import java.io.File;                                                                                     </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  46 import java.io.FileOutputStream;                                                                         </span>
<span class="4914725365521379617" onmouseenter="enter('4914725365521379617');" onmouseout="out('4914725365521379617');" style="">  47 import java.io.FileWriter;                                                                               </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  48 import java.io.IOException;                                                                              </span>
<span class="4087034682117787535" onmouseenter="enter('4087034682117787535');" onmouseout="out('4087034682117787535');" style="">  49 import java.io.StringReader;                                                                             </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  50 import java.lang.reflect.Field;                                                                          </span>
<span class="-2624565711555737384" onmouseenter="enter('-2624565711555737384');" onmouseout="out('-2624565711555737384');" style="">  51 import java.nio.charset.StandardCharsets;                                                                </span>
<span class="54331962280914690" onmouseenter="enter('54331962280914690');" onmouseout="out('54331962280914690');" style="">  52 import java.text.SimpleDateFormat;                                                                       </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  53 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  54 import java.util.Calendar;                                                                               </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  55 import java.util.Date;                                                                                   </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  56 import java.util.GregorianCalendar;                                                                      </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  57 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  58 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  59 import java.util.List;                                                                                   </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  60 import java.util.Locale;                                                                                 </span>
<span class="8860446888132102879" onmouseenter="enter('8860446888132102879');" onmouseout="out('8860446888132102879');" style="">  61 import java.util.SimpleTimeZone;                                                                         </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  62 import java.util.UUID;                                                                                   </span>
<span class="-6525955205891456613" onmouseenter="enter('-6525955205891456613');" onmouseout="out('-6525955205891456613');" style="">  63 import javax.xml.xpath.XPath;                                                                            </span>
<span class="948957029946951050" onmouseenter="enter('948957029946951050');" onmouseout="out('948957029946951050');" style="">  64 import javax.xml.xpath.XPathFactory;                                                                     </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  65 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  66 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  67 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="-141107564105590930" onmouseenter="enter('-141107564105590930');" onmouseout="out('-141107564105590930');" style="">  68 import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst;     </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  69 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  70 import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                           </span>
<span class="-3005335786085073829" onmouseenter="enter('-3005335786085073829');" onmouseout="out('-3005335786085073829');" style="">  71 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventBatteryInfo;                       </span>
<span class="7017557905176594961" onmouseenter="enter('7017557905176594961');" onmouseout="out('7017557905176594961');" style="">  72 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventCallControl;                       </span>
<span class="6368471362458763033" onmouseenter="enter('6368471362458763033');" onmouseout="out('6368471362458763033');" style="">  73 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventFindPhone;                         </span>
<span class="4012861689788039008" onmouseenter="enter('4012861689788039008');" onmouseout="out('4012861689788039008');" style="">  74 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventMusicControl;                      </span>
<span class="-5203005511074004401" onmouseenter="enter('-5203005511074004401');" onmouseout="out('-5203005511074004401');" style="">  75 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventNotificationControl;               </span>
<span class="4252572397761323695" onmouseenter="enter('4252572397761323695');" onmouseout="out('4252572397761323695');" style="">  76 import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSConstants;                          </span>
<span class="8687478736174414119" onmouseenter="enter('8687478736174414119');" onmouseout="out('8687478736174414119');" style="">  77 import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSSampleProvider;                     </span>
<span class="-7483974346858162294" onmouseenter="enter('-7483974346858162294');" onmouseout="out('-7483974346858162294');" style="">  78 import nodomain.freeyourgadget.gadgetbridge.devices.qhybrid.NotificationConfiguration;                   </span>
<span class="8046368326334810504" onmouseenter="enter('8046368326334810504');" onmouseout="out('8046368326334810504');" style="">  79 import nodomain.freeyourgadget.gadgetbridge.entities.BangleJSActivitySample;                             </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  80 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                               </span>
<span class="5185434099904652174" onmouseenter="enter('5185434099904652174');" onmouseout="out('5185434099904652174');" style="">  81 import nodomain.freeyourgadget.gadgetbridge.model.ActivityKind;                                          </span>
<span class="-8766238562391910018" onmouseenter="enter('-8766238562391910018');" onmouseout="out('-8766238562391910018');" style="">  82 import nodomain.freeyourgadget.gadgetbridge.model.Alarm;                                                 </span>
<span class="2021957179005285653" onmouseenter="enter('2021957179005285653');" onmouseout="out('2021957179005285653');" style="">  83 import nodomain.freeyourgadget.gadgetbridge.model.BatteryState;                                          </span>
<span class="-3899388208810973608" onmouseenter="enter('-3899388208810973608');" onmouseout="out('-3899388208810973608');" style="">  84 import nodomain.freeyourgadget.gadgetbridge.model.CalendarEventSpec;                                     </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  85 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="-7415926539738049206" onmouseenter="enter('-7415926539738049206');" onmouseout="out('-7415926539738049206');" style="">  86 import nodomain.freeyourgadget.gadgetbridge.model.CannedMessagesSpec;                                    </span>
<span class="308285905299900254" onmouseenter="enter('308285905299900254');" onmouseout="out('308285905299900254');" style="">  87 import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;                                         </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  88 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  89 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  90 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="-3277000154202836222" onmouseenter="enter('-3277000154202836222');" onmouseout="out('-3277000154202836222');" style="">  91 import nodomain.freeyourgadget.gadgetbridge.model.RecordedDataTypes;                                     </span>
<span class="-40839721936664146" onmouseenter="enter('-40839721936664146');" onmouseout="out('-40839721936664146');" style="">  92 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;                                           </span>
<span class="4344228987867394358" onmouseenter="enter('4344228987867394358');" onmouseout="out('4344228987867394358');" style="">  93 import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLEDeviceSupport;                      </span>
<span class="3410519392510510669" onmouseenter="enter('3410519392510510669');" onmouseout="out('3410519392510510669');" style="">  94 import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;                             </span>
<span class="332482647079918156" onmouseenter="enter('332482647079918156');" onmouseout="out('332482647079918156');" style=""><abbr title="  95 import nodomain.freeyourgadget.gadgetbridge.service.devices.qhybrid.requests.misfit.PlayNotificationRequest;">  95 import nodomain.freeyourgadget.gadgetbridge.service.devices.qhybrid.requests.misfit.PlayNotificationRequeðŸ”µ</abbr></span>
<span class="-9148468836908617343" onmouseenter="enter('-9148468836908617343');" onmouseout="out('-9148468836908617343');" style="">  96 import nodomain.freeyourgadget.gadgetbridge.util.AlarmUtils;                                             </span>
<span class="-8051705910484913631" onmouseenter="enter('-8051705910484913631');" onmouseout="out('-8051705910484913631');" style="">  97 import nodomain.freeyourgadget.gadgetbridge.util.EmojiConverter;                                         </span>
<span class="-2020231768395052380" onmouseenter="enter('-2020231768395052380');" onmouseout="out('-2020231768395052380');" style="">  98 import nodomain.freeyourgadget.gadgetbridge.util.FileUtils;                                              </span>
<span class="-3798970344596478499" onmouseenter="enter('-3798970344596478499');" onmouseout="out('-3798970344596478499');" style="">  99 import nodomain.freeyourgadget.gadgetbridge.util.GB;                                                     </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style=""> 100 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style=""> 101 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span class="-9193129351684262878" onmouseenter="enter('-9193129351684262878');" onmouseout="out('-9193129351684262878');" style=""> 102 import org.json.JSONArray;                                                                               </span>
<span class="-8573375701834280359" onmouseenter="enter('-8573375701834280359');" onmouseout="out('-8573375701834280359');" style=""> 103 import org.json.JSONException;                                                                           </span>
<span class="7232075261178918144" onmouseenter="enter('7232075261178918144');" onmouseout="out('7232075261178918144');" style=""> 104 import org.json.JSONObject;                                                                              </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style=""> 105 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style=""> 106 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="-2051516048009622280" onmouseenter="enter('-2051516048009622280');" onmouseout="out('-2051516048009622280');" style=""> 107 import org.xml.sax.InputSource;                                                                          </span>
<span class="-2225725182537405146" onmouseenter="enter('-2225725182537405146');" onmouseout="out('-2225725182537405146');" style=""><abbr title=" 108 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_ALLOW_HIGH_MTU;"> 108 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="1576087340720410961" onmouseenter="enter('1576087340720410961');" onmouseout="out('1576087340720410961');" style=""><abbr title=" 109 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_BANGLEJS_TEXT_BITMAP;"> 109 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="-5321063140707926105" onmouseenter="enter('-5321063140707926105');" onmouseout="out('-5321063140707926105');" style=""><abbr title=" 110 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTENTS;"> 110 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="2440588347549655822" onmouseenter="enter('2440588347549655822');" onmouseout="out('2440588347549655822');" style=""><abbr title=" 111 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTERNET_ACCESS;"> 111 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConsðŸ”µ</abbr></span>
<span class="-7620522862868556032" onmouseenter="enter('-7620522862868556032');" onmouseout="out('-7620522862868556032');" style=""> 112 import static nodomain.freeyourgadget.gadgetbridge.database.DBHelper.*;                                  </span>
<span  style=""> 113                                                                                                          </span>
<span  style=""> 114                                                                                                          </span>
<span class="-4540174980983528222" onmouseenter="enter('-4540174980983528222');" onmouseout="out('-4540174980983528222');" style=""> 115 public class BangleJSDeviceSupport extends AbstractBTLEDeviceSupport {                                   </span>
<span class="5737832610637191351" onmouseenter="enter('5737832610637191351');" onmouseout="out('5737832610637191351');" style=""> 116     private static final Logger LOG = LoggerFactory.getLogger(BangleJSDeviceSupport.class);              </span>
<span  style=""> 117                                                                                                          </span>
<span class="-1874769646843493640" onmouseenter="enter('-1874769646843493640');" onmouseout="out('-1874769646843493640');" style=""> 118     private BluetoothGattCharacteristic rxCharacteristic = null;                                         </span>
<span  style=""> 119                                                                                                          </span>
<span class="3394422526290177606" onmouseenter="enter('3394422526290177606');" onmouseout="out('3394422526290177606');" style=""> 120     private BluetoothGattCharacteristic txCharacteristic = null;                                         </span>
<span  style=""> 121                                                                                                          </span>
<span class="4278598336110524029" onmouseenter="enter('4278598336110524029');" onmouseout="out('4278598336110524029');" style=""> 122     private boolean allowHighMTU = false;                                                                </span>
<span  style=""> 123                                                                                                          </span>
<span class="4758769595687694218" onmouseenter="enter('4758769595687694218');" onmouseout="out('4758769595687694218');" style=""> 124     private int mtuSize = 20;                                                                            </span>
<span  style=""> 125                                                                                                          </span>
<span class="-3842051295133417796" onmouseenter="enter('-3842051295133417796');" onmouseout="out('-3842051295133417796');" style=""> 126     // to attempt to stop duplicate packets when sending Local Intents                                   </span>
<span class="6800216559409303711" onmouseenter="enter('6800216559409303711');" onmouseout="out('6800216559409303711');" style=""> 127     int bangleCommandSeq = 0;                                                                            </span>
<span  style=""> 128                                                                                                          </span>
<span class="-4512087169427854590" onmouseenter="enter('-4512087169427854590');" onmouseout="out('-4512087169427854590');" style=""> 129     // / Current line of data received from Bangle.js                                                    </span>
<span class="-848193569484274658" onmouseenter="enter('-848193569484274658');" onmouseout="out('-848193569484274658');" style=""> 130     private String receivedLine = &quot;&quot;;                                                                    </span>
<span  style=""> 131                                                                                                          </span>
<span class="7842135007952282839" onmouseenter="enter('7842135007952282839');" onmouseout="out('7842135007952282839');" style=""><abbr title=" 132     /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS). Can be dumped with &#x27;Fetch Device Debug Logs&#x27; from Debug menu"> 132     /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS).ðŸ”µ</abbr></span>
<span class="-7872820322050208046" onmouseenter="enter('-7872820322050208046');" onmouseout="out('-7872820322050208046');" style=""> 133     private String receiveHistory = &quot;&quot;;                                                                  </span>
<span  style=""> 134                                                                                                          </span>
<span class="-3915326133595600019" onmouseenter="enter('-3915326133595600019');" onmouseout="out('-3915326133595600019');" style=""> 135     private boolean realtimeHRM = false;                                                                 </span>
<span  style=""> 136                                                                                                          </span>
<span class="-4342711334813376852" onmouseenter="enter('-4342711334813376852');" onmouseout="out('-4342711334813376852');" style=""> 137     private boolean realtimeStep = false;                                                                </span>
<span  style=""> 138                                                                                                          </span>
<span class="-785214995925481662" onmouseenter="enter('-785214995925481662');" onmouseout="out('-785214995925481662');" style=""> 139     private int realtimeHRMInterval = 30*60;                                                             </span>
<span  style=""> 140                                                                                                          </span>
<span class="8646268532285750413" onmouseenter="enter('8646268532285750413');" onmouseout="out('8646268532285750413');" style=""> 141     /* Long */                                                                                           </span>
<span class="6082764652228350545" onmouseenter="enter('6082764652228350545');" onmouseout="out('6082764652228350545');" style=""> 142     private final LimitedQueue mNotificationReplyAction = new LimitedQueue(16);                          </span>
<span  style=""> 143                                                                                                          </span>
<span class="3035544862292212294" onmouseenter="enter('3035544862292212294');" onmouseout="out('3035544862292212294');" style=""> 144     /// Maximum amount of characters to store in receiveHistory                                          </span>
<span class="-1679828146401541729" onmouseenter="enter('-1679828146401541729');" onmouseout="out('-1679828146401541729');" style=""> 145     public static final int MAX_RECEIVE_HISTORY_CHARS = 100000;                                          </span>
<span  style=""> 146                                                                                                          </span>
<span class="-4613019613947290640" onmouseenter="enter('-4613019613947290640');" onmouseout="out('-4613019613947290640');" style=""> 147     // Local Intents - for app manager communication                                                     </span>
<span class="-4613019613947290640" onmouseenter="enter('-4613019613947290640');" onmouseout="out('-4613019613947290640');" style=""> 148     // Local Intents - for app manager communication                                                     </span>
<span class="-6355985936525602065" onmouseenter="enter('-6355985936525602065');" onmouseout="out('-6355985936525602065');" style=""> 149     public static final String BANGLEJS_COMMAND_TX = &quot;banglejs_command_tx&quot;;                              </span>
<span  style=""> 150                                                                                                          </span>
<span class="-7611986610894711832" onmouseenter="enter('-7611986610894711832');" onmouseout="out('-7611986610894711832');" style=""> 151     public static final String BANGLEJS_COMMAND_RX = &quot;banglejs_command_rx&quot;;                              </span>
<span  style=""> 152                                                                                                          </span>
<span class="3928394439815779565" onmouseenter="enter('3928394439815779565');" onmouseout="out('3928394439815779565');" style=""> 153     // Global Intents                                                                                    </span>
<span class="3928394439815779565" onmouseenter="enter('3928394439815779565');" onmouseout="out('3928394439815779565');" style=""> 154     // Global Intents                                                                                    </span>
<span class="8064114268652999257" onmouseenter="enter('8064114268652999257');" onmouseout="out('8064114268652999257');" style=""> 155     private static final String BANGLE_ACTION_UART_TX = &quot;com.banglejs.uart.tx&quot;;                          </span>
<span  style=""> 156                                                                                                          </span>
<span class="-7141869860994321087" onmouseenter="enter('-7141869860994321087');" onmouseout="out('-7141869860994321087');" style=""> 157     public BangleJSDeviceSupport() {                                                                     </span>
<span class="4463652287758102089" onmouseenter="enter('4463652287758102089');" onmouseout="out('4463652287758102089');" style=""> 158         super(LOG);                                                                                      </span>
<span class="3886704256627163463" onmouseenter="enter('3886704256627163463');" onmouseout="out('3886704256627163463');" style=""> 159         addSupportedService(BangleJSConstants.UUID_SERVICE_NORDIC_UART);                                 </span>
<span class="1127284200558372197" onmouseenter="enter('1127284200558372197');" onmouseout="out('1127284200558372197');" style=""> 160         registerLocalIntents();                                                                          </span>
<span class="8826733129991946596" onmouseenter="enter('8826733129991946596');" onmouseout="out('8826733129991946596');" style=""> 161         registerGlobalIntents();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162     }                                                                                                    </span>
<span  style=""> 163                                                                                                          </span>
<span class="3363204271654612484" onmouseenter="enter('3363204271654612484');" onmouseout="out('3363204271654612484');" style=""> 164     private void registerLocalIntents() {                                                                </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 165         IntentFilter commandFilter = new IntentFilter();                                                 </span>
<span class="-7160894414714230309" onmouseenter="enter('-7160894414714230309');" onmouseout="out('-7160894414714230309');" style=""> 166         commandFilter.addAction(GBDevice.ACTION_DEVICE_CHANGED);                                         </span>
<span class="1690174294514698098" onmouseenter="enter('1690174294514698098');" onmouseout="out('1690174294514698098');" style=""> 167         commandFilter.addAction(BANGLEJS_COMMAND_TX);                                                    </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 168         BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 169             @Override                                                                                    </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 170             public void onReceive(Context context, Intent intent) {                                      </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 171                 switch (intent.getAction()) {                                                            </span>
<span class="-8414712287764653645" onmouseenter="enter('-8414712287764653645');" onmouseout="out('-8414712287764653645');" style=""> 172                     case BANGLEJS_COMMAND_TX :                                                           </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 173                         {                                                                                </span>
<span class="6200259397597608765" onmouseenter="enter('6200259397597608765');" onmouseout="out('6200259397597608765');" style=""> 174                             String data = String.valueOf(intent.getExtras().get(&quot;DATA&quot;));                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 175                             try {                                                                        </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 176                                 TransactionBuilder builder = performInitialized(&quot;TX&quot;);                   </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 177                                 uartTx(builder, data);                                                   </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 178                                 builder.queue(getQueue());                                               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 179                             } catch (IOException e) {                                                    </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 180                                 GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 180                                 GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 182                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183                         }                                                                                </span>
<span class="6293769308819402605" onmouseenter="enter('6293769308819402605');" onmouseout="out('6293769308819402605');" style=""> 184                     case GBDevice.ACTION_DEVICE_CHANGED :                                                </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 185                         {                                                                                </span>
<span class="-7853573391303433157" onmouseenter="enter('-7853573391303433157');" onmouseout="out('-7853573391303433157');" style=""> 186                             LOG.info(&quot;ACTION_DEVICE_CHANGED &quot; + gbDevice.getStateString());              </span>
<span class="-7940698414339010940" onmouseenter="enter('-7940698414339010940');" onmouseout="out('-7940698414339010940');" style=""> 187                             receiveHistory += (((&quot;\n||||||| BASE                                         </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 188 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 188 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 189 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 190 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 191 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 191 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 192 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 193 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 194 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 194 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 195 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 196 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 197 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 197 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 198 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 199 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 200 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 200 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 201 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 202 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 203 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 203 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 204 =======                                                                                                  </span>
<span class="-2698711650899637748" onmouseenter="enter('-2698711650899637748');" onmouseout="out('-2698711650899637748');" style=""><abbr title=" 205 ======\nACTION_DEVICE_CHANGED &quot; + gbDevice.getStateString()) + &quot; &quot;) + new SimpleDateFormat(&quot;yyyy-mm-dd hh:mm:ss&quot;).format(Calendar.getInstance().getTime())) + &quot;\n||||||| BASE"> 205 ======\nACTION_DEVICE_CHANGED &quot; + gbDevice.getStateString()) + &quot; &quot;) + new SimpleDateFormat(&quot;yyyy-mm-dd hhðŸ”µ</abbr></span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 206 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 206 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 207 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 208 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 209 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 209 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 210 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 211 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 212 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 212 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 213 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 214 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 215 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 215 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 216 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 217 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 218 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 218 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 219 =======                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 220 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style=""><abbr title=" 221 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 221 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 222 =======                                                                                                  </span>
<span class="-1805486623323291891" onmouseenter="enter('-1805486623323291891');" onmouseout="out('-1805486623323291891');" style=""> 223 ======\n&quot;;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 227         };                                                                                               </span>
<span class="-3358010436009942845" onmouseenter="enter('-3358010436009942845');" onmouseout="out('-3358010436009942845');" style=""><abbr title=" 228         LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, commandFilter);"> 228         LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span  style=""> 230                                                                                                          </span>
<span class="-5775866095722777208" onmouseenter="enter('-5775866095722777208');" onmouseout="out('-5775866095722777208');" style=""> 231     private void registerGlobalIntents() {                                                               </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 232         IntentFilter commandFilter = new IntentFilter();                                                 </span>
<span class="312812515367481242" onmouseenter="enter('312812515367481242');" onmouseout="out('312812515367481242');" style=""> 233         commandFilter.addAction(BANGLE_ACTION_UART_TX);                                                  </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 234         BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 235             @Override                                                                                    </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 236             public void onReceive(Context context, Intent intent) {                                      </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 237                 switch (intent.getAction()) {                                                            </span>
<span class="-2247552427419228949" onmouseenter="enter('-2247552427419228949');" onmouseout="out('-2247552427419228949');" style=""> 238                     case BANGLE_ACTION_UART_TX: {                                                        </span>
<span class="1831826963180757129" onmouseenter="enter('1831826963180757129');" onmouseout="out('1831826963180757129');" style=""> 239                         /* In Tasker:                                                                    </span>
<span class="-7864253240443668933" onmouseenter="enter('-7864253240443668933');" onmouseout="out('-7864253240443668933');" style=""> 240                           Action: com.banglejs.uart.tx                                                   </span>
<span class="-8992717920838973367" onmouseenter="enter('-8992717920838973367');" onmouseout="out('-8992717920838973367');" style=""> 241                           Cat: None                                                                      </span>
<span class="7759910949487339439" onmouseenter="enter('7759910949487339439');" onmouseout="out('7759910949487339439');" style=""> 242                           Extra: line:Terminal.println(%avariable)                                       </span>
<span class="1033584491372489972" onmouseenter="enter('1033584491372489972');" onmouseout="out('1033584491372489972');" style=""> 243                           Target: Broadcast Receiver                                                     </span>
<span  style=""> 244                                                                                                          </span>
<span class="8716883358060475580" onmouseenter="enter('8716883358060475580');" onmouseout="out('8716883358060475580');" style=""><abbr title=" 245                           Variable: Number, Configure on Import, NOT structured, Value set, Nothing Exported, NOT Same as value"> 245                           Variable: Number, Configure on Import, NOT structured, Value set, Nothing ExporðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 246                          */                                                                              </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 247                         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 247                         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDeviceðŸ”µ</abbr></span>
<span class="-3486649650498692683" onmouseenter="enter('-3486649650498692683');" onmouseout="out('-3486649650498692683');" style=""> 248                         if (!devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) return;                 </span>
<span class="-5120599586530243425" onmouseenter="enter('-5120599586530243425');" onmouseout="out('-5120599586530243425');" style=""> 249                         String data = intent.getStringExtra(&quot;line&quot;);                                     </span>
<span class="2134003849288272405" onmouseenter="enter('2134003849288272405');" onmouseout="out('2134003849288272405');" style=""> 250                         if (data==null) {                                                                </span>
<span class="-1377387169158373155" onmouseenter="enter('-1377387169158373155');" onmouseout="out('-1377387169158373155');" style=""><abbr title=" 251                             GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 251                             GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTHðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 252                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                         }                                                                                </span>
<span class="-5300884727268780299" onmouseenter="enter('-5300884727268780299');" onmouseout="out('-5300884727268780299');" style=""> 254                         if (!data.endsWith(&quot;\n&quot;)) data += &quot;\n&quot;;                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 255                         try {                                                                            </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 256                             TransactionBuilder builder = performInitialized(&quot;TX&quot;);                       </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 257                             uartTx(builder, data);                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 258                             builder.queue(getQueue());                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 259                         } catch (IOException e) {                                                        </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 260                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 260                             GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 262                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 266         };                                                                                               </span>
<span class="-7064134150505035894" onmouseenter="enter('-7064134150505035894');" onmouseout="out('-7064134150505035894');" style=""> 267         GBApplication.getContext().registerReceiver(commandReceiver, commandFilter);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268     }                                                                                                    </span>
<span  style=""> 269                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 270     @Override                                                                                            </span>
<span class="624595386859969795" onmouseenter="enter('624595386859969795');" onmouseout="out('624595386859969795');" style=""> 271     protected TransactionBuilder initializeDevice(TransactionBuilder builder) {                          </span>
<span class="6943102306574884764" onmouseenter="enter('6943102306574884764');" onmouseout="out('6943102306574884764');" style=""> 272         LOG.info(&quot;Initializing&quot;);                                                                        </span>
<span  style=""> 273                                                                                                          </span>
<span class="-5776342764121597122" onmouseenter="enter('-5776342764121597122');" onmouseout="out('-5776342764121597122');" style=""> 274         gbDevice.setState(GBDevice.State.INITIALIZING);                                                  </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 275         gbDevice.sendDeviceUpdateIntent(getContext());                                                   </span>
<span class="-92673263340012587" onmouseenter="enter('-92673263340012587');" onmouseout="out('-92673263340012587');" style=""> 276         gbDevice.setBatteryThresholdPercent((short) 30);                                                 </span>
<span  style=""> 277                                                                                                          </span>
<span class="-8842369873450741446" onmouseenter="enter('-8842369873450741446');" onmouseout="out('-8842369873450741446');" style=""> 278         rxCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX);      </span>
<span class="5321381947985783136" onmouseenter="enter('5321381947985783136');" onmouseout="out('5321381947985783136');" style=""> 279         txCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_TX);      </span>
<span class="8787860057533172177" onmouseenter="enter('8787860057533172177');" onmouseout="out('8787860057533172177');" style=""> 280         builder.setGattCallback(this);                                                                   </span>
<span class="-6644952300158088977" onmouseenter="enter('-6644952300158088977');" onmouseout="out('-6644952300158088977');" style=""> 281         builder.notify(rxCharacteristic, true);                                                          </span>
<span  style=""> 282                                                                                                          </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 283         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));</span>
<span class="-251442064819697046" onmouseenter="enter('-251442064819697046');" onmouseout="out('-251442064819697046');" style=""> 284         allowHighMTU = devicePrefs.getBoolean(PREF_ALLOW_HIGH_MTU, false);                               </span>
<span  style=""> 285                                                                                                          </span>
<span class="-8288238614628464708" onmouseenter="enter('-8288238614628464708');" onmouseout="out('-8288238614628464708');" style=""> 286         uartTx(builder, &quot; \u0003&quot;); // clear active line                                                 </span>
<span  style=""> 287                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 288         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="8819552782192853417" onmouseenter="enter('8819552782192853417');" onmouseout="out('8819552782192853417');" style=""> 289         if (prefs.getBoolean(&quot;datetime_synconconnect&quot;, true))                                            </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 290           transmitTime(builder);                                                                         </span>
<span class="-772823299017939314" onmouseenter="enter('-772823299017939314');" onmouseout="out('-772823299017939314');" style=""> 291         //sendSettings(builder);                                                                         </span>
<span  style=""> 292                                                                                                          </span>
<span class="6222907129579606912" onmouseenter="enter('6222907129579606912');" onmouseout="out('6222907129579606912');" style=""> 293         // get version                                                                                   </span>
<span  style=""> 294                                                                                                          </span>
<span class="6586859092027978564" onmouseenter="enter('6586859092027978564');" onmouseout="out('6586859092027978564');" style=""> 295         gbDevice.setState(GBDevice.State.INITIALIZED);                                                   </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 296         gbDevice.sendDeviceUpdateIntent(getContext());                                                   </span>
<span  style=""> 297                                                                                                          </span>
<span class="-3832688778173104110" onmouseenter="enter('-3832688778173104110');" onmouseout="out('-3832688778173104110');" style=""> 298         getDevice().setFirmwareVersion(&quot;N/A&quot;);                                                           </span>
<span class="-4069256094451065143" onmouseenter="enter('-4069256094451065143');" onmouseout="out('-4069256094451065143');" style=""> 299         getDevice().setFirmwareVersion2(&quot;N/A&quot;);                                                          </span>
<span  style=""> 300                                                                                                          </span>
<span class="8801197429786363323" onmouseenter="enter('8801197429786363323');" onmouseout="out('8801197429786363323');" style=""> 301         LOG.info(&quot;Initialization Done&quot;);                                                                 </span>
<span  style=""> 302                                                                                                          </span>
<span class="4801455624621135639" onmouseenter="enter('4801455624621135639');" onmouseout="out('4801455624621135639');" style=""> 303         return builder;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304     }                                                                                                    </span>
<span  style=""> 305                                                                                                          </span>
<span class="-607913654590177522" onmouseenter="enter('-607913654590177522');" onmouseout="out('-607913654590177522');" style=""> 306     /// Write a string of data, and chunk it up                                                          </span>
<span class="7559000899786781106" onmouseenter="enter('7559000899786781106');" onmouseout="out('7559000899786781106');" style=""> 307     private void uartTx(TransactionBuilder builder, String str) {                                        </span>
<span class="2941836608639998178" onmouseenter="enter('2941836608639998178');" onmouseout="out('2941836608639998178');" style=""> 308         byte[] bytes = str.getBytes(StandardCharsets.ISO_8859_1);                                        </span>
<span class="7973208681748769929" onmouseenter="enter('7973208681748769929');" onmouseout="out('7973208681748769929');" style=""> 309         LOG.info(&quot;UART TX: &quot; + str);                                                                     </span>
<span class="-4351000658882190788" onmouseenter="enter('-4351000658882190788');" onmouseout="out('-4351000658882190788');" style=""><abbr title=" 310         // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.stringify is converting to UTF-8?"> 310         // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.strðŸ”µ</abbr></span>
<span class="-4779482083542627164" onmouseenter="enter('-4779482083542627164');" onmouseout="out('-4779482083542627164');" style=""> 311         for (int i = 0; i &lt; bytes.length; i += mtuSize) {                                                </span>
<span class="-67559333950181428" onmouseenter="enter('-67559333950181428');" onmouseout="out('-67559333950181428');" style=""> 312             int l = bytes.length - i;                                                                    </span>
<span class="-1475736791152170308" onmouseenter="enter('-1475736791152170308');" onmouseout="out('-1475736791152170308');" style=""> 313             if (l &gt; mtuSize) {                                                                           </span>
<span class="-547581976360547131" onmouseenter="enter('-547581976360547131');" onmouseout="out('-547581976360547131');" style=""> 314                 l = mtuSize;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315             }                                                                                            </span>
<span class="-7868874671478910733" onmouseenter="enter('-7868874671478910733');" onmouseout="out('-7868874671478910733');" style=""> 316             byte[] packet = new byte[l];                                                                 </span>
<span class="6292978456177043042" onmouseenter="enter('6292978456177043042');" onmouseout="out('6292978456177043042');" style=""> 317             System.arraycopy(bytes, i, packet, 0, l);                                                    </span>
<span class="7692898876807316449" onmouseenter="enter('7692898876807316449');" onmouseout="out('7692898876807316449');" style=""> 318             builder.write(txCharacteristic, packet);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320     }                                                                                                    </span>
<span  style=""> 321                                                                                                          </span>
<span class="3351123158831541694" onmouseenter="enter('3351123158831541694');" onmouseout="out('3351123158831541694');" style=""> 322     // / Converts an object to a JSON string. see jsonToString                                           </span>
<span class="-7371185357421447388" onmouseenter="enter('-7371185357421447388');" onmouseout="out('-7371185357421447388');" style=""> 323     private String jsonToStringInternal(Object v) {                                                      </span>
<span class="-460987363590135383" onmouseenter="enter('-460987363590135383');" onmouseout="out('-460987363590135383');" style=""> 324         // else int/double/null                                                                          </span>
<span class="-7134941835268720819" onmouseenter="enter('-7134941835268720819');" onmouseout="out('-7134941835268720819');" style=""> 325         if (v instanceof String) {                                                                       </span>
<span class="4695321176266141339" onmouseenter="enter('4695321176266141339');" onmouseout="out('4695321176266141339');" style=""> 326             /* Convert a string, escaping chars we can&#x27;t send over out UART connection */                </span>
<span class="-5871417642658841225" onmouseenter="enter('-5871417642658841225');" onmouseout="out('-5871417642658841225');" style=""> 327             String s = ((String) (v));                                                                   </span>
<span class="-1195550795921055111" onmouseenter="enter('-1195550795921055111');" onmouseout="out('-1195550795921055111');" style=""> 328             String json = &quot;\&quot;&quot;;                                                                          </span>
<span class="-2173296205160994735" onmouseenter="enter('-2173296205160994735');" onmouseout="out('-2173296205160994735');" style=""> 329             for (int i = 0; i &lt; s.length(); i++) {                                                       </span>
<span class="5545656622231653300" onmouseenter="enter('5545656622231653300');" onmouseout="out('5545656622231653300');" style=""> 330                 int ch = ((int) (s.charAt(i)));                                                          </span>
<span class="6625948962848639956" onmouseenter="enter('6625948962848639956');" onmouseout="out('6625948962848639956');" style=""> 331                 if (ch &lt; 8) {                                                                            </span>
<span class="-2487801193836131922" onmouseenter="enter('-2487801193836131922');" onmouseout="out('-2487801193836131922');" style=""> 332                     json += &quot;\\&quot; + ch;                                                                   </span>
<span class="3708489390330291473" onmouseenter="enter('3708489390330291473');" onmouseout="out('3708489390330291473');" style=""> 333                 } else if (ch == 8) {                                                                    </span>
<span class="4383799007201761561" onmouseenter="enter('4383799007201761561');" onmouseout="out('4383799007201761561');" style=""> 334                     json += &quot;\\b&quot;;                                                                       </span>
<span class="300971696577844299" onmouseenter="enter('300971696577844299');" onmouseout="out('300971696577844299');" style=""> 335                 } else if (ch == 9) {                                                                    </span>
<span class="-6878457641950727239" onmouseenter="enter('-6878457641950727239');" onmouseout="out('-6878457641950727239');" style=""> 336                     json += &quot;\\t&quot;;                                                                       </span>
<span class="-7141532855230198959" onmouseenter="enter('-7141532855230198959');" onmouseout="out('-7141532855230198959');" style=""> 337                 } else if (ch == 10) {                                                                   </span>
<span class="607554413974012825" onmouseenter="enter('607554413974012825');" onmouseout="out('607554413974012825');" style=""> 338                     json += &quot;\\n&quot;;                                                                       </span>
<span class="-1669744455732566079" onmouseenter="enter('-1669744455732566079');" onmouseout="out('-1669744455732566079');" style=""> 339                 } else if (ch == 11) {                                                                   </span>
<span class="520368793644924868" onmouseenter="enter('520368793644924868');" onmouseout="out('520368793644924868');" style=""> 340                     json += &quot;\\v&quot;;                                                                       </span>
<span class="-929973022393077134" onmouseenter="enter('-929973022393077134');" onmouseout="out('-929973022393077134');" style=""> 341                 } else if (ch == 12) {                                                                   </span>
<span class="-6169253651112308709" onmouseenter="enter('-6169253651112308709');" onmouseout="out('-6169253651112308709');" style=""> 342                     json += &quot;\\f&quot;;                                                                       </span>
<span class="7451850740330791998" onmouseenter="enter('7451850740330791998');" onmouseout="out('7451850740330791998');" style=""> 343                 } else if (ch == 34) {                                                                   </span>
<span class="6572278560275649887" onmouseenter="enter('6572278560275649887');" onmouseout="out('6572278560275649887');" style=""> 344                     json += &quot;\\\&quot;&quot;;                                                                      </span>
<span class="4034873577427254760" onmouseenter="enter('4034873577427254760');" onmouseout="out('4034873577427254760');" style=""> 345                 } else if (ch == 92) {                                                                   </span>
<span class="-8741299139296362316" onmouseenter="enter('-8741299139296362316');" onmouseout="out('-8741299139296362316');" style=""> 346                     json += &quot;\\\\&quot;;                                                                      </span>
<span class="5658732660287565209" onmouseenter="enter('5658732660287565209');" onmouseout="out('5658732660287565209');" style=""> 347                 } else if (((((ch &lt; 32) || (ch == 26)) || (ch == 27)) || (ch == 127)) || (ch == 173)) {  </span>
<span class="-1697826715572272145" onmouseenter="enter('-1697826715572272145');" onmouseout="out('-1697826715572272145');" style=""> 348                     json += &quot;\\x&quot; + Integer.toHexString((ch &amp; 255) | 256).substring(1);                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 349                 } else {                                                                                 </span>
<span class="-6566411571922063762" onmouseenter="enter('-6566411571922063762');" onmouseout="out('-6566411571922063762');" style=""> 350                     json += s.charAt(i);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352             }                                                                                            </span>
<span class="8650149552652832651" onmouseenter="enter('8650149552652832651');" onmouseout="out('8650149552652832651');" style=""> 353             return json + &quot;\&quot;&quot;;                                                                          </span>
<span class="-7459573803876256213" onmouseenter="enter('-7459573803876256213');" onmouseout="out('-7459573803876256213');" style=""> 354         } else if (v instanceof JSONArray) {                                                             </span>
<span class="-6059107816577756395" onmouseenter="enter('-6059107816577756395');" onmouseout="out('-6059107816577756395');" style=""> 355             JSONArray a = ((JSONArray) (v));                                                             </span>
<span class="2941565214382533189" onmouseenter="enter('2941565214382533189');" onmouseout="out('2941565214382533189');" style=""> 356             String json = &quot;[&quot;;                                                                           </span>
<span class="78142245209497464" onmouseenter="enter('78142245209497464');" onmouseout="out('78142245209497464');" style=""> 357             for (int i = 0; i &lt; a.length(); i++) {                                                       </span>
<span class="81359043772452968" onmouseenter="enter('81359043772452968');" onmouseout="out('81359043772452968');" style=""> 358                 if (i &gt; 0) {                                                                             </span>
<span class="-8541737388862892319" onmouseenter="enter('-8541737388862892319');" onmouseout="out('-8541737388862892319');" style=""> 359                     json += &quot;,&quot;;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360                 }                                                                                        </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style=""> 361                 Object o = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 362                 try {                                                                                    </span>
<span class="1204902991279523771" onmouseenter="enter('1204902991279523771');" onmouseout="out('1204902991279523771');" style=""> 363                     o = a.get(i);                                                                        </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 364                 } catch (JSONException e) {                                                              </span>
<span class="5502177219725162371" onmouseenter="enter('5502177219725162371');" onmouseout="out('5502177219725162371');" style=""> 365                     LOG.warn(&quot;jsonToString array error: &quot; + e.getLocalizedMessage());                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366                 }                                                                                        </span>
<span class="-4254234117673713204" onmouseenter="enter('-4254234117673713204');" onmouseout="out('-4254234117673713204');" style=""> 367                 json += jsonToStringInternal(o);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368             }                                                                                            </span>
<span class="-5174318501251175353" onmouseenter="enter('-5174318501251175353');" onmouseout="out('-5174318501251175353');" style=""> 369             return json + &quot;]&quot;;                                                                           </span>
<span class="8699967118061541294" onmouseenter="enter('8699967118061541294');" onmouseout="out('8699967118061541294');" style=""> 370         } else if (v instanceof JSONObject) {                                                            </span>
<span class="6520491509195983979" onmouseenter="enter('6520491509195983979');" onmouseout="out('6520491509195983979');" style=""> 371             JSONObject obj = ((JSONObject) (v));                                                         </span>
<span class="-6486828837023838756" onmouseenter="enter('-6486828837023838756');" onmouseout="out('-6486828837023838756');" style=""> 372             String json = &quot;{&quot;;                                                                           </span>
<span class="7563206350819307174" onmouseenter="enter('7563206350819307174');" onmouseout="out('7563206350819307174');" style=""> 373             Iterator&lt;String&gt; iter = obj.keys();                                                          </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 374             while (iter.hasNext()) {                                                                     </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 375                 String key = iter.next();                                                                </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style=""> 376                 Object o = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 377                 try {                                                                                    </span>
<span class="8042496106905891292" onmouseenter="enter('8042496106905891292');" onmouseout="out('8042496106905891292');" style=""> 378                     o = obj.get(key);                                                                    </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 379                 } catch (JSONException e) {                                                              </span>
<span class="2953006937969085175" onmouseenter="enter('2953006937969085175');" onmouseout="out('2953006937969085175');" style=""> 380                     LOG.warn(&quot;jsonToString object error: &quot; + e.getLocalizedMessage());                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381                 }                                                                                        </span>
<span class="2327666277772003897" onmouseenter="enter('2327666277772003897');" onmouseout="out('2327666277772003897');" style=""> 382                 json += (key + &quot;:&quot;) + jsonToStringInternal(o);                                           </span>
<span class="8441698388627537050" onmouseenter="enter('8441698388627537050');" onmouseout="out('8441698388627537050');" style=""> 383                 if (iter.hasNext()) {                                                                    </span>
<span class="-8541737388862892319" onmouseenter="enter('-8541737388862892319');" onmouseout="out('-8541737388862892319');" style=""> 384                     json += &quot;,&quot;;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386             }                                                                                            </span>
<span class="-3439487844327173366" onmouseenter="enter('-3439487844327173366');" onmouseout="out('-3439487844327173366');" style=""> 387             return json + &quot;}&quot;;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388         }                                                                                                </span>
<span class="3525583877034800949" onmouseenter="enter('3525583877034800949');" onmouseout="out('3525583877034800949');" style=""> 389         return v.toString();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390     }                                                                                                    </span>
<span  style=""> 391                                                                                                          </span>
<span class="-4462526562745695882" onmouseenter="enter('-4462526562745695882');" onmouseout="out('-4462526562745695882');" style=""> 392     /// Convert a JSON object to a JSON String (NOT 100% JSON compliant)                                 </span>
<span class="4157561026938027662" onmouseenter="enter('4157561026938027662');" onmouseout="out('4157561026938027662');" style=""> 393     public String jsonToString(JSONObject jsonObj) {                                                     </span>
<span class="-3297195869188929142" onmouseenter="enter('-3297195869188929142');" onmouseout="out('-3297195869188929142');" style=""> 394         /* jsonObj.toString() works but breaks char codes&gt;128 (encodes as UTF8?) and also uses           </span>
<span class="7509381523120718717" onmouseenter="enter('7509381523120718717');" onmouseout="out('7509381523120718717');" style=""> 395         \u0000 when just \0 would do (and so on).                                                        </span>
<span  style=""> 396                                                                                                          </span>
<span class="-1336376992819668396" onmouseenter="enter('-1336376992819668396');" onmouseout="out('-1336376992819668396');" style=""> 397         So we do it manually, which can be more compact anyway.                                          </span>
<span class="-5084316389888644344" onmouseenter="enter('-5084316389888644344');" onmouseout="out('-5084316389888644344');" style=""> 398         This is JSON-ish, so not exactly as per JSON1 spec but good enough for Espruino.                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 399          */                                                                                              </span>
<span class="7796956154837315813" onmouseenter="enter('7796956154837315813');" onmouseout="out('7796956154837315813');" style=""> 400         return jsonToStringInternal(jsonObj);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="31684629009080209" onmouseenter="enter('31684629009080209');" onmouseout="out('31684629009080209');" style=""> 403     /// Write a JSON object of data                                                                      </span>
<span class="-8756055707520682190" onmouseenter="enter('-8756055707520682190');" onmouseout="out('-8756055707520682190');" style=""> 404     private void uartTxJSON(String taskName, JSONObject json) {                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 405         try {                                                                                            </span>
<span class="-6185382728407385788" onmouseenter="enter('-6185382728407385788');" onmouseout="out('-6185382728407385788');" style=""> 406             TransactionBuilder builder = performInitialized(taskName);                                   </span>
<span class="-5291927674188184215" onmouseenter="enter('-5291927674188184215');" onmouseout="out('-5291927674188184215');" style=""> 407             uartTx(builder, &quot;\u0010GB(&quot;+jsonToString(json)+&quot;)\n&quot;);                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 408             builder.queue(getQueue());                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 409         } catch (IOException e) {                                                                        </span>
<span class="2446652404576165600" onmouseenter="enter('2446652404576165600');" onmouseout="out('2446652404576165600');" style=""><abbr title=" 410             GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 410             GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONGðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412     }                                                                                                    </span>
<span  style=""> 413                                                                                                          </span>
<span class="4290598848752150102" onmouseenter="enter('4290598848752150102');" onmouseout="out('4290598848752150102');" style=""> 414     /// Write JSON object of the form {t:taskName, err:message}                                          </span>
<span  style=""> 415                                                                                                          </span>
<span class="-8058058420395857539" onmouseenter="enter('-8058058420395857539');" onmouseout="out('-8058058420395857539');" style=""> 416     private void uartTxJSONError(String taskName, String message) {                                      </span>
<span class="3966342241212062344" onmouseenter="enter('3966342241212062344');" onmouseout="out('3966342241212062344');" style=""> 417         uartTxJSONError(taskName,message,null);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418     }                                                                                                    </span>
<span  style=""> 419                                                                                                          </span>
<span class="7327259819120083170" onmouseenter="enter('7327259819120083170');" onmouseout="out('7327259819120083170');" style=""> 420     private void uartTxJSONError(String taskName, String message,String id) {                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 421         JSONObject o = new JSONObject();                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 422         try {                                                                                            </span>
<span class="-4736457139552862676" onmouseenter="enter('-4736457139552862676');" onmouseout="out('-4736457139552862676');" style=""> 423             o.put(&quot;t&quot;, taskName);                                                                        </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 424             if( id!=null)                                                                                </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 425                 o.put(&quot;id&quot;, id);                                                                         </span>
<span class="-3362855442851232299" onmouseenter="enter('-3362855442851232299');" onmouseout="out('-3362855442851232299');" style=""> 426             o.put(&quot;err&quot;, message);                                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 427         } catch (JSONException e) {                                                                      </span>
<span class="-293713289384668060" onmouseenter="enter('-293713289384668060');" onmouseout="out('-293713289384668060');" style=""><abbr title=" 428             GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 428             GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.EðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429         }                                                                                                </span>
<span class="-3544369649702046019" onmouseenter="enter('-3544369649702046019');" onmouseout="out('-3544369649702046019');" style=""> 430         uartTxJSON(taskName, o);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431     }                                                                                                    </span>
<span  style=""> 432                                                                                                          </span>
<span class="3549324304064443217" onmouseenter="enter('3549324304064443217');" onmouseout="out('3549324304064443217');" style=""> 433     private void handleUartRxLine(String line) {                                                         </span>
<span class="7696744219355043330" onmouseenter="enter('7696744219355043330');" onmouseout="out('7696744219355043330');" style=""> 434         LOG.info(&quot;UART RX LINE: &quot; + line);                                                               </span>
<span class="3576528791698119885" onmouseenter="enter('3576528791698119885');" onmouseout="out('3576528791698119885');" style=""> 435         if (line.length() == 0) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 436             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437         }                                                                                                </span>
<span class="3376197024318262350" onmouseenter="enter('3376197024318262350');" onmouseout="out('3376197024318262350');" style=""> 438         if (&quot;&gt;Uncaught ReferenceError: \&quot;GB\&quot; is not defined&quot;.equals(line)) {                            </span>
<span class="7158908931448264833" onmouseenter="enter('7158908931448264833');" onmouseout="out('7158908931448264833');" style=""><abbr title=" 439             GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 439             GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="7187336905794741510" onmouseenter="enter('7187336905794741510');" onmouseout="out('7187336905794741510');" style=""> 440         } else if (line.charAt(0) == &#x27;{&#x27;) {                                                              </span>
<span class="8231786037032554769" onmouseenter="enter('8231786037032554769');" onmouseout="out('8231786037032554769');" style=""> 441             // JSON - we hope!                                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 442             try {                                                                                        </span>
<span class="2411116435363976231" onmouseenter="enter('2411116435363976231');" onmouseout="out('2411116435363976231');" style=""> 443                 JSONObject json = new JSONObject(line);                                                  </span>
<span class="8233558512387133223" onmouseenter="enter('8233558512387133223');" onmouseout="out('8233558512387133223');" style=""> 444                 LOG.info(&quot;UART RX JSON parsed successfully&quot;);                                            </span>
<span class="4509864865787947019" onmouseenter="enter('4509864865787947019');" onmouseout="out('4509864865787947019');" style=""> 445                 handleUartRxJSON(json);                                                                  </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 446             } catch (JSONException e) {                                                                  </span>
<span class="6152452966279211564" onmouseenter="enter('6152452966279211564');" onmouseout="out('6152452966279211564');" style=""> 447                 LOG.info(&quot;UART RX JSON parse failure: &quot; + e.getLocalizedMessage());                      </span>
<span class="8356145272001509336" onmouseenter="enter('8356145272001509336');" onmouseout="out('8356145272001509336');" style=""><abbr title=" 448                 GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 448                 GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), ToastðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 450         } else {                                                                                         </span>
<span class="1693056504573772476" onmouseenter="enter('1693056504573772476');" onmouseout="out('1693056504573772476');" style=""> 451             LOG.info((&quot;UART RX line started with &quot; + ((int) (line.charAt(0)))) + &quot; - ignoring&quot;);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453     }                                                                                                    </span>
<span  style=""> 454                                                                                                          </span>
<span class="-1023302836013344522" onmouseenter="enter('-1023302836013344522');" onmouseout="out('-1023302836013344522');" style=""> 455     private void handleUartRxJSON(JSONObject json) throws JSONException {                                </span>
<span class="7061070849429770108" onmouseenter="enter('7061070849429770108');" onmouseout="out('7061070849429770108');" style=""> 456         String packetType = json.getString(&quot;t&quot;);                                                         </span>
<span class="2121648211711712075" onmouseenter="enter('2121648211711712075');" onmouseout="out('2121648211711712075');" style=""> 457         switch (packetType) {                                                                            </span>
<span class="8257595597266786757" onmouseenter="enter('8257595597266786757');" onmouseout="out('8257595597266786757');" style=""> 458             case &quot;info&quot; :                                                                                </span>
<span class="6489300233296788049" onmouseenter="enter('6489300233296788049');" onmouseout="out('6489300233296788049');" style=""><abbr title=" 459                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO);"> 459                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO)ðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 460                 break;                                                                                   </span>
<span class="3620617518043881921" onmouseenter="enter('3620617518043881921');" onmouseout="out('3620617518043881921');" style=""> 461             case &quot;warn&quot; :                                                                                </span>
<span class="-1267997652646506218" onmouseenter="enter('-1267997652646506218');" onmouseout="out('-1267997652646506218');" style=""><abbr title=" 462                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN);"> 462                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN)ðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 463                 break;                                                                                   </span>
<span class="-3706274782362016842" onmouseenter="enter('-3706274782362016842');" onmouseout="out('-3706274782362016842');" style=""> 464             case &quot;error&quot; :                                                                               </span>
<span class="3082648944163426921" onmouseenter="enter('3082648944163426921');" onmouseout="out('3082648944163426921');" style=""><abbr title=" 465                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERROR);"> 465                 GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERRORðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 466                 break;                                                                                   </span>
<span class="-384708487345316543" onmouseenter="enter('-384708487345316543');" onmouseout="out('-384708487345316543');" style=""> 467             case &quot;ver&quot; :                                                                                 </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 468                 {                                                                                        </span>
<span class="7839433048464938701" onmouseenter="enter('7839433048464938701');" onmouseout="out('7839433048464938701');" style=""> 469                     if (json.has(&quot;fw1&quot;)) {                                                               </span>
<span class="7809101785256581980" onmouseenter="enter('7809101785256581980');" onmouseout="out('7809101785256581980');" style=""> 470                         getDevice().setFirmwareVersion(json.getString(&quot;fw1&quot;));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471                     }                                                                                    </span>
<span class="4456277737803037921" onmouseenter="enter('4456277737803037921');" onmouseout="out('4456277737803037921');" style=""> 472                     if (json.has(&quot;fw2&quot;)) {                                                               </span>
<span class="-1725698584982350052" onmouseenter="enter('-1725698584982350052');" onmouseout="out('-1725698584982350052');" style=""> 473                         getDevice().setFirmwareVersion2(json.getString(&quot;fw2&quot;));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 476                 break;                                                                                   </span>
<span class="201054612750788821" onmouseenter="enter('201054612750788821');" onmouseout="out('201054612750788821');" style=""> 477             case &quot;status&quot; :                                                                              </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 478                 {                                                                                        </span>
<span class="1472249640876064382" onmouseenter="enter('1472249640876064382');" onmouseout="out('1472249640876064382');" style=""> 479                     GBDeviceEventBatteryInfo batteryInfo = new GBDeviceEventBatteryInfo();               </span>
<span class="-8684865925727857265" onmouseenter="enter('-8684865925727857265');" onmouseout="out('-8684865925727857265');" style=""> 480                     if (json.has(&quot;bat&quot;)) {                                                               </span>
<span class="3744277214774220447" onmouseenter="enter('3744277214774220447');" onmouseout="out('3744277214774220447');" style=""> 481                         int b = json.getInt(&quot;bat&quot;);                                                      </span>
<span class="3141346019756563905" onmouseenter="enter('3141346019756563905');" onmouseout="out('3141346019756563905');" style=""> 482                         if (b &lt; 0) {                                                                     </span>
<span class="-9059849556022659364" onmouseenter="enter('-9059849556022659364');" onmouseout="out('-9059849556022659364');" style=""> 483                             b = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484                         }                                                                                </span>
<span class="6944362793521286299" onmouseenter="enter('6944362793521286299');" onmouseout="out('6944362793521286299');" style=""> 485                         if (b &gt; 100) {                                                                   </span>
<span class="7646004800392088212" onmouseenter="enter('7646004800392088212');" onmouseout="out('7646004800392088212');" style=""> 486                             b = 100;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487                         }                                                                                </span>
<span class="6496455062087841098" onmouseenter="enter('6496455062087841098');" onmouseout="out('6496455062087841098');" style=""> 488                         batteryInfo.level = b;                                                           </span>
<span class="-2105719386055198398" onmouseenter="enter('-2105719386055198398');" onmouseout="out('-2105719386055198398');" style=""> 489                         batteryInfo.state = BatteryState.BATTERY_NORMAL;                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490                     }                                                                                    </span>
<span class="-6137562215460910907" onmouseenter="enter('-6137562215460910907');" onmouseout="out('-6137562215460910907');" style=""> 491                     if (json.has(&quot;chg&quot;) &amp;&amp; (json.getInt(&quot;chg&quot;) == 1)) {                                  </span>
<span class="-936118866357790298" onmouseenter="enter('-936118866357790298');" onmouseout="out('-936118866357790298');" style=""> 492                         batteryInfo.state = BatteryState.BATTERY_CHARGING;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493                     }                                                                                    </span>
<span class="127663014309379431" onmouseenter="enter('127663014309379431');" onmouseout="out('127663014309379431');" style=""> 494                     if (json.has(&quot;volt&quot;)) {                                                              </span>
<span class="4365874674546070375" onmouseenter="enter('4365874674546070375');" onmouseout="out('4365874674546070375');" style=""> 495                         batteryInfo.voltage = ((float) (json.getDouble(&quot;volt&quot;)));                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496                     }                                                                                    </span>
<span class="-1573801757390600576" onmouseenter="enter('-1573801757390600576');" onmouseout="out('-1573801757390600576');" style=""> 497                     handleGBDeviceEvent(batteryInfo);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 499                 break;                                                                                   </span>
<span class="2229242202880704313" onmouseenter="enter('2229242202880704313');" onmouseout="out('2229242202880704313');" style=""> 500             case &quot;findPhone&quot; :                                                                           </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 501                 {                                                                                        </span>
<span class="-2748392883851010177" onmouseenter="enter('-2748392883851010177');" onmouseout="out('-2748392883851010177');" style=""> 502                     boolean start = json.has(&quot;n&quot;) &amp;&amp; json.getBoolean(&quot;n&quot;);                               </span>
<span class="6136676704701652580" onmouseenter="enter('6136676704701652580');" onmouseout="out('6136676704701652580');" style=""> 503                     GBDeviceEventFindPhone deviceEventFindPhone = new GBDeviceEventFindPhone();          </span>
<span class="-7374195378437822275" onmouseenter="enter('-7374195378437822275');" onmouseout="out('-7374195378437822275');" style=""><abbr title=" 504                     deviceEventFindPhone.event = (start) ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFindPhone.Event.STOP;"> 504                     deviceEventFindPhone.event = (start) ? GBDeviceEventFindPhone.Event.START : GBDeviceEðŸ”µ</abbr></span>
<span class="-1455650059425895125" onmouseenter="enter('-1455650059425895125');" onmouseout="out('-1455650059425895125');" style=""> 505                     evaluateGBDeviceEvent(deviceEventFindPhone);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 507                 break;                                                                                   </span>
<span class="-439924054420654571" onmouseenter="enter('-439924054420654571');" onmouseout="out('-439924054420654571');" style=""> 508             case &quot;music&quot; :                                                                               </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 509                 {                                                                                        </span>
<span class="-5683743334008418698" onmouseenter="enter('-5683743334008418698');" onmouseout="out('-5683743334008418698');" style=""> 510                     GBDeviceEventMusicControl deviceEventMusicControl = new GBDeviceEventMusicControl(); </span>
<span class="5894306574008826676" onmouseenter="enter('5894306574008826676');" onmouseout="out('5894306574008826676');" style=""><abbr title=" 511                     deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 511                     deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getStrinðŸ”µ</abbr></span>
<span class="8133545861002504946" onmouseenter="enter('8133545861002504946');" onmouseout="out('8133545861002504946');" style=""> 512                     evaluateGBDeviceEvent(deviceEventMusicControl);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 514                 break;                                                                                   </span>
<span class="-1549130490559468169" onmouseenter="enter('-1549130490559468169');" onmouseout="out('-1549130490559468169');" style=""> 515             case &quot;call&quot; :                                                                                </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 516                 {                                                                                        </span>
<span class="2406734484891175482" onmouseenter="enter('2406734484891175482');" onmouseout="out('2406734484891175482');" style=""> 517                     GBDeviceEventCallControl deviceEventCallControl = new GBDeviceEventCallControl();    </span>
<span class="-5299176663874891056" onmouseenter="enter('-5299176663874891056');" onmouseout="out('-5299176663874891056');" style=""><abbr title=" 518                     deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 518                     deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(ðŸ”µ</abbr></span>
<span class="-7699727803461656923" onmouseenter="enter('-7699727803461656923');" onmouseout="out('-7699727803461656923');" style=""> 519                     evaluateGBDeviceEvent(deviceEventCallControl);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 521                 break;                                                                                   </span>
<span class="7945941463689776504" onmouseenter="enter('7945941463689776504');" onmouseout="out('7945941463689776504');" style=""> 522             case &quot;notify&quot; :                                                                              </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 523                 {                                                                                        </span>
<span class="1278038111464368986" onmouseenter="enter('1278038111464368986');" onmouseout="out('1278038111464368986');" style=""><abbr title=" 524                     GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificationControl();"> 524                     GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotiðŸ”µ</abbr></span>
<span class="-6597246807803729732" onmouseenter="enter('-6597246807803729732');" onmouseout="out('-6597246807803729732');" style=""> 525                     // .title appears unused                                                             </span>
<span class="-3304774628543622498" onmouseenter="enter('-3304774628543622498');" onmouseout="out('-3304774628543622498');" style=""><abbr title=" 526                     deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 526                     deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(jðŸ”µ</abbr></span>
<span class="-6839551330654272104" onmouseenter="enter('-6839551330654272104');" onmouseout="out('-6839551330654272104');" style=""> 527                     if (json.has(&quot;id&quot;)) {                                                                </span>
<span class="1062450614172957636" onmouseenter="enter('1062450614172957636');" onmouseout="out('1062450614172957636');" style=""> 528                         deviceEvtNotificationControl.handle = json.getInt(&quot;id&quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529                     }                                                                                    </span>
<span class="6017600880550682559" onmouseenter="enter('6017600880550682559');" onmouseout="out('6017600880550682559');" style=""> 530                     if (json.has(&quot;tel&quot;)) {                                                               </span>
<span class="3912257448498793625" onmouseenter="enter('3912257448498793625');" onmouseout="out('3912257448498793625');" style=""> 531                         deviceEvtNotificationControl.phoneNumber = json.getString(&quot;tel&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532                     }                                                                                    </span>
<span class="4877334614942896057" onmouseenter="enter('4877334614942896057');" onmouseout="out('4877334614942896057');" style=""> 533                     if (json.has(&quot;msg&quot;)) {                                                               </span>
<span class="6661039268276828670" onmouseenter="enter('6661039268276828670');" onmouseout="out('6661039268276828670');" style=""> 534                         deviceEvtNotificationControl.reply = json.getString(&quot;msg&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                     }                                                                                    </span>
<span class="-1817112681649718085" onmouseenter="enter('-1817112681649718085');" onmouseout="out('-1817112681649718085');" style=""> 536                 /* REPLY responses don&#x27;t use the ID from the event (MUTE/etc seem to), but instead       </span>
<span class="5406797550372080886" onmouseenter="enter('5406797550372080886');" onmouseout="out('5406797550372080886');" style=""> 537                 * they use a handle that was provided in an action list on the onNotification.. event  */</span>
<span class="-4787844253490591897" onmouseenter="enter('-4787844253490591897');" onmouseout="out('-4787844253490591897');" style=""><abbr title=" 538                     if (deviceEvtNotificationControl.event == GBDeviceEventNotificationControl.Event.REPLY) {"> 538                     if (deviceEvtNotificationControl.event == GBDeviceEventNotificationControl.Event.REPLðŸ”µ</abbr></span>
<span class="1334079968342110130" onmouseenter="enter('1334079968342110130');" onmouseout="out('1334079968342110130');" style=""><abbr title=" 539                         Long foundHandle = ((Long) (mNotificationReplyAction.lookup(((int) (deviceEvtNotificationControl.handle)))));"> 539                         Long foundHandle = ((Long) (mNotificationReplyAction.lookup(((int) (deviceEvtNotiðŸ”µ</abbr></span>
<span class="7103413633083714949" onmouseenter="enter('7103413633083714949');" onmouseout="out('7103413633083714949');" style=""> 540                         if (foundHandle != null) {                                                       </span>
<span class="-5768705298123946646" onmouseenter="enter('-5768705298123946646');" onmouseout="out('-5768705298123946646');" style=""> 541                             deviceEvtNotificationControl.handle = foundHandle;                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543                     }                                                                                    </span>
<span class="1799618905473722788" onmouseenter="enter('1799618905473722788');" onmouseout="out('1799618905473722788');" style=""> 544                     evaluateGBDeviceEvent(deviceEvtNotificationControl);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 546                 break;                                                                                   </span>
<span class="7575887232037628059" onmouseenter="enter('7575887232037628059');" onmouseout="out('7575887232037628059');" style=""> 547             case &quot;act&quot; :                                                                                 </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 548                 {                                                                                        </span>
<span class="8371010899036944571" onmouseenter="enter('8371010899036944571');" onmouseout="out('8371010899036944571');" style=""> 549                     BangleJSActivitySample sample = new BangleJSActivitySample();                        </span>
<span class="-3747344891166319436" onmouseenter="enter('-3747344891166319436');" onmouseout="out('-3747344891166319436');" style=""><abbr title=" 550                     sample.setTimestamp(((int) (GregorianCalendar.getInstance().getTimeInMillis() / 1000L)));"> 550                     sample.setTimestamp(((int) (GregorianCalendar.getInstance().getTimeInMillis() / 1000LðŸ”µ</abbr></span>
<span class="-6511180810366476909" onmouseenter="enter('-6511180810366476909');" onmouseout="out('-6511180810366476909');" style=""> 551                     int hrm = 0;                                                                         </span>
<span class="-2794193254662759202" onmouseenter="enter('-2794193254662759202');" onmouseout="out('-2794193254662759202');" style=""> 552                     int steps = 0;                                                                       </span>
<span class="2718998260350413448" onmouseenter="enter('2718998260350413448');" onmouseout="out('2718998260350413448');" style=""> 553                     if (json.has(&quot;hrm&quot;)) {                                                               </span>
<span class="-1793157959375520860" onmouseenter="enter('-1793157959375520860');" onmouseout="out('-1793157959375520860');" style=""> 554                         hrm = json.getInt(&quot;hrm&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555                     }                                                                                    </span>
<span class="5509452681002536693" onmouseenter="enter('5509452681002536693');" onmouseout="out('5509452681002536693');" style=""> 556                     if (json.has(&quot;stp&quot;)) {                                                               </span>
<span class="-869114754117571597" onmouseenter="enter('-869114754117571597');" onmouseout="out('-869114754117571597');" style=""> 557                         steps = json.getInt(&quot;stp&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558                     }                                                                                    </span>
<span class="6603465025108101037" onmouseenter="enter('6603465025108101037');" onmouseout="out('6603465025108101037');" style=""> 559                     int activity = BangleJSSampleProvider.TYPE_ACTIVITY;                                 </span>
<span class="3613450311757741108" onmouseenter="enter('3613450311757741108');" onmouseout="out('3613450311757741108');" style=""> 560                     /* if (json.has(&quot;act&quot;)) {                                                            </span>
<span class="-2439039461724633138" onmouseenter="enter('-2439039461724633138');" onmouseout="out('-2439039461724633138');" style=""> 561                     String actName = &quot;TYPE_&quot; + json.getString(&quot;act&quot;).toUpperCase();                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 562                     try {                                                                                </span>
<span class="-5191337226244238063" onmouseenter="enter('-5191337226244238063');" onmouseout="out('-5191337226244238063');" style=""> 563                     Field f = ActivityKind.class.getField(actName);                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 564                     try {                                                                                </span>
<span class="8672601729845658913" onmouseenter="enter('8672601729845658913');" onmouseout="out('8672601729845658913');" style=""> 565                     activity = f.getInt(null);                                                           </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 566                     } catch (IllegalAccessException e) {                                                 </span>
<span class="9211658540801898058" onmouseenter="enter('9211658540801898058');" onmouseout="out('9211658540801898058');" style=""> 567                     LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not readable&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568                     }                                                                                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 569                     } catch (NoSuchFieldException e) {                                                   </span>
<span class="-4236592020282047640" onmouseenter="enter('-4236592020282047640');" onmouseout="out('-4236592020282047640');" style=""> 570                     LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not found&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572                     }                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 573                      */                                                                                  </span>
<span class="8668161863330653058" onmouseenter="enter('8668161863330653058');" onmouseout="out('8668161863330653058');" style=""> 574                     sample.setRawKind(activity);                                                         </span>
<span class="5935105042646692248" onmouseenter="enter('5935105042646692248');" onmouseout="out('5935105042646692248');" style=""> 575                     sample.setHeartRate(hrm);                                                            </span>
<span class="-4745425836300475693" onmouseenter="enter('-4745425836300475693');" onmouseout="out('-4745425836300475693');" style=""> 576                     sample.setSteps(steps);                                                              </span>
<span class="-4664868025801837253" onmouseenter="enter('-4664868025801837253');" onmouseout="out('-4664868025801837253');" style=""> 577                     try (final DBHandler dbHandler = GBApplication.acquireDB()) {                        </span>
<span class="1422413790142608640" onmouseenter="enter('1422413790142608640');" onmouseout="out('1422413790142608640');" style=""> 578                         Long userId = getUser(dbHandler.getDaoSession()).getId();                        </span>
<span class="3688300519339275893" onmouseenter="enter('3688300519339275893');" onmouseout="out('3688300519339275893');" style=""><abbr title=" 579                         Long deviceId = DBHelper.getDevice(getDevice(), dbHandler.getDaoSession()).getId();"> 579                         Long deviceId = DBHelper.getDevice(getDevice(), dbHandler.getDaoSession()).getId(ðŸ”µ</abbr></span>
<span class="-4884679916644886432" onmouseenter="enter('-4884679916644886432');" onmouseout="out('-4884679916644886432');" style=""><abbr title=" 580                         BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.getDaoSession());"> 580                         BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandlðŸ”µ</abbr></span>
<span class="6444535225867718796" onmouseenter="enter('6444535225867718796');" onmouseout="out('6444535225867718796');" style=""> 581                         sample.setDeviceId(deviceId);                                                    </span>
<span class="292659008851945780" onmouseenter="enter('292659008851945780');" onmouseout="out('292659008851945780');" style=""> 582                         sample.setUserId(userId);                                                        </span>
<span class="4765059548563428130" onmouseenter="enter('4765059548563428130');" onmouseout="out('4765059548563428130');" style=""> 583                         provider.addGBActivitySample(sample);                                            </span>
<span class="-2749309157466987679" onmouseenter="enter('-2749309157466987679');" onmouseout="out('-2749309157466987679');" style=""> 584                     } catch (java.lang.Exception ex) {                                                   </span>
<span class="1206810911036844482" onmouseenter="enter('1206810911036844482');" onmouseout="out('1206810911036844482');" style=""> 585                         LOG.warn(&quot;Error saving activity: &quot; + ex.getLocalizedMessage());                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586                     }                                                                                    </span>
<span class="5171490897490639183" onmouseenter="enter('5171490897490639183');" onmouseout="out('5171490897490639183');" style=""> 587                     // push realtime data                                                                </span>
<span class="-6833823710638969612" onmouseenter="enter('-6833823710638969612');" onmouseout="out('-6833823710638969612');" style=""> 588                     if (realtimeHRM || realtimeStep) {                                                   </span>
<span class="-469650191333685908" onmouseenter="enter('-469650191333685908');" onmouseout="out('-469650191333685908');" style=""><abbr title=" 589                         Intent intent = new Intent(DeviceService.ACTION_REALTIME_SAMPLES).putExtra(DeviceService.EXTRA_REALTIME_SAMPLE, sample);"> 589                         Intent intent = new Intent(DeviceService.ACTION_REALTIME_SAMPLES).putExtra(DeviceðŸ”µ</abbr></span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 590                         LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 593                 break;                                                                                   </span>
<span class="6578946551069653891" onmouseenter="enter('6578946551069653891');" onmouseout="out('6578946551069653891');" style=""> 594             case &quot;http&quot; :                                                                                </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 595                 {                                                                                        </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 596                     Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 596                     Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getðŸ”µ</abbr></span>
<span class="-2953622124354391707" onmouseenter="enter('-2953622124354391707');" onmouseout="out('-2953622124354391707');" style=""> 597                     String _id = null;                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 598                     try {                                                                                </span>
<span class="4672396922249032002" onmouseenter="enter('4672396922249032002');" onmouseout="out('4672396922249032002');" style=""> 599                         _id = json.getString(&quot;id&quot;);                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 600                     } catch (JSONException e) {                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601                     }                                                                                    </span>
<span class="5919143370037839830" onmouseenter="enter('5919143370037839830');" onmouseout="out('5919143370037839830');" style=""> 602                     final String id = _id;                                                               </span>
<span class="-6992637283999421128" onmouseenter="enter('-6992637283999421128');" onmouseout="out('-6992637283999421128');" style=""><abbr title=" 603                     if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESS, false)) {"> 603                     if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESSðŸ”µ</abbr></span>
<span class="3585939051150823686" onmouseenter="enter('3585939051150823686');" onmouseout="out('3585939051150823686');" style=""> 604                         RequestQueue queue = Volley.newRequestQueue(getContext());                       </span>
<span class="5176519532323120311" onmouseenter="enter('5176519532323120311');" onmouseout="out('5176519532323120311');" style=""> 605                         String url = json.getString(&quot;url&quot;);                                              </span>
<span class="-3545396317642083141" onmouseenter="enter('-3545396317642083141');" onmouseout="out('-3545396317642083141');" style=""> 606                         String _xmlPath = &quot;&quot;;                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 607                         try {                                                                            </span>
<span class="-6862471463745020928" onmouseenter="enter('-6862471463745020928');" onmouseout="out('-6862471463745020928');" style=""> 608                             _xmlPath = json.getString(&quot;xpath&quot;);                                          </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 609                         } catch (JSONException e) {                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610                         }                                                                                </span>
<span class="605766333889403990" onmouseenter="enter('605766333889403990');" onmouseout="out('605766333889403990');" style=""> 611                         final String xmlPath = _xmlPath;                                                 </span>
<span class="-7325827083532572939" onmouseenter="enter('-7325827083532572939');" onmouseout="out('-7325827083532572939');" style=""> 612                         // Request a string response from the provided URL.                              </span>
<span class="6204867909111487361" onmouseenter="enter('6204867909111487361');" onmouseout="out('6204867909111487361');" style=""><abbr title=" 613                         StringRequest stringRequest = new StringRequest(Request.Method.GET, url, new Response.Listener&lt;String&gt;() {"> 613                         StringRequest stringRequest = new StringRequest(Request.Method.GET, url, new RespðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 614                             @Override                                                                    </span>
<span class="2219137294630149657" onmouseenter="enter('2219137294630149657');" onmouseout="out('2219137294630149657');" style=""> 615                             public void onResponse(String response) {                                    </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 616                                 JSONObject o = new JSONObject();                                         </span>
<span class="3496993666001094453" onmouseenter="enter('3496993666001094453');" onmouseout="out('3496993666001094453');" style=""> 617                                 if (xmlPath.length() != 0) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 618                                     try {                                                                </span>
<span class="5597187660883583119" onmouseenter="enter('5597187660883583119');" onmouseout="out('5597187660883583119');" style=""><abbr title=" 619                                         InputSource inputXML = new InputSource(new StringReader(response));"> 619                                         InputSource inputXML = new InputSource(new StringReader(response)ðŸ”µ</abbr></span>
<span class="-160158441380049344" onmouseenter="enter('-160158441380049344');" onmouseout="out('-160158441380049344');" style=""> 620                                         XPath xPath = XPathFactory.newInstance().newXPath();             </span>
<span class="-5056989228059087382" onmouseenter="enter('-5056989228059087382');" onmouseout="out('-5056989228059087382');" style=""> 621                                         response = xPath.evaluate(xmlPath, inputXML);                    </span>
<span class="6915073702287441966" onmouseenter="enter('6915073702287441966');" onmouseout="out('6915073702287441966');" style=""> 622                                     } catch ( error) {                                                   </span>
<span class="8669238683349277164" onmouseenter="enter('8669238683349277164');" onmouseout="out('8669238683349277164');" style=""> 623                                         uartTxJSONError(&quot;http&quot;, error.toString(), id);                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 624                                         return;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625                                     }                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626                                 }                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 627                                 try {                                                                    </span>
<span class="6603605385044119606" onmouseenter="enter('6603605385044119606');" onmouseout="out('6603605385044119606');" style=""> 628                                     o.put(&quot;t&quot;, &quot;http&quot;);                                                  </span>
<span class="-168595834781466469" onmouseenter="enter('-168595834781466469');" onmouseout="out('-168595834781466469');" style=""> 629                                     if (id != null) {                                                    </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 630                                         o.put(&quot;id&quot;, id);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631                                     }                                                                    </span>
<span class="-7019821812941989411" onmouseenter="enter('-7019821812941989411');" onmouseout="out('-7019821812941989411');" style=""> 632                                     o.put(&quot;resp&quot;, response);                                             </span>
<span class="6077291764686690243" onmouseenter="enter('6077291764686690243');" onmouseout="out('6077291764686690243');" style=""> 633                                 } catch ( e) {                                                           </span>
<span class="5084509021389731794" onmouseenter="enter('5084509021389731794');" onmouseout="out('5084509021389731794');" style=""><abbr title=" 634                                     GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 634                                     GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635                                 }                                                                        </span>
<span class="-4140114778756524985" onmouseenter="enter('-4140114778756524985');" onmouseout="out('-4140114778756524985');" style=""> 636                                 uartTxJSON(&quot;http&quot;, o);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637                             }                                                                            </span>
<span class="4760556576659557486" onmouseenter="enter('4760556576659557486');" onmouseout="out('4760556576659557486');" style=""> 638                         }, new Response.ErrorListener() {                                                </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 639                             @Override                                                                    </span>
<span class="3365806574504816618" onmouseenter="enter('3365806574504816618');" onmouseout="out('3365806574504816618');" style=""> 640                             public void onErrorResponse(VolleyError error) {                             </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 641                                 JSONObject o = new JSONObject();                                         </span>
<span class="8669238683349277164" onmouseenter="enter('8669238683349277164');" onmouseout="out('8669238683349277164');" style=""> 642                                 uartTxJSONError(&quot;http&quot;, error.toString(), id);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643                             }                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 644                         });                                                                              </span>
<span class="-2087140764948748418" onmouseenter="enter('-2087140764948748418');" onmouseout="out('-2087140764948748418');" style=""> 645                         queue.add(stringRequest);                                                        </span>
<span class="5819964688213219254" onmouseenter="enter('5819964688213219254');" onmouseout="out('5819964688213219254');" style=""> 646                     } else if (BuildConfig.INTERNET_ACCESS) {                                            </span>
<span class="8856156369012126809" onmouseenter="enter('8856156369012126809');" onmouseout="out('8856156369012126809');" style=""><abbr title=" 647                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device Settings&quot;, id);"> 647                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device SðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 648                     } else {                                                                             </span>
<span class="-2120817831627260131" onmouseenter="enter('-2120817831627260131');" onmouseout="out('-2120817831627260131');" style=""><abbr title=" 649                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;, id);"> 649                         uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 650                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 652                 break;                                                                                   </span>
<span class="-998818706321559707" onmouseenter="enter('-998818706321559707');" onmouseout="out('-998818706321559707');" style=""> 653             case &quot;intent&quot; :                                                                              </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 654                 {                                                                                        </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 655                     Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 655                     Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getðŸ”µ</abbr></span>
<span class="-3997484102524704678" onmouseenter="enter('-3997484102524704678');" onmouseout="out('-3997484102524704678');" style=""> 656                     if (devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) {                            </span>
<span class="7885860666276152502" onmouseenter="enter('7885860666276152502');" onmouseout="out('7885860666276152502');" style=""> 657                         String action = json.getString(&quot;action&quot;);                                        </span>
<span class="-6778424845662998727" onmouseenter="enter('-6778424845662998727');" onmouseout="out('-6778424845662998727');" style=""> 658                         JSONObject extra = json.getJSONObject(&quot;extra&quot;);                                  </span>
<span class="5907617214453163300" onmouseenter="enter('5907617214453163300');" onmouseout="out('5907617214453163300');" style=""> 659                         Intent in = new Intent();                                                        </span>
<span class="-8779884887971893320" onmouseenter="enter('-8779884887971893320');" onmouseout="out('-8779884887971893320');" style=""> 660                         in.setAction(action);                                                            </span>
<span class="-5835095174807794521" onmouseenter="enter('-5835095174807794521');" onmouseout="out('-5835095174807794521');" style=""> 661                         if (extra != null) {                                                             </span>
<span class="7421222014058952195" onmouseenter="enter('7421222014058952195');" onmouseout="out('7421222014058952195');" style=""> 662                             Iterator&lt;String&gt; iter = extra.keys();                                        </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 663                             while (iter.hasNext()) {                                                     </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 664                                 String key = iter.next();                                                </span>
<span class="-6860780283306876147" onmouseenter="enter('-6860780283306876147');" onmouseout="out('-6860780283306876147');" style=""> 665                                 in.putExtra(key, extra.getString(key));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667                         }                                                                                </span>
<span class="6658078666630545861" onmouseenter="enter('6658078666630545861');" onmouseout="out('6658078666630545861');" style=""> 668                         LOG.info(&quot;Sending intent &quot; + action);                                            </span>
<span class="-5369611568799868297" onmouseenter="enter('-5369611568799868297');" onmouseout="out('-5369611568799868297');" style=""> 669                         this.getContext().getApplicationContext().sendBroadcast(in);                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 670                     } else {                                                                             </span>
<span class="7018402905003983802" onmouseenter="enter('7018402905003983802');" onmouseout="out('7018402905003983802');" style=""><abbr title=" 671                         uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge Device Settings&quot;);"> 671                         uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge DeviceðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 673                 }                                                                                        </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 674             default :                                                                                    </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 675                 {                                                                                        </span>
<span class="-7449643979637758821" onmouseenter="enter('-7449643979637758821');" onmouseout="out('-7449643979637758821');" style=""> 676                     LOG.info((&quot;UART RX JSON packet type &#x27;&quot; + packetType) + &quot;&#x27; not understood.&quot;);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679     }                                                                                                    </span>
<span  style=""> 680                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 681     @Override                                                                                            </span>
<span class="-5661496586383940029" onmouseenter="enter('-5661496586383940029');" onmouseout="out('-5661496586383940029');" style=""><abbr title=" 682     public boolean onCharacteristicChanged(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic) {"> 682     public boolean onCharacteristicChanged(BluetoothGatt gatt, BluetoothGattCharacteristic characteristicðŸ”µ</abbr></span>
<span class="3568353468682512593" onmouseenter="enter('3568353468682512593');" onmouseout="out('3568353468682512593');" style=""> 683         if (super.onCharacteristicChanged(gatt, characteristic)) {                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 684             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 685         }                                                                                                </span>
<span class="5227655087294118325" onmouseenter="enter('5227655087294118325');" onmouseout="out('5227655087294118325');" style=""> 686         if (BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX.equals(characteristic.getUuid())) {     </span>
<span class="5982523523606215133" onmouseenter="enter('5982523523606215133');" onmouseout="out('5982523523606215133');" style=""> 687             byte[] chars = characteristic.getValue();                                                    </span>
<span class="616145045349787748" onmouseenter="enter('616145045349787748');" onmouseout="out('616145045349787748');" style=""> 688             // check to see if we get more data - if so, increase out MTU for sending                    </span>
<span class="900599847375356649" onmouseenter="enter('900599847375356649');" onmouseout="out('900599847375356649');" style=""> 689             if (allowHighMTU &amp;&amp; (chars.length &gt; mtuSize)) {                                              </span>
<span class="4158896835387507605" onmouseenter="enter('4158896835387507605');" onmouseout="out('4158896835387507605');" style=""> 690                 mtuSize = chars.length;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691             }                                                                                            </span>
<span class="2539938136572489105" onmouseenter="enter('2539938136572489105');" onmouseout="out('2539938136572489105');" style=""> 692             String packetStr = new String(chars);                                                        </span>
<span class="-8749842360460534491" onmouseenter="enter('-8749842360460534491');" onmouseout="out('-8749842360460534491');" style=""> 693             LOG.info(&quot;RX: &quot; + packetStr);                                                                </span>
<span class="6081730255717431423" onmouseenter="enter('6081730255717431423');" onmouseout="out('6081730255717431423');" style=""> 694             // logging                                                                                   </span>
<span class="-5745508240241304992" onmouseenter="enter('-5745508240241304992');" onmouseout="out('-5745508240241304992');" style=""> 695             receiveHistory += packetStr;                                                                 </span>
<span class="-3839845406555242813" onmouseenter="enter('-3839845406555242813');" onmouseout="out('-3839845406555242813');" style=""> 696             if (receiveHistory.length() &gt; MAX_RECEIVE_HISTORY_CHARS) {                                   </span>
<span class="2384681518975537665" onmouseenter="enter('2384681518975537665');" onmouseout="out('2384681518975537665');" style=""><abbr title=" 697                 receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CHARS);"> 697                 receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698             }                                                                                            </span>
<span class="4345605670928647371" onmouseenter="enter('4345605670928647371');" onmouseout="out('4345605670928647371');" style=""> 699             // split into input lines                                                                    </span>
<span class="5259079271083901413" onmouseenter="enter('5259079271083901413');" onmouseout="out('5259079271083901413');" style=""> 700             receivedLine += packetStr;                                                                   </span>
<span class="-2556332053060264516" onmouseenter="enter('-2556332053060264516');" onmouseout="out('-2556332053060264516');" style=""> 701             while (receivedLine.contains(&quot;\n&quot;)) {                                                        </span>
<span class="4579450793956603432" onmouseenter="enter('4579450793956603432');" onmouseout="out('4579450793956603432');" style=""> 702                 int p = receivedLine.indexOf(&quot;\n&quot;);                                                      </span>
<span class="-3595479302674366971" onmouseenter="enter('-3595479302674366971');" onmouseout="out('-3595479302674366971');" style=""> 703                 String line = receivedLine.substring(0, p - 1);                                          </span>
<span class="2537858755103760976" onmouseenter="enter('2537858755103760976');" onmouseout="out('2537858755103760976');" style=""> 704                 receivedLine = receivedLine.substring(p + 1);                                            </span>
<span class="-3428869778620909618" onmouseenter="enter('-3428869778620909618');" onmouseout="out('-3428869778620909618');" style=""> 705                 handleUartRxLine(line);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706             }                                                                                            </span>
<span class="-7051609494506194757" onmouseenter="enter('-7051609494506194757');" onmouseout="out('-7051609494506194757');" style=""> 707             // Send an intent with new data                                                              </span>
<span class="-223393600950927979" onmouseenter="enter('-223393600950927979');" onmouseout="out('-223393600950927979');" style=""> 708             Intent intent = new Intent(BangleJSDeviceSupport.BANGLEJS_COMMAND_RX);                       </span>
<span class="-5525767627942220600" onmouseenter="enter('-5525767627942220600');" onmouseout="out('-5525767627942220600');" style=""> 709             intent.putExtra(&quot;DATA&quot;, packetStr);                                                          </span>
<span class="5708963109403024105" onmouseenter="enter('5708963109403024105');" onmouseout="out('5708963109403024105');" style=""> 710             intent.putExtra(&quot;SEQ&quot;, bangleCommandSeq++);                                                  </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 711             LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 713         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714     }                                                                                                    </span>
<span  style=""> 715                                                                                                          </span>
<span class="3689734917392452830" onmouseenter="enter('3689734917392452830');" onmouseout="out('3689734917392452830');" style=""> 716     void transmitTime(TransactionBuilder builder) {                                                      </span>
<span class="-580696616137890311" onmouseenter="enter('-580696616137890311');" onmouseout="out('-580696616137890311');" style=""> 717       long ts = System.currentTimeMillis();                                                              </span>
<span class="2966270791537104856" onmouseenter="enter('2966270791537104856');" onmouseout="out('2966270791537104856');" style=""> 718       float tz = SimpleTimeZone.getDefault().getOffset(ts) / (1000 * 60 * 60.0f);                        </span>
<span class="3431964532899256755" onmouseenter="enter('3431964532899256755');" onmouseout="out('3431964532899256755');" style=""> 719       // set time                                                                                        </span>
<span class="-1610279467427834467" onmouseenter="enter('-1610279467427834467');" onmouseout="out('-1610279467427834467');" style=""> 720       String cmd = &quot;\u0010setTime(&quot;+(ts/1000)+&quot;);&quot;;                                                      </span>
<span class="-8332305144616549872" onmouseenter="enter('-8332305144616549872');" onmouseout="out('-8332305144616549872');" style=""> 721       // set timezone                                                                                    </span>
<span class="-5517412366789003339" onmouseenter="enter('-5517412366789003339');" onmouseout="out('-5517412366789003339');" style=""> 722       cmd += &quot;E.setTimeZone(&quot;+tz+&quot;);&quot;;                                                                   </span>
<span class="-1545435846395421943" onmouseenter="enter('-1545435846395421943');" onmouseout="out('-1545435846395421943');" style=""> 723       // write timezone to settings                                                                      </span>
<span class="-5908148183258021619" onmouseenter="enter('-5908148183258021619');" onmouseout="out('-5908148183258021619');" style=""><abbr title=" 724       cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;Storage&#x27;).readJSON(&#x27;setting.json&#x27;,1))&quot;;"> 724       cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;StorageðŸ”µ</abbr></span>
<span class="4089130236590622366" onmouseenter="enter('4089130236590622366');" onmouseout="out('4089130236590622366');" style=""> 725       uartTx(builder, cmd+&quot;\n&quot;);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726     }                                                                                                    </span>
<span  style=""> 727                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 728     @Override                                                                                            </span>
<span class="-5141762163842231173" onmouseenter="enter('-5141762163842231173');" onmouseout="out('-5141762163842231173');" style=""> 729     public boolean useAutoConnect() {                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 730         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731     }                                                                                                    </span>
<span  style=""> 732                                                                                                          </span>
<span class="-8620112809460611919" onmouseenter="enter('-8620112809460611919');" onmouseout="out('-8620112809460611919');" style=""> 733     private String renderUnicodeWordAsImage(String word) {                                               </span>
<span class="9035541491240023486" onmouseenter="enter('9035541491240023486');" onmouseout="out('9035541491240023486');" style=""> 734         // check for emoji                                                                               </span>
<span class="5486434163020554131" onmouseenter="enter('5486434163020554131');" onmouseout="out('5486434163020554131');" style=""> 735         boolean hasEmoji = false;                                                                        </span>
<span class="-2763417065276232789" onmouseenter="enter('-2763417065276232789');" onmouseout="out('-2763417065276232789');" style=""> 736         if (EmojiUtils.getAllEmojis() == null) {                                                         </span>
<span class="-4263391647615423897" onmouseenter="enter('-4263391647615423897');" onmouseout="out('-4263391647615423897');" style=""> 737             EmojiManager.initEmojiData(GBApplication.getContext());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738         }                                                                                                </span>
<span class="2166215806491572157" onmouseenter="enter('2166215806491572157');" onmouseout="out('2166215806491572157');" style=""> 739         for (Emoji emoji : EmojiUtils.getAllEmojis()) {                                                  </span>
<span class="-2592293442458908227" onmouseenter="enter('-2592293442458908227');" onmouseout="out('-2592293442458908227');" style=""> 740             if (word.contains(emoji.getEmoji())) {                                                       </span>
<span class="3603213733237101036" onmouseenter="enter('3603213733237101036');" onmouseout="out('3603213733237101036');" style=""> 741                 hasEmoji = true;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 742             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743         }                                                                                                </span>
<span class="2890001900011943869" onmouseenter="enter('2890001900011943869');" onmouseout="out('2890001900011943869');" style=""> 744         // if we had emoji, ensure we create 3 bit color (not 1 bit B&amp;W)                                 </span>
<span class="1347045635000521096" onmouseenter="enter('1347045635000521096');" onmouseout="out('1347045635000521096');" style=""><abbr title=" 745         return &quot;\u0000&quot; + bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : BangleJSBitmapStyle.MONOCHROME);"> 745         return &quot;\u0000&quot; + bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746     }                                                                                                    </span>
<span  style=""> 747                                                                                                          </span>
<span class="8776024667736839740" onmouseenter="enter('8776024667736839740');" onmouseout="out('8776024667736839740');" style=""> 748     public String renderUnicodeAsImage(String txt) {                                                     </span>
<span class="-6900992539845339533" onmouseenter="enter('-6900992539845339533');" onmouseout="out('-6900992539845339533');" style=""> 749         if (txt == null) {                                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 750             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751         }                                                                                                </span>
<span class="-2990212439896506505" onmouseenter="enter('-2990212439896506505');" onmouseout="out('-2990212439896506505');" style=""> 752         /* If we&#x27;re not doing conversion, pass this right back (we use the EmojiConverter                </span>
<span class="-7506261437918887711" onmouseenter="enter('-7506261437918887711');" onmouseout="out('-7506261437918887711');" style=""> 753         As we would have done if BangleJSCoordinator.supportsUnicodeEmojis had reported false            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 754          */                                                                                              </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 755         Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));</span>
<span class="-4117323455397894718" onmouseenter="enter('-4117323455397894718');" onmouseout="out('-4117323455397894718');" style=""> 756         if (!devicePrefs.getBoolean(PREF_BANGLEJS_TEXT_BITMAP, false)) {                                 </span>
<span class="-6218899606023063069" onmouseenter="enter('-6218899606023063069');" onmouseout="out('-6218899606023063069');" style=""> 757             return EmojiConverter.convertUnicodeEmojiToAscii(txt, GBApplication.getContext());           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758         }                                                                                                </span>
<span class="292577723455835940" onmouseenter="enter('292577723455835940');" onmouseout="out('292577723455835940');" style=""> 759         // Otherwise split up and check each word                                                        </span>
<span class="7080532079749589676" onmouseenter="enter('7080532079749589676');" onmouseout="out('7080532079749589676');" style=""> 760         String word = &quot;&quot;;                                                                                </span>
<span class="-3623621045223349277" onmouseenter="enter('-3623621045223349277');" onmouseout="out('-3623621045223349277');" style=""> 761         String result = &quot;&quot;;                                                                              </span>
<span class="-760381533077121579" onmouseenter="enter('-760381533077121579');" onmouseout="out('-760381533077121579');" style=""> 762         boolean needsTranslate = false;                                                                  </span>
<span class="-5307308616277513107" onmouseenter="enter('-5307308616277513107');" onmouseout="out('-5307308616277513107');" style=""> 763         for (int i = 0; i &lt; txt.length(); i++) {                                                         </span>
<span class="-3301384702044321827" onmouseenter="enter('-3301384702044321827');" onmouseout="out('-3301384702044321827');" style=""> 764             char ch = txt.charAt(i);                                                                     </span>
<span class="60687087762063990" onmouseenter="enter('60687087762063990');" onmouseout="out('60687087762063990');" style=""> 765             if (&quot; -_/:.,?!\&#x27;\&quot;&amp;*()&quot;.indexOf(ch) &gt;= 0) {                                                  </span>
<span class="1318526908393735015" onmouseenter="enter('1318526908393735015');" onmouseout="out('1318526908393735015');" style=""> 766                 // word split                                                                            </span>
<span class="3023464089904488098" onmouseenter="enter('3023464089904488098');" onmouseout="out('3023464089904488098');" style=""> 767                 if (needsTranslate) {                                                                    </span>
<span class="-8425102913074219446" onmouseenter="enter('-8425102913074219446');" onmouseout="out('-8425102913074219446');" style=""> 768                 // convert word                                                                          </span>
<span class="8865765689237270422" onmouseenter="enter('8865765689237270422');" onmouseout="out('8865765689237270422');" style=""> 769                     result += renderUnicodeWordAsImage(word) + ch;                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 770                 } else {                                                                                 </span>
<span class="-6421214527688478285" onmouseenter="enter('-6421214527688478285');" onmouseout="out('-6421214527688478285');" style=""> 771                 // or just copy across                                                                   </span>
<span class="1585333345004567155" onmouseenter="enter('1585333345004567155');" onmouseout="out('1585333345004567155');" style=""> 772                     result += word + ch;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773                 }                                                                                        </span>
<span class="4599818924517102902" onmouseenter="enter('4599818924517102902');" onmouseout="out('4599818924517102902');" style=""> 774                 word = &quot;&quot;;                                                                               </span>
<span class="1499680785627976825" onmouseenter="enter('1499680785627976825');" onmouseout="out('1499680785627976825');" style=""> 775                 needsTranslate = false;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 776             } else {                                                                                     </span>
<span class="5371833621916626168" onmouseenter="enter('5371833621916626168');" onmouseout="out('5371833621916626168');" style=""> 777                 // TODO: better check?                                                                   </span>
<span class="-1325131945095916490" onmouseenter="enter('-1325131945095916490');" onmouseout="out('-1325131945095916490');" style=""> 778                 if ((ch &lt; 0) || (ch &gt; 255)) {                                                            </span>
<span class="-3735787848493917158" onmouseenter="enter('-3735787848493917158');" onmouseout="out('-3735787848493917158');" style=""> 779                     needsTranslate = true;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780                 }                                                                                        </span>
<span class="2225265087012361140" onmouseenter="enter('2225265087012361140');" onmouseout="out('2225265087012361140');" style=""> 781                 word += ch;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783         }                                                                                                </span>
<span class="3023464089904488098" onmouseenter="enter('3023464089904488098');" onmouseout="out('3023464089904488098');" style=""> 784         if (needsTranslate) {                                                                            </span>
<span class="-8425102913074219446" onmouseenter="enter('-8425102913074219446');" onmouseout="out('-8425102913074219446');" style=""> 785             // convert word                                                                              </span>
<span class="-2531563633600833789" onmouseenter="enter('-2531563633600833789');" onmouseout="out('-2531563633600833789');" style=""> 786             result += renderUnicodeWordAsImage(word);                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 787         } else {                                                                                         </span>
<span class="-6421214527688478285" onmouseenter="enter('-6421214527688478285');" onmouseout="out('-6421214527688478285');" style=""> 788         // or just copy across                                                                           </span>
<span class="-4182205432270767968" onmouseenter="enter('-4182205432270767968');" onmouseout="out('-4182205432270767968');" style=""> 789             result += word;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 791         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792     }                                                                                                    </span>
<span  style=""> 793                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 794     @Override                                                                                            </span>
<span class="-116609517646424186" onmouseenter="enter('-116609517646424186');" onmouseout="out('-116609517646424186');" style=""> 795     public void onNotification(NotificationSpec notificationSpec) {                                      </span>
<span class="7210616345943040728" onmouseenter="enter('7210616345943040728');" onmouseout="out('7210616345943040728');" style=""> 796         for (int i = 0; i &lt; notificationSpec.attachedActions.size(); i++) {                              </span>
<span class="-1299099168286401629" onmouseenter="enter('-1299099168286401629');" onmouseout="out('-1299099168286401629');" style=""> 797             NotificationSpec.Action action = notificationSpec.attachedActions.get(i);                    </span>
<span class="2681239772598543261" onmouseenter="enter('2681239772598543261');" onmouseout="out('2681239772598543261');" style=""> 798             // wow. This should be easier!                                                               </span>
<span class="6910917973513768721" onmouseenter="enter('6910917973513768721');" onmouseout="out('6910917973513768721');" style=""> 799             if (action.type == NotificationSpec.Action.TYPE_WEARABLE_REPLY) {                            </span>
<span class="-720899283256773493" onmouseenter="enter('-720899283256773493');" onmouseout="out('-720899283256773493');" style=""><abbr title=" 800                 mNotificationReplyAction.add(notificationSpec.getId(), new Long(((((long) (notificationSpec.getId())) &lt;&lt; 4) + i) + 1));"> 800                 mNotificationReplyAction.add(notificationSpec.getId(), new Long(((((long) (notificationSpðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 803         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 804             JSONObject o = new JSONObject();                                                             </span>
<span class="-3237033879846899756" onmouseenter="enter('-3237033879846899756');" onmouseout="out('-3237033879846899756');" style=""> 805             o.put(&quot;t&quot;, &quot;notify&quot;);                                                                        </span>
<span class="-2996816801319654727" onmouseenter="enter('-2996816801319654727');" onmouseout="out('-2996816801319654727');" style=""> 806             o.put(&quot;id&quot;, notificationSpec.getId());                                                       </span>
<span class="7446549792523373865" onmouseenter="enter('7446549792523373865');" onmouseout="out('7446549792523373865');" style=""> 807             o.put(&quot;src&quot;, notificationSpec.sourceName);                                                   </span>
<span class="-2496842413615993216" onmouseenter="enter('-2496842413615993216');" onmouseout="out('-2496842413615993216');" style=""> 808             o.put(&quot;title&quot;, renderUnicodeAsImage(notificationSpec.title));                                </span>
<span class="8572918879739705875" onmouseenter="enter('8572918879739705875');" onmouseout="out('8572918879739705875');" style=""> 809             o.put(&quot;subject&quot;, renderUnicodeAsImage(notificationSpec.subject));                            </span>
<span class="-1911849092192349426" onmouseenter="enter('-1911849092192349426');" onmouseout="out('-1911849092192349426');" style=""> 810             o.put(&quot;body&quot;, renderUnicodeAsImage(notificationSpec.body));                                  </span>
<span class="-504952153198563265" onmouseenter="enter('-504952153198563265');" onmouseout="out('-504952153198563265');" style=""> 811             o.put(&quot;sender&quot;, renderUnicodeAsImage(notificationSpec.sender));                              </span>
<span class="-5726859549953031700" onmouseenter="enter('-5726859549953031700');" onmouseout="out('-5726859549953031700');" style=""> 812             o.put(&quot;tel&quot;, notificationSpec.phoneNumber);                                                  </span>
<span class="7885351870399476726" onmouseenter="enter('7885351870399476726');" onmouseout="out('7885351870399476726');" style=""> 813             uartTxJSON(&quot;onNotification&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 814         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 815             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 816         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817     }                                                                                                    </span>
<span  style=""> 818                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 819     @Override                                                                                            </span>
<span class="-1102873404195143085" onmouseenter="enter('-1102873404195143085');" onmouseout="out('-1102873404195143085');" style=""> 820     public void onDeleteNotification(int id) {                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 821         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 822             JSONObject o = new JSONObject();                                                             </span>
<span class="8475479069823885977" onmouseenter="enter('8475479069823885977');" onmouseout="out('8475479069823885977');" style=""> 823             o.put(&quot;t&quot;, &quot;notify-&quot;);                                                                       </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 824             o.put(&quot;id&quot;, id);                                                                             </span>
<span class="4156835990201809715" onmouseenter="enter('4156835990201809715');" onmouseout="out('4156835990201809715');" style=""> 825             uartTxJSON(&quot;onDeleteNotification&quot;, o);                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 826         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 827             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829     }                                                                                                    </span>
<span  style=""> 830                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 831     @Override                                                                                            </span>
<span class="7164248173527032001" onmouseenter="enter('7164248173527032001');" onmouseout="out('7164248173527032001');" style=""> 832     public void onSetTime() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 833         try {                                                                                            </span>
<span class="-5785975329698273515" onmouseenter="enter('-5785975329698273515');" onmouseout="out('-5785975329698273515');" style=""> 834             TransactionBuilder builder = performInitialized(&quot;setTime&quot;);                                  </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 835             transmitTime(builder);                                                                       </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 836             builder.queue(getQueue());                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 837         } catch (Exception e) {                                                                          </span>
<span class="5000424150373642922" onmouseenter="enter('5000424150373642922');" onmouseout="out('5000424150373642922');" style=""><abbr title=" 838             GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 838             GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840     }                                                                                                    </span>
<span  style=""> 841                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 842     @Override                                                                                            </span>
<span class="-6473317888357330260" onmouseenter="enter('-6473317888357330260');" onmouseout="out('-6473317888357330260');" style=""> 843     public void onSetAlarms(ArrayList&lt;? extends Alarm&gt; alarms) {                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 844         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 845             JSONObject o = new JSONObject();                                                             </span>
<span class="3488284827981638605" onmouseenter="enter('3488284827981638605');" onmouseout="out('3488284827981638605');" style=""> 846             o.put(&quot;t&quot;, &quot;alarm&quot;);                                                                         </span>
<span class="2586106610260987486" onmouseenter="enter('2586106610260987486');" onmouseout="out('2586106610260987486');" style=""> 847             JSONArray jsonalarms = new JSONArray();                                                      </span>
<span class="7012783305172244346" onmouseenter="enter('7012783305172244346');" onmouseout="out('7012783305172244346');" style=""> 848             o.put(&quot;d&quot;, jsonalarms);                                                                      </span>
<span  style=""> 849                                                                                                          </span>
<span class="-7996805109404385335" onmouseenter="enter('-7996805109404385335');" onmouseout="out('-7996805109404385335');" style=""> 850             for (Alarm alarm : alarms) {                                                                 </span>
<span class="-7206413691565762606" onmouseenter="enter('-7206413691565762606');" onmouseout="out('-7206413691565762606');" style=""> 851                 if (!alarm.getEnabled()) continue;                                                       </span>
<span class="1488433958727864154" onmouseenter="enter('1488433958727864154');" onmouseout="out('1488433958727864154');" style=""> 852                 JSONObject jsonalarm = new JSONObject();                                                 </span>
<span class="-2065505732499951357" onmouseenter="enter('-2065505732499951357');" onmouseout="out('-2065505732499951357');" style=""> 853                 jsonalarms.put(jsonalarm);                                                               </span>
<span  style=""> 854                                                                                                          </span>
<span class="169777398048646112" onmouseenter="enter('169777398048646112');" onmouseout="out('169777398048646112');" style=""> 855                 Calendar calendar = AlarmUtils.toCalendar(alarm);                                        </span>
<span  style=""> 856                                                                                                          </span>
<span class="6578593229745866209" onmouseenter="enter('6578593229745866209');" onmouseout="out('6578593229745866209');" style=""> 857                 jsonalarm.put(&quot;h&quot;, alarm.getHour());                                                     </span>
<span class="7461878622333576123" onmouseenter="enter('7461878622333576123');" onmouseout="out('7461878622333576123');" style=""> 858                 jsonalarm.put(&quot;m&quot;, alarm.getMinute());                                                   </span>
<span class="97057399767477313" onmouseenter="enter('97057399767477313');" onmouseout="out('97057399767477313');" style=""> 859                 jsonalarm.put(&quot;rep&quot;, alarm.getRepetition());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 860             }                                                                                            </span>
<span class="7288963480750843606" onmouseenter="enter('7288963480750843606');" onmouseout="out('7288963480750843606');" style=""> 861             uartTxJSON(&quot;onSetAlarms&quot;, o);                                                                </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 862         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 863             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 865     }                                                                                                    </span>
<span  style=""> 866                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 867     @Override                                                                                            </span>
<span class="8502851833159229707" onmouseenter="enter('8502851833159229707');" onmouseout="out('8502851833159229707');" style=""> 868     public void onSetCallState(CallSpec callSpec) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 869         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 870             JSONObject o = new JSONObject();                                                             </span>
<span class="4158854171585038558" onmouseenter="enter('4158854171585038558');" onmouseout="out('4158854171585038558');" style=""> 871             o.put(&quot;t&quot;, &quot;call&quot;);                                                                          </span>
<span class="3958892663366704764" onmouseenter="enter('3958892663366704764');" onmouseout="out('3958892663366704764');" style=""> 872             String cmdName = &quot;&quot;;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 873             try {                                                                                        </span>
<span class="-9009466648790586927" onmouseenter="enter('-9009466648790586927');" onmouseout="out('-9009466648790586927');" style=""> 874                 Field fields[] = callSpec.getClass().getDeclaredFields();                                </span>
<span class="-8522204470221494922" onmouseenter="enter('-8522204470221494922');" onmouseout="out('-8522204470221494922');" style=""> 875                 for (Field field : fields)                                                               </span>
<span class="-7797368603385788624" onmouseenter="enter('-7797368603385788624');" onmouseout="out('-7797368603385788624');" style=""><abbr title=" 876                     if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.command)"> 876                     if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.commandðŸ”µ</abbr></span>
<span class="8043037183581644681" onmouseenter="enter('8043037183581644681');" onmouseout="out('8043037183581644681');" style=""> 877                         cmdName = field.getName().substring(5).toLowerCase();                            </span>
<span class="-7581013626583319085" onmouseenter="enter('-7581013626583319085');" onmouseout="out('-7581013626583319085');" style=""> 878             } catch (IllegalAccessException e) {}                                                        </span>
<span class="-1085015235935761185" onmouseenter="enter('-1085015235935761185');" onmouseout="out('-1085015235935761185');" style=""> 879             o.put(&quot;cmd&quot;, cmdName);                                                                       </span>
<span class="8637280962137247636" onmouseenter="enter('8637280962137247636');" onmouseout="out('8637280962137247636');" style=""> 880             o.put(&quot;name&quot;, renderUnicodeAsImage(callSpec.name));                                          </span>
<span class="673690437593128793" onmouseenter="enter('673690437593128793');" onmouseout="out('673690437593128793');" style=""> 881             o.put(&quot;number&quot;, callSpec.number);                                                            </span>
<span class="-6546279892320681741" onmouseenter="enter('-6546279892320681741');" onmouseout="out('-6546279892320681741');" style=""> 882             uartTxJSON(&quot;onSetCallState&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 883         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 884             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 885         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886     }                                                                                                    </span>
<span  style=""> 887                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 888     @Override                                                                                            </span>
<span class="8238257195410140286" onmouseenter="enter('8238257195410140286');" onmouseout="out('8238257195410140286');" style=""> 889     public void onSetCannedMessages(CannedMessagesSpec cannedMessagesSpec) {                             </span>
<span  style=""> 890                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 891     }                                                                                                    </span>
<span  style=""> 892                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 893     @Override                                                                                            </span>
<span class="8228188929931998548" onmouseenter="enter('8228188929931998548');" onmouseout="out('8228188929931998548');" style=""> 894     public void onSetMusicState(MusicStateSpec stateSpec) {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 895         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 896             JSONObject o = new JSONObject();                                                             </span>
<span class="-92554745071265211" onmouseenter="enter('-92554745071265211');" onmouseout="out('-92554745071265211');" style=""> 897             o.put(&quot;t&quot;, &quot;musicstate&quot;);                                                                    </span>
<span class="8807632241012571777" onmouseenter="enter('8807632241012571777');" onmouseout="out('8807632241012571777');" style=""> 898             int musicState = stateSpec.state;                                                            </span>
<span class="-8234435338877590300" onmouseenter="enter('-8234435338877590300');" onmouseout="out('-8234435338877590300');" style=""> 899             String[] musicStates = {&quot;play&quot;, &quot;pause&quot;, &quot;stop&quot;, &quot;&quot;};                                        </span>
<span class="-9088398443169884235" onmouseenter="enter('-9088398443169884235');" onmouseout="out('-9088398443169884235');" style=""> 900             if (musicState&lt;0) musicState=3;                                                              </span>
<span class="2321591687835617567" onmouseenter="enter('2321591687835617567');" onmouseout="out('2321591687835617567');" style=""> 901             if (musicState&gt;=musicStates.length) musicState = musicStates.length-1;                       </span>
<span class="-1010325962977709940" onmouseenter="enter('-1010325962977709940');" onmouseout="out('-1010325962977709940');" style=""> 902             o.put(&quot;state&quot;, musicStates[musicState]);                                                     </span>
<span class="4362989328077723220" onmouseenter="enter('4362989328077723220');" onmouseout="out('4362989328077723220');" style=""> 903             o.put(&quot;position&quot;, stateSpec.position);                                                       </span>
<span class="-521013622091952719" onmouseenter="enter('-521013622091952719');" onmouseout="out('-521013622091952719');" style=""> 904             o.put(&quot;shuffle&quot;, stateSpec.shuffle);                                                         </span>
<span class="7992510141527813217" onmouseenter="enter('7992510141527813217');" onmouseout="out('7992510141527813217');" style=""> 905             o.put(&quot;repeat&quot;, stateSpec.repeat);                                                           </span>
<span class="-8798301955703322193" onmouseenter="enter('-8798301955703322193');" onmouseout="out('-8798301955703322193');" style=""> 906             uartTxJSON(&quot;onSetMusicState&quot;, o);                                                            </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 907         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 908             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 909         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 910     }                                                                                                    </span>
<span  style=""> 911                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 912     @Override                                                                                            </span>
<span class="-4182706906721092498" onmouseenter="enter('-4182706906721092498');" onmouseout="out('-4182706906721092498');" style=""> 913     public void onSetMusicInfo(MusicSpec musicSpec) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 914         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 915             JSONObject o = new JSONObject();                                                             </span>
<span class="-21742499724689403" onmouseenter="enter('-21742499724689403');" onmouseout="out('-21742499724689403');" style=""> 916             o.put(&quot;t&quot;, &quot;musicinfo&quot;);                                                                     </span>
<span class="-7907833892429297395" onmouseenter="enter('-7907833892429297395');" onmouseout="out('-7907833892429297395');" style=""> 917             o.put(&quot;artist&quot;, renderUnicodeAsImage(musicSpec.artist));                                     </span>
<span class="6485281684850333943" onmouseenter="enter('6485281684850333943');" onmouseout="out('6485281684850333943');" style=""> 918             o.put(&quot;album&quot;, renderUnicodeAsImage(musicSpec.album));                                       </span>
<span class="6434659518035718811" onmouseenter="enter('6434659518035718811');" onmouseout="out('6434659518035718811');" style=""> 919             o.put(&quot;track&quot;, renderUnicodeAsImage(musicSpec.track));                                       </span>
<span class="-6589694811644482139" onmouseenter="enter('-6589694811644482139');" onmouseout="out('-6589694811644482139');" style=""> 920             o.put(&quot;dur&quot;, musicSpec.duration);                                                            </span>
<span class="-5969522677742802968" onmouseenter="enter('-5969522677742802968');" onmouseout="out('-5969522677742802968');" style=""> 921             o.put(&quot;c&quot;, musicSpec.trackCount);                                                            </span>
<span class="7704969334649219354" onmouseenter="enter('7704969334649219354');" onmouseout="out('7704969334649219354');" style=""> 922             o.put(&quot;n&quot;, musicSpec.trackNr);                                                               </span>
<span class="-567994157751048073" onmouseenter="enter('-567994157751048073');" onmouseout="out('-567994157751048073');" style=""> 923             uartTxJSON(&quot;onSetMusicInfo&quot;, o);                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 924         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 925             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 927     }                                                                                                    </span>
<span  style=""> 928                                                                                                          </span>
<span class="1808047972614051455" onmouseenter="enter('1808047972614051455');" onmouseout="out('1808047972614051455');" style=""> 929     private void transmitActivityStatus() {                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 930         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 931             JSONObject o = new JSONObject();                                                             </span>
<span class="-8158526622976442101" onmouseenter="enter('-8158526622976442101');" onmouseout="out('-8158526622976442101');" style=""> 932             o.put(&quot;t&quot;, &quot;act&quot;);                                                                           </span>
<span class="5593394621505017212" onmouseenter="enter('5593394621505017212');" onmouseout="out('5593394621505017212');" style=""> 933             o.put(&quot;hrm&quot;, realtimeHRM);                                                                   </span>
<span class="9069762361832051811" onmouseenter="enter('9069762361832051811');" onmouseout="out('9069762361832051811');" style=""> 934             o.put(&quot;stp&quot;, realtimeStep);                                                                  </span>
<span class="4361099818971426695" onmouseenter="enter('4361099818971426695');" onmouseout="out('4361099818971426695');" style=""> 935             o.put(&quot;int&quot;, realtimeHRMInterval);                                                           </span>
<span class="-8731247564001223528" onmouseenter="enter('-8731247564001223528');" onmouseout="out('-8731247564001223528');" style=""> 936             uartTxJSON(&quot;onEnableRealtimeSteps&quot;, o);                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 937         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 938             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 940     }                                                                                                    </span>
<span  style=""> 941                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 942     @Override                                                                                            </span>
<span class="-8425797677863799500" onmouseenter="enter('-8425797677863799500');" onmouseout="out('-8425797677863799500');" style=""> 943     public void onEnableRealtimeSteps(boolean enable) {                                                  </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 944         if (enable == realtimeHRM) return;                                                               </span>
<span class="-5879371575258185595" onmouseenter="enter('-5879371575258185595');" onmouseout="out('-5879371575258185595');" style=""> 945         realtimeStep = enable;                                                                           </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 946         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947     }                                                                                                    </span>
<span  style=""> 948                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 949     @Override                                                                                            </span>
<span class="-4135655620136168708" onmouseenter="enter('-4135655620136168708');" onmouseout="out('-4135655620136168708');" style=""> 950     public void onInstallApp(Uri uri) {                                                                  </span>
<span  style=""> 951                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 952     }                                                                                                    </span>
<span  style=""> 953                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 954     @Override                                                                                            </span>
<span class="-3322711972275217450" onmouseenter="enter('-3322711972275217450');" onmouseout="out('-3322711972275217450');" style=""> 955     public void onAppInfoReq() {                                                                         </span>
<span  style=""> 956                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 957     }                                                                                                    </span>
<span  style=""> 958                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 959     @Override                                                                                            </span>
<span class="1692097554900603024" onmouseenter="enter('1692097554900603024');" onmouseout="out('1692097554900603024');" style=""> 960     public void onAppStart(UUID uuid, boolean start) {                                                   </span>
<span  style=""> 961                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962     }                                                                                                    </span>
<span  style=""> 963                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 964     @Override                                                                                            </span>
<span class="7633110766708892729" onmouseenter="enter('7633110766708892729');" onmouseout="out('7633110766708892729');" style=""> 965     public void onAppDelete(UUID uuid) {                                                                 </span>
<span  style=""> 966                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 967     }                                                                                                    </span>
<span  style=""> 968                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 969     @Override                                                                                            </span>
<span class="2176182926116218619" onmouseenter="enter('2176182926116218619');" onmouseout="out('2176182926116218619');" style=""> 970     public void onAppConfiguration(UUID appUuid, String config, Integer id) {                            </span>
<span  style=""> 971                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972     }                                                                                                    </span>
<span  style=""> 973                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 974     @Override                                                                                            </span>
<span class="-2513514137107402976" onmouseenter="enter('-2513514137107402976');" onmouseout="out('-2513514137107402976');" style=""> 975     public void onAppReorder(UUID[] uuids) {                                                             </span>
<span  style=""> 976                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 977     }                                                                                                    </span>
<span  style=""> 978                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 979     @Override                                                                                            </span>
<span class="3881968248613188942" onmouseenter="enter('3881968248613188942');" onmouseout="out('3881968248613188942');" style=""> 980     public void onFetchRecordedData(int dataTypes) {                                                     </span>
<span class="-3849076454550892314" onmouseenter="enter('-3849076454550892314');" onmouseout="out('-3849076454550892314');" style=""> 981         if (dataTypes == RecordedDataTypes.TYPE_DEBUGLOGS) {                                             </span>
<span class="1579212162814293327" onmouseenter="enter('1579212162814293327');" onmouseout="out('1579212162814293327');" style=""> 982             File dir;                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 983             try {                                                                                        </span>
<span class="-3526927992489947407" onmouseenter="enter('-3526927992489947407');" onmouseout="out('-3526927992489947407');" style=""> 984                 dir = FileUtils.getExternalFilesDir();                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 985             } catch (IOException e) {                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 986                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 987             }                                                                                            </span>
<span class="-8623321881845197728" onmouseenter="enter('-8623321881845197728');" onmouseout="out('-8623321881845197728');" style=""> 988             SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd-HHmmss&quot;, Locale.US);            </span>
<span class="-5624783356718448695" onmouseenter="enter('-5624783356718448695');" onmouseout="out('-5624783356718448695');" style=""> 989             String filename = (&quot;banglejs_debug_&quot; + dateFormat.format(new Date())) + &quot;.log&quot;;              </span>
<span class="7993016116168812941" onmouseenter="enter('7993016116168812941');" onmouseout="out('7993016116168812941');" style=""> 990             File outputFile = new File(dir, filename);                                                   </span>
<span class="-8137261290332422753" onmouseenter="enter('-8137261290332422753');" onmouseout="out('-8137261290332422753');" style=""> 991             LOG.warn(&quot;Writing log to &quot; + outputFile.toString());                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 992             try {                                                                                        </span>
<span class="-8771066680414961708" onmouseenter="enter('-8771066680414961708');" onmouseout="out('-8771066680414961708');" style=""> 993                 BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile));                  </span>
<span class="4633875208200868523" onmouseenter="enter('4633875208200868523');" onmouseout="out('4633875208200868523');" style=""> 994                 writer.write(receiveHistory);                                                            </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style=""> 995                 writer.close();                                                                          </span>
<span class="-3019360337557251714" onmouseenter="enter('-3019360337557251714');" onmouseout="out('-3019360337557251714');" style=""> 996                 receiveHistory = &quot;&quot;;                                                                     </span>
<span class="7175282780053110768" onmouseenter="enter('7175282780053110768');" onmouseout="out('7175282780053110768');" style=""> 997                 GB.toast(getContext(), &quot;Log written to &quot; + filename, Toast.LENGTH_LONG, GB.INFO);        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 998             } catch (IOException e) {                                                                    </span>
<span class="4694495530853371438" onmouseenter="enter('4694495530853371438');" onmouseout="out('4694495530853371438');" style=""> 999                 LOG.warn(&quot;Could not write to file&quot;, e);                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">1000                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1001             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1002         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1003     }                                                                                                    </span>
<span  style="">1004                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1005     @Override                                                                                            </span>
<span class="3589048831688325527" onmouseenter="enter('3589048831688325527');" onmouseout="out('3589048831688325527');" style="">1006     public void onReset(int flags) {                                                                     </span>
<span  style="">1007                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1008     }                                                                                                    </span>
<span  style="">1009                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1010     @Override                                                                                            </span>
<span class="-9008385526233139735" onmouseenter="enter('-9008385526233139735');" onmouseout="out('-9008385526233139735');" style="">1011     public void onHeartRateTest() {                                                                      </span>
<span  style="">1012                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1013     }                                                                                                    </span>
<span  style="">1014                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1015     @Override                                                                                            </span>
<span class="2383065190612615413" onmouseenter="enter('2383065190612615413');" onmouseout="out('2383065190612615413');" style="">1016     public void onEnableRealtimeHeartRateMeasurement(boolean enable) {                                   </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style="">1017         if (enable == realtimeHRM) return;                                                               </span>
<span class="8804907312000263363" onmouseenter="enter('8804907312000263363');" onmouseout="out('8804907312000263363');" style="">1018         realtimeHRM = enable;                                                                            </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style="">1019         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1020     }                                                                                                    </span>
<span  style="">1021                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1022     @Override                                                                                            </span>
<span class="-3287587973518064190" onmouseenter="enter('-3287587973518064190');" onmouseout="out('-3287587973518064190');" style="">1023     public void onFindDevice(boolean start) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1024         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style="">1025             JSONObject o = new JSONObject();                                                             </span>
<span class="4130381404080081417" onmouseenter="enter('4130381404080081417');" onmouseout="out('4130381404080081417');" style="">1026             o.put(&quot;t&quot;, &quot;find&quot;);                                                                          </span>
<span class="6818313613707459779" onmouseenter="enter('6818313613707459779');" onmouseout="out('6818313613707459779');" style="">1027             o.put(&quot;n&quot;, start);                                                                           </span>
<span class="5958886073956724015" onmouseenter="enter('5958886073956724015');" onmouseout="out('5958886073956724015');" style="">1028             uartTxJSON(&quot;onFindDevice&quot;, o);                                                               </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style="">1029         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style="">1030             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1031         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1032     }                                                                                                    </span>
<span  style="">1033                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1034     @Override                                                                                            </span>
<span class="-1926054327985162362" onmouseenter="enter('-1926054327985162362');" onmouseout="out('-1926054327985162362');" style="">1035     public void onSetConstantVibration(int integer) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1036         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style="">1037             JSONObject o = new JSONObject();                                                             </span>
<span class="4547736712460874928" onmouseenter="enter('4547736712460874928');" onmouseout="out('4547736712460874928');" style="">1038             o.put(&quot;t&quot;, &quot;vibrate&quot;);                                                                       </span>
<span class="-4243820256325497798" onmouseenter="enter('-4243820256325497798');" onmouseout="out('-4243820256325497798');" style="">1039             o.put(&quot;n&quot;, integer);                                                                         </span>
<span class="-1000088439791572503" onmouseenter="enter('-1000088439791572503');" onmouseout="out('-1000088439791572503');" style="">1040             uartTxJSON(&quot;onSetConstantVibration&quot;, o);                                                     </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style="">1041         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style="">1042             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1043         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1044     }                                                                                                    </span>
<span  style="">1045                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1046     @Override                                                                                            </span>
<span class="-3293819866797459784" onmouseenter="enter('-3293819866797459784');" onmouseout="out('-3293819866797459784');" style="">1047     public void onScreenshotReq() {                                                                      </span>
<span  style="">1048                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1049     }                                                                                                    </span>
<span  style="">1050                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1051     @Override                                                                                            </span>
<span class="-2597044235576493624" onmouseenter="enter('-2597044235576493624');" onmouseout="out('-2597044235576493624');" style="">1052     public void onEnableHeartRateSleepSupport(boolean enable) {                                          </span>
<span  style="">1053                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1054     }                                                                                                    </span>
<span  style="">1055                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1056     @Override                                                                                            </span>
<span class="-5895120009761092080" onmouseenter="enter('-5895120009761092080');" onmouseout="out('-5895120009761092080');" style="">1057     public void onSetHeartRateMeasurementInterval(int seconds) {                                         </span>
<span class="-1003654780605811203" onmouseenter="enter('-1003654780605811203');" onmouseout="out('-1003654780605811203');" style="">1058         realtimeHRMInterval = seconds;                                                                   </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style="">1059         transmitActivityStatus();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1060     }                                                                                                    </span>
<span  style="">1061                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1062     @Override                                                                                            </span>
<span class="-7200644583722212481" onmouseenter="enter('-7200644583722212481');" onmouseout="out('-7200644583722212481');" style="">1063     public void onAddCalendarEvent(CalendarEventSpec calendarEventSpec) {                                </span>
<span  style="">1064                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1065     }                                                                                                    </span>
<span  style="">1066                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1067     @Override                                                                                            </span>
<span class="2890386202777848228" onmouseenter="enter('2890386202777848228');" onmouseout="out('2890386202777848228');" style="">1068     public void onDeleteCalendarEvent(byte type, long id) {                                              </span>
<span  style="">1069                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1070     }                                                                                                    </span>
<span  style="">1071                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1072     @Override                                                                                            </span>
<span class="349159621018699769" onmouseenter="enter('349159621018699769');" onmouseout="out('349159621018699769');" style="">1073     public void onSendConfiguration(String config) {                                                     </span>
<span  style="">1074                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1075     }                                                                                                    </span>
<span  style="">1076                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1077     @Override                                                                                            </span>
<span class="8707097463436604513" onmouseenter="enter('8707097463436604513');" onmouseout="out('8707097463436604513');" style="">1078     public void onReadConfiguration(String config) {                                                     </span>
<span  style="">1079                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1080     }                                                                                                    </span>
<span  style="">1081                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1082     @Override                                                                                            </span>
<span class="-1180224994468071186" onmouseenter="enter('-1180224994468071186');" onmouseout="out('-1180224994468071186');" style="">1083     public void onTestNewFunction() {                                                                    </span>
<span  style="">1084                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1085     }                                                                                                    </span>
<span  style="">1086                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1087     @Override                                                                                            </span>
<span class="-6167041048283935417" onmouseenter="enter('-6167041048283935417');" onmouseout="out('-6167041048283935417');" style="">1088     public void onSendWeather(WeatherSpec weatherSpec) {                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1089         try {                                                                                            </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style="">1090             JSONObject o = new JSONObject();                                                             </span>
<span class="501109951395943657" onmouseenter="enter('501109951395943657');" onmouseout="out('501109951395943657');" style="">1091             o.put(&quot;t&quot;, &quot;weather&quot;);                                                                       </span>
<span class="4560755441777004113" onmouseenter="enter('4560755441777004113');" onmouseout="out('4560755441777004113');" style="">1092             o.put(&quot;temp&quot;, weatherSpec.currentTemp);                                                      </span>
<span class="7333169967933356383" onmouseenter="enter('7333169967933356383');" onmouseout="out('7333169967933356383');" style="">1093             o.put(&quot;hum&quot;, weatherSpec.currentHumidity);                                                   </span>
<span class="1899511800679765497" onmouseenter="enter('1899511800679765497');" onmouseout="out('1899511800679765497');" style="">1094             o.put(&quot;code&quot;, weatherSpec.currentConditionCode);                                             </span>
<span class="-4150178137906864023" onmouseenter="enter('-4150178137906864023');" onmouseout="out('-4150178137906864023');" style="">1095             o.put(&quot;txt&quot;, weatherSpec.currentCondition);                                                  </span>
<span class="2529521996043109426" onmouseenter="enter('2529521996043109426');" onmouseout="out('2529521996043109426');" style="">1096             o.put(&quot;wind&quot;, weatherSpec.windSpeed);                                                        </span>
<span class="-3531204280741737459" onmouseenter="enter('-3531204280741737459');" onmouseout="out('-3531204280741737459');" style="">1097             o.put(&quot;wdir&quot;, weatherSpec.windDirection);                                                    </span>
<span class="-5203705012940108393" onmouseenter="enter('-5203705012940108393');" onmouseout="out('-5203705012940108393');" style="">1098             o.put(&quot;loc&quot;, weatherSpec.location);                                                          </span>
<span class="-7123085564208723174" onmouseenter="enter('-7123085564208723174');" onmouseout="out('-7123085564208723174');" style="">1099             uartTxJSON(&quot;onSendWeather&quot;, o);                                                              </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style="">1100         } catch (JSONException e) {                                                                      </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style="">1101             LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1103     }                                                                                                    </span>
<span  style="">1104                                                                                                          </span>
<span class="-2877595281257014330" onmouseenter="enter('-2877595281257014330');" onmouseout="out('-2877595281257014330');" style="">1105     public Bitmap textToBitmap(String text) {                                                            </span>
<span class="8197355036703912915" onmouseenter="enter('8197355036703912915');" onmouseout="out('8197355036703912915');" style="">1106         Paint paint = new Paint(0); // Paint.ANTI_ALIAS_FLAG not wanted as 1bpp                          </span>
<span class="7051721925152008019" onmouseenter="enter('7051721925152008019');" onmouseout="out('7051721925152008019');" style="">1107         paint.setTextSize(18);                                                                           </span>
<span class="3201120031631468052" onmouseenter="enter('3201120031631468052');" onmouseout="out('3201120031631468052');" style="">1108         paint.setColor(0xFFFFFFFF);                                                                      </span>
<span class="-8656814648822962149" onmouseenter="enter('-8656814648822962149');" onmouseout="out('-8656814648822962149');" style="">1109         paint.setTextAlign(Paint.Align.LEFT);                                                            </span>
<span class="-7872377864782888483" onmouseenter="enter('-7872377864782888483');" onmouseout="out('-7872377864782888483');" style="">1110         float baseline = -paint.ascent(); // ascent() is negative                                        </span>
<span class="-8465374828216379200" onmouseenter="enter('-8465374828216379200');" onmouseout="out('-8465374828216379200');" style="">1111         int width = (int) (paint.measureText(text) + 0.5f); // round                                     </span>
<span class="-3854390456573697081" onmouseenter="enter('-3854390456573697081');" onmouseout="out('-3854390456573697081');" style="">1112         int height = (int) (baseline + paint.descent() + 0.5f);                                          </span>
<span class="2906210495000084590" onmouseenter="enter('2906210495000084590');" onmouseout="out('2906210495000084590');" style="">1113         Bitmap image = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);                      </span>
<span class="-8679273566707466475" onmouseenter="enter('-8679273566707466475');" onmouseout="out('-8679273566707466475');" style="">1114         Canvas canvas = new Canvas(image);                                                               </span>
<span class="-1111517440201709382" onmouseenter="enter('-1111517440201709382');" onmouseout="out('-1111517440201709382');" style="">1115         canvas.drawText(text, 0, baseline, paint);                                                       </span>
<span class="-2663644744327296233" onmouseenter="enter('-2663644744327296233');" onmouseout="out('-2663644744327296233');" style="">1116         return image;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1117     }                                                                                                    </span>
<span  style="">1118                                                                                                          </span>
<span class="7074963208724431146" onmouseenter="enter('7074963208724431146');" onmouseout="out('7074963208724431146');" style="">1119     public enum BangleJSBitmapStyle {                                                                    </span>
<span  style="">1120                                                                                                          </span>
<span class="6147896096185822433" onmouseenter="enter('6147896096185822433');" onmouseout="out('6147896096185822433');" style="">1121         MONOCHROME,                                                                                      </span>
<span class="8041706669606219396" onmouseenter="enter('8041706669606219396');" onmouseout="out('8041706669606219396');" style="">1122         RGB_3BPP;}                                                                                       </span>
<span  style="">1123                                                                                                          </span>
<span class="6301558466408951369" onmouseenter="enter('6301558466408951369');" onmouseout="out('6301558466408951369');" style="">1124     /** Used for writing single bits to an array */                                                      </span>
<span class="819222803118860573" onmouseenter="enter('819222803118860573');" onmouseout="out('819222803118860573');" style="">1125     public static class BitWriter {                                                                      </span>
<span class="114498312668931576" onmouseenter="enter('114498312668931576');" onmouseout="out('114498312668931576');" style="">1126         int n;                                                                                           </span>
<span  style="">1127                                                                                                          </span>
<span class="2627896913916265726" onmouseenter="enter('2627896913916265726');" onmouseout="out('2627896913916265726');" style="">1128         byte[] bits;                                                                                     </span>
<span  style="">1129                                                                                                          </span>
<span class="2223332225252801045" onmouseenter="enter('2223332225252801045');" onmouseout="out('2223332225252801045');" style="">1130         int currentByte;                                                                                 </span>
<span  style="">1131                                                                                                          </span>
<span class="7706654433699569414" onmouseenter="enter('7706654433699569414');" onmouseout="out('7706654433699569414');" style="">1132         int bitIdx;                                                                                      </span>
<span  style="">1133                                                                                                          </span>
<span class="4387590414863300883" onmouseenter="enter('4387590414863300883');" onmouseout="out('4387590414863300883');" style="">1134         public BitWriter(byte[] array, int offset) {                                                     </span>
<span class="-2669551821059816380" onmouseenter="enter('-2669551821059816380');" onmouseout="out('-2669551821059816380');" style="">1135             bits = array;                                                                                </span>
<span class="8043804227758168612" onmouseenter="enter('8043804227758168612');" onmouseout="out('8043804227758168612');" style="">1136             n = offset;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1137         }                                                                                                </span>
<span  style="">1138                                                                                                          </span>
<span class="3787308675999271388" onmouseenter="enter('3787308675999271388');" onmouseout="out('3787308675999271388');" style="">1139         public void push(boolean v) {                                                                    </span>
<span class="5216704317815857972" onmouseenter="enter('5216704317815857972');" onmouseout="out('5216704317815857972');" style="">1140             currentByte = (currentByte &lt;&lt; 1) | (v ? 1 : 0);                                              </span>
<span class="-9185751609333789697" onmouseenter="enter('-9185751609333789697');" onmouseout="out('-9185751609333789697');" style="">1141             bitIdx++;                                                                                    </span>
<span class="-4190492491002713547" onmouseenter="enter('-4190492491002713547');" onmouseout="out('-4190492491002713547');" style="">1142             if (bitIdx == 8) {                                                                           </span>
<span class="-5585532229895791295" onmouseenter="enter('-5585532229895791295');" onmouseout="out('-5585532229895791295');" style="">1143                 bits[n++] = ((byte) (currentByte));                                                      </span>
<span class="7441701714119310800" onmouseenter="enter('7441701714119310800');" onmouseout="out('7441701714119310800');" style="">1144                 bitIdx = 0;                                                                              </span>
<span class="-6334189767708640910" onmouseenter="enter('-6334189767708640910');" onmouseout="out('-6334189767708640910');" style="">1145                 currentByte = 0;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1146             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1147         }                                                                                                </span>
<span  style="">1148                                                                                                          </span>
<span class="-6819029797264174065" onmouseenter="enter('-6819029797264174065');" onmouseout="out('-6819029797264174065');" style="">1149         public void finish() {                                                                           </span>
<span class="-2718513213508325030" onmouseenter="enter('-2718513213508325030');" onmouseout="out('-2718513213508325030');" style="">1150             if (bitIdx &gt; 0) {                                                                            </span>
<span class="-5585532229895791295" onmouseenter="enter('-5585532229895791295');" onmouseout="out('-5585532229895791295');" style="">1151                 bits[n++] = ((byte) (currentByte));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1152             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1153         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1154     }                                                                                                    </span>
<span  style="">1155                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1156     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1157      * Currently only 1bpp, no scaling */                                                                </span>
<span class="7395401196912084921" onmouseenter="enter('7395401196912084921');" onmouseout="out('7395401196912084921');" style="">1158     public static byte[] bitmapToEspruinoArray(Bitmap bitmap, BangleJSBitmapStyle style) {               </span>
<span class="-8264578209241474849" onmouseenter="enter('-8264578209241474849');" onmouseout="out('-8264578209241474849');" style="">1159         int width = bitmap.getWidth();                                                                   </span>
<span class="579214017182008882" onmouseenter="enter('579214017182008882');" onmouseout="out('579214017182008882');" style="">1160         int height = bitmap.getHeight();                                                                 </span>
<span class="-4084861302694118597" onmouseenter="enter('-4084861302694118597');" onmouseout="out('-4084861302694118597');" style="">1161         int bpp = (style == BangleJSBitmapStyle.RGB_3BPP) ? 3 : 1;                                       </span>
<span class="1294080984429799558" onmouseenter="enter('1294080984429799558');" onmouseout="out('1294080984429799558');" style="">1162         byte[] pixels = new byte[width * height];                                                        </span>
<span class="-8781894220114795181" onmouseenter="enter('-8781894220114795181');" onmouseout="out('-8781894220114795181');" style="">1163         final byte PIXELCOL_TRANSPARENT = -1;                                                            </span>
<span class="-2189550786346663312" onmouseenter="enter('-2189550786346663312');" onmouseout="out('-2189550786346663312');" style="">1164         // for bayer dithering                                                                           </span>
<span class="7788652634978124707" onmouseenter="enter('7788652634978124707');" onmouseout="out('7788652634978124707');" style="">1165         final int[] ditherMatrix = new int[]{ 1 * 16, 5 * 16, 7 * 16, 3 * 16 };                          </span>
<span class="7959981185777845703" onmouseenter="enter('7959981185777845703');" onmouseout="out('7959981185777845703');" style="">1166         // if doing 3bpp, check image to see if it&#x27;s transparent                                         </span>
<span class="7555252492765405443" onmouseenter="enter('7555252492765405443');" onmouseout="out('7555252492765405443');" style="">1167         boolean allowTransparency = style != BangleJSBitmapStyle.MONOCHROME;                             </span>
<span class="-37573379981503148" onmouseenter="enter('-37573379981503148');" onmouseout="out('-37573379981503148');" style="">1168         boolean isTransparent = false;                                                                   </span>
<span class="7994078972417264550" onmouseenter="enter('7994078972417264550');" onmouseout="out('7994078972417264550');" style="">1169         byte transparentColorIndex = 0;                                                                  </span>
<span class="4545384496906809483" onmouseenter="enter('4545384496906809483');" onmouseout="out('4545384496906809483');" style="">1170         /* Work out what colour index each pixel should be and write to pixels.                          </span>
<span class="-816286840416722331" onmouseenter="enter('-816286840416722331');" onmouseout="out('-816286840416722331');" style="">1171          Also figure out if we&#x27;re transparent at all, and how often each color is used */                </span>
<span class="-9194181315819606730" onmouseenter="enter('-9194181315819606730');" onmouseout="out('-9194181315819606730');" style="">1172         int[] colUsage = new int[8];                                                                     </span>
<span class="-1168375646381031328" onmouseenter="enter('-1168375646381031328');" onmouseout="out('-1168375646381031328');" style="">1173         int n = 0;                                                                                       </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1174         for (int y = 0; y &lt; height; y++) {                                                               </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1175             for (int x = 0; x &lt; width; x++) {                                                            </span>
<span class="-2101137108834168285" onmouseenter="enter('-2101137108834168285');" onmouseout="out('-2101137108834168285');" style="">1176                 int pixel = bitmap.getPixel(x, y);                                                       </span>
<span class="-7873265173430592100" onmouseenter="enter('-7873265173430592100');" onmouseout="out('-7873265173430592100');" style="">1177                 int r = pixel &amp; 255;                                                                     </span>
<span class="5214305336064064060" onmouseenter="enter('5214305336064064060');" onmouseout="out('5214305336064064060');" style="">1178                 int g = (pixel &gt;&gt; 8) &amp; 255;                                                              </span>
<span class="-8611762025314058231" onmouseenter="enter('-8611762025314058231');" onmouseout="out('-8611762025314058231');" style="">1179                 int b = (pixel &gt;&gt; 16) &amp; 255;                                                             </span>
<span class="4540615999107180416" onmouseenter="enter('4540615999107180416');" onmouseout="out('4540615999107180416');" style="">1180                 int a = (pixel &gt;&gt; 24) &amp; 255;                                                             </span>
<span class="-7690440557473777446" onmouseenter="enter('-7690440557473777446');" onmouseout="out('-7690440557473777446');" style="">1181                 boolean pixelTransparent = allowTransparency &amp;&amp; (a &lt; 128);                               </span>
<span class="8857737978256656560" onmouseenter="enter('8857737978256656560');" onmouseout="out('8857737978256656560');" style="">1182                 if (pixelTransparent) {                                                                  </span>
<span class="4144053758920166277" onmouseenter="enter('4144053758920166277');" onmouseout="out('4144053758920166277');" style="">1183                     isTransparent = true;                                                                </span>
<span class="-1483564027931343691" onmouseenter="enter('-1483564027931343691');" onmouseout="out('-1483564027931343691');" style="">1184                     r = g = b = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1185                 }                                                                                        </span>
<span class="7892385962647882401" onmouseenter="enter('7892385962647882401');" onmouseout="out('7892385962647882401');" style="">1186                 // do dithering here                                                                     </span>
<span class="165670811009254178" onmouseenter="enter('165670811009254178');" onmouseout="out('165670811009254178');" style="">1187                 int ditherAmt = ditherMatrix[(x &amp; 1) + ((y &amp; 1) * 2)];                                   </span>
<span class="-5333286516522955764" onmouseenter="enter('-5333286516522955764');" onmouseout="out('-5333286516522955764');" style="">1188                 r += ditherAmt;                                                                          </span>
<span class="-3777395832470098990" onmouseenter="enter('-3777395832470098990');" onmouseout="out('-3777395832470098990');" style="">1189                 g += ditherAmt;                                                                          </span>
<span class="-5891859440152819561" onmouseenter="enter('-5891859440152819561');" onmouseout="out('-5891859440152819561');" style="">1190                 b += ditherAmt;                                                                          </span>
<span class="1554400584909279790" onmouseenter="enter('1554400584909279790');" onmouseout="out('1554400584909279790');" style="">1191                 int col = 0;                                                                             </span>
<span class="425403785452241366" onmouseenter="enter('425403785452241366');" onmouseout="out('425403785452241366');" style="">1192                 if (style == BangleJSBitmapStyle.MONOCHROME) {                                           </span>
<span class="-5714749239986980579" onmouseenter="enter('-5714749239986980579');" onmouseout="out('-5714749239986980579');" style="">1193                     col = (((r + g) + b) &gt;= 768) ? 1 : 0;                                                </span>
<span class="2913621535438476958" onmouseenter="enter('2913621535438476958');" onmouseout="out('2913621535438476958');" style="">1194                 } else if (style == BangleJSBitmapStyle.RGB_3BPP) {                                      </span>
<span class="6655873151110877821" onmouseenter="enter('6655873151110877821');" onmouseout="out('6655873151110877821');" style="">1195                     col = ((r &gt;= 256 ? 1 : 0) | (g &gt;= 256 ? 2 : 0)) | (b &gt;= 256 ? 4 : 0);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1196                 }                                                                                        </span>
<span class="-1984322815564514344" onmouseenter="enter('-1984322815564514344');" onmouseout="out('-1984322815564514344');" style="">1197                 // if not transparent, record usage                                                      </span>
<span class="-1639830103098407414" onmouseenter="enter('-1639830103098407414');" onmouseout="out('-1639830103098407414');" style="">1198                 if (!pixelTransparent) {                                                                 </span>
<span class="-2776729421473967080" onmouseenter="enter('-2776729421473967080');" onmouseout="out('-2776729421473967080');" style="">1199                     colUsage[col]++;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1200                 }                                                                                        </span>
<span class="4219755117683718437" onmouseenter="enter('4219755117683718437');" onmouseout="out('4219755117683718437');" style="">1201                 // save colour, mark transparent separately                                              </span>
<span class="7275311386783088605" onmouseenter="enter('7275311386783088605');" onmouseout="out('7275311386783088605');" style="">1202                 pixels[n++] = ((byte) ((pixelTransparent) ? PIXELCOL_TRANSPARENT : col));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1203             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1204         }                                                                                                </span>
<span class="-7238986996251945663" onmouseenter="enter('-7238986996251945663');" onmouseout="out('-7238986996251945663');" style="">1205         // if we&#x27;re transparent, find the least-used color, and use that for transparency                </span>
<span class="-3011917059987129784" onmouseenter="enter('-3011917059987129784');" onmouseout="out('-3011917059987129784');" style="">1206         if (isTransparent) {                                                                             </span>
<span class="-8837844203179481085" onmouseenter="enter('-8837844203179481085');" onmouseout="out('-8837844203179481085');" style="">1207             // find least used                                                                           </span>
<span class="-2156609844502175267" onmouseenter="enter('-2156609844502175267');" onmouseout="out('-2156609844502175267');" style="">1208             int minColUsage = -1;                                                                        </span>
<span class="-7109096896103501926" onmouseenter="enter('-7109096896103501926');" onmouseout="out('-7109096896103501926');" style="">1209             for (int c = 0; c &lt; 8; c++) {                                                                </span>
<span class="1563396679151690864" onmouseenter="enter('1563396679151690864');" onmouseout="out('1563396679151690864');" style="">1210                 if ((minColUsage &lt; 0) || (colUsage[c] &lt; minColUsage)) {                                  </span>
<span class="5318194882336838338" onmouseenter="enter('5318194882336838338');" onmouseout="out('5318194882336838338');" style="">1211                     minColUsage = colUsage[c];                                                           </span>
<span class="-6313391513095838917" onmouseenter="enter('-6313391513095838917');" onmouseout="out('-6313391513095838917');" style="">1212                     transparentColorIndex = ((byte) (c));                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1213                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1214             }                                                                                            </span>
<span class="-6360425578627405201" onmouseenter="enter('-6360425578627405201');" onmouseout="out('-6360425578627405201');" style="">1215             // rewrite any transparent pixels as the correct color for transparency                      </span>
<span class="-5416151965397794978" onmouseenter="enter('-5416151965397794978');" onmouseout="out('-5416151965397794978');" style="">1216             for (n = 0; n &lt; pixels.length; n++) {                                                        </span>
<span class="2223674147407876062" onmouseenter="enter('2223674147407876062');" onmouseout="out('2223674147407876062');" style="">1217                 if (pixels[n] == PIXELCOL_TRANSPARENT) {                                                 </span>
<span class="2866860587696074876" onmouseenter="enter('2866860587696074876');" onmouseout="out('2866860587696074876');" style="">1218                     pixels[n] = transparentColorIndex;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1219                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1220             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1221         }                                                                                                </span>
<span class="2745980283769036105" onmouseenter="enter('2745980283769036105');" onmouseout="out('2745980283769036105');" style="">1222         // Write the header                                                                              </span>
<span class="4619789784648282898" onmouseenter="enter('4619789784648282898');" onmouseout="out('4619789784648282898');" style="">1223         int headerLen = (isTransparent) ? 4 : 3;                                                         </span>
<span class="6067090525523658250" onmouseenter="enter('6067090525523658250');" onmouseout="out('6067090525523658250');" style="">1224         byte[] bmp = new byte[((((height * width) * bpp) + 7) &gt;&gt; 3) + headerLen];                        </span>
<span class="-3123089809445365222" onmouseenter="enter('-3123089809445365222');" onmouseout="out('-3123089809445365222');" style="">1225         bmp[0] = ((byte) (width));                                                                       </span>
<span class="-5375657870153237735" onmouseenter="enter('-5375657870153237735');" onmouseout="out('-5375657870153237735');" style="">1226         bmp[1] = ((byte) (height));                                                                      </span>
<span class="6954450436876767664" onmouseenter="enter('6954450436876767664');" onmouseout="out('6954450436876767664');" style="">1227         bmp[2] = ((byte) (bpp + (isTransparent ? 128 : 0)));                                             </span>
<span class="-3011917059987129784" onmouseenter="enter('-3011917059987129784');" onmouseout="out('-3011917059987129784');" style="">1228         if (isTransparent) {                                                                             </span>
<span class="-8946038768092927753" onmouseenter="enter('-8946038768092927753');" onmouseout="out('-8946038768092927753');" style="">1229             bmp[3] = transparentColorIndex;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1230         }                                                                                                </span>
<span class="8478354166162352997" onmouseenter="enter('8478354166162352997');" onmouseout="out('8478354166162352997');" style="">1231         // Now write the image out bit by bit                                                            </span>
<span class="344926378213754405" onmouseenter="enter('344926378213754405');" onmouseout="out('344926378213754405');" style="">1232         BitWriter bits = new BitWriter(bmp, headerLen);                                                  </span>
<span class="-3260558023763679626" onmouseenter="enter('-3260558023763679626');" onmouseout="out('-3260558023763679626');" style="">1233         n = 0;                                                                                           </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1234         for (int y = 0; y &lt; height; y++) {                                                               </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1235             for (int x = 0; x &lt; width; x++) {                                                            </span>
<span class="593941254526452666" onmouseenter="enter('593941254526452666');" onmouseout="out('593941254526452666');" style="">1236                 int pixel = pixels[n++];                                                                 </span>
<span class="1798653453310326348" onmouseenter="enter('1798653453310326348');" onmouseout="out('1798653453310326348');" style="">1237                 for (int b = bpp - 1; b &gt;= 0; b--) {                                                     </span>
<span class="7762727858310627224" onmouseenter="enter('7762727858310627224');" onmouseout="out('7762727858310627224');" style="">1238                     bits.push(((pixel &gt;&gt; b) &amp; 1) != 0);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1239                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1240             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1241         }                                                                                                </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1242         return bmp;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1243     }                                                                                                    </span>
<span  style="">1244                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1245     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1246      * Currently only 1bpp, no scaling */                                                                </span>
<span class="8132909775831713515" onmouseenter="enter('8132909775831713515');" onmouseout="out('8132909775831713515');" style="">1247     public static String bitmapToEspruinoString(Bitmap bitmap, BangleJSBitmapStyle style) {              </span>
<span class="-259762080887441901" onmouseenter="enter('-259762080887441901');" onmouseout="out('-259762080887441901');" style="">1248         return new String(bitmapToEspruinoArray(bitmap, style), StandardCharsets.ISO_8859_1);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1249     }                                                                                                    </span>
<span  style="">1250                                                                                                          </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1251     /** Convert an Android bitmap to a base64 string for use in Espruino.                                </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1252      * Currently only 1bpp, no scaling */                                                                </span>
<span class="3005879465184206786" onmouseenter="enter('3005879465184206786');" onmouseout="out('3005879465184206786');" style="">1253     public static String bitmapToEspruinoBase64(Bitmap bitmap, BangleJSBitmapStyle style) {              </span>
<span class="1469322567080526004" onmouseenter="enter('1469322567080526004');" onmouseout="out('1469322567080526004');" style=""><abbr title="1254         return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\n&quot;, &quot;&quot;);">1254         return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\nðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1255     }                                                                                                    </span>
<span  style="">1256                                                                                                          </span>
<span class="-3553936365177536696" onmouseenter="enter('-3553936365177536696');" onmouseout="out('-3553936365177536696');" style="">1257     /** Convert a drawable to a bitmap, for use with bitmapToEspruino */                                 </span>
<span class="3383127324214077694" onmouseenter="enter('3383127324214077694');" onmouseout="out('3383127324214077694');" style="">1258     public static Bitmap drawableToBitmap(Drawable drawable) {                                           </span>
<span class="5888468731770076773" onmouseenter="enter('5888468731770076773');" onmouseout="out('5888468731770076773');" style="">1259         final int maxWidth = 32;                                                                         </span>
<span class="1045468429082287724" onmouseenter="enter('1045468429082287724');" onmouseout="out('1045468429082287724');" style="">1260         final int maxHeight = 32;                                                                        </span>
<span class="2296952793490653309" onmouseenter="enter('2296952793490653309');" onmouseout="out('2296952793490653309');" style="">1261         /* Return bitmap directly but only if it&#x27;s small enough. It could be                             </span>
<span class="5951543220377437420" onmouseenter="enter('5951543220377437420');" onmouseout="out('5951543220377437420');" style="">1262         we have a bitmap but it&#x27;s just too big to send direct to the bangle */                           </span>
<span class="256873417632096091" onmouseenter="enter('256873417632096091');" onmouseout="out('256873417632096091');" style="">1263         if (drawable instanceof BitmapDrawable) {                                                        </span>
<span class="-5943336945219947575" onmouseenter="enter('-5943336945219947575');" onmouseout="out('-5943336945219947575');" style="">1264             BitmapDrawable bitmapDrawable = (BitmapDrawable) drawable;                                   </span>
<span class="3248690101517469022" onmouseenter="enter('3248690101517469022');" onmouseout="out('3248690101517469022');" style="">1265             Bitmap bmp = bitmapDrawable.getBitmap();                                                     </span>
<span class="-7540961171633243123" onmouseenter="enter('-7540961171633243123');" onmouseout="out('-7540961171633243123');" style="">1266             if (bmp != null &amp;&amp; bmp.getWidth()&lt;=maxWidth &amp;&amp; bmp.getHeight()&lt;=maxHeight)                   </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1267                 return bmp;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1268         }                                                                                                </span>
<span class="-1267243917470848355" onmouseenter="enter('-1267243917470848355');" onmouseout="out('-1267243917470848355');" style="">1269         /* Otherwise render this to a bitmap ourselves.. work out size */                                </span>
<span class="4014031002419706861" onmouseenter="enter('4014031002419706861');" onmouseout="out('4014031002419706861');" style="">1270         int w = maxWidth;                                                                                </span>
<span class="7839465956667040099" onmouseenter="enter('7839465956667040099');" onmouseout="out('7839465956667040099');" style="">1271         int h = maxHeight;                                                                               </span>
<span class="-8364515267334494119" onmouseenter="enter('-8364515267334494119');" onmouseout="out('-8364515267334494119');" style="">1272         if (drawable.getIntrinsicWidth() &gt; 0 &amp;&amp; drawable.getIntrinsicHeight() &gt; 0) {                     </span>
<span class="7888521624075720743" onmouseenter="enter('7888521624075720743');" onmouseout="out('7888521624075720743');" style="">1273             w = drawable.getIntrinsicWidth();                                                            </span>
<span class="-8527253388982325533" onmouseenter="enter('-8527253388982325533');" onmouseout="out('-8527253388982325533');" style="">1274             h = drawable.getIntrinsicHeight();                                                           </span>
<span class="1937935127293972578" onmouseenter="enter('1937935127293972578');" onmouseout="out('1937935127293972578');" style="">1275             // don&#x27;t allocate anything too big, but keep the ratio                                       </span>
<span class="-3040808582930904343" onmouseenter="enter('-3040808582930904343');" onmouseout="out('-3040808582930904343');" style="">1276             if (w&gt;maxWidth) {                                                                            </span>
<span class="3961818778152175494" onmouseenter="enter('3961818778152175494');" onmouseout="out('3961818778152175494');" style="">1277                 h = h * maxWidth / w;                                                                    </span>
<span class="-810617720622075293" onmouseenter="enter('-810617720622075293');" onmouseout="out('-810617720622075293');" style="">1278                 w = maxWidth;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1279             }                                                                                            </span>
<span class="-8361662207911676693" onmouseenter="enter('-8361662207911676693');" onmouseout="out('-8361662207911676693');" style="">1280             if (h&gt;maxHeight) {                                                                           </span>
<span class="-4098427333168952513" onmouseenter="enter('-4098427333168952513');" onmouseout="out('-4098427333168952513');" style="">1281                 w = w * maxHeight / h;                                                                   </span>
<span class="3192577241527884586" onmouseenter="enter('3192577241527884586');" onmouseout="out('3192577241527884586');" style="">1282                 h = maxHeight;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1283             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1284         }                                                                                                </span>
<span class="5796017605604363662" onmouseenter="enter('5796017605604363662');" onmouseout="out('5796017605604363662');" style="">1285         /* render */                                                                                     </span>
<span class="2390903888286128230" onmouseenter="enter('2390903888286128230');" onmouseout="out('2390903888286128230');" style=""><abbr title="1286         Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will be created of 1x1 pixel">1286         Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will bðŸ”µ</abbr></span>
<span class="-8462009662057840967" onmouseenter="enter('-8462009662057840967');" onmouseout="out('-8462009662057840967');" style="">1287         Canvas canvas = new Canvas(bitmap);                                                              </span>
<span class="8202941983594652957" onmouseenter="enter('8202941983594652957');" onmouseout="out('8202941983594652957');" style="">1288         drawable.setBounds(0, 0, canvas.getWidth(), canvas.getHeight());                                 </span>
<span class="-8639362966527052788" onmouseenter="enter('-8639362966527052788');" onmouseout="out('-8639362966527052788');" style="">1289         drawable.draw(canvas);                                                                           </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style="">1290         return bitmap;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1291     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1292 }                                                                                                        </span></pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="7867943778411854368" onmouseenter="enter('7867943778411854368');" onmouseout="out('7867943778411854368');" style="">   1  /*  Copyright (C) 2019-2021 Andreas Shimokawa, Gordon Williams                                                    </span>
<span  style="">   2                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   4                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8      (at your option) any later version.                                                                           </span>
<span  style="">   9                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  14                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="-588248541382154970" onmouseenter="enter('-588248541382154970');" onmouseout="out('-588248541382154970');" style="">  17  package nodomain.freeyourgadget.gadgetbridge.service.devices.banglejs;                                            </span>
<span  style="">  18                                                                                                                    </span>
<span class="2440823415412133066" onmouseenter="enter('2440823415412133066');" onmouseout="out('2440823415412133066');" style="">  19  import android.bluetooth.BluetoothGatt;                                                                           </span>
<span class="4736969144974683041" onmouseenter="enter('4736969144974683041');" onmouseout="out('4736969144974683041');" style="">  20  import android.bluetooth.BluetoothGattCharacteristic;                                                             </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  21  import android.content.BroadcastReceiver;                                                                         </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  22  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  23  import android.content.Intent;                                                                                    </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  24  import android.content.IntentFilter;                                                                              </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  25  import android.graphics.Bitmap;                                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  26  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  27  import android.graphics.Canvas;                                                                                   </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  28  import android.graphics.Paint;                                                                                    </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  29  import android.graphics.drawable.BitmapDrawable;                                                                  </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  30  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="">  31  import android.net.Uri;                                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  32  import android.util.Base64;                                                                                       </span>
<span class="-4373317539211938720" onmouseenter="enter('-4373317539211938720');" onmouseout="out('-4373317539211938720');" style="">  33  import android.widget.Toast;                                                                                      </span>
<span  style="">  34                                                                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  35  import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                              </span>
<span  style="">  36                                                                                                                    </span>
<span class="3171981379522900271" onmouseenter="enter('3171981379522900271');" onmouseout="out('3171981379522900271');" style="">  37  import com.android.volley.Request;                                                                                </span>
<span class="4430867795468484324" onmouseenter="enter('4430867795468484324');" onmouseout="out('4430867795468484324');" style="">  38  import com.android.volley.Response;                                                                               </span>
<span class="-6875921712592050045" onmouseenter="enter('-6875921712592050045');" onmouseout="out('-6875921712592050045');" style="">  39  import com.android.volley.RequestQueue;                                                                           </span>
<span class="7596528640051210243" onmouseenter="enter('7596528640051210243');" onmouseout="out('7596528640051210243');" style="">  40  import com.android.volley.VolleyError;                                                                            </span>
<span class="-6338542844679972782" onmouseenter="enter('-6338542844679972782');" onmouseout="out('-6338542844679972782');" style="">  41  import com.android.volley.toolbox.StringRequest;                                                                  </span>
<span class="4822020902022089151" onmouseenter="enter('4822020902022089151');" onmouseout="out('4822020902022089151');" style="">  42  import com.android.volley.toolbox.Volley;                                                                         </span>
<span  style="">  43                                                                                                                    </span>
<span class="-9193129351684262878" onmouseenter="enter('-9193129351684262878');" onmouseout="out('-9193129351684262878');" style="">  44  import org.json.JSONArray;                                                                                        </span>
<span class="-8573375701834280359" onmouseenter="enter('-8573375701834280359');" onmouseout="out('-8573375701834280359');" style="">  45  import org.json.JSONException;                                                                                    </span>
<span class="7232075261178918144" onmouseenter="enter('7232075261178918144');" onmouseout="out('7232075261178918144');" style="">  46  import org.json.JSONObject;                                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  47  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  48  import org.slf4j.LoggerFactory;                                                                                   </span>
<span class="-2051516048009622280" onmouseenter="enter('-2051516048009622280');" onmouseout="out('-2051516048009622280');" style="">  49  import org.xml.sax.InputSource;                                                                                   </span>
<span  style="">  50                                                                                                                    </span>
<span class="-6983162919371453239" onmouseenter="enter('-6983162919371453239');" onmouseout="out('-6983162919371453239');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +import java.io.BufferedWriter;                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +import java.io.File;                                                                                              </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +import java.io.FileOutputStream;                                                                                  </span>
<span class="4914725365521379617" onmouseenter="enter('4914725365521379617');" onmouseout="out('4914725365521379617');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +import java.io.FileWriter;                                                                                        </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  55  import java.io.IOException;                                                                                       </span>
<span class="4087034682117787535" onmouseenter="enter('4087034682117787535');" onmouseout="out('4087034682117787535');" style="">  56  import java.io.StringReader;                                                                                      </span>
<span class="-2624565711555737384" onmouseenter="enter('-2624565711555737384');" onmouseout="out('-2624565711555737384');" style="">  57  import java.nio.charset.StandardCharsets;                                                                         </span>
<span class="54331962280914690" onmouseenter="enter('54331962280914690');" onmouseout="out('54331962280914690');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +import java.text.SimpleDateFormat;                                                                                </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  59  import java.util.ArrayList;                                                                                       </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  60  import java.util.Calendar;                                                                                        </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +import java.util.Date;                                                                                            </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  62  import java.util.GregorianCalendar;                                                                               </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  63  import java.util.HashMap;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  64  import java.util.Iterator;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +import java.util.List;                                                                                            </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +import java.util.Locale;                                                                                          </span>
<span class="8860446888132102879" onmouseenter="enter('8860446888132102879');" onmouseout="out('8860446888132102879');" style="">  67  import java.util.SimpleTimeZone;                                                                                  </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  68  import java.util.UUID;                                                                                            </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  69  import java.lang.reflect.Field;                                                                                   </span>
<span  style="">  70                                                                                                                    </span>
<span class="-3163672285055708144" onmouseenter="enter('-3163672285055708144');" onmouseout="out('-3163672285055708144');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +import io.wax911.emojify.Emoji;                                                                                   </span>
<span class="6994093753897510849" onmouseenter="enter('6994093753897510849');" onmouseout="out('6994093753897510849');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +import io.wax911.emojify.EmojiManager;                                                                            </span>
<span class="-2985037039232163872" onmouseenter="enter('-2985037039232163872');" onmouseout="out('-2985037039232163872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +import io.wax911.emojify.EmojiUtils;                                                                              </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  74  import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                          </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  75  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  76  import nodomain.freeyourgadget.gadgetbridge.R;                                                                    </span>
<span class="-141107564105590930" onmouseenter="enter('-141107564105590930');" onmouseout="out('-141107564105590930');" style="">  77  import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst;              </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  78  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  79  import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                                    </span>
<span class="-3005335786085073829" onmouseenter="enter('-3005335786085073829');" onmouseout="out('-3005335786085073829');" style="">  80  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventBatteryInfo;                                </span>
<span class="7017557905176594961" onmouseenter="enter('7017557905176594961');" onmouseout="out('7017557905176594961');" style="">  81  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventCallControl;                                </span>
<span class="6368471362458763033" onmouseenter="enter('6368471362458763033');" onmouseout="out('6368471362458763033');" style="">  82  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventFindPhone;                                  </span>
<span class="4012861689788039008" onmouseenter="enter('4012861689788039008');" onmouseout="out('4012861689788039008');" style="">  83  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventMusicControl;                               </span>
<span class="-5203005511074004401" onmouseenter="enter('-5203005511074004401');" onmouseout="out('-5203005511074004401');" style="">  84  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventNotificationControl;                        </span>
<span class="4252572397761323695" onmouseenter="enter('4252572397761323695');" onmouseout="out('4252572397761323695');" style="">  85  import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSConstants;                                   </span>
<span class="8687478736174414119" onmouseenter="enter('8687478736174414119');" onmouseout="out('8687478736174414119');" style="">  86  import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSSampleProvider;                              </span>
<span class="-7483974346858162294" onmouseenter="enter('-7483974346858162294');" onmouseout="out('-7483974346858162294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +import nodomain.freeyourgadget.gadgetbridge.devices.qhybrid.NotificationConfiguration;                            </span>
<span class="8046368326334810504" onmouseenter="enter('8046368326334810504');" onmouseout="out('8046368326334810504');" style="">  88  import nodomain.freeyourgadget.gadgetbridge.entities.BangleJSActivitySample;                                      </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  89  import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                                        </span>
<span class="5185434099904652174" onmouseenter="enter('5185434099904652174');" onmouseout="out('5185434099904652174');" style="">  90  import nodomain.freeyourgadget.gadgetbridge.model.ActivityKind;                                                   </span>
<span class="-8766238562391910018" onmouseenter="enter('-8766238562391910018');" onmouseout="out('-8766238562391910018');" style="">  91  import nodomain.freeyourgadget.gadgetbridge.model.Alarm;                                                          </span>
<span class="2021957179005285653" onmouseenter="enter('2021957179005285653');" onmouseout="out('2021957179005285653');" style="">  92  import nodomain.freeyourgadget.gadgetbridge.model.BatteryState;                                                   </span>
<span class="-3899388208810973608" onmouseenter="enter('-3899388208810973608');" onmouseout="out('-3899388208810973608');" style="">  93  import nodomain.freeyourgadget.gadgetbridge.model.CalendarEventSpec;                                              </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  94  import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                                       </span>
<span class="-7415926539738049206" onmouseenter="enter('-7415926539738049206');" onmouseout="out('-7415926539738049206');" style="">  95  import nodomain.freeyourgadget.gadgetbridge.model.CannedMessagesSpec;                                             </span>
<span class="308285905299900254" onmouseenter="enter('308285905299900254');" onmouseout="out('308285905299900254');" style="">  96  import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;                                                  </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  97  import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                                      </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  98  import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                                 </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  99  import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                               </span>
<span class="-3277000154202836222" onmouseenter="enter('-3277000154202836222');" onmouseout="out('-3277000154202836222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +import nodomain.freeyourgadget.gadgetbridge.model.RecordedDataTypes;                                              </span>
<span class="-40839721936664146" onmouseenter="enter('-40839721936664146');" onmouseout="out('-40839721936664146');" style=""> 101  import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;                                                    </span>
<span class="4344228987867394358" onmouseenter="enter('4344228987867394358');" onmouseout="out('4344228987867394358');" style=""> 102  import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLEDeviceSupport;                               </span>
<span class="3410519392510510669" onmouseenter="enter('3410519392510510669');" onmouseout="out('3410519392510510669');" style=""> 103  import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;                                      </span>
<span class="332482647079918156" onmouseenter="enter('332482647079918156');" onmouseout="out('332482647079918156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +import nodomain.freeyourgadget.gadgetbridge.service.devices.qhybrid.requests.misfit.PlayNotificationRequest;      </span>
<span class="-9148468836908617343" onmouseenter="enter('-9148468836908617343');" onmouseout="out('-9148468836908617343');" style=""> 105  import nodomain.freeyourgadget.gadgetbridge.util.AlarmUtils;                                                      </span>
<span class="-8051705910484913631" onmouseenter="enter('-8051705910484913631');" onmouseout="out('-8051705910484913631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +import nodomain.freeyourgadget.gadgetbridge.util.EmojiConverter;                                                  </span>
<span class="-2020231768395052380" onmouseenter="enter('-2020231768395052380');" onmouseout="out('-2020231768395052380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +import nodomain.freeyourgadget.gadgetbridge.util.FileUtils;                                                       </span>
<span class="-3798970344596478499" onmouseenter="enter('-3798970344596478499');" onmouseout="out('-3798970344596478499');" style=""> 108  import nodomain.freeyourgadget.gadgetbridge.util.GB;                                                              </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                                    </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style=""> 110  import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                           </span>
<span  style=""> 111                                                                                                                    </span>
<span class="-2225725182537405146" onmouseenter="enter('-2225725182537405146');" onmouseout="out('-2225725182537405146');" style=""><abbr title=" 112  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_ALLOW_HIGH_MTU;"> 112  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_ALðŸ”µ</abbr></span>
<span class="2440588347549655822" onmouseenter="enter('2440588347549655822');" onmouseout="out('2440588347549655822');" style=""><abbr title=" 113  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTERNET_ACCESS;"> 113  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEðŸ”µ</abbr></span>
<span class="-5321063140707926105" onmouseenter="enter('-5321063140707926105');" onmouseout="out('-5321063140707926105');" style=""><abbr title=" 114  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTENTS;"> 114  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEðŸ”µ</abbr></span>
<span class="1576087340720410961" onmouseenter="enter('1576087340720410961');" onmouseout="out('1576087340720410961');" style=""><abbr title=" 115  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_BANGLEJS_TEXT_BITMAP;"> 115  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_BAðŸ”µ</abbr></span>
<span class="-7620522862868556032" onmouseenter="enter('-7620522862868556032');" onmouseout="out('-7620522862868556032');" style=""> 116  import static nodomain.freeyourgadget.gadgetbridge.database.DBHelper.*;                                           </span>
<span  style=""> 117                                                                                                                    </span>
<span class="-6525955205891456613" onmouseenter="enter('-6525955205891456613');" onmouseout="out('-6525955205891456613');" style=""> 118  import javax.xml.xpath.XPath;                                                                                     </span>
<span class="948957029946951050" onmouseenter="enter('948957029946951050');" onmouseout="out('948957029946951050');" style=""> 119  import javax.xml.xpath.XPathFactory;                                                                              </span>
<span  style=""> 120                                                                                                                    </span>
<span class="-4540174980983528222" onmouseenter="enter('-4540174980983528222');" onmouseout="out('-4540174980983528222');" style=""> 121  public class BangleJSDeviceSupport extends AbstractBTLEDeviceSupport {                                            </span>
<span class="5737832610637191351" onmouseenter="enter('5737832610637191351');" onmouseout="out('5737832610637191351');" style=""> 122      private static final Logger LOG = LoggerFactory.getLogger(BangleJSDeviceSupport.class);                       </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-1874769646843493640" onmouseenter="enter('-1874769646843493640');" onmouseout="out('-1874769646843493640');" style=""> 124      private BluetoothGattCharacteristic rxCharacteristic = null;                                                  </span>
<span class="3394422526290177606" onmouseenter="enter('3394422526290177606');" onmouseout="out('3394422526290177606');" style=""> 125      private BluetoothGattCharacteristic txCharacteristic = null;                                                  </span>
<span class="4278598336110524029" onmouseenter="enter('4278598336110524029');" onmouseout="out('4278598336110524029');" style=""> 126      private boolean allowHighMTU = false;                                                                         </span>
<span class="4758769595687694218" onmouseenter="enter('4758769595687694218');" onmouseout="out('4758769595687694218');" style=""> 127      private int mtuSize = 20;                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -                                                                                                                  </span>
<span class="-5210712730292226171" onmouseenter="enter('-5210712730292226171');" onmouseout="out('-5210712730292226171');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +    int bangleCommandSeq = 0; // to attempt to stop duplicate packets when sending Local Intents                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +                                                                                                                  </span>
<span class="1561011760409728503" onmouseenter="enter('1561011760409728503');" onmouseout="out('1561011760409728503');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +    /// Current line of data received from Bangle.js                                                              </span>
<span class="-848193569484274658" onmouseenter="enter('-848193569484274658');" onmouseout="out('-848193569484274658');" style=""> 132      private String receivedLine = &quot;&quot;;                                                                             </span>
<span class="7842135007952282839" onmouseenter="enter('7842135007952282839');" onmouseout="out('7842135007952282839');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 133 +    /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS). Can be dumped with &#x27;Fetch Device Debug Logs&#x27; from Debug menu"> 133 +    /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS). Can be dðŸ”µ</abbr></span>
<span class="-7872820322050208046" onmouseenter="enter('-7872820322050208046');" onmouseout="out('-7872820322050208046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +    private String receiveHistory = &quot;&quot;;                                                                           </span>
<span class="-3915326133595600019" onmouseenter="enter('-3915326133595600019');" onmouseout="out('-3915326133595600019');" style=""> 135      private boolean realtimeHRM = false;                                                                          </span>
<span class="-4342711334813376852" onmouseenter="enter('-4342711334813376852');" onmouseout="out('-4342711334813376852');" style=""> 136      private boolean realtimeStep = false;                                                                         </span>
<span class="-785214995925481662" onmouseenter="enter('-785214995925481662');" onmouseout="out('-785214995925481662');" style=""> 137      private int realtimeHRMInterval = 30*60;                                                                      </span>





<span  style=""> 138                                                                                                                    </span>
<span class="7817012674261800607" onmouseenter="enter('7817012674261800607');" onmouseout="out('7817012674261800607');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +    private final LimitedQueue/*Long*/ mNotificationReplyAction = new LimitedQueue(16);                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +                                                                                                                  </span>
<span class="3035544862292212294" onmouseenter="enter('3035544862292212294');" onmouseout="out('3035544862292212294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +    /// Maximum amount of characters to store in receiveHistory                                                   </span>
<span class="-1679828146401541729" onmouseenter="enter('-1679828146401541729');" onmouseout="out('-1679828146401541729');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +    public static final int MAX_RECEIVE_HISTORY_CHARS = 100000;                                                   </span>
<span class="-4613019613947290640" onmouseenter="enter('-4613019613947290640');" onmouseout="out('-4613019613947290640');" style=""> 143      // Local Intents - for app manager communication                                                              </span>
<span class="-6355985936525602065" onmouseenter="enter('-6355985936525602065');" onmouseout="out('-6355985936525602065');" style=""> 144      public static final String BANGLEJS_COMMAND_TX = &quot;banglejs_command_tx&quot;;                                       </span>
<span class="-7611986610894711832" onmouseenter="enter('-7611986610894711832');" onmouseout="out('-7611986610894711832');" style=""> 145      public static final String BANGLEJS_COMMAND_RX = &quot;banglejs_command_rx&quot;;                                       </span>
<span class="3928394439815779565" onmouseenter="enter('3928394439815779565');" onmouseout="out('3928394439815779565');" style=""> 146      // Global Intents                                                                                             </span>
<span class="8064114268652999257" onmouseenter="enter('8064114268652999257');" onmouseout="out('8064114268652999257');" style=""> 147      private static final String BANGLE_ACTION_UART_TX = &quot;com.banglejs.uart.tx&quot;;                                   </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-7141869860994321087" onmouseenter="enter('-7141869860994321087');" onmouseout="out('-7141869860994321087');" style=""> 149      public BangleJSDeviceSupport() {                                                                              </span>
<span class="4463652287758102089" onmouseenter="enter('4463652287758102089');" onmouseout="out('4463652287758102089');" style=""> 150          super(LOG);                                                                                               </span>
<span class="3886704256627163463" onmouseenter="enter('3886704256627163463');" onmouseout="out('3886704256627163463');" style=""> 151          addSupportedService(BangleJSConstants.UUID_SERVICE_NORDIC_UART);                                          </span>
<span  style=""> 152                                                                                                                    </span>
<span class="1127284200558372197" onmouseenter="enter('1127284200558372197');" onmouseout="out('1127284200558372197');" style=""> 153          registerLocalIntents();                                                                                   </span>
<span class="8826733129991946596" onmouseenter="enter('8826733129991946596');" onmouseout="out('8826733129991946596');" style=""> 154          registerGlobalIntents();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155      }                                                                                                             </span>
<span  style=""> 156                                                                                                                    </span>
<span class="3363204271654612484" onmouseenter="enter('3363204271654612484');" onmouseout="out('3363204271654612484');" style=""> 157      private void registerLocalIntents() {                                                                         </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 158          IntentFilter commandFilter = new IntentFilter();                                                          </span>
<span class="-7160894414714230309" onmouseenter="enter('-7160894414714230309');" onmouseout="out('-7160894414714230309');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +        commandFilter.addAction(GBDevice.ACTION_DEVICE_CHANGED);                                                  </span>
<span class="1690174294514698098" onmouseenter="enter('1690174294514698098');" onmouseout="out('1690174294514698098');" style=""> 160          commandFilter.addAction(BANGLEJS_COMMAND_TX);                                                             </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 161          BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 162              @Override                                                                                             </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 163              public void onReceive(Context context, Intent intent) {                                               </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 164                  switch (intent.getAction()) {                                                                     </span>
<span class="1707526022738550013" onmouseenter="enter('1707526022738550013');" onmouseout="out('1707526022738550013');" style=""> 165                      case BANGLEJS_COMMAND_TX: {                                                                   </span>
<span class="6200259397597608765" onmouseenter="enter('6200259397597608765');" onmouseout="out('6200259397597608765');" style=""> 166                          String data = String.valueOf(intent.getExtras().get(&quot;DATA&quot;));                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 167                          try {                                                                                     </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 168                              TransactionBuilder builder = performInitialized(&quot;TX&quot;);                                </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 169                              uartTx(builder, data);                                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 170                              builder.queue(getQueue());                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 171                          } catch (IOException e) {                                                                 </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 172                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 172                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173                          }                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 174                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                    }                                                                                             </span>
<span class="5219935206621418062" onmouseenter="enter('5219935206621418062');" onmouseout="out('5219935206621418062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                    case GBDevice.ACTION_DEVICE_CHANGED: {                                                        </span>
<span class="-7853573391303433157" onmouseenter="enter('-7853573391303433157');" onmouseout="out('-7853573391303433157');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +                        LOG.info(&quot;ACTION_DEVICE_CHANGED &quot; + gbDevice.getStateString());                           </span>
<span class="3462566553438825861" onmouseenter="enter('3462566553438825861');" onmouseout="out('3462566553438825861');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 178 +                        receiveHistory += &quot;\n================================================\nACTION_DEVICE_CHANGED &quot;+gbDevice.getStateString()+&quot; &quot;+(new SimpleDateFormat(&quot;yyyy-mm-dd hh:mm:ss&quot;)).format(Calendar.getInstance().getTime())+&quot;\n================================================\n&quot;;"> 178 +                        receiveHistory += &quot;\n================================================\nACTION_DEVICE_CHANGðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 182          };                                                                                                        </span>
<span class="-3358010436009942845" onmouseenter="enter('-3358010436009942845');" onmouseout="out('-3358010436009942845');" style=""><abbr title=" 183          LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, commandFilter);"> 183          LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, commandFilðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184      }                                                                                                             </span>
<span  style=""> 185                                                                                                                    </span>
<span class="-5775866095722777208" onmouseenter="enter('-5775866095722777208');" onmouseout="out('-5775866095722777208');" style=""> 186      private void registerGlobalIntents() {                                                                        </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 187          IntentFilter commandFilter = new IntentFilter();                                                          </span>
<span class="312812515367481242" onmouseenter="enter('312812515367481242');" onmouseout="out('312812515367481242');" style=""> 188          commandFilter.addAction(BANGLE_ACTION_UART_TX);                                                           </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 189          BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 190              @Override                                                                                             </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 191              public void onReceive(Context context, Intent intent) {                                               </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 192                  switch (intent.getAction()) {                                                                     </span>
<span class="-2247552427419228949" onmouseenter="enter('-2247552427419228949');" onmouseout="out('-2247552427419228949');" style=""> 193                      case BANGLE_ACTION_UART_TX: {                                                                 </span>
<span class="1831826963180757129" onmouseenter="enter('1831826963180757129');" onmouseout="out('1831826963180757129');" style=""> 194                          /* In Tasker:                                                                             </span>
<span class="-7864253240443668933" onmouseenter="enter('-7864253240443668933');" onmouseout="out('-7864253240443668933');" style=""> 195                            Action: com.banglejs.uart.tx                                                            </span>
<span class="-8992717920838973367" onmouseenter="enter('-8992717920838973367');" onmouseout="out('-8992717920838973367');" style=""> 196                            Cat: None                                                                               </span>
<span class="7759910949487339439" onmouseenter="enter('7759910949487339439');" onmouseout="out('7759910949487339439');" style=""> 197                            Extra: line:Terminal.println(%avariable)                                                </span>
<span class="1033584491372489972" onmouseenter="enter('1033584491372489972');" onmouseout="out('1033584491372489972');" style=""> 198                            Target: Broadcast Receiver                                                              </span>
<span  style=""> 199                                                                                                                    </span>
<span class="8716883358060475580" onmouseenter="enter('8716883358060475580');" onmouseout="out('8716883358060475580');" style=""><abbr title=" 200                            Variable: Number, Configure on Import, NOT structured, Value set, Nothing Exported, NOT Same as value"> 200                            Variable: Number, Configure on Import, NOT structured, Value set, Nothing Exported, NOT ðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 201                           */                                                                                       </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 202                          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 202                          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddreðŸ”µ</abbr></span>
<span class="-3486649650498692683" onmouseenter="enter('-3486649650498692683');" onmouseout="out('-3486649650498692683');" style=""> 203                          if (!devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) return;                          </span>
<span class="-5120599586530243425" onmouseenter="enter('-5120599586530243425');" onmouseout="out('-5120599586530243425');" style=""> 204                          String data = intent.getStringExtra(&quot;line&quot;);                                              </span>
<span class="2134003849288272405" onmouseenter="enter('2134003849288272405');" onmouseout="out('2134003849288272405');" style=""> 205                          if (data==null) {                                                                         </span>
<span class="-1377387169158373155" onmouseenter="enter('-1377387169158373155');" onmouseout="out('-1377387169158373155');" style=""><abbr title=" 206                              GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 206                              GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTH_LONG, GBðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 207                              return;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                          }                                                                                         </span>
<span class="-5300884727268780299" onmouseenter="enter('-5300884727268780299');" onmouseout="out('-5300884727268780299');" style=""> 209                          if (!data.endsWith(&quot;\n&quot;)) data += &quot;\n&quot;;                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 210                          try {                                                                                     </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 211                              TransactionBuilder builder = performInitialized(&quot;TX&quot;);                                </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 212                              uartTx(builder, data);                                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 213                              builder.queue(getQueue());                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 214                          } catch (IOException e) {                                                                 </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 215                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 215                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216                          }                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 217                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 221          };                                                                                                        </span>
<span class="-7064134150505035894" onmouseenter="enter('-7064134150505035894');" onmouseout="out('-7064134150505035894');" style=""> 222          GBApplication.getContext().registerReceiver(commandReceiver, commandFilter);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223      }                                                                                                             </span>
<span  style=""> 224                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225      @Override                                                                                                     </span>
<span class="624595386859969795" onmouseenter="enter('624595386859969795');" onmouseout="out('624595386859969795');" style=""> 226      protected TransactionBuilder initializeDevice(TransactionBuilder builder) {                                   </span>
<span class="6943102306574884764" onmouseenter="enter('6943102306574884764');" onmouseout="out('6943102306574884764');" style=""> 227          LOG.info(&quot;Initializing&quot;);                                                                                 </span>
<span  style=""> 228                                                                                                                    </span>
<span class="-5776342764121597122" onmouseenter="enter('-5776342764121597122');" onmouseout="out('-5776342764121597122');" style=""> 229          gbDevice.setState(GBDevice.State.INITIALIZING);                                                           </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 230          gbDevice.sendDeviceUpdateIntent(getContext());                                                            </span>
<span class="-92673263340012587" onmouseenter="enter('-92673263340012587');" onmouseout="out('-92673263340012587');" style=""> 231          gbDevice.setBatteryThresholdPercent((short) 30);                                                          </span>
<span  style=""> 232                                                                                                                    </span>
<span class="-8842369873450741446" onmouseenter="enter('-8842369873450741446');" onmouseout="out('-8842369873450741446');" style=""> 233          rxCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX);               </span>
<span class="5321381947985783136" onmouseenter="enter('5321381947985783136');" onmouseout="out('5321381947985783136');" style=""> 234          txCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_TX);               </span>
<span class="8787860057533172177" onmouseenter="enter('8787860057533172177');" onmouseout="out('8787860057533172177');" style=""> 235          builder.setGattCallback(this);                                                                            </span>
<span class="-6644952300158088977" onmouseenter="enter('-6644952300158088977');" onmouseout="out('-6644952300158088977');" style=""> 236          builder.notify(rxCharacteristic, true);                                                                   </span>
<span  style=""> 237                                                                                                                    </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 238          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));         </span>
<span class="-251442064819697046" onmouseenter="enter('-251442064819697046');" onmouseout="out('-251442064819697046');" style=""> 239          allowHighMTU = devicePrefs.getBoolean(PREF_ALLOW_HIGH_MTU, false);                                        </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-8288238614628464708" onmouseenter="enter('-8288238614628464708');" onmouseout="out('-8288238614628464708');" style=""> 241          uartTx(builder, &quot; \u0003&quot;); // clear active line                                                          </span>
<span  style=""> 242                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 243          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="8819552782192853417" onmouseenter="enter('8819552782192853417');" onmouseout="out('8819552782192853417');" style=""> 244          if (prefs.getBoolean(&quot;datetime_synconconnect&quot;, true))                                                     </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 245            transmitTime(builder);                                                                                  </span>
<span class="-772823299017939314" onmouseenter="enter('-772823299017939314');" onmouseout="out('-772823299017939314');" style=""> 246          //sendSettings(builder);                                                                                  </span>
<span  style=""> 247                                                                                                                    </span>
<span class="6222907129579606912" onmouseenter="enter('6222907129579606912');" onmouseout="out('6222907129579606912');" style=""> 248          // get version                                                                                            </span>
<span  style=""> 249                                                                                                                    </span>
<span class="6586859092027978564" onmouseenter="enter('6586859092027978564');" onmouseout="out('6586859092027978564');" style=""> 250          gbDevice.setState(GBDevice.State.INITIALIZED);                                                            </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 251          gbDevice.sendDeviceUpdateIntent(getContext());                                                            </span>
<span  style=""> 252                                                                                                                    </span>
<span class="-3832688778173104110" onmouseenter="enter('-3832688778173104110');" onmouseout="out('-3832688778173104110');" style=""> 253          getDevice().setFirmwareVersion(&quot;N/A&quot;);                                                                    </span>
<span class="-4069256094451065143" onmouseenter="enter('-4069256094451065143');" onmouseout="out('-4069256094451065143');" style=""> 254          getDevice().setFirmwareVersion2(&quot;N/A&quot;);                                                                   </span>
<span  style=""> 255                                                                                                                    </span>
<span class="8801197429786363323" onmouseenter="enter('8801197429786363323');" onmouseout="out('8801197429786363323');" style=""> 256          LOG.info(&quot;Initialization Done&quot;);                                                                          </span>
<span  style=""> 257                                                                                                                    </span>
<span class="4801455624621135639" onmouseenter="enter('4801455624621135639');" onmouseout="out('4801455624621135639');" style=""> 258          return builder;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259      }                                                                                                             </span>
<span  style=""> 260                                                                                                                    </span>
<span class="-607913654590177522" onmouseenter="enter('-607913654590177522');" onmouseout="out('-607913654590177522');" style=""> 261      /// Write a string of data, and chunk it up                                                                   </span>
<span class="7559000899786781106" onmouseenter="enter('7559000899786781106');" onmouseout="out('7559000899786781106');" style=""> 262      private void uartTx(TransactionBuilder builder, String str) {                                                 </span>
<span class="2941836608639998178" onmouseenter="enter('2941836608639998178');" onmouseout="out('2941836608639998178');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +        byte[] bytes = str.getBytes(StandardCharsets.ISO_8859_1);                                                 </span>
<span class="7973208681748769929" onmouseenter="enter('7973208681748769929');" onmouseout="out('7973208681748769929');" style=""> 264          LOG.info(&quot;UART TX: &quot; + str);                                                                              </span>
<span class="7487272846038104686" onmouseenter="enter('7487272846038104686');" onmouseout="out('7487272846038104686');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -        byte[] bytes;                                                                                             </span>
<span class="2645055981471255717" onmouseenter="enter('2645055981471255717');" onmouseout="out('2645055981471255717');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -        bytes = str.getBytes(StandardCharsets.ISO_8859_1);                                                        </span>
<span class="-4351000658882190788" onmouseenter="enter('-4351000658882190788');" onmouseout="out('-4351000658882190788');" style=""><abbr title=" 267          // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.stringify is converting to UTF-8?"> 267          // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.stringify isðŸ”µ</abbr></span>
<span class="-7681259971523215295" onmouseenter="enter('-7681259971523215295');" onmouseout="out('-7681259971523215295');" style=""> 268          for (int i=0;i&lt;bytes.length;i+=mtuSize) {                                                                 </span>
<span class="6940458760871247208" onmouseenter="enter('6940458760871247208');" onmouseout="out('6940458760871247208');" style=""> 269              int l = bytes.length-i;                                                                               </span>
<span class="-2771087721762798548" onmouseenter="enter('-2771087721762798548');" onmouseout="out('-2771087721762798548');" style=""> 270              if (l&gt;mtuSize) l=mtuSize;                                                                             </span>
<span class="-7868874671478910733" onmouseenter="enter('-7868874671478910733');" onmouseout="out('-7868874671478910733');" style=""> 271              byte[] packet = new byte[l];                                                                          </span>
<span class="6292978456177043042" onmouseenter="enter('6292978456177043042');" onmouseout="out('6292978456177043042');" style=""> 272              System.arraycopy(bytes, i, packet, 0, l);                                                             </span>
<span class="7692898876807316449" onmouseenter="enter('7692898876807316449');" onmouseout="out('7692898876807316449');" style=""> 273              builder.write(txCharacteristic, packet);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275      }                                                                                                             </span>
<span  style=""> 276                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 277 -                                                                                                                  </span>
<span class="-607913654590177522" onmouseenter="enter('-607913654590177522');" onmouseout="out('-607913654590177522');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 278 -    /// Write a string of data, and chunk it up                                                                   </span>
<span class="-5064235187014244552" onmouseenter="enter('-5064235187014244552');" onmouseout="out('-5064235187014244552');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +    /// Converts an object to a JSON string. see jsonToString                                                     </span>
<span class="-7371185357421447388" onmouseenter="enter('-7371185357421447388');" onmouseout="out('-7371185357421447388');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +    private String jsonToStringInternal(Object v) {                                                               </span>
<span class="-7134941835268720819" onmouseenter="enter('-7134941835268720819');" onmouseout="out('-7134941835268720819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +        if (v instanceof String) {                                                                                </span>
<span class="4695321176266141339" onmouseenter="enter('4695321176266141339');" onmouseout="out('4695321176266141339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +            /* Convert a string, escaping chars we can&#x27;t send over out UART connection */                         </span>
<span class="8933833811592559950" onmouseenter="enter('8933833811592559950');" onmouseout="out('8933833811592559950');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +            String s = (String)v;                                                                                 </span>
<span class="-1195550795921055111" onmouseenter="enter('-1195550795921055111');" onmouseout="out('-1195550795921055111');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +            String json = &quot;\&quot;&quot;;                                                                                   </span>
<span class="-1996367706551518739" onmouseenter="enter('-1996367706551518739');" onmouseout="out('-1996367706551518739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +            for (int i=0;i&lt;s.length();i++) {                                                                      </span>
<span class="-4633521068028742210" onmouseenter="enter('-4633521068028742210');" onmouseout="out('-4633521068028742210');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +                int ch = (int)s.charAt(i);                                                                        </span>
<span class="5723330426570993790" onmouseenter="enter('5723330426570993790');" onmouseout="out('5723330426570993790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +                if (ch&lt;8) json += &quot;\\&quot;+ch;                                                                        </span>
<span class="-4350456713444094906" onmouseenter="enter('-4350456713444094906');" onmouseout="out('-4350456713444094906');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +                else if (ch==8) json += &quot;\\b&quot;;                                                                    </span>
<span class="6286426041013160143" onmouseenter="enter('6286426041013160143');" onmouseout="out('6286426041013160143');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +                else if (ch==9) json += &quot;\\t&quot;;                                                                    </span>
<span class="-1277399730021433556" onmouseenter="enter('-1277399730021433556');" onmouseout="out('-1277399730021433556');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +                else if (ch==10) json += &quot;\\n&quot;;                                                                   </span>
<span class="6872609748162055968" onmouseenter="enter('6872609748162055968');" onmouseout="out('6872609748162055968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +                else if (ch==11) json += &quot;\\v&quot;;                                                                   </span>
<span class="7232867159848538970" onmouseenter="enter('7232867159848538970');" onmouseout="out('7232867159848538970');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +                else if (ch==12) json += &quot;\\f&quot;;                                                                   </span>
<span class="-9019357013713288321" onmouseenter="enter('-9019357013713288321');" onmouseout="out('-9019357013713288321');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +                else if (ch==34) json += &quot;\\\&quot;&quot;; // quote                                                         </span>
<span class="9032098586745803989" onmouseenter="enter('9032098586745803989');" onmouseout="out('9032098586745803989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +                else if (ch==92) json += &quot;\\\\&quot;; // slash                                                         </span>
<span class="6447496634063631908" onmouseenter="enter('6447496634063631908');" onmouseout="out('6447496634063631908');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 295 +                else if (ch&lt;32 || ch==26 || ch==27 || ch==127 || ch==173) json += &quot;\\x&quot;+Integer.toHexString((ch&amp;255)|256).substring(1);"> 295 +                else if (ch&lt;32 || ch==26 || ch==27 || ch==127 || ch==173) json += &quot;\\x&quot;+Integer.toHexString((ch&amp;25ðŸ”µ</abbr></span>
<span class="5586798994544781015" onmouseenter="enter('5586798994544781015');" onmouseout="out('5586798994544781015');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +                else json += s.charAt(i);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +            }                                                                                                     </span>
<span class="8650149552652832651" onmouseenter="enter('8650149552652832651');" onmouseout="out('8650149552652832651');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +            return json + &quot;\&quot;&quot;;                                                                                   </span>
<span class="-7459573803876256213" onmouseenter="enter('-7459573803876256213');" onmouseout="out('-7459573803876256213');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +        } else if (v instanceof JSONArray) {                                                                      </span>
<span class="20789529080758051" onmouseenter="enter('20789529080758051');" onmouseout="out('20789529080758051');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +            JSONArray a = (JSONArray)v;                                                                           </span>
<span class="2941565214382533189" onmouseenter="enter('2941565214382533189');" onmouseout="out('2941565214382533189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +            String json = &quot;[&quot;;                                                                                    </span>
<span class="2132510637713046246" onmouseenter="enter('2132510637713046246');" onmouseout="out('2132510637713046246');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +            for (int i=0;i&lt;a.length();i++) {                                                                      </span>
<span class="-865608346194445464" onmouseenter="enter('-865608346194445464');" onmouseout="out('-865608346194445464');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +                if (i&gt;0) json += &quot;,&quot;;                                                                             </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +                Object o = null;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 305 +                try {                                                                                             </span>
<span class="1204902991279523771" onmouseenter="enter('1204902991279523771');" onmouseout="out('1204902991279523771');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 306 +                    o = a.get(i);                                                                                 </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 307 +                } catch (JSONException e) {                                                                       </span>
<span class="5502177219725162371" onmouseenter="enter('5502177219725162371');" onmouseout="out('5502177219725162371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 308 +                    LOG.warn(&quot;jsonToString array error: &quot; + e.getLocalizedMessage());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +                }                                                                                                 </span>
<span class="-4254234117673713204" onmouseenter="enter('-4254234117673713204');" onmouseout="out('-4254234117673713204');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +                json += jsonToStringInternal(o);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +            }                                                                                                     </span>
<span class="-4069907645727934854" onmouseenter="enter('-4069907645727934854');" onmouseout="out('-4069907645727934854');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +            return json+&quot;]&quot;;                                                                                      </span>
<span class="8699967118061541294" onmouseenter="enter('8699967118061541294');" onmouseout="out('8699967118061541294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +        } else if (v instanceof JSONObject) {                                                                     </span>
<span class="5040693240352357389" onmouseenter="enter('5040693240352357389');" onmouseout="out('5040693240352357389');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +            JSONObject obj = (JSONObject)v;                                                                       </span>
<span class="-6486828837023838756" onmouseenter="enter('-6486828837023838756');" onmouseout="out('-6486828837023838756');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +            String json = &quot;{&quot;;                                                                                    </span>
<span class="7563206350819307174" onmouseenter="enter('7563206350819307174');" onmouseout="out('7563206350819307174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +            Iterator&lt;String&gt; iter = obj.keys();                                                                   </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +            while (iter.hasNext()) {                                                                              </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +                String key = iter.next();                                                                         </span>
<span class="-144921863826016230" onmouseenter="enter('-144921863826016230');" onmouseout="out('-144921863826016230');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 319 +                Object o = null;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +                try {                                                                                             </span>
<span class="8042496106905891292" onmouseenter="enter('8042496106905891292');" onmouseout="out('8042496106905891292');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +                    o = obj.get(key);                                                                             </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +                } catch (JSONException e) {                                                                       </span>
<span class="2953006937969085175" onmouseenter="enter('2953006937969085175');" onmouseout="out('2953006937969085175');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +                    LOG.warn(&quot;jsonToString object error: &quot; + e.getLocalizedMessage());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +                }                                                                                                 </span>
<span class="7562295632169911142" onmouseenter="enter('7562295632169911142');" onmouseout="out('7562295632169911142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +                json += key+&quot;:&quot;+jsonToStringInternal(o);                                                          </span>
<span class="-775465109238322464" onmouseenter="enter('-775465109238322464');" onmouseout="out('-775465109238322464');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +                if (iter.hasNext()) json+=&quot;,&quot;;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +            }                                                                                                     </span>
<span class="1226915701420061298" onmouseenter="enter('1226915701420061298');" onmouseout="out('1226915701420061298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +            return json+&quot;}&quot;;                                                                                      </span>
<span class="3600399421666172751" onmouseenter="enter('3600399421666172751');" onmouseout="out('3600399421666172751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +        } // else int/double/null                                                                                 </span>
<span class="3525583877034800949" onmouseenter="enter('3525583877034800949');" onmouseout="out('3525583877034800949');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +        return v.toString();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +                                                                                                                  </span>
<span class="-4462526562745695882" onmouseenter="enter('-4462526562745695882');" onmouseout="out('-4462526562745695882');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +    /// Convert a JSON object to a JSON String (NOT 100% JSON compliant)                                          </span>
<span class="4157561026938027662" onmouseenter="enter('4157561026938027662');" onmouseout="out('4157561026938027662');" style=""> 334      public String jsonToString(JSONObject jsonObj) {                                                              </span>
<span class="-4522530179526724243" onmouseenter="enter('-4522530179526724243');" onmouseout="out('-4522530179526724243');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -        String json = jsonObj.toString();                                                                         </span>
<span class="-647637209944640137" onmouseenter="enter('-647637209944640137');" onmouseout="out('-647637209944640137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -        // toString creates &#x27;\u0000&#x27; instead of &#x27;\0&#x27;                                                              </span>
<span class="4177878667956674041" onmouseenter="enter('4177878667956674041');" onmouseout="out('4177878667956674041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 337 -        // FIXME: there have got to be nicer ways of handling this - maybe we just make our own JSON.toString (see below)"> 337 -        // FIXME: there have got to be nicer ways of handling this - maybe we just make our own JSON.toString (seeðŸ”µ</abbr></span>
<span class="3255181898386234576" onmouseenter="enter('3255181898386234576');" onmouseout="out('3255181898386234576');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -        json = json.replaceAll(&quot;\\\\u000([01234567])&quot;, &quot;\\\\$1&quot;);                                                 </span>
<span class="72601646808909527" onmouseenter="enter('72601646808909527');" onmouseout="out('72601646808909527');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -        json = json.replaceAll(&quot;\\\\u00([0123456789abcdef][0123456789abcdef])&quot;, &quot;\\\\x$1&quot;);                       </span>
<span class="-9201807036798608310" onmouseenter="enter('-9201807036798608310');" onmouseout="out('-9201807036798608310');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 340 -        return json;                                                                                              </span>
<span class="-2574074928360666732" onmouseenter="enter('-2574074928360666732');" onmouseout="out('-2574074928360666732');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 341 -        /*String json = &quot;{&quot;;                                                                                      </span>
<span class="-4233945994791575356" onmouseenter="enter('-4233945994791575356');" onmouseout="out('-4233945994791575356');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 342 -        Iterator&lt;String&gt; iter = jsonObj.keys();                                                                   </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 343 -        while (iter.hasNext()) {                                                                                  </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 344 -            String key = iter.next();                                                                             </span>
<span class="5129714181240102620" onmouseenter="enter('5129714181240102620');" onmouseout="out('5129714181240102620');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 345 -            Object v = jsonObj.get(key);                                                                          </span>
<span class="-3931564472926176624" onmouseenter="enter('-3931564472926176624');" onmouseout="out('-3931564472926176624');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 346 -            if (v instanceof Integer) {                                                                           </span>
<span class="2189452865908165505" onmouseenter="enter('2189452865908165505');" onmouseout="out('2189452865908165505');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 347 -                // ...                                                                                            </span>
<span class="-5749274956692686167" onmouseenter="enter('-5749274956692686167');" onmouseout="out('-5749274956692686167');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 348 -            } else // ..                                                                                          </span>
<span class="-775465109238322464" onmouseenter="enter('-775465109238322464');" onmouseout="out('-775465109238322464');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 349 -            if (iter.hasNext()) json+=&quot;,&quot;;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 350 -        }                                                                                                         </span>
<span class="-454891966817639137" onmouseenter="enter('-454891966817639137');" onmouseout="out('-454891966817639137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 351 -        return json+&quot;}&quot;;*/                                                                                        </span>
<span class="-3297195869188929142" onmouseenter="enter('-3297195869188929142');" onmouseout="out('-3297195869188929142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +        /* jsonObj.toString() works but breaks char codes&gt;128 (encodes as UTF8?) and also uses                    </span>
<span class="7509381523120718717" onmouseenter="enter('7509381523120718717');" onmouseout="out('7509381523120718717');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 353 +        \u0000 when just \0 would do (and so on).                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +                                                                                                                  </span>
<span class="-1336376992819668396" onmouseenter="enter('-1336376992819668396');" onmouseout="out('-1336376992819668396');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 355 +        So we do it manually, which can be more compact anyway.                                                   </span>
<span class="-5084316389888644344" onmouseenter="enter('-5084316389888644344');" onmouseout="out('-5084316389888644344');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 356 +        This is JSON-ish, so not exactly as per JSON1 spec but good enough for Espruino.                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 357 +        */                                                                                                        </span>
<span class="7796956154837315813" onmouseenter="enter('7796956154837315813');" onmouseout="out('7796956154837315813');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 358 +        return jsonToStringInternal(jsonObj);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359      }                                                                                                             </span>
<span  style=""> 360                                                                                                                    </span>
<span class="31684629009080209" onmouseenter="enter('31684629009080209');" onmouseout="out('31684629009080209');" style=""> 361      /// Write a JSON object of data                                                                               </span>
<span class="-8756055707520682190" onmouseenter="enter('-8756055707520682190');" onmouseout="out('-8756055707520682190');" style=""> 362      private void uartTxJSON(String taskName, JSONObject json) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 363          try {                                                                                                     </span>
<span class="-6185382728407385788" onmouseenter="enter('-6185382728407385788');" onmouseout="out('-6185382728407385788');" style=""> 364              TransactionBuilder builder = performInitialized(taskName);                                            </span>
<span class="-5291927674188184215" onmouseenter="enter('-5291927674188184215');" onmouseout="out('-5291927674188184215');" style=""> 365              uartTx(builder, &quot;\u0010GB(&quot;+jsonToString(json)+&quot;)\n&quot;);                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 366              builder.queue(getQueue());                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 367          } catch (IOException e) {                                                                                 </span>
<span class="2446652404576165600" onmouseenter="enter('2446652404576165600');" onmouseout="out('2446652404576165600');" style=""><abbr title=" 368              GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 368              GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370      }                                                                                                             </span>
<span  style=""> 371                                                                                                                    </span>
<span class="4290598848752150102" onmouseenter="enter('4290598848752150102');" onmouseout="out('4290598848752150102');" style=""> 372      /// Write JSON object of the form {t:taskName, err:message}                                                   </span>
<span  style=""> 373                                                                                                                    </span>
<span class="-8058058420395857539" onmouseenter="enter('-8058058420395857539');" onmouseout="out('-8058058420395857539');" style=""> 374      private void uartTxJSONError(String taskName, String message) {                                               </span>
<span class="3966342241212062344" onmouseenter="enter('3966342241212062344');" onmouseout="out('3966342241212062344');" style=""> 375          uartTxJSONError(taskName,message,null);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376      }                                                                                                             </span>
<span  style=""> 377                                                                                                                    </span>
<span class="7327259819120083170" onmouseenter="enter('7327259819120083170');" onmouseout="out('7327259819120083170');" style=""> 378      private void uartTxJSONError(String taskName, String message,String id) {                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 379          JSONObject o = new JSONObject();                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 380          try {                                                                                                     </span>
<span class="-4736457139552862676" onmouseenter="enter('-4736457139552862676');" onmouseout="out('-4736457139552862676');" style=""> 381              o.put(&quot;t&quot;, taskName);                                                                                 </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 382              if( id!=null)                                                                                         </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 383                  o.put(&quot;id&quot;, id);                                                                                  </span>
<span class="-3362855442851232299" onmouseenter="enter('-3362855442851232299');" onmouseout="out('-3362855442851232299');" style=""> 384              o.put(&quot;err&quot;, message);                                                                                </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 385          } catch (JSONException e) {                                                                               </span>
<span class="-293713289384668060" onmouseenter="enter('-293713289384668060');" onmouseout="out('-293713289384668060');" style=""> 386              GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387          }                                                                                                         </span>
<span class="-3544369649702046019" onmouseenter="enter('-3544369649702046019');" onmouseout="out('-3544369649702046019');" style=""> 388          uartTxJSON(taskName, o);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389      }                                                                                                             </span>
<span  style=""> 390                                                                                                                    </span>
<span  style=""> 391                                                                                                                    </span>
<span  style=""> 392                                                                                                                    </span>
<span class="3549324304064443217" onmouseenter="enter('3549324304064443217');" onmouseout="out('3549324304064443217');" style=""> 393      private void handleUartRxLine(String line) {                                                                  </span>
<span class="7696744219355043330" onmouseenter="enter('7696744219355043330');" onmouseout="out('7696744219355043330');" style=""> 394          LOG.info(&quot;UART RX LINE: &quot; + line);                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 395 -                                                                                                                  </span>
<span class="5454828508308371900" onmouseenter="enter('5454828508308371900');" onmouseout="out('5454828508308371900');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 396 +        if (line.length()==0) return;                                                                             </span>
<span class="2508923913537480964" onmouseenter="enter('2508923913537480964');" onmouseout="out('2508923913537480964');" style=""> 397          if (&quot;&gt;Uncaught ReferenceError: \&quot;GB\&quot; is not defined&quot;.equals(line))                                       </span>
<span class="7158908931448264833" onmouseenter="enter('7158908931448264833');" onmouseout="out('7158908931448264833');" style=""> 398            GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GB.ERROR);  </span>
<span class="-6455000716475696058" onmouseenter="enter('-6455000716475696058');" onmouseout="out('-6455000716475696058');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 399 -        else if (line.length() &gt; 0 &amp;&amp; line.charAt(0)==&#x27;{&#x27;) {                                                      </span>
<span class="5685500193458919055" onmouseenter="enter('5685500193458919055');" onmouseout="out('5685500193458919055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +        else if (line.charAt(0)==&#x27;{&#x27;) {                                                                           </span>
<span class="8231786037032554769" onmouseenter="enter('8231786037032554769');" onmouseout="out('8231786037032554769');" style=""> 401              // JSON - we hope!                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 402              try {                                                                                                 </span>
<span class="2411116435363976231" onmouseenter="enter('2411116435363976231');" onmouseout="out('2411116435363976231');" style=""> 403                  JSONObject json = new JSONObject(line);                                                           </span>
<span class="8233558512387133223" onmouseenter="enter('8233558512387133223');" onmouseout="out('8233558512387133223');" style=""> 404                  LOG.info(&quot;UART RX JSON parsed successfully&quot;);                                                     </span>
<span class="4509864865787947019" onmouseenter="enter('4509864865787947019');" onmouseout="out('4509864865787947019');" style=""> 405                  handleUartRxJSON(json);                                                                           </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 406              } catch (JSONException e) {                                                                           </span>
<span class="-2414553303058964646" onmouseenter="enter('-2414553303058964646');" onmouseout="out('-2414553303058964646');" style=""> 407                  LOG.info(&quot;UART RX JSON parse failure: &quot;+ e.getLocalizedMessage());                                </span>
<span class="8356145272001509336" onmouseenter="enter('8356145272001509336');" onmouseout="out('8356145272001509336');" style=""><abbr title=" 408                  GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 408                  GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 410          } else {                                                                                                  </span>
<span class="3013327231508790922" onmouseenter="enter('3013327231508790922');" onmouseout="out('3013327231508790922');" style=""> 411              LOG.info(&quot;UART RX line started with &quot;+(int)line.charAt(0)+&quot; - ignoring&quot;);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413      }                                                                                                             </span>
<span  style=""> 414                                                                                                                    </span>
<span class="-1023302836013344522" onmouseenter="enter('-1023302836013344522');" onmouseout="out('-1023302836013344522');" style=""> 415      private void handleUartRxJSON(JSONObject json) throws JSONException {                                         </span>
<span class="7061070849429770108" onmouseenter="enter('7061070849429770108');" onmouseout="out('7061070849429770108');" style=""> 416          String packetType = json.getString(&quot;t&quot;);                                                                  </span>
<span class="2121648211711712075" onmouseenter="enter('2121648211711712075');" onmouseout="out('2121648211711712075');" style=""> 417          switch (packetType) {                                                                                     </span>
<span class="1154622936863099207" onmouseenter="enter('1154622936863099207');" onmouseout="out('1154622936863099207');" style=""> 418              case &quot;info&quot;:                                                                                          </span>
<span class="6489300233296788049" onmouseenter="enter('6489300233296788049');" onmouseout="out('6489300233296788049');" style=""> 419                  GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO);        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 420                  break;                                                                                            </span>
<span class="3852677909480408410" onmouseenter="enter('3852677909480408410');" onmouseout="out('3852677909480408410');" style=""> 421              case &quot;warn&quot;:                                                                                          </span>
<span class="-1267997652646506218" onmouseenter="enter('-1267997652646506218');" onmouseout="out('-1267997652646506218');" style=""> 422                  GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN);        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 423                  break;                                                                                            </span>
<span class="-4027904492374937118" onmouseenter="enter('-4027904492374937118');" onmouseout="out('-4027904492374937118');" style=""> 424              case &quot;error&quot;:                                                                                         </span>
<span class="3082648944163426921" onmouseenter="enter('3082648944163426921');" onmouseout="out('3082648944163426921');" style=""> 425                  GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERROR);       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 426                  break;                                                                                            </span>
<span class="-6550395055022650144" onmouseenter="enter('-6550395055022650144');" onmouseout="out('-6550395055022650144');" style=""> 427              case &quot;ver&quot;: {                                                                                         </span>
<span class="1504582788479684724" onmouseenter="enter('1504582788479684724');" onmouseout="out('1504582788479684724');" style=""> 428                  if (json.has(&quot;fw1&quot;))                                                                              </span>
<span class="7809101785256581980" onmouseenter="enter('7809101785256581980');" onmouseout="out('7809101785256581980');" style=""> 429                      getDevice().setFirmwareVersion(json.getString(&quot;fw1&quot;));                                        </span>
<span class="-4269189810719037321" onmouseenter="enter('-4269189810719037321');" onmouseout="out('-4269189810719037321');" style=""> 430                  if (json.has(&quot;fw2&quot;))                                                                              </span>
<span class="-1725698584982350052" onmouseenter="enter('-1725698584982350052');" onmouseout="out('-1725698584982350052');" style=""> 431                      getDevice().setFirmwareVersion2(json.getString(&quot;fw2&quot;));                                       </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 432              } break;                                                                                              </span>
<span class="-3223445656092502792" onmouseenter="enter('-3223445656092502792');" onmouseout="out('-3223445656092502792');" style=""> 433              case &quot;status&quot;: {                                                                                      </span>
<span class="1472249640876064382" onmouseenter="enter('1472249640876064382');" onmouseout="out('1472249640876064382');" style=""> 434                  GBDeviceEventBatteryInfo batteryInfo = new GBDeviceEventBatteryInfo();                            </span>
<span class="-8684865925727857265" onmouseenter="enter('-8684865925727857265');" onmouseout="out('-8684865925727857265');" style=""> 435                  if (json.has(&quot;bat&quot;)) {                                                                            </span>
<span class="3744277214774220447" onmouseenter="enter('3744277214774220447');" onmouseout="out('3744277214774220447');" style=""> 436                      int b = json.getInt(&quot;bat&quot;);                                                                   </span>
<span class="5862741907286067284" onmouseenter="enter('5862741907286067284');" onmouseout="out('5862741907286067284');" style=""> 437                      if (b &lt; 0) b = 0;                                                                             </span>
<span class="572226595522417282" onmouseenter="enter('572226595522417282');" onmouseout="out('572226595522417282');" style=""> 438                      if (b &gt; 100) b = 100;                                                                         </span>
<span class="6496455062087841098" onmouseenter="enter('6496455062087841098');" onmouseout="out('6496455062087841098');" style=""> 439                      batteryInfo.level = b;                                                                        </span>
<span class="-2105719386055198398" onmouseenter="enter('-2105719386055198398');" onmouseout="out('-2105719386055198398');" style=""> 440                      batteryInfo.state = BatteryState.BATTERY_NORMAL;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441                  }                                                                                                 </span>
<span class="-8617525444786471834" onmouseenter="enter('-8617525444786471834');" onmouseout="out('-8617525444786471834');" style=""> 442                  if (json.has(&quot;chg&quot;) &amp;&amp; json.getInt(&quot;chg&quot;) == 1) {                                                 </span>
<span class="-936118866357790298" onmouseenter="enter('-936118866357790298');" onmouseout="out('-936118866357790298');" style=""> 443                      batteryInfo.state = BatteryState.BATTERY_CHARGING;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444                  }                                                                                                 </span>
<span class="1514350151524445078" onmouseenter="enter('1514350151524445078');" onmouseout="out('1514350151524445078');" style=""> 445                  if (json.has(&quot;volt&quot;))                                                                             </span>
<span class="-3686044708246396849" onmouseenter="enter('-3686044708246396849');" onmouseout="out('-3686044708246396849');" style=""> 446                      batteryInfo.voltage = (float) json.getDouble(&quot;volt&quot;);                                         </span>
<span class="-1573801757390600576" onmouseenter="enter('-1573801757390600576');" onmouseout="out('-1573801757390600576');" style=""> 447                  handleGBDeviceEvent(batteryInfo);                                                                 </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 448              } break;                                                                                              </span>
<span class="-7544298044919087691" onmouseenter="enter('-7544298044919087691');" onmouseout="out('-7544298044919087691');" style=""> 449              case &quot;findPhone&quot;: {                                                                                   </span>
<span class="-2748392883851010177" onmouseenter="enter('-2748392883851010177');" onmouseout="out('-2748392883851010177');" style=""> 450                  boolean start = json.has(&quot;n&quot;) &amp;&amp; json.getBoolean(&quot;n&quot;);                                            </span>
<span class="6136676704701652580" onmouseenter="enter('6136676704701652580');" onmouseout="out('6136676704701652580');" style=""> 451                  GBDeviceEventFindPhone deviceEventFindPhone = new GBDeviceEventFindPhone();                       </span>
<span class="3202169087750798845" onmouseenter="enter('3202169087750798845');" onmouseout="out('3202169087750798845');" style=""><abbr title=" 452                  deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFindPhone.Event.STOP;"> 452                  deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFindPhone.EðŸ”µ</abbr></span>
<span class="-1455650059425895125" onmouseenter="enter('-1455650059425895125');" onmouseout="out('-1455650059425895125');" style=""> 453                  evaluateGBDeviceEvent(deviceEventFindPhone);                                                      </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 454              } break;                                                                                              </span>
<span class="5454487238732594669" onmouseenter="enter('5454487238732594669');" onmouseout="out('5454487238732594669');" style=""> 455              case &quot;music&quot;: {                                                                                       </span>
<span class="-5683743334008418698" onmouseenter="enter('-5683743334008418698');" onmouseout="out('-5683743334008418698');" style=""> 456                  GBDeviceEventMusicControl deviceEventMusicControl = new GBDeviceEventMusicControl();              </span>
<span class="5894306574008826676" onmouseenter="enter('5894306574008826676');" onmouseout="out('5894306574008826676');" style=""><abbr title=" 457                  deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 457                  deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;n&quot;).toUppeðŸ”µ</abbr></span>
<span class="8133545861002504946" onmouseenter="enter('8133545861002504946');" onmouseout="out('8133545861002504946');" style=""> 458                  evaluateGBDeviceEvent(deviceEventMusicControl);                                                   </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 459              } break;                                                                                              </span>
<span class="-9207173587563143993" onmouseenter="enter('-9207173587563143993');" onmouseout="out('-9207173587563143993');" style=""> 460              case &quot;call&quot;: {                                                                                        </span>
<span class="2406734484891175482" onmouseenter="enter('2406734484891175482');" onmouseout="out('2406734484891175482');" style=""> 461                  GBDeviceEventCallControl deviceEventCallControl = new GBDeviceEventCallControl();                 </span>
<span class="-5299176663874891056" onmouseenter="enter('-5299176663874891056');" onmouseout="out('-5299176663874891056');" style=""><abbr title=" 462                  deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 462                  deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCðŸ”µ</abbr></span>
<span class="-7699727803461656923" onmouseenter="enter('-7699727803461656923');" onmouseout="out('-7699727803461656923');" style=""> 463                  evaluateGBDeviceEvent(deviceEventCallControl);                                                    </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 464              } break;                                                                                              </span>
<span class="-337329064960380865" onmouseenter="enter('-337329064960380865');" onmouseout="out('-337329064960380865');" style=""> 465              case &quot;notify&quot; : {                                                                                     </span>
<span class="1278038111464368986" onmouseenter="enter('1278038111464368986');" onmouseout="out('1278038111464368986');" style=""><abbr title=" 466                  GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificationControl();"> 466                  GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificationContrðŸ”µ</abbr></span>
<span class="-6597246807803729732" onmouseenter="enter('-6597246807803729732');" onmouseout="out('-6597246807803729732');" style=""> 467                  // .title appears unused                                                                          </span>
<span class="-3304774628543622498" onmouseenter="enter('-3304774628543622498');" onmouseout="out('-3304774628543622498');" style=""><abbr title=" 468                  deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 468                  deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.getStringðŸ”µ</abbr></span>
<span class="4338373654190408032" onmouseenter="enter('4338373654190408032');" onmouseout="out('4338373654190408032');" style=""> 469                  if (json.has(&quot;id&quot;))                                                                               </span>
<span class="1062450614172957636" onmouseenter="enter('1062450614172957636');" onmouseout="out('1062450614172957636');" style=""> 470                      deviceEvtNotificationControl.handle = json.getInt(&quot;id&quot;);                                      </span>
<span class="658666775109182698" onmouseenter="enter('658666775109182698');" onmouseout="out('658666775109182698');" style=""> 471                  if (json.has(&quot;tel&quot;))                                                                              </span>
<span class="3912257448498793625" onmouseenter="enter('3912257448498793625');" onmouseout="out('3912257448498793625');" style=""> 472                      deviceEvtNotificationControl.phoneNumber = json.getString(&quot;tel&quot;);                             </span>
<span class="-279845848013227661" onmouseenter="enter('-279845848013227661');" onmouseout="out('-279845848013227661');" style=""> 473                  if (json.has(&quot;msg&quot;))                                                                              </span>
<span class="6661039268276828670" onmouseenter="enter('6661039268276828670');" onmouseout="out('6661039268276828670');" style=""> 474                      deviceEvtNotificationControl.reply = json.getString(&quot;msg&quot;);                                   </span>
<span class="-1817112681649718085" onmouseenter="enter('-1817112681649718085');" onmouseout="out('-1817112681649718085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 475 +                /* REPLY responses don&#x27;t use the ID from the event (MUTE/etc seem to), but instead                </span>
<span class="5406797550372080886" onmouseenter="enter('5406797550372080886');" onmouseout="out('5406797550372080886');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 476 +                * they use a handle that was provided in an action list on the onNotification.. event  */         </span>
<span class="-4787844253490591897" onmouseenter="enter('-4787844253490591897');" onmouseout="out('-4787844253490591897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 477 +                if (deviceEvtNotificationControl.event == GBDeviceEventNotificationControl.Event.REPLY) {         </span>
<span class="7047790762640343753" onmouseenter="enter('7047790762640343753');" onmouseout="out('7047790762640343753');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 478 +                    Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationControl.handle);"> 478 +                    Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationControl.hanðŸ”µ</abbr></span>
<span class="2363738327135911056" onmouseenter="enter('2363738327135911056');" onmouseout="out('2363738327135911056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 479 +                    if (foundHandle!=null)                                                                        </span>
<span class="-5768705298123946646" onmouseenter="enter('-5768705298123946646');" onmouseout="out('-5768705298123946646');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 480 +                        deviceEvtNotificationControl.handle = foundHandle;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 481 +                }                                                                                                 </span>
<span class="1799618905473722788" onmouseenter="enter('1799618905473722788');" onmouseout="out('1799618905473722788');" style=""> 482                  evaluateGBDeviceEvent(deviceEvtNotificationControl);                                              </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 483              } break;                                                                                              </span>
<span class="692659105886468257" onmouseenter="enter('692659105886468257');" onmouseout="out('692659105886468257');" style=""> 484              case &quot;act&quot;: {                                                                                         </span>
<span class="8371010899036944571" onmouseenter="enter('8371010899036944571');" onmouseout="out('8371010899036944571');" style=""> 485                  BangleJSActivitySample sample = new BangleJSActivitySample();                                     </span>
<span class="-1915545881769334236" onmouseenter="enter('-1915545881769334236');" onmouseout="out('-1915545881769334236');" style=""> 486                  sample.setTimestamp((int) (GregorianCalendar.getInstance().getTimeInMillis() / 1000L));           </span>
<span class="-6511180810366476909" onmouseenter="enter('-6511180810366476909');" onmouseout="out('-6511180810366476909');" style=""> 487                  int hrm = 0;                                                                                      </span>
<span class="-2794193254662759202" onmouseenter="enter('-2794193254662759202');" onmouseout="out('-2794193254662759202');" style=""> 488                  int steps = 0;                                                                                    </span>
<span class="1159991081674058958" onmouseenter="enter('1159991081674058958');" onmouseout="out('1159991081674058958');" style=""> 489                  if (json.has(&quot;hrm&quot;)) hrm = json.getInt(&quot;hrm&quot;);                                                    </span>
<span class="2200733451486704836" onmouseenter="enter('2200733451486704836');" onmouseout="out('2200733451486704836');" style=""> 490                  if (json.has(&quot;stp&quot;)) steps = json.getInt(&quot;stp&quot;);                                                  </span>
<span class="6603465025108101037" onmouseenter="enter('6603465025108101037');" onmouseout="out('6603465025108101037');" style=""> 491                  int activity = BangleJSSampleProvider.TYPE_ACTIVITY;                                              </span>
<span class="6065424140180877442" onmouseenter="enter('6065424140180877442');" onmouseout="out('6065424140180877442');" style=""> 492                  /*if (json.has(&quot;act&quot;)) {                                                                          </span>
<span class="-2439039461724633138" onmouseenter="enter('-2439039461724633138');" onmouseout="out('-2439039461724633138');" style=""> 493                      String actName = &quot;TYPE_&quot; + json.getString(&quot;act&quot;).toUpperCase();                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 494                      try {                                                                                         </span>
<span class="-5191337226244238063" onmouseenter="enter('-5191337226244238063');" onmouseout="out('-5191337226244238063');" style=""> 495                          Field f = ActivityKind.class.getField(actName);                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 496                          try {                                                                                     </span>
<span class="8672601729845658913" onmouseenter="enter('8672601729845658913');" onmouseout="out('8672601729845658913');" style=""> 497                              activity = f.getInt(null);                                                            </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 498                          } catch (IllegalAccessException e) {                                                      </span>
<span class="9211658540801898058" onmouseenter="enter('9211658540801898058');" onmouseout="out('9211658540801898058');" style=""> 499                              LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not readable&quot;);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500                          }                                                                                         </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 501                      } catch (NoSuchFieldException e) {                                                            </span>
<span class="-4236592020282047640" onmouseenter="enter('-4236592020282047640');" onmouseout="out('-4236592020282047640');" style=""> 502                          LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not found&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503                      }                                                                                             </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 504                  }*/                                                                                               </span>
<span class="8668161863330653058" onmouseenter="enter('8668161863330653058');" onmouseout="out('8668161863330653058');" style=""> 505                  sample.setRawKind(activity);                                                                      </span>
<span class="5935105042646692248" onmouseenter="enter('5935105042646692248');" onmouseout="out('5935105042646692248');" style=""> 506                  sample.setHeartRate(hrm);                                                                         </span>
<span class="-4745425836300475693" onmouseenter="enter('-4745425836300475693');" onmouseout="out('-4745425836300475693');" style=""> 507                  sample.setSteps(steps);                                                                           </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style=""> 508                  try (DBHandler dbHandler = GBApplication.acquireDB()) {                                           </span>
<span class="1422413790142608640" onmouseenter="enter('1422413790142608640');" onmouseout="out('1422413790142608640');" style=""> 509                      Long userId = getUser(dbHandler.getDaoSession()).getId();                                     </span>
<span class="3688300519339275893" onmouseenter="enter('3688300519339275893');" onmouseout="out('3688300519339275893');" style=""> 510                      Long deviceId = DBHelper.getDevice(getDevice(), dbHandler.getDaoSession()).getId();           </span>
<span class="-4884679916644886432" onmouseenter="enter('-4884679916644886432');" onmouseout="out('-4884679916644886432');" style=""><abbr title=" 511                      BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.getDaoSession());"> 511                      BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.getDaoSessðŸ”µ</abbr></span>
<span class="6444535225867718796" onmouseenter="enter('6444535225867718796');" onmouseout="out('6444535225867718796');" style=""> 512                      sample.setDeviceId(deviceId);                                                                 </span>
<span class="292659008851945780" onmouseenter="enter('292659008851945780');" onmouseout="out('292659008851945780');" style=""> 513                      sample.setUserId(userId);                                                                     </span>
<span class="4765059548563428130" onmouseenter="enter('4765059548563428130');" onmouseout="out('4765059548563428130');" style=""> 514                      provider.addGBActivitySample(sample);                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 515                  } catch (Exception ex) {                                                                          </span>
<span class="1206810911036844482" onmouseenter="enter('1206810911036844482');" onmouseout="out('1206810911036844482');" style=""> 516                      LOG.warn(&quot;Error saving activity: &quot; + ex.getLocalizedMessage());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517                  }                                                                                                 </span>
<span class="5171490897490639183" onmouseenter="enter('5171490897490639183');" onmouseout="out('5171490897490639183');" style=""> 518                  // push realtime data                                                                             </span>
<span class="-6833823710638969612" onmouseenter="enter('-6833823710638969612');" onmouseout="out('-6833823710638969612');" style=""> 519                  if (realtimeHRM || realtimeStep) {                                                                </span>
<span class="-9081146433891434428" onmouseenter="enter('-9081146433891434428');" onmouseout="out('-9081146433891434428');" style=""> 520                      Intent intent = new Intent(DeviceService.ACTION_REALTIME_SAMPLES)                             </span>
<span class="5807466852720832411" onmouseenter="enter('5807466852720832411');" onmouseout="out('5807466852720832411');" style=""> 521                              .putExtra(DeviceService.EXTRA_REALTIME_SAMPLE, sample);                               </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 522                      LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523                  }                                                                                                 </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 524              } break;                                                                                              </span>
<span class="-3056288259405338320" onmouseenter="enter('-3056288259405338320');" onmouseout="out('-3056288259405338320');" style=""> 525              case &quot;http&quot;: {                                                                                        </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 526                  Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress())); </span>
<span class="4471501014415506100" onmouseenter="enter('4471501014415506100');" onmouseout="out('4471501014415506100');" style=""> 527                  String _id=null;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 528                  try {                                                                                             </span>
<span class="4672396922249032002" onmouseenter="enter('4672396922249032002');" onmouseout="out('4672396922249032002');" style=""> 529                      _id = json.getString(&quot;id&quot;);                                                                   </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 530                  } catch (JSONException e) {                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531                  }                                                                                                 </span>
<span class="5919143370037839830" onmouseenter="enter('5919143370037839830');" onmouseout="out('5919143370037839830');" style=""> 532                  final String id = _id;                                                                            </span>
<span  style=""> 533                                                                                                                    </span>
<span  style=""> 534                                                                                                                    </span>
<span class="-6992637283999421128" onmouseenter="enter('-6992637283999421128');" onmouseout="out('-6992637283999421128');" style=""> 535                  if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESS, false)) {  </span>
<span class="3585939051150823686" onmouseenter="enter('3585939051150823686');" onmouseout="out('3585939051150823686');" style=""> 536                      RequestQueue queue = Volley.newRequestQueue(getContext());                                    </span>
<span class="5176519532323120311" onmouseenter="enter('5176519532323120311');" onmouseout="out('5176519532323120311');" style=""> 537                      String url = json.getString(&quot;url&quot;);                                                           </span>
<span  style=""> 538                                                                                                                    </span>
<span class="-3545396317642083141" onmouseenter="enter('-3545396317642083141');" onmouseout="out('-3545396317642083141');" style=""> 539                      String _xmlPath = &quot;&quot;;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 540                      try {                                                                                         </span>
<span class="-6862471463745020928" onmouseenter="enter('-6862471463745020928');" onmouseout="out('-6862471463745020928');" style=""> 541                          _xmlPath = json.getString(&quot;xpath&quot;);                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 542                      } catch (JSONException e) {                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543                      }                                                                                             </span>
<span class="605766333889403990" onmouseenter="enter('605766333889403990');" onmouseout="out('605766333889403990');" style=""> 544                      final String xmlPath = _xmlPath;                                                              </span>
<span class="-7325827083532572939" onmouseenter="enter('-7325827083532572939');" onmouseout="out('-7325827083532572939');" style=""> 545                      // Request a string response from the provided URL.                                           </span>
<span class="-7080864972701183073" onmouseenter="enter('-7080864972701183073');" onmouseout="out('-7080864972701183073');" style=""> 546                      StringRequest stringRequest = new StringRequest(Request.Method.GET, url,                      </span>
<span class="1580018343670400637" onmouseenter="enter('1580018343670400637');" onmouseout="out('1580018343670400637');" style=""> 547                              new Response.Listener&lt;String&gt;() {                                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 548                                  @Override                                                                         </span>
<span class="2219137294630149657" onmouseenter="enter('2219137294630149657');" onmouseout="out('2219137294630149657');" style=""> 549                                  public void onResponse(String response) {                                         </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 550                                      JSONObject o = new JSONObject();                                              </span>
<span class="3496993666001094453" onmouseenter="enter('3496993666001094453');" onmouseout="out('3496993666001094453');" style=""> 551                                      if (xmlPath.length() != 0) {                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 552                                          try {                                                                     </span>
<span class="5597187660883583119" onmouseenter="enter('5597187660883583119');" onmouseout="out('5597187660883583119');" style=""> 553                                              InputSource inputXML = new InputSource(new StringReader(response));   </span>
<span class="-160158441380049344" onmouseenter="enter('-160158441380049344');" onmouseout="out('-160158441380049344');" style=""> 554                                              XPath xPath = XPathFactory.newInstance().newXPath();                  </span>
<span class="-5056989228059087382" onmouseenter="enter('-5056989228059087382');" onmouseout="out('-5056989228059087382');" style=""> 555                                              response = xPath.evaluate(xmlPath, inputXML);                         </span>
<span class="6902166904876459873" onmouseenter="enter('6902166904876459873');" onmouseout="out('6902166904876459873');" style=""> 556                                          } catch (Exception error) {                                               </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 557                                              uartTxJSONError(&quot;http&quot;, error.toString(),id);                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 558                                              return;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559                                          }                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560                                      }                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 561                                      try {                                                                         </span>
<span class="6603605385044119606" onmouseenter="enter('6603605385044119606');" onmouseout="out('6603605385044119606');" style=""> 562                                          o.put(&quot;t&quot;, &quot;http&quot;);                                                       </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 563                                          if( id!=null)                                                             </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 564                                              o.put(&quot;id&quot;, id);                                                      </span>
<span class="-7019821812941989411" onmouseenter="enter('-7019821812941989411');" onmouseout="out('-7019821812941989411');" style=""> 565                                          o.put(&quot;resp&quot;, response);                                                  </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 566                                      } catch (JSONException e) {                                                   </span>
<span class="5084509021389731794" onmouseenter="enter('5084509021389731794');" onmouseout="out('5084509021389731794');" style=""><abbr title=" 567                                          GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 567                                          GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LOðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568                                      }                                                                             </span>
<span class="-4140114778756524985" onmouseenter="enter('-4140114778756524985');" onmouseout="out('-4140114778756524985');" style=""> 569                                      uartTxJSON(&quot;http&quot;, o);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570                                  }                                                                                 </span>
<span class="4760556576659557486" onmouseenter="enter('4760556576659557486');" onmouseout="out('4760556576659557486');" style=""> 571                              }, new Response.ErrorListener() {                                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 572                          @Override                                                                                 </span>
<span class="3365806574504816618" onmouseenter="enter('3365806574504816618');" onmouseout="out('3365806574504816618');" style=""> 573                          public void onErrorResponse(VolleyError error) {                                          </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 574                              JSONObject o = new JSONObject();                                                      </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 575                              uartTxJSONError(&quot;http&quot;, error.toString(),id);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576                          }                                                                                         </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 577                      });                                                                                           </span>
<span class="-2087140764948748418" onmouseenter="enter('-2087140764948748418');" onmouseout="out('-2087140764948748418');" style=""> 578                      queue.add(stringRequest);                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 579                  } else {                                                                                          </span>
<span class="-204746163834141844" onmouseenter="enter('-204746163834141844');" onmouseout="out('-204746163834141844');" style=""> 580                      if (BuildConfig.INTERNET_ACCESS)                                                              </span>
<span class="-1860415774351364303" onmouseenter="enter('-1860415774351364303');" onmouseout="out('-1860415774351364303');" style=""><abbr title=" 581                          uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device Settings&quot;,id);"> 581                          uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device Settings&quot;,ðŸ”µ</abbr></span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 582                      else                                                                                          </span>
<span class="-8529240479352607945" onmouseenter="enter('-8529240479352607945');" onmouseout="out('-8529240479352607945');" style=""> 583                          uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;,id);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584                  }                                                                                                 </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 585              } break;                                                                                              </span>
<span class="7434952261878113170" onmouseenter="enter('7434952261878113170');" onmouseout="out('7434952261878113170');" style=""> 586              case &quot;intent&quot;: {                                                                                      </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 587                  Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress())); </span>
<span class="-3997484102524704678" onmouseenter="enter('-3997484102524704678');" onmouseout="out('-3997484102524704678');" style=""> 588                  if (devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) {                                         </span>
<span class="7885860666276152502" onmouseenter="enter('7885860666276152502');" onmouseout="out('7885860666276152502');" style=""> 589                      String action = json.getString(&quot;action&quot;);                                                     </span>
<span class="-6778424845662998727" onmouseenter="enter('-6778424845662998727');" onmouseout="out('-6778424845662998727');" style=""> 590                      JSONObject extra = json.getJSONObject(&quot;extra&quot;);                                               </span>
<span class="5907617214453163300" onmouseenter="enter('5907617214453163300');" onmouseout="out('5907617214453163300');" style=""> 591                      Intent in = new Intent();                                                                     </span>
<span class="-8779884887971893320" onmouseenter="enter('-8779884887971893320');" onmouseout="out('-8779884887971893320');" style=""> 592                      in.setAction(action);                                                                         </span>
<span class="-5835095174807794521" onmouseenter="enter('-5835095174807794521');" onmouseout="out('-5835095174807794521');" style=""> 593                      if (extra != null) {                                                                          </span>
<span class="7421222014058952195" onmouseenter="enter('7421222014058952195');" onmouseout="out('7421222014058952195');" style=""> 594                          Iterator&lt;String&gt; iter = extra.keys();                                                     </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 595                          while (iter.hasNext()) {                                                                  </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 596                              String key = iter.next();                                                             </span>
<span class="-6860780283306876147" onmouseenter="enter('-6860780283306876147');" onmouseout="out('-6860780283306876147');" style=""> 597                              in.putExtra(key, extra.getString(key));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599                      }                                                                                             </span>
<span class="6658078666630545861" onmouseenter="enter('6658078666630545861');" onmouseout="out('6658078666630545861');" style=""> 600                      LOG.info(&quot;Sending intent &quot; + action);                                                         </span>
<span class="-5369611568799868297" onmouseenter="enter('-5369611568799868297');" onmouseout="out('-5369611568799868297');" style=""> 601                      this.getContext().getApplicationContext().sendBroadcast(in);                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 602                  } else {                                                                                          </span>
<span class="7018402905003983802" onmouseenter="enter('7018402905003983802');" onmouseout="out('7018402905003983802');" style=""> 603                      uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge Device Settings&quot;); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605              }                                                                                                     </span>
<span class="-2384932350282687845" onmouseenter="enter('-2384932350282687845');" onmouseout="out('-2384932350282687845');" style=""> 606              default : {                                                                                           </span>
<span class="880605181182979788" onmouseenter="enter('880605181182979788');" onmouseout="out('880605181182979788');" style=""> 607                  LOG.info(&quot;UART RX JSON packet type &#x27;&quot;+packetType+&quot;&#x27; not understood.&quot;);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610      }                                                                                                             </span>
<span  style=""> 611                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 612      @Override                                                                                                     </span>
<span class="5766835775206074860" onmouseenter="enter('5766835775206074860');" onmouseout="out('5766835775206074860');" style=""> 613      public boolean onCharacteristicChanged(BluetoothGatt gatt,                                                    </span>
<span class="-4605279869462858246" onmouseenter="enter('-4605279869462858246');" onmouseout="out('-4605279869462858246');" style=""> 614                                             BluetoothGattCharacteristic characteristic) {                          </span>
<span class="3568353468682512593" onmouseenter="enter('3568353468682512593');" onmouseout="out('3568353468682512593');" style=""> 615          if (super.onCharacteristicChanged(gatt, characteristic)) {                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 616              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617          }                                                                                                         </span>
<span class="5227655087294118325" onmouseenter="enter('5227655087294118325');" onmouseout="out('5227655087294118325');" style=""> 618          if (BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX.equals(characteristic.getUuid())) {              </span>
<span class="5982523523606215133" onmouseenter="enter('5982523523606215133');" onmouseout="out('5982523523606215133');" style=""> 619              byte[] chars = characteristic.getValue();                                                             </span>
<span class="616145045349787748" onmouseenter="enter('616145045349787748');" onmouseout="out('616145045349787748');" style=""> 620              // check to see if we get more data - if so, increase out MTU for sending                             </span>
<span class="-514373143088406372" onmouseenter="enter('-514373143088406372');" onmouseout="out('-514373143088406372');" style=""> 621              if (allowHighMTU &amp;&amp; chars.length &gt; mtuSize)                                                           </span>
<span class="4158896835387507605" onmouseenter="enter('4158896835387507605');" onmouseout="out('4158896835387507605');" style=""> 622                  mtuSize = chars.length;                                                                           </span>
<span class="2539938136572489105" onmouseenter="enter('2539938136572489105');" onmouseout="out('2539938136572489105');" style=""> 623              String packetStr = new String(chars);                                                                 </span>
<span class="-8749842360460534491" onmouseenter="enter('-8749842360460534491');" onmouseout="out('-8749842360460534491');" style=""> 624              LOG.info(&quot;RX: &quot; + packetStr);                                                                         </span>
<span class="6081730255717431423" onmouseenter="enter('6081730255717431423');" onmouseout="out('6081730255717431423');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 625 +            // logging                                                                                            </span>
<span class="-5745508240241304992" onmouseenter="enter('-5745508240241304992');" onmouseout="out('-5745508240241304992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 626 +            receiveHistory += packetStr;                                                                          </span>
<span class="3030748261717732019" onmouseenter="enter('3030748261717732019');" onmouseout="out('3030748261717732019');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 627 +            if (receiveHistory.length() &gt; MAX_RECEIVE_HISTORY_CHARS)                                              </span>
<span class="2384681518975537665" onmouseenter="enter('2384681518975537665');" onmouseout="out('2384681518975537665');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 628 +                receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CHARS);   </span>
<span class="4345605670928647371" onmouseenter="enter('4345605670928647371');" onmouseout="out('4345605670928647371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 629 +            // split into input lines                                                                             </span>
<span class="5259079271083901413" onmouseenter="enter('5259079271083901413');" onmouseout="out('5259079271083901413');" style=""> 630              receivedLine += packetStr;                                                                            </span>
<span class="-2556332053060264516" onmouseenter="enter('-2556332053060264516');" onmouseout="out('-2556332053060264516');" style=""> 631              while (receivedLine.contains(&quot;\n&quot;)) {                                                                 </span>
<span class="4579450793956603432" onmouseenter="enter('4579450793956603432');" onmouseout="out('4579450793956603432');" style=""> 632                  int p = receivedLine.indexOf(&quot;\n&quot;);                                                               </span>
<span class="-477187957539062569" onmouseenter="enter('-477187957539062569');" onmouseout="out('-477187957539062569');" style=""> 633                  String line =  receivedLine.substring(0,p-1);                                                     </span>
<span class="8894037851537473877" onmouseenter="enter('8894037851537473877');" onmouseout="out('8894037851537473877');" style=""> 634                  receivedLine = receivedLine.substring(p+1);                                                       </span>
<span class="-3428869778620909618" onmouseenter="enter('-3428869778620909618');" onmouseout="out('-3428869778620909618');" style=""> 635                  handleUartRxLine(line);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636              }                                                                                                     </span>
<span class="-7051609494506194757" onmouseenter="enter('-7051609494506194757');" onmouseout="out('-7051609494506194757');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 637 +            // Send an intent with new data                                                                       </span>
<span class="-223393600950927979" onmouseenter="enter('-223393600950927979');" onmouseout="out('-223393600950927979');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 638 +            Intent intent = new Intent(BangleJSDeviceSupport.BANGLEJS_COMMAND_RX);                                </span>
<span class="-5525767627942220600" onmouseenter="enter('-5525767627942220600');" onmouseout="out('-5525767627942220600');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 639 +            intent.putExtra(&quot;DATA&quot;, packetStr);                                                                   </span>
<span class="5708963109403024105" onmouseenter="enter('5708963109403024105');" onmouseout="out('5708963109403024105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 640 +            intent.putExtra(&quot;SEQ&quot;, bangleCommandSeq++);                                                           </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 641 +            LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 643          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644      }                                                                                                             </span>
<span  style=""> 645                                                                                                                    </span>
<span  style=""> 646                                                                                                                    </span>
<span class="3689734917392452830" onmouseenter="enter('3689734917392452830');" onmouseout="out('3689734917392452830');" style=""> 647      void transmitTime(TransactionBuilder builder) {                                                               </span>
<span class="-580696616137890311" onmouseenter="enter('-580696616137890311');" onmouseout="out('-580696616137890311');" style=""> 648        long ts = System.currentTimeMillis();                                                                       </span>
<span class="2966270791537104856" onmouseenter="enter('2966270791537104856');" onmouseout="out('2966270791537104856');" style=""> 649        float tz = SimpleTimeZone.getDefault().getOffset(ts) / (1000 * 60 * 60.0f);                                 </span>
<span class="3431964532899256755" onmouseenter="enter('3431964532899256755');" onmouseout="out('3431964532899256755');" style=""> 650        // set time                                                                                                 </span>
<span class="-1610279467427834467" onmouseenter="enter('-1610279467427834467');" onmouseout="out('-1610279467427834467');" style=""> 651        String cmd = &quot;\u0010setTime(&quot;+(ts/1000)+&quot;);&quot;;                                                               </span>
<span class="-8332305144616549872" onmouseenter="enter('-8332305144616549872');" onmouseout="out('-8332305144616549872');" style=""> 652        // set timezone                                                                                             </span>
<span class="-5517412366789003339" onmouseenter="enter('-5517412366789003339');" onmouseout="out('-5517412366789003339');" style=""> 653        cmd += &quot;E.setTimeZone(&quot;+tz+&quot;);&quot;;                                                                            </span>
<span class="-1545435846395421943" onmouseenter="enter('-1545435846395421943');" onmouseout="out('-1545435846395421943');" style=""> 654        // write timezone to settings                                                                               </span>
<span class="-5908148183258021619" onmouseenter="enter('-5908148183258021619');" onmouseout="out('-5908148183258021619');" style=""><abbr title=" 655        cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;Storage&#x27;).readJSON(&#x27;setting.json&#x27;,1))&quot;;"> 655        cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;Storage&#x27;).readJSðŸ”µ</abbr></span>
<span class="4089130236590622366" onmouseenter="enter('4089130236590622366');" onmouseout="out('4089130236590622366');" style=""> 656        uartTx(builder, cmd+&quot;\n&quot;);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657      }                                                                                                             </span>
<span  style=""> 658                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 659      @Override                                                                                                     </span>
<span class="-5141762163842231173" onmouseenter="enter('-5141762163842231173');" onmouseout="out('-5141762163842231173');" style=""> 660      public boolean useAutoConnect() {                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 661          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662      }                                                                                                             </span>
<span  style=""> 663                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 664 -                                                                                                                  </span>
<span class="-8620112809460611919" onmouseenter="enter('-8620112809460611919');" onmouseout="out('-8620112809460611919');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 665 +    private String renderUnicodeWordAsImage(String word) {                                                        </span>
<span class="9035541491240023486" onmouseenter="enter('9035541491240023486');" onmouseout="out('9035541491240023486');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 666 +        // check for emoji                                                                                        </span>
<span class="5486434163020554131" onmouseenter="enter('5486434163020554131');" onmouseout="out('5486434163020554131');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 667 +        boolean hasEmoji = false;                                                                                 </span>
<span class="-4354250430909135512" onmouseenter="enter('-4354250430909135512');" onmouseout="out('-4354250430909135512');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 668 +        if (EmojiUtils.getAllEmojis()==null)                                                                      </span>
<span class="-4263391647615423897" onmouseenter="enter('-4263391647615423897');" onmouseout="out('-4263391647615423897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 669 +            EmojiManager.initEmojiData(GBApplication.getContext());                                               </span>
<span class="7493806979185135357" onmouseenter="enter('7493806979185135357');" onmouseout="out('7493806979185135357');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 670 +        for(Emoji emoji : EmojiUtils.getAllEmojis())                                                              </span>
<span class="-5951281087173806711" onmouseenter="enter('-5951281087173806711');" onmouseout="out('-5951281087173806711');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 671 +            if (word.contains(emoji.getEmoji())) hasEmoji = true;                                                 </span>
<span class="2890001900011943869" onmouseenter="enter('2890001900011943869');" onmouseout="out('2890001900011943869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 672 +        // if we had emoji, ensure we create 3 bit color (not 1 bit B&amp;W)                                          </span>
<span class="-5597957252839048845" onmouseenter="enter('-5597957252839048845');" onmouseout="out('-5597957252839048845');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 673 +        return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : BangleJSBitmapStyle.MONOCHROME);"> 673 +        return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : BangleJSBðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 674 +    }                                                                                                             </span>
<span  style=""> 675                                                                                                                    </span>
<span class="8776024667736839740" onmouseenter="enter('8776024667736839740');" onmouseout="out('8776024667736839740');" style=""> 676      public String renderUnicodeAsImage(String txt) {                                                              </span>
<span class="-1342218611990734243" onmouseenter="enter('-1342218611990734243');" onmouseout="out('-1342218611990734243');" style=""> 677          if (txt==null) return null;                                                                               </span>
<span class="-2209668059421895927" onmouseenter="enter('-2209668059421895927');" onmouseout="out('-2209668059421895927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 678 -        // If we&#x27;re not doing conversion, pass this right back                                                    </span>
<span class="-2990212439896506505" onmouseenter="enter('-2990212439896506505');" onmouseout="out('-2990212439896506505');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 679 +        /* If we&#x27;re not doing conversion, pass this right back (we use the EmojiConverter                         </span>
<span class="-9019482477548156237" onmouseenter="enter('-9019482477548156237');" onmouseout="out('-9019482477548156237');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 680 +        As we would have done if BangleJSCoordinator.supportsUnicodeEmojis had reported false */                  </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 681          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));         </span>
<span class="6036337086743190632" onmouseenter="enter('6036337086743190632');" onmouseout="out('6036337086743190632');" style=""> 682          if (!devicePrefs.getBoolean(PREF_BANGLEJS_TEXT_BITMAP, false))                                            </span>
<span class="-7288271959595239698" onmouseenter="enter('-7288271959595239698');" onmouseout="out('-7288271959595239698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 683 -            return txt;                                                                                           </span>
<span class="292577723455835940" onmouseenter="enter('292577723455835940');" onmouseout="out('292577723455835940');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 684 -        // Otherwise split up and check each word                                                                 </span>
<span class="1809640108333429188" onmouseenter="enter('1809640108333429188');" onmouseout="out('1809640108333429188');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 685 -        String words[] = txt.split(&quot; &quot;);                                                                          </span>
<span class="3637940892999293193" onmouseenter="enter('3637940892999293193');" onmouseout="out('3637940892999293193');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 686 -        for (int i=0;i&lt;words.length;i++) {                                                                        </span>
<span class="-1261873167777271973" onmouseenter="enter('-1261873167777271973');" onmouseout="out('-1261873167777271973');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 687 -            boolean isRenderable = true;                                                                          </span>
<span class="1989178542676826816" onmouseenter="enter('1989178542676826816');" onmouseout="out('1989178542676826816');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 688 -            for (int j=0;j&lt;words[i].length();j++) {                                                               </span>
<span class="-16469041501275168" onmouseenter="enter('-16469041501275168');" onmouseout="out('-16469041501275168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 689 -                char c = words[i].charAt(j);                                                                      </span>
<span class="-6218899606023063069" onmouseenter="enter('-6218899606023063069');" onmouseout="out('-6218899606023063069');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 690 +            return EmojiConverter.convertUnicodeEmojiToAscii(txt, GBApplication.getContext());                    </span>
<span class="292577723455835940" onmouseenter="enter('292577723455835940');" onmouseout="out('292577723455835940');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 691 +         // Otherwise split up and check each word                                                                </span>
<span class="-5288421538986521183" onmouseenter="enter('-5288421538986521183');" onmouseout="out('-5288421538986521183');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 692 +        String word = &quot;&quot;, result = &quot;&quot;;                                                                            </span>
<span class="-760381533077121579" onmouseenter="enter('-760381533077121579');" onmouseout="out('-760381533077121579');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 693 +        boolean needsTranslate = false;                                                                           </span>
<span class="-4776297315441687962" onmouseenter="enter('-4776297315441687962');" onmouseout="out('-4776297315441687962');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 694 +        for (int i=0;i&lt;txt.length();i++) {                                                                        </span>
<span class="-3301384702044321827" onmouseenter="enter('-3301384702044321827');" onmouseout="out('-3301384702044321827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 695 +            char ch = txt.charAt(i);                                                                              </span>
<span class="-3018677457763070108" onmouseenter="enter('-3018677457763070108');" onmouseout="out('-3018677457763070108');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 696 +            if (&quot; -_/:.,?!&#x27;\&quot;&amp;*()&quot;.indexOf(ch)&gt;=0) {                                                              </span>
<span class="1318526908393735015" onmouseenter="enter('1318526908393735015');" onmouseout="out('1318526908393735015');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 697 +                // word split                                                                                     </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 698 +                if (needsTranslate) { // convert word                                                             </span>
<span class="-3387652020968698915" onmouseenter="enter('-3387652020968698915');" onmouseout="out('-3387652020968698915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 699 +                    result += renderUnicodeWordAsImage(word)+ch;                                                  </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 700 +                } else { // or just copy across                                                                   </span>
<span class="1121164921789299019" onmouseenter="enter('1121164921789299019');" onmouseout="out('1121164921789299019');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 701 +                    result += word+ch;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 702 +                }                                                                                                 </span>
<span class="4599818924517102902" onmouseenter="enter('4599818924517102902');" onmouseout="out('4599818924517102902');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 703 +                word = &quot;&quot;;                                                                                        </span>
<span class="1499680785627976825" onmouseenter="enter('1499680785627976825');" onmouseout="out('1499680785627976825');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 704 +                needsTranslate = false;                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 705 +            } else {                                                                                              </span>
<span class="5371833621916626168" onmouseenter="enter('5371833621916626168');" onmouseout="out('5371833621916626168');" style=""> 706                  // TODO: better check?                                                                            </span>
<span class="6054207687507284700" onmouseenter="enter('6054207687507284700');" onmouseout="out('6054207687507284700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 707 -                if (c&lt;0 || c&gt;255) isRenderable = false;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 708 -            }                                                                                                     </span>
<span class="2526594978603575319" onmouseenter="enter('2526594978603575319');" onmouseout="out('2526594978603575319');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 709 -            if (!isRenderable)                                                                                    </span>
<span class="1972284869698434639" onmouseenter="enter('1972284869698434639');" onmouseout="out('1972284869698434639');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 710 -                words[i] = &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(words[i]));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 711 -        }                                                                                                         </span>
<span class="-4584734899719749670" onmouseenter="enter('-4584734899719749670');" onmouseout="out('-4584734899719749670');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 712 -        return String.join(&quot; &quot;, words);                                                                           </span>
<span class="-123072587783183541" onmouseenter="enter('-123072587783183541');" onmouseout="out('-123072587783183541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 713 +                if (ch&lt;0 || ch&gt;255) needsTranslate = true;                                                        </span>
<span class="2225265087012361140" onmouseenter="enter('2225265087012361140');" onmouseout="out('2225265087012361140');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 714 +                word += ch;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 715 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 716 +        }                                                                                                         </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 717 +        if (needsTranslate) { // convert word                                                                     </span>
<span class="-2531563633600833789" onmouseenter="enter('-2531563633600833789');" onmouseout="out('-2531563633600833789');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 718 +            result += renderUnicodeWordAsImage(word);                                                             </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 719 +        } else { // or just copy across                                                                           </span>
<span class="-4182205432270767968" onmouseenter="enter('-4182205432270767968');" onmouseout="out('-4182205432270767968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 720 +            result += word;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 721 +        }                                                                                                         </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 722 +        return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723      }                                                                                                             </span>
<span  style=""> 724                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 725      @Override                                                                                                     </span>
<span class="-116609517646424186" onmouseenter="enter('-116609517646424186');" onmouseout="out('-116609517646424186');" style=""> 726      public void onNotification(NotificationSpec notificationSpec) {                                               </span>
<span class="7244891213408121655" onmouseenter="enter('7244891213408121655');" onmouseout="out('7244891213408121655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 727 +        for (int i=0;i&lt;notificationSpec.attachedActions.size();i++) {                                             </span>
<span class="-1299099168286401629" onmouseenter="enter('-1299099168286401629');" onmouseout="out('-1299099168286401629');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 728 +            NotificationSpec.Action action = notificationSpec.attachedActions.get(i);                             </span>
<span class="1218815619539919953" onmouseenter="enter('1218815619539919953');" onmouseout="out('1218815619539919953');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 729 +            if (action.type==NotificationSpec.Action.TYPE_WEARABLE_REPLY)                                         </span>
<span class="-2487072541266275253" onmouseenter="enter('-2487072541266275253');" onmouseout="out('-2487072541266275253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 730 +                mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.getId()&lt;&lt;4) + i + 1)); // wow. This should be easier!"> 730 +                mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.getId()&lt;&lt;4ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 731 +        }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 732          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 733              JSONObject o = new JSONObject();                                                                      </span>
<span class="-3237033879846899756" onmouseenter="enter('-3237033879846899756');" onmouseout="out('-3237033879846899756');" style=""> 734              o.put(&quot;t&quot;, &quot;notify&quot;);                                                                                 </span>
<span class="-2996816801319654727" onmouseenter="enter('-2996816801319654727');" onmouseout="out('-2996816801319654727');" style=""> 735              o.put(&quot;id&quot;, notificationSpec.getId());                                                                </span>
<span class="7446549792523373865" onmouseenter="enter('7446549792523373865');" onmouseout="out('7446549792523373865');" style=""> 736              o.put(&quot;src&quot;, notificationSpec.sourceName);                                                            </span>
<span class="-2496842413615993216" onmouseenter="enter('-2496842413615993216');" onmouseout="out('-2496842413615993216');" style=""> 737              o.put(&quot;title&quot;, renderUnicodeAsImage(notificationSpec.title));                                         </span>
<span class="8572918879739705875" onmouseenter="enter('8572918879739705875');" onmouseout="out('8572918879739705875');" style=""> 738              o.put(&quot;subject&quot;, renderUnicodeAsImage(notificationSpec.subject));                                     </span>
<span class="-1911849092192349426" onmouseenter="enter('-1911849092192349426');" onmouseout="out('-1911849092192349426');" style=""> 739              o.put(&quot;body&quot;, renderUnicodeAsImage(notificationSpec.body));                                           </span>
<span class="-504952153198563265" onmouseenter="enter('-504952153198563265');" onmouseout="out('-504952153198563265');" style=""> 740              o.put(&quot;sender&quot;, renderUnicodeAsImage(notificationSpec.sender));                                       </span>
<span class="-5726859549953031700" onmouseenter="enter('-5726859549953031700');" onmouseout="out('-5726859549953031700');" style=""> 741              o.put(&quot;tel&quot;, notificationSpec.phoneNumber);                                                           </span>
<span class="7885351870399476726" onmouseenter="enter('7885351870399476726');" onmouseout="out('7885351870399476726');" style=""> 742              uartTxJSON(&quot;onNotification&quot;, o);                                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 743          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 744              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 745          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746      }                                                                                                             </span>
<span  style=""> 747                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 748      @Override                                                                                                     </span>
<span class="-1102873404195143085" onmouseenter="enter('-1102873404195143085');" onmouseout="out('-1102873404195143085');" style=""> 749      public void onDeleteNotification(int id) {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 750          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 751              JSONObject o = new JSONObject();                                                                      </span>
<span class="8475479069823885977" onmouseenter="enter('8475479069823885977');" onmouseout="out('8475479069823885977');" style=""> 752              o.put(&quot;t&quot;, &quot;notify-&quot;);                                                                                </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 753              o.put(&quot;id&quot;, id);                                                                                      </span>
<span class="4156835990201809715" onmouseenter="enter('4156835990201809715');" onmouseout="out('4156835990201809715');" style=""> 754              uartTxJSON(&quot;onDeleteNotification&quot;, o);                                                                </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 755          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 756              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758      }                                                                                                             </span>
<span  style=""> 759                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 760      @Override                                                                                                     </span>
<span class="7164248173527032001" onmouseenter="enter('7164248173527032001');" onmouseout="out('7164248173527032001');" style=""> 761      public void onSetTime() {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 762          try {                                                                                                     </span>
<span class="-5785975329698273515" onmouseenter="enter('-5785975329698273515');" onmouseout="out('-5785975329698273515');" style=""> 763              TransactionBuilder builder = performInitialized(&quot;setTime&quot;);                                           </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 764              transmitTime(builder);                                                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 765              builder.queue(getQueue());                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 766          } catch (Exception e) {                                                                                   </span>
<span class="5000424150373642922" onmouseenter="enter('5000424150373642922');" onmouseout="out('5000424150373642922');" style=""> 767              GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 768          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769      }                                                                                                             </span>
<span  style=""> 770                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 771      @Override                                                                                                     </span>
<span class="-6473317888357330260" onmouseenter="enter('-6473317888357330260');" onmouseout="out('-6473317888357330260');" style=""> 772      public void onSetAlarms(ArrayList&lt;? extends Alarm&gt; alarms) {                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 773          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 774              JSONObject o = new JSONObject();                                                                      </span>
<span class="3488284827981638605" onmouseenter="enter('3488284827981638605');" onmouseout="out('3488284827981638605');" style=""> 775              o.put(&quot;t&quot;, &quot;alarm&quot;);                                                                                  </span>
<span class="2586106610260987486" onmouseenter="enter('2586106610260987486');" onmouseout="out('2586106610260987486');" style=""> 776              JSONArray jsonalarms = new JSONArray();                                                               </span>
<span class="7012783305172244346" onmouseenter="enter('7012783305172244346');" onmouseout="out('7012783305172244346');" style=""> 777              o.put(&quot;d&quot;, jsonalarms);                                                                               </span>
<span  style=""> 778                                                                                                                    </span>
<span class="-7996805109404385335" onmouseenter="enter('-7996805109404385335');" onmouseout="out('-7996805109404385335');" style=""> 779              for (Alarm alarm : alarms) {                                                                          </span>
<span class="-7206413691565762606" onmouseenter="enter('-7206413691565762606');" onmouseout="out('-7206413691565762606');" style=""> 780                  if (!alarm.getEnabled()) continue;                                                                </span>
<span class="1488433958727864154" onmouseenter="enter('1488433958727864154');" onmouseout="out('1488433958727864154');" style=""> 781                  JSONObject jsonalarm = new JSONObject();                                                          </span>
<span class="-2065505732499951357" onmouseenter="enter('-2065505732499951357');" onmouseout="out('-2065505732499951357');" style=""> 782                  jsonalarms.put(jsonalarm);                                                                        </span>
<span  style=""> 783                                                                                                                    </span>
<span class="169777398048646112" onmouseenter="enter('169777398048646112');" onmouseout="out('169777398048646112');" style=""> 784                  Calendar calendar = AlarmUtils.toCalendar(alarm);                                                 </span>
<span  style=""> 785                                                                                                                    </span>
<span class="6578593229745866209" onmouseenter="enter('6578593229745866209');" onmouseout="out('6578593229745866209');" style=""> 786                  jsonalarm.put(&quot;h&quot;, alarm.getHour());                                                              </span>
<span class="7461878622333576123" onmouseenter="enter('7461878622333576123');" onmouseout="out('7461878622333576123');" style=""> 787                  jsonalarm.put(&quot;m&quot;, alarm.getMinute());                                                            </span>
<span class="97057399767477313" onmouseenter="enter('97057399767477313');" onmouseout="out('97057399767477313');" style=""> 788                  jsonalarm.put(&quot;rep&quot;, alarm.getRepetition());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 789              }                                                                                                     </span>
<span class="7288963480750843606" onmouseenter="enter('7288963480750843606');" onmouseout="out('7288963480750843606');" style=""> 790              uartTxJSON(&quot;onSetAlarms&quot;, o);                                                                         </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 791          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 792              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 793          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794      }                                                                                                             </span>
<span  style=""> 795                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 796      @Override                                                                                                     </span>
<span class="8502851833159229707" onmouseenter="enter('8502851833159229707');" onmouseout="out('8502851833159229707');" style=""> 797      public void onSetCallState(CallSpec callSpec) {                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 798          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 799              JSONObject o = new JSONObject();                                                                      </span>
<span class="4158854171585038558" onmouseenter="enter('4158854171585038558');" onmouseout="out('4158854171585038558');" style=""> 800              o.put(&quot;t&quot;, &quot;call&quot;);                                                                                   </span>
<span class="3958892663366704764" onmouseenter="enter('3958892663366704764');" onmouseout="out('3958892663366704764');" style=""> 801              String cmdName = &quot;&quot;;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 802              try {                                                                                                 </span>
<span class="-9009466648790586927" onmouseenter="enter('-9009466648790586927');" onmouseout="out('-9009466648790586927');" style=""> 803                  Field fields[] = callSpec.getClass().getDeclaredFields();                                         </span>
<span class="-8522204470221494922" onmouseenter="enter('-8522204470221494922');" onmouseout="out('-8522204470221494922');" style=""> 804                  for (Field field : fields)                                                                        </span>
<span class="-7797368603385788624" onmouseenter="enter('-7797368603385788624');" onmouseout="out('-7797368603385788624');" style=""> 805                      if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.command)        </span>
<span class="8043037183581644681" onmouseenter="enter('8043037183581644681');" onmouseout="out('8043037183581644681');" style=""> 806                          cmdName = field.getName().substring(5).toLowerCase();                                     </span>
<span class="-7581013626583319085" onmouseenter="enter('-7581013626583319085');" onmouseout="out('-7581013626583319085');" style=""> 807              } catch (IllegalAccessException e) {}                                                                 </span>
<span class="-1085015235935761185" onmouseenter="enter('-1085015235935761185');" onmouseout="out('-1085015235935761185');" style=""> 808              o.put(&quot;cmd&quot;, cmdName);                                                                                </span>
<span class="8637280962137247636" onmouseenter="enter('8637280962137247636');" onmouseout="out('8637280962137247636');" style=""> 809              o.put(&quot;name&quot;, renderUnicodeAsImage(callSpec.name));                                                   </span>
<span class="673690437593128793" onmouseenter="enter('673690437593128793');" onmouseout="out('673690437593128793');" style=""> 810              o.put(&quot;number&quot;, callSpec.number);                                                                     </span>
<span class="-6546279892320681741" onmouseenter="enter('-6546279892320681741');" onmouseout="out('-6546279892320681741');" style=""> 811              uartTxJSON(&quot;onSetCallState&quot;, o);                                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 812          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 813              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 815  }                                                                                                                 </span>
<span  style=""> 816                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 817      @Override                                                                                                     </span>
<span class="8238257195410140286" onmouseenter="enter('8238257195410140286');" onmouseout="out('8238257195410140286');" style=""> 818      public void onSetCannedMessages(CannedMessagesSpec cannedMessagesSpec) {                                      </span>
<span  style=""> 819                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820      }                                                                                                             </span>
<span  style=""> 821                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 822      @Override                                                                                                     </span>
<span class="8228188929931998548" onmouseenter="enter('8228188929931998548');" onmouseout="out('8228188929931998548');" style=""> 823      public void onSetMusicState(MusicStateSpec stateSpec) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 824          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 825              JSONObject o = new JSONObject();                                                                      </span>
<span class="-92554745071265211" onmouseenter="enter('-92554745071265211');" onmouseout="out('-92554745071265211');" style=""> 826              o.put(&quot;t&quot;, &quot;musicstate&quot;);                                                                             </span>
<span class="8807632241012571777" onmouseenter="enter('8807632241012571777');" onmouseout="out('8807632241012571777');" style=""> 827              int musicState = stateSpec.state;                                                                     </span>
<span class="-8234435338877590300" onmouseenter="enter('-8234435338877590300');" onmouseout="out('-8234435338877590300');" style=""> 828              String[] musicStates = {&quot;play&quot;, &quot;pause&quot;, &quot;stop&quot;, &quot;&quot;};                                                 </span>
<span class="-9088398443169884235" onmouseenter="enter('-9088398443169884235');" onmouseout="out('-9088398443169884235');" style=""> 829              if (musicState&lt;0) musicState=3;                                                                       </span>
<span class="2321591687835617567" onmouseenter="enter('2321591687835617567');" onmouseout="out('2321591687835617567');" style=""> 830              if (musicState&gt;=musicStates.length) musicState = musicStates.length-1;                                </span>
<span class="-1010325962977709940" onmouseenter="enter('-1010325962977709940');" onmouseout="out('-1010325962977709940');" style=""> 831              o.put(&quot;state&quot;, musicStates[musicState]);                                                              </span>
<span class="4362989328077723220" onmouseenter="enter('4362989328077723220');" onmouseout="out('4362989328077723220');" style=""> 832              o.put(&quot;position&quot;, stateSpec.position);                                                                </span>
<span class="-521013622091952719" onmouseenter="enter('-521013622091952719');" onmouseout="out('-521013622091952719');" style=""> 833              o.put(&quot;shuffle&quot;, stateSpec.shuffle);                                                                  </span>
<span class="7992510141527813217" onmouseenter="enter('7992510141527813217');" onmouseout="out('7992510141527813217');" style=""> 834              o.put(&quot;repeat&quot;, stateSpec.repeat);                                                                    </span>
<span class="-8798301955703322193" onmouseenter="enter('-8798301955703322193');" onmouseout="out('-8798301955703322193');" style=""> 835              uartTxJSON(&quot;onSetMusicState&quot;, o);                                                                     </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 836          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 837              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839      }                                                                                                             </span>
<span  style=""> 840                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 841      @Override                                                                                                     </span>
<span class="-4182706906721092498" onmouseenter="enter('-4182706906721092498');" onmouseout="out('-4182706906721092498');" style=""> 842      public void onSetMusicInfo(MusicSpec musicSpec) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 843          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 844              JSONObject o = new JSONObject();                                                                      </span>
<span class="-21742499724689403" onmouseenter="enter('-21742499724689403');" onmouseout="out('-21742499724689403');" style=""> 845              o.put(&quot;t&quot;, &quot;musicinfo&quot;);                                                                              </span>
<span class="-7907833892429297395" onmouseenter="enter('-7907833892429297395');" onmouseout="out('-7907833892429297395');" style=""> 846              o.put(&quot;artist&quot;, renderUnicodeAsImage(musicSpec.artist));                                              </span>
<span class="6485281684850333943" onmouseenter="enter('6485281684850333943');" onmouseout="out('6485281684850333943');" style=""> 847              o.put(&quot;album&quot;, renderUnicodeAsImage(musicSpec.album));                                                </span>
<span class="6434659518035718811" onmouseenter="enter('6434659518035718811');" onmouseout="out('6434659518035718811');" style=""> 848              o.put(&quot;track&quot;, renderUnicodeAsImage(musicSpec.track));                                                </span>
<span class="-6589694811644482139" onmouseenter="enter('-6589694811644482139');" onmouseout="out('-6589694811644482139');" style=""> 849              o.put(&quot;dur&quot;, musicSpec.duration);                                                                     </span>
<span class="-5969522677742802968" onmouseenter="enter('-5969522677742802968');" onmouseout="out('-5969522677742802968');" style=""> 850              o.put(&quot;c&quot;, musicSpec.trackCount);                                                                     </span>
<span class="7704969334649219354" onmouseenter="enter('7704969334649219354');" onmouseout="out('7704969334649219354');" style=""> 851              o.put(&quot;n&quot;, musicSpec.trackNr);                                                                        </span>
<span class="-567994157751048073" onmouseenter="enter('-567994157751048073');" onmouseout="out('-567994157751048073');" style=""> 852              uartTxJSON(&quot;onSetMusicInfo&quot;, o);                                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 853          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 854              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856      }                                                                                                             </span>
<span  style=""> 857                                                                                                                    </span>
<span class="1808047972614051455" onmouseenter="enter('1808047972614051455');" onmouseout="out('1808047972614051455');" style=""> 858      private void transmitActivityStatus() {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 859          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 860              JSONObject o = new JSONObject();                                                                      </span>
<span class="-8158526622976442101" onmouseenter="enter('-8158526622976442101');" onmouseout="out('-8158526622976442101');" style=""> 861              o.put(&quot;t&quot;, &quot;act&quot;);                                                                                    </span>
<span class="5593394621505017212" onmouseenter="enter('5593394621505017212');" onmouseout="out('5593394621505017212');" style=""> 862              o.put(&quot;hrm&quot;, realtimeHRM);                                                                            </span>
<span class="9069762361832051811" onmouseenter="enter('9069762361832051811');" onmouseout="out('9069762361832051811');" style=""> 863              o.put(&quot;stp&quot;, realtimeStep);                                                                           </span>
<span class="4361099818971426695" onmouseenter="enter('4361099818971426695');" onmouseout="out('4361099818971426695');" style=""> 864              o.put(&quot;int&quot;, realtimeHRMInterval);                                                                    </span>
<span class="-8731247564001223528" onmouseenter="enter('-8731247564001223528');" onmouseout="out('-8731247564001223528');" style=""> 865              uartTxJSON(&quot;onEnableRealtimeSteps&quot;, o);                                                               </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 866          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 867              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869      }                                                                                                             </span>
<span  style=""> 870                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 871      @Override                                                                                                     </span>
<span class="-8425797677863799500" onmouseenter="enter('-8425797677863799500');" onmouseout="out('-8425797677863799500');" style=""> 872      public void onEnableRealtimeSteps(boolean enable) {                                                           </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 873          if (enable == realtimeHRM) return;                                                                        </span>
<span class="-5879371575258185595" onmouseenter="enter('-5879371575258185595');" onmouseout="out('-5879371575258185595');" style=""> 874          realtimeStep = enable;                                                                                    </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 875          transmitActivityStatus();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876      }                                                                                                             </span>
<span  style=""> 877                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 878      @Override                                                                                                     </span>
<span class="-4135655620136168708" onmouseenter="enter('-4135655620136168708');" onmouseout="out('-4135655620136168708');" style=""> 879      public void onInstallApp(Uri uri) {                                                                           </span>
<span  style=""> 880                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881      }                                                                                                             </span>
<span  style=""> 882                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 883      @Override                                                                                                     </span>
<span class="-3322711972275217450" onmouseenter="enter('-3322711972275217450');" onmouseout="out('-3322711972275217450');" style=""> 884      public void onAppInfoReq() {                                                                                  </span>
<span  style=""> 885                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886      }                                                                                                             </span>
<span  style=""> 887                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 888      @Override                                                                                                     </span>
<span class="1692097554900603024" onmouseenter="enter('1692097554900603024');" onmouseout="out('1692097554900603024');" style=""> 889      public void onAppStart(UUID uuid, boolean start) {                                                            </span>
<span  style=""> 890                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 891      }                                                                                                             </span>
<span  style=""> 892                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 893      @Override                                                                                                     </span>
<span class="7633110766708892729" onmouseenter="enter('7633110766708892729');" onmouseout="out('7633110766708892729');" style=""> 894      public void onAppDelete(UUID uuid) {                                                                          </span>
<span  style=""> 895                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 896      }                                                                                                             </span>
<span  style=""> 897                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 898      @Override                                                                                                     </span>
<span class="2176182926116218619" onmouseenter="enter('2176182926116218619');" onmouseout="out('2176182926116218619');" style=""> 899      public void onAppConfiguration(UUID appUuid, String config, Integer id) {                                     </span>
<span  style=""> 900                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 901      }                                                                                                             </span>
<span  style=""> 902                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 903      @Override                                                                                                     </span>
<span class="-2513514137107402976" onmouseenter="enter('-2513514137107402976');" onmouseout="out('-2513514137107402976');" style=""> 904      public void onAppReorder(UUID[] uuids) {                                                                      </span>
<span  style=""> 905                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 906      }                                                                                                             </span>
<span  style=""> 907                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 908      @Override                                                                                                     </span>
<span class="3881968248613188942" onmouseenter="enter('3881968248613188942');" onmouseout="out('3881968248613188942');" style=""> 909      public void onFetchRecordedData(int dataTypes) {                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 910 -                                                                                                                  </span>
<span class="-3849076454550892314" onmouseenter="enter('-3849076454550892314');" onmouseout="out('-3849076454550892314');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 911 +        if (dataTypes == RecordedDataTypes.TYPE_DEBUGLOGS) {                                                      </span>
<span class="1579212162814293327" onmouseenter="enter('1579212162814293327');" onmouseout="out('1579212162814293327');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 912 +            File dir;                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 913 +            try {                                                                                                 </span>
<span class="-3526927992489947407" onmouseenter="enter('-3526927992489947407');" onmouseout="out('-3526927992489947407');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 914 +                dir = FileUtils.getExternalFilesDir();                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 915 +            } catch (IOException e) {                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 916 +                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 917 +            }                                                                                                     </span>
<span class="-8623321881845197728" onmouseenter="enter('-8623321881845197728');" onmouseout="out('-8623321881845197728');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 918 +            SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd-HHmmss&quot;, Locale.US);                     </span>
<span class="-3655538185251554118" onmouseenter="enter('-3655538185251554118');" onmouseout="out('-3655538185251554118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 919 +            String filename = &quot;banglejs_debug_&quot; + dateFormat.format(new Date()) + &quot;.log&quot;;                         </span>
<span class="2454422670405906587" onmouseenter="enter('2454422670405906587');" onmouseout="out('2454422670405906587');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 920 +            File outputFile = new File(dir, filename );                                                           </span>
<span class="6676810503762950417" onmouseenter="enter('6676810503762950417');" onmouseout="out('6676810503762950417');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 921 +            LOG.warn(&quot;Writing log to &quot;+outputFile.toString());                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 922 +            try {                                                                                                 </span>
<span class="-8771066680414961708" onmouseenter="enter('-8771066680414961708');" onmouseout="out('-8771066680414961708');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 923 +                BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile));                           </span>
<span class="4633875208200868523" onmouseenter="enter('4633875208200868523');" onmouseout="out('4633875208200868523');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 924 +                writer.write(receiveHistory);                                                                     </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 925 +                writer.close();                                                                                   </span>
<span class="-3019360337557251714" onmouseenter="enter('-3019360337557251714');" onmouseout="out('-3019360337557251714');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 926 +                receiveHistory = &quot;&quot;;                                                                              </span>
<span class="3582332183058181346" onmouseenter="enter('3582332183058181346');" onmouseout="out('3582332183058181346');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 927 +                GB.toast(getContext(), &quot;Log written to &quot;+filename, Toast.LENGTH_LONG, GB.INFO);                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 928 +            } catch (IOException e) {                                                                             </span>
<span class="4694495530853371438" onmouseenter="enter('4694495530853371438');" onmouseout="out('4694495530853371438');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 929 +                LOG.warn(&quot;Could not write to file&quot;, e);                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 930 +                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 931 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 932 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 933      }                                                                                                             </span>
<span  style=""> 934                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 935      @Override                                                                                                     </span>
<span class="3589048831688325527" onmouseenter="enter('3589048831688325527');" onmouseout="out('3589048831688325527');" style=""> 936      public void onReset(int flags) {                                                                              </span>
<span  style=""> 937                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 938      }                                                                                                             </span>
<span  style=""> 939                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 940      @Override                                                                                                     </span>
<span class="-9008385526233139735" onmouseenter="enter('-9008385526233139735');" onmouseout="out('-9008385526233139735');" style=""> 941      public void onHeartRateTest() {                                                                               </span>
<span  style=""> 942                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 943      }                                                                                                             </span>
<span  style=""> 944                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 945      @Override                                                                                                     </span>
<span class="2383065190612615413" onmouseenter="enter('2383065190612615413');" onmouseout="out('2383065190612615413');" style=""> 946      public void onEnableRealtimeHeartRateMeasurement(boolean enable) {                                            </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 947          if (enable == realtimeHRM) return;                                                                        </span>
<span class="8804907312000263363" onmouseenter="enter('8804907312000263363');" onmouseout="out('8804907312000263363');" style=""> 948          realtimeHRM = enable;                                                                                     </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 949          transmitActivityStatus();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 950      }                                                                                                             </span>
<span  style=""> 951                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 952      @Override                                                                                                     </span>
<span class="-3287587973518064190" onmouseenter="enter('-3287587973518064190');" onmouseout="out('-3287587973518064190');" style=""> 953      public void onFindDevice(boolean start) {                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 954          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 955              JSONObject o = new JSONObject();                                                                      </span>
<span class="4130381404080081417" onmouseenter="enter('4130381404080081417');" onmouseout="out('4130381404080081417');" style=""> 956              o.put(&quot;t&quot;, &quot;find&quot;);                                                                                   </span>
<span class="6818313613707459779" onmouseenter="enter('6818313613707459779');" onmouseout="out('6818313613707459779');" style=""> 957              o.put(&quot;n&quot;, start);                                                                                    </span>
<span class="5958886073956724015" onmouseenter="enter('5958886073956724015');" onmouseout="out('5958886073956724015');" style=""> 958              uartTxJSON(&quot;onFindDevice&quot;, o);                                                                        </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 959          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 960              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962      }                                                                                                             </span>
<span  style=""> 963                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 964      @Override                                                                                                     </span>
<span class="-1926054327985162362" onmouseenter="enter('-1926054327985162362');" onmouseout="out('-1926054327985162362');" style=""> 965      public void onSetConstantVibration(int integer) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 966          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 967              JSONObject o = new JSONObject();                                                                      </span>
<span class="4547736712460874928" onmouseenter="enter('4547736712460874928');" onmouseout="out('4547736712460874928');" style=""> 968              o.put(&quot;t&quot;, &quot;vibrate&quot;);                                                                                </span>
<span class="-4243820256325497798" onmouseenter="enter('-4243820256325497798');" onmouseout="out('-4243820256325497798');" style=""> 969              o.put(&quot;n&quot;, integer);                                                                                  </span>
<span class="-1000088439791572503" onmouseenter="enter('-1000088439791572503');" onmouseout="out('-1000088439791572503');" style=""> 970              uartTxJSON(&quot;onSetConstantVibration&quot;, o);                                                              </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 971          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 972              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 973          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 974      }                                                                                                             </span>
<span  style=""> 975                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 976      @Override                                                                                                     </span>
<span class="-3293819866797459784" onmouseenter="enter('-3293819866797459784');" onmouseout="out('-3293819866797459784');" style=""> 977      public void onScreenshotReq() {                                                                               </span>
<span  style=""> 978                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 979      }                                                                                                             </span>
<span  style=""> 980                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 981      @Override                                                                                                     </span>
<span class="-2597044235576493624" onmouseenter="enter('-2597044235576493624');" onmouseout="out('-2597044235576493624');" style=""> 982      public void onEnableHeartRateSleepSupport(boolean enable) {                                                   </span>
<span  style=""> 983                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984      }                                                                                                             </span>
<span  style=""> 985                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 986      @Override                                                                                                     </span>
<span class="-5895120009761092080" onmouseenter="enter('-5895120009761092080');" onmouseout="out('-5895120009761092080');" style=""> 987      public void onSetHeartRateMeasurementInterval(int seconds) {                                                  </span>
<span class="-1003654780605811203" onmouseenter="enter('-1003654780605811203');" onmouseout="out('-1003654780605811203');" style=""> 988          realtimeHRMInterval = seconds;                                                                            </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 989          transmitActivityStatus();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 990      }                                                                                                             </span>
<span  style=""> 991                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 992      @Override                                                                                                     </span>
<span class="-7200644583722212481" onmouseenter="enter('-7200644583722212481');" onmouseout="out('-7200644583722212481');" style=""> 993      public void onAddCalendarEvent(CalendarEventSpec calendarEventSpec) {                                         </span>
<span  style=""> 994                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 995      }                                                                                                             </span>
<span  style=""> 996                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 997      @Override                                                                                                     </span>
<span class="2890386202777848228" onmouseenter="enter('2890386202777848228');" onmouseout="out('2890386202777848228');" style=""> 998      public void onDeleteCalendarEvent(byte type, long id) {                                                       </span>
<span  style=""> 999                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1000      }                                                                                                             </span>
<span  style="">1001                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1002      @Override                                                                                                     </span>
<span class="349159621018699769" onmouseenter="enter('349159621018699769');" onmouseout="out('349159621018699769');" style="">1003      public void onSendConfiguration(String config) {                                                              </span>
<span  style="">1004                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1005      }                                                                                                             </span>
<span  style="">1006                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1007      @Override                                                                                                     </span>
<span class="8707097463436604513" onmouseenter="enter('8707097463436604513');" onmouseout="out('8707097463436604513');" style="">1008      public void onReadConfiguration(String config) {                                                              </span>
<span  style="">1009                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1010      }                                                                                                             </span>
<span  style="">1011                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1012      @Override                                                                                                     </span>
<span class="-1180224994468071186" onmouseenter="enter('-1180224994468071186');" onmouseout="out('-1180224994468071186');" style="">1013      public void onTestNewFunction() {                                                                             </span>
<span  style="">1014                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1015      }                                                                                                             </span>
<span  style="">1016                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1017      @Override                                                                                                     </span>
<span class="-6167041048283935417" onmouseenter="enter('-6167041048283935417');" onmouseout="out('-6167041048283935417');" style="">1018      public void onSendWeather(WeatherSpec weatherSpec) {                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1019          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style="">1020              JSONObject o = new JSONObject();                                                                      </span>
<span class="501109951395943657" onmouseenter="enter('501109951395943657');" onmouseout="out('501109951395943657');" style="">1021              o.put(&quot;t&quot;, &quot;weather&quot;);                                                                                </span>
<span class="4560755441777004113" onmouseenter="enter('4560755441777004113');" onmouseout="out('4560755441777004113');" style="">1022              o.put(&quot;temp&quot;, weatherSpec.currentTemp);                                                               </span>
<span class="7333169967933356383" onmouseenter="enter('7333169967933356383');" onmouseout="out('7333169967933356383');" style="">1023              o.put(&quot;hum&quot;, weatherSpec.currentHumidity);                                                            </span>
<span class="1899511800679765497" onmouseenter="enter('1899511800679765497');" onmouseout="out('1899511800679765497');" style="">1024              o.put(&quot;code&quot;, weatherSpec.currentConditionCode);                                                      </span>
<span class="-4150178137906864023" onmouseenter="enter('-4150178137906864023');" onmouseout="out('-4150178137906864023');" style="">1025              o.put(&quot;txt&quot;, weatherSpec.currentCondition);                                                           </span>
<span class="2529521996043109426" onmouseenter="enter('2529521996043109426');" onmouseout="out('2529521996043109426');" style="">1026              o.put(&quot;wind&quot;, weatherSpec.windSpeed);                                                                 </span>
<span class="-3531204280741737459" onmouseenter="enter('-3531204280741737459');" onmouseout="out('-3531204280741737459');" style="">1027              o.put(&quot;wdir&quot;, weatherSpec.windDirection);                                                             </span>
<span class="-5203705012940108393" onmouseenter="enter('-5203705012940108393');" onmouseout="out('-5203705012940108393');" style="">1028              o.put(&quot;loc&quot;, weatherSpec.location);                                                                   </span>
<span class="-7123085564208723174" onmouseenter="enter('-7123085564208723174');" onmouseout="out('-7123085564208723174');" style="">1029              uartTxJSON(&quot;onSendWeather&quot;, o);                                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style="">1030          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style="">1031              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1032          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1033      }                                                                                                             </span>
<span  style="">1034                                                                                                                    </span>
<span class="-2877595281257014330" onmouseenter="enter('-2877595281257014330');" onmouseout="out('-2877595281257014330');" style="">1035      public Bitmap textToBitmap(String text) {                                                                     </span>
<span class="8197355036703912915" onmouseenter="enter('8197355036703912915');" onmouseout="out('8197355036703912915');" style="">1036          Paint paint = new Paint(0); // Paint.ANTI_ALIAS_FLAG not wanted as 1bpp                                   </span>
<span class="7051721925152008019" onmouseenter="enter('7051721925152008019');" onmouseout="out('7051721925152008019');" style="">1037          paint.setTextSize(18);                                                                                    </span>
<span class="3201120031631468052" onmouseenter="enter('3201120031631468052');" onmouseout="out('3201120031631468052');" style="">1038          paint.setColor(0xFFFFFFFF);                                                                               </span>
<span class="-8656814648822962149" onmouseenter="enter('-8656814648822962149');" onmouseout="out('-8656814648822962149');" style="">1039          paint.setTextAlign(Paint.Align.LEFT);                                                                     </span>
<span class="-7872377864782888483" onmouseenter="enter('-7872377864782888483');" onmouseout="out('-7872377864782888483');" style="">1040          float baseline = -paint.ascent(); // ascent() is negative                                                 </span>
<span class="-8465374828216379200" onmouseenter="enter('-8465374828216379200');" onmouseout="out('-8465374828216379200');" style="">1041          int width = (int) (paint.measureText(text) + 0.5f); // round                                              </span>
<span class="-3854390456573697081" onmouseenter="enter('-3854390456573697081');" onmouseout="out('-3854390456573697081');" style="">1042          int height = (int) (baseline + paint.descent() + 0.5f);                                                   </span>
<span class="2906210495000084590" onmouseenter="enter('2906210495000084590');" onmouseout="out('2906210495000084590');" style="">1043          Bitmap image = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);                               </span>
<span class="-8679273566707466475" onmouseenter="enter('-8679273566707466475');" onmouseout="out('-8679273566707466475');" style="">1044          Canvas canvas = new Canvas(image);                                                                        </span>
<span class="-1111517440201709382" onmouseenter="enter('-1111517440201709382');" onmouseout="out('-1111517440201709382');" style="">1045          canvas.drawText(text, 0, baseline, paint);                                                                </span>
<span class="-2663644744327296233" onmouseenter="enter('-2663644744327296233');" onmouseout="out('-2663644744327296233');" style="">1046          return image;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1047      }                                                                                                             </span>
<span  style="">1048                                                                                                                    </span>
<span class="7074963208724431146" onmouseenter="enter('7074963208724431146');" onmouseout="out('7074963208724431146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1049 +    public enum BangleJSBitmapStyle {                                                                             </span>
<span class="6147896096185822433" onmouseenter="enter('6147896096185822433');" onmouseout="out('6147896096185822433');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1050 +        MONOCHROME,                                                                                               </span>
<span class="4062182762926863582" onmouseenter="enter('4062182762926863582');" onmouseout="out('4062182762926863582');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1051 +        RGB_3BPP                                                                                                  </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1052 +    };                                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1053 +                                                                                                                  </span>
<span class="6301558466408951369" onmouseenter="enter('6301558466408951369');" onmouseout="out('6301558466408951369');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1054 +    /** Used for writing single bits to an array */                                                               </span>
<span class="819222803118860573" onmouseenter="enter('819222803118860573');" onmouseout="out('819222803118860573');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1055 +    public static class BitWriter {                                                                               </span>
<span class="114498312668931576" onmouseenter="enter('114498312668931576');" onmouseout="out('114498312668931576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1056 +        int n;                                                                                                    </span>
<span class="2627896913916265726" onmouseenter="enter('2627896913916265726');" onmouseout="out('2627896913916265726');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1057 +        byte[] bits;                                                                                              </span>
<span class="1763732906692125975" onmouseenter="enter('1763732906692125975');" onmouseout="out('1763732906692125975');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1058 +        int currentByte, bitIdx;                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1059 +                                                                                                                  </span>
<span class="4387590414863300883" onmouseenter="enter('4387590414863300883');" onmouseout="out('4387590414863300883');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1060 +        public BitWriter(byte[] array, int offset) {                                                              </span>
<span class="-2669551821059816380" onmouseenter="enter('-2669551821059816380');" onmouseout="out('-2669551821059816380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1061 +            bits = array;                                                                                         </span>
<span class="8043804227758168612" onmouseenter="enter('8043804227758168612');" onmouseout="out('8043804227758168612');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1062 +            n = offset;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1063 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1064 +                                                                                                                  </span>
<span class="3787308675999271388" onmouseenter="enter('3787308675999271388');" onmouseout="out('3787308675999271388');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1065 +        public void push(boolean v) {                                                                             </span>
<span class="-3502051617447471385" onmouseenter="enter('-3502051617447471385');" onmouseout="out('-3502051617447471385');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1066 +            currentByte = (currentByte &lt;&lt; 1) | (v?1:0);                                                           </span>
<span class="-9185751609333789697" onmouseenter="enter('-9185751609333789697');" onmouseout="out('-9185751609333789697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1067 +            bitIdx++;                                                                                             </span>
<span class="-4190492491002713547" onmouseenter="enter('-4190492491002713547');" onmouseout="out('-4190492491002713547');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1068 +            if (bitIdx == 8) {                                                                                    </span>
<span class="6079776424871100267" onmouseenter="enter('6079776424871100267');" onmouseout="out('6079776424871100267');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1069 +                bits[n++] = (byte)currentByte;                                                                    </span>
<span class="7441701714119310800" onmouseenter="enter('7441701714119310800');" onmouseout="out('7441701714119310800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1070 +                bitIdx = 0;                                                                                       </span>
<span class="-6334189767708640910" onmouseenter="enter('-6334189767708640910');" onmouseout="out('-6334189767708640910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1071 +                currentByte = 0;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1072 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1073 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1074 +                                                                                                                  </span>
<span class="-6819029797264174065" onmouseenter="enter('-6819029797264174065');" onmouseout="out('-6819029797264174065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1075 +        public void finish() {                                                                                    </span>
<span class="-7024656867771236134" onmouseenter="enter('-7024656867771236134');" onmouseout="out('-7024656867771236134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1076 +            if (bitIdx &gt; 0) bits[n++] = (byte)currentByte;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1077 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1078 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1079 +                                                                                                                  </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1080      /** Convert an Android bitmap to a base64 string for use in Espruino.                                         </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1081       * Currently only 1bpp, no scaling */                                                                         </span>
<span class="-3636207061562779479" onmouseenter="enter('-3636207061562779479');" onmouseout="out('-3636207061562779479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1082 -    public static byte[] bitmapToEspruinoArray(Bitmap bitmap) {                                                   </span>
<span class="7395401196912084921" onmouseenter="enter('7395401196912084921');" onmouseout="out('7395401196912084921');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1083 +    public static byte[] bitmapToEspruinoArray(Bitmap bitmap, BangleJSBitmapStyle style) {                        </span>
<span class="-8264578209241474849" onmouseenter="enter('-8264578209241474849');" onmouseout="out('-8264578209241474849');" style="">1084          int width = bitmap.getWidth();                                                                            </span>
<span class="579214017182008882" onmouseenter="enter('579214017182008882');" onmouseout="out('579214017182008882');" style="">1085          int height = bitmap.getHeight();                                                                          </span>
<span class="-5468132095560190208" onmouseenter="enter('-5468132095560190208');" onmouseout="out('-5468132095560190208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1086 -        byte bmp[] = new byte[((height * width + 7) &gt;&gt; 3) + 3];                                                   </span>
<span class="-8063747109253331105" onmouseenter="enter('-8063747109253331105');" onmouseout="out('-8063747109253331105');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1087 -        int n = 0, c = 0, cn = 0;                                                                                 </span>
<span class="-650429588605459357" onmouseenter="enter('-650429588605459357');" onmouseout="out('-650429588605459357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1088 -        bmp[n++] = (byte)width;                                                                                   </span>
<span class="-8266527298740840983" onmouseenter="enter('-8266527298740840983');" onmouseout="out('-8266527298740840983');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1089 -        bmp[n++] = (byte)height;                                                                                  </span>
<span class="5057379001520513130" onmouseenter="enter('5057379001520513130');" onmouseout="out('5057379001520513130');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1090 -        bmp[n++] = 1;                                                                                             </span>
<span class="62095710955205844" onmouseenter="enter('62095710955205844');" onmouseout="out('62095710955205844');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1091 +        int bpp = (style==BangleJSBitmapStyle.RGB_3BPP) ? 3 : 1;                                                  </span>
<span class="2569753333792437088" onmouseenter="enter('2569753333792437088');" onmouseout="out('2569753333792437088');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1092 +        byte pixels[] = new byte[width * height];                                                                 </span>
<span class="-8781894220114795181" onmouseenter="enter('-8781894220114795181');" onmouseout="out('-8781894220114795181');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1093 +        final byte PIXELCOL_TRANSPARENT = -1;                                                                     </span>
<span class="6803383238845196993" onmouseenter="enter('6803383238845196993');" onmouseout="out('6803383238845196993');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1094 +        final int ditherMatrix[] = {1*16,5*16,7*16,3*16}; // for bayer dithering                                  </span>
<span class="7959981185777845703" onmouseenter="enter('7959981185777845703');" onmouseout="out('7959981185777845703');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1095 +        // if doing 3bpp, check image to see if it&#x27;s transparent                                                  </span>
<span class="2206517053249792991" onmouseenter="enter('2206517053249792991');" onmouseout="out('2206517053249792991');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1096 +        boolean allowTransparency = (style != BangleJSBitmapStyle.MONOCHROME);                                    </span>
<span class="-37573379981503148" onmouseenter="enter('-37573379981503148');" onmouseout="out('-37573379981503148');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1097 +        boolean isTransparent = false;                                                                            </span>
<span class="7994078972417264550" onmouseenter="enter('7994078972417264550');" onmouseout="out('7994078972417264550');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1098 +        byte transparentColorIndex = 0;                                                                           </span>
<span class="4545384496906809483" onmouseenter="enter('4545384496906809483');" onmouseout="out('4545384496906809483');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1099 +        /* Work out what colour index each pixel should be and write to pixels.                                   </span>
<span class="-816286840416722331" onmouseenter="enter('-816286840416722331');" onmouseout="out('-816286840416722331');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1100 +         Also figure out if we&#x27;re transparent at all, and how often each color is used */                         </span>
<span class="-3015935700404012624" onmouseenter="enter('-3015935700404012624');" onmouseout="out('-3015935700404012624');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1101 +        int colUsage[] = new int[8];                                                                              </span>
<span class="-1168375646381031328" onmouseenter="enter('-1168375646381031328');" onmouseout="out('-1168375646381031328');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1102 +        int n = 0;                                                                                                </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1103          for (int y = 0; y &lt; height; y++) {                                                                        </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1104              for (int x = 0; x &lt; width; x++) {                                                                     </span>
<span class="-771115154633897268" onmouseenter="enter('-771115154633897268');" onmouseout="out('-771115154633897268');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1105 -                boolean pixel = (bitmap.getPixel(x, y) &amp; 255) &gt; 128;                                              </span>
<span class="6674653668556692298" onmouseenter="enter('6674653668556692298');" onmouseout="out('6674653668556692298');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1106 -                c = (c &lt;&lt; 1) | (pixel?1:0);                                                                       </span>
<span class="9172772233428286483" onmouseenter="enter('9172772233428286483');" onmouseout="out('9172772233428286483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1107 -                cn++;                                                                                             </span>
<span class="-448289942795796071" onmouseenter="enter('-448289942795796071');" onmouseout="out('-448289942795796071');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1108 -                if (cn == 8) {                                                                                    </span>
<span class="3052733147797367046" onmouseenter="enter('3052733147797367046');" onmouseout="out('3052733147797367046');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1109 -                    bmp[n++] = (byte)c;                                                                           </span>
<span class="6564409203482604272" onmouseenter="enter('6564409203482604272');" onmouseout="out('6564409203482604272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1110 -                    cn = 0;                                                                                       </span>
<span class="2474985583203145484" onmouseenter="enter('2474985583203145484');" onmouseout="out('2474985583203145484');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1111 -                    c = 0;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1112 -                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1113 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1114 -        }                                                                                                         </span>
<span class="-8164484178145478016" onmouseenter="enter('-8164484178145478016');" onmouseout="out('-8164484178145478016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1115 -        if (cn &gt; 0) bmp[n++] = (byte)c;                                                                           </span>
<span class="7173512941781537638" onmouseenter="enter('7173512941781537638');" onmouseout="out('7173512941781537638');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1116 -        //LOG.info(&quot;BMP: &quot; + width + &quot;x&quot;+height+&quot; n &quot;+n);                                                         </span>
<span class="5324835058640739880" onmouseenter="enter('5324835058640739880');" onmouseout="out('5324835058640739880');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1117 -        // Convert to base64                                                                                      </span>
<span class="-2101137108834168285" onmouseenter="enter('-2101137108834168285');" onmouseout="out('-2101137108834168285');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1118 +                int pixel = bitmap.getPixel(x, y);                                                                </span>
<span class="-7873265173430592100" onmouseenter="enter('-7873265173430592100');" onmouseout="out('-7873265173430592100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1119 +                int r = pixel &amp; 255;                                                                              </span>
<span class="5214305336064064060" onmouseenter="enter('5214305336064064060');" onmouseout="out('5214305336064064060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1120 +                int g = (pixel &gt;&gt; 8) &amp; 255;                                                                       </span>
<span class="-8611762025314058231" onmouseenter="enter('-8611762025314058231');" onmouseout="out('-8611762025314058231');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1121 +                int b = (pixel &gt;&gt; 16) &amp; 255;                                                                      </span>
<span class="4540615999107180416" onmouseenter="enter('4540615999107180416');" onmouseout="out('4540615999107180416');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1122 +                int a = (pixel &gt;&gt; 24) &amp; 255;                                                                      </span>
<span class="-7690440557473777446" onmouseenter="enter('-7690440557473777446');" onmouseout="out('-7690440557473777446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1123 +                boolean pixelTransparent = allowTransparency &amp;&amp; (a &lt; 128);                                        </span>
<span class="8857737978256656560" onmouseenter="enter('8857737978256656560');" onmouseout="out('8857737978256656560');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1124 +                if (pixelTransparent) {                                                                           </span>
<span class="4144053758920166277" onmouseenter="enter('4144053758920166277');" onmouseout="out('4144053758920166277');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1125 +                    isTransparent = true;                                                                         </span>
<span class="-1483564027931343691" onmouseenter="enter('-1483564027931343691');" onmouseout="out('-1483564027931343691');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1126 +                    r = g = b = 0;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1127 +                }                                                                                                 </span>
<span class="7892385962647882401" onmouseenter="enter('7892385962647882401');" onmouseout="out('7892385962647882401');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1128 +                // do dithering here                                                                              </span>
<span class="-1753549363475258451" onmouseenter="enter('-1753549363475258451');" onmouseout="out('-1753549363475258451');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1129 +                int ditherAmt = ditherMatrix[(x&amp;1) + (y&amp;1)*2];                                                    </span>
<span class="-5333286516522955764" onmouseenter="enter('-5333286516522955764');" onmouseout="out('-5333286516522955764');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1130 +                r += ditherAmt;                                                                                   </span>
<span class="-3777395832470098990" onmouseenter="enter('-3777395832470098990');" onmouseout="out('-3777395832470098990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1131 +                g += ditherAmt;                                                                                   </span>
<span class="-5891859440152819561" onmouseenter="enter('-5891859440152819561');" onmouseout="out('-5891859440152819561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1132 +                b += ditherAmt;                                                                                   </span>
<span class="1554400584909279790" onmouseenter="enter('1554400584909279790');" onmouseout="out('1554400584909279790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1133 +                int col = 0;                                                                                      </span>
<span class="418637413535106488" onmouseenter="enter('418637413535106488');" onmouseout="out('418637413535106488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1134 +                if (style == BangleJSBitmapStyle.MONOCHROME)                                                      </span>
<span class="7187319285928422906" onmouseenter="enter('7187319285928422906');" onmouseout="out('7187319285928422906');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1135 +                    col = ((r+g+b) &gt;= 768)?1:0;                                                                   </span>
<span class="-9158255213257007445" onmouseenter="enter('-9158255213257007445');" onmouseout="out('-9158255213257007445');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1136 +                else if (style == BangleJSBitmapStyle.RGB_3BPP)                                                   </span>
<span class="6807772790369921462" onmouseenter="enter('6807772790369921462');" onmouseout="out('6807772790369921462');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1137 +                    col = ((r&gt;=256)?1:0) | ((g&gt;=256)?2:0) | ((b&gt;=256)?4:0);                                       </span>
<span class="-8103715039558456046" onmouseenter="enter('-8103715039558456046');" onmouseout="out('-8103715039558456046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1138 +                if (!pixelTransparent) colUsage[col]++; // if not transparent, record usage                       </span>
<span class="4219755117683718437" onmouseenter="enter('4219755117683718437');" onmouseout="out('4219755117683718437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1139 +                // save colour, mark transparent separately                                                       </span>
<span class="9129530588794156450" onmouseenter="enter('9129530588794156450');" onmouseout="out('9129530588794156450');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1140 +                pixels[n++] = (byte)(pixelTransparent ? PIXELCOL_TRANSPARENT : col);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1141 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1142 +        }                                                                                                         </span>
<span class="-7238986996251945663" onmouseenter="enter('-7238986996251945663');" onmouseout="out('-7238986996251945663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1143 +        // if we&#x27;re transparent, find the least-used color, and use that for transparency                         </span>
<span class="-3011917059987129784" onmouseenter="enter('-3011917059987129784');" onmouseout="out('-3011917059987129784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1144 +        if (isTransparent) {                                                                                      </span>
<span class="-8837844203179481085" onmouseenter="enter('-8837844203179481085');" onmouseout="out('-8837844203179481085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1145 +            // find least used                                                                                    </span>
<span class="-2156609844502175267" onmouseenter="enter('-2156609844502175267');" onmouseout="out('-2156609844502175267');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1146 +            int minColUsage = -1;                                                                                 </span>
<span class="-722001860546824180" onmouseenter="enter('-722001860546824180');" onmouseout="out('-722001860546824180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1147 +            for (int c=0;c&lt;8;c++) {                                                                               </span>
<span class="4418845972840093199" onmouseenter="enter('4418845972840093199');" onmouseout="out('4418845972840093199');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1148 +                if (minColUsage&lt;0 || colUsage[c]&lt;minColUsage) {                                                   </span>
<span class="5318194882336838338" onmouseenter="enter('5318194882336838338');" onmouseout="out('5318194882336838338');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1149 +                    minColUsage = colUsage[c];                                                                    </span>
<span class="1332179475621902578" onmouseenter="enter('1332179475621902578');" onmouseout="out('1332179475621902578');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1150 +                    transparentColorIndex = (byte)c;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1151 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1152 +            }                                                                                                     </span>
<span class="-6360425578627405201" onmouseenter="enter('-6360425578627405201');" onmouseout="out('-6360425578627405201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1153 +            // rewrite any transparent pixels as the correct color for transparency                               </span>
<span class="-6081737035071239023" onmouseenter="enter('-6081737035071239023');" onmouseout="out('-6081737035071239023');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1154 +            for (n=0;n&lt;pixels.length;n++)                                                                         </span>
<span class="-5898303404019142000" onmouseenter="enter('-5898303404019142000');" onmouseout="out('-5898303404019142000');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1155 +                if (pixels[n]==PIXELCOL_TRANSPARENT)                                                              </span>
<span class="2866860587696074876" onmouseenter="enter('2866860587696074876');" onmouseout="out('2866860587696074876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1156 +                    pixels[n] = transparentColorIndex;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1157 +        }                                                                                                         </span>
<span class="2745980283769036105" onmouseenter="enter('2745980283769036105');" onmouseout="out('2745980283769036105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1158 +        // Write the header                                                                                       </span>
<span class="-1351042579972959800" onmouseenter="enter('-1351042579972959800');" onmouseout="out('-1351042579972959800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1159 +        int headerLen = isTransparent ? 4 : 3;                                                                    </span>
<span class="-1842770092995408603" onmouseenter="enter('-1842770092995408603');" onmouseout="out('-1842770092995408603');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1160 +        byte bmp[] = new byte[(((height * width * bpp) + 7) &gt;&gt; 3) + headerLen];                                   </span>
<span class="-2931355111361492552" onmouseenter="enter('-2931355111361492552');" onmouseout="out('-2931355111361492552');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1161 +        bmp[0] = (byte)width;                                                                                     </span>
<span class="7001926567865572655" onmouseenter="enter('7001926567865572655');" onmouseout="out('7001926567865572655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1162 +        bmp[1] = (byte)height;                                                                                    </span>
<span class="-237013155551245034" onmouseenter="enter('-237013155551245034');" onmouseout="out('-237013155551245034');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1163 +        bmp[2] = (byte)(bpp + (isTransparent?128:0));                                                             </span>
<span class="6762716390198046926" onmouseenter="enter('6762716390198046926');" onmouseout="out('6762716390198046926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1164 +        if (isTransparent) bmp[3] = transparentColorIndex;                                                        </span>
<span class="8478354166162352997" onmouseenter="enter('8478354166162352997');" onmouseout="out('8478354166162352997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1165 +        // Now write the image out bit by bit                                                                     </span>
<span class="344926378213754405" onmouseenter="enter('344926378213754405');" onmouseout="out('344926378213754405');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1166 +        BitWriter bits = new BitWriter(bmp, headerLen);                                                           </span>
<span class="-3260558023763679626" onmouseenter="enter('-3260558023763679626');" onmouseout="out('-3260558023763679626');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1167 +        n = 0;                                                                                                    </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1168 +        for (int y = 0; y &lt; height; y++) {                                                                        </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1169 +            for (int x = 0; x &lt; width; x++) {                                                                     </span>
<span class="593941254526452666" onmouseenter="enter('593941254526452666');" onmouseout="out('593941254526452666');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1170 +                int pixel = pixels[n++];                                                                          </span>
<span class="-1551860236924517479" onmouseenter="enter('-1551860236924517479');" onmouseout="out('-1551860236924517479');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1171 +                for (int b=bpp-1;b&gt;=0;b--)                                                                        </span>
<span class="-5304162960169081882" onmouseenter="enter('-5304162960169081882');" onmouseout="out('-5304162960169081882');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1172 +                    bits.push(((pixel&gt;&gt;b)&amp;1) != 0);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1173 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1174 +        }                                                                                                         </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1175          return bmp;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1176      }                                                                                                             </span>
<span  style="">1177                                                                                                                    </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1178      /** Convert an Android bitmap to a base64 string for use in Espruino.                                         </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1179       * Currently only 1bpp, no scaling */                                                                         </span>
<span class="-4487821626516184731" onmouseenter="enter('-4487821626516184731');" onmouseout="out('-4487821626516184731');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1180 -    public static String bitmapToEspruinoString(Bitmap bitmap) {                                                  </span>
<span class="8233707567119166127" onmouseenter="enter('8233707567119166127');" onmouseout="out('8233707567119166127');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1181 -        return new String(bitmapToEspruinoArray(bitmap), StandardCharsets.ISO_8859_1);                            </span>
<span class="8132909775831713515" onmouseenter="enter('8132909775831713515');" onmouseout="out('8132909775831713515');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1182 +    public static String bitmapToEspruinoString(Bitmap bitmap, BangleJSBitmapStyle style) {                       </span>
<span class="-259762080887441901" onmouseenter="enter('-259762080887441901');" onmouseout="out('-259762080887441901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1183 +        return new String(bitmapToEspruinoArray(bitmap, style), StandardCharsets.ISO_8859_1);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1184      }                                                                                                             </span>
<span  style="">1185                                                                                                                    </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1186      /** Convert an Android bitmap to a base64 string for use in Espruino.                                         </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1187       * Currently only 1bpp, no scaling */                                                                         </span>
<span class="2266332245921000841" onmouseenter="enter('2266332245921000841');" onmouseout="out('2266332245921000841');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1188 -    public static String bitmapToEspruinoBase64(Bitmap bitmap) {                                                  </span>
<span class="-4423749523808680087" onmouseenter="enter('-4423749523808680087');" onmouseout="out('-4423749523808680087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1189 -        return Base64.encodeToString(bitmapToEspruinoArray(bitmap), Base64.DEFAULT).replaceAll(&quot;\n&quot;,&quot;&quot;);          </span>
<span class="3005879465184206786" onmouseenter="enter('3005879465184206786');" onmouseout="out('3005879465184206786');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1190 +    public static String bitmapToEspruinoBase64(Bitmap bitmap, BangleJSBitmapStyle style) {                       </span>
<span class="-5699216721301532414" onmouseenter="enter('-5699216721301532414');" onmouseout="out('-5699216721301532414');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1191 +        return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\n&quot;,&quot;&quot;);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1192      }                                                                                                             </span>
<span  style="">1193                                                                                                                    </span>
<span class="-3553936365177536696" onmouseenter="enter('-3553936365177536696');" onmouseout="out('-3553936365177536696');" style="">1194      /** Convert a drawable to a bitmap, for use with bitmapToEspruino */                                          </span>
<span class="3383127324214077694" onmouseenter="enter('3383127324214077694');" onmouseout="out('3383127324214077694');" style="">1195      public static Bitmap drawableToBitmap(Drawable drawable) {                                                    </span>
<span class="5888468731770076773" onmouseenter="enter('5888468731770076773');" onmouseout="out('5888468731770076773');" style="">1196          final int maxWidth = 32;                                                                                  </span>
<span class="1045468429082287724" onmouseenter="enter('1045468429082287724');" onmouseout="out('1045468429082287724');" style="">1197          final int maxHeight = 32;                                                                                 </span>
<span class="2296952793490653309" onmouseenter="enter('2296952793490653309');" onmouseout="out('2296952793490653309');" style="">1198          /* Return bitmap directly but only if it&#x27;s small enough. It could be                                      </span>
<span class="5951543220377437420" onmouseenter="enter('5951543220377437420');" onmouseout="out('5951543220377437420');" style="">1199          we have a bitmap but it&#x27;s just too big to send direct to the bangle */                                    </span>
<span class="256873417632096091" onmouseenter="enter('256873417632096091');" onmouseout="out('256873417632096091');" style="">1200          if (drawable instanceof BitmapDrawable) {                                                                 </span>
<span class="-5943336945219947575" onmouseenter="enter('-5943336945219947575');" onmouseout="out('-5943336945219947575');" style="">1201              BitmapDrawable bitmapDrawable = (BitmapDrawable) drawable;                                            </span>
<span class="3248690101517469022" onmouseenter="enter('3248690101517469022');" onmouseout="out('3248690101517469022');" style="">1202              Bitmap bmp = bitmapDrawable.getBitmap();                                                              </span>
<span class="-7540961171633243123" onmouseenter="enter('-7540961171633243123');" onmouseout="out('-7540961171633243123');" style="">1203              if (bmp != null &amp;&amp; bmp.getWidth()&lt;=maxWidth &amp;&amp; bmp.getHeight()&lt;=maxHeight)                            </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1204                  return bmp;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1205          }                                                                                                         </span>
<span class="-1267243917470848355" onmouseenter="enter('-1267243917470848355');" onmouseout="out('-1267243917470848355');" style="">1206          /* Otherwise render this to a bitmap ourselves.. work out size */                                         </span>
<span class="4014031002419706861" onmouseenter="enter('4014031002419706861');" onmouseout="out('4014031002419706861');" style="">1207          int w = maxWidth;                                                                                         </span>
<span class="7839465956667040099" onmouseenter="enter('7839465956667040099');" onmouseout="out('7839465956667040099');" style="">1208          int h = maxHeight;                                                                                        </span>
<span class="-8364515267334494119" onmouseenter="enter('-8364515267334494119');" onmouseout="out('-8364515267334494119');" style="">1209          if (drawable.getIntrinsicWidth() &gt; 0 &amp;&amp; drawable.getIntrinsicHeight() &gt; 0) {                              </span>
<span class="7888521624075720743" onmouseenter="enter('7888521624075720743');" onmouseout="out('7888521624075720743');" style="">1210              w = drawable.getIntrinsicWidth();                                                                     </span>
<span class="-8527253388982325533" onmouseenter="enter('-8527253388982325533');" onmouseout="out('-8527253388982325533');" style="">1211              h = drawable.getIntrinsicHeight();                                                                    </span>
<span class="1937935127293972578" onmouseenter="enter('1937935127293972578');" onmouseout="out('1937935127293972578');" style="">1212              // don&#x27;t allocate anything too big, but keep the ratio                                                </span>
<span class="-3040808582930904343" onmouseenter="enter('-3040808582930904343');" onmouseout="out('-3040808582930904343');" style="">1213              if (w&gt;maxWidth) {                                                                                     </span>
<span class="3961818778152175494" onmouseenter="enter('3961818778152175494');" onmouseout="out('3961818778152175494');" style="">1214                  h = h * maxWidth / w;                                                                             </span>
<span class="-810617720622075293" onmouseenter="enter('-810617720622075293');" onmouseout="out('-810617720622075293');" style="">1215                  w = maxWidth;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1216              }                                                                                                     </span>
<span class="-8361662207911676693" onmouseenter="enter('-8361662207911676693');" onmouseout="out('-8361662207911676693');" style="">1217              if (h&gt;maxHeight) {                                                                                    </span>
<span class="-4098427333168952513" onmouseenter="enter('-4098427333168952513');" onmouseout="out('-4098427333168952513');" style="">1218                  w = w * maxHeight / h;                                                                            </span>
<span class="3192577241527884586" onmouseenter="enter('3192577241527884586');" onmouseout="out('3192577241527884586');" style="">1219                  h = maxHeight;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1220              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1221          }                                                                                                         </span>
<span class="5796017605604363662" onmouseenter="enter('5796017605604363662');" onmouseout="out('5796017605604363662');" style="">1222          /* render */                                                                                              </span>
<span class="2390903888286128230" onmouseenter="enter('2390903888286128230');" onmouseout="out('2390903888286128230');" style=""><abbr title="1223          Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will be created of 1x1 pixel">1223          Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will be createdðŸ”µ</abbr></span>
<span class="-8462009662057840967" onmouseenter="enter('-8462009662057840967');" onmouseout="out('-8462009662057840967');" style="">1224          Canvas canvas = new Canvas(bitmap);                                                                       </span>
<span class="8202941983594652957" onmouseenter="enter('8202941983594652957');" onmouseout="out('8202941983594652957');" style="">1225          drawable.setBounds(0, 0, canvas.getWidth(), canvas.getHeight());                                          </span>
<span class="-8639362966527052788" onmouseenter="enter('-8639362966527052788');" onmouseout="out('-8639362966527052788');" style="">1226          drawable.draw(canvas);                                                                                    </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style="">1227          return bitmap;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1228      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1229  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="7867943778411854368" onmouseenter="enter('7867943778411854368');" onmouseout="out('7867943778411854368');" style="">   1  /*  Copyright (C) 2019-2021 Andreas Shimokawa, Gordon Williams                                                    </span>
<span  style="">   2                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   4                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8      (at your option) any later version.                                                                           </span>
<span  style="">   9                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  14                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="-588248541382154970" onmouseenter="enter('-588248541382154970');" onmouseout="out('-588248541382154970');" style="">  17  package nodomain.freeyourgadget.gadgetbridge.service.devices.banglejs;                                            </span>
<span  style="">  18                                                                                                                    </span>
<span class="2440823415412133066" onmouseenter="enter('2440823415412133066');" onmouseout="out('2440823415412133066');" style="">  19  import android.bluetooth.BluetoothGatt;                                                                           </span>
<span class="4736969144974683041" onmouseenter="enter('4736969144974683041');" onmouseout="out('4736969144974683041');" style="">  20  import android.bluetooth.BluetoothGattCharacteristic;                                                             </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  21  import android.content.BroadcastReceiver;                                                                         </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  22  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  23  import android.content.Intent;                                                                                    </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  24  import android.content.IntentFilter;                                                                              </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  25  import android.graphics.Bitmap;                                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  26  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  27  import android.graphics.Canvas;                                                                                   </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  28  import android.graphics.Paint;                                                                                    </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  29  import android.graphics.drawable.BitmapDrawable;                                                                  </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  30  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="">  31  import android.net.Uri;                                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  32  import android.util.Base64;                                                                                       </span>
<span class="-4373317539211938720" onmouseenter="enter('-4373317539211938720');" onmouseout="out('-4373317539211938720');" style="">  33  import android.widget.Toast;                                                                                      </span>
<span  style="">  34                                                                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  35  import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                              </span>
<span  style="">  36                                                                                                                    </span>
<span class="3171981379522900271" onmouseenter="enter('3171981379522900271');" onmouseout="out('3171981379522900271');" style="">  37  import com.android.volley.Request;                                                                                </span>
<span class="4430867795468484324" onmouseenter="enter('4430867795468484324');" onmouseout="out('4430867795468484324');" style="">  38  import com.android.volley.Response;                                                                               </span>
<span class="-6875921712592050045" onmouseenter="enter('-6875921712592050045');" onmouseout="out('-6875921712592050045');" style="">  39  import com.android.volley.RequestQueue;                                                                           </span>
<span class="7596528640051210243" onmouseenter="enter('7596528640051210243');" onmouseout="out('7596528640051210243');" style="">  40  import com.android.volley.VolleyError;                                                                            </span>
<span class="-6338542844679972782" onmouseenter="enter('-6338542844679972782');" onmouseout="out('-6338542844679972782');" style="">  41  import com.android.volley.toolbox.StringRequest;                                                                  </span>
<span class="4822020902022089151" onmouseenter="enter('4822020902022089151');" onmouseout="out('4822020902022089151');" style="">  42  import com.android.volley.toolbox.Volley;                                                                         </span>
<span  style="">  43                                                                                                                    </span>
<span class="-9193129351684262878" onmouseenter="enter('-9193129351684262878');" onmouseout="out('-9193129351684262878');" style="">  44  import org.json.JSONArray;                                                                                        </span>
<span class="-8573375701834280359" onmouseenter="enter('-8573375701834280359');" onmouseout="out('-8573375701834280359');" style="">  45  import org.json.JSONException;                                                                                    </span>
<span class="7232075261178918144" onmouseenter="enter('7232075261178918144');" onmouseout="out('7232075261178918144');" style="">  46  import org.json.JSONObject;                                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  47  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  48  import org.slf4j.LoggerFactory;                                                                                   </span>
<span class="-2051516048009622280" onmouseenter="enter('-2051516048009622280');" onmouseout="out('-2051516048009622280');" style="">  49  import org.xml.sax.InputSource;                                                                                   </span>
<span  style="">  50                                                                                                                    </span>
<span class="-6983162919371453239" onmouseenter="enter('-6983162919371453239');" onmouseout="out('-6983162919371453239');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +import java.io.BufferedWriter;                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +import java.io.File;                                                                                              </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +import java.io.FileOutputStream;                                                                                  </span>
<span class="4914725365521379617" onmouseenter="enter('4914725365521379617');" onmouseout="out('4914725365521379617');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +import java.io.FileWriter;                                                                                        </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  55  import java.io.IOException;                                                                                       </span>
<span class="4087034682117787535" onmouseenter="enter('4087034682117787535');" onmouseout="out('4087034682117787535');" style="">  56  import java.io.StringReader;                                                                                      </span>
<span class="-2624565711555737384" onmouseenter="enter('-2624565711555737384');" onmouseout="out('-2624565711555737384');" style="">  57  import java.nio.charset.StandardCharsets;                                                                         </span>
<span class="54331962280914690" onmouseenter="enter('54331962280914690');" onmouseout="out('54331962280914690');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +import java.text.SimpleDateFormat;                                                                                </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  59  import java.util.ArrayList;                                                                                       </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  60  import java.util.Calendar;                                                                                        </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +import java.util.Date;                                                                                            </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  62  import java.util.GregorianCalendar;                                                                               </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  63  import java.util.HashMap;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  64  import java.util.Iterator;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +import java.util.List;                                                                                            </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +import java.util.Locale;                                                                                          </span>
<span class="8860446888132102879" onmouseenter="enter('8860446888132102879');" onmouseout="out('8860446888132102879');" style="">  67  import java.util.SimpleTimeZone;                                                                                  </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  68  import java.util.UUID;                                                                                            </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  69  import java.lang.reflect.Field;                                                                                   </span>
<span  style="">  70                                                                                                                    </span>
<span class="-3163672285055708144" onmouseenter="enter('-3163672285055708144');" onmouseout="out('-3163672285055708144');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +import io.wax911.emojify.Emoji;                                                                                   </span>
<span class="6994093753897510849" onmouseenter="enter('6994093753897510849');" onmouseout="out('6994093753897510849');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +import io.wax911.emojify.EmojiManager;                                                                            </span>
<span class="-2985037039232163872" onmouseenter="enter('-2985037039232163872');" onmouseout="out('-2985037039232163872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +import io.wax911.emojify.EmojiUtils;                                                                              </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  74  import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                          </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  75  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  76  import nodomain.freeyourgadget.gadgetbridge.R;                                                                    </span>
<span class="-141107564105590930" onmouseenter="enter('-141107564105590930');" onmouseout="out('-141107564105590930');" style="">  77  import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst;              </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  78  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  79  import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                                    </span>
<span class="-3005335786085073829" onmouseenter="enter('-3005335786085073829');" onmouseout="out('-3005335786085073829');" style="">  80  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventBatteryInfo;                                </span>
<span class="7017557905176594961" onmouseenter="enter('7017557905176594961');" onmouseout="out('7017557905176594961');" style="">  81  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventCallControl;                                </span>
<span class="6368471362458763033" onmouseenter="enter('6368471362458763033');" onmouseout="out('6368471362458763033');" style="">  82  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventFindPhone;                                  </span>
<span class="4012861689788039008" onmouseenter="enter('4012861689788039008');" onmouseout="out('4012861689788039008');" style="">  83  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventMusicControl;                               </span>
<span class="-5203005511074004401" onmouseenter="enter('-5203005511074004401');" onmouseout="out('-5203005511074004401');" style="">  84  import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEventNotificationControl;                        </span>
<span class="4252572397761323695" onmouseenter="enter('4252572397761323695');" onmouseout="out('4252572397761323695');" style="">  85  import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSConstants;                                   </span>
<span class="8687478736174414119" onmouseenter="enter('8687478736174414119');" onmouseout="out('8687478736174414119');" style="">  86  import nodomain.freeyourgadget.gadgetbridge.devices.banglejs.BangleJSSampleProvider;                              </span>

<span class="8046368326334810504" onmouseenter="enter('8046368326334810504');" onmouseout="out('8046368326334810504');" style="">  87  import nodomain.freeyourgadget.gadgetbridge.entities.BangleJSActivitySample;                                      </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  88  import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                                        </span>
<span class="5185434099904652174" onmouseenter="enter('5185434099904652174');" onmouseout="out('5185434099904652174');" style="">  89  import nodomain.freeyourgadget.gadgetbridge.model.ActivityKind;                                                   </span>
<span class="-8766238562391910018" onmouseenter="enter('-8766238562391910018');" onmouseout="out('-8766238562391910018');" style="">  90  import nodomain.freeyourgadget.gadgetbridge.model.Alarm;                                                          </span>
<span class="2021957179005285653" onmouseenter="enter('2021957179005285653');" onmouseout="out('2021957179005285653');" style="">  91  import nodomain.freeyourgadget.gadgetbridge.model.BatteryState;                                                   </span>
<span class="-3899388208810973608" onmouseenter="enter('-3899388208810973608');" onmouseout="out('-3899388208810973608');" style="">  92  import nodomain.freeyourgadget.gadgetbridge.model.CalendarEventSpec;                                              </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  93  import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                                       </span>
<span class="-7415926539738049206" onmouseenter="enter('-7415926539738049206');" onmouseout="out('-7415926539738049206');" style="">  94  import nodomain.freeyourgadget.gadgetbridge.model.CannedMessagesSpec;                                             </span>
<span class="308285905299900254" onmouseenter="enter('308285905299900254');" onmouseout="out('308285905299900254');" style="">  95  import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;                                                  </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  96  import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                                      </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  97  import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                                 </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  98  import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                               </span>
<span class="-3277000154202836222" onmouseenter="enter('-3277000154202836222');" onmouseout="out('-3277000154202836222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +import nodomain.freeyourgadget.gadgetbridge.model.RecordedDataTypes;                                              </span>
<span class="-40839721936664146" onmouseenter="enter('-40839721936664146');" onmouseout="out('-40839721936664146');" style=""> 100  import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;                                                    </span>
<span class="4344228987867394358" onmouseenter="enter('4344228987867394358');" onmouseout="out('4344228987867394358');" style=""> 101  import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLEDeviceSupport;                               </span>
<span class="3410519392510510669" onmouseenter="enter('3410519392510510669');" onmouseout="out('3410519392510510669');" style=""> 102  import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;                                      </span>

<span class="-9148468836908617343" onmouseenter="enter('-9148468836908617343');" onmouseout="out('-9148468836908617343');" style=""> 103  import nodomain.freeyourgadget.gadgetbridge.util.AlarmUtils;                                                      </span>
<span class="-8051705910484913631" onmouseenter="enter('-8051705910484913631');" onmouseout="out('-8051705910484913631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +import nodomain.freeyourgadget.gadgetbridge.util.EmojiConverter;                                                  </span>
<span class="-2020231768395052380" onmouseenter="enter('-2020231768395052380');" onmouseout="out('-2020231768395052380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +import nodomain.freeyourgadget.gadgetbridge.util.FileUtils;                                                       </span>
<span class="-3798970344596478499" onmouseenter="enter('-3798970344596478499');" onmouseout="out('-3798970344596478499');" style=""> 106  import nodomain.freeyourgadget.gadgetbridge.util.GB;                                                              </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                                    </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style=""> 108  import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                           </span>
<span  style=""> 109                                                                                                                    </span>
<span class="-2225725182537405146" onmouseenter="enter('-2225725182537405146');" onmouseout="out('-2225725182537405146');" style=""><abbr title=" 110  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_ALLOW_HIGH_MTU;"> 110  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_ALðŸ”µ</abbr></span>
<span class="2440588347549655822" onmouseenter="enter('2440588347549655822');" onmouseout="out('2440588347549655822');" style=""><abbr title=" 111  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTERNET_ACCESS;"> 111  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEðŸ”µ</abbr></span>
<span class="-5321063140707926105" onmouseenter="enter('-5321063140707926105');" onmouseout="out('-5321063140707926105');" style=""><abbr title=" 112  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEVICE_INTENTS;"> 112  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_DEðŸ”µ</abbr></span>
<span class="1576087340720410961" onmouseenter="enter('1576087340720410961');" onmouseout="out('1576087340720410961');" style=""><abbr title=" 113  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_BANGLEJS_TEXT_BITMAP;"> 113  import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_BAðŸ”µ</abbr></span>
<span class="-7620522862868556032" onmouseenter="enter('-7620522862868556032');" onmouseout="out('-7620522862868556032');" style=""> 114  import static nodomain.freeyourgadget.gadgetbridge.database.DBHelper.*;                                           </span>
<span  style=""> 115                                                                                                                    </span>
<span class="-6525955205891456613" onmouseenter="enter('-6525955205891456613');" onmouseout="out('-6525955205891456613');" style=""> 116  import javax.xml.xpath.XPath;                                                                                     </span>
<span class="948957029946951050" onmouseenter="enter('948957029946951050');" onmouseout="out('948957029946951050');" style=""> 117  import javax.xml.xpath.XPathFactory;                                                                              </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-4540174980983528222" onmouseenter="enter('-4540174980983528222');" onmouseout="out('-4540174980983528222');" style=""> 119  public class BangleJSDeviceSupport extends AbstractBTLEDeviceSupport {                                            </span>
<span class="5737832610637191351" onmouseenter="enter('5737832610637191351');" onmouseout="out('5737832610637191351');" style=""> 120      private static final Logger LOG = LoggerFactory.getLogger(BangleJSDeviceSupport.class);                       </span>
<span  style=""> 121                                                                                                                    </span>
<span class="-1874769646843493640" onmouseenter="enter('-1874769646843493640');" onmouseout="out('-1874769646843493640');" style=""> 122      private BluetoothGattCharacteristic rxCharacteristic = null;                                                  </span>
<span class="3394422526290177606" onmouseenter="enter('3394422526290177606');" onmouseout="out('3394422526290177606');" style=""> 123      private BluetoothGattCharacteristic txCharacteristic = null;                                                  </span>
<span class="4278598336110524029" onmouseenter="enter('4278598336110524029');" onmouseout="out('4278598336110524029');" style=""> 124      private boolean allowHighMTU = false;                                                                         </span>
<span class="4758769595687694218" onmouseenter="enter('4758769595687694218');" onmouseout="out('4758769595687694218');" style=""> 125      private int mtuSize = 20;                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -                                                                                                                  </span>
<span class="-5210712730292226171" onmouseenter="enter('-5210712730292226171');" onmouseout="out('-5210712730292226171');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +    int bangleCommandSeq = 0; // to attempt to stop duplicate packets when sending Local Intents                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +                                                                                                                  </span>
<span class="1561011760409728503" onmouseenter="enter('1561011760409728503');" onmouseout="out('1561011760409728503');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +    /// Current line of data received from Bangle.js                                                              </span>
<span class="-848193569484274658" onmouseenter="enter('-848193569484274658');" onmouseout="out('-848193569484274658');" style=""> 130      private String receivedLine = &quot;&quot;;                                                                             </span>
<span class="7842135007952282839" onmouseenter="enter('7842135007952282839');" onmouseout="out('7842135007952282839');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 131 +    /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS). Can be dumped with &#x27;Fetch Device Debug Logs&#x27; from Debug menu"> 131 +    /// All characters received from Bangle.js for debug purposes (limited to MAX_RECEIVE_HISTORY_CHARS). Can be dðŸ”µ</abbr></span>
<span class="-7872820322050208046" onmouseenter="enter('-7872820322050208046');" onmouseout="out('-7872820322050208046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +    private String receiveHistory = &quot;&quot;;                                                                           </span>
<span class="-3915326133595600019" onmouseenter="enter('-3915326133595600019');" onmouseout="out('-3915326133595600019');" style=""> 133      private boolean realtimeHRM = false;                                                                          </span>
<span class="-4342711334813376852" onmouseenter="enter('-4342711334813376852');" onmouseout="out('-4342711334813376852');" style=""> 134      private boolean realtimeStep = false;                                                                         </span>
<span class="-785214995925481662" onmouseenter="enter('-785214995925481662');" onmouseout="out('-785214995925481662');" style=""> 135      private int realtimeHRMInterval = 30*60;                                                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +                                                                                                                  </span>
<span class="7817012674261800607" onmouseenter="enter('7817012674261800607');" onmouseout="out('7817012674261800607');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +    private final LimitedQueue/*Long*/ mNotificationReplyAction = new LimitedQueue(16);                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +                                                                                                                  </span>
<span class="3035544862292212294" onmouseenter="enter('3035544862292212294');" onmouseout="out('3035544862292212294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +    /// Maximum amount of characters to store in receiveHistory                                                   </span>
<span class="-1679828146401541729" onmouseenter="enter('-1679828146401541729');" onmouseout="out('-1679828146401541729');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +    public static final int MAX_RECEIVE_HISTORY_CHARS = 100000;                                                   </span>
<span  style=""> 141                                                                                                                    </span>




<span class="-4613019613947290640" onmouseenter="enter('-4613019613947290640');" onmouseout="out('-4613019613947290640');" style=""> 142      // Local Intents - for app manager communication                                                              </span>
<span class="-6355985936525602065" onmouseenter="enter('-6355985936525602065');" onmouseout="out('-6355985936525602065');" style=""> 143      public static final String BANGLEJS_COMMAND_TX = &quot;banglejs_command_tx&quot;;                                       </span>
<span class="-7611986610894711832" onmouseenter="enter('-7611986610894711832');" onmouseout="out('-7611986610894711832');" style=""> 144      public static final String BANGLEJS_COMMAND_RX = &quot;banglejs_command_rx&quot;;                                       </span>
<span class="3928394439815779565" onmouseenter="enter('3928394439815779565');" onmouseout="out('3928394439815779565');" style=""> 145      // Global Intents                                                                                             </span>
<span class="8064114268652999257" onmouseenter="enter('8064114268652999257');" onmouseout="out('8064114268652999257');" style=""> 146      private static final String BANGLE_ACTION_UART_TX = &quot;com.banglejs.uart.tx&quot;;                                   </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-7141869860994321087" onmouseenter="enter('-7141869860994321087');" onmouseout="out('-7141869860994321087');" style=""> 148      public BangleJSDeviceSupport() {                                                                              </span>
<span class="4463652287758102089" onmouseenter="enter('4463652287758102089');" onmouseout="out('4463652287758102089');" style=""> 149          super(LOG);                                                                                               </span>
<span class="3886704256627163463" onmouseenter="enter('3886704256627163463');" onmouseout="out('3886704256627163463');" style=""> 150          addSupportedService(BangleJSConstants.UUID_SERVICE_NORDIC_UART);                                          </span>
<span  style=""> 151                                                                                                                    </span>
<span class="1127284200558372197" onmouseenter="enter('1127284200558372197');" onmouseout="out('1127284200558372197');" style=""> 152          registerLocalIntents();                                                                                   </span>
<span class="8826733129991946596" onmouseenter="enter('8826733129991946596');" onmouseout="out('8826733129991946596');" style=""> 153          registerGlobalIntents();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154      }                                                                                                             </span>
<span  style=""> 155                                                                                                                    </span>
<span class="3363204271654612484" onmouseenter="enter('3363204271654612484');" onmouseout="out('3363204271654612484');" style=""> 156      private void registerLocalIntents() {                                                                         </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 157          IntentFilter commandFilter = new IntentFilter();                                                          </span>
<span class="-7160894414714230309" onmouseenter="enter('-7160894414714230309');" onmouseout="out('-7160894414714230309');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +        commandFilter.addAction(GBDevice.ACTION_DEVICE_CHANGED);                                                  </span>
<span class="1690174294514698098" onmouseenter="enter('1690174294514698098');" onmouseout="out('1690174294514698098');" style=""> 159          commandFilter.addAction(BANGLEJS_COMMAND_TX);                                                             </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 160          BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 161              @Override                                                                                             </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 162              public void onReceive(Context context, Intent intent) {                                               </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 163                  switch (intent.getAction()) {                                                                     </span>
<span class="1707526022738550013" onmouseenter="enter('1707526022738550013');" onmouseout="out('1707526022738550013');" style=""> 164                      case BANGLEJS_COMMAND_TX: {                                                                   </span>
<span class="6200259397597608765" onmouseenter="enter('6200259397597608765');" onmouseout="out('6200259397597608765');" style=""> 165                          String data = String.valueOf(intent.getExtras().get(&quot;DATA&quot;));                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 166                          try {                                                                                     </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 167                              TransactionBuilder builder = performInitialized(&quot;TX&quot;);                                </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 168                              uartTx(builder, data);                                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 169                              builder.queue(getQueue());                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 170                          } catch (IOException e) {                                                                 </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 171                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 171                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172                          }                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 173                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +                    }                                                                                             </span>
<span class="5219935206621418062" onmouseenter="enter('5219935206621418062');" onmouseout="out('5219935206621418062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                    case GBDevice.ACTION_DEVICE_CHANGED: {                                                        </span>
<span class="-7853573391303433157" onmouseenter="enter('-7853573391303433157');" onmouseout="out('-7853573391303433157');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                        LOG.info(&quot;ACTION_DEVICE_CHANGED &quot; + gbDevice.getStateString());                           </span>
<span class="3462566553438825861" onmouseenter="enter('3462566553438825861');" onmouseout="out('3462566553438825861');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 177 +                        receiveHistory += &quot;\n================================================\nACTION_DEVICE_CHANGED &quot;+gbDevice.getStateString()+&quot; &quot;+(new SimpleDateFormat(&quot;yyyy-mm-dd hh:mm:ss&quot;)).format(Calendar.getInstance().getTime())+&quot;\n================================================\n&quot;;"> 177 +                        receiveHistory += &quot;\n================================================\nACTION_DEVICE_CHANGðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 181          };                                                                                                        </span>
<span class="-3358010436009942845" onmouseenter="enter('-3358010436009942845');" onmouseout="out('-3358010436009942845');" style=""><abbr title=" 182          LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, commandFilter);"> 182          LocalBroadcastManager.getInstance(GBApplication.getContext()).registerReceiver(commandReceiver, commandFilðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183      }                                                                                                             </span>
<span  style=""> 184                                                                                                                    </span>
<span class="-5775866095722777208" onmouseenter="enter('-5775866095722777208');" onmouseout="out('-5775866095722777208');" style=""> 185      private void registerGlobalIntents() {                                                                        </span>
<span class="-566507879392612419" onmouseenter="enter('-566507879392612419');" onmouseout="out('-566507879392612419');" style=""> 186          IntentFilter commandFilter = new IntentFilter();                                                          </span>
<span class="312812515367481242" onmouseenter="enter('312812515367481242');" onmouseout="out('312812515367481242');" style=""> 187          commandFilter.addAction(BANGLE_ACTION_UART_TX);                                                           </span>
<span class="-651545802643295145" onmouseenter="enter('-651545802643295145');" onmouseout="out('-651545802643295145');" style=""> 188          BroadcastReceiver commandReceiver = new BroadcastReceiver() {                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 189              @Override                                                                                             </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 190              public void onReceive(Context context, Intent intent) {                                               </span>
<span class="241245612729856704" onmouseenter="enter('241245612729856704');" onmouseout="out('241245612729856704');" style=""> 191                  switch (intent.getAction()) {                                                                     </span>
<span class="-2247552427419228949" onmouseenter="enter('-2247552427419228949');" onmouseout="out('-2247552427419228949');" style=""> 192                      case BANGLE_ACTION_UART_TX: {                                                                 </span>
<span class="1831826963180757129" onmouseenter="enter('1831826963180757129');" onmouseout="out('1831826963180757129');" style=""> 193                          /* In Tasker:                                                                             </span>
<span class="-7864253240443668933" onmouseenter="enter('-7864253240443668933');" onmouseout="out('-7864253240443668933');" style=""> 194                            Action: com.banglejs.uart.tx                                                            </span>
<span class="-8992717920838973367" onmouseenter="enter('-8992717920838973367');" onmouseout="out('-8992717920838973367');" style=""> 195                            Cat: None                                                                               </span>
<span class="7759910949487339439" onmouseenter="enter('7759910949487339439');" onmouseout="out('7759910949487339439');" style=""> 196                            Extra: line:Terminal.println(%avariable)                                                </span>
<span class="1033584491372489972" onmouseenter="enter('1033584491372489972');" onmouseout="out('1033584491372489972');" style=""> 197                            Target: Broadcast Receiver                                                              </span>
<span  style=""> 198                                                                                                                    </span>
<span class="8716883358060475580" onmouseenter="enter('8716883358060475580');" onmouseout="out('8716883358060475580');" style=""><abbr title=" 199                            Variable: Number, Configure on Import, NOT structured, Value set, Nothing Exported, NOT Same as value"> 199                            Variable: Number, Configure on Import, NOT structured, Value set, Nothing Exported, NOT ðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 200                           */                                                                                       </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""><abbr title=" 201                          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));"> 201                          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddreðŸ”µ</abbr></span>
<span class="-3486649650498692683" onmouseenter="enter('-3486649650498692683');" onmouseout="out('-3486649650498692683');" style=""> 202                          if (!devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) return;                          </span>
<span class="-5120599586530243425" onmouseenter="enter('-5120599586530243425');" onmouseout="out('-5120599586530243425');" style=""> 203                          String data = intent.getStringExtra(&quot;line&quot;);                                              </span>
<span class="2134003849288272405" onmouseenter="enter('2134003849288272405');" onmouseout="out('2134003849288272405');" style=""> 204                          if (data==null) {                                                                         </span>
<span class="-1377387169158373155" onmouseenter="enter('-1377387169158373155');" onmouseout="out('-1377387169158373155');" style=""><abbr title=" 205                              GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTH_LONG, GB.ERROR);"> 205                              GB.toast(getContext(), &quot;UART TX Intent, but no &#x27;line&#x27; supplied&quot;, Toast.LENGTH_LONG, GBðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 206                              return;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                          }                                                                                         </span>
<span class="-5300884727268780299" onmouseenter="enter('-5300884727268780299');" onmouseout="out('-5300884727268780299');" style=""> 208                          if (!data.endsWith(&quot;\n&quot;)) data += &quot;\n&quot;;                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 209                          try {                                                                                     </span>
<span class="1590737202282478048" onmouseenter="enter('1590737202282478048');" onmouseout="out('1590737202282478048');" style=""> 210                              TransactionBuilder builder = performInitialized(&quot;TX&quot;);                                </span>
<span class="-6520461689692745811" onmouseenter="enter('-6520461689692745811');" onmouseout="out('-6520461689692745811');" style=""> 211                              uartTx(builder, data);                                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 212                              builder.queue(getQueue());                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 213                          } catch (IOException e) {                                                                 </span>
<span class="-1901028856670226901" onmouseenter="enter('-1901028856670226901');" onmouseout="out('-1901028856670226901');" style=""><abbr title=" 214                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 214                              GB.toast(getContext(), &quot;Error in TX: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                          }                                                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 216                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 220          };                                                                                                        </span>
<span class="-7064134150505035894" onmouseenter="enter('-7064134150505035894');" onmouseout="out('-7064134150505035894');" style=""> 221          GBApplication.getContext().registerReceiver(commandReceiver, commandFilter);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222      }                                                                                                             </span>
<span  style=""> 223                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 224      @Override                                                                                                     </span>
<span class="624595386859969795" onmouseenter="enter('624595386859969795');" onmouseout="out('624595386859969795');" style=""> 225      protected TransactionBuilder initializeDevice(TransactionBuilder builder) {                                   </span>
<span class="6943102306574884764" onmouseenter="enter('6943102306574884764');" onmouseout="out('6943102306574884764');" style=""> 226          LOG.info(&quot;Initializing&quot;);                                                                                 </span>
<span  style=""> 227                                                                                                                    </span>
<span class="-5776342764121597122" onmouseenter="enter('-5776342764121597122');" onmouseout="out('-5776342764121597122');" style=""> 228          gbDevice.setState(GBDevice.State.INITIALIZING);                                                           </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 229          gbDevice.sendDeviceUpdateIntent(getContext());                                                            </span>
<span class="-92673263340012587" onmouseenter="enter('-92673263340012587');" onmouseout="out('-92673263340012587');" style=""> 230          gbDevice.setBatteryThresholdPercent((short) 30);                                                          </span>
<span  style=""> 231                                                                                                                    </span>
<span class="-8842369873450741446" onmouseenter="enter('-8842369873450741446');" onmouseout="out('-8842369873450741446');" style=""> 232          rxCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX);               </span>
<span class="5321381947985783136" onmouseenter="enter('5321381947985783136');" onmouseout="out('5321381947985783136');" style=""> 233          txCharacteristic = getCharacteristic(BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_TX);               </span>
<span class="8787860057533172177" onmouseenter="enter('8787860057533172177');" onmouseout="out('8787860057533172177');" style=""> 234          builder.setGattCallback(this);                                                                            </span>
<span class="-6644952300158088977" onmouseenter="enter('-6644952300158088977');" onmouseout="out('-6644952300158088977');" style=""> 235          builder.notify(rxCharacteristic, true);                                                                   </span>
<span  style=""> 236                                                                                                                    </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 237          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));         </span>
<span class="-251442064819697046" onmouseenter="enter('-251442064819697046');" onmouseout="out('-251442064819697046');" style=""> 238          allowHighMTU = devicePrefs.getBoolean(PREF_ALLOW_HIGH_MTU, false);                                        </span>
<span  style=""> 239                                                                                                                    </span>
<span class="-8288238614628464708" onmouseenter="enter('-8288238614628464708');" onmouseout="out('-8288238614628464708');" style=""> 240          uartTx(builder, &quot; \u0003&quot;); // clear active line                                                          </span>
<span  style=""> 241                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 242          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="8819552782192853417" onmouseenter="enter('8819552782192853417');" onmouseout="out('8819552782192853417');" style=""> 243          if (prefs.getBoolean(&quot;datetime_synconconnect&quot;, true))                                                     </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 244            transmitTime(builder);                                                                                  </span>
<span class="-772823299017939314" onmouseenter="enter('-772823299017939314');" onmouseout="out('-772823299017939314');" style=""> 245          //sendSettings(builder);                                                                                  </span>
<span  style=""> 246                                                                                                                    </span>
<span class="6222907129579606912" onmouseenter="enter('6222907129579606912');" onmouseout="out('6222907129579606912');" style=""> 247          // get version                                                                                            </span>
<span  style=""> 248                                                                                                                    </span>
<span class="6586859092027978564" onmouseenter="enter('6586859092027978564');" onmouseout="out('6586859092027978564');" style=""> 249          gbDevice.setState(GBDevice.State.INITIALIZED);                                                            </span>
<span class="-6083303279196581322" onmouseenter="enter('-6083303279196581322');" onmouseout="out('-6083303279196581322');" style=""> 250          gbDevice.sendDeviceUpdateIntent(getContext());                                                            </span>
<span  style=""> 251                                                                                                                    </span>
<span class="-3832688778173104110" onmouseenter="enter('-3832688778173104110');" onmouseout="out('-3832688778173104110');" style=""> 252          getDevice().setFirmwareVersion(&quot;N/A&quot;);                                                                    </span>
<span class="-4069256094451065143" onmouseenter="enter('-4069256094451065143');" onmouseout="out('-4069256094451065143');" style=""> 253          getDevice().setFirmwareVersion2(&quot;N/A&quot;);                                                                   </span>
<span  style=""> 254                                                                                                                    </span>
<span class="8801197429786363323" onmouseenter="enter('8801197429786363323');" onmouseout="out('8801197429786363323');" style=""> 255          LOG.info(&quot;Initialization Done&quot;);                                                                          </span>
<span  style=""> 256                                                                                                                    </span>
<span class="4801455624621135639" onmouseenter="enter('4801455624621135639');" onmouseout="out('4801455624621135639');" style=""> 257          return builder;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258      }                                                                                                             </span>
<span  style=""> 259                                                                                                                    </span>
<span class="-607913654590177522" onmouseenter="enter('-607913654590177522');" onmouseout="out('-607913654590177522');" style=""> 260      /// Write a string of data, and chunk it up                                                                   </span>
<span class="7559000899786781106" onmouseenter="enter('7559000899786781106');" onmouseout="out('7559000899786781106');" style=""> 261      private void uartTx(TransactionBuilder builder, String str) {                                                 </span>

<span class="7973208681748769929" onmouseenter="enter('7973208681748769929');" onmouseout="out('7973208681748769929');" style=""> 262          LOG.info(&quot;UART TX: &quot; + str);                                                                              </span>
<span class="7487272846038104686" onmouseenter="enter('7487272846038104686');" onmouseout="out('7487272846038104686');" style=""> 263          byte[] bytes;                                                                                             </span>
<span class="2645055981471255717" onmouseenter="enter('2645055981471255717');" onmouseout="out('2645055981471255717');" style=""> 264          bytes = str.getBytes(StandardCharsets.ISO_8859_1);                                                        </span>
<span class="-4351000658882190788" onmouseenter="enter('-4351000658882190788');" onmouseout="out('-4351000658882190788');" style=""><abbr title=" 265          // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.stringify is converting to UTF-8?"> 265          // FIXME: somehow this is still giving us UTF8 data when we put images in strings. Maybe JSON.stringify isðŸ”µ</abbr></span>
<span class="-7681259971523215295" onmouseenter="enter('-7681259971523215295');" onmouseout="out('-7681259971523215295');" style=""> 266          for (int i=0;i&lt;bytes.length;i+=mtuSize) {                                                                 </span>
<span class="6940458760871247208" onmouseenter="enter('6940458760871247208');" onmouseout="out('6940458760871247208');" style=""> 267              int l = bytes.length-i;                                                                               </span>
<span class="-2771087721762798548" onmouseenter="enter('-2771087721762798548');" onmouseout="out('-2771087721762798548');" style=""> 268              if (l&gt;mtuSize) l=mtuSize;                                                                             </span>
<span class="-7868874671478910733" onmouseenter="enter('-7868874671478910733');" onmouseout="out('-7868874671478910733');" style=""> 269              byte[] packet = new byte[l];                                                                          </span>
<span class="6292978456177043042" onmouseenter="enter('6292978456177043042');" onmouseout="out('6292978456177043042');" style=""> 270              System.arraycopy(bytes, i, packet, 0, l);                                                             </span>
<span class="7692898876807316449" onmouseenter="enter('7692898876807316449');" onmouseout="out('7692898876807316449');" style=""> 271              builder.write(txCharacteristic, packet);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273      }                                                                                                             </span>
<span  style=""> 274                                                                                                                    </span>
<span  style=""> 275                                                                                                                    </span>
<span class="-607913654590177522" onmouseenter="enter('-607913654590177522');" onmouseout="out('-607913654590177522');" style=""> 276      /// Write a string of data, and chunk it up                                                                   </span>























































<span class="4157561026938027662" onmouseenter="enter('4157561026938027662');" onmouseout="out('4157561026938027662');" style=""> 277      public String jsonToString(JSONObject jsonObj) {                                                              </span>
<span class="-4522530179526724243" onmouseenter="enter('-4522530179526724243');" onmouseout="out('-4522530179526724243');" style=""> 278          String json = jsonObj.toString();                                                                         </span>
<span class="-647637209944640137" onmouseenter="enter('-647637209944640137');" onmouseout="out('-647637209944640137');" style=""> 279          // toString creates &#x27;\u0000&#x27; instead of &#x27;\0&#x27;                                                              </span>
<span class="4177878667956674041" onmouseenter="enter('4177878667956674041');" onmouseout="out('4177878667956674041');" style=""><abbr title=" 280          // FIXME: there have got to be nicer ways of handling this - maybe we just make our own JSON.toString (see below)"> 280          // FIXME: there have got to be nicer ways of handling this - maybe we just make our own JSON.toString (seeðŸ”µ</abbr></span>
<span class="3255181898386234576" onmouseenter="enter('3255181898386234576');" onmouseout="out('3255181898386234576');" style=""> 281          json = json.replaceAll(&quot;\\\\u000([01234567])&quot;, &quot;\\\\$1&quot;);                                                 </span>
<span class="72601646808909527" onmouseenter="enter('72601646808909527');" onmouseout="out('72601646808909527');" style=""> 282          json = json.replaceAll(&quot;\\\\u00([0123456789abcdef][0123456789abcdef])&quot;, &quot;\\\\x$1&quot;);                       </span>
<span class="-9201807036798608310" onmouseenter="enter('-9201807036798608310');" onmouseout="out('-9201807036798608310');" style=""> 283          return json;                                                                                              </span>
<span class="-2574074928360666732" onmouseenter="enter('-2574074928360666732');" onmouseout="out('-2574074928360666732');" style=""> 284          /*String json = &quot;{&quot;;                                                                                      </span>
<span class="-4233945994791575356" onmouseenter="enter('-4233945994791575356');" onmouseout="out('-4233945994791575356');" style=""> 285          Iterator&lt;String&gt; iter = jsonObj.keys();                                                                   </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 286          while (iter.hasNext()) {                                                                                  </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 287              String key = iter.next();                                                                             </span>
<span class="5129714181240102620" onmouseenter="enter('5129714181240102620');" onmouseout="out('5129714181240102620');" style=""> 288              Object v = jsonObj.get(key);                                                                          </span>
<span class="-3931564472926176624" onmouseenter="enter('-3931564472926176624');" onmouseout="out('-3931564472926176624');" style=""> 289              if (v instanceof Integer) {                                                                           </span>
<span class="2189452865908165505" onmouseenter="enter('2189452865908165505');" onmouseout="out('2189452865908165505');" style=""> 290                  // ...                                                                                            </span>
<span class="-5749274956692686167" onmouseenter="enter('-5749274956692686167');" onmouseout="out('-5749274956692686167');" style=""> 291              } else // ..                                                                                          </span>
<span class="-775465109238322464" onmouseenter="enter('-775465109238322464');" onmouseout="out('-775465109238322464');" style=""> 292              if (iter.hasNext()) json+=&quot;,&quot;;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293          }                                                                                                         </span>
<span class="-454891966817639137" onmouseenter="enter('-454891966817639137');" onmouseout="out('-454891966817639137');" style=""> 294          return json+&quot;}&quot;;*/                                                                                        </span>







<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295      }                                                                                                             </span>
<span  style=""> 296                                                                                                                    </span>
<span class="31684629009080209" onmouseenter="enter('31684629009080209');" onmouseout="out('31684629009080209');" style=""> 297      /// Write a JSON object of data                                                                               </span>
<span class="-8756055707520682190" onmouseenter="enter('-8756055707520682190');" onmouseout="out('-8756055707520682190');" style=""> 298      private void uartTxJSON(String taskName, JSONObject json) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 299          try {                                                                                                     </span>
<span class="-6185382728407385788" onmouseenter="enter('-6185382728407385788');" onmouseout="out('-6185382728407385788');" style=""> 300              TransactionBuilder builder = performInitialized(taskName);                                            </span>
<span class="-5291927674188184215" onmouseenter="enter('-5291927674188184215');" onmouseout="out('-5291927674188184215');" style=""> 301              uartTx(builder, &quot;\u0010GB(&quot;+jsonToString(json)+&quot;)\n&quot;);                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 302              builder.queue(getQueue());                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 303          } catch (IOException e) {                                                                                 </span>
<span class="2446652404576165600" onmouseenter="enter('2446652404576165600');" onmouseout="out('2446652404576165600');" style=""><abbr title=" 304              GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 304              GB.toast(getContext(), &quot;Error in &quot;+taskName+&quot;: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306      }                                                                                                             </span>
<span  style=""> 307                                                                                                                    </span>
<span class="4290598848752150102" onmouseenter="enter('4290598848752150102');" onmouseout="out('4290598848752150102');" style=""> 308      /// Write JSON object of the form {t:taskName, err:message}                                                   </span>
<span  style=""> 309                                                                                                                    </span>
<span class="-8058058420395857539" onmouseenter="enter('-8058058420395857539');" onmouseout="out('-8058058420395857539');" style=""> 310      private void uartTxJSONError(String taskName, String message) {                                               </span>
<span class="3966342241212062344" onmouseenter="enter('3966342241212062344');" onmouseout="out('3966342241212062344');" style=""> 311          uartTxJSONError(taskName,message,null);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312      }                                                                                                             </span>
<span  style=""> 313                                                                                                                    </span>
<span class="7327259819120083170" onmouseenter="enter('7327259819120083170');" onmouseout="out('7327259819120083170');" style=""> 314      private void uartTxJSONError(String taskName, String message,String id) {                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 315          JSONObject o = new JSONObject();                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 316          try {                                                                                                     </span>
<span class="-4736457139552862676" onmouseenter="enter('-4736457139552862676');" onmouseout="out('-4736457139552862676');" style=""> 317              o.put(&quot;t&quot;, taskName);                                                                                 </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 318              if( id!=null)                                                                                         </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 319                  o.put(&quot;id&quot;, id);                                                                                  </span>
<span class="-3362855442851232299" onmouseenter="enter('-3362855442851232299');" onmouseout="out('-3362855442851232299');" style=""> 320              o.put(&quot;err&quot;, message);                                                                                </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 321          } catch (JSONException e) {                                                                               </span>
<span class="-293713289384668060" onmouseenter="enter('-293713289384668060');" onmouseout="out('-293713289384668060');" style=""> 322              GB.toast(getContext(), &quot;uartTxJSONError: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323          }                                                                                                         </span>
<span class="-3544369649702046019" onmouseenter="enter('-3544369649702046019');" onmouseout="out('-3544369649702046019');" style=""> 324          uartTxJSON(taskName, o);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325      }                                                                                                             </span>
<span  style=""> 326                                                                                                                    </span>
<span  style=""> 327                                                                                                                    </span>
<span  style=""> 328                                                                                                                    </span>
<span class="3549324304064443217" onmouseenter="enter('3549324304064443217');" onmouseout="out('3549324304064443217');" style=""> 329      private void handleUartRxLine(String line) {                                                                  </span>
<span class="7696744219355043330" onmouseenter="enter('7696744219355043330');" onmouseout="out('7696744219355043330');" style=""> 330          LOG.info(&quot;UART RX LINE: &quot; + line);                                                                        </span>
<span  style=""> 331                                                                                                                    </span>

<span class="2508923913537480964" onmouseenter="enter('2508923913537480964');" onmouseout="out('2508923913537480964');" style=""> 332          if (&quot;&gt;Uncaught ReferenceError: \&quot;GB\&quot; is not defined&quot;.equals(line))                                       </span>
<span class="7158908931448264833" onmouseenter="enter('7158908931448264833');" onmouseout="out('7158908931448264833');" style=""> 333            GB.toast(getContext(), &quot;Gadgetbridge plugin not installed on Bangle.js&quot;, Toast.LENGTH_LONG, GB.ERROR);  </span>
<span class="-6455000716475696058" onmouseenter="enter('-6455000716475696058');" onmouseout="out('-6455000716475696058');" style=""> 334          else if (line.length() &gt; 0 &amp;&amp; line.charAt(0)==&#x27;{&#x27;) {                                                      </span>

<span class="8231786037032554769" onmouseenter="enter('8231786037032554769');" onmouseout="out('8231786037032554769');" style=""> 335              // JSON - we hope!                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 336              try {                                                                                                 </span>
<span class="2411116435363976231" onmouseenter="enter('2411116435363976231');" onmouseout="out('2411116435363976231');" style=""> 337                  JSONObject json = new JSONObject(line);                                                           </span>
<span class="8233558512387133223" onmouseenter="enter('8233558512387133223');" onmouseout="out('8233558512387133223');" style=""> 338                  LOG.info(&quot;UART RX JSON parsed successfully&quot;);                                                     </span>
<span class="4509864865787947019" onmouseenter="enter('4509864865787947019');" onmouseout="out('4509864865787947019');" style=""> 339                  handleUartRxJSON(json);                                                                           </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 340              } catch (JSONException e) {                                                                           </span>
<span class="-2414553303058964646" onmouseenter="enter('-2414553303058964646');" onmouseout="out('-2414553303058964646');" style=""> 341                  LOG.info(&quot;UART RX JSON parse failure: &quot;+ e.getLocalizedMessage());                                </span>
<span class="8356145272001509336" onmouseenter="enter('8356145272001509336');" onmouseout="out('8356145272001509336');" style=""><abbr title=" 342                  GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 342                  GB.toast(getContext(), &quot;Malformed JSON from Bangle.js: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 344          } else {                                                                                                  </span>
<span class="3013327231508790922" onmouseenter="enter('3013327231508790922');" onmouseout="out('3013327231508790922');" style=""> 345              LOG.info(&quot;UART RX line started with &quot;+(int)line.charAt(0)+&quot; - ignoring&quot;);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347      }                                                                                                             </span>
<span  style=""> 348                                                                                                                    </span>
<span class="-1023302836013344522" onmouseenter="enter('-1023302836013344522');" onmouseout="out('-1023302836013344522');" style=""> 349      private void handleUartRxJSON(JSONObject json) throws JSONException {                                         </span>
<span class="7061070849429770108" onmouseenter="enter('7061070849429770108');" onmouseout="out('7061070849429770108');" style=""> 350          String packetType = json.getString(&quot;t&quot;);                                                                  </span>
<span class="2121648211711712075" onmouseenter="enter('2121648211711712075');" onmouseout="out('2121648211711712075');" style=""> 351          switch (packetType) {                                                                                     </span>
<span class="1154622936863099207" onmouseenter="enter('1154622936863099207');" onmouseout="out('1154622936863099207');" style=""> 352              case &quot;info&quot;:                                                                                          </span>
<span class="6489300233296788049" onmouseenter="enter('6489300233296788049');" onmouseout="out('6489300233296788049');" style=""> 353                  GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.INFO);        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 354                  break;                                                                                            </span>
<span class="3852677909480408410" onmouseenter="enter('3852677909480408410');" onmouseout="out('3852677909480408410');" style=""> 355              case &quot;warn&quot;:                                                                                          </span>
<span class="-1267997652646506218" onmouseenter="enter('-1267997652646506218');" onmouseout="out('-1267997652646506218');" style=""> 356                  GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.WARN);        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 357                  break;                                                                                            </span>
<span class="-4027904492374937118" onmouseenter="enter('-4027904492374937118');" onmouseout="out('-4027904492374937118');" style=""> 358              case &quot;error&quot;:                                                                                         </span>
<span class="3082648944163426921" onmouseenter="enter('3082648944163426921');" onmouseout="out('3082648944163426921');" style=""> 359                  GB.toast(getContext(), &quot;Bangle.js: &quot; + json.getString(&quot;msg&quot;), Toast.LENGTH_LONG, GB.ERROR);       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 360                  break;                                                                                            </span>
<span class="-6550395055022650144" onmouseenter="enter('-6550395055022650144');" onmouseout="out('-6550395055022650144');" style=""> 361              case &quot;ver&quot;: {                                                                                         </span>
<span class="1504582788479684724" onmouseenter="enter('1504582788479684724');" onmouseout="out('1504582788479684724');" style=""> 362                  if (json.has(&quot;fw1&quot;))                                                                              </span>
<span class="7809101785256581980" onmouseenter="enter('7809101785256581980');" onmouseout="out('7809101785256581980');" style=""> 363                      getDevice().setFirmwareVersion(json.getString(&quot;fw1&quot;));                                        </span>
<span class="-4269189810719037321" onmouseenter="enter('-4269189810719037321');" onmouseout="out('-4269189810719037321');" style=""> 364                  if (json.has(&quot;fw2&quot;))                                                                              </span>
<span class="-1725698584982350052" onmouseenter="enter('-1725698584982350052');" onmouseout="out('-1725698584982350052');" style=""> 365                      getDevice().setFirmwareVersion2(json.getString(&quot;fw2&quot;));                                       </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 366              } break;                                                                                              </span>
<span class="-3223445656092502792" onmouseenter="enter('-3223445656092502792');" onmouseout="out('-3223445656092502792');" style=""> 367              case &quot;status&quot;: {                                                                                      </span>
<span class="1472249640876064382" onmouseenter="enter('1472249640876064382');" onmouseout="out('1472249640876064382');" style=""> 368                  GBDeviceEventBatteryInfo batteryInfo = new GBDeviceEventBatteryInfo();                            </span>
<span class="-8684865925727857265" onmouseenter="enter('-8684865925727857265');" onmouseout="out('-8684865925727857265');" style=""> 369                  if (json.has(&quot;bat&quot;)) {                                                                            </span>
<span class="3744277214774220447" onmouseenter="enter('3744277214774220447');" onmouseout="out('3744277214774220447');" style=""> 370                      int b = json.getInt(&quot;bat&quot;);                                                                   </span>
<span class="5862741907286067284" onmouseenter="enter('5862741907286067284');" onmouseout="out('5862741907286067284');" style=""> 371                      if (b &lt; 0) b = 0;                                                                             </span>
<span class="572226595522417282" onmouseenter="enter('572226595522417282');" onmouseout="out('572226595522417282');" style=""> 372                      if (b &gt; 100) b = 100;                                                                         </span>
<span class="6496455062087841098" onmouseenter="enter('6496455062087841098');" onmouseout="out('6496455062087841098');" style=""> 373                      batteryInfo.level = b;                                                                        </span>
<span class="-2105719386055198398" onmouseenter="enter('-2105719386055198398');" onmouseout="out('-2105719386055198398');" style=""> 374                      batteryInfo.state = BatteryState.BATTERY_NORMAL;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375                  }                                                                                                 </span>
<span class="-8617525444786471834" onmouseenter="enter('-8617525444786471834');" onmouseout="out('-8617525444786471834');" style=""> 376                  if (json.has(&quot;chg&quot;) &amp;&amp; json.getInt(&quot;chg&quot;) == 1) {                                                 </span>
<span class="-936118866357790298" onmouseenter="enter('-936118866357790298');" onmouseout="out('-936118866357790298');" style=""> 377                      batteryInfo.state = BatteryState.BATTERY_CHARGING;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378                  }                                                                                                 </span>
<span class="1514350151524445078" onmouseenter="enter('1514350151524445078');" onmouseout="out('1514350151524445078');" style=""> 379                  if (json.has(&quot;volt&quot;))                                                                             </span>
<span class="-3686044708246396849" onmouseenter="enter('-3686044708246396849');" onmouseout="out('-3686044708246396849');" style=""> 380                      batteryInfo.voltage = (float) json.getDouble(&quot;volt&quot;);                                         </span>
<span class="-1573801757390600576" onmouseenter="enter('-1573801757390600576');" onmouseout="out('-1573801757390600576');" style=""> 381                  handleGBDeviceEvent(batteryInfo);                                                                 </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 382              } break;                                                                                              </span>
<span class="-7544298044919087691" onmouseenter="enter('-7544298044919087691');" onmouseout="out('-7544298044919087691');" style=""> 383              case &quot;findPhone&quot;: {                                                                                   </span>
<span class="-2748392883851010177" onmouseenter="enter('-2748392883851010177');" onmouseout="out('-2748392883851010177');" style=""> 384                  boolean start = json.has(&quot;n&quot;) &amp;&amp; json.getBoolean(&quot;n&quot;);                                            </span>
<span class="6136676704701652580" onmouseenter="enter('6136676704701652580');" onmouseout="out('6136676704701652580');" style=""> 385                  GBDeviceEventFindPhone deviceEventFindPhone = new GBDeviceEventFindPhone();                       </span>
<span class="3202169087750798845" onmouseenter="enter('3202169087750798845');" onmouseout="out('3202169087750798845');" style=""><abbr title=" 386                  deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFindPhone.Event.STOP;"> 386                  deviceEventFindPhone.event = start ? GBDeviceEventFindPhone.Event.START : GBDeviceEventFindPhone.EðŸ”µ</abbr></span>
<span class="-1455650059425895125" onmouseenter="enter('-1455650059425895125');" onmouseout="out('-1455650059425895125');" style=""> 387                  evaluateGBDeviceEvent(deviceEventFindPhone);                                                      </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 388              } break;                                                                                              </span>
<span class="5454487238732594669" onmouseenter="enter('5454487238732594669');" onmouseout="out('5454487238732594669');" style=""> 389              case &quot;music&quot;: {                                                                                       </span>
<span class="-5683743334008418698" onmouseenter="enter('-5683743334008418698');" onmouseout="out('-5683743334008418698');" style=""> 390                  GBDeviceEventMusicControl deviceEventMusicControl = new GBDeviceEventMusicControl();              </span>
<span class="5894306574008826676" onmouseenter="enter('5894306574008826676');" onmouseout="out('5894306574008826676');" style=""><abbr title=" 391                  deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 391                  deviceEventMusicControl.event = GBDeviceEventMusicControl.Event.valueOf(json.getString(&quot;n&quot;).toUppeðŸ”µ</abbr></span>
<span class="8133545861002504946" onmouseenter="enter('8133545861002504946');" onmouseout="out('8133545861002504946');" style=""> 392                  evaluateGBDeviceEvent(deviceEventMusicControl);                                                   </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 393              } break;                                                                                              </span>
<span class="-9207173587563143993" onmouseenter="enter('-9207173587563143993');" onmouseout="out('-9207173587563143993');" style=""> 394              case &quot;call&quot;: {                                                                                        </span>
<span class="2406734484891175482" onmouseenter="enter('2406734484891175482');" onmouseout="out('2406734484891175482');" style=""> 395                  GBDeviceEventCallControl deviceEventCallControl = new GBDeviceEventCallControl();                 </span>
<span class="-5299176663874891056" onmouseenter="enter('-5299176663874891056');" onmouseout="out('-5299176663874891056');" style=""><abbr title=" 396                  deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 396                  deviceEventCallControl.event = GBDeviceEventCallControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCðŸ”µ</abbr></span>
<span class="-7699727803461656923" onmouseenter="enter('-7699727803461656923');" onmouseout="out('-7699727803461656923');" style=""> 397                  evaluateGBDeviceEvent(deviceEventCallControl);                                                    </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 398              } break;                                                                                              </span>
<span class="-337329064960380865" onmouseenter="enter('-337329064960380865');" onmouseout="out('-337329064960380865');" style=""> 399              case &quot;notify&quot; : {                                                                                     </span>
<span class="1278038111464368986" onmouseenter="enter('1278038111464368986');" onmouseout="out('1278038111464368986');" style=""><abbr title=" 400                  GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificationControl();"> 400                  GBDeviceEventNotificationControl deviceEvtNotificationControl = new GBDeviceEventNotificationContrðŸ”µ</abbr></span>
<span class="-6597246807803729732" onmouseenter="enter('-6597246807803729732');" onmouseout="out('-6597246807803729732');" style=""> 401                  // .title appears unused                                                                          </span>
<span class="-3304774628543622498" onmouseenter="enter('-3304774628543622498');" onmouseout="out('-3304774628543622498');" style=""><abbr title=" 402                  deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.getString(&quot;n&quot;).toUpperCase());"> 402                  deviceEvtNotificationControl.event = GBDeviceEventNotificationControl.Event.valueOf(json.getStringðŸ”µ</abbr></span>
<span class="4338373654190408032" onmouseenter="enter('4338373654190408032');" onmouseout="out('4338373654190408032');" style=""> 403                  if (json.has(&quot;id&quot;))                                                                               </span>
<span class="1062450614172957636" onmouseenter="enter('1062450614172957636');" onmouseout="out('1062450614172957636');" style=""> 404                      deviceEvtNotificationControl.handle = json.getInt(&quot;id&quot;);                                      </span>
<span class="658666775109182698" onmouseenter="enter('658666775109182698');" onmouseout="out('658666775109182698');" style=""> 405                  if (json.has(&quot;tel&quot;))                                                                              </span>
<span class="3912257448498793625" onmouseenter="enter('3912257448498793625');" onmouseout="out('3912257448498793625');" style=""> 406                      deviceEvtNotificationControl.phoneNumber = json.getString(&quot;tel&quot;);                             </span>
<span class="-279845848013227661" onmouseenter="enter('-279845848013227661');" onmouseout="out('-279845848013227661');" style=""> 407                  if (json.has(&quot;msg&quot;))                                                                              </span>
<span class="6661039268276828670" onmouseenter="enter('6661039268276828670');" onmouseout="out('6661039268276828670');" style=""> 408                      deviceEvtNotificationControl.reply = json.getString(&quot;msg&quot;);                                   </span>
<span class="-1817112681649718085" onmouseenter="enter('-1817112681649718085');" onmouseout="out('-1817112681649718085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +                /* REPLY responses don&#x27;t use the ID from the event (MUTE/etc seem to), but instead                </span>
<span class="5406797550372080886" onmouseenter="enter('5406797550372080886');" onmouseout="out('5406797550372080886');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +                * they use a handle that was provided in an action list on the onNotification.. event  */         </span>
<span class="-4787844253490591897" onmouseenter="enter('-4787844253490591897');" onmouseout="out('-4787844253490591897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +                if (deviceEvtNotificationControl.event == GBDeviceEventNotificationControl.Event.REPLY) {         </span>
<span class="7047790762640343753" onmouseenter="enter('7047790762640343753');" onmouseout="out('7047790762640343753');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 412 +                    Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationControl.handle);"> 412 +                    Long foundHandle = (Long)mNotificationReplyAction.lookup((int)deviceEvtNotificationControl.hanðŸ”µ</abbr></span>
<span class="2363738327135911056" onmouseenter="enter('2363738327135911056');" onmouseout="out('2363738327135911056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +                    if (foundHandle!=null)                                                                        </span>
<span class="-5768705298123946646" onmouseenter="enter('-5768705298123946646');" onmouseout="out('-5768705298123946646');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +                        deviceEvtNotificationControl.handle = foundHandle;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +                }                                                                                                 </span>
<span class="1799618905473722788" onmouseenter="enter('1799618905473722788');" onmouseout="out('1799618905473722788');" style=""> 416                  evaluateGBDeviceEvent(deviceEvtNotificationControl);                                              </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 417              } break;                                                                                              </span>
<span class="692659105886468257" onmouseenter="enter('692659105886468257');" onmouseout="out('692659105886468257');" style=""> 418              case &quot;act&quot;: {                                                                                         </span>
<span class="8371010899036944571" onmouseenter="enter('8371010899036944571');" onmouseout="out('8371010899036944571');" style=""> 419                  BangleJSActivitySample sample = new BangleJSActivitySample();                                     </span>
<span class="-1915545881769334236" onmouseenter="enter('-1915545881769334236');" onmouseout="out('-1915545881769334236');" style=""> 420                  sample.setTimestamp((int) (GregorianCalendar.getInstance().getTimeInMillis() / 1000L));           </span>
<span class="-6511180810366476909" onmouseenter="enter('-6511180810366476909');" onmouseout="out('-6511180810366476909');" style=""> 421                  int hrm = 0;                                                                                      </span>
<span class="-2794193254662759202" onmouseenter="enter('-2794193254662759202');" onmouseout="out('-2794193254662759202');" style=""> 422                  int steps = 0;                                                                                    </span>
<span class="1159991081674058958" onmouseenter="enter('1159991081674058958');" onmouseout="out('1159991081674058958');" style=""> 423                  if (json.has(&quot;hrm&quot;)) hrm = json.getInt(&quot;hrm&quot;);                                                    </span>
<span class="2200733451486704836" onmouseenter="enter('2200733451486704836');" onmouseout="out('2200733451486704836');" style=""> 424                  if (json.has(&quot;stp&quot;)) steps = json.getInt(&quot;stp&quot;);                                                  </span>
<span class="6603465025108101037" onmouseenter="enter('6603465025108101037');" onmouseout="out('6603465025108101037');" style=""> 425                  int activity = BangleJSSampleProvider.TYPE_ACTIVITY;                                              </span>
<span class="6065424140180877442" onmouseenter="enter('6065424140180877442');" onmouseout="out('6065424140180877442');" style=""> 426                  /*if (json.has(&quot;act&quot;)) {                                                                          </span>
<span class="-2439039461724633138" onmouseenter="enter('-2439039461724633138');" onmouseout="out('-2439039461724633138');" style=""> 427                      String actName = &quot;TYPE_&quot; + json.getString(&quot;act&quot;).toUpperCase();                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 428                      try {                                                                                         </span>
<span class="-5191337226244238063" onmouseenter="enter('-5191337226244238063');" onmouseout="out('-5191337226244238063');" style=""> 429                          Field f = ActivityKind.class.getField(actName);                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 430                          try {                                                                                     </span>
<span class="8672601729845658913" onmouseenter="enter('8672601729845658913');" onmouseout="out('8672601729845658913');" style=""> 431                              activity = f.getInt(null);                                                            </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 432                          } catch (IllegalAccessException e) {                                                      </span>
<span class="9211658540801898058" onmouseenter="enter('9211658540801898058');" onmouseout="out('9211658540801898058');" style=""> 433                              LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not readable&quot;);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434                          }                                                                                         </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 435                      } catch (NoSuchFieldException e) {                                                            </span>
<span class="-4236592020282047640" onmouseenter="enter('-4236592020282047640');" onmouseout="out('-4236592020282047640');" style=""> 436                          LOG.info(&quot;JSON activity &#x27;&quot;+actName+&quot;&#x27; not found&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437                      }                                                                                             </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 438                  }*/                                                                                               </span>
<span class="8668161863330653058" onmouseenter="enter('8668161863330653058');" onmouseout="out('8668161863330653058');" style=""> 439                  sample.setRawKind(activity);                                                                      </span>
<span class="5935105042646692248" onmouseenter="enter('5935105042646692248');" onmouseout="out('5935105042646692248');" style=""> 440                  sample.setHeartRate(hrm);                                                                         </span>
<span class="-4745425836300475693" onmouseenter="enter('-4745425836300475693');" onmouseout="out('-4745425836300475693');" style=""> 441                  sample.setSteps(steps);                                                                           </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style=""> 442                  try (DBHandler dbHandler = GBApplication.acquireDB()) {                                           </span>
<span class="1422413790142608640" onmouseenter="enter('1422413790142608640');" onmouseout="out('1422413790142608640');" style=""> 443                      Long userId = getUser(dbHandler.getDaoSession()).getId();                                     </span>
<span class="3688300519339275893" onmouseenter="enter('3688300519339275893');" onmouseout="out('3688300519339275893');" style=""> 444                      Long deviceId = DBHelper.getDevice(getDevice(), dbHandler.getDaoSession()).getId();           </span>
<span class="-4884679916644886432" onmouseenter="enter('-4884679916644886432');" onmouseout="out('-4884679916644886432');" style=""><abbr title=" 445                      BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.getDaoSession());"> 445                      BangleJSSampleProvider provider = new BangleJSSampleProvider(getDevice(), dbHandler.getDaoSessðŸ”µ</abbr></span>
<span class="6444535225867718796" onmouseenter="enter('6444535225867718796');" onmouseout="out('6444535225867718796');" style=""> 446                      sample.setDeviceId(deviceId);                                                                 </span>
<span class="292659008851945780" onmouseenter="enter('292659008851945780');" onmouseout="out('292659008851945780');" style=""> 447                      sample.setUserId(userId);                                                                     </span>
<span class="4765059548563428130" onmouseenter="enter('4765059548563428130');" onmouseout="out('4765059548563428130');" style=""> 448                      provider.addGBActivitySample(sample);                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 449                  } catch (Exception ex) {                                                                          </span>
<span class="1206810911036844482" onmouseenter="enter('1206810911036844482');" onmouseout="out('1206810911036844482');" style=""> 450                      LOG.warn(&quot;Error saving activity: &quot; + ex.getLocalizedMessage());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451                  }                                                                                                 </span>
<span class="5171490897490639183" onmouseenter="enter('5171490897490639183');" onmouseout="out('5171490897490639183');" style=""> 452                  // push realtime data                                                                             </span>
<span class="-6833823710638969612" onmouseenter="enter('-6833823710638969612');" onmouseout="out('-6833823710638969612');" style=""> 453                  if (realtimeHRM || realtimeStep) {                                                                </span>
<span class="-9081146433891434428" onmouseenter="enter('-9081146433891434428');" onmouseout="out('-9081146433891434428');" style=""> 454                      Intent intent = new Intent(DeviceService.ACTION_REALTIME_SAMPLES)                             </span>
<span class="5807466852720832411" onmouseenter="enter('5807466852720832411');" onmouseout="out('5807466852720832411');" style=""> 455                              .putExtra(DeviceService.EXTRA_REALTIME_SAMPLE, sample);                               </span>
<span class="4408272978519826220" onmouseenter="enter('4408272978519826220');" onmouseout="out('4408272978519826220');" style=""> 456                      LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457                  }                                                                                                 </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 458              } break;                                                                                              </span>
<span class="-3056288259405338320" onmouseenter="enter('-3056288259405338320');" onmouseout="out('-3056288259405338320');" style=""> 459              case &quot;http&quot;: {                                                                                        </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 460                  Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress())); </span>
<span class="4471501014415506100" onmouseenter="enter('4471501014415506100');" onmouseout="out('4471501014415506100');" style=""> 461                  String _id=null;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 462                  try {                                                                                             </span>
<span class="4672396922249032002" onmouseenter="enter('4672396922249032002');" onmouseout="out('4672396922249032002');" style=""> 463                      _id = json.getString(&quot;id&quot;);                                                                   </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 464                  } catch (JSONException e) {                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465                  }                                                                                                 </span>
<span class="5919143370037839830" onmouseenter="enter('5919143370037839830');" onmouseout="out('5919143370037839830');" style=""> 466                  final String id = _id;                                                                            </span>
<span  style=""> 467                                                                                                                    </span>
<span  style=""> 468                                                                                                                    </span>
<span class="-6992637283999421128" onmouseenter="enter('-6992637283999421128');" onmouseout="out('-6992637283999421128');" style=""> 469                  if (BuildConfig.INTERNET_ACCESS &amp;&amp; devicePrefs.getBoolean(PREF_DEVICE_INTERNET_ACCESS, false)) {  </span>
<span class="3585939051150823686" onmouseenter="enter('3585939051150823686');" onmouseout="out('3585939051150823686');" style=""> 470                      RequestQueue queue = Volley.newRequestQueue(getContext());                                    </span>
<span class="5176519532323120311" onmouseenter="enter('5176519532323120311');" onmouseout="out('5176519532323120311');" style=""> 471                      String url = json.getString(&quot;url&quot;);                                                           </span>
<span  style=""> 472                                                                                                                    </span>
<span class="-3545396317642083141" onmouseenter="enter('-3545396317642083141');" onmouseout="out('-3545396317642083141');" style=""> 473                      String _xmlPath = &quot;&quot;;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 474                      try {                                                                                         </span>
<span class="-6862471463745020928" onmouseenter="enter('-6862471463745020928');" onmouseout="out('-6862471463745020928');" style=""> 475                          _xmlPath = json.getString(&quot;xpath&quot;);                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 476                      } catch (JSONException e) {                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477                      }                                                                                             </span>
<span class="605766333889403990" onmouseenter="enter('605766333889403990');" onmouseout="out('605766333889403990');" style=""> 478                      final String xmlPath = _xmlPath;                                                              </span>
<span class="-7325827083532572939" onmouseenter="enter('-7325827083532572939');" onmouseout="out('-7325827083532572939');" style=""> 479                      // Request a string response from the provided URL.                                           </span>
<span class="-7080864972701183073" onmouseenter="enter('-7080864972701183073');" onmouseout="out('-7080864972701183073');" style=""> 480                      StringRequest stringRequest = new StringRequest(Request.Method.GET, url,                      </span>
<span class="1580018343670400637" onmouseenter="enter('1580018343670400637');" onmouseout="out('1580018343670400637');" style=""> 481                              new Response.Listener&lt;String&gt;() {                                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 482                                  @Override                                                                         </span>
<span class="2219137294630149657" onmouseenter="enter('2219137294630149657');" onmouseout="out('2219137294630149657');" style=""> 483                                  public void onResponse(String response) {                                         </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 484                                      JSONObject o = new JSONObject();                                              </span>
<span class="3496993666001094453" onmouseenter="enter('3496993666001094453');" onmouseout="out('3496993666001094453');" style=""> 485                                      if (xmlPath.length() != 0) {                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 486                                          try {                                                                     </span>
<span class="5597187660883583119" onmouseenter="enter('5597187660883583119');" onmouseout="out('5597187660883583119');" style=""> 487                                              InputSource inputXML = new InputSource(new StringReader(response));   </span>
<span class="-160158441380049344" onmouseenter="enter('-160158441380049344');" onmouseout="out('-160158441380049344');" style=""> 488                                              XPath xPath = XPathFactory.newInstance().newXPath();                  </span>
<span class="-5056989228059087382" onmouseenter="enter('-5056989228059087382');" onmouseout="out('-5056989228059087382');" style=""> 489                                              response = xPath.evaluate(xmlPath, inputXML);                         </span>
<span class="6902166904876459873" onmouseenter="enter('6902166904876459873');" onmouseout="out('6902166904876459873');" style=""> 490                                          } catch (Exception error) {                                               </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 491                                              uartTxJSONError(&quot;http&quot;, error.toString(),id);                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 492                                              return;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493                                          }                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494                                      }                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 495                                      try {                                                                         </span>
<span class="6603605385044119606" onmouseenter="enter('6603605385044119606');" onmouseout="out('6603605385044119606');" style=""> 496                                          o.put(&quot;t&quot;, &quot;http&quot;);                                                       </span>
<span class="533807089894271001" onmouseenter="enter('533807089894271001');" onmouseout="out('533807089894271001');" style=""> 497                                          if( id!=null)                                                             </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 498                                              o.put(&quot;id&quot;, id);                                                      </span>
<span class="-7019821812941989411" onmouseenter="enter('-7019821812941989411');" onmouseout="out('-7019821812941989411');" style=""> 499                                          o.put(&quot;resp&quot;, response);                                                  </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 500                                      } catch (JSONException e) {                                                   </span>
<span class="5084509021389731794" onmouseenter="enter('5084509021389731794');" onmouseout="out('5084509021389731794');" style=""><abbr title=" 501                                          GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);"> 501                                          GB.toast(getContext(), &quot;HTTP: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LOðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502                                      }                                                                             </span>
<span class="-4140114778756524985" onmouseenter="enter('-4140114778756524985');" onmouseout="out('-4140114778756524985');" style=""> 503                                      uartTxJSON(&quot;http&quot;, o);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504                                  }                                                                                 </span>
<span class="4760556576659557486" onmouseenter="enter('4760556576659557486');" onmouseout="out('4760556576659557486');" style=""> 505                              }, new Response.ErrorListener() {                                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 506                          @Override                                                                                 </span>
<span class="3365806574504816618" onmouseenter="enter('3365806574504816618');" onmouseout="out('3365806574504816618');" style=""> 507                          public void onErrorResponse(VolleyError error) {                                          </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 508                              JSONObject o = new JSONObject();                                                      </span>
<span class="-7915337954596231780" onmouseenter="enter('-7915337954596231780');" onmouseout="out('-7915337954596231780');" style=""> 509                              uartTxJSONError(&quot;http&quot;, error.toString(),id);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510                          }                                                                                         </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 511                      });                                                                                           </span>
<span class="-2087140764948748418" onmouseenter="enter('-2087140764948748418');" onmouseout="out('-2087140764948748418');" style=""> 512                      queue.add(stringRequest);                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 513                  } else {                                                                                          </span>
<span class="-204746163834141844" onmouseenter="enter('-204746163834141844');" onmouseout="out('-204746163834141844');" style=""> 514                      if (BuildConfig.INTERNET_ACCESS)                                                              </span>
<span class="-1860415774351364303" onmouseenter="enter('-1860415774351364303');" onmouseout="out('-1860415774351364303');" style=""><abbr title=" 515                          uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device Settings&quot;,id);"> 515                          uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled, check Gadgetbridge Device Settings&quot;,ðŸ”µ</abbr></span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 516                      else                                                                                          </span>
<span class="-8529240479352607945" onmouseenter="enter('-8529240479352607945');" onmouseout="out('-8529240479352607945');" style=""> 517                          uartTxJSONError(&quot;http&quot;, &quot;Internet access not enabled in this Gadgetbridge build&quot;,id);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518                  }                                                                                                 </span>
<span class="3494613965878019271" onmouseenter="enter('3494613965878019271');" onmouseout="out('3494613965878019271');" style=""> 519              } break;                                                                                              </span>
<span class="7434952261878113170" onmouseenter="enter('7434952261878113170');" onmouseout="out('7434952261878113170');" style=""> 520              case &quot;intent&quot;: {                                                                                      </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 521                  Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress())); </span>
<span class="-3997484102524704678" onmouseenter="enter('-3997484102524704678');" onmouseout="out('-3997484102524704678');" style=""> 522                  if (devicePrefs.getBoolean(PREF_DEVICE_INTENTS, false)) {                                         </span>
<span class="7885860666276152502" onmouseenter="enter('7885860666276152502');" onmouseout="out('7885860666276152502');" style=""> 523                      String action = json.getString(&quot;action&quot;);                                                     </span>
<span class="-6778424845662998727" onmouseenter="enter('-6778424845662998727');" onmouseout="out('-6778424845662998727');" style=""> 524                      JSONObject extra = json.getJSONObject(&quot;extra&quot;);                                               </span>
<span class="5907617214453163300" onmouseenter="enter('5907617214453163300');" onmouseout="out('5907617214453163300');" style=""> 525                      Intent in = new Intent();                                                                     </span>
<span class="-8779884887971893320" onmouseenter="enter('-8779884887971893320');" onmouseout="out('-8779884887971893320');" style=""> 526                      in.setAction(action);                                                                         </span>
<span class="-5835095174807794521" onmouseenter="enter('-5835095174807794521');" onmouseout="out('-5835095174807794521');" style=""> 527                      if (extra != null) {                                                                          </span>
<span class="7421222014058952195" onmouseenter="enter('7421222014058952195');" onmouseout="out('7421222014058952195');" style=""> 528                          Iterator&lt;String&gt; iter = extra.keys();                                                     </span>
<span class="-1112121426929780205" onmouseenter="enter('-1112121426929780205');" onmouseout="out('-1112121426929780205');" style=""> 529                          while (iter.hasNext()) {                                                                  </span>
<span class="8057540540642579767" onmouseenter="enter('8057540540642579767');" onmouseout="out('8057540540642579767');" style=""> 530                              String key = iter.next();                                                             </span>
<span class="-6860780283306876147" onmouseenter="enter('-6860780283306876147');" onmouseout="out('-6860780283306876147');" style=""> 531                              in.putExtra(key, extra.getString(key));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533                      }                                                                                             </span>
<span class="6658078666630545861" onmouseenter="enter('6658078666630545861');" onmouseout="out('6658078666630545861');" style=""> 534                      LOG.info(&quot;Sending intent &quot; + action);                                                         </span>
<span class="-5369611568799868297" onmouseenter="enter('-5369611568799868297');" onmouseout="out('-5369611568799868297');" style=""> 535                      this.getContext().getApplicationContext().sendBroadcast(in);                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 536                  } else {                                                                                          </span>
<span class="7018402905003983802" onmouseenter="enter('7018402905003983802');" onmouseout="out('7018402905003983802');" style=""> 537                      uartTxJSONError(&quot;intent&quot;, &quot;Android Intents not enabled, check Gadgetbridge Device Settings&quot;); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539              }                                                                                                     </span>
<span class="-2384932350282687845" onmouseenter="enter('-2384932350282687845');" onmouseout="out('-2384932350282687845');" style=""> 540              default : {                                                                                           </span>
<span class="880605181182979788" onmouseenter="enter('880605181182979788');" onmouseout="out('880605181182979788');" style=""> 541                  LOG.info(&quot;UART RX JSON packet type &#x27;&quot;+packetType+&quot;&#x27; not understood.&quot;);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544      }                                                                                                             </span>
<span  style=""> 545                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 546      @Override                                                                                                     </span>
<span class="5766835775206074860" onmouseenter="enter('5766835775206074860');" onmouseout="out('5766835775206074860');" style=""> 547      public boolean onCharacteristicChanged(BluetoothGatt gatt,                                                    </span>
<span class="-4605279869462858246" onmouseenter="enter('-4605279869462858246');" onmouseout="out('-4605279869462858246');" style=""> 548                                             BluetoothGattCharacteristic characteristic) {                          </span>
<span class="3568353468682512593" onmouseenter="enter('3568353468682512593');" onmouseout="out('3568353468682512593');" style=""> 549          if (super.onCharacteristicChanged(gatt, characteristic)) {                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 550              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551          }                                                                                                         </span>
<span class="5227655087294118325" onmouseenter="enter('5227655087294118325');" onmouseout="out('5227655087294118325');" style=""> 552          if (BangleJSConstants.UUID_CHARACTERISTIC_NORDIC_UART_RX.equals(characteristic.getUuid())) {              </span>
<span class="5982523523606215133" onmouseenter="enter('5982523523606215133');" onmouseout="out('5982523523606215133');" style=""> 553              byte[] chars = characteristic.getValue();                                                             </span>
<span class="616145045349787748" onmouseenter="enter('616145045349787748');" onmouseout="out('616145045349787748');" style=""> 554              // check to see if we get more data - if so, increase out MTU for sending                             </span>
<span class="-514373143088406372" onmouseenter="enter('-514373143088406372');" onmouseout="out('-514373143088406372');" style=""> 555              if (allowHighMTU &amp;&amp; chars.length &gt; mtuSize)                                                           </span>
<span class="4158896835387507605" onmouseenter="enter('4158896835387507605');" onmouseout="out('4158896835387507605');" style=""> 556                  mtuSize = chars.length;                                                                           </span>
<span class="2539938136572489105" onmouseenter="enter('2539938136572489105');" onmouseout="out('2539938136572489105');" style=""> 557              String packetStr = new String(chars);                                                                 </span>
<span class="-8749842360460534491" onmouseenter="enter('-8749842360460534491');" onmouseout="out('-8749842360460534491');" style=""> 558              LOG.info(&quot;RX: &quot; + packetStr);                                                                         </span>
<span class="6081730255717431423" onmouseenter="enter('6081730255717431423');" onmouseout="out('6081730255717431423');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 559 +            // logging                                                                                            </span>
<span class="-5745508240241304992" onmouseenter="enter('-5745508240241304992');" onmouseout="out('-5745508240241304992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 560 +            receiveHistory += packetStr;                                                                          </span>
<span class="3030748261717732019" onmouseenter="enter('3030748261717732019');" onmouseout="out('3030748261717732019');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 561 +            if (receiveHistory.length() &gt; MAX_RECEIVE_HISTORY_CHARS)                                              </span>
<span class="2384681518975537665" onmouseenter="enter('2384681518975537665');" onmouseout="out('2384681518975537665');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 562 +                receiveHistory = receiveHistory.substring(receiveHistory.length() - MAX_RECEIVE_HISTORY_CHARS);   </span>
<span class="4345605670928647371" onmouseenter="enter('4345605670928647371');" onmouseout="out('4345605670928647371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 563 +            // split into input lines                                                                             </span>
<span class="5259079271083901413" onmouseenter="enter('5259079271083901413');" onmouseout="out('5259079271083901413');" style=""> 564              receivedLine += packetStr;                                                                            </span>
<span class="-2556332053060264516" onmouseenter="enter('-2556332053060264516');" onmouseout="out('-2556332053060264516');" style=""> 565              while (receivedLine.contains(&quot;\n&quot;)) {                                                                 </span>
<span class="4579450793956603432" onmouseenter="enter('4579450793956603432');" onmouseout="out('4579450793956603432');" style=""> 566                  int p = receivedLine.indexOf(&quot;\n&quot;);                                                               </span>
<span class="-477187957539062569" onmouseenter="enter('-477187957539062569');" onmouseout="out('-477187957539062569');" style=""> 567                  String line =  receivedLine.substring(0,p-1);                                                     </span>
<span class="8894037851537473877" onmouseenter="enter('8894037851537473877');" onmouseout="out('8894037851537473877');" style=""> 568                  receivedLine = receivedLine.substring(p+1);                                                       </span>
<span class="-3428869778620909618" onmouseenter="enter('-3428869778620909618');" onmouseout="out('-3428869778620909618');" style=""> 569                  handleUartRxLine(line);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570              }                                                                                                     </span>





<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 572          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573      }                                                                                                             </span>
<span  style=""> 574                                                                                                                    </span>
<span  style=""> 575                                                                                                                    </span>
<span class="3689734917392452830" onmouseenter="enter('3689734917392452830');" onmouseout="out('3689734917392452830');" style=""> 576      void transmitTime(TransactionBuilder builder) {                                                               </span>
<span class="-580696616137890311" onmouseenter="enter('-580696616137890311');" onmouseout="out('-580696616137890311');" style=""> 577        long ts = System.currentTimeMillis();                                                                       </span>
<span class="2966270791537104856" onmouseenter="enter('2966270791537104856');" onmouseout="out('2966270791537104856');" style=""> 578        float tz = SimpleTimeZone.getDefault().getOffset(ts) / (1000 * 60 * 60.0f);                                 </span>
<span class="3431964532899256755" onmouseenter="enter('3431964532899256755');" onmouseout="out('3431964532899256755');" style=""> 579        // set time                                                                                                 </span>
<span class="-1610279467427834467" onmouseenter="enter('-1610279467427834467');" onmouseout="out('-1610279467427834467');" style=""> 580        String cmd = &quot;\u0010setTime(&quot;+(ts/1000)+&quot;);&quot;;                                                               </span>
<span class="-8332305144616549872" onmouseenter="enter('-8332305144616549872');" onmouseout="out('-8332305144616549872');" style=""> 581        // set timezone                                                                                             </span>
<span class="-5517412366789003339" onmouseenter="enter('-5517412366789003339');" onmouseout="out('-5517412366789003339');" style=""> 582        cmd += &quot;E.setTimeZone(&quot;+tz+&quot;);&quot;;                                                                            </span>
<span class="-1545435846395421943" onmouseenter="enter('-1545435846395421943');" onmouseout="out('-1545435846395421943');" style=""> 583        // write timezone to settings                                                                               </span>
<span class="-5908148183258021619" onmouseenter="enter('-5908148183258021619');" onmouseout="out('-5908148183258021619');" style=""><abbr title=" 584        cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;Storage&#x27;).readJSON(&#x27;setting.json&#x27;,1))&quot;;"> 584        cmd += &quot;(s=&gt;{s&amp;&amp;(s.timezone=&quot;+tz+&quot;)&amp;&amp;require(&#x27;Storage&#x27;).write(&#x27;setting.json&#x27;,s);})(require(&#x27;Storage&#x27;).readJSðŸ”µ</abbr></span>
<span class="4089130236590622366" onmouseenter="enter('4089130236590622366');" onmouseout="out('4089130236590622366');" style=""> 585        uartTx(builder, cmd+&quot;\n&quot;);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586      }                                                                                                             </span>
<span  style=""> 587                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 588      @Override                                                                                                     </span>
<span class="-5141762163842231173" onmouseenter="enter('-5141762163842231173');" onmouseout="out('-5141762163842231173');" style=""> 589      public boolean useAutoConnect() {                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 590          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591      }                                                                                                             </span>
<span  style=""> 592                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 593 -                                                                                                                  </span>
<span class="-8620112809460611919" onmouseenter="enter('-8620112809460611919');" onmouseout="out('-8620112809460611919');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 594 +    private String renderUnicodeWordAsImage(String word) {                                                        </span>
<span class="9035541491240023486" onmouseenter="enter('9035541491240023486');" onmouseout="out('9035541491240023486');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 595 +        // check for emoji                                                                                        </span>
<span class="5486434163020554131" onmouseenter="enter('5486434163020554131');" onmouseout="out('5486434163020554131');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 596 +        boolean hasEmoji = false;                                                                                 </span>
<span class="-4354250430909135512" onmouseenter="enter('-4354250430909135512');" onmouseout="out('-4354250430909135512');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +        if (EmojiUtils.getAllEmojis()==null)                                                                      </span>
<span class="-4263391647615423897" onmouseenter="enter('-4263391647615423897');" onmouseout="out('-4263391647615423897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 598 +            EmojiManager.initEmojiData(GBApplication.getContext());                                               </span>
<span class="7493806979185135357" onmouseenter="enter('7493806979185135357');" onmouseout="out('7493806979185135357');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +        for(Emoji emoji : EmojiUtils.getAllEmojis())                                                              </span>
<span class="-5951281087173806711" onmouseenter="enter('-5951281087173806711');" onmouseout="out('-5951281087173806711');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +            if (word.contains(emoji.getEmoji())) hasEmoji = true;                                                 </span>
<span class="2890001900011943869" onmouseenter="enter('2890001900011943869');" onmouseout="out('2890001900011943869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +        // if we had emoji, ensure we create 3 bit color (not 1 bit B&amp;W)                                          </span>
<span class="-5597957252839048845" onmouseenter="enter('-5597957252839048845');" onmouseout="out('-5597957252839048845');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 602 +        return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : BangleJSBitmapStyle.MONOCHROME);"> 602 +        return &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(word), hasEmoji ? BangleJSBitmapStyle.RGB_3BPP : BangleJSBðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 603 +    }                                                                                                             </span>
<span  style=""> 604                                                                                                                    </span>
<span class="8776024667736839740" onmouseenter="enter('8776024667736839740');" onmouseout="out('8776024667736839740');" style=""> 605      public String renderUnicodeAsImage(String txt) {                                                              </span>
<span class="-1342218611990734243" onmouseenter="enter('-1342218611990734243');" onmouseout="out('-1342218611990734243');" style=""> 606          if (txt==null) return null;                                                                               </span>
<span class="-2209668059421895927" onmouseenter="enter('-2209668059421895927');" onmouseout="out('-2209668059421895927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 607 -        // If we&#x27;re not doing conversion, pass this right back                                                    </span>
<span class="-2990212439896506505" onmouseenter="enter('-2990212439896506505');" onmouseout="out('-2990212439896506505');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 608 +        /* If we&#x27;re not doing conversion, pass this right back (we use the EmojiConverter                         </span>
<span class="-9019482477548156237" onmouseenter="enter('-9019482477548156237');" onmouseout="out('-9019482477548156237');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 609 +        As we would have done if BangleJSCoordinator.supportsUnicodeEmojis had reported false */                  </span>
<span class="8725140559661098998" onmouseenter="enter('8725140559661098998');" onmouseout="out('8725140559661098998');" style=""> 610          Prefs devicePrefs = new Prefs(GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()));         </span>
<span class="6036337086743190632" onmouseenter="enter('6036337086743190632');" onmouseout="out('6036337086743190632');" style=""> 611          if (!devicePrefs.getBoolean(PREF_BANGLEJS_TEXT_BITMAP, false))                                            </span>
<span class="-7288271959595239698" onmouseenter="enter('-7288271959595239698');" onmouseout="out('-7288271959595239698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 612 -            return txt;                                                                                           </span>
<span class="292577723455835940" onmouseenter="enter('292577723455835940');" onmouseout="out('292577723455835940');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 613 -        // Otherwise split up and check each word                                                                 </span>
<span class="1809640108333429188" onmouseenter="enter('1809640108333429188');" onmouseout="out('1809640108333429188');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 614 -        String words[] = txt.split(&quot; &quot;);                                                                          </span>
<span class="3637940892999293193" onmouseenter="enter('3637940892999293193');" onmouseout="out('3637940892999293193');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 615 -        for (int i=0;i&lt;words.length;i++) {                                                                        </span>
<span class="-1261873167777271973" onmouseenter="enter('-1261873167777271973');" onmouseout="out('-1261873167777271973');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -            boolean isRenderable = true;                                                                          </span>
<span class="1989178542676826816" onmouseenter="enter('1989178542676826816');" onmouseout="out('1989178542676826816');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -            for (int j=0;j&lt;words[i].length();j++) {                                                               </span>
<span class="-16469041501275168" onmouseenter="enter('-16469041501275168');" onmouseout="out('-16469041501275168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 618 -                char c = words[i].charAt(j);                                                                      </span>
<span class="-6218899606023063069" onmouseenter="enter('-6218899606023063069');" onmouseout="out('-6218899606023063069');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 619 +            return EmojiConverter.convertUnicodeEmojiToAscii(txt, GBApplication.getContext());                    </span>
<span class="292577723455835940" onmouseenter="enter('292577723455835940');" onmouseout="out('292577723455835940');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 620 +         // Otherwise split up and check each word                                                                </span>
<span class="-5288421538986521183" onmouseenter="enter('-5288421538986521183');" onmouseout="out('-5288421538986521183');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 621 +        String word = &quot;&quot;, result = &quot;&quot;;                                                                            </span>
<span class="-760381533077121579" onmouseenter="enter('-760381533077121579');" onmouseout="out('-760381533077121579');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 622 +        boolean needsTranslate = false;                                                                           </span>
<span class="-4776297315441687962" onmouseenter="enter('-4776297315441687962');" onmouseout="out('-4776297315441687962');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 623 +        for (int i=0;i&lt;txt.length();i++) {                                                                        </span>
<span class="-3301384702044321827" onmouseenter="enter('-3301384702044321827');" onmouseout="out('-3301384702044321827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 624 +            char ch = txt.charAt(i);                                                                              </span>
<span class="-3018677457763070108" onmouseenter="enter('-3018677457763070108');" onmouseout="out('-3018677457763070108');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 625 +            if (&quot; -_/:.,?!&#x27;\&quot;&amp;*()&quot;.indexOf(ch)&gt;=0) {                                                              </span>
<span class="1318526908393735015" onmouseenter="enter('1318526908393735015');" onmouseout="out('1318526908393735015');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 626 +                // word split                                                                                     </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 627 +                if (needsTranslate) { // convert word                                                             </span>
<span class="-3387652020968698915" onmouseenter="enter('-3387652020968698915');" onmouseout="out('-3387652020968698915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 628 +                    result += renderUnicodeWordAsImage(word)+ch;                                                  </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 629 +                } else { // or just copy across                                                                   </span>
<span class="1121164921789299019" onmouseenter="enter('1121164921789299019');" onmouseout="out('1121164921789299019');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 630 +                    result += word+ch;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 631 +                }                                                                                                 </span>
<span class="4599818924517102902" onmouseenter="enter('4599818924517102902');" onmouseout="out('4599818924517102902');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 632 +                word = &quot;&quot;;                                                                                        </span>
<span class="1499680785627976825" onmouseenter="enter('1499680785627976825');" onmouseout="out('1499680785627976825');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 633 +                needsTranslate = false;                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 634 +            } else {                                                                                              </span>
<span class="5371833621916626168" onmouseenter="enter('5371833621916626168');" onmouseout="out('5371833621916626168');" style=""> 635                  // TODO: better check?                                                                            </span>
<span class="6054207687507284700" onmouseenter="enter('6054207687507284700');" onmouseout="out('6054207687507284700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 636 -                if (c&lt;0 || c&gt;255) isRenderable = false;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 637 -            }                                                                                                     </span>
<span class="2526594978603575319" onmouseenter="enter('2526594978603575319');" onmouseout="out('2526594978603575319');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 638 -            if (!isRenderable)                                                                                    </span>
<span class="1972284869698434639" onmouseenter="enter('1972284869698434639');" onmouseout="out('1972284869698434639');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 639 -                words[i] = &quot;\0&quot;+bitmapToEspruinoString(textToBitmap(words[i]));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 640 -        }                                                                                                         </span>
<span class="-4584734899719749670" onmouseenter="enter('-4584734899719749670');" onmouseout="out('-4584734899719749670');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 641 -        return String.join(&quot; &quot;, words);                                                                           </span>
<span class="-123072587783183541" onmouseenter="enter('-123072587783183541');" onmouseout="out('-123072587783183541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 642 +                if (ch&lt;0 || ch&gt;255) needsTranslate = true;                                                        </span>
<span class="2225265087012361140" onmouseenter="enter('2225265087012361140');" onmouseout="out('2225265087012361140');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 643 +                word += ch;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 644 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 645 +        }                                                                                                         </span>
<span class="-4781296342404793482" onmouseenter="enter('-4781296342404793482');" onmouseout="out('-4781296342404793482');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 646 +        if (needsTranslate) { // convert word                                                                     </span>
<span class="-2531563633600833789" onmouseenter="enter('-2531563633600833789');" onmouseout="out('-2531563633600833789');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 647 +            result += renderUnicodeWordAsImage(word);                                                             </span>
<span class="9087636364182332830" onmouseenter="enter('9087636364182332830');" onmouseout="out('9087636364182332830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 648 +        } else { // or just copy across                                                                           </span>
<span class="-4182205432270767968" onmouseenter="enter('-4182205432270767968');" onmouseout="out('-4182205432270767968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 649 +            result += word;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 650 +        }                                                                                                         </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 651 +        return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652      }                                                                                                             </span>
<span  style=""> 653                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 654      @Override                                                                                                     </span>
<span class="-116609517646424186" onmouseenter="enter('-116609517646424186');" onmouseout="out('-116609517646424186');" style=""> 655      public void onNotification(NotificationSpec notificationSpec) {                                               </span>
<span class="7244891213408121655" onmouseenter="enter('7244891213408121655');" onmouseout="out('7244891213408121655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 656 +        for (int i=0;i&lt;notificationSpec.attachedActions.size();i++) {                                             </span>
<span class="-1299099168286401629" onmouseenter="enter('-1299099168286401629');" onmouseout="out('-1299099168286401629');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 657 +            NotificationSpec.Action action = notificationSpec.attachedActions.get(i);                             </span>
<span class="1218815619539919953" onmouseenter="enter('1218815619539919953');" onmouseout="out('1218815619539919953');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 658 +            if (action.type==NotificationSpec.Action.TYPE_WEARABLE_REPLY)                                         </span>
<span class="-2487072541266275253" onmouseenter="enter('-2487072541266275253');" onmouseout="out('-2487072541266275253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 659 +                mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.getId()&lt;&lt;4) + i + 1)); // wow. This should be easier!"> 659 +                mNotificationReplyAction.add(notificationSpec.getId(), new Long(((long)notificationSpec.getId()&lt;&lt;4ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 660 +        }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 661          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 662              JSONObject o = new JSONObject();                                                                      </span>
<span class="-3237033879846899756" onmouseenter="enter('-3237033879846899756');" onmouseout="out('-3237033879846899756');" style=""> 663              o.put(&quot;t&quot;, &quot;notify&quot;);                                                                                 </span>
<span class="-2996816801319654727" onmouseenter="enter('-2996816801319654727');" onmouseout="out('-2996816801319654727');" style=""> 664              o.put(&quot;id&quot;, notificationSpec.getId());                                                                </span>
<span class="7446549792523373865" onmouseenter="enter('7446549792523373865');" onmouseout="out('7446549792523373865');" style=""> 665              o.put(&quot;src&quot;, notificationSpec.sourceName);                                                            </span>
<span class="-2496842413615993216" onmouseenter="enter('-2496842413615993216');" onmouseout="out('-2496842413615993216');" style=""> 666              o.put(&quot;title&quot;, renderUnicodeAsImage(notificationSpec.title));                                         </span>
<span class="8572918879739705875" onmouseenter="enter('8572918879739705875');" onmouseout="out('8572918879739705875');" style=""> 667              o.put(&quot;subject&quot;, renderUnicodeAsImage(notificationSpec.subject));                                     </span>
<span class="-1911849092192349426" onmouseenter="enter('-1911849092192349426');" onmouseout="out('-1911849092192349426');" style=""> 668              o.put(&quot;body&quot;, renderUnicodeAsImage(notificationSpec.body));                                           </span>
<span class="-504952153198563265" onmouseenter="enter('-504952153198563265');" onmouseout="out('-504952153198563265');" style=""> 669              o.put(&quot;sender&quot;, renderUnicodeAsImage(notificationSpec.sender));                                       </span>
<span class="-5726859549953031700" onmouseenter="enter('-5726859549953031700');" onmouseout="out('-5726859549953031700');" style=""> 670              o.put(&quot;tel&quot;, notificationSpec.phoneNumber);                                                           </span>
<span class="7885351870399476726" onmouseenter="enter('7885351870399476726');" onmouseout="out('7885351870399476726');" style=""> 671              uartTxJSON(&quot;onNotification&quot;, o);                                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 672          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 673              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675      }                                                                                                             </span>
<span  style=""> 676                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 677      @Override                                                                                                     </span>
<span class="-1102873404195143085" onmouseenter="enter('-1102873404195143085');" onmouseout="out('-1102873404195143085');" style=""> 678      public void onDeleteNotification(int id) {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 679          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 680              JSONObject o = new JSONObject();                                                                      </span>
<span class="8475479069823885977" onmouseenter="enter('8475479069823885977');" onmouseout="out('8475479069823885977');" style=""> 681              o.put(&quot;t&quot;, &quot;notify-&quot;);                                                                                </span>
<span class="4919027600147688741" onmouseenter="enter('4919027600147688741');" onmouseout="out('4919027600147688741');" style=""> 682              o.put(&quot;id&quot;, id);                                                                                      </span>
<span class="4156835990201809715" onmouseenter="enter('4156835990201809715');" onmouseout="out('4156835990201809715');" style=""> 683              uartTxJSON(&quot;onDeleteNotification&quot;, o);                                                                </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 684          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 685              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687      }                                                                                                             </span>
<span  style=""> 688                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 689      @Override                                                                                                     </span>
<span class="7164248173527032001" onmouseenter="enter('7164248173527032001');" onmouseout="out('7164248173527032001');" style=""> 690      public void onSetTime() {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 691          try {                                                                                                     </span>
<span class="-5785975329698273515" onmouseenter="enter('-5785975329698273515');" onmouseout="out('-5785975329698273515');" style=""> 692              TransactionBuilder builder = performInitialized(&quot;setTime&quot;);                                           </span>
<span class="5146306396474603796" onmouseenter="enter('5146306396474603796');" onmouseout="out('5146306396474603796');" style=""> 693              transmitTime(builder);                                                                                </span>
<span class="-5534937907083456817" onmouseenter="enter('-5534937907083456817');" onmouseout="out('-5534937907083456817');" style=""> 694              builder.queue(getQueue());                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 695          } catch (Exception e) {                                                                                   </span>
<span class="5000424150373642922" onmouseenter="enter('5000424150373642922');" onmouseout="out('5000424150373642922');" style=""> 696              GB.toast(getContext(), &quot;Error setting time: &quot; + e.getLocalizedMessage(), Toast.LENGTH_LONG, GB.ERROR);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698      }                                                                                                             </span>
<span  style=""> 699                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 700      @Override                                                                                                     </span>
<span class="-6473317888357330260" onmouseenter="enter('-6473317888357330260');" onmouseout="out('-6473317888357330260');" style=""> 701      public void onSetAlarms(ArrayList&lt;? extends Alarm&gt; alarms) {                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 702          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 703              JSONObject o = new JSONObject();                                                                      </span>
<span class="3488284827981638605" onmouseenter="enter('3488284827981638605');" onmouseout="out('3488284827981638605');" style=""> 704              o.put(&quot;t&quot;, &quot;alarm&quot;);                                                                                  </span>
<span class="2586106610260987486" onmouseenter="enter('2586106610260987486');" onmouseout="out('2586106610260987486');" style=""> 705              JSONArray jsonalarms = new JSONArray();                                                               </span>
<span class="7012783305172244346" onmouseenter="enter('7012783305172244346');" onmouseout="out('7012783305172244346');" style=""> 706              o.put(&quot;d&quot;, jsonalarms);                                                                               </span>
<span  style=""> 707                                                                                                                    </span>
<span class="-7996805109404385335" onmouseenter="enter('-7996805109404385335');" onmouseout="out('-7996805109404385335');" style=""> 708              for (Alarm alarm : alarms) {                                                                          </span>
<span class="-7206413691565762606" onmouseenter="enter('-7206413691565762606');" onmouseout="out('-7206413691565762606');" style=""> 709                  if (!alarm.getEnabled()) continue;                                                                </span>
<span class="1488433958727864154" onmouseenter="enter('1488433958727864154');" onmouseout="out('1488433958727864154');" style=""> 710                  JSONObject jsonalarm = new JSONObject();                                                          </span>
<span class="-2065505732499951357" onmouseenter="enter('-2065505732499951357');" onmouseout="out('-2065505732499951357');" style=""> 711                  jsonalarms.put(jsonalarm);                                                                        </span>
<span  style=""> 712                                                                                                                    </span>
<span class="169777398048646112" onmouseenter="enter('169777398048646112');" onmouseout="out('169777398048646112');" style=""> 713                  Calendar calendar = AlarmUtils.toCalendar(alarm);                                                 </span>
<span  style=""> 714                                                                                                                    </span>
<span class="6578593229745866209" onmouseenter="enter('6578593229745866209');" onmouseout="out('6578593229745866209');" style=""> 715                  jsonalarm.put(&quot;h&quot;, alarm.getHour());                                                              </span>
<span class="7461878622333576123" onmouseenter="enter('7461878622333576123');" onmouseout="out('7461878622333576123');" style=""> 716                  jsonalarm.put(&quot;m&quot;, alarm.getMinute());                                                            </span>
<span class="97057399767477313" onmouseenter="enter('97057399767477313');" onmouseout="out('97057399767477313');" style=""> 717                  jsonalarm.put(&quot;rep&quot;, alarm.getRepetition());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718              }                                                                                                     </span>
<span class="7288963480750843606" onmouseenter="enter('7288963480750843606');" onmouseout="out('7288963480750843606');" style=""> 719              uartTxJSON(&quot;onSetAlarms&quot;, o);                                                                         </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 720          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 721              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 722          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723      }                                                                                                             </span>
<span  style=""> 724                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 725      @Override                                                                                                     </span>
<span class="8502851833159229707" onmouseenter="enter('8502851833159229707');" onmouseout="out('8502851833159229707');" style=""> 726      public void onSetCallState(CallSpec callSpec) {                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 727          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 728              JSONObject o = new JSONObject();                                                                      </span>
<span class="4158854171585038558" onmouseenter="enter('4158854171585038558');" onmouseout="out('4158854171585038558');" style=""> 729              o.put(&quot;t&quot;, &quot;call&quot;);                                                                                   </span>
<span class="3958892663366704764" onmouseenter="enter('3958892663366704764');" onmouseout="out('3958892663366704764');" style=""> 730              String cmdName = &quot;&quot;;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 731              try {                                                                                                 </span>
<span class="-9009466648790586927" onmouseenter="enter('-9009466648790586927');" onmouseout="out('-9009466648790586927');" style=""> 732                  Field fields[] = callSpec.getClass().getDeclaredFields();                                         </span>
<span class="-8522204470221494922" onmouseenter="enter('-8522204470221494922');" onmouseout="out('-8522204470221494922');" style=""> 733                  for (Field field : fields)                                                                        </span>
<span class="-7797368603385788624" onmouseenter="enter('-7797368603385788624');" onmouseout="out('-7797368603385788624');" style=""> 734                      if (field.getName().startsWith(&quot;CALL_&quot;) &amp;&amp; field.getInt(callSpec) == callSpec.command)        </span>
<span class="8043037183581644681" onmouseenter="enter('8043037183581644681');" onmouseout="out('8043037183581644681');" style=""> 735                          cmdName = field.getName().substring(5).toLowerCase();                                     </span>
<span class="-7581013626583319085" onmouseenter="enter('-7581013626583319085');" onmouseout="out('-7581013626583319085');" style=""> 736              } catch (IllegalAccessException e) {}                                                                 </span>
<span class="-1085015235935761185" onmouseenter="enter('-1085015235935761185');" onmouseout="out('-1085015235935761185');" style=""> 737              o.put(&quot;cmd&quot;, cmdName);                                                                                </span>
<span class="8637280962137247636" onmouseenter="enter('8637280962137247636');" onmouseout="out('8637280962137247636');" style=""> 738              o.put(&quot;name&quot;, renderUnicodeAsImage(callSpec.name));                                                   </span>
<span class="673690437593128793" onmouseenter="enter('673690437593128793');" onmouseout="out('673690437593128793');" style=""> 739              o.put(&quot;number&quot;, callSpec.number);                                                                     </span>
<span class="-6546279892320681741" onmouseenter="enter('-6546279892320681741');" onmouseout="out('-6546279892320681741');" style=""> 740              uartTxJSON(&quot;onSetCallState&quot;, o);                                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 741          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 742              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 744  }                                                                                                                 </span>
<span  style=""> 745                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 746      @Override                                                                                                     </span>
<span class="8238257195410140286" onmouseenter="enter('8238257195410140286');" onmouseout="out('8238257195410140286');" style=""> 747      public void onSetCannedMessages(CannedMessagesSpec cannedMessagesSpec) {                                      </span>
<span  style=""> 748                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749      }                                                                                                             </span>
<span  style=""> 750                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 751      @Override                                                                                                     </span>
<span class="8228188929931998548" onmouseenter="enter('8228188929931998548');" onmouseout="out('8228188929931998548');" style=""> 752      public void onSetMusicState(MusicStateSpec stateSpec) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 753          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 754              JSONObject o = new JSONObject();                                                                      </span>
<span class="-92554745071265211" onmouseenter="enter('-92554745071265211');" onmouseout="out('-92554745071265211');" style=""> 755              o.put(&quot;t&quot;, &quot;musicstate&quot;);                                                                             </span>
<span class="8807632241012571777" onmouseenter="enter('8807632241012571777');" onmouseout="out('8807632241012571777');" style=""> 756              int musicState = stateSpec.state;                                                                     </span>
<span class="-8234435338877590300" onmouseenter="enter('-8234435338877590300');" onmouseout="out('-8234435338877590300');" style=""> 757              String[] musicStates = {&quot;play&quot;, &quot;pause&quot;, &quot;stop&quot;, &quot;&quot;};                                                 </span>
<span class="-9088398443169884235" onmouseenter="enter('-9088398443169884235');" onmouseout="out('-9088398443169884235');" style=""> 758              if (musicState&lt;0) musicState=3;                                                                       </span>
<span class="2321591687835617567" onmouseenter="enter('2321591687835617567');" onmouseout="out('2321591687835617567');" style=""> 759              if (musicState&gt;=musicStates.length) musicState = musicStates.length-1;                                </span>
<span class="-1010325962977709940" onmouseenter="enter('-1010325962977709940');" onmouseout="out('-1010325962977709940');" style=""> 760              o.put(&quot;state&quot;, musicStates[musicState]);                                                              </span>
<span class="4362989328077723220" onmouseenter="enter('4362989328077723220');" onmouseout="out('4362989328077723220');" style=""> 761              o.put(&quot;position&quot;, stateSpec.position);                                                                </span>
<span class="-521013622091952719" onmouseenter="enter('-521013622091952719');" onmouseout="out('-521013622091952719');" style=""> 762              o.put(&quot;shuffle&quot;, stateSpec.shuffle);                                                                  </span>
<span class="7992510141527813217" onmouseenter="enter('7992510141527813217');" onmouseout="out('7992510141527813217');" style=""> 763              o.put(&quot;repeat&quot;, stateSpec.repeat);                                                                    </span>
<span class="-8798301955703322193" onmouseenter="enter('-8798301955703322193');" onmouseout="out('-8798301955703322193');" style=""> 764              uartTxJSON(&quot;onSetMusicState&quot;, o);                                                                     </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 765          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 766              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 768      }                                                                                                             </span>
<span  style=""> 769                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 770      @Override                                                                                                     </span>
<span class="-4182706906721092498" onmouseenter="enter('-4182706906721092498');" onmouseout="out('-4182706906721092498');" style=""> 771      public void onSetMusicInfo(MusicSpec musicSpec) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 772          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 773              JSONObject o = new JSONObject();                                                                      </span>
<span class="-21742499724689403" onmouseenter="enter('-21742499724689403');" onmouseout="out('-21742499724689403');" style=""> 774              o.put(&quot;t&quot;, &quot;musicinfo&quot;);                                                                              </span>
<span class="-7907833892429297395" onmouseenter="enter('-7907833892429297395');" onmouseout="out('-7907833892429297395');" style=""> 775              o.put(&quot;artist&quot;, renderUnicodeAsImage(musicSpec.artist));                                              </span>
<span class="6485281684850333943" onmouseenter="enter('6485281684850333943');" onmouseout="out('6485281684850333943');" style=""> 776              o.put(&quot;album&quot;, renderUnicodeAsImage(musicSpec.album));                                                </span>
<span class="6434659518035718811" onmouseenter="enter('6434659518035718811');" onmouseout="out('6434659518035718811');" style=""> 777              o.put(&quot;track&quot;, renderUnicodeAsImage(musicSpec.track));                                                </span>
<span class="-6589694811644482139" onmouseenter="enter('-6589694811644482139');" onmouseout="out('-6589694811644482139');" style=""> 778              o.put(&quot;dur&quot;, musicSpec.duration);                                                                     </span>
<span class="-5969522677742802968" onmouseenter="enter('-5969522677742802968');" onmouseout="out('-5969522677742802968');" style=""> 779              o.put(&quot;c&quot;, musicSpec.trackCount);                                                                     </span>
<span class="7704969334649219354" onmouseenter="enter('7704969334649219354');" onmouseout="out('7704969334649219354');" style=""> 780              o.put(&quot;n&quot;, musicSpec.trackNr);                                                                        </span>
<span class="-567994157751048073" onmouseenter="enter('-567994157751048073');" onmouseout="out('-567994157751048073');" style=""> 781              uartTxJSON(&quot;onSetMusicInfo&quot;, o);                                                                      </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 782          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 783              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785      }                                                                                                             </span>
<span  style=""> 786                                                                                                                    </span>
<span class="1808047972614051455" onmouseenter="enter('1808047972614051455');" onmouseout="out('1808047972614051455');" style=""> 787      private void transmitActivityStatus() {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 788          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 789              JSONObject o = new JSONObject();                                                                      </span>
<span class="-8158526622976442101" onmouseenter="enter('-8158526622976442101');" onmouseout="out('-8158526622976442101');" style=""> 790              o.put(&quot;t&quot;, &quot;act&quot;);                                                                                    </span>
<span class="5593394621505017212" onmouseenter="enter('5593394621505017212');" onmouseout="out('5593394621505017212');" style=""> 791              o.put(&quot;hrm&quot;, realtimeHRM);                                                                            </span>
<span class="9069762361832051811" onmouseenter="enter('9069762361832051811');" onmouseout="out('9069762361832051811');" style=""> 792              o.put(&quot;stp&quot;, realtimeStep);                                                                           </span>
<span class="4361099818971426695" onmouseenter="enter('4361099818971426695');" onmouseout="out('4361099818971426695');" style=""> 793              o.put(&quot;int&quot;, realtimeHRMInterval);                                                                    </span>
<span class="-8731247564001223528" onmouseenter="enter('-8731247564001223528');" onmouseout="out('-8731247564001223528');" style=""> 794              uartTxJSON(&quot;onEnableRealtimeSteps&quot;, o);                                                               </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 795          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 796              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798      }                                                                                                             </span>
<span  style=""> 799                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 800      @Override                                                                                                     </span>
<span class="-8425797677863799500" onmouseenter="enter('-8425797677863799500');" onmouseout="out('-8425797677863799500');" style=""> 801      public void onEnableRealtimeSteps(boolean enable) {                                                           </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 802          if (enable == realtimeHRM) return;                                                                        </span>
<span class="-5879371575258185595" onmouseenter="enter('-5879371575258185595');" onmouseout="out('-5879371575258185595');" style=""> 803          realtimeStep = enable;                                                                                    </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 804          transmitActivityStatus();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805      }                                                                                                             </span>
<span  style=""> 806                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 807      @Override                                                                                                     </span>
<span class="-4135655620136168708" onmouseenter="enter('-4135655620136168708');" onmouseout="out('-4135655620136168708');" style=""> 808      public void onInstallApp(Uri uri) {                                                                           </span>
<span  style=""> 809                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810      }                                                                                                             </span>
<span  style=""> 811                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 812      @Override                                                                                                     </span>
<span class="-3322711972275217450" onmouseenter="enter('-3322711972275217450');" onmouseout="out('-3322711972275217450');" style=""> 813      public void onAppInfoReq() {                                                                                  </span>
<span  style=""> 814                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 815      }                                                                                                             </span>
<span  style=""> 816                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 817      @Override                                                                                                     </span>
<span class="1692097554900603024" onmouseenter="enter('1692097554900603024');" onmouseout="out('1692097554900603024');" style=""> 818      public void onAppStart(UUID uuid, boolean start) {                                                            </span>
<span  style=""> 819                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820      }                                                                                                             </span>
<span  style=""> 821                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 822      @Override                                                                                                     </span>
<span class="7633110766708892729" onmouseenter="enter('7633110766708892729');" onmouseout="out('7633110766708892729');" style=""> 823      public void onAppDelete(UUID uuid) {                                                                          </span>
<span  style=""> 824                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825      }                                                                                                             </span>
<span  style=""> 826                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 827      @Override                                                                                                     </span>
<span class="2176182926116218619" onmouseenter="enter('2176182926116218619');" onmouseout="out('2176182926116218619');" style=""> 828      public void onAppConfiguration(UUID appUuid, String config, Integer id) {                                     </span>
<span  style=""> 829                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830      }                                                                                                             </span>
<span  style=""> 831                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 832      @Override                                                                                                     </span>
<span class="-2513514137107402976" onmouseenter="enter('-2513514137107402976');" onmouseout="out('-2513514137107402976');" style=""> 833      public void onAppReorder(UUID[] uuids) {                                                                      </span>
<span  style=""> 834                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835      }                                                                                                             </span>
<span  style=""> 836                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 837      @Override                                                                                                     </span>
<span class="3881968248613188942" onmouseenter="enter('3881968248613188942');" onmouseout="out('3881968248613188942');" style=""> 838      public void onFetchRecordedData(int dataTypes) {                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 839 -                                                                                                                  </span>
<span class="-3849076454550892314" onmouseenter="enter('-3849076454550892314');" onmouseout="out('-3849076454550892314');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 840 +        if (dataTypes == RecordedDataTypes.TYPE_DEBUGLOGS) {                                                      </span>
<span class="1579212162814293327" onmouseenter="enter('1579212162814293327');" onmouseout="out('1579212162814293327');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 841 +            File dir;                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 842 +            try {                                                                                                 </span>
<span class="-3526927992489947407" onmouseenter="enter('-3526927992489947407');" onmouseout="out('-3526927992489947407');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 843 +                dir = FileUtils.getExternalFilesDir();                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 844 +            } catch (IOException e) {                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 845 +                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 846 +            }                                                                                                     </span>
<span class="-8623321881845197728" onmouseenter="enter('-8623321881845197728');" onmouseout="out('-8623321881845197728');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 847 +            SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd-HHmmss&quot;, Locale.US);                     </span>
<span class="-3655538185251554118" onmouseenter="enter('-3655538185251554118');" onmouseout="out('-3655538185251554118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 848 +            String filename = &quot;banglejs_debug_&quot; + dateFormat.format(new Date()) + &quot;.log&quot;;                         </span>
<span class="2454422670405906587" onmouseenter="enter('2454422670405906587');" onmouseout="out('2454422670405906587');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 849 +            File outputFile = new File(dir, filename );                                                           </span>
<span class="6676810503762950417" onmouseenter="enter('6676810503762950417');" onmouseout="out('6676810503762950417');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 850 +            LOG.warn(&quot;Writing log to &quot;+outputFile.toString());                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 851 +            try {                                                                                                 </span>
<span class="-8771066680414961708" onmouseenter="enter('-8771066680414961708');" onmouseout="out('-8771066680414961708');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 852 +                BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile));                           </span>
<span class="4633875208200868523" onmouseenter="enter('4633875208200868523');" onmouseout="out('4633875208200868523');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 853 +                writer.write(receiveHistory);                                                                     </span>
<span class="4330639758910844474" onmouseenter="enter('4330639758910844474');" onmouseout="out('4330639758910844474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 854 +                writer.close();                                                                                   </span>
<span class="-3019360337557251714" onmouseenter="enter('-3019360337557251714');" onmouseout="out('-3019360337557251714');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 855 +                receiveHistory = &quot;&quot;;                                                                              </span>
<span class="3582332183058181346" onmouseenter="enter('3582332183058181346');" onmouseout="out('3582332183058181346');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 856 +                GB.toast(getContext(), &quot;Log written to &quot;+filename, Toast.LENGTH_LONG, GB.INFO);                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 857 +            } catch (IOException e) {                                                                             </span>
<span class="4694495530853371438" onmouseenter="enter('4694495530853371438');" onmouseout="out('4694495530853371438');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 858 +                LOG.warn(&quot;Could not write to file&quot;, e);                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 859 +                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 860 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 861 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862      }                                                                                                             </span>
<span  style=""> 863                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 864      @Override                                                                                                     </span>
<span class="3589048831688325527" onmouseenter="enter('3589048831688325527');" onmouseout="out('3589048831688325527');" style=""> 865      public void onReset(int flags) {                                                                              </span>
<span  style=""> 866                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867      }                                                                                                             </span>
<span  style=""> 868                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 869      @Override                                                                                                     </span>
<span class="-9008385526233139735" onmouseenter="enter('-9008385526233139735');" onmouseout="out('-9008385526233139735');" style=""> 870      public void onHeartRateTest() {                                                                               </span>
<span  style=""> 871                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872      }                                                                                                             </span>
<span  style=""> 873                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 874      @Override                                                                                                     </span>
<span class="2383065190612615413" onmouseenter="enter('2383065190612615413');" onmouseout="out('2383065190612615413');" style=""> 875      public void onEnableRealtimeHeartRateMeasurement(boolean enable) {                                            </span>
<span class="5274395572810491412" onmouseenter="enter('5274395572810491412');" onmouseout="out('5274395572810491412');" style=""> 876          if (enable == realtimeHRM) return;                                                                        </span>
<span class="8804907312000263363" onmouseenter="enter('8804907312000263363');" onmouseout="out('8804907312000263363');" style=""> 877          realtimeHRM = enable;                                                                                     </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 878          transmitActivityStatus();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879      }                                                                                                             </span>
<span  style=""> 880                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 881      @Override                                                                                                     </span>
<span class="-3287587973518064190" onmouseenter="enter('-3287587973518064190');" onmouseout="out('-3287587973518064190');" style=""> 882      public void onFindDevice(boolean start) {                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 883          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 884              JSONObject o = new JSONObject();                                                                      </span>
<span class="4130381404080081417" onmouseenter="enter('4130381404080081417');" onmouseout="out('4130381404080081417');" style=""> 885              o.put(&quot;t&quot;, &quot;find&quot;);                                                                                   </span>
<span class="6818313613707459779" onmouseenter="enter('6818313613707459779');" onmouseout="out('6818313613707459779');" style=""> 886              o.put(&quot;n&quot;, start);                                                                                    </span>
<span class="5958886073956724015" onmouseenter="enter('5958886073956724015');" onmouseout="out('5958886073956724015');" style=""> 887              uartTxJSON(&quot;onFindDevice&quot;, o);                                                                        </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 888          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 889              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 890          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 891      }                                                                                                             </span>
<span  style=""> 892                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 893      @Override                                                                                                     </span>
<span class="-1926054327985162362" onmouseenter="enter('-1926054327985162362');" onmouseout="out('-1926054327985162362');" style=""> 894      public void onSetConstantVibration(int integer) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 895          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 896              JSONObject o = new JSONObject();                                                                      </span>
<span class="4547736712460874928" onmouseenter="enter('4547736712460874928');" onmouseout="out('4547736712460874928');" style=""> 897              o.put(&quot;t&quot;, &quot;vibrate&quot;);                                                                                </span>
<span class="-4243820256325497798" onmouseenter="enter('-4243820256325497798');" onmouseout="out('-4243820256325497798');" style=""> 898              o.put(&quot;n&quot;, integer);                                                                                  </span>
<span class="-1000088439791572503" onmouseenter="enter('-1000088439791572503');" onmouseout="out('-1000088439791572503');" style=""> 899              uartTxJSON(&quot;onSetConstantVibration&quot;, o);                                                              </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 900          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 901              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 902          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903      }                                                                                                             </span>
<span  style=""> 904                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 905      @Override                                                                                                     </span>
<span class="-3293819866797459784" onmouseenter="enter('-3293819866797459784');" onmouseout="out('-3293819866797459784');" style=""> 906      public void onScreenshotReq() {                                                                               </span>
<span  style=""> 907                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 908      }                                                                                                             </span>
<span  style=""> 909                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 910      @Override                                                                                                     </span>
<span class="-2597044235576493624" onmouseenter="enter('-2597044235576493624');" onmouseout="out('-2597044235576493624');" style=""> 911      public void onEnableHeartRateSleepSupport(boolean enable) {                                                   </span>
<span  style=""> 912                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 913      }                                                                                                             </span>
<span  style=""> 914                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 915      @Override                                                                                                     </span>
<span class="-5895120009761092080" onmouseenter="enter('-5895120009761092080');" onmouseout="out('-5895120009761092080');" style=""> 916      public void onSetHeartRateMeasurementInterval(int seconds) {                                                  </span>
<span class="-1003654780605811203" onmouseenter="enter('-1003654780605811203');" onmouseout="out('-1003654780605811203');" style=""> 917          realtimeHRMInterval = seconds;                                                                            </span>
<span class="-9131522215257389057" onmouseenter="enter('-9131522215257389057');" onmouseout="out('-9131522215257389057');" style=""> 918          transmitActivityStatus();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 919      }                                                                                                             </span>
<span  style=""> 920                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 921      @Override                                                                                                     </span>
<span class="-7200644583722212481" onmouseenter="enter('-7200644583722212481');" onmouseout="out('-7200644583722212481');" style=""> 922      public void onAddCalendarEvent(CalendarEventSpec calendarEventSpec) {                                         </span>
<span  style=""> 923                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 924      }                                                                                                             </span>
<span  style=""> 925                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 926      @Override                                                                                                     </span>
<span class="2890386202777848228" onmouseenter="enter('2890386202777848228');" onmouseout="out('2890386202777848228');" style=""> 927      public void onDeleteCalendarEvent(byte type, long id) {                                                       </span>
<span  style=""> 928                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 929      }                                                                                                             </span>
<span  style=""> 930                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 931      @Override                                                                                                     </span>
<span class="349159621018699769" onmouseenter="enter('349159621018699769');" onmouseout="out('349159621018699769');" style=""> 932      public void onSendConfiguration(String config) {                                                              </span>
<span  style=""> 933                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 934      }                                                                                                             </span>
<span  style=""> 935                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 936      @Override                                                                                                     </span>
<span class="8707097463436604513" onmouseenter="enter('8707097463436604513');" onmouseout="out('8707097463436604513');" style=""> 937      public void onReadConfiguration(String config) {                                                              </span>
<span  style=""> 938                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939      }                                                                                                             </span>
<span  style=""> 940                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 941      @Override                                                                                                     </span>
<span class="-1180224994468071186" onmouseenter="enter('-1180224994468071186');" onmouseout="out('-1180224994468071186');" style=""> 942      public void onTestNewFunction() {                                                                             </span>
<span  style=""> 943                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 944      }                                                                                                             </span>
<span  style=""> 945                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 946      @Override                                                                                                     </span>
<span class="-6167041048283935417" onmouseenter="enter('-6167041048283935417');" onmouseout="out('-6167041048283935417');" style=""> 947      public void onSendWeather(WeatherSpec weatherSpec) {                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 948          try {                                                                                                     </span>
<span class="6913327923992486965" onmouseenter="enter('6913327923992486965');" onmouseout="out('6913327923992486965');" style=""> 949              JSONObject o = new JSONObject();                                                                      </span>
<span class="501109951395943657" onmouseenter="enter('501109951395943657');" onmouseout="out('501109951395943657');" style=""> 950              o.put(&quot;t&quot;, &quot;weather&quot;);                                                                                </span>
<span class="4560755441777004113" onmouseenter="enter('4560755441777004113');" onmouseout="out('4560755441777004113');" style=""> 951              o.put(&quot;temp&quot;, weatherSpec.currentTemp);                                                               </span>
<span class="7333169967933356383" onmouseenter="enter('7333169967933356383');" onmouseout="out('7333169967933356383');" style=""> 952              o.put(&quot;hum&quot;, weatherSpec.currentHumidity);                                                            </span>
<span class="1899511800679765497" onmouseenter="enter('1899511800679765497');" onmouseout="out('1899511800679765497');" style=""> 953              o.put(&quot;code&quot;, weatherSpec.currentConditionCode);                                                      </span>
<span class="-4150178137906864023" onmouseenter="enter('-4150178137906864023');" onmouseout="out('-4150178137906864023');" style=""> 954              o.put(&quot;txt&quot;, weatherSpec.currentCondition);                                                           </span>
<span class="2529521996043109426" onmouseenter="enter('2529521996043109426');" onmouseout="out('2529521996043109426');" style=""> 955              o.put(&quot;wind&quot;, weatherSpec.windSpeed);                                                                 </span>
<span class="-3531204280741737459" onmouseenter="enter('-3531204280741737459');" onmouseout="out('-3531204280741737459');" style=""> 956              o.put(&quot;wdir&quot;, weatherSpec.windDirection);                                                             </span>
<span class="-5203705012940108393" onmouseenter="enter('-5203705012940108393');" onmouseout="out('-5203705012940108393');" style=""> 957              o.put(&quot;loc&quot;, weatherSpec.location);                                                                   </span>
<span class="-7123085564208723174" onmouseenter="enter('-7123085564208723174');" onmouseout="out('-7123085564208723174');" style=""> 958              uartTxJSON(&quot;onSendWeather&quot;, o);                                                                       </span>
<span class="2021063483207698984" onmouseenter="enter('2021063483207698984');" onmouseout="out('2021063483207698984');" style=""> 959          } catch (JSONException e) {                                                                               </span>
<span class="-3155506605018775394" onmouseenter="enter('-3155506605018775394');" onmouseout="out('-3155506605018775394');" style=""> 960              LOG.info(&quot;JSONException: &quot; + e.getLocalizedMessage());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962      }                                                                                                             </span>
<span  style=""> 963                                                                                                                    </span>
<span class="-2877595281257014330" onmouseenter="enter('-2877595281257014330');" onmouseout="out('-2877595281257014330');" style=""> 964      public Bitmap textToBitmap(String text) {                                                                     </span>
<span class="8197355036703912915" onmouseenter="enter('8197355036703912915');" onmouseout="out('8197355036703912915');" style=""> 965          Paint paint = new Paint(0); // Paint.ANTI_ALIAS_FLAG not wanted as 1bpp                                   </span>
<span class="7051721925152008019" onmouseenter="enter('7051721925152008019');" onmouseout="out('7051721925152008019');" style=""> 966          paint.setTextSize(18);                                                                                    </span>
<span class="3201120031631468052" onmouseenter="enter('3201120031631468052');" onmouseout="out('3201120031631468052');" style=""> 967          paint.setColor(0xFFFFFFFF);                                                                               </span>
<span class="-8656814648822962149" onmouseenter="enter('-8656814648822962149');" onmouseout="out('-8656814648822962149');" style=""> 968          paint.setTextAlign(Paint.Align.LEFT);                                                                     </span>
<span class="-7872377864782888483" onmouseenter="enter('-7872377864782888483');" onmouseout="out('-7872377864782888483');" style=""> 969          float baseline = -paint.ascent(); // ascent() is negative                                                 </span>
<span class="-8465374828216379200" onmouseenter="enter('-8465374828216379200');" onmouseout="out('-8465374828216379200');" style=""> 970          int width = (int) (paint.measureText(text) + 0.5f); // round                                              </span>
<span class="-3854390456573697081" onmouseenter="enter('-3854390456573697081');" onmouseout="out('-3854390456573697081');" style=""> 971          int height = (int) (baseline + paint.descent() + 0.5f);                                                   </span>
<span class="2906210495000084590" onmouseenter="enter('2906210495000084590');" onmouseout="out('2906210495000084590');" style=""> 972          Bitmap image = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);                               </span>
<span class="-8679273566707466475" onmouseenter="enter('-8679273566707466475');" onmouseout="out('-8679273566707466475');" style=""> 973          Canvas canvas = new Canvas(image);                                                                        </span>
<span class="-1111517440201709382" onmouseenter="enter('-1111517440201709382');" onmouseout="out('-1111517440201709382');" style=""> 974          canvas.drawText(text, 0, baseline, paint);                                                                </span>
<span class="-2663644744327296233" onmouseenter="enter('-2663644744327296233');" onmouseout="out('-2663644744327296233');" style=""> 975          return image;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 976      }                                                                                                             </span>
<span  style=""> 977                                                                                                                    </span>
<span class="7074963208724431146" onmouseenter="enter('7074963208724431146');" onmouseout="out('7074963208724431146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 978 +    public enum BangleJSBitmapStyle {                                                                             </span>
<span class="6147896096185822433" onmouseenter="enter('6147896096185822433');" onmouseout="out('6147896096185822433');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 979 +        MONOCHROME,                                                                                               </span>
<span class="4062182762926863582" onmouseenter="enter('4062182762926863582');" onmouseout="out('4062182762926863582');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 980 +        RGB_3BPP                                                                                                  </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 981 +    };                                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 982 +                                                                                                                  </span>
<span class="6301558466408951369" onmouseenter="enter('6301558466408951369');" onmouseout="out('6301558466408951369');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 983 +    /** Used for writing single bits to an array */                                                               </span>
<span class="819222803118860573" onmouseenter="enter('819222803118860573');" onmouseout="out('819222803118860573');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 984 +    public static class BitWriter {                                                                               </span>
<span class="114498312668931576" onmouseenter="enter('114498312668931576');" onmouseout="out('114498312668931576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 985 +        int n;                                                                                                    </span>
<span class="2627896913916265726" onmouseenter="enter('2627896913916265726');" onmouseout="out('2627896913916265726');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 986 +        byte[] bits;                                                                                              </span>
<span class="1763732906692125975" onmouseenter="enter('1763732906692125975');" onmouseout="out('1763732906692125975');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 987 +        int currentByte, bitIdx;                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 988 +                                                                                                                  </span>
<span class="4387590414863300883" onmouseenter="enter('4387590414863300883');" onmouseout="out('4387590414863300883');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 989 +        public BitWriter(byte[] array, int offset) {                                                              </span>
<span class="-2669551821059816380" onmouseenter="enter('-2669551821059816380');" onmouseout="out('-2669551821059816380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 990 +            bits = array;                                                                                         </span>
<span class="8043804227758168612" onmouseenter="enter('8043804227758168612');" onmouseout="out('8043804227758168612');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 991 +            n = offset;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 992 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 993 +                                                                                                                  </span>
<span class="3787308675999271388" onmouseenter="enter('3787308675999271388');" onmouseout="out('3787308675999271388');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 994 +        public void push(boolean v) {                                                                             </span>
<span class="-3502051617447471385" onmouseenter="enter('-3502051617447471385');" onmouseout="out('-3502051617447471385');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 995 +            currentByte = (currentByte &lt;&lt; 1) | (v?1:0);                                                           </span>
<span class="-9185751609333789697" onmouseenter="enter('-9185751609333789697');" onmouseout="out('-9185751609333789697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 996 +            bitIdx++;                                                                                             </span>
<span class="-4190492491002713547" onmouseenter="enter('-4190492491002713547');" onmouseout="out('-4190492491002713547');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 997 +            if (bitIdx == 8) {                                                                                    </span>
<span class="6079776424871100267" onmouseenter="enter('6079776424871100267');" onmouseout="out('6079776424871100267');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 998 +                bits[n++] = (byte)currentByte;                                                                    </span>
<span class="7441701714119310800" onmouseenter="enter('7441701714119310800');" onmouseout="out('7441701714119310800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 999 +                bitIdx = 0;                                                                                       </span>
<span class="-6334189767708640910" onmouseenter="enter('-6334189767708640910');" onmouseout="out('-6334189767708640910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1000 +                currentByte = 0;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1001 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1002 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1003 +                                                                                                                  </span>
<span class="-6819029797264174065" onmouseenter="enter('-6819029797264174065');" onmouseout="out('-6819029797264174065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1004 +        public void finish() {                                                                                    </span>
<span class="-7024656867771236134" onmouseenter="enter('-7024656867771236134');" onmouseout="out('-7024656867771236134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1005 +            if (bitIdx &gt; 0) bits[n++] = (byte)currentByte;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1006 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1007 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1008 +                                                                                                                  </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1009      /** Convert an Android bitmap to a base64 string for use in Espruino.                                         </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1010       * Currently only 1bpp, no scaling */                                                                         </span>
<span class="-3636207061562779479" onmouseenter="enter('-3636207061562779479');" onmouseout="out('-3636207061562779479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1011 -    public static byte[] bitmapToEspruinoArray(Bitmap bitmap) {                                                   </span>
<span class="7395401196912084921" onmouseenter="enter('7395401196912084921');" onmouseout="out('7395401196912084921');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1012 +    public static byte[] bitmapToEspruinoArray(Bitmap bitmap, BangleJSBitmapStyle style) {                        </span>
<span class="-8264578209241474849" onmouseenter="enter('-8264578209241474849');" onmouseout="out('-8264578209241474849');" style="">1013          int width = bitmap.getWidth();                                                                            </span>
<span class="579214017182008882" onmouseenter="enter('579214017182008882');" onmouseout="out('579214017182008882');" style="">1014          int height = bitmap.getHeight();                                                                          </span>
<span class="-5468132095560190208" onmouseenter="enter('-5468132095560190208');" onmouseout="out('-5468132095560190208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1015 -        byte bmp[] = new byte[((height * width + 7) &gt;&gt; 3) + 3];                                                   </span>
<span class="-8063747109253331105" onmouseenter="enter('-8063747109253331105');" onmouseout="out('-8063747109253331105');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1016 -        int n = 0, c = 0, cn = 0;                                                                                 </span>
<span class="-650429588605459357" onmouseenter="enter('-650429588605459357');" onmouseout="out('-650429588605459357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1017 -        bmp[n++] = (byte)width;                                                                                   </span>
<span class="-8266527298740840983" onmouseenter="enter('-8266527298740840983');" onmouseout="out('-8266527298740840983');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1018 -        bmp[n++] = (byte)height;                                                                                  </span>
<span class="5057379001520513130" onmouseenter="enter('5057379001520513130');" onmouseout="out('5057379001520513130');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1019 -        bmp[n++] = 1;                                                                                             </span>
<span class="62095710955205844" onmouseenter="enter('62095710955205844');" onmouseout="out('62095710955205844');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1020 +        int bpp = (style==BangleJSBitmapStyle.RGB_3BPP) ? 3 : 1;                                                  </span>
<span class="2569753333792437088" onmouseenter="enter('2569753333792437088');" onmouseout="out('2569753333792437088');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1021 +        byte pixels[] = new byte[width * height];                                                                 </span>
<span class="-8781894220114795181" onmouseenter="enter('-8781894220114795181');" onmouseout="out('-8781894220114795181');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1022 +        final byte PIXELCOL_TRANSPARENT = -1;                                                                     </span>
<span class="6803383238845196993" onmouseenter="enter('6803383238845196993');" onmouseout="out('6803383238845196993');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1023 +        final int ditherMatrix[] = {1*16,5*16,7*16,3*16}; // for bayer dithering                                  </span>
<span class="7959981185777845703" onmouseenter="enter('7959981185777845703');" onmouseout="out('7959981185777845703');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1024 +        // if doing 3bpp, check image to see if it&#x27;s transparent                                                  </span>
<span class="2206517053249792991" onmouseenter="enter('2206517053249792991');" onmouseout="out('2206517053249792991');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1025 +        boolean allowTransparency = (style != BangleJSBitmapStyle.MONOCHROME);                                    </span>
<span class="-37573379981503148" onmouseenter="enter('-37573379981503148');" onmouseout="out('-37573379981503148');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1026 +        boolean isTransparent = false;                                                                            </span>
<span class="7994078972417264550" onmouseenter="enter('7994078972417264550');" onmouseout="out('7994078972417264550');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1027 +        byte transparentColorIndex = 0;                                                                           </span>
<span class="4545384496906809483" onmouseenter="enter('4545384496906809483');" onmouseout="out('4545384496906809483');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1028 +        /* Work out what colour index each pixel should be and write to pixels.                                   </span>
<span class="-816286840416722331" onmouseenter="enter('-816286840416722331');" onmouseout="out('-816286840416722331');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1029 +         Also figure out if we&#x27;re transparent at all, and how often each color is used */                         </span>
<span class="-3015935700404012624" onmouseenter="enter('-3015935700404012624');" onmouseout="out('-3015935700404012624');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1030 +        int colUsage[] = new int[8];                                                                              </span>
<span class="-1168375646381031328" onmouseenter="enter('-1168375646381031328');" onmouseout="out('-1168375646381031328');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1031 +        int n = 0;                                                                                                </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="">1032          for (int y = 0; y &lt; height; y++) {                                                                        </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="">1033              for (int x = 0; x &lt; width; x++) {                                                                     </span>
<span class="-771115154633897268" onmouseenter="enter('-771115154633897268');" onmouseout="out('-771115154633897268');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1034 -                boolean pixel = (bitmap.getPixel(x, y) &amp; 255) &gt; 128;                                              </span>
<span class="6674653668556692298" onmouseenter="enter('6674653668556692298');" onmouseout="out('6674653668556692298');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1035 -                c = (c &lt;&lt; 1) | (pixel?1:0);                                                                       </span>
<span class="9172772233428286483" onmouseenter="enter('9172772233428286483');" onmouseout="out('9172772233428286483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1036 -                cn++;                                                                                             </span>
<span class="-448289942795796071" onmouseenter="enter('-448289942795796071');" onmouseout="out('-448289942795796071');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1037 -                if (cn == 8) {                                                                                    </span>
<span class="3052733147797367046" onmouseenter="enter('3052733147797367046');" onmouseout="out('3052733147797367046');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1038 -                    bmp[n++] = (byte)c;                                                                           </span>
<span class="6564409203482604272" onmouseenter="enter('6564409203482604272');" onmouseout="out('6564409203482604272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1039 -                    cn = 0;                                                                                       </span>
<span class="2474985583203145484" onmouseenter="enter('2474985583203145484');" onmouseout="out('2474985583203145484');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1040 -                    c = 0;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1041 -                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1042 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1043 -        }                                                                                                         </span>
<span class="-8164484178145478016" onmouseenter="enter('-8164484178145478016');" onmouseout="out('-8164484178145478016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1044 -        if (cn &gt; 0) bmp[n++] = (byte)c;                                                                           </span>
<span class="7173512941781537638" onmouseenter="enter('7173512941781537638');" onmouseout="out('7173512941781537638');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1045 -        //LOG.info(&quot;BMP: &quot; + width + &quot;x&quot;+height+&quot; n &quot;+n);                                                         </span>
<span class="5324835058640739880" onmouseenter="enter('5324835058640739880');" onmouseout="out('5324835058640739880');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1046 -        // Convert to base64                                                                                      </span>
<span class="-2101137108834168285" onmouseenter="enter('-2101137108834168285');" onmouseout="out('-2101137108834168285');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1047 +                int pixel = bitmap.getPixel(x, y);                                                                </span>
<span class="-7873265173430592100" onmouseenter="enter('-7873265173430592100');" onmouseout="out('-7873265173430592100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1048 +                int r = pixel &amp; 255;                                                                              </span>
<span class="5214305336064064060" onmouseenter="enter('5214305336064064060');" onmouseout="out('5214305336064064060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1049 +                int g = (pixel &gt;&gt; 8) &amp; 255;                                                                       </span>
<span class="-8611762025314058231" onmouseenter="enter('-8611762025314058231');" onmouseout="out('-8611762025314058231');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1050 +                int b = (pixel &gt;&gt; 16) &amp; 255;                                                                      </span>
<span class="4540615999107180416" onmouseenter="enter('4540615999107180416');" onmouseout="out('4540615999107180416');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1051 +                int a = (pixel &gt;&gt; 24) &amp; 255;                                                                      </span>
<span class="-7690440557473777446" onmouseenter="enter('-7690440557473777446');" onmouseout="out('-7690440557473777446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1052 +                boolean pixelTransparent = allowTransparency &amp;&amp; (a &lt; 128);                                        </span>
<span class="8857737978256656560" onmouseenter="enter('8857737978256656560');" onmouseout="out('8857737978256656560');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1053 +                if (pixelTransparent) {                                                                           </span>
<span class="4144053758920166277" onmouseenter="enter('4144053758920166277');" onmouseout="out('4144053758920166277');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1054 +                    isTransparent = true;                                                                         </span>
<span class="-1483564027931343691" onmouseenter="enter('-1483564027931343691');" onmouseout="out('-1483564027931343691');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1055 +                    r = g = b = 0;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1056 +                }                                                                                                 </span>
<span class="7892385962647882401" onmouseenter="enter('7892385962647882401');" onmouseout="out('7892385962647882401');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1057 +                // do dithering here                                                                              </span>
<span class="-1753549363475258451" onmouseenter="enter('-1753549363475258451');" onmouseout="out('-1753549363475258451');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1058 +                int ditherAmt = ditherMatrix[(x&amp;1) + (y&amp;1)*2];                                                    </span>
<span class="-5333286516522955764" onmouseenter="enter('-5333286516522955764');" onmouseout="out('-5333286516522955764');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1059 +                r += ditherAmt;                                                                                   </span>
<span class="-3777395832470098990" onmouseenter="enter('-3777395832470098990');" onmouseout="out('-3777395832470098990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1060 +                g += ditherAmt;                                                                                   </span>
<span class="-5891859440152819561" onmouseenter="enter('-5891859440152819561');" onmouseout="out('-5891859440152819561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1061 +                b += ditherAmt;                                                                                   </span>
<span class="1554400584909279790" onmouseenter="enter('1554400584909279790');" onmouseout="out('1554400584909279790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1062 +                int col = 0;                                                                                      </span>
<span class="418637413535106488" onmouseenter="enter('418637413535106488');" onmouseout="out('418637413535106488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1063 +                if (style == BangleJSBitmapStyle.MONOCHROME)                                                      </span>
<span class="7187319285928422906" onmouseenter="enter('7187319285928422906');" onmouseout="out('7187319285928422906');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1064 +                    col = ((r+g+b) &gt;= 768)?1:0;                                                                   </span>
<span class="-9158255213257007445" onmouseenter="enter('-9158255213257007445');" onmouseout="out('-9158255213257007445');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1065 +                else if (style == BangleJSBitmapStyle.RGB_3BPP)                                                   </span>
<span class="6807772790369921462" onmouseenter="enter('6807772790369921462');" onmouseout="out('6807772790369921462');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1066 +                    col = ((r&gt;=256)?1:0) | ((g&gt;=256)?2:0) | ((b&gt;=256)?4:0);                                       </span>
<span class="-8103715039558456046" onmouseenter="enter('-8103715039558456046');" onmouseout="out('-8103715039558456046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1067 +                if (!pixelTransparent) colUsage[col]++; // if not transparent, record usage                       </span>
<span class="4219755117683718437" onmouseenter="enter('4219755117683718437');" onmouseout="out('4219755117683718437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1068 +                // save colour, mark transparent separately                                                       </span>
<span class="9129530588794156450" onmouseenter="enter('9129530588794156450');" onmouseout="out('9129530588794156450');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1069 +                pixels[n++] = (byte)(pixelTransparent ? PIXELCOL_TRANSPARENT : col);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1070 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1071 +        }                                                                                                         </span>
<span class="-7238986996251945663" onmouseenter="enter('-7238986996251945663');" onmouseout="out('-7238986996251945663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1072 +        // if we&#x27;re transparent, find the least-used color, and use that for transparency                         </span>
<span class="-3011917059987129784" onmouseenter="enter('-3011917059987129784');" onmouseout="out('-3011917059987129784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1073 +        if (isTransparent) {                                                                                      </span>
<span class="-8837844203179481085" onmouseenter="enter('-8837844203179481085');" onmouseout="out('-8837844203179481085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1074 +            // find least used                                                                                    </span>
<span class="-2156609844502175267" onmouseenter="enter('-2156609844502175267');" onmouseout="out('-2156609844502175267');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1075 +            int minColUsage = -1;                                                                                 </span>
<span class="-722001860546824180" onmouseenter="enter('-722001860546824180');" onmouseout="out('-722001860546824180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1076 +            for (int c=0;c&lt;8;c++) {                                                                               </span>
<span class="4418845972840093199" onmouseenter="enter('4418845972840093199');" onmouseout="out('4418845972840093199');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1077 +                if (minColUsage&lt;0 || colUsage[c]&lt;minColUsage) {                                                   </span>
<span class="5318194882336838338" onmouseenter="enter('5318194882336838338');" onmouseout="out('5318194882336838338');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1078 +                    minColUsage = colUsage[c];                                                                    </span>
<span class="1332179475621902578" onmouseenter="enter('1332179475621902578');" onmouseout="out('1332179475621902578');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1079 +                    transparentColorIndex = (byte)c;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1080 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1081 +            }                                                                                                     </span>
<span class="-6360425578627405201" onmouseenter="enter('-6360425578627405201');" onmouseout="out('-6360425578627405201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1082 +            // rewrite any transparent pixels as the correct color for transparency                               </span>
<span class="-6081737035071239023" onmouseenter="enter('-6081737035071239023');" onmouseout="out('-6081737035071239023');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1083 +            for (n=0;n&lt;pixels.length;n++)                                                                         </span>
<span class="-5898303404019142000" onmouseenter="enter('-5898303404019142000');" onmouseout="out('-5898303404019142000');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1084 +                if (pixels[n]==PIXELCOL_TRANSPARENT)                                                              </span>
<span class="2866860587696074876" onmouseenter="enter('2866860587696074876');" onmouseout="out('2866860587696074876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1085 +                    pixels[n] = transparentColorIndex;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1086 +        }                                                                                                         </span>
<span class="2745980283769036105" onmouseenter="enter('2745980283769036105');" onmouseout="out('2745980283769036105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1087 +        // Write the header                                                                                       </span>
<span class="-1351042579972959800" onmouseenter="enter('-1351042579972959800');" onmouseout="out('-1351042579972959800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1088 +        int headerLen = isTransparent ? 4 : 3;                                                                    </span>
<span class="-1842770092995408603" onmouseenter="enter('-1842770092995408603');" onmouseout="out('-1842770092995408603');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1089 +        byte bmp[] = new byte[(((height * width * bpp) + 7) &gt;&gt; 3) + headerLen];                                   </span>
<span class="-2931355111361492552" onmouseenter="enter('-2931355111361492552');" onmouseout="out('-2931355111361492552');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1090 +        bmp[0] = (byte)width;                                                                                     </span>
<span class="7001926567865572655" onmouseenter="enter('7001926567865572655');" onmouseout="out('7001926567865572655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1091 +        bmp[1] = (byte)height;                                                                                    </span>
<span class="-237013155551245034" onmouseenter="enter('-237013155551245034');" onmouseout="out('-237013155551245034');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1092 +        bmp[2] = (byte)(bpp + (isTransparent?128:0));                                                             </span>
<span class="6762716390198046926" onmouseenter="enter('6762716390198046926');" onmouseout="out('6762716390198046926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1093 +        if (isTransparent) bmp[3] = transparentColorIndex;                                                        </span>
<span class="8478354166162352997" onmouseenter="enter('8478354166162352997');" onmouseout="out('8478354166162352997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1094 +        // Now write the image out bit by bit                                                                     </span>
<span class="344926378213754405" onmouseenter="enter('344926378213754405');" onmouseout="out('344926378213754405');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1095 +        BitWriter bits = new BitWriter(bmp, headerLen);                                                           </span>
<span class="-3260558023763679626" onmouseenter="enter('-3260558023763679626');" onmouseout="out('-3260558023763679626');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1096 +        n = 0;                                                                                                    </span>
<span class="1196932007836040243" onmouseenter="enter('1196932007836040243');" onmouseout="out('1196932007836040243');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1097 +        for (int y = 0; y &lt; height; y++) {                                                                        </span>
<span class="3922203925107373531" onmouseenter="enter('3922203925107373531');" onmouseout="out('3922203925107373531');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1098 +            for (int x = 0; x &lt; width; x++) {                                                                     </span>
<span class="593941254526452666" onmouseenter="enter('593941254526452666');" onmouseout="out('593941254526452666');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1099 +                int pixel = pixels[n++];                                                                          </span>
<span class="-1551860236924517479" onmouseenter="enter('-1551860236924517479');" onmouseout="out('-1551860236924517479');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1100 +                for (int b=bpp-1;b&gt;=0;b--)                                                                        </span>
<span class="-5304162960169081882" onmouseenter="enter('-5304162960169081882');" onmouseout="out('-5304162960169081882');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1101 +                    bits.push(((pixel&gt;&gt;b)&amp;1) != 0);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1102 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1103 +        }                                                                                                         </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1104          return bmp;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1105      }                                                                                                             </span>
<span  style="">1106                                                                                                                    </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1107      /** Convert an Android bitmap to a base64 string for use in Espruino.                                         </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1108       * Currently only 1bpp, no scaling */                                                                         </span>
<span class="-4487821626516184731" onmouseenter="enter('-4487821626516184731');" onmouseout="out('-4487821626516184731');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1109 -    public static String bitmapToEspruinoString(Bitmap bitmap) {                                                  </span>
<span class="8233707567119166127" onmouseenter="enter('8233707567119166127');" onmouseout="out('8233707567119166127');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1110 -        return new String(bitmapToEspruinoArray(bitmap), StandardCharsets.ISO_8859_1);                            </span>
<span class="8132909775831713515" onmouseenter="enter('8132909775831713515');" onmouseout="out('8132909775831713515');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1111 +    public static String bitmapToEspruinoString(Bitmap bitmap, BangleJSBitmapStyle style) {                       </span>
<span class="-259762080887441901" onmouseenter="enter('-259762080887441901');" onmouseout="out('-259762080887441901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1112 +        return new String(bitmapToEspruinoArray(bitmap, style), StandardCharsets.ISO_8859_1);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1113      }                                                                                                             </span>
<span  style="">1114                                                                                                                    </span>
<span class="-5107651094583248130" onmouseenter="enter('-5107651094583248130');" onmouseout="out('-5107651094583248130');" style="">1115      /** Convert an Android bitmap to a base64 string for use in Espruino.                                         </span>
<span class="6184283030439629978" onmouseenter="enter('6184283030439629978');" onmouseout="out('6184283030439629978');" style="">1116       * Currently only 1bpp, no scaling */                                                                         </span>
<span class="2266332245921000841" onmouseenter="enter('2266332245921000841');" onmouseout="out('2266332245921000841');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1117 -    public static String bitmapToEspruinoBase64(Bitmap bitmap) {                                                  </span>
<span class="-4423749523808680087" onmouseenter="enter('-4423749523808680087');" onmouseout="out('-4423749523808680087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1118 -        return Base64.encodeToString(bitmapToEspruinoArray(bitmap), Base64.DEFAULT).replaceAll(&quot;\n&quot;,&quot;&quot;);          </span>
<span class="3005879465184206786" onmouseenter="enter('3005879465184206786');" onmouseout="out('3005879465184206786');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1119 +    public static String bitmapToEspruinoBase64(Bitmap bitmap, BangleJSBitmapStyle style) {                       </span>
<span class="-5699216721301532414" onmouseenter="enter('-5699216721301532414');" onmouseout="out('-5699216721301532414');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1120 +        return Base64.encodeToString(bitmapToEspruinoArray(bitmap, style), Base64.DEFAULT).replaceAll(&quot;\n&quot;,&quot;&quot;);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1121      }                                                                                                             </span>
<span  style="">1122                                                                                                                    </span>
<span class="-3553936365177536696" onmouseenter="enter('-3553936365177536696');" onmouseout="out('-3553936365177536696');" style="">1123      /** Convert a drawable to a bitmap, for use with bitmapToEspruino */                                          </span>
<span class="3383127324214077694" onmouseenter="enter('3383127324214077694');" onmouseout="out('3383127324214077694');" style="">1124      public static Bitmap drawableToBitmap(Drawable drawable) {                                                    </span>
<span class="5888468731770076773" onmouseenter="enter('5888468731770076773');" onmouseout="out('5888468731770076773');" style="">1125          final int maxWidth = 32;                                                                                  </span>
<span class="1045468429082287724" onmouseenter="enter('1045468429082287724');" onmouseout="out('1045468429082287724');" style="">1126          final int maxHeight = 32;                                                                                 </span>
<span class="2296952793490653309" onmouseenter="enter('2296952793490653309');" onmouseout="out('2296952793490653309');" style="">1127          /* Return bitmap directly but only if it&#x27;s small enough. It could be                                      </span>
<span class="5951543220377437420" onmouseenter="enter('5951543220377437420');" onmouseout="out('5951543220377437420');" style="">1128          we have a bitmap but it&#x27;s just too big to send direct to the bangle */                                    </span>
<span class="256873417632096091" onmouseenter="enter('256873417632096091');" onmouseout="out('256873417632096091');" style="">1129          if (drawable instanceof BitmapDrawable) {                                                                 </span>
<span class="-5943336945219947575" onmouseenter="enter('-5943336945219947575');" onmouseout="out('-5943336945219947575');" style="">1130              BitmapDrawable bitmapDrawable = (BitmapDrawable) drawable;                                            </span>
<span class="3248690101517469022" onmouseenter="enter('3248690101517469022');" onmouseout="out('3248690101517469022');" style="">1131              Bitmap bmp = bitmapDrawable.getBitmap();                                                              </span>
<span class="-7540961171633243123" onmouseenter="enter('-7540961171633243123');" onmouseout="out('-7540961171633243123');" style="">1132              if (bmp != null &amp;&amp; bmp.getWidth()&lt;=maxWidth &amp;&amp; bmp.getHeight()&lt;=maxHeight)                            </span>
<span class="-3047168372670726829" onmouseenter="enter('-3047168372670726829');" onmouseout="out('-3047168372670726829');" style="">1133                  return bmp;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1134          }                                                                                                         </span>
<span class="-1267243917470848355" onmouseenter="enter('-1267243917470848355');" onmouseout="out('-1267243917470848355');" style="">1135          /* Otherwise render this to a bitmap ourselves.. work out size */                                         </span>
<span class="4014031002419706861" onmouseenter="enter('4014031002419706861');" onmouseout="out('4014031002419706861');" style="">1136          int w = maxWidth;                                                                                         </span>
<span class="7839465956667040099" onmouseenter="enter('7839465956667040099');" onmouseout="out('7839465956667040099');" style="">1137          int h = maxHeight;                                                                                        </span>
<span class="-8364515267334494119" onmouseenter="enter('-8364515267334494119');" onmouseout="out('-8364515267334494119');" style="">1138          if (drawable.getIntrinsicWidth() &gt; 0 &amp;&amp; drawable.getIntrinsicHeight() &gt; 0) {                              </span>
<span class="7888521624075720743" onmouseenter="enter('7888521624075720743');" onmouseout="out('7888521624075720743');" style="">1139              w = drawable.getIntrinsicWidth();                                                                     </span>
<span class="-8527253388982325533" onmouseenter="enter('-8527253388982325533');" onmouseout="out('-8527253388982325533');" style="">1140              h = drawable.getIntrinsicHeight();                                                                    </span>
<span class="1937935127293972578" onmouseenter="enter('1937935127293972578');" onmouseout="out('1937935127293972578');" style="">1141              // don&#x27;t allocate anything too big, but keep the ratio                                                </span>
<span class="-3040808582930904343" onmouseenter="enter('-3040808582930904343');" onmouseout="out('-3040808582930904343');" style="">1142              if (w&gt;maxWidth) {                                                                                     </span>
<span class="3961818778152175494" onmouseenter="enter('3961818778152175494');" onmouseout="out('3961818778152175494');" style="">1143                  h = h * maxWidth / w;                                                                             </span>
<span class="-810617720622075293" onmouseenter="enter('-810617720622075293');" onmouseout="out('-810617720622075293');" style="">1144                  w = maxWidth;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1145              }                                                                                                     </span>
<span class="-8361662207911676693" onmouseenter="enter('-8361662207911676693');" onmouseout="out('-8361662207911676693');" style="">1146              if (h&gt;maxHeight) {                                                                                    </span>
<span class="-4098427333168952513" onmouseenter="enter('-4098427333168952513');" onmouseout="out('-4098427333168952513');" style="">1147                  w = w * maxHeight / h;                                                                            </span>
<span class="3192577241527884586" onmouseenter="enter('3192577241527884586');" onmouseout="out('3192577241527884586');" style="">1148                  h = maxHeight;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1149              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1150          }                                                                                                         </span>
<span class="5796017605604363662" onmouseenter="enter('5796017605604363662');" onmouseout="out('5796017605604363662');" style="">1151          /* render */                                                                                              </span>
<span class="2390903888286128230" onmouseenter="enter('2390903888286128230');" onmouseout="out('2390903888286128230');" style=""><abbr title="1152          Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will be created of 1x1 pixel">1152          Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888); // Single color bitmap will be createdðŸ”µ</abbr></span>
<span class="-8462009662057840967" onmouseenter="enter('-8462009662057840967');" onmouseout="out('-8462009662057840967');" style="">1153          Canvas canvas = new Canvas(bitmap);                                                                       </span>
<span class="8202941983594652957" onmouseenter="enter('8202941983594652957');" onmouseout="out('8202941983594652957');" style="">1154          drawable.setBounds(0, 0, canvas.getWidth(), canvas.getHeight());                                          </span>
<span class="-8639362966527052788" onmouseenter="enter('-8639362966527052788');" onmouseout="out('-8639362966527052788');" style="">1155          drawable.draw(canvas);                                                                                    </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style="">1156          return bitmap;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1157      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1158  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            