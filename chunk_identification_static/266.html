<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>266</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    266
                    <a href="265.html">prev</a>
                    <a href="267.html">next</a>
                    <a href="266_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_fe7880a68ed3272ba6192b7dd47bceadb83b633d_hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;fe7880a68ed3272ba6192b7dd47bceadb83b633d:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;fe7880a68ed3272ba6192b7dd47bceadb83b633d^1:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;fe7880a68ed3272ba6192b7dd47bceadb83b633d^2:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b97ef2c376f3f65f38136ac572cc33ea3e4cddbf:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [bj], [b], [j]], subset: [[b], [bj], [b], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  21                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  22 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                      </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  24 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  26 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  27 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  28 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  29 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  30 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  31 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  32 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  33 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  34 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  35 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  36 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  37 import org.apache.hadoop.hbase.AuthUtil;                                                                 </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  38 import org.apache.hadoop.hbase.ChoreService;                                                             </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  39 import org.apache.hadoop.hbase.HBaseConfiguration;                                                       </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  40 import org.apache.hadoop.hbase.ScheduledChore;                                                           </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  41 import org.apache.hadoop.hbase.TableName;                                                                </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  42 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  43 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  44 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  45 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  46 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  47 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  48 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  49                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  50 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  51 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  52 import java.security.PrivilegedAction;                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  53 import java.util.ArrayList;                                                                              </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  54 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  55 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  56 import java.util.Map;                                                                                    </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  57 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  58 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  59 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  60 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  61                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  62 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  63  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  64  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  65  */                                                                                                      </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  66 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                </span>
<span  style="">  67                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  68     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  69     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  70     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  71     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  72     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  73     private String[] columnNames;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  74     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  75     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  76     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  77     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  78     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  79     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  80     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  81     private String clientKeytabFile;                                                                     </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  82     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  83     private String[] qualifiers;                                                                         </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  84     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  85     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  86     private transient Table table;                                                                       </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  87     private transient ChoreService choreService;                                                         </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  88     private transient List&lt;Row&gt; records;                                                                 </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  89     private transient volatile boolean closed = false;                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  90     /**                                                                                                  </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  91      * 批量写入的参数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  92      */                                                                                                  </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  93     private Integer batchSize;                                                                           </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  94     private Long batchWaitInterval;                                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  95     /**                                                                                                  </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  96      * 定时任务                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  97      */                                                                                                  </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  98     private transient ScheduledExecutorService scheduler;                                                </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  99     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style=""> 100                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 101     /**                                                                                                  </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style=""> 102      * 脏数据管理                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 103      */                                                                                                  </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style=""> 104     private DirtyDataManager dirtyDataManager;                                                           </span>
<span  style=""> 105                                                                                                          </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 106     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 109     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 110         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111     }                                                                                                    </span>
<span  style=""> 112                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 113     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 114     public void configure(Configuration parameters) {                                                    </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 115         // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                    </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 116         // DO NOTHING                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117     }                                                                                                    </span>
<span  style=""> 118                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 119     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 120     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 121         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 122         records = new ArrayList&lt;&gt;();                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 123         conf = HBaseConfiguration.create();                                                              </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 124         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 125         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 126         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 127         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128     }                                                                                                    </span>
<span  style=""> 129                                                                                                          </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 130     private void openConn() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 131         try {                                                                                            </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 132             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 133                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 134                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 135             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 136                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 137                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 138                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 139                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 141         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 142             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143         }                                                                                                </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 144         initScheduledTask(batchWaitInterval);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145     }                                                                                                    </span>
<span  style=""> 146                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 147     /**                                                                                                  </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 148      * 初始化定时写入任务                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 149      *                                                                                                   </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 150      * @param batchWaitInterval 定时任务时间                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 151      */                                                                                                  </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 152     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 153         try {                                                                                            </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 154             if (batchWaitInterval &gt; 0) {                                                                 </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 155                 this.scheduler = new ScheduledThreadPoolExecutor(                                        </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 156                         1,                                                                               </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 157                         new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 158                 );                                                                                       </span>
<span  style=""> 159                                                                                                          </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 160                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                            </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 161                         () -&gt; {                                                                          </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 162                             synchronized (HbaseOutputFormat.this) {                                      </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 163                                 if (!records.isEmpty()) {                                                </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 164                                     dealBatchOperation(records);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166                             }                                                                            </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 167                         }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 168                 );                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 170         } catch (Exception e) {                                                                          </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 171             LOG.error(&quot;init schedule task failed !&quot;);                                                    </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 172             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174     }                                                                                                    </span>
<span  style=""> 175                                                                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 176     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 177         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 178         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 179                                                                                                          </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 180         LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                            </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 181         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 182         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 182         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 183                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 184         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 185                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 186         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 187         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 187         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 188                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 189         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 190         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 191                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 192         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 192         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 193         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 194         conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 195             try {                                                                                        </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 196                 ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                             </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 197                 if (authChore != null) {                                                                 </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 198                     choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 199                     choreService.scheduleChore(authChore);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200                 }                                                                                        </span>
<span  style=""> 201                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 202                 return ConnectionFactory.createConnection(finalConf);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 203             } catch (IOException e) {                                                                    </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 204                 LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                              </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 205                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 207         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208     }                                                                                                    </span>
<span  style=""> 209                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 210     @Override                                                                                            </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 211     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                               </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 212         if (record.f0) {                                                                                 </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style=""> 213             if (this.batchSize &gt; 1) {                                                                    </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 214                 writeBatchRecord(record.f1);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 215             } else {                                                                                     </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 216                 dealInsert(record.f1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219     }                                                                                                    </span>
<span  style=""> 220                                                                                                          </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 221     public void writeBatchRecord(Row row) {                                                              </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 222         records.add(row);                                                                                </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 223         // 数据累计到batchSize之后开始处理                                                                          </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 224         if (records.size() == this.batchSize) {                                                          </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 225             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 229     protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                  </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 230         // A null in the result array means that the call for that action failed, even after retries.    </span>
<span class="-7898978178383061123" onmouseenter="enter('-7898978178383061123');" onmouseout="out('-7898978178383061123');" style=""> 231         Object[] results = new Object[records.size()];                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 232         try {                                                                                            </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 233             List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                          </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 234             for (Row record : records) {                                                                 </span>
<span class="4049132556821532406" onmouseenter="enter('4049132556821532406');" onmouseout="out('4049132556821532406');" style=""> 235                 puts.add(getPutByRow(record));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236             }                                                                                            </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 237             table.batch(puts, results);                                                                  </span>
<span  style=""> 238                                                                                                          </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 239             // 打印结果                                                                                      </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 240             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 241                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 242                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243             }                                                                                            </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style=""> 244         } catch (IOException | InterruptedException e) {                                                 </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style=""> 245             // ignore exception                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 246         } finally {                                                                                      </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 247             // 判断数据是否插入成功                                                                                </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style=""> 248             for (int i = 0; i &lt; results.length; i++) {                                                   </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 249                 if (results[i] instanceof Exception) {                                                   </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 250 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251                     dirtyDataManager.execute();                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 252 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253                         LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                      </span>
<span class="2359639359152997630" onmouseenter="enter('2359639359152997630');" onmouseout="out('2359639359152997630');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254                         LOG.error(&quot;Error cause: &quot; + results[i]);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255                     }                                                                                    </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256                     // 脏数据记录                                                                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257                     outDirtyRecords.inc();                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258                 } else {                                                                                 </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259                     // 输出结果条数记录                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260                     outRecords.inc();                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 261 =======                                                                                                  </span>
<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262                     if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                       </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263                         LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                      </span>
<span class="191608650467857411" onmouseenter="enter('191608650467857411');" onmouseout="out('191608650467857411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 264                         LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause((Exception) results[i]));"> 264                         LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause((Exception) results🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265                     }                                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 266 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style=""> 267                     // 脏数据记录                                                                             </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style=""> 268                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="2903760467988971292" onmouseenter="enter('2903760467988971292');" onmouseout="out('2903760467988971292');" style=""> 269                         records.get(i).toString(),                                                       </span>
<span class="5608629942095290553" onmouseenter="enter('5608629942095290553');" onmouseout="out('5608629942095290553');" style=""> 270                         ExceptionTrace.traceOriginalCause((Exception) results[i])                        </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 271                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 272                     outDirtyRecords.inc();                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 273                 } else {                                                                                 </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 274                     // 输出结果条数记录                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 275                     outRecords.inc();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 278             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 279             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span  style=""> 282                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 283     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 284         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 285         if (put == null || put.isEmpty()) {                                                              </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 286             // 记录脏数据                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 287             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 288             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289         }                                                                                                </span>
<span  style=""> 290                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 291         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 292             table.put(put);                                                                              </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 293 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295                 LOG.info(record.toString());                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 296 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                 LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                               </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299                 LOG.error(&quot;&quot;, e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300             }                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 307 =======                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310                 LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                      </span>
<span class="5284749126956950965" onmouseenter="enter('5284749126956950965');" onmouseout="out('5284749126956950965');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311                 LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause(e));                       </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 312 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 314         } catch (Exception e) {                                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style=""> 315             dirtyDataManager.collectDirtyData(                                                           </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style=""> 316                 record.toString(),                                                                       </span>
<span class="2536668618460450946" onmouseenter="enter('2536668618460450946');" onmouseout="out('2536668618460450946');" style=""> 317                 ExceptionTrace.traceOriginalCause(e));                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 318             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319         }                                                                                                </span>
<span  style=""> 320                                                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 321         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322     }                                                                                                    </span>
<span  style=""> 323                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 324     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 325         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 326         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 327             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 329         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 330         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 331             Object fieldVal = record.getField(i);                                                        </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 332             if (fieldVal != null) {                                                                      </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 333                 byte[] val = fieldVal.toString().getBytes();                                             </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 334                 byte[] cf = families[i].getBytes();                                                      </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 335                 byte[] qualifier = qualifiers[i].getBytes();                                             </span>
<span  style=""> 336                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 337                 put.addColumn(cf, qualifier, val);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 340         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 341     }                                                                                                    </span>
<span  style=""> 342                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 343     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 344         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 345         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 346         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 347             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 348             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 349             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 351         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352     }                                                                                                    </span>
<span  style=""> 353                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 354     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 355         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 356         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 357         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 358         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359     }                                                                                                    </span>
<span  style=""> 360                                                                                                          </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 361     private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                              </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 362         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 363         for (int i = 0; i &lt; columnNames.length; i++) {                                                   </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 364             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 366         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367     }                                                                                                    </span>
<span  style=""> 368                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 369     @Override                                                                                            </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 370     public synchronized void close() throws IOException {                                                </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 371         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 372             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373         }                                                                                                </span>
<span  style=""> 374                                                                                                          </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 375         closed = true;                                                                                   </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 376         if (!records.isEmpty()) {                                                                        </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 377             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378         }                                                                                                </span>
<span  style=""> 379                                                                                                          </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 380         if (scheduledFuture != null) {                                                                   </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 381             scheduledFuture.cancel(false);                                                               </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 382             if (scheduler != null) {                                                                     </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 383                 scheduler.shutdownNow();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385         }                                                                                                </span>
<span  style=""> 386                                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 387         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 388             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 389             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390         }                                                                                                </span>
<span  style=""> 391                                                                                                          </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style=""> 392         if (dirtyDataManager != null) {                                                                  </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style=""> 393             dirtyDataManager.close();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395     }                                                                                                    </span>
<span  style=""> 396                                                                                                          </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 397     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                     </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 398                                         String regionserverPrincipal,                                    </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 399                                         String zookeeperSaslClient,                                      </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 400                                         String securityKrb5Conf) {                                       </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 401         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 402             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 402             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 404         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 405         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 406         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 407         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 408                                                                                                          </span>
<span  style=""> 409                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 410         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 411             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412         }                                                                                                </span>
<span  style=""> 413                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 414         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 415             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 416             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 417             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 419     }                                                                                                    </span>
<span  style=""> 420                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 421     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 422     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 423         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 424                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 425                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 426                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 427                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 428                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 429                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 430                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 431                 &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                     </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 432                 &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                     </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 433                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434     }                                                                                                    </span>
<span  style=""> 435                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 436     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 437                                                                                                          </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 438         private final HbaseOutputFormat format;                                                          </span>
<span  style=""> 439                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 440         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 441             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442         }                                                                                                </span>
<span  style=""> 443                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 444         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 445             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 446             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447         }                                                                                                </span>
<span  style=""> 448                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 449         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 450             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 451             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452         }                                                                                                </span>
<span  style=""> 453                                                                                                          </span>
<span  style=""> 454                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 455         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 456             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 457             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458         }                                                                                                </span>
<span  style=""> 459                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 460         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 461             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 462             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463         }                                                                                                </span>
<span  style=""> 464                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 465         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 466             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 467             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468         }                                                                                                </span>
<span  style=""> 469                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 470         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 471             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 472             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473         }                                                                                                </span>
<span  style=""> 474                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 475         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 476             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 477             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478         }                                                                                                </span>
<span  style=""> 479                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 480         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 481             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 482             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483         }                                                                                                </span>
<span  style=""> 484                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 485         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 486             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 487             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488         }                                                                                                </span>
<span  style=""> 489                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 490         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 491             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 492             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493         }                                                                                                </span>
<span  style=""> 494                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 495         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 496             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 497             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498         }                                                                                                </span>
<span  style=""> 499                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 500         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 501             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 502             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503         }                                                                                                </span>
<span  style=""> 504                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 505         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 506             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 507             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508         }                                                                                                </span>
<span  style=""> 509                                                                                                          </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style=""> 510         public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {             </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style=""> 511             format.dirtyDataManager = dirtyDataManager;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 512             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513         }                                                                                                </span>
<span  style=""> 514                                                                                                          </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 515         public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 516             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 517             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518         }                                                                                                </span>
<span  style=""> 519                                                                                                          </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 520         public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                   </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 521             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 522             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523         }                                                                                                </span>
<span  style=""> 524                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 525         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 526             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 527             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 528             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 529             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 529             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 530                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 531             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 532             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 533                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 534             if (format.columnNameFamily != null) {                                                       </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 535                 List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());               </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 536                 String[] columns = keyList.toArray(new String[0]);                                       </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 537                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 538                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 539                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 540                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 541                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 544             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 545             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 546                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 547             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  21                                                                                                          </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="">  22 import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                      </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  23 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  24 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  25 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  26 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  28 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  29 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  30 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  31 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  32 import org.apache.hadoop.hbase.AuthUtil;                                                                 </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  33 import org.apache.hadoop.hbase.ChoreService;                                                             </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  34 import org.apache.hadoop.hbase.HBaseConfiguration;                                                       </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  35 import org.apache.hadoop.hbase.ScheduledChore;                                                           </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  36 import org.apache.hadoop.hbase.TableName;                                                                </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  37 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  38 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  39 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  40 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  41 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  45 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  46 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  47 import java.security.PrivilegedAction;                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  48 import java.util.ArrayList;                                                                              </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  49 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  50 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  51 import java.util.Map;                                                                                    </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  52 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  53 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  54 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  55 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  56                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  57 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  58  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  59  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  60  */                                                                                                      </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  61 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                </span>
<span  style="">  62                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  63     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  64     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  65     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  66     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  67     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  68     private String[] columnNames;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  69     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  70     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  71     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  72     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  73     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  74     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  75     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  76     private String clientKeytabFile;                                                                     </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  77     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  78     private String[] qualifiers;                                                                         </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  79     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  80     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  81     private transient Table table;                                                                       </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  82     private transient ChoreService choreService;                                                         </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  83     private transient List&lt;Row&gt; records;                                                                 </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  84     private transient volatile boolean closed = false;                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  85     /**                                                                                                  </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  86      * 批量写入的参数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  87      */                                                                                                  </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  88     private Integer batchSize;                                                                           </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  89     private Long batchWaitInterval;                                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  90     /**                                                                                                  </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  91      * 定时任务                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  92      */                                                                                                  </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  93     private transient ScheduledExecutorService scheduler;                                                </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  94     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style="">  95                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  96     /**                                                                                                  </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style="">  97      * 脏数据管理                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  98      */                                                                                                  </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style="">  99     private DirtyDataManager dirtyDataManager;                                                           </span>
<span  style=""> 100                                                                                                          </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 101     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102     }                                                                                                    </span>
<span  style=""> 103                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 104     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 105         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106     }                                                                                                    </span>
<span  style=""> 107                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 108     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 109     public void configure(Configuration parameters) {                                                    </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 110         // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                    </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 111         // DO NOTHING                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112     }                                                                                                    </span>
<span  style=""> 113                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 114     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 115     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 116         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 117         records = new ArrayList&lt;&gt;();                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 118         conf = HBaseConfiguration.create();                                                              </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 119         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 120         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 121         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 122         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123     }                                                                                                    </span>
<span  style=""> 124                                                                                                          </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 125     private void openConn() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 126         try {                                                                                            </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 127             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 128                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 129                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 130             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 131                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 132                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 133                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 134                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 136         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 137             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138         }                                                                                                </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 139         initScheduledTask(batchWaitInterval);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140     }                                                                                                    </span>
<span  style=""> 141                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 142     /**                                                                                                  </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 143      * 初始化定时写入任务                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 144      *                                                                                                   </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 145      * @param batchWaitInterval 定时任务时间                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 146      */                                                                                                  </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 147     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148         try {                                                                                            </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 149             if (batchWaitInterval &gt; 0) {                                                                 </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 150                 this.scheduler = new ScheduledThreadPoolExecutor(                                        </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 151                         1,                                                                               </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 152                         new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 153                 );                                                                                       </span>
<span  style=""> 154                                                                                                          </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 155                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                            </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 156                         () -&gt; {                                                                          </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 157                             synchronized (HbaseOutputFormat.this) {                                      </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 158                                 if (!records.isEmpty()) {                                                </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 159                                     dealBatchOperation(records);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                             }                                                                            </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 162                         }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 163                 );                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 165         } catch (Exception e) {                                                                          </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 166             LOG.error(&quot;init schedule task failed !&quot;);                                                    </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 167             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169     }                                                                                                    </span>
<span  style=""> 170                                                                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 171     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 172         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 173         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 174                                                                                                          </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 175         LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                            </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 176         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 177         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 177         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 178                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 179         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 180                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 181         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 182         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 182         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 183                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 184         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 185         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 186                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 187         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 187         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 188         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 189         conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 190             try {                                                                                        </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 191                 ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                             </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 192                 if (authChore != null) {                                                                 </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 193                     choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 194                     choreService.scheduleChore(authChore);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195                 }                                                                                        </span>
<span  style=""> 196                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 197                 return ConnectionFactory.createConnection(finalConf);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 198             } catch (IOException e) {                                                                    </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 199                 LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                              </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 200                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 202         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203     }                                                                                                    </span>
<span  style=""> 204                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 205     @Override                                                                                            </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 206     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                               </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 207         if (record.f0) {                                                                                 </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style=""> 208             if (this.batchSize &gt; 1) {                                                                    </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 209                 writeBatchRecord(record.f1);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 210             } else {                                                                                     </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 211                 dealInsert(record.f1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 216     public void writeBatchRecord(Row row) {                                                              </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 217         records.add(row);                                                                                </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 218         // 数据累计到batchSize之后开始处理                                                                          </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 219         if (records.size() == this.batchSize) {                                                          </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 220             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span  style=""> 223                                                                                                          </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 224     protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                  </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 225         // A null in the result array means that the call for that action failed, even after retries.    </span>
<span class="-7898978178383061123" onmouseenter="enter('-7898978178383061123');" onmouseout="out('-7898978178383061123');" style=""> 226         Object[] results = new Object[records.size()];                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 227         try {                                                                                            </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 228             List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                          </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 229             for (Row record : records) {                                                                 </span>
<span class="4049132556821532406" onmouseenter="enter('4049132556821532406');" onmouseout="out('4049132556821532406');" style=""> 230                 puts.add(getPutByRow(record));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231             }                                                                                            </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 232             table.batch(puts, results);                                                                  </span>
<span  style=""> 233                                                                                                          </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 234             // 打印结果                                                                                      </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 235             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 236                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 237                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238             }                                                                                            </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style=""> 239         } catch (IOException | InterruptedException e) {                                                 </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style=""> 240             // ignore exception                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 241         } finally {                                                                                      </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 242             // 判断数据是否插入成功                                                                                </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style=""> 243             for (int i = 0; i &lt; results.length; i++) {                                                   </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 244                 if (results[i] instanceof Exception) {                                                   </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 245 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246                     dirtyDataManager.execute();                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 247 ||||||| BASE                                                                                             </span>
<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248                     if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                       </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249                         LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                      </span>
<span class="2359639359152997630" onmouseenter="enter('2359639359152997630');" onmouseout="out('2359639359152997630');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250                         LOG.error(&quot;Error cause: &quot; + results[i]);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251                     }                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 252 =======                                                                                                  </span>
<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253                     if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                       </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254                         LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                      </span>
<span class="191608650467857411" onmouseenter="enter('191608650467857411');" onmouseout="out('191608650467857411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 255                         LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause((Exception) results[i]));"> 255                         LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause((Exception) results🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256                     }                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 257 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style=""> 258                     // 脏数据记录                                                                             </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style=""> 259                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="2903760467988971292" onmouseenter="enter('2903760467988971292');" onmouseout="out('2903760467988971292');" style=""> 260                         records.get(i).toString(),                                                       </span>
<span class="5608629942095290553" onmouseenter="enter('5608629942095290553');" onmouseout="out('5608629942095290553');" style=""> 261                         ExceptionTrace.traceOriginalCause((Exception) results[i])                        </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 262                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 263                     outDirtyRecords.inc();                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 264                 } else {                                                                                 </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 265                     // 输出结果条数记录                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 266                     outRecords.inc();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 269             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 270             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span  style=""> 273                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 274     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 275         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 276         if (put == null || put.isEmpty()) {                                                              </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 277             // 记录脏数据                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 278             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 279             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span  style=""> 281                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 282         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 283             table.put(put);                                                                              </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 284 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 285 ||||||| BASE                                                                                             </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288                 LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                               </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289                 LOG.error(&quot;&quot;, e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290             }                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 294 =======                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297                 LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                      </span>
<span class="5284749126956950965" onmouseenter="enter('5284749126956950965');" onmouseout="out('5284749126956950965');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298                 LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause(e));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299             }                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 303 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 304         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 305             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306         }                                                                                                </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 307         } catch (Exception e) {                                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style=""> 308             dirtyDataManager.collectDirtyData(                                                           </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style=""> 309                 record.toString(),                                                                       </span>
<span class="2536668618460450946" onmouseenter="enter('2536668618460450946');" onmouseout="out('2536668618460450946');" style=""> 310                 ExceptionTrace.traceOriginalCause(e));                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 311             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312         }                                                                                                </span>
<span  style=""> 313                                                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 314         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315     }                                                                                                    </span>
<span  style=""> 316                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 317     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 318         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 319         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 320             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 322         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 323         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 324             Object fieldVal = record.getField(i);                                                        </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 325             if (fieldVal != null) {                                                                      </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 326                 byte[] val = fieldVal.toString().getBytes();                                             </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 327                 byte[] cf = families[i].getBytes();                                                      </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 328                 byte[] qualifier = qualifiers[i].getBytes();                                             </span>
<span  style=""> 329                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 330                 put.addColumn(cf, qualifier, val);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 333         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 336     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 337         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 338         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 339         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 340             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 341             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 342             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 344         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345     }                                                                                                    </span>
<span  style=""> 346                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 347     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 348         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 349         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 350         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 351         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352     }                                                                                                    </span>
<span  style=""> 353                                                                                                          </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 354     private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                              </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 355         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 356         for (int i = 0; i &lt; columnNames.length; i++) {                                                   </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 357             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 359         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360     }                                                                                                    </span>
<span  style=""> 361                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 362     @Override                                                                                            </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 363     public synchronized void close() throws IOException {                                                </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 364         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 365             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366         }                                                                                                </span>
<span  style=""> 367                                                                                                          </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 368         closed = true;                                                                                   </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 369         if (!records.isEmpty()) {                                                                        </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 370             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371         }                                                                                                </span>
<span  style=""> 372                                                                                                          </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 373         if (scheduledFuture != null) {                                                                   </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 374             scheduledFuture.cancel(false);                                                               </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 375             if (scheduler != null) {                                                                     </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 376                 scheduler.shutdownNow();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378         }                                                                                                </span>
<span  style=""> 379                                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 380         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 381             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 382             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383         }                                                                                                </span>
<span  style=""> 384                                                                                                          </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style=""> 385         if (dirtyDataManager != null) {                                                                  </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style=""> 386             dirtyDataManager.close();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388     }                                                                                                    </span>
<span  style=""> 389                                                                                                          </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 390     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                     </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 391                                         String regionserverPrincipal,                                    </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 392                                         String zookeeperSaslClient,                                      </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 393                                         String securityKrb5Conf) {                                       </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 394         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 395             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 395             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 397         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 398         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 399         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 400         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 401                                                                                                          </span>
<span  style=""> 402                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 403         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 404             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405         }                                                                                                </span>
<span  style=""> 406                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 407         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 408             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 409             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 410             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412     }                                                                                                    </span>
<span  style=""> 413                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 414     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 415     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 416         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 417                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 418                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 419                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 420                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 421                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 422                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 423                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 424                 &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                     </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 425                 &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                     </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 426                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427     }                                                                                                    </span>
<span  style=""> 428                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 429     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 430                                                                                                          </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 431         private final HbaseOutputFormat format;                                                          </span>
<span  style=""> 432                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 433         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 434             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435         }                                                                                                </span>
<span  style=""> 436                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 437         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 438             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 439             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440         }                                                                                                </span>
<span  style=""> 441                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 442         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 443             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 444             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445         }                                                                                                </span>
<span  style=""> 446                                                                                                          </span>
<span  style=""> 447                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 448         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 449             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 450             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451         }                                                                                                </span>
<span  style=""> 452                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 453         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 454             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 455             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456         }                                                                                                </span>
<span  style=""> 457                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 458         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 459             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 460             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461         }                                                                                                </span>
<span  style=""> 462                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 463         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 464             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 465             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466         }                                                                                                </span>
<span  style=""> 467                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 468         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 469             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 470             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471         }                                                                                                </span>
<span  style=""> 472                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 473         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 474             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 475             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476         }                                                                                                </span>
<span  style=""> 477                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 478         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 479             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 480             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481         }                                                                                                </span>
<span  style=""> 482                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 483         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 484             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 485             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486         }                                                                                                </span>
<span  style=""> 487                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 488         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 489             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 490             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491         }                                                                                                </span>
<span  style=""> 492                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 493         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 494             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 495             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496         }                                                                                                </span>
<span  style=""> 497                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 498         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 499             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 500             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501         }                                                                                                </span>
<span  style=""> 502                                                                                                          </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style=""> 503         public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {             </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style=""> 504             format.dirtyDataManager = dirtyDataManager;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 505             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506         }                                                                                                </span>
<span  style=""> 507                                                                                                          </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 508         public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 509             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 510             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511         }                                                                                                </span>
<span  style=""> 512                                                                                                          </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 513         public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                   </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 514             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 515             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516         }                                                                                                </span>
<span  style=""> 517                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 518         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 519             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 520             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 521             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 522             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 522             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 523                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 524             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 525             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 526                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 527             if (format.columnNameFamily != null) {                                                       </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 528                 List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());               </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 529                 String[] columns = keyList.toArray(new String[0]);                                       </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 530                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 531                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 532                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 533                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 534                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 537             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 538             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 539                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 540             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543 }                                                                                                        </span>





</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  18 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  19                                                                                                          </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="">  20 import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                      </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  21 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  22 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  24 import com.google.common.collect.Maps;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  25 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  26 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  27 import java.security.PrivilegedAction;                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  28 import java.util.ArrayList;                                                                              </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  29 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  30 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  31 import java.util.Map;                                                                                    </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  32 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  33 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  34 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  35 import java.util.concurrent.TimeUnit;                                                                    </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  36 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  37 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  38 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  39 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  40 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  41 import org.apache.hadoop.hbase.AuthUtil;                                                                 </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  42 import org.apache.hadoop.hbase.ChoreService;                                                             </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  43 import org.apache.hadoop.hbase.HBaseConfiguration;                                                       </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  44 import org.apache.hadoop.hbase.ScheduledChore;                                                           </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  45 import org.apache.hadoop.hbase.TableName;                                                                </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  46 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  47 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  48 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  49 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  50 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  51 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  52 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  53                                                                                                          </span>
<span  style="">  54                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  56  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  57  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58  */                                                                                                      </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  59 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  60     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span  style="">  61                                                                                                          </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  62     private String host;                                                                                 </span>
<span  style="">  63                                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  64     private String zkParent;                                                                             </span>
<span  style="">  65                                                                                                          </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  66     private String rowkey;                                                                               </span>
<span  style="">  67                                                                                                          </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  68     private String tableName;                                                                            </span>
<span  style="">  69                                                                                                          </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  70     private String[] columnNames;                                                                        </span>
<span  style="">  71                                                                                                          </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  72     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span  style="">  73                                                                                                          </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  74     private boolean kerberosAuthEnable;                                                                  </span>
<span  style="">  75                                                                                                          </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  76     private String regionserverKeytabFile;                                                               </span>
<span  style="">  77                                                                                                          </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  78     private String regionserverPrincipal;                                                                </span>
<span  style="">  79                                                                                                          </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  80     private String securityKrb5Conf;                                                                     </span>
<span  style="">  81                                                                                                          </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  82     private String zookeeperSaslClient;                                                                  </span>
<span  style="">  83                                                                                                          </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  84     private String clientPrincipal;                                                                      </span>
<span  style="">  85                                                                                                          </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  86     private String clientKeytabFile;                                                                     </span>
<span  style="">  87                                                                                                          </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  88     private String[] families;                                                                           </span>
<span  style="">  89                                                                                                          </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  90     private String[] qualifiers;                                                                         </span>
<span  style="">  91                                                                                                          </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  92     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span  style="">  93                                                                                                          </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  94     private transient Connection conn;                                                                   </span>
<span  style="">  95                                                                                                          </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  96     private transient Table table;                                                                       </span>
<span  style="">  97                                                                                                          </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  98     private transient ChoreService choreService;                                                         </span>
<span  style="">  99                                                                                                          </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style=""> 100     private transient List&lt;Row&gt; records;                                                                 </span>
<span  style=""> 101                                                                                                          </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style=""> 102     private transient volatile boolean closed = false;                                                   </span>
<span  style=""> 103                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 104     /**                                                                                                  </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style=""> 105      * 批量写入的参数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 106      */                                                                                                  </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style=""> 107     private Integer batchSize;                                                                           </span>
<span  style=""> 108                                                                                                          </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style=""> 109     private Long batchWaitInterval;                                                                      </span>
<span  style=""> 110                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 111     /**                                                                                                  </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style=""> 112      * 定时任务                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 113      */                                                                                                  </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style=""> 114     private transient ScheduledExecutorService scheduler;                                                </span>
<span  style=""> 115                                                                                                          </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style=""> 116     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style=""> 117                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 118     /**                                                                                                  </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style=""> 119      * 脏数据管理                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 120      */                                                                                                  </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style=""> 121     private DirtyDataManager dirtyDataManager;                                                           </span>
<span  style=""> 122                                                                                                          </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 123     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124     }                                                                                                    </span>
<span  style=""> 125                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 126     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 127         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128     }                                                                                                    </span>
<span  style=""> 129                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 130     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 131     public void configure(Configuration parameters) {                                                    </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 132         // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                    </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 133         // DO NOTHING                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134     }                                                                                                    </span>
<span  style=""> 135                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 136     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 137     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 138         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 139         records = new ArrayList&lt;&gt;();                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 140         conf = HBaseConfiguration.create();                                                              </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 141         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 142         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 143         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 144         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145     }                                                                                                    </span>
<span  style=""> 146                                                                                                          </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 147     private void openConn() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148         try {                                                                                            </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 149             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 150                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 151                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 152             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 153                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 154                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 155                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 156                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 158         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 159             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160         }                                                                                                </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 161         initScheduledTask(batchWaitInterval);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162     }                                                                                                    </span>
<span  style=""> 163                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 164     /**                                                                                                  </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 165      * 初始化定时写入任务                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 166      *                                                                                                   </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 167      * @param batchWaitInterval 定时任务时间                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 168      */                                                                                                  </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 169     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 170         try {                                                                                            </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 171             if (batchWaitInterval &gt; 0) {                                                                 </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 172                 this.scheduler = new ScheduledThreadPoolExecutor(                                        </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 173                         1,                                                                               </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 174                         new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 175                 );                                                                                       </span>
<span  style=""> 176                                                                                                          </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 177                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                            </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 178                         () -&gt; {                                                                          </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 179                             synchronized (HbaseOutputFormat.this) {                                      </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 180                                 if (!records.isEmpty()) {                                                </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 181                                     dealBatchOperation(records);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183                             }                                                                            </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 184                         }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 185                 );                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 187         } catch (Exception e) {                                                                          </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 188             LOG.error(&quot;init schedule task failed !&quot;);                                                    </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 189             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191     }                                                                                                    </span>
<span  style=""> 192                                                                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 193     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 194         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 195         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 196                                                                                                          </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 197         LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                            </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 198         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 199         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 199         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 200                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 201         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 202                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 203         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 204         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 204         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 205                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 206         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 207         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 208                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 209         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 209         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 210         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 211         conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 212             try {                                                                                        </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 213                 ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                             </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 214                 if (authChore != null) {                                                                 </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 215                     choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 216                     choreService.scheduleChore(authChore);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                 }                                                                                        </span>
<span  style=""> 218                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 219                 return ConnectionFactory.createConnection(finalConf);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 220             } catch (IOException e) {                                                                    </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 221                 LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                              </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 222                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 224         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225     }                                                                                                    </span>
<span  style=""> 226                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 227     @Override                                                                                            </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 228     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                               </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 229         if (record.f0) {                                                                                 </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style=""> 230             if (this.batchSize &gt; 1) {                                                                    </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 231                 writeBatchRecord(record.f1);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 232             } else {                                                                                     </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 233                 dealInsert(record.f1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236     }                                                                                                    </span>
<span  style=""> 237                                                                                                          </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 238     public void writeBatchRecord(Row row) {                                                              </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 239         records.add(row);                                                                                </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 240         // 数据累计到batchSize之后开始处理                                                                          </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 241         if (records.size() == this.batchSize) {                                                          </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 242             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244     }                                                                                                    </span>
<span  style=""> 245                                                                                                          </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 246     protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                  </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 247         // A null in the result array means that the call for that action failed, even after retries.    </span>
<span class="-7898978178383061123" onmouseenter="enter('-7898978178383061123');" onmouseout="out('-7898978178383061123');" style=""> 248         Object[] results = new Object[records.size()];                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 249         try {                                                                                            </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 250             List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                          </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 251             for (Row record : records) {                                                                 </span>
<span class="4049132556821532406" onmouseenter="enter('4049132556821532406');" onmouseout="out('4049132556821532406');" style=""> 252                 puts.add(getPutByRow(record));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253             }                                                                                            </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 254             table.batch(puts, results);                                                                  </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 255             // 打印结果                                                                                      </span>
<span class="718537504629553708" onmouseenter="enter('718537504629553708');" onmouseout="out('718537504629553708');" style=""> 256             if ((outRecords.getCount() % ROW_PRINT_FREQUENCY) == 0) {                                    </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 257                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 258                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259             }                                                                                            </span>
<span class="4324967919884815686" onmouseenter="enter('4324967919884815686');" onmouseout="out('4324967919884815686');" style=""> 260         } catch (IOException | java.lang.InterruptedException e) {                                       </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style=""> 261             // ignore exception                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 262         } finally {                                                                                      </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 263             // 判断数据是否插入成功                                                                                </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style=""> 264             for (int i = 0; i &lt; results.length; i++) {                                                   </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 265                 if (results[i] instanceof Exception) {                                                   </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style=""> 266                     dirtyDataManager.execute();                                                          </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style=""> 267                     // 脏数据记录                                                                             </span>
<span class="6016801622208181712" onmouseenter="enter('6016801622208181712');" onmouseout="out('6016801622208181712');" style=""><abbr title=" 268                     dirtyDataManager.collectDirtyData(records.get(i).toString(), ExceptionTrace.traceOriginalCause(((Exception) (results[i]))));"> 268                     dirtyDataManager.collectDirtyData(records.get(i).toString(), ExceptionTrace.traceOrig🔵</abbr></span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 269                     outDirtyRecords.inc();                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 270                 } else {                                                                                 </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 271                     // 输出结果条数记录                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 272                     outRecords.inc();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 275             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 276             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278     }                                                                                                    </span>
<span  style=""> 279                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 280     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 281         Put put = getPutByRow(record);                                                                   </span>
<span class="7979542233400604099" onmouseenter="enter('7979542233400604099');" onmouseout="out('7979542233400604099');" style=""> 282         if ((put == null) || put.isEmpty()) {                                                            </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 283             // 记录脏数据                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 284             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 285             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 287         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 288             table.put(put);                                                                              </span>
<span class="718537504629553708" onmouseenter="enter('718537504629553708');" onmouseout="out('718537504629553708');" style=""> 289             if ((outRecords.getCount() % ROW_PRINT_FREQUENCY) == 0) {                                    </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 290                 LOG.info(record.toString());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291             }                                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 292         } catch (java.lang.Exception e) {                                                                </span>
<span class="-462120057032768446" onmouseenter="enter('-462120057032768446');" onmouseout="out('-462120057032768446');" style=""> 293             dirtyDataManager.collectDirtyData(record.toString(), ExceptionTrace.traceOriginalCause(e));  </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 294             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295         }                                                                                                </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 296         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297     }                                                                                                    </span>
<span  style=""> 298                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 299     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 300         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 301         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 302             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 304         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 305         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 306             Object fieldVal = record.getField(i);                                                        </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 307             if (fieldVal != null) {                                                                      </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 308                 byte[] val = fieldVal.toString().getBytes();                                             </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 309                 byte[] cf = families[i].getBytes();                                                      </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 310                 byte[] qualifier = qualifiers[i].getBytes();                                             </span>
<span  style=""> 311                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 312                 put.addColumn(cf, qualifier, val);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 315         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316     }                                                                                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 318     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 319         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 320         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 321         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 322             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 323             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 324             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 326         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327     }                                                                                                    </span>
<span  style=""> 328                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 329     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 330         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 331         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 332         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 333         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 336     private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                              </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 337         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 338         for (int i = 0; i &lt; columnNames.length; i++) {                                                   </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 339             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 341         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342     }                                                                                                    </span>
<span  style=""> 343                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 344     @Override                                                                                            </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 345     public synchronized void close() throws IOException {                                                </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 346         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 347             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348         }                                                                                                </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 349         closed = true;                                                                                   </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 350         if (!records.isEmpty()) {                                                                        </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 351             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352         }                                                                                                </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 353         if (scheduledFuture != null) {                                                                   </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 354             scheduledFuture.cancel(false);                                                               </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 355             if (scheduler != null) {                                                                     </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 356                 scheduler.shutdownNow();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358         }                                                                                                </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 359         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 360             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 361             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362         }                                                                                                </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style=""> 363         if (dirtyDataManager != null) {                                                                  </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style=""> 364             dirtyDataManager.close();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366     }                                                                                                    </span>
<span  style=""> 367                                                                                                          </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 368     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                     </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 369                                         String regionserverPrincipal,                                    </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 370                                         String zookeeperSaslClient,                                      </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 371                                         String securityKrb5Conf) {                                       </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 372         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 373             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 373             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 375         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 376         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 377         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 378         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 379                                                                                                          </span>
<span  style=""> 380                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 381         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 382             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383         }                                                                                                </span>
<span  style=""> 384                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 385         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 386             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 387             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 388             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390     }                                                                                                    </span>
<span  style=""> 391                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 392     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 393     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 394         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 395                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 396                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 397                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 398                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 399                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 400                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 401                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 402                 &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                     </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 403                 &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                     </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 404                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405     }                                                                                                    </span>
<span  style=""> 406                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 407     public static class HbaseOutputFormatBuilder {                                                       </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 408         private final HbaseOutputFormat format;                                                          </span>
<span  style=""> 409                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 410         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 411             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412         }                                                                                                </span>
<span  style=""> 413                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 414         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 415             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 416             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417         }                                                                                                </span>
<span  style=""> 418                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 419         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 420             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 421             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422         }                                                                                                </span>
<span  style=""> 423                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 424         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 425             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 426             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427         }                                                                                                </span>
<span  style=""> 428                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 429         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 430             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 431             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432         }                                                                                                </span>
<span  style=""> 433                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 434         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 435             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 436             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437         }                                                                                                </span>
<span  style=""> 438                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 439         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 440             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 441             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442         }                                                                                                </span>
<span  style=""> 443                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 444         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 445             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 446             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447         }                                                                                                </span>
<span  style=""> 448                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 449         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 450             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 451             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452         }                                                                                                </span>
<span  style=""> 453                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 454         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 455             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 456             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457         }                                                                                                </span>
<span  style=""> 458                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 459         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 460             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 461             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462         }                                                                                                </span>
<span  style=""> 463                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 464         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 465             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 466             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467         }                                                                                                </span>
<span  style=""> 468                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 469         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 470             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 471             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472         }                                                                                                </span>
<span  style=""> 473                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 474         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 475             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 476             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477         }                                                                                                </span>
<span  style=""> 478                                                                                                          </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style=""> 479         public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {             </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style=""> 480             format.dirtyDataManager = dirtyDataManager;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 481             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482         }                                                                                                </span>
<span  style=""> 483                                                                                                          </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 484         public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 485             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 486             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487         }                                                                                                </span>
<span  style=""> 488                                                                                                          </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 489         public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                   </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 490             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 491             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492         }                                                                                                </span>
<span  style=""> 493                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 494         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 495             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 496             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 497             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 498             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 498             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 499                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 500             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 501             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 502                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 503             if (format.columnNameFamily != null) {                                                       </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 504                 List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());               </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 505                 String[] columns = keyList.toArray(new String[0]);                                       </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 506                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 507                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 508                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 509                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 510                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 513             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 514             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 515                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 516             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519 }                                                                                                        </span>





























</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  21                                                                                                                    </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                               </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import com.dtstack.flink.sql.exception.ExceptionTrace;                                                            </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  24  import com.dtstack.flink.sql.factory.DTThreadFactory;                                                             </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  25  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  26  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  28  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  29  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  30  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  31  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  32  import org.apache.hadoop.hbase.AuthUtil;                                                                          </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  33  import org.apache.hadoop.hbase.ChoreService;                                                                      </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  34  import org.apache.hadoop.hbase.HBaseConfiguration;                                                                </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  35  import org.apache.hadoop.hbase.ScheduledChore;                                                                    </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  36  import org.apache.hadoop.hbase.TableName;                                                                         </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  37  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  38  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  39  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  40  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  41  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  44                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  45  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  46  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  47  import java.security.PrivilegedAction;                                                                            </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  48  import java.util.ArrayList;                                                                                       </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  49  import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  50  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  51  import java.util.Map;                                                                                             </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  52  import java.util.concurrent.ScheduledExecutorService;                                                             </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  53  import java.util.concurrent.ScheduledFuture;                                                                      </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  54  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  55  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  56                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  57  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  58   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  59   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  60   */                                                                                                               </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  61  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                         </span>
<span  style="">  62                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  63      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  64      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  65      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  66      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  67      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  68      private String[] columnNames;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  69      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  70      private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  71      private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  72      private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  73      private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  74      private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  75      private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  76      private String clientKeytabFile;                                                                              </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  77      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  78      private String[] qualifiers;                                                                                  </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  79      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  80      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  81      private transient Table table;                                                                                </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  82      private transient ChoreService choreService;                                                                  </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  83      private transient List&lt;Row&gt; records;                                                                          </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  84      private transient volatile boolean closed = false;                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  85      /**                                                                                                           </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  86       * 批量写入的参数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  87       */                                                                                                           </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  88      private Integer batchSize;                                                                                    </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  89      private Long batchWaitInterval;                                                                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  90      /**                                                                                                           </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  91       * 定时任务                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  92       */                                                                                                           </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  93      private transient ScheduledExecutorService scheduler;                                                         </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  94      private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                         </span>
<span  style="">  95                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +    /**                                                                                                           </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +     * 脏数据管理                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +     */                                                                                                           </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +    private DirtyDataManager dirtyDataManager;                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +                                                                                                                  </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 101      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102      }                                                                                                             </span>
<span  style=""> 103                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 104      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 105          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106      }                                                                                                             </span>
<span  style=""> 107                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 108      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 109      public void configure(Configuration parameters) {                                                             </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 110          // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                             </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 111          // DO NOTHING                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112      }                                                                                                             </span>
<span  style=""> 113                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 114      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 115      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 116          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 117          records = new ArrayList&lt;&gt;();                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 118          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 119          openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 120          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 121          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 122          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123      }                                                                                                             </span>
<span  style=""> 124                                                                                                                    </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 125      private void openConn() {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 126          try {                                                                                                     </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 127              if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 128                  LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 129                  openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 130              } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 131                  LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 132                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 133                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 134                  conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 136          } catch (Exception e) {                                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 137              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138          }                                                                                                         </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 139          initScheduledTask(batchWaitInterval);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140      }                                                                                                             </span>
<span  style=""> 141                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 142      /**                                                                                                           </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 143       * 初始化定时写入任务                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 144       *                                                                                                            </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 145       * @param batchWaitInterval 定时任务时间                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 146       */                                                                                                           </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 147      private void initScheduledTask(Long batchWaitInterval) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148          try {                                                                                                     </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 149              if (batchWaitInterval &gt; 0) {                                                                          </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 150                  this.scheduler = new ScheduledThreadPoolExecutor(                                                 </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 151                          1,                                                                                        </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 152                          new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                                </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 153                  );                                                                                                </span>
<span  style=""> 154                                                                                                                    </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 155                  this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                                     </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 156                          () -&gt; {                                                                                   </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 157                              synchronized (HbaseOutputFormat.this) {                                               </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 158                                  if (!records.isEmpty()) {                                                         </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 159                                      dealBatchOperation(records);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                              }                                                                                     </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 162                          }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 163                  );                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 165          } catch (Exception e) {                                                                                   </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 166              LOG.error(&quot;init schedule task failed !&quot;);                                                             </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 167              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169      }                                                                                                             </span>
<span  style=""> 170                                                                                                                    </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 171      private void openKerberosConn() throws Exception {                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 172          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 173          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style=""> 174                                                                                                                    </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 175          LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                                     </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 176          Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""> 177          Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style=""> 178                                                                                                                    </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 179          fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style=""> 180                                                                                                                    </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 181          clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""> 182          clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style=""> 183                                                                                                                    </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 184          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 185          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 187          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 187          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clie🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 188          org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 189          conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 190              try {                                                                                                 </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 191                  ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                      </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 192                  if (authChore != null) {                                                                          </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 193                      choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                         </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 194                      choreService.scheduleChore(authChore);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195                  }                                                                                                 </span>
<span  style=""> 196                                                                                                                    </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 197                  return ConnectionFactory.createConnection(finalConf);                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 198              } catch (IOException e) {                                                                             </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 199                  LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                       </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 200                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 202          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203      }                                                                                                             </span>
<span  style=""> 204                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 205      @Override                                                                                                     </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 206      public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                                        </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 207          if (record.f0) {                                                                                          </span>
<span class="8741474660790294795" onmouseenter="enter('8741474660790294795');" onmouseout="out('8741474660790294795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -            if (this.batchSize != 0) {                                                                            </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +            if (this.batchSize &gt; 1) {                                                                             </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 210                  writeBatchRecord(record.f1);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 211              } else {                                                                                              </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 212                  dealInsert(record.f1);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215      }                                                                                                             </span>
<span  style=""> 216                                                                                                                    </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 217      public void writeBatchRecord(Row row) {                                                                       </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 218          records.add(row);                                                                                         </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 219          // 数据累计到batchSize之后开始处理                                                                                   </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 220          if (records.size() == this.batchSize) {                                                                   </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 221              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223      }                                                                                                             </span>
<span  style=""> 224                                                                                                                    </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 225      protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                           </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 226          // A null in the result array means that the call for that action failed, even after retries.             </span>
<span class="-7898978178383061123" onmouseenter="enter('-7898978178383061123');" onmouseout="out('-7898978178383061123');" style=""> 227          Object[] results = new Object[records.size()];                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 228          try {                                                                                                     </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 229              List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                                   </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 230              for (Row record : records) {                                                                          </span>
<span class="4049132556821532406" onmouseenter="enter('4049132556821532406');" onmouseout="out('4049132556821532406');" style=""> 231                  puts.add(getPutByRow(record));                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232              }                                                                                                     </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 233              table.batch(puts, results);                                                                           </span>
<span  style=""> 234                                                                                                                    </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 235              // 打印结果                                                                                               </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 236              if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 237                  // 只打印最后一条数据                                                                                      </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 238                  LOG.info(records.get(records.size() - 1).toString());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239              }                                                                                                     </span>
<span class="-7907197852339825500" onmouseenter="enter('-7907197852339825500');" onmouseout="out('-7907197852339825500');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -        } catch (IOException | InterruptedException ignored) {                                                    </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +        } catch (IOException | InterruptedException e) {                                                          </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +            // ignore exception                                                                                   </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 243          } finally {                                                                                               </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 244              // 判断数据是否插入成功                                                                                         </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style=""> 245              for (int i = 0; i &lt; results.length; i++) {                                                            </span>
<span class="2819338636380693463" onmouseenter="enter('2819338636380693463');" onmouseout="out('2819338636380693463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 246 -                if (results[i] != null) {                                                                         </span>

<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 247 -                    if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                                </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 248 -                        LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                               </span>
<span class="2359639359152997630" onmouseenter="enter('2359639359152997630');" onmouseout="out('2359639359152997630');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 249 -                        LOG.error(&quot;Error cause: &quot; + results[i]);                                                  </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 250 -                    }                                                                                             </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +                if (results[i] instanceof Exception) {                                                            </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +                    dirtyDataManager.execute();                                                                   </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style=""> 253                      // 脏数据记录                                                                                      </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +                    dirtyDataManager.collectDirtyData(                                                            </span>
<span class="2903760467988971292" onmouseenter="enter('2903760467988971292');" onmouseout="out('2903760467988971292');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +                        records.get(i).toString(),                                                                </span>
<span class="5608629942095290553" onmouseenter="enter('5608629942095290553');" onmouseout="out('5608629942095290553');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +                        ExceptionTrace.traceOriginalCause((Exception) results[i])                                 </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +                    );                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 258                      outDirtyRecords.inc();                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 259                  } else {                                                                                          </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 260                      // 输出结果条数记录                                                                                   </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 261                      outRecords.inc();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263              }                                                                                                     </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 264              // 添加完数据之后数据清空records                                                                                 </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 265              records.clear();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267      }                                                                                                             </span>
<span  style=""> 268                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 269      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 270          Put put = getPutByRow(record);                                                                            </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 271          if (put == null || put.isEmpty()) {                                                                       </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 272              // 记录脏数据                                                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 273              outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 274              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275          }                                                                                                         </span>
<span  style=""> 276                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 277          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 278              table.put(put);                                                                                       </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +            if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +                LOG.info(record.toString());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +            }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 282          } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 283 -            if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -                LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                        </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -                LOG.error(&quot;&quot;, e);                                                                                 </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -            }                                                                                                     </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +            dirtyDataManager.collectDirtyData(                                                                    </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +                record.toString(),                                                                                </span>
<span class="2536668618460450946" onmouseenter="enter('2536668618460450946');" onmouseout="out('2536668618460450946');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +                ExceptionTrace.traceOriginalCause(e));                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 290              outDirtyRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291          }                                                                                                         </span>
<span  style=""> 292                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 293 -        if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 294 -            LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 295 -        }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 296          outRecords.inc();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297      }                                                                                                             </span>
<span  style=""> 298                                                                                                                    </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 299      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 300          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 301          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 302              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 304          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 305          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 306              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 307              if (fieldVal != null) {                                                                               </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 308                  byte[] val = fieldVal.toString().getBytes();                                                      </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 309                  byte[] cf = families[i].getBytes();                                                               </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 310                  byte[] qualifier = qualifiers[i].getBytes();                                                      </span>
<span  style=""> 311                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 312                  put.addColumn(cf, qualifier, val);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 315          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316      }                                                                                                             </span>
<span  style=""> 317                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 318      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 319          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 320          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 321          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 322              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 323              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 324              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 326          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327      }                                                                                                             </span>
<span  style=""> 328                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 329      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 330          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 331          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 332          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 333          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334      }                                                                                                             </span>
<span  style=""> 335                                                                                                                    </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 336      private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                                       </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 337          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 338          for (int i = 0; i &lt; columnNames.length; i++) {                                                            </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 339              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 341          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342      }                                                                                                             </span>
<span  style=""> 343                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 344      @Override                                                                                                     </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 345      public synchronized void close() throws IOException {                                                         </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 346          if (closed) {                                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 347              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348          }                                                                                                         </span>
<span  style=""> 349                                                                                                                    </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 350          closed = true;                                                                                            </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 351          if (!records.isEmpty()) {                                                                                 </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 352              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353          }                                                                                                         </span>
<span  style=""> 354                                                                                                                    </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 355          if (scheduledFuture != null) {                                                                            </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 356              scheduledFuture.cancel(false);                                                                        </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 357              if (scheduler != null) {                                                                              </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 358                  scheduler.shutdownNow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360          }                                                                                                         </span>
<span  style=""> 361                                                                                                                    </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 362          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 363              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 364              conn = null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 365 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 366 +                                                                                                                  </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 367 +        if (dirtyDataManager != null) {                                                                           </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 368 +            dirtyDataManager.close();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370      }                                                                                                             </span>
<span  style=""> 371                                                                                                                    </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 372      private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                              </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 373                                          String regionserverPrincipal,                                             </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 374                                          String zookeeperSaslClient,                                               </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 375                                          String securityKrb5Conf) {                                                </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 376          if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 377              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 377              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378          }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 379          config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 380          config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 381          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 382          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style=""> 383                                                                                                                    </span>
<span  style=""> 384                                                                                                                    </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 385          if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 386              System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387          }                                                                                                         </span>
<span  style=""> 388                                                                                                                    </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 389          if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 390              String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 391              LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 392              System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394      }                                                                                                             </span>
<span  style=""> 395                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 396      @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 397      public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 398          return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 399                  &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 400                  &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 401                  &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 402                  &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 403                  &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 404                  &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 405                  &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 406                  &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                              </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 407                  &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                              </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 408                  &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409      }                                                                                                             </span>
<span  style=""> 410                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 411      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 412                                                                                                                    </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 413          private final HbaseOutputFormat format;                                                                   </span>
<span  style=""> 414                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 415          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 416              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417          }                                                                                                         </span>
<span  style=""> 418                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 419          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 420              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 421              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422          }                                                                                                         </span>
<span  style=""> 423                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 424          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 425              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 426              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427          }                                                                                                         </span>
<span  style=""> 428                                                                                                                    </span>
<span  style=""> 429                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 430          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 431              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 432              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433          }                                                                                                         </span>
<span  style=""> 434                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 435          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 436              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 437              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438          }                                                                                                         </span>
<span  style=""> 439                                                                                                                    </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 440          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 441              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 442              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443          }                                                                                                         </span>
<span  style=""> 444                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 445          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 446              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 447              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448          }                                                                                                         </span>
<span  style=""> 449                                                                                                                    </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 450          public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 451              format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 452              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453          }                                                                                                         </span>
<span  style=""> 454                                                                                                                    </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 455          public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 456              format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 457              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458          }                                                                                                         </span>
<span  style=""> 459                                                                                                                    </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 460          public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 461              format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 462              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463          }                                                                                                         </span>
<span  style=""> 464                                                                                                                    </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 465          public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 466              format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 467              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468          }                                                                                                         </span>
<span  style=""> 469                                                                                                                    </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 470          public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 471              format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 472              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473          }                                                                                                         </span>
<span  style=""> 474                                                                                                                    </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 475          public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 476              format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 477              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478          }                                                                                                         </span>
<span  style=""> 479                                                                                                                    </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 480          public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 481              format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 482              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483          }                                                                                                         </span>
<span  style=""> 484                                                                                                                    </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 485 +        public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {                      </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 486 +            format.dirtyDataManager = dirtyDataManager;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 487 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 488 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 489 +                                                                                                                  </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 490          public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                         </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 491              format.batchSize = batchSize;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 492              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493          }                                                                                                         </span>
<span  style=""> 494                                                                                                                    </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 495          public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                            </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 496              format.batchWaitInterval = batchWaitInterval;                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 497              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498          }                                                                                                         </span>
<span  style=""> 499                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 500          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 501              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 502              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 503              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 504              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 505                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 506              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 507              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 508                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 509              if (format.columnNameFamily != null) {                                                                </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 510                  List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());                        </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 511                  String[] columns = keyList.toArray(new String[0]);                                                </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 512                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 513                      String col = columns[i];                                                                      </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 514                      String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 515                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 516                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 519              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 520              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 521                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 522              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  21                                                                                                                    </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.dtstack.flink.sql.exception.ExceptionTrace;                                                            </span>

<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  23  import com.dtstack.flink.sql.factory.DTThreadFactory;                                                             </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  24  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  27  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  29  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  30  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  31  import org.apache.hadoop.hbase.AuthUtil;                                                                          </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  32  import org.apache.hadoop.hbase.ChoreService;                                                                      </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  33  import org.apache.hadoop.hbase.HBaseConfiguration;                                                                </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  34  import org.apache.hadoop.hbase.ScheduledChore;                                                                    </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  35  import org.apache.hadoop.hbase.TableName;                                                                         </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  36  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  37  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  38  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  39  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  40  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  41  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  42  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  43                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  44  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  45  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  46  import java.security.PrivilegedAction;                                                                            </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  47  import java.util.ArrayList;                                                                                       </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  48  import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  49  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  50  import java.util.Map;                                                                                             </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  51  import java.util.concurrent.ScheduledExecutorService;                                                             </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  52  import java.util.concurrent.ScheduledFuture;                                                                      </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  53  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  54  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  55                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  57   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  58   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59   */                                                                                                               </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  60  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                         </span>
<span  style="">  61                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  62      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  63      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  64      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  65      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  66      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  67      private String[] columnNames;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  68      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  69      private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  70      private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  71      private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  72      private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  73      private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  74      private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  75      private String clientKeytabFile;                                                                              </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  76      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  77      private String[] qualifiers;                                                                                  </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  78      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  79      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  80      private transient Table table;                                                                                </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  81      private transient ChoreService choreService;                                                                  </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  82      private transient List&lt;Row&gt; records;                                                                          </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  83      private transient volatile boolean closed = false;                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  84      /**                                                                                                           </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  85       * 批量写入的参数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  86       */                                                                                                           </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  87      private Integer batchSize;                                                                                    </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  88      private Long batchWaitInterval;                                                                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  89      /**                                                                                                           </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  90       * 定时任务                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  91       */                                                                                                           </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  92      private transient ScheduledExecutorService scheduler;                                                         </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  93      private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                         </span>
<span  style="">  94                                                                                                                    </span>





<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style="">  95      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96      }                                                                                                             </span>
<span  style="">  97                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style="">  98      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style="">  99          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100      }                                                                                                             </span>
<span  style=""> 101                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 102      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 103      public void configure(Configuration parameters) {                                                             </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 104          // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                             </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 105          // DO NOTHING                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106      }                                                                                                             </span>
<span  style=""> 107                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 108      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 109      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 110          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 111          records = new ArrayList&lt;&gt;();                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 112          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 113          openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 114          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 115          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 116          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117      }                                                                                                             </span>
<span  style=""> 118                                                                                                                    </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 119      private void openConn() {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 120          try {                                                                                                     </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 121              if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 122                  LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 123                  openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 124              } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 125                  LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 126                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 127                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 128                  conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 130          } catch (Exception e) {                                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 131              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132          }                                                                                                         </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 133          initScheduledTask(batchWaitInterval);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134      }                                                                                                             </span>
<span  style=""> 135                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 136      /**                                                                                                           </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 137       * 初始化定时写入任务                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 138       *                                                                                                            </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 139       * @param batchWaitInterval 定时任务时间                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 140       */                                                                                                           </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 141      private void initScheduledTask(Long batchWaitInterval) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 142          try {                                                                                                     </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 143              if (batchWaitInterval &gt; 0) {                                                                          </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 144                  this.scheduler = new ScheduledThreadPoolExecutor(                                                 </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 145                          1,                                                                                        </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 146                          new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                                </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 147                  );                                                                                                </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 149                  this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                                     </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 150                          () -&gt; {                                                                                   </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 151                              synchronized (HbaseOutputFormat.this) {                                               </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 152                                  if (!records.isEmpty()) {                                                         </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 153                                      dealBatchOperation(records);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                              }                                                                                     </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 156                          }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 157                  );                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 159          } catch (Exception e) {                                                                                   </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 160              LOG.error(&quot;init schedule task failed !&quot;);                                                             </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 161              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163      }                                                                                                             </span>
<span  style=""> 164                                                                                                                    </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 165      private void openKerberosConn() throws Exception {                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 166          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 167          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 169          LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                                     </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 170          Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""> 171          Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style=""> 172                                                                                                                    </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 173          fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style=""> 174                                                                                                                    </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 175          clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""> 176          clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style=""> 177                                                                                                                    </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 178          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 179          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style=""> 180                                                                                                                    </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 181          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 181          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clie🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 182          org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 183          conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 184              try {                                                                                                 </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 185                  ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                      </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 186                  if (authChore != null) {                                                                          </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 187                      choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                         </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 188                      choreService.scheduleChore(authChore);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                  }                                                                                                 </span>
<span  style=""> 190                                                                                                                    </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 191                  return ConnectionFactory.createConnection(finalConf);                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 192              } catch (IOException e) {                                                                             </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 193                  LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                       </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 194                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 196          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197      }                                                                                                             </span>
<span  style=""> 198                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 199      @Override                                                                                                     </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 200      public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                                        </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 201          if (record.f0) {                                                                                          </span>
<span class="8741474660790294795" onmouseenter="enter('8741474660790294795');" onmouseout="out('8741474660790294795');" style=""> 202              if (this.batchSize != 0) {                                                                            </span>

<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 203                  writeBatchRecord(record.f1);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 204              } else {                                                                                              </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 205                  dealInsert(record.f1);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208      }                                                                                                             </span>
<span  style=""> 209                                                                                                                    </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 210      public void writeBatchRecord(Row row) {                                                                       </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 211          records.add(row);                                                                                         </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 212          // 数据累计到batchSize之后开始处理                                                                                   </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 213          if (records.size() == this.batchSize) {                                                                   </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 214              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 218      protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                           </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 219          // A null in the result array means that the call for that action failed, even after retries.             </span>
<span class="-7898978178383061123" onmouseenter="enter('-7898978178383061123');" onmouseout="out('-7898978178383061123');" style=""> 220          Object[] results = new Object[records.size()];                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 221          try {                                                                                                     </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 222              List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                                   </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 223              for (Row record : records) {                                                                          </span>
<span class="4049132556821532406" onmouseenter="enter('4049132556821532406');" onmouseout="out('4049132556821532406');" style=""> 224                  puts.add(getPutByRow(record));                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225              }                                                                                                     </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 226              table.batch(puts, results);                                                                           </span>
<span  style=""> 227                                                                                                                    </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 228              // 打印结果                                                                                               </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 229              if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 230                  // 只打印最后一条数据                                                                                      </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 231                  LOG.info(records.get(records.size() - 1).toString());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232              }                                                                                                     </span>
<span class="-7907197852339825500" onmouseenter="enter('-7907197852339825500');" onmouseout="out('-7907197852339825500');" style=""> 233          } catch (IOException | InterruptedException ignored) {                                                    </span>


<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 234          } finally {                                                                                               </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 235              // 判断数据是否插入成功                                                                                         </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style=""> 236              for (int i = 0; i &lt; results.length; i++) {                                                            </span>
<span class="2819338636380693463" onmouseenter="enter('2819338636380693463');" onmouseout="out('2819338636380693463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 237 -                if (results[i] != null) {                                                                         </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +                if (results[i] instanceof Exception) {                                                            </span>
<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style=""> 239                      if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                                </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style=""> 240                          LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                               </span>
<span class="2359639359152997630" onmouseenter="enter('2359639359152997630');" onmouseout="out('2359639359152997630');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 241 -                        LOG.error(&quot;Error cause: &quot; + results[i]);                                                  </span>
<span class="191608650467857411" onmouseenter="enter('191608650467857411');" onmouseout="out('191608650467857411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +                        LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause((Exception) results[i]));   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243                      }                                                                                             </span>


<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style=""> 244                      // 脏数据记录                                                                                      </span>




<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 245                      outDirtyRecords.inc();                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 246                  } else {                                                                                          </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 247                      // 输出结果条数记录                                                                                   </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 248                      outRecords.inc();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250              }                                                                                                     </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 251              // 添加完数据之后数据清空records                                                                                 </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 252              records.clear();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254      }                                                                                                             </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 256      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 257          Put put = getPutByRow(record);                                                                            </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 258          if (put == null || put.isEmpty()) {                                                                       </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 259              // 记录脏数据                                                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 260              outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 261              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262          }                                                                                                         </span>
<span  style=""> 263                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 264          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 265              table.put(put);                                                                                       </span>



<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 266          } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 267              if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -                LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                        </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -                LOG.error(&quot;&quot;, e);                                                                                 </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +                LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                               </span>
<span class="5284749126956950965" onmouseenter="enter('5284749126956950965');" onmouseout="out('5284749126956950965');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause(e));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272              }                                                                                                     </span>



<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 273              outDirtyRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274          }                                                                                                         </span>
<span  style=""> 275                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 276          if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 277              LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278          }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 279          outRecords.inc();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280      }                                                                                                             </span>
<span  style=""> 281                                                                                                                    </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 282      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 283          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 284          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 285              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 287          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 288          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 289              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 290              if (fieldVal != null) {                                                                               </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 291                  byte[] val = fieldVal.toString().getBytes();                                                      </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 292                  byte[] cf = families[i].getBytes();                                                               </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 293                  byte[] qualifier = qualifiers[i].getBytes();                                                      </span>
<span  style=""> 294                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 295                  put.addColumn(cf, qualifier, val);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 298          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299      }                                                                                                             </span>
<span  style=""> 300                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 301      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 302          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 303          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 304          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 305              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 306              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 307              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 309          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310      }                                                                                                             </span>
<span  style=""> 311                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 312      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 313          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 314          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 315          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 316          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317      }                                                                                                             </span>
<span  style=""> 318                                                                                                                    </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 319      private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                                       </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 320          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 321          for (int i = 0; i &lt; columnNames.length; i++) {                                                            </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 322              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 324          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325      }                                                                                                             </span>
<span  style=""> 326                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 327      @Override                                                                                                     </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 328      public synchronized void close() throws IOException {                                                         </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 329          if (closed) {                                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 330              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331          }                                                                                                         </span>
<span  style=""> 332                                                                                                                    </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 333          closed = true;                                                                                            </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 334          if (!records.isEmpty()) {                                                                                 </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 335              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336          }                                                                                                         </span>
<span  style=""> 337                                                                                                                    </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 338          if (scheduledFuture != null) {                                                                            </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 339              scheduledFuture.cancel(false);                                                                        </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 340              if (scheduler != null) {                                                                              </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 341                  scheduler.shutdownNow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343          }                                                                                                         </span>
<span  style=""> 344                                                                                                                    </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 345          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 346              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 347              conn = null;                                                                                          </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349      }                                                                                                             </span>
<span  style=""> 350                                                                                                                    </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 351      private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                              </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 352                                          String regionserverPrincipal,                                             </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 353                                          String zookeeperSaslClient,                                               </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 354                                          String securityKrb5Conf) {                                                </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 355          if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 356              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 356              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357          }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 358          config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 359          config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 360          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 361          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style=""> 362                                                                                                                    </span>
<span  style=""> 363                                                                                                                    </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 364          if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 365              System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366          }                                                                                                         </span>
<span  style=""> 367                                                                                                                    </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 368          if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 369              String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 370              LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 371              System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373      }                                                                                                             </span>
<span  style=""> 374                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 375      @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 376      public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 377          return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 378                  &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 379                  &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 380                  &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 381                  &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 382                  &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 383                  &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 384                  &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 385                  &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                              </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 386                  &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                              </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 387                  &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388      }                                                                                                             </span>
<span  style=""> 389                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 390      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 391                                                                                                                    </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 392          private final HbaseOutputFormat format;                                                                   </span>
<span  style=""> 393                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 394          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 395              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396          }                                                                                                         </span>
<span  style=""> 397                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 398          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 399              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 400              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401          }                                                                                                         </span>
<span  style=""> 402                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 403          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 404              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 405              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406          }                                                                                                         </span>
<span  style=""> 407                                                                                                                    </span>
<span  style=""> 408                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 409          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 410              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 411              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412          }                                                                                                         </span>
<span  style=""> 413                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 414          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 415              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 416              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417          }                                                                                                         </span>
<span  style=""> 418                                                                                                                    </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 419          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 420              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 421              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422          }                                                                                                         </span>
<span  style=""> 423                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 424          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 425              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 426              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427          }                                                                                                         </span>
<span  style=""> 428                                                                                                                    </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 429          public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 430              format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 431              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432          }                                                                                                         </span>
<span  style=""> 433                                                                                                                    </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 434          public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 435              format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 436              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437          }                                                                                                         </span>
<span  style=""> 438                                                                                                                    </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 439          public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 440              format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 441              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442          }                                                                                                         </span>
<span  style=""> 443                                                                                                                    </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 444          public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 445              format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 446              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447          }                                                                                                         </span>
<span  style=""> 448                                                                                                                    </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 449          public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 450              format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 451              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452          }                                                                                                         </span>
<span  style=""> 453                                                                                                                    </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 454          public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 455              format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 456              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457          }                                                                                                         </span>
<span  style=""> 458                                                                                                                    </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 459          public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 460              format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 461              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462          }                                                                                                         </span>
<span  style=""> 463                                                                                                                    </span>





<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 464          public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                         </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 465              format.batchSize = batchSize;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 466              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467          }                                                                                                         </span>
<span  style=""> 468                                                                                                                    </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 469          public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                            </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 470              format.batchWaitInterval = batchWaitInterval;                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 471              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472          }                                                                                                         </span>
<span  style=""> 473                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 474          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 475              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 476              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 477              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 478              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 479                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 480              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 481              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 482                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 483              if (format.columnNameFamily != null) {                                                                </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 484                  List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());                        </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 485                  String[] columns = keyList.toArray(new String[0]);                                                </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 486                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 487                      String col = columns[i];                                                                      </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 488                      String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 489                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 490                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 493              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 494              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 495                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 496              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            