<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>439</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    439
                    <a href="438.html">prev</a>
                    <a href="440.html">next</a>
                    <a href="439_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_cb68efb9e51ba697e771581059b9c11c3fe66ccb_core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;cb68efb9e51ba697e771581059b9c11c3fe66ccb:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;cb68efb9e51ba697e771581059b9c11c3fe66ccb^1:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;cb68efb9e51ba697e771581059b9c11c3fe66ccb^2:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;828062ef514a8028632086b1c19ef248140da519:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  20 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  21                                                                                                          </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  22 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  23 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  24 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  25 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  26 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  27 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  29 import org.apache.calcite.sql.SqlMatchRecognize;                                                         </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  30 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  31 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  32 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  33 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  35 import com.google.common.collect.Lists;                                                                  </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="">  36 import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                          </span>
<span  style="">  37                                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38 import java.util.List;                                                                                   </span>
<span  style="">  39                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  40 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  41                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42 /**                                                                                                      </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  43  * 解析flink sql                                                                                           </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  44  * sql 只支持 insert 开头的                                                                                    </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  45  * Date: 2018/6/22                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  46  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  47  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48  */                                                                                                      </span>
<span  style="">  49                                                                                                          </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  50 public class InsertSqlParser implements IParser {                                                        </span>
<span  style="">  51                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  52 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  54 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     public boolean verify(String sql) {                                                                  </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  57 =======                                                                                                  </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59     private static Boolean parentIsInsert = false;                                                       </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  60 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style="">  61                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  62     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  63     public boolean verify(String sql) {                                                                  </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  64         return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65     }                                                                                                    </span>
<span  style="">  66                                                                                                          </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  67     public static InsertSqlParser newInstance(){                                                         </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  68         InsertSqlParser parser = new InsertSqlParser();                                                  </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  69         return parser;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70     }                                                                                                    </span>
<span  style="">  71                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72     @Override                                                                                            </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="">  73     public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                 </span>
<span  style="">  74                                                                                                          </span>
<span  style="">  75                                                                                                          </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="">  76         SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                           </span>
<span  style="">  77                                                                                                          </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  78         SqlParseResult sqlParseResult = new SqlParseResult();                                            </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  79         parseNode(sqlNode, sqlParseResult);                                                              </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  80         sqlParseResult.setExecSql(sqlNode.toString());                                                   </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  81         sqlTree.addExecSql(sqlParseResult);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82     }                                                                                                    </span>
<span  style="">  83                                                                                                          </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  84     private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  85         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  86         switch (sqlKind){                                                                                </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  87             case INSERT:                                                                                 </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  88                 SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                               </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  89                 SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                    </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  90                 sqlParseResult.addTargetTable(sqlTarget.toString());                                     </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="">  91                 parentIsInsert = true;                                                                   </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  92                 parseNode(sqlSource, sqlParseResult);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  93                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  94             case SELECT:                                                                                 </span>
<span class="-6587445636759965572" onmouseenter="enter('-6587445636759965572');" onmouseout="out('-6587445636759965572');" style="">  95                 SqlSelect sqlSelect = (SqlSelect) sqlNode;                                               </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="">  96                 if (parentIsInsert) {                                                                    </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="">  97                     rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98                 }                                                                                        </span>
<span class="-4229800989062838511" onmouseenter="enter('-4229800989062838511');" onmouseout="out('-4229800989062838511');" style="">  99                 SqlNode sqlFrom = ((SqlSelect) sqlNode).getFrom();                                       </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style=""> 100                 if (sqlFrom.getKind() == IDENTIFIER) {                                                   </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style=""> 101                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 102                 } else {                                                                                 </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style=""> 103                     parentIsInsert = false;                                                              </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 104                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 106                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 107             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 108                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 109                 SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                       </span>
<span  style=""> 110                                                                                                          </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 111                 if(leftNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 112                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 113                 }else{                                                                                   </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 114                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115                 }                                                                                        </span>
<span  style=""> 116                                                                                                          </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 117                 if(rightNode.getKind() == IDENTIFIER){                                                   </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 118                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 119                 }else{                                                                                   </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 120                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 122                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 123             case AS:                                                                                     </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 124                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 125                 SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                       </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 126                 if(identifierNode.getKind() != IDENTIFIER){                                              </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 127                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 128                 }else {                                                                                  </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 129                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 131                 break;                                                                                   </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 132             case MATCH_RECOGNIZE:                                                                        </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 133                 SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                    </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 134                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 135                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 136             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 137                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 138                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 139                 if(unionLeft.getKind() == IDENTIFIER){                                                   </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 140                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 141                 }else{                                                                                   </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 142                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 144                 if(unionRight.getKind() == IDENTIFIER){                                                  </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 145                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 146                 }else{                                                                                   </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 147                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 149                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 150             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 151                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 152                 parseNode(sqlOrderBy.query, sqlParseResult);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 153                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 154             default:                                                                                     </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 155                 //do nothing                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 156                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158     }                                                                                                    </span>
<span  style=""> 159                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 160     /**                                                                                                  </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style=""> 161      * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                       </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style=""> 162      * 仅对 table.xx 这种类型的字段进行替换                                                                           </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style=""> 163      * @param selectList select Node 的 select 字段                                                         </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style=""> 164      * @param sqlSelect 第一层解析出来的 selectNode                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 165      */                                                                                                  </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style=""> 166     private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                 </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style=""> 167         SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                          </span>
<span  style=""> 168                                                                                                          </span>
<span class="343879600078305884" onmouseenter="enter('343879600078305884');" onmouseout="out('343879600078305884');" style=""> 169         for (int index = 0; index &lt; selectList.size(); index++) {                                        </span>
<span class="-1256655832574901737" onmouseenter="enter('-1256655832574901737');" onmouseout="out('-1256655832574901737');" style=""> 170             if (selectList.get(index).getKind().equals(SqlKind.AS)                                       </span>
<span class="-4245735002242502625" onmouseenter="enter('-4245735002242502625');" onmouseout="out('-4245735002242502625');" style=""> 171                     || ((SqlIdentifier) selectList.get(index)).names.size() == 1) {                      </span>
<span class="-5529344336821821070" onmouseenter="enter('-5529344336821821070');" onmouseout="out('-5529344336821821070');" style=""> 172                 sqlNodes.add(selectList.get(index));                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 173                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174             }                                                                                            </span>
<span class="7050887275215492486" onmouseenter="enter('7050887275215492486');" onmouseout="out('7050887275215492486');" style=""> 175             sqlNodes.add(transformToAsNode(selectList.get(index)));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176         }                                                                                                </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style=""> 177         sqlSelect.setSelectList(sqlNodes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178     }                                                                                                    </span>
<span  style=""> 179                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 180     /**                                                                                                  </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style=""> 181      * 将 sqlNode 转化为 AsNode                                                                              </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style=""> 182      * @param sqlNode 需要转化的 sqlNode                                                                      </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style=""> 183      * @return 重新构造的 AsNode                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 184      */                                                                                                  </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style=""> 185     public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                      </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style=""> 186         String asName = &quot;&quot;;                                                                              </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style=""> 187         SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                    </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style=""> 188                                             sqlNode.getParserPosition().getEndColumnNum());              </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style=""> 189         if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                              </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style=""> 190             asName = ((SqlIdentifier) sqlNode).names.get(1);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191         }                                                                                                </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 192         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style=""> 193         operands[0] = sqlNode;                                                                           </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style=""> 194         operands[1] = new SqlIdentifier(asName, null, pos);                                              </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style=""> 195         return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span  style=""> 197                                                                                                          </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 198     public static class SqlParseResult {                                                                 </span>
<span  style=""> 199                                                                                                          </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 200         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 201                                                                                                          </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 202         private List&lt;String&gt; targetTableList = Lists.newArrayList();                                     </span>
<span  style=""> 203                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 204         private String execSql;                                                                          </span>
<span  style=""> 205                                                                                                          </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 206         public void addSourceTable(String sourceTable){                                                  </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 207             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208         }                                                                                                </span>
<span  style=""> 209                                                                                                          </span>
<span class="2239855044100079830" onmouseenter="enter('2239855044100079830');" onmouseout="out('2239855044100079830');" style=""> 210         public void addTargetTable(String targetTable){                                                  </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 211             targetTableList.add(targetTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212         }                                                                                                </span>
<span  style=""> 213                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 214         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 215             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216         }                                                                                                </span>
<span  style=""> 217                                                                                                          </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 218         public List&lt;String&gt; getTargetTableList() {                                                       </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 219             return targetTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span  style=""> 221                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 222         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 223             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224         }                                                                                                </span>
<span  style=""> 225                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 226         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 227             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  21 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  22                                                                                                          </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  23 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  24 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  25 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  26 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  27 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  28 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  29 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  30 import org.apache.calcite.sql.SqlMatchRecognize;                                                         </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  31 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  32 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  33 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  34 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  35 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  36 import com.google.common.collect.Lists;                                                                  </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="">  37 import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  39 import java.util.List;                                                                                   </span>
<span  style="">  40                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  41 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  42                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43 /**                                                                                                      </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  44  * 解析flink sql                                                                                           </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  45  * sql 只支持 insert 开头的                                                                                    </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  46  * Date: 2018/6/22                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  47  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  48  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49  */                                                                                                      </span>
<span  style="">  50                                                                                                          </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  51 public class InsertSqlParser implements IParser {                                                        </span>
<span  style="">  52                                                                                                          </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  53     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  54                                                                                                          </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  55     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="">  56     private static Boolean parentIsInsert = false;                                                       </span>
<span  style="">  57                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  58     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  59     public boolean verify(String sql) {                                                                  </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  60         return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61     }                                                                                                    </span>
<span  style="">  62                                                                                                          </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  63     public static InsertSqlParser newInstance(){                                                         </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  64         InsertSqlParser parser = new InsertSqlParser();                                                  </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  65         return parser;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66     }                                                                                                    </span>
<span  style="">  67                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  68     @Override                                                                                            </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="">  69     public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                 </span>
<span  style="">  70                                                                                                          </span>
<span  style="">  71                                                                                                          </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="">  72         SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                           </span>
<span  style="">  73                                                                                                          </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  74         SqlParseResult sqlParseResult = new SqlParseResult();                                            </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  75         parseNode(sqlNode, sqlParseResult);                                                              </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  76         sqlParseResult.setExecSql(sqlNode.toString());                                                   </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  77         sqlTree.addExecSql(sqlParseResult);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78     }                                                                                                    </span>
<span  style="">  79                                                                                                          </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  80     private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  81         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  82         switch (sqlKind){                                                                                </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  83             case INSERT:                                                                                 </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  84                 SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                               </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  85                 SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                    </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  86                 sqlParseResult.addTargetTable(sqlTarget.toString());                                     </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="">  87                 parentIsInsert = true;                                                                   </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  88                 parseNode(sqlSource, sqlParseResult);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  89                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  90             case SELECT:                                                                                 </span>
<span class="-6587445636759965572" onmouseenter="enter('-6587445636759965572');" onmouseout="out('-6587445636759965572');" style="">  91                 SqlSelect sqlSelect = (SqlSelect) sqlNode;                                               </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="">  92                 if (parentIsInsert) {                                                                    </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="">  93                     rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94                 }                                                                                        </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style="">  95                 SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                        </span>
<span class="1877498908128044563" onmouseenter="enter('1877498908128044563');" onmouseout="out('1877498908128044563');" style="">  96                 if(sqlFrom.getKind() == IDENTIFIER){                                                     </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style="">  97                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="">  98                 }else{                                                                                   </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style="">  99                     parentIsInsert = false;                                                              </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 100                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 102                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 103             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 104                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 105                 SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                       </span>
<span  style=""> 106                                                                                                          </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 107                 if(leftNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 108                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 109                 }else{                                                                                   </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 110                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111                 }                                                                                        </span>
<span  style=""> 112                                                                                                          </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 113                 if(rightNode.getKind() == IDENTIFIER){                                                   </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 114                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 115                 }else{                                                                                   </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 116                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 118                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 119             case AS:                                                                                     </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 120                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 121                 SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                       </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 122                 if(identifierNode.getKind() != IDENTIFIER){                                              </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 123                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 124                 }else {                                                                                  </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 125                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 127                 break;                                                                                   </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 128             case MATCH_RECOGNIZE:                                                                        </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 129                 SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                    </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 130                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 131                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 132             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 133                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 134                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 135                 if(unionLeft.getKind() == IDENTIFIER){                                                   </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 136                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 137                 }else{                                                                                   </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 138                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                 }                                                                                        </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 140                 if(unionRight.getKind() == IDENTIFIER){                                                  </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 141                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 142                 }else{                                                                                   </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 143                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 145                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 146             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 147                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 148                 parseNode(sqlOrderBy.query, sqlParseResult);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 149                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 150             default:                                                                                     </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 151                 //do nothing                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 152                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 156     /**                                                                                                  </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style=""> 157      * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                       </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style=""> 158      * 仅对 table.xx 这种类型的字段进行替换                                                                           </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style=""> 159      * @param selectList select Node 的 select 字段                                                         </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style=""> 160      * @param sqlSelect 第一层解析出来的 selectNode                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 161      */                                                                                                  </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style=""> 162     private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                 </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style=""> 163         SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                          </span>
<span  style=""> 164                                                                                                          </span>
<span class="343879600078305884" onmouseenter="enter('343879600078305884');" onmouseout="out('343879600078305884');" style=""> 165         for (int index = 0; index &lt; selectList.size(); index++) {                                        </span>
<span class="-1256655832574901737" onmouseenter="enter('-1256655832574901737');" onmouseout="out('-1256655832574901737');" style=""> 166             if (selectList.get(index).getKind().equals(SqlKind.AS)                                       </span>
<span class="-4245735002242502625" onmouseenter="enter('-4245735002242502625');" onmouseout="out('-4245735002242502625');" style=""> 167                     || ((SqlIdentifier) selectList.get(index)).names.size() == 1) {                      </span>
<span class="-5529344336821821070" onmouseenter="enter('-5529344336821821070');" onmouseout="out('-5529344336821821070');" style=""> 168                 sqlNodes.add(selectList.get(index));                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 169                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170             }                                                                                            </span>
<span class="7050887275215492486" onmouseenter="enter('7050887275215492486');" onmouseout="out('7050887275215492486');" style=""> 171             sqlNodes.add(transformToAsNode(selectList.get(index)));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172         }                                                                                                </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style=""> 173         sqlSelect.setSelectList(sqlNodes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174     }                                                                                                    </span>
<span  style=""> 175                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 176     /**                                                                                                  </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style=""> 177      * 将 sqlNode 转化为 AsNode                                                                              </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style=""> 178      * @param sqlNode 需要转化的 sqlNode                                                                      </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style=""> 179      * @return 重新构造的 AsNode                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 180      */                                                                                                  </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style=""> 181     public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                      </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style=""> 182         String asName = &quot;&quot;;                                                                              </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style=""> 183         SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                    </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style=""> 184                                             sqlNode.getParserPosition().getEndColumnNum());              </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style=""> 185         if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                              </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style=""> 186             asName = ((SqlIdentifier) sqlNode).names.get(1);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187         }                                                                                                </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 188         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style=""> 189         operands[0] = sqlNode;                                                                           </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style=""> 190         operands[1] = new SqlIdentifier(asName, null, pos);                                              </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style=""> 191         return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192     }                                                                                                    </span>
<span  style=""> 193                                                                                                          </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 194     public static class SqlParseResult {                                                                 </span>
<span  style=""> 195                                                                                                          </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 196         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 197                                                                                                          </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 198         private List&lt;String&gt; targetTableList = Lists.newArrayList();                                     </span>
<span  style=""> 199                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 200         private String execSql;                                                                          </span>
<span  style=""> 201                                                                                                          </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 202         public void addSourceTable(String sourceTable){                                                  </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 203             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204         }                                                                                                </span>
<span  style=""> 205                                                                                                          </span>
<span class="2239855044100079830" onmouseenter="enter('2239855044100079830');" onmouseout="out('2239855044100079830');" style=""> 206         public void addTargetTable(String targetTable){                                                  </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 207             targetTableList.add(targetTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208         }                                                                                                </span>
<span  style=""> 209                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 210         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 211             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212         }                                                                                                </span>
<span  style=""> 213                                                                                                          </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 214         public List&lt;String&gt; getTargetTableList() {                                                       </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 215             return targetTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216         }                                                                                                </span>
<span  style=""> 217                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 218         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 219             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span  style=""> 221                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 222         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 223             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226 }                                                                                                        </span>


</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  18 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  19                                                                                                          </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  20 import com.google.common.collect.Lists;                                                                  </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  21 import java.util.List;                                                                                   </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  22 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  23 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  24 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  25 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  26 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  27 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  28 import org.apache.calcite.sql.SqlMatchRecognize;                                                         </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  29 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  30 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  31 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  32 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  33 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="">  35 import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  36 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  37                                                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  39 /**                                                                                                      </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  40  * 解析flink sql                                                                                           </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  41  * sql 只支持 insert 开头的                                                                                    </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  42  * Date: 2018/6/22                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  43  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  44  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  45  */                                                                                                      </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  46 public class InsertSqlParser implements IParser {                                                        </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  47     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  48                                                                                                          </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  49     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  50     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="">  51     private static Boolean parentIsInsert = false;                                                       </span>
<span  style="">  52                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  53     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  54     public boolean verify(String sql) {                                                                  </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  55         return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56     }                                                                                                    </span>
<span  style="">  57                                                                                                          </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  58     public static InsertSqlParser newInstance(){                                                         </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  59         InsertSqlParser parser = new InsertSqlParser();                                                  </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  60         return parser;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61     }                                                                                                    </span>
<span  style="">  62                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  63     @Override                                                                                            </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="">  64     public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                 </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="">  65         SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                           </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  66         SqlParseResult sqlParseResult = new SqlParseResult();                                            </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  67         parseNode(sqlNode, sqlParseResult);                                                              </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  68         sqlParseResult.setExecSql(sqlNode.toString());                                                   </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  69         sqlTree.addExecSql(sqlParseResult);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70     }                                                                                                    </span>
<span  style="">  71                                                                                                          </span>
<span class="3654677151739835793" onmouseenter="enter('3654677151739835793');" onmouseout="out('3654677151739835793');" style="">  72     private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult) {                      </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  73         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style="">  74         switch (sqlKind) {                                                                               </span>
<span class="-3229205352829537061" onmouseenter="enter('-3229205352829537061');" onmouseout="out('-3229205352829537061');" style="">  75             case INSERT :                                                                                </span>
<span class="-4408047239025759532" onmouseenter="enter('-4408047239025759532');" onmouseout="out('-4408047239025759532');" style="">  76                 SqlNode sqlTarget = ((SqlInsert) (sqlNode)).getTargetTable();                            </span>
<span class="4923379117766569884" onmouseenter="enter('4923379117766569884');" onmouseout="out('4923379117766569884');" style="">  77                 SqlNode sqlSource = ((SqlInsert) (sqlNode)).getSource();                                 </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  78                 sqlParseResult.addTargetTable(sqlTarget.toString());                                     </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="">  79                 parentIsInsert = true;                                                                   </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  80                 parseNode(sqlSource, sqlParseResult);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  81                 break;                                                                                   </span>
<span class="-3198951126756304146" onmouseenter="enter('-3198951126756304146');" onmouseout="out('-3198951126756304146');" style="">  82             case SELECT :                                                                                </span>
<span class="6756734206692677194" onmouseenter="enter('6756734206692677194');" onmouseout="out('6756734206692677194');" style="">  83                 SqlSelect sqlSelect = ((SqlSelect) (sqlNode));                                           </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="">  84                 if (parentIsInsert) {                                                                    </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="">  85                     rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86                 }                                                                                        </span>
<span class="-1459310299914917625" onmouseenter="enter('-1459310299914917625');" onmouseout="out('-1459310299914917625');" style="">  87                 SqlNode sqlFrom = ((SqlSelect) (sqlNode)).getFrom();                                     </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style="">  88                 if (sqlFrom.getKind() == IDENTIFIER) {                                                   </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style="">  89                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  90                 } else {                                                                                 </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style="">  91                     parentIsInsert = false;                                                              </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style="">  92                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  94                 break;                                                                                   </span>
<span class="-6812790603264225102" onmouseenter="enter('-6812790603264225102');" onmouseout="out('-6812790603264225102');" style="">  95             case JOIN :                                                                                  </span>
<span class="-4395251305376668835" onmouseenter="enter('-4395251305376668835');" onmouseout="out('-4395251305376668835');" style="">  96                 SqlNode leftNode = ((SqlJoin) (sqlNode)).getLeft();                                      </span>
<span class="8050631472929284299" onmouseenter="enter('8050631472929284299');" onmouseout="out('8050631472929284299');" style="">  97                 SqlNode rightNode = ((SqlJoin) (sqlNode)).getRight();                                    </span>
<span class="-7068116128484836160" onmouseenter="enter('-7068116128484836160');" onmouseout="out('-7068116128484836160');" style="">  98                 if (leftNode.getKind() == IDENTIFIER) {                                                  </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style="">  99                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 100                 } else {                                                                                 </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 101                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102                 }                                                                                        </span>
<span class="3756007340939565225" onmouseenter="enter('3756007340939565225');" onmouseout="out('3756007340939565225');" style=""> 103                 if (rightNode.getKind() == IDENTIFIER) {                                                 </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 104                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 105                 } else {                                                                                 </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 106                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 108                 break;                                                                                   </span>
<span class="-7603101237578294688" onmouseenter="enter('-7603101237578294688');" onmouseout="out('-7603101237578294688');" style=""> 109             case AS :                                                                                    </span>
<span class="-2592138503817003871" onmouseenter="enter('-2592138503817003871');" onmouseout="out('-2592138503817003871');" style=""> 110                 // 不解析column,所以 as 相关的都是表                                                                </span>
<span class="-570332885351525475" onmouseenter="enter('-570332885351525475');" onmouseout="out('-570332885351525475');" style=""> 111                 SqlNode identifierNode = ((SqlBasicCall) (sqlNode)).getOperands()[0];                    </span>
<span class="-4220098490622996269" onmouseenter="enter('-4220098490622996269');" onmouseout="out('-4220098490622996269');" style=""> 112                 if (identifierNode.getKind() != IDENTIFIER) {                                            </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 113                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 114                 } else {                                                                                 </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 115                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 117                 break;                                                                                   </span>
<span class="4847728785269382503" onmouseenter="enter('4847728785269382503');" onmouseout="out('4847728785269382503');" style=""> 118             case MATCH_RECOGNIZE :                                                                       </span>
<span class="6938719457719113840" onmouseenter="enter('6938719457719113840');" onmouseout="out('6938719457719113840');" style=""> 119                 SqlMatchRecognize node = ((SqlMatchRecognize) (sqlNode));                                </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 120                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 121                 break;                                                                                   </span>
<span class="1238941309895419592" onmouseenter="enter('1238941309895419592');" onmouseout="out('1238941309895419592');" style=""> 122             case UNION :                                                                                 </span>
<span class="3847221911167009847" onmouseenter="enter('3847221911167009847');" onmouseout="out('3847221911167009847');" style=""> 123                 SqlNode unionLeft = ((SqlBasicCall) (sqlNode)).getOperands()[0];                         </span>
<span class="-4021192438573809697" onmouseenter="enter('-4021192438573809697');" onmouseout="out('-4021192438573809697');" style=""> 124                 SqlNode unionRight = ((SqlBasicCall) (sqlNode)).getOperands()[1];                        </span>
<span class="1880013034228131218" onmouseenter="enter('1880013034228131218');" onmouseout="out('1880013034228131218');" style=""> 125                 if (unionLeft.getKind() == IDENTIFIER) {                                                 </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 126                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 127                 } else {                                                                                 </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 128                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129                 }                                                                                        </span>
<span class="25238980504787842" onmouseenter="enter('25238980504787842');" onmouseout="out('25238980504787842');" style=""> 130                 if (unionRight.getKind() == IDENTIFIER) {                                                </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 131                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 132                 } else {                                                                                 </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 133                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 135                 break;                                                                                   </span>
<span class="9103487536272409028" onmouseenter="enter('9103487536272409028');" onmouseout="out('9103487536272409028');" style=""> 136             case ORDER_BY :                                                                              </span>
<span class="-6096761147743361957" onmouseenter="enter('-6096761147743361957');" onmouseout="out('-6096761147743361957');" style=""> 137                 SqlOrderBy sqlOrderBy = ((SqlOrderBy) (sqlNode));                                        </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 138                 parseNode(sqlOrderBy.query, sqlParseResult);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 139                 break;                                                                                   </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 140             default :                                                                                    </span>
<span class="-6802310387761368139" onmouseenter="enter('-6802310387761368139');" onmouseout="out('-6802310387761368139');" style=""> 141                 // do nothing                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 142                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144     }                                                                                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 146     /**                                                                                                  </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style=""> 147      * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                       </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style=""> 148      * 仅对 table.xx 这种类型的字段进行替换                                                                           </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style=""> 149      * @param selectList select Node 的 select 字段                                                         </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style=""> 150      * @param sqlSelect 第一层解析出来的 selectNode                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 151      */                                                                                                  </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style=""> 152     private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                 </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style=""> 153         SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                          </span>
<span  style=""> 154                                                                                                          </span>
<span class="343879600078305884" onmouseenter="enter('343879600078305884');" onmouseout="out('343879600078305884');" style=""> 155         for (int index = 0; index &lt; selectList.size(); index++) {                                        </span>
<span class="-1256655832574901737" onmouseenter="enter('-1256655832574901737');" onmouseout="out('-1256655832574901737');" style=""> 156             if (selectList.get(index).getKind().equals(SqlKind.AS)                                       </span>
<span class="-4245735002242502625" onmouseenter="enter('-4245735002242502625');" onmouseout="out('-4245735002242502625');" style=""> 157                     || ((SqlIdentifier) selectList.get(index)).names.size() == 1) {                      </span>
<span class="-5529344336821821070" onmouseenter="enter('-5529344336821821070');" onmouseout="out('-5529344336821821070');" style=""> 158                 sqlNodes.add(selectList.get(index));                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 159                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160             }                                                                                            </span>
<span class="7050887275215492486" onmouseenter="enter('7050887275215492486');" onmouseout="out('7050887275215492486');" style=""> 161             sqlNodes.add(transformToAsNode(selectList.get(index)));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style=""> 163         sqlSelect.setSelectList(sqlNodes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164     }                                                                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 166     /**                                                                                                  </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style=""> 167      * 将 sqlNode 转化为 AsNode                                                                              </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style=""> 168      * @param sqlNode 需要转化的 sqlNode                                                                      </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style=""> 169      * @return 重新构造的 AsNode                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 170      */                                                                                                  </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style=""> 171     public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                      </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style=""> 172         String asName = &quot;&quot;;                                                                              </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style=""> 173         SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                    </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style=""> 174                                             sqlNode.getParserPosition().getEndColumnNum());              </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style=""> 175         if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                              </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style=""> 176             asName = ((SqlIdentifier) sqlNode).names.get(1);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177         }                                                                                                </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 178         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style=""> 179         operands[0] = sqlNode;                                                                           </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style=""> 180         operands[1] = new SqlIdentifier(asName, null, pos);                                              </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style=""> 181         return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182     }                                                                                                    </span>
<span  style=""> 183                                                                                                          </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 184     public static class SqlParseResult {                                                                 </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 185         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 186                                                                                                          </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 187         private List&lt;String&gt; targetTableList = Lists.newArrayList();                                     </span>
<span  style=""> 188                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 189         private String execSql;                                                                          </span>
<span  style=""> 190                                                                                                          </span>
<span class="-2198483008967905672" onmouseenter="enter('-2198483008967905672');" onmouseout="out('-2198483008967905672');" style=""> 191         public void addSourceTable(String sourceTable) {                                                 </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 192             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193         }                                                                                                </span>
<span  style=""> 194                                                                                                          </span>
<span class="7318825121337911992" onmouseenter="enter('7318825121337911992');" onmouseout="out('7318825121337911992');" style=""> 195         public void addTargetTable(String targetTable) {                                                 </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 196             targetTableList.add(targetTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197         }                                                                                                </span>
<span  style=""> 198                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 199         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 200             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201         }                                                                                                </span>
<span  style=""> 202                                                                                                          </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 203         public List&lt;String&gt; getTargetTableList() {                                                       </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 204             return targetTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205         }                                                                                                </span>
<span  style=""> 206                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 207         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 208             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209         }                                                                                                </span>
<span  style=""> 210                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 211         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 212             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215 }                                                                                                        </span>













</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  21  package com.dtstack.flink.sql.parser;                                                                             </span>
<span  style="">  22                                                                                                                    </span>
<span class="-2084905850329493825" onmouseenter="enter('-2084905850329493825');" onmouseout="out('-2084905850329493825');" style="">  23  import org.apache.calcite.config.Lex;                                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  24  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  25  import org.apache.calcite.sql.SqlInsert;                                                                          </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  26  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  27  import org.apache.calcite.sql.SqlKind;                                                                            </span>




<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  28  import org.apache.calcite.sql.SqlMatchRecognize;                                                                  </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  29  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  30  import org.apache.calcite.sql.SqlOrderBy;                                                                         </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  31  import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  32  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="1277226550340008522" onmouseenter="enter('1277226550340008522');" onmouseout="out('1277226550340008522');" style="">  33  import org.apache.calcite.sql.parser.SqlParser;                                                                   </span>



<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  35  import com.google.common.collect.Lists;                                                                           </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                           </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                                   </span>
<span  style="">  38                                                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  39  import java.util.List;                                                                                            </span>
<span  style="">  40                                                                                                                    </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  41  import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                          </span>
<span  style="">  42                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43  /**                                                                                                               </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  44   * 解析flink sql                                                                                                    </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  45   * sql 只支持 insert 开头的                                                                                             </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  46   * Date: 2018/6/22                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  47   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  48   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49   */                                                                                                               </span>
<span  style="">  50                                                                                                                    </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  51  public class InsertSqlParser implements IParser {                                                                 </span>
<span  style="">  52                                                                                                                    </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +    private FlinkPlanner flinkPlanner = new FlinkPlanner();                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +                                                                                                                  </span>

<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55      @Override                                                                                                     </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  56      public boolean verify(String sql) {                                                                           </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  57          return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58      }                                                                                                             </span>
<span  style="">  59                                                                                                                    </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  60      public static InsertSqlParser newInstance(){                                                                  </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  61          InsertSqlParser parser = new InsertSqlParser();                                                           </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  62          return parser;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63      }                                                                                                             </span>
<span  style="">  64                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  65      @Override                                                                                                     </span>
<span class="2434475561113814770" onmouseenter="enter('2434475561113814770');" onmouseout="out('2434475561113814770');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  66 -    public void parseSql(String sql, SqlTree sqlTree) {                                                           </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +    public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                          </span>
<span  style="">  68                                                                                                                    </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -        FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                           </span>
<span class="1851740432007864849" onmouseenter="enter('1851740432007864849');" onmouseout="out('1851740432007864849');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -        SqlNode sqlNode = flinkPlanner.parse(sql);                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +                                                                                                                  </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +        SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                                    </span>
<span  style="">  73                                                                                                                    </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  74          SqlParseResult sqlParseResult = new SqlParseResult();                                                     </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  75          parseNode(sqlNode, sqlParseResult);                                                                       </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  76          sqlParseResult.setExecSql(sqlNode.toString());                                                            </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  77          sqlTree.addExecSql(sqlParseResult);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78      }                                                                                                             </span>
<span  style="">  79                                                                                                                    </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  80      private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                                </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  81          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  82          switch (sqlKind){                                                                                         </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  83              case INSERT:                                                                                          </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  84                  SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                                        </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  85                  SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                             </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  86                  sqlParseResult.addTargetTable(sqlTarget.toString());                                              </span>

<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  87                  parseNode(sqlSource, sqlParseResult);                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  88                  break;                                                                                            </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  89              case SELECT:                                                                                          </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style="">  90                  SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                                 </span>
<span class="1877498908128044563" onmouseenter="enter('1877498908128044563');" onmouseout="out('1877498908128044563');" style="">  91                  if(sqlFrom.getKind() == IDENTIFIER){                                                              </span>






<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style="">  92                      sqlParseResult.addSourceTable(sqlFrom.toString());                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="">  93                  }else{                                                                                            </span>


<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style="">  94                      parseNode(sqlFrom, sqlParseResult);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  96                  break;                                                                                            </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style="">  97              case JOIN:                                                                                            </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style="">  98                  SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                                  </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style="">  99                  SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                                </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 101                  if(leftNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 102                      sqlParseResult.addSourceTable(leftNode.toString());                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 103                  }else{                                                                                            </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 104                      parseNode(leftNode, sqlParseResult);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105                  }                                                                                                 </span>
<span  style=""> 106                                                                                                                    </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 107                  if(rightNode.getKind() == IDENTIFIER){                                                            </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 108                      sqlParseResult.addSourceTable(rightNode.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 109                  }else{                                                                                            </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 110                      parseNode(rightNode, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 112                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 113              case AS:                                                                                              </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 114                  //不解析column,所以 as 相关的都是表                                                                          </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 115                  SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                                </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 116                  if(identifierNode.getKind() != IDENTIFIER){                                                       </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 117                      parseNode(identifierNode, sqlParseResult);                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 118                  }else {                                                                                           </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 119                      sqlParseResult.addSourceTable(identifierNode.toString());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 121                  break;                                                                                            </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 122              case MATCH_RECOGNIZE:                                                                                 </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 123                  SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                             </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 124                  sqlParseResult.addSourceTable(node.getTableRef().toString());                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 125                  break;                                                                                            </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 126              case UNION:                                                                                           </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 127                  SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 128                  SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                                    </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 129                  if(unionLeft.getKind() == IDENTIFIER){                                                            </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 130                      sqlParseResult.addSourceTable(unionLeft.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 131                  }else{                                                                                            </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 132                      parseNode(unionLeft, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133                  }                                                                                                 </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 134                  if(unionRight.getKind() == IDENTIFIER){                                                           </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 135                      sqlParseResult.addSourceTable(unionRight.toString());                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 136                  }else{                                                                                            </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 137                      parseNode(unionRight, sqlParseResult);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 139                  break;                                                                                            </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 140              case ORDER_BY:                                                                                        </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 141                  SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                                    </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 142                  parseNode(sqlOrderBy.query, sqlParseResult);                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 143                  break;                                                                                            </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 144              default:                                                                                              </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 145                  //do nothing                                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 146                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148      }                                                                                                             </span>
<span  style=""> 149                                                                                                                    </span>






































<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 150      public static class SqlParseResult {                                                                          </span>
<span  style=""> 151                                                                                                                    </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 152          private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                              </span>
<span  style=""> 153                                                                                                                    </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 154          private List&lt;String&gt; targetTableList = Lists.newArrayList();                                              </span>
<span  style=""> 155                                                                                                                    </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 156          private String execSql;                                                                                   </span>
<span  style=""> 157                                                                                                                    </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 158          public void addSourceTable(String sourceTable){                                                           </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 159              sourceTableList.add(sourceTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160          }                                                                                                         </span>
<span  style=""> 161                                                                                                                    </span>
<span class="2239855044100079830" onmouseenter="enter('2239855044100079830');" onmouseout="out('2239855044100079830');" style=""> 162          public void addTargetTable(String targetTable){                                                           </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 163              targetTableList.add(targetTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164          }                                                                                                         </span>
<span  style=""> 165                                                                                                                    </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 166          public List&lt;String&gt; getSourceTableList() {                                                                </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 167              return sourceTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168          }                                                                                                         </span>
<span  style=""> 169                                                                                                                    </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 170          public List&lt;String&gt; getTargetTableList() {                                                                </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 171              return targetTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172          }                                                                                                         </span>
<span  style=""> 173                                                                                                                    </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 174          public String getExecSql() {                                                                              </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 175              return execSql;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176          }                                                                                                         </span>
<span  style=""> 177                                                                                                                    </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 178          public void setExecSql(String execSql) {                                                                  </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 179              this.execSql = execSql;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -                                                                                                                  </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  21  package com.dtstack.flink.sql.parser;                                                                             </span>
<span  style="">  22                                                                                                                    </span>
<span class="-2084905850329493825" onmouseenter="enter('-2084905850329493825');" onmouseout="out('-2084905850329493825');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import org.apache.calcite.config.Lex;                                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  25  import org.apache.calcite.sql.SqlInsert;                                                                          </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  26  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  27  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  32  import org.apache.calcite.sql.SqlMatchRecognize;                                                                  </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  34  import org.apache.calcite.sql.SqlOrderBy;                                                                         </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="1277226550340008522" onmouseenter="enter('1277226550340008522');" onmouseout="out('1277226550340008522');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import org.apache.calcite.sql.parser.SqlParser;                                                                   </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +import org.apache.calcite.sql.SqlAsOperator;                                                                      </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import org.apache.calcite.sql.parser.SqlParserPos;                                                                </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  41  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  42  import com.google.common.collect.Lists;                                                                           </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  43  import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                           </span>

<span  style="">  44                                                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  45  import java.util.List;                                                                                            </span>
<span  style="">  46                                                                                                                    </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  47  import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                          </span>
<span  style="">  48                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49  /**                                                                                                               </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  50   * 解析flink sql                                                                                                    </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  51   * sql 只支持 insert 开头的                                                                                             </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  52   * Date: 2018/6/22                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  53   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  54   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  55   */                                                                                                               </span>
<span  style="">  56                                                                                                                    </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  57  public class InsertSqlParser implements IParser {                                                                 </span>
<span  style="">  58                                                                                                                    </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +    // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                              </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +    private static Boolean parentIsInsert = false;                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  62      @Override                                                                                                     </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  63      public boolean verify(String sql) {                                                                           </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  64          return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65      }                                                                                                             </span>
<span  style="">  66                                                                                                                    </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  67      public static InsertSqlParser newInstance(){                                                                  </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  68          InsertSqlParser parser = new InsertSqlParser();                                                           </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  69          return parser;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70      }                                                                                                             </span>
<span  style="">  71                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72      @Override                                                                                                     </span>
<span class="2434475561113814770" onmouseenter="enter('2434475561113814770');" onmouseout="out('2434475561113814770');" style="">  73      public void parseSql(String sql, SqlTree sqlTree) {                                                           </span>

<span  style="">  74                                                                                                                    </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="">  75          FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                           </span>
<span class="1851740432007864849" onmouseenter="enter('1851740432007864849');" onmouseout="out('1851740432007864849');" style="">  76          SqlNode sqlNode = flinkPlanner.parse(sql);                                                                </span>


<span  style="">  77                                                                                                                    </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  78          SqlParseResult sqlParseResult = new SqlParseResult();                                                     </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  79          parseNode(sqlNode, sqlParseResult);                                                                       </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  80          sqlParseResult.setExecSql(sqlNode.toString());                                                            </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  81          sqlTree.addExecSql(sqlParseResult);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82      }                                                                                                             </span>
<span  style="">  83                                                                                                                    </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  84      private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                                </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  85          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  86          switch (sqlKind){                                                                                         </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  87              case INSERT:                                                                                          </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  88                  SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                                        </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  89                  SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                             </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  90                  sqlParseResult.addTargetTable(sqlTarget.toString());                                              </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +                parentIsInsert = true;                                                                            </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  92                  parseNode(sqlSource, sqlParseResult);                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  93                  break;                                                                                            </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  94              case SELECT:                                                                                          </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -                SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                                 </span>
<span class="1877498908128044563" onmouseenter="enter('1877498908128044563');" onmouseout="out('1877498908128044563');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -                if(sqlFrom.getKind() == IDENTIFIER){                                                              </span>
<span class="-6587445636759965572" onmouseenter="enter('-6587445636759965572');" onmouseout="out('-6587445636759965572');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +                SqlSelect sqlSelect = (SqlSelect) sqlNode;                                                        </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +                if (parentIsInsert) {                                                                             </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +                    rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +                }                                                                                                 </span>
<span class="-4229800989062838511" onmouseenter="enter('-4229800989062838511');" onmouseout="out('-4229800989062838511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +                SqlNode sqlFrom = ((SqlSelect) sqlNode).getFrom();                                                </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +                if (sqlFrom.getKind() == IDENTIFIER) {                                                            </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style=""> 103                      sqlParseResult.addSourceTable(sqlFrom.toString());                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -                }else{                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +                } else {                                                                                          </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +                    parentIsInsert = false;                                                                       </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 107                      parseNode(sqlFrom, sqlParseResult);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 109                  break;                                                                                            </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 110              case JOIN:                                                                                            </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 111                  SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                                  </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 112                  SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                                </span>
<span  style=""> 113                                                                                                                    </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 114                  if(leftNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 115                      sqlParseResult.addSourceTable(leftNode.toString());                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 116                  }else{                                                                                            </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 117                      parseNode(leftNode, sqlParseResult);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118                  }                                                                                                 </span>
<span  style=""> 119                                                                                                                    </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 120                  if(rightNode.getKind() == IDENTIFIER){                                                            </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 121                      sqlParseResult.addSourceTable(rightNode.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 122                  }else{                                                                                            </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 123                      parseNode(rightNode, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 125                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 126              case AS:                                                                                              </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 127                  //不解析column,所以 as 相关的都是表                                                                          </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 128                  SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                                </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 129                  if(identifierNode.getKind() != IDENTIFIER){                                                       </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 130                      parseNode(identifierNode, sqlParseResult);                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 131                  }else {                                                                                           </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 132                      sqlParseResult.addSourceTable(identifierNode.toString());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 134                  break;                                                                                            </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 135              case MATCH_RECOGNIZE:                                                                                 </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 136                  SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                             </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 137                  sqlParseResult.addSourceTable(node.getTableRef().toString());                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 138                  break;                                                                                            </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 139              case UNION:                                                                                           </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 140                  SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 141                  SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                                    </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 142                  if(unionLeft.getKind() == IDENTIFIER){                                                            </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 143                      sqlParseResult.addSourceTable(unionLeft.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 144                  }else{                                                                                            </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 145                      parseNode(unionLeft, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                  }                                                                                                 </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 147                  if(unionRight.getKind() == IDENTIFIER){                                                           </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 148                      sqlParseResult.addSourceTable(unionRight.toString());                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 149                  }else{                                                                                            </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 150                      parseNode(unionRight, sqlParseResult);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 152                  break;                                                                                            </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 153              case ORDER_BY:                                                                                        </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 154                  SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                                    </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 155                  parseNode(sqlOrderBy.query, sqlParseResult);                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 156                  break;                                                                                            </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 157              default:                                                                                              </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 158                  //do nothing                                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 159                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161      }                                                                                                             </span>
<span  style=""> 162                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +    /**                                                                                                           </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +     * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                                </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +     * 仅对 table.xx 这种类型的字段进行替换                                                                                    </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +     * @param selectList select Node 的 select 字段                                                                  </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +     * @param sqlSelect 第一层解析出来的 selectNode                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +     */                                                                                                           </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +    private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                          </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +        SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +                                                                                                                  </span>
<span class="343879600078305884" onmouseenter="enter('343879600078305884');" onmouseout="out('343879600078305884');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +        for (int index = 0; index &lt; selectList.size(); index++) {                                                 </span>
<span class="-1256655832574901737" onmouseenter="enter('-1256655832574901737');" onmouseout="out('-1256655832574901737');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +            if (selectList.get(index).getKind().equals(SqlKind.AS)                                                </span>
<span class="-4245735002242502625" onmouseenter="enter('-4245735002242502625');" onmouseout="out('-4245735002242502625');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +                    || ((SqlIdentifier) selectList.get(index)).names.size() == 1) {                               </span>
<span class="-5529344336821821070" onmouseenter="enter('-5529344336821821070');" onmouseout="out('-5529344336821821070');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                sqlNodes.add(selectList.get(index));                                                              </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +            }                                                                                                     </span>
<span class="7050887275215492486" onmouseenter="enter('7050887275215492486');" onmouseout="out('7050887275215492486');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +            sqlNodes.add(transformToAsNode(selectList.get(index)));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +        }                                                                                                         </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +        sqlSelect.setSelectList(sqlNodes);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +    /**                                                                                                           </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +     * 将 sqlNode 转化为 AsNode                                                                                       </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +     * @param sqlNode 需要转化的 sqlNode                                                                               </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +     * @return 重新构造的 AsNode                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +     */                                                                                                           </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +    public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                               </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +        String asName = &quot;&quot;;                                                                                       </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                             </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                                            sqlNode.getParserPosition().getEndColumnNum());                       </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +        if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                                       </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +            asName = ((SqlIdentifier) sqlNode).names.get(1);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +        }                                                                                                         </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +        SqlNode[] operands = new SqlNode[2];                                                                      </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +        operands[0] = sqlNode;                                                                                    </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +        operands[1] = new SqlIdentifier(asName, null, pos);                                                       </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +        return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +                                                                                                                  </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 201      public static class SqlParseResult {                                                                          </span>
<span  style=""> 202                                                                                                                    </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 203          private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                              </span>
<span  style=""> 204                                                                                                                    </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 205          private List&lt;String&gt; targetTableList = Lists.newArrayList();                                              </span>
<span  style=""> 206                                                                                                                    </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 207          private String execSql;                                                                                   </span>
<span  style=""> 208                                                                                                                    </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 209          public void addSourceTable(String sourceTable){                                                           </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 210              sourceTableList.add(sourceTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211          }                                                                                                         </span>
<span  style=""> 212                                                                                                                    </span>
<span class="2239855044100079830" onmouseenter="enter('2239855044100079830');" onmouseout="out('2239855044100079830');" style=""> 213          public void addTargetTable(String targetTable){                                                           </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 214              targetTableList.add(targetTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215          }                                                                                                         </span>
<span  style=""> 216                                                                                                                    </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 217          public List&lt;String&gt; getSourceTableList() {                                                                </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 218              return sourceTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219          }                                                                                                         </span>
<span  style=""> 220                                                                                                                    </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 221          public List&lt;String&gt; getTargetTableList() {                                                                </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 222              return targetTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223          }                                                                                                         </span>
<span  style=""> 224                                                                                                                    </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 225          public String getExecSql() {                                                                              </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 226              return execSql;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227          }                                                                                                         </span>
<span  style=""> 228                                                                                                                    </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 229          public void setExecSql(String execSql) {                                                                  </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 230              this.execSql = execSql;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            