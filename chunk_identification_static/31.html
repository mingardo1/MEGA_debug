<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>31</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    31
                    <a href="30.html">prev</a>
                    <a href="32.html">next</a>
                    <a href="31_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_7e580476786a21dce46e1afe089b873afc7abe19_app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;7e580476786a21dce46e1afe089b873afc7abe19:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;7e580476786a21dce46e1afe089b873afc7abe19^1:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;7e580476786a21dce46e1afe089b873afc7abe19^2:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;07b3954585ccc799cb794ab6b89505ef3f3811df:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [s]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.arialyy.simple.download;
  18 
  19 import android.content.BroadcastReceiver;
  20 import android.content.Context;
  21 import android.content.Intent;
  22 import android.os.Bundle;
  23 import android.os.Environment;
  24 import android.os.Handler;
  25 import android.os.Message;
  26 import android.support.v7.widget.Toolbar;
  27 import android.util.Log;
  28 import android.view.Menu;
  29 import android.view.MenuItem;
  30 import android.view.View;
  31 import android.widget.Button;
  32 import android.widget.RadioGroup;
  33 import android.widget.TextView;
  34 import android.widget.Toast;
  35 import butterknife.Bind;
  36 import com.arialyy.annotations.Download;
  37 import com.arialyy.aria.core.download.DownloadTarget;
  38 import com.arialyy.aria.core.Aria;
  39 import com.arialyy.aria.core.download.DownloadEntity;
  40 import com.arialyy.aria.core.download.DownloadTask;
  41 import com.arialyy.aria.core.inf.IEntity;
  42 import com.arialyy.aria.util.CommonUtil;
  43 import com.arialyy.frame.util.FileUtil;
  44 import com.arialyy.frame.util.show.L;
  45 import com.arialyy.frame.util.show.T;
  46 import com.arialyy.simple.R;
  47 import com.arialyy.simple.base.BaseActivity;
  48 import com.arialyy.simple.databinding.ActivitySingleBinding;
  49 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  50 import java.io.File;
  51 
  52 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53   public static final int DOWNLOAD_PRE = 0x01;
  54   public static final int DOWNLOAD_STOP = 0x02;
  55   public static final int DOWNLOAD_FAILE = 0x03;
  56   public static final int DOWNLOAD_CANCEL = 0x04;
  57   public static final int DOWNLOAD_RESUME = 0x05;
  58   public static final int DOWNLOAD_COMPLETE = 0x06;
  59   public static final int DOWNLOAD_RUNNING = 0x07;
  60   public static final int DOWNLOAD_START = 0x08;
  61 
  62   private static final String DOWNLOAD_URL =
  63       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;
  66       //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
  67       //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;
  68   //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  69   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  69   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/üîµ</abbr>
  70   //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  71   //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  72   //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  73   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  74   @Bind(R.id.start) Button mStart;
  75   @Bind(R.id.stop) Button mStop;
  76   @Bind(R.id.cancel) Button mCancel;
  77   @Bind(R.id.size) TextView mSize;
  78   @Bind(R.id.speed) TextView mSpeed;
  79   @Bind(R.id.speeds) RadioGroup mRg;
  80 
  81   private Handler mUpdateHandler = new Handler() {
  82     @Override public void handleMessage(Message msg) {
  83       super.handleMessage(msg);
  84       switch (msg.what) {
  85         case DOWNLOAD_RUNNING:
  86           DownloadTask task = (DownloadTask) msg.obj;
  87           long current = task.getCurrentProgress();
  88           long len = task.getFileSize();
  89           if (len == 0) {
  90             mPb.setProgress(0);
  91           } else {
  92             mPb.setProgress((int) ((current * 100) / len));
  93           }
  94           mSpeed.setText(task.getConvertSpeed());
  95           break;
  96         case DOWNLOAD_PRE:
  97           setBtState(false);
  98           break;
  99         case DOWNLOAD_START:
 100           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 101           break;
 102         case DOWNLOAD_FAILE:
 103           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 104           setBtState(true);
 105           break;
 106         case DOWNLOAD_STOP:
 107           Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 108           mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 109           setBtState(true);
 110           break;
 111         case DOWNLOAD_CANCEL:
 112           mPb.setProgress(0);
 113           Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 114           mStart.setText(&quot;ÂºÄÂßã&quot;);
 115           setBtState(true);
 116           break;
 117         case DOWNLOAD_RESUME:
 118           mStart.setText(&quot;ÊöÇÂÅú&quot;);
 119           setBtState(false);
 120           break;
 121         case DOWNLOAD_COMPLETE:
 122           mPb.setProgress(100);
 123           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 124           mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 125           mCancel.setEnabled(false);
 126           setBtState(true);
 127           break;
 128       }
 129     }
 130   };
 131 
 132   @Override protected void onCreate(Bundle savedInstanceState) {
 133     super.onCreate(savedInstanceState);
 134     Aria.download(this).register();
 135   }
 136 
 137   /**
 138    * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 139    */
 140   private void setBtState(boolean state) {
 141     mStart.setEnabled(state);
 142     mStop.setEnabled(!state);
 143   }
 144 
 145   @Override public boolean onCreateOptionsMenu(Menu menu) {
 146     getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 147     return super.onCreateOptionsMenu(menu);
 148   }
 149 
 150   @Override public boolean onMenuItemClick(MenuItem item) {
 151     double speed = -1;
 152     String msg = &quot;&quot;;
 153     switch (item.getItemId()) {
 154       case R.id.help:
 155         msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 156             + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøátask.getKey().equals(DOWNLOAD_URL)Âà§Êñ≠ÊòØÂê¶ÊòØÂΩìÂâçÈ°µÈù¢ÁöÑ‰∏ãËΩΩÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 157             + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 158             + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 159         showMsgDialog(&quot;tip&quot;, msg);
 160         break;
 161       case R.id.speed_0:
 162         speed = 0.0;
 163         break;
 164       case R.id.speed_128:
 165         speed = 128.0;
 166         break;
 167       case R.id.speed_256:
 168         speed = 256.0;
 169         break;
 170       case R.id.speed_512:
 171         speed = 512.0;
 172         break;
 173       case R.id.speed_1m:
 174         speed = 1024.0;
 175         break;
 176     }
 177     if (speed &gt; -1) {
 178       msg = item.getTitle().toString();
 179       Aria.download(this).setMaxSpeed(speed);
 180       T.showShort(this, msg);
 181     }
 182     return true;
 183   }
 184 
 185   @Download.onPre protected void onPre(DownloadTask task) {
 186     if (task.getKey().equals(DOWNLOAD_URL)) {
 187       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 188           .sendToTarget();
 189     }
 190   }
 191 
 192   @Download.onTaskStart void taskStart(DownloadTask task) {
 193     //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°
 194     if (task.getKey().equals(DOWNLOAD_URL)) {
 195       mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 196           .sendToTarget();
 197     }
 198   }
 199 
 200   @Download.onTaskRunning protected void running(DownloadTask task) {
 201     if (task.getKey().equals(DOWNLOAD_URL)) {
 202       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 203     }
 204   }
 205 
 206   @Download.onTaskResume void taskResume(DownloadTask task) {
 207     if (task.getKey().equals(DOWNLOAD_URL)) {
 208       mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 209     }
 210   }
 211 
 212   @Download.onTaskStop void taskStop(DownloadTask task) {
 213     if (task.getKey().equals(DOWNLOAD_URL)) {
 214       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 215       L.d(TAG, &quot;task__stop&quot;);
 216     }
 217   }
 218 
 219   @Download.onTaskCancel void taskCancel(DownloadTask task) {
 220     if (task.getKey().equals(DOWNLOAD_URL)) {
 221       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 222       L.d(TAG, &quot;task__cancel&quot;);
 223     }
 224   }
 225 
 226   @Download.onTaskFail void taskFail(DownloadTask task) {
 227     if (task.getKey().equals(DOWNLOAD_URL)) {
 228       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 229     }
 230   }
 231 
 232   @Download.onTaskComplete void taskComplete(DownloadTask task) {
 233     if (task.getKey().equals(DOWNLOAD_URL)) {
 234       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 235     }
 236   }
 237 
 238   @Download.onNoSupportBreakPoint public void onNoSupportBreakPoint(DownloadTask task) {
 239     if (task.getKey().equals(DOWNLOAD_URL)) {
 240       T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 241     }
 242   }
 243 
 244   @Override protected int setLayoutId() {
 245     return R.layout.activity_single;
 246   }
 247 
 248   @Override protected void init(Bundle savedInstanceState) {
 249     super.init(savedInstanceState);
 250     setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 251     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 252     mPb.setProgress(target.getPercent());
 253     if (target.getTaskState() == IEntity.STATE_STOP) {
 254       mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 255       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 256       setBtState(true);
 257     } else if (target.isDownloading()) {
 258       setBtState(false);
 259     }
 260     mSize.setText(target.getConvertFileSize());
 261     Aria.get(this).getDownloadConfig().setOpenBreadCast(true);
 262   }
 263 
 264   public void onClick(View view) {
 265     switch (view.getId()) {
 266       case R.id.start:
 267         String text = ((TextView) view).getText().toString();
 268         if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 269           Aria.download(this)
 270               .load(DOWNLOAD_URL)
 271               .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 272               .start();
 273         } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 274           Aria.download(this).load(DOWNLOAD_URL).resume();
 275         }
 276         break;
 277       case R.id.stop:
 278         Aria.download(this).load(DOWNLOAD_URL).pause();
 279         break;
 280       case R.id.cancel:
 281         Aria.download(this).load(DOWNLOAD_URL).cancel();
 282         break;
 283     }
 284   }
 285 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
 286 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 287 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 288   private class MySchedulerListener extends Aria.DownloadSchedulerListener {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290     @Override public void onPre(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292         mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293             .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 296 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 297     @Override public void onNoSupportBreakPoint(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 298       super.onNoSupportBreakPoint(task);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 299       T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 301 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302     @Override public void onTaskStart(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303       //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305         mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306             .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310     @Override public void onTaskResume(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312         mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316     @Override public void onTaskStop(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318         mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322     @Override public void onTaskCancel(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324         mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325         L.d(TAG, &quot;task__cancel&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329     @Override public void onTaskFail(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 330       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 331         mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 332       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 333     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 334 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 335     @Override public void onTaskComplete(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 336       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337         mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 338       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 339     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 340 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 341     @Override public void onTaskRunning(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 342       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 343         mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 344       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 345     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 346   }</span>
 347 =======
 348 &gt;&gt;&gt;&gt;&gt;&gt;&gt; v_3.0
 349 ||||||| GitAnalyzerPlus_base
 350 =======
 351 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 352 }
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.arialyy.simple.download;
  18 
  19 import android.content.BroadcastReceiver;
  20 import android.content.Context;
  21 import android.content.Intent;
  22 import android.os.Bundle;
  23 import android.os.Environment;
  24 import android.os.Handler;
  25 import android.os.Message;
  26 import android.support.v7.widget.Toolbar;
  27 import android.util.Log;
  28 import android.view.Menu;
  29 import android.view.MenuItem;
  30 import android.view.View;
  31 import android.widget.Button;
  32 import android.widget.RadioGroup;
  33 import android.widget.TextView;
  34 import android.widget.Toast;
  35 import butterknife.Bind;
  36 import com.arialyy.annotations.Download;
  37 import com.arialyy.aria.core.download.DownloadTarget;
  38 import com.arialyy.aria.core.Aria;
  39 import com.arialyy.aria.core.download.DownloadEntity;
  40 import com.arialyy.aria.core.download.DownloadTask;
  41 import com.arialyy.aria.core.inf.IEntity;
  42 import com.arialyy.aria.util.CommonUtil;
  43 import com.arialyy.frame.util.FileUtil;
  44 import com.arialyy.frame.util.show.L;
  45 import com.arialyy.frame.util.show.T;
  46 import com.arialyy.simple.R;
  47 import com.arialyy.simple.base.BaseActivity;
  48 import com.arialyy.simple.databinding.ActivitySingleBinding;
  49 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  50 import java.io.File;
  51 
  52 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53   public static final int DOWNLOAD_PRE = 0x01;
  54   public static final int DOWNLOAD_STOP = 0x02;
  55   public static final int DOWNLOAD_FAILE = 0x03;
  56   public static final int DOWNLOAD_CANCEL = 0x04;
  57   public static final int DOWNLOAD_RESUME = 0x05;
  58   public static final int DOWNLOAD_COMPLETE = 0x06;
  59   public static final int DOWNLOAD_RUNNING = 0x07;
  60   public static final int DOWNLOAD_START = 0x08;
  61 
  62   private static final String DOWNLOAD_URL =
  63       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;
  66       //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
  67       //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;
  68   //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  69   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  69   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/üîµ</abbr>
  70   //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  71   //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  72   //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  73   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  74   @Bind(R.id.start) Button mStart;
  75   @Bind(R.id.stop) Button mStop;
  76   @Bind(R.id.cancel) Button mCancel;
  77   @Bind(R.id.size) TextView mSize;
  78   @Bind(R.id.speed) TextView mSpeed;
  79   @Bind(R.id.speeds) RadioGroup mRg;
  80 
  81   private Handler mUpdateHandler = new Handler() {
  82     @Override public void handleMessage(Message msg) {
  83       super.handleMessage(msg);
  84       switch (msg.what) {
  85         case DOWNLOAD_RUNNING:
  86           DownloadTask task = (DownloadTask) msg.obj;
  87           long current = task.getCurrentProgress();
  88           long len = task.getFileSize();
  89           if (len == 0) {
  90             mPb.setProgress(0);
  91           } else {
  92             mPb.setProgress((int) ((current * 100) / len));
  93           }
  94           mSpeed.setText(task.getConvertSpeed());
  95           break;
  96         case DOWNLOAD_PRE:
  97           setBtState(false);
  98           break;
  99         case DOWNLOAD_START:
 100           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 101           break;
 102         case DOWNLOAD_FAILE:
 103           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 104           setBtState(true);
 105           break;
 106         case DOWNLOAD_STOP:
 107           Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 108           mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 109           setBtState(true);
 110           break;
 111         case DOWNLOAD_CANCEL:
 112           mPb.setProgress(0);
 113           Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 114           mStart.setText(&quot;ÂºÄÂßã&quot;);
 115           setBtState(true);
 116           break;
 117         case DOWNLOAD_RESUME:
 118           mStart.setText(&quot;ÊöÇÂÅú&quot;);
 119           setBtState(false);
 120           break;
 121         case DOWNLOAD_COMPLETE:
 122           mPb.setProgress(100);
 123           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 124           mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 125           mCancel.setEnabled(false);
 126           setBtState(true);
 127           break;
 128       }
 129     }
 130   };
 131 
 132   @Override protected void onCreate(Bundle savedInstanceState) {
 133     super.onCreate(savedInstanceState);
 134     Aria.download(this).register();
 135   }
 136 
 137   /**
 138    * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 139    */
 140   private void setBtState(boolean state) {
 141     mStart.setEnabled(state);
 142     mStop.setEnabled(!state);
 143   }
 144 
 145   @Override public boolean onCreateOptionsMenu(Menu menu) {
 146     getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 147     return super.onCreateOptionsMenu(menu);
 148   }
 149 
 150   @Override public boolean onMenuItemClick(MenuItem item) {
 151     double speed = -1;
 152     String msg = &quot;&quot;;
 153     switch (item.getItemId()) {
 154       case R.id.help:
 155         msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 156             + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøátask.getKey().equals(DOWNLOAD_URL)Âà§Êñ≠ÊòØÂê¶ÊòØÂΩìÂâçÈ°µÈù¢ÁöÑ‰∏ãËΩΩÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 157             + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 158             + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 159         showMsgDialog(&quot;tip&quot;, msg);
 160         break;
 161       case R.id.speed_0:
 162         speed = 0.0;
 163         break;
 164       case R.id.speed_128:
 165         speed = 128.0;
 166         break;
 167       case R.id.speed_256:
 168         speed = 256.0;
 169         break;
 170       case R.id.speed_512:
 171         speed = 512.0;
 172         break;
 173       case R.id.speed_1m:
 174         speed = 1024.0;
 175         break;
 176     }
 177     if (speed &gt; -1) {
 178       msg = item.getTitle().toString();
 179       Aria.download(this).setMaxSpeed(speed);
 180       T.showShort(this, msg);
 181     }
 182     return true;
 183   }
 184 
 185   @Download.onPre protected void onPre(DownloadTask task) {
 186     if (task.getKey().equals(DOWNLOAD_URL)) {
 187       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 188           .sendToTarget();
 189     }
 190   }
 191 
 192   @Download.onTaskStart void taskStart(DownloadTask task) {
 193     //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°
 194     if (task.getKey().equals(DOWNLOAD_URL)) {
 195       mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 196           .sendToTarget();
 197     }
 198   }
 199 
 200   @Download.onTaskRunning protected void running(DownloadTask task) {
 201     if (task.getKey().equals(DOWNLOAD_URL)) {
 202       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 203     }
 204   }
 205 
 206   @Download.onTaskResume void taskResume(DownloadTask task) {
 207     if (task.getKey().equals(DOWNLOAD_URL)) {
 208       mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 209     }
 210   }
 211 
 212   @Download.onTaskStop void taskStop(DownloadTask task) {
 213     if (task.getKey().equals(DOWNLOAD_URL)) {
 214       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 215       L.d(TAG, &quot;task__stop&quot;);
 216     }
 217   }
 218 
 219   @Download.onTaskCancel void taskCancel(DownloadTask task) {
 220     if (task.getKey().equals(DOWNLOAD_URL)) {
 221       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 222       L.d(TAG, &quot;task__cancel&quot;);
 223     }
 224   }
 225 
 226   @Download.onTaskFail void taskFail(DownloadTask task) {
 227     if (task.getKey().equals(DOWNLOAD_URL)) {
 228       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 229     }
 230   }
 231 
 232   @Download.onTaskComplete void taskComplete(DownloadTask task) {
 233     if (task.getKey().equals(DOWNLOAD_URL)) {
 234       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 235     }
 236   }
 237 
 238   @Download.onNoSupportBreakPoint public void onNoSupportBreakPoint(DownloadTask task) {
 239     if (task.getKey().equals(DOWNLOAD_URL)) {
 240       T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 241     }
 242   }
 243 
 244   @Override protected int setLayoutId() {
 245     return R.layout.activity_single;
 246   }
 247 
 248   @Override protected void init(Bundle savedInstanceState) {
 249     super.init(savedInstanceState);
 250     setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 251     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 252     mPb.setProgress(target.getPercent());
 253     if (target.getTaskState() == IEntity.STATE_STOP) {
 254       mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 255       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 256       setBtState(true);
 257     } else if (target.isDownloading()) {
 258       setBtState(false);
 259     }
 260     mSize.setText(target.getConvertFileSize());
 261     Aria.get(this).getDownloadConfig().setOpenBreadCast(true);
 262   }
 263 
 264   public void onClick(View view) {
 265     switch (view.getId()) {
 266       case R.id.start:
 267         String text = ((TextView) view).getText().toString();
 268         if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 269           Aria.download(this)
 270               .load(DOWNLOAD_URL)
 271               .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 272               .start();
 273         } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 274           Aria.download(this).load(DOWNLOAD_URL).resume();
 275         }
 276         break;
 277       case R.id.stop:
 278         Aria.download(this).load(DOWNLOAD_URL).pause();
 279         break;
 280       case R.id.cancel:
 281         Aria.download(this).load(DOWNLOAD_URL).cancel();
 282         break;
 283     }
 284   }
 285 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
 286 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 287 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 288   private class MySchedulerListener extends Aria.DownloadSchedulerListener {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290     @Override public void onPre(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292         mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293             .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 296 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 297     @Override public void onNoSupportBreakPoint(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 298       super.onNoSupportBreakPoint(task);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 299       T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 301 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302     @Override public void onTaskStart(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303       //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305         mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306             .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310     @Override public void onTaskResume(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312         mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316     @Override public void onTaskStop(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318         mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322     @Override public void onTaskCancel(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324         mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325         L.d(TAG, &quot;task__cancel&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329     @Override public void onTaskFail(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 330       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 331         mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 332       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 333     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 334 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 335     @Override public void onTaskComplete(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 336       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337         mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 338       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 339     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 340 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 341     @Override public void onTaskRunning(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 342       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 343         mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 344       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 345     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 346   }</span>
 347 =======
 348 &gt;&gt;&gt;&gt;&gt;&gt;&gt; v_3.0
 349 ||||||| BASE
 350 =======
 351 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 352 }
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.simple.download;
  17 
  18 import android.content.BroadcastReceiver;
  19 import android.content.Context;
  20 import android.content.Intent;
  21 import android.os.Bundle;
  22 import android.os.Environment;
  23 import android.os.Handler;
  24 import android.os.Message;
  25 import android.support.v7.widget.Toolbar;
  26 import android.util.Log;
  27 import android.view.Menu;
  28 import android.view.MenuItem;
  29 import android.view.View;
  30 import android.widget.Button;
  31 import android.widget.RadioGroup;
  32 import android.widget.TextView;
  33 import android.widget.Toast;
  34 import butterknife.Bind;
  35 import com.arialyy.annotations.Download;
  36 import com.arialyy.aria.core.Aria;
  37 import com.arialyy.aria.core.download.DownloadEntity;
  38 import com.arialyy.aria.core.download.DownloadTarget;
  39 import com.arialyy.aria.core.download.DownloadTask;
  40 import com.arialyy.aria.core.inf.IEntity;
  41 import com.arialyy.aria.util.CommonUtil;
  42 import com.arialyy.frame.util.FileUtil;
  43 import com.arialyy.frame.util.show.L;
  44 import com.arialyy.frame.util.show.T;
  45 import com.arialyy.simple.R;
  46 import com.arialyy.simple.base.BaseActivity;
  47 import com.arialyy.simple.databinding.ActivitySingleBinding;
  48 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  49 import java.io.File;
  50 
  51 
  52 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53   public static final int DOWNLOAD_PRE = 0x01;
  54   public static final int DOWNLOAD_STOP = 0x02;
  55   public static final int DOWNLOAD_FAILE = 0x03;
  56   public static final int DOWNLOAD_CANCEL = 0x04;
  57   public static final int DOWNLOAD_RESUME = 0x05;
  58   public static final int DOWNLOAD_COMPLETE = 0x06;
  59   public static final int DOWNLOAD_RUNNING = 0x07;
  60   public static final int DOWNLOAD_START = 0x08;
  61 
  62   private static final String DOWNLOAD_URL =
  63       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;
  66       //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
  67       //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;
  68   //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  69   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  69   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/üîµ</abbr>
  70   //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  71   //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  72   //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  73   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  74   @Bind(R.id.start) Button mStart;
  75   @Bind(R.id.stop) Button mStop;
  76   @Bind(R.id.cancel) Button mCancel;
  77   @Bind(R.id.size) TextView mSize;
  78   @Bind(R.id.speed) TextView mSpeed;
  79   @Bind(R.id.speeds) RadioGroup mRg;
  80 
  81   private Handler mUpdateHandler = new Handler() {
  82     @Override public void handleMessage(Message msg) {
  83       super.handleMessage(msg);
  84       switch (msg.what) {
  85         case DOWNLOAD_RUNNING:
  86           DownloadTask task = (DownloadTask) msg.obj;
  87           long current = task.getCurrentProgress();
  88           long len = task.getFileSize();
  89           if (len == 0) {
  90             mPb.setProgress(0);
  91           } else {
  92             mPb.setProgress((int) ((current * 100) / len));
  93           }
  94           mSpeed.setText(task.getConvertSpeed());
  95           break;
  96         case DOWNLOAD_PRE:
  97           setBtState(false);
  98           break;
  99         case DOWNLOAD_START:
 100           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 101           break;
 102         case DOWNLOAD_FAILE:
 103           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 104           setBtState(true);
 105           break;
 106         case DOWNLOAD_STOP:
 107           Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 108           mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 109           setBtState(true);
 110           break;
 111         case DOWNLOAD_CANCEL:
 112           mPb.setProgress(0);
 113           Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 114           mStart.setText(&quot;ÂºÄÂßã&quot;);
 115           setBtState(true);
 116           break;
 117         case DOWNLOAD_RESUME:
 118           mStart.setText(&quot;ÊöÇÂÅú&quot;);
 119           setBtState(false);
 120           break;
 121         case DOWNLOAD_COMPLETE:
 122           mPb.setProgress(100);
 123           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 124           mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 125           mCancel.setEnabled(false);
 126           setBtState(true);
 127           break;
 128       }
 129     }
 130   };
 131 
 132   @Override protected void onCreate(Bundle savedInstanceState) {
 133     super.onCreate(savedInstanceState);
 134     Aria.download(this).register();
 135   }
 136 
 137   /**
 138    * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 139    */
 140   private void setBtState(boolean state) {
 141     mStart.setEnabled(state);
 142     mStop.setEnabled(!state);
 143   }
 144 
 145   @Override public boolean onCreateOptionsMenu(Menu menu) {
 146     getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 147     return super.onCreateOptionsMenu(menu);
 148   }
 149 
 150   @Override public boolean onMenuItemClick(MenuItem item) {
 151     double speed = -1;
 152     String msg = &quot;&quot;;
 153     switch (item.getItemId()) {
 154       case R.id.help:
 155         msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 156             + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøátask.getKey().equals(DOWNLOAD_URL)Âà§Êñ≠ÊòØÂê¶ÊòØÂΩìÂâçÈ°µÈù¢ÁöÑ‰∏ãËΩΩÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 157             + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 158             + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 159         showMsgDialog(&quot;tip&quot;, msg);
 160         break;
 161       case R.id.speed_0:
 162         speed = 0.0;
 163         break;
 164       case R.id.speed_128:
 165         speed = 128.0;
 166         break;
 167       case R.id.speed_256:
 168         speed = 256.0;
 169         break;
 170       case R.id.speed_512:
 171         speed = 512.0;
 172         break;
 173       case R.id.speed_1m:
 174         speed = 1024.0;
 175         break;
 176     }
 177     if (speed &gt; -1) {
 178       msg = item.getTitle().toString();
 179       Aria.download(this).setMaxSpeed(speed);
 180       T.showShort(this, msg);
 181     }
 182     return true;
 183   }
 184 
 185   @Download.onPre protected void onPre(DownloadTask task) {
 186     if (task.getKey().equals(DOWNLOAD_URL)) {
 187       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 188           .sendToTarget();
 189     }
 190   }
 191 
 192   @Download.onTaskStart void taskStart(DownloadTask task) {
 193     //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°
 194     if (task.getKey().equals(DOWNLOAD_URL)) {
 195       mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 196           .sendToTarget();
 197     }
 198   }
 199 
 200   @Download.onTaskRunning protected void running(DownloadTask task) {
 201     if (task.getKey().equals(DOWNLOAD_URL)) {
 202       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 203     }
 204   }
 205 
 206   @Download.onTaskResume void taskResume(DownloadTask task) {
 207     if (task.getKey().equals(DOWNLOAD_URL)) {
 208       mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 209     }
 210   }
 211 
 212   @Download.onTaskStop void taskStop(DownloadTask task) {
 213     if (task.getKey().equals(DOWNLOAD_URL)) {
 214       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 215       L.d(TAG, &quot;task__stop&quot;);
 216     }
 217   }
 218 
 219   @Download.onTaskCancel void taskCancel(DownloadTask task) {
 220     if (task.getKey().equals(DOWNLOAD_URL)) {
 221       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 222       L.d(TAG, &quot;task__cancel&quot;);
 223     }
 224   }
 225 
 226   @Download.onTaskFail void taskFail(DownloadTask task) {
 227     if (task.getKey().equals(DOWNLOAD_URL)) {
 228       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 229     }
 230   }
 231 
 232   @Download.onTaskComplete void taskComplete(DownloadTask task) {
 233     if (task.getKey().equals(DOWNLOAD_URL)) {
 234       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 235     }
 236   }
 237 
 238   @Download.onNoSupportBreakPoint public void onNoSupportBreakPoint(DownloadTask task) {
 239     if (task.getKey().equals(DOWNLOAD_URL)) {
 240       T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 241     }
 242   }
 243 
 244   @Override protected int setLayoutId() {
 245     return R.layout.activity_single;
 246   }
 247 
 248   @Override protected void init(Bundle savedInstanceState) {
 249     super.init(savedInstanceState);
 250     setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 251     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 252     mPb.setProgress(target.getPercent());
 253     if (target.getTaskState() == IEntity.STATE_STOP) {
 254       mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 255       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 256       setBtState(true);
 257     } else if (target.isDownloading()) {
 258       setBtState(false);
 259     }
 260     mSize.setText(target.getConvertFileSize());
 261     Aria.get(this).getDownloadConfig().setOpenBreadCast(true);
 262   }
 263 
 264   public void onClick(View view) {
 265     switch (view.getId()) {
 266       case R.id.start:
 267         String text = ((TextView) view).getText().toString();
 268         if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 269           Aria.download(this)
 270               .load(DOWNLOAD_URL)
 271               .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 272               .start();
 273         } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 274           Aria.download(this).load(DOWNLOAD_URL).resume();
 275         }
 276         break;
 277       case R.id.stop:
 278         Aria.download(this).load(DOWNLOAD_URL).pause();
 279         break;
 280       case R.id.cancel:
 281         Aria.download(this).load(DOWNLOAD_URL).cancel();
 282         break;
 283     }
 284   }
 285 
 286 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
 287 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 288 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289   private class MySchedulerListener extends Aria.DownloadSchedulerListener {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291     @Override public void onPre(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293         mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294             .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 296     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 297 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 298     @Override public void onNoSupportBreakPoint(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 299       super.onNoSupportBreakPoint(task);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300       T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 301     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303     @Override public void onTaskStart(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304       //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306         mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307             .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311     @Override public void onTaskResume(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313         mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317     @Override public void onTaskStop(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319         mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323     @Override public void onTaskCancel(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325         mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326         L.d(TAG, &quot;task__cancel&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 330     @Override public void onTaskFail(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 331       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 332         mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 333       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 334     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 335 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 336     @Override public void onTaskComplete(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 338         mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 339       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 340     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 341 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 342     @Override public void onTaskRunning(DownloadTask task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 343       if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 344         mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 345       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 346     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 347   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 348 </span>
 349 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 350 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 350 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwüîµ</abbr></span>
 351 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352 </span>
 353 &gt;&gt;&gt;&gt;&gt;&gt;&gt; v_3.0
 354 
 355 ||||||| BASE
<abbr title=" 356 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 356 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwüîµ</abbr>
 357 =======
 358 
 359 
 360 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 361 }</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  
  17  package com.arialyy.simple.download;
  18  
  19  import android.content.BroadcastReceiver;
  20  import android.content.Context;
  21  import android.content.Intent;
  22  import android.os.Bundle;
  23  import android.os.Environment;
  24  import android.os.Handler;
  25  import android.os.Message;
  26  import android.support.v7.widget.Toolbar;
  27  import android.util.Log;
  28  import android.view.Menu;
  29  import android.view.MenuItem;
  30  import android.view.View;
  31  import android.widget.Button;
  32  import android.widget.RadioGroup;
  33  import android.widget.TextView;
  34  import android.widget.Toast;
  35  import butterknife.Bind;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import com.arialyy.annotations.Download;</span>
  37  import com.arialyy.aria.core.download.DownloadTarget;
  38  import com.arialyy.aria.core.Aria;
  39  import com.arialyy.aria.core.download.DownloadEntity;
  40  import com.arialyy.aria.core.download.DownloadTask;
  41  import com.arialyy.aria.core.inf.IEntity;
  42  import com.arialyy.aria.util.CommonUtil;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +import com.arialyy.frame.util.FileUtil;</span>
  44  import com.arialyy.frame.util.show.L;
  45  import com.arialyy.frame.util.show.T;
  46  import com.arialyy.simple.R;
  47  import com.arialyy.simple.base.BaseActivity;
  48  import com.arialyy.simple.databinding.ActivitySingleBinding;
  49  import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +import java.io.File;</span>
  51  
  52  public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53    public static final int DOWNLOAD_PRE = 0x01;
  54    public static final int DOWNLOAD_STOP = 0x02;
  55    public static final int DOWNLOAD_FAILE = 0x03;
  56    public static final int DOWNLOAD_CANCEL = 0x04;
  57    public static final int DOWNLOAD_RESUME = 0x05;
  58    public static final int DOWNLOAD_COMPLETE = 0x06;
  59    public static final int DOWNLOAD_RUNNING = 0x07;
  60    public static final int DOWNLOAD_START = 0x08;
  61  
  62    private static final String DOWNLOAD_URL =
  63        //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64        //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65        &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -  //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +      //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +      //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +  //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  70 +  //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  70 +  //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuraüîµ</abbr></span>
  71    //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  72    //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  73    //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  74    @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  75    @Bind(R.id.start) Button mStart;
  76    @Bind(R.id.stop) Button mStop;
  77    @Bind(R.id.cancel) Button mCancel;
  78    @Bind(R.id.size) TextView mSize;
  79    @Bind(R.id.speed) TextView mSpeed;
  80    @Bind(R.id.speeds) RadioGroup mRg;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -  private DownloadEntity mEntity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -  private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -    @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -      String action = intent.getAction();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -      if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -        L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -  };</span>
  90  
  91    private Handler mUpdateHandler = new Handler() {
  92      @Override public void handleMessage(Message msg) {
  93        super.handleMessage(msg);
  94        switch (msg.what) {
  95          case DOWNLOAD_RUNNING:
  96            DownloadTask task = (DownloadTask) msg.obj;
  97            long current = task.getCurrentProgress();
  98            long len = task.getFileSize();
  99            if (len == 0) {
 100              mPb.setProgress(0);
 101            } else {
 102              mPb.setProgress((int) ((current * 100) / len));
 103            }
 104            mSpeed.setText(task.getConvertSpeed());
 105            break;
 106          case DOWNLOAD_PRE:
 107            setBtState(false);
 108            break;
 109          case DOWNLOAD_START:
 110            mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 111            break;
 112          case DOWNLOAD_FAILE:
 113            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 114            setBtState(true);
 115            break;
 116          case DOWNLOAD_STOP:
 117            Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 118            mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 119            setBtState(true);
 120            break;
 121          case DOWNLOAD_CANCEL:
 122            mPb.setProgress(0);
 123            Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 124            mStart.setText(&quot;ÂºÄÂßã&quot;);
 125            setBtState(true);
 126            break;
 127          case DOWNLOAD_RESUME:
 128            mStart.setText(&quot;ÊöÇÂÅú&quot;);
 129            setBtState(false);
 130            break;
 131          case DOWNLOAD_COMPLETE:
 132            mPb.setProgress(100);
 133            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 134            mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 135            mCancel.setEnabled(false);
 136            setBtState(true);
 137            break;
 138        }
 139      }
 140    };
 141  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +  @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +    super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +    Aria.download(this).register();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +</span>
 147    /**
 148     * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 149     */
 150    private void setBtState(boolean state) {
 151      mStart.setEnabled(state);
 152      mStop.setEnabled(!state);
 153    }
 154  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -  @Override protected void onResume() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -    super.onResume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -    Aria.download(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -    //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -</span>
 161    @Override public boolean onCreateOptionsMenu(Menu menu) {
 162      getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 163      return super.onCreateOptionsMenu(menu);
 164    }
 165  
 166    @Override public boolean onMenuItemClick(MenuItem item) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -    if (item.getItemId() == R.id.help) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -      String msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -          + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøátask.getKey().equals(DOWNLOAD_URL)Âà§Êñ≠ÊòØÂê¶ÊòØÂΩìÂâçÈ°µÈù¢ÁöÑ‰∏ãËΩΩÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -          + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -          + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -      showMsgDialog(&quot;tip&quot;, msg);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +    double speed = -1;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +    String msg = &quot;&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +    switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +      case R.id.help:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +        msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +            + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøátask.getKey().equals(DOWNLOAD_URL)Âà§Êñ≠ÊòØÂê¶ÊòØÂΩìÂâçÈ°µÈù¢ÁöÑ‰∏ãËΩΩÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +            + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +            + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +        showMsgDialog(&quot;tip&quot;, msg);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +      case R.id.speed_0:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +        speed = 0.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +      case R.id.speed_128:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +        speed = 128.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +      case R.id.speed_256:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        speed = 256.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +      case R.id.speed_512:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +        speed = 512.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +      case R.id.speed_1m:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +        speed = 1024.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +    if (speed &gt; -1) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +      msg = item.getTitle().toString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +      Aria.download(this).setMaxSpeed(speed);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +      T.showShort(this, msg);</span>
 203      }
 204      return true;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +  @Download.onPre protected void onPre(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +          .sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +  @Download.onTaskStart void taskStart(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +    //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +          .sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +  @Download.onTaskRunning protected void running(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +  @Download.onTaskResume void taskResume(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +  @Download.onTaskStop void taskStop(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +      L.d(TAG, &quot;task__stop&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +  @Download.onTaskCancel void taskCancel(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +      L.d(TAG, &quot;task__cancel&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +  @Download.onTaskFail void taskFail(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +  @Download.onTaskComplete void taskComplete(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +  @Download.onNoSupportBreakPoint public void onNoSupportBreakPoint(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +      T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +    }</span>
 264    }
 265  
 266    @Override protected int setLayoutId() {
 267      return R.layout.activity_single;
 268    }
 269  
 270    @Override protected void init(Bundle savedInstanceState) {
 271      super.init(savedInstanceState);
 272      setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 273      DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 274      mPb.setProgress(target.getPercent());
 275      if (target.getTaskState() == IEntity.STATE_STOP) {
 276        mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 277        mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 278        setBtState(true);
 279      } else if (target.isDownloading()) {
 280        setBtState(false);
 281      }
 282      mSize.setText(target.getConvertFileSize());
 283      Aria.get(this).getDownloadConfig().setOpenBreadCast(true);
 284    }
 285  
 286    public void onClick(View view) {
 287      switch (view.getId()) {
 288        case R.id.start:
 289          String text = ((TextView) view).getText().toString();
 290          if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 291            Aria.download(this)
 292                .load(DOWNLOAD_URL)
 293                .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 294                .start();
 295          } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 296            Aria.download(this).load(DOWNLOAD_URL).resume();
 297          }
 298          break;
 299        case R.id.stop:
 300          Aria.download(this).load(DOWNLOAD_URL).pause();
 301          break;
 302        case R.id.cancel:
 303          Aria.download(this).load(DOWNLOAD_URL).cancel();
 304          break;
 305      }
 306    }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 307 +&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span>
 308  
 309    private class MySchedulerListener extends Aria.DownloadSchedulerListener {
 310  
 311      @Override public void onPre(DownloadTask task) {
 312        if (task.getKey().equals(DOWNLOAD_URL)) {
 313          mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 314              .sendToTarget();
 315        }
 316      }
 317  
 318      @Override public void onNoSupportBreakPoint(DownloadTask task) {
 319        super.onNoSupportBreakPoint(task);
 320        T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 321      }
 322  
 323      @Override public void onTaskStart(DownloadTask task) {
 324        //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°
 325        if (task.getKey().equals(DOWNLOAD_URL)) {
 326          mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 327              .sendToTarget();
 328        }
 329      }
 330  
 331      @Override public void onTaskResume(DownloadTask task) {
 332        if (task.getKey().equals(DOWNLOAD_URL)) {
 333          mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 334        }
 335      }
 336  
 337      @Override public void onTaskStop(DownloadTask task) {
 338        if (task.getKey().equals(DOWNLOAD_URL)) {
 339          mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 340        }
 341      }
 342  
 343      @Override public void onTaskCancel(DownloadTask task) {
 344        if (task.getKey().equals(DOWNLOAD_URL)) {
 345          mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +        L.d(TAG, &quot;task__cancel&quot;);</span>
 347        }
 348      }
 349  
 350      @Override public void onTaskFail(DownloadTask task) {
 351        if (task.getKey().equals(DOWNLOAD_URL)) {
 352          mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 353        }
 354      }
 355  
 356      @Override public void onTaskComplete(DownloadTask task) {
 357        if (task.getKey().equals(DOWNLOAD_URL)) {
 358          mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 359        }
 360      }
 361  
 362      @Override public void onTaskRunning(DownloadTask task) {
 363        if (task.getKey().equals(DOWNLOAD_URL)) {
 364          mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 365        }
 366      }
 367    }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 368 +=======</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 369 +&gt;&gt;&gt;&gt;&gt;&gt;&gt; v_3.0</span>
 370  }</pre></td>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  
  17  package com.arialyy.simple.download;
  18  
  19  import android.content.BroadcastReceiver;
  20  import android.content.Context;
  21  import android.content.Intent;
  22  import android.os.Bundle;
  23  import android.os.Environment;
  24  import android.os.Handler;
  25  import android.os.Message;
  26  import android.support.v7.widget.Toolbar;
  27  import android.util.Log;
  28  import android.view.Menu;
  29  import android.view.MenuItem;
  30  import android.view.View;
  31  import android.widget.Button;
  32  import android.widget.RadioGroup;
  33  import android.widget.TextView;
  34  import android.widget.Toast;
  35  import butterknife.Bind;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import com.arialyy.annotations.Download;</span>
  37  import com.arialyy.aria.core.download.DownloadTarget;
  38  import com.arialyy.aria.core.Aria;
  39  import com.arialyy.aria.core.download.DownloadEntity;
  40  import com.arialyy.aria.core.download.DownloadTask;
  41  import com.arialyy.aria.core.inf.IEntity;
  42  import com.arialyy.aria.util.CommonUtil;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +import com.arialyy.frame.util.FileUtil;</span>
  44  import com.arialyy.frame.util.show.L;
  45  import com.arialyy.frame.util.show.T;
  46  import com.arialyy.simple.R;
  47  import com.arialyy.simple.base.BaseActivity;
  48  import com.arialyy.simple.databinding.ActivitySingleBinding;
  49  import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +import java.io.File;</span>
  51  
  52  public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53    public static final int DOWNLOAD_PRE = 0x01;
  54    public static final int DOWNLOAD_STOP = 0x02;
  55    public static final int DOWNLOAD_FAILE = 0x03;
  56    public static final int DOWNLOAD_CANCEL = 0x04;
  57    public static final int DOWNLOAD_RESUME = 0x05;
  58    public static final int DOWNLOAD_COMPLETE = 0x06;
  59    public static final int DOWNLOAD_RUNNING = 0x07;
  60    public static final int DOWNLOAD_START = 0x08;
  61  
  62    private static final String DOWNLOAD_URL =
  63        //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64        //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65        &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -  //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +      //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +      //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +  //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  70 +  //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  70 +  //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuraüîµ</abbr></span>
  71    //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  72    //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  73    //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  74    @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  75    @Bind(R.id.start) Button mStart;
  76    @Bind(R.id.stop) Button mStop;
  77    @Bind(R.id.cancel) Button mCancel;
  78    @Bind(R.id.size) TextView mSize;
  79    @Bind(R.id.speed) TextView mSpeed;
  80    @Bind(R.id.speeds) RadioGroup mRg;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -  private DownloadEntity mEntity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -  private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -    @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -      String action = intent.getAction();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -      if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -        L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -  };</span>
  90  
  91    private Handler mUpdateHandler = new Handler() {
  92      @Override public void handleMessage(Message msg) {
  93        super.handleMessage(msg);
  94        switch (msg.what) {
  95          case DOWNLOAD_RUNNING:
  96            DownloadTask task = (DownloadTask) msg.obj;
  97            long current = task.getCurrentProgress();
  98            long len = task.getFileSize();
  99            if (len == 0) {
 100              mPb.setProgress(0);
 101            } else {
 102              mPb.setProgress((int) ((current * 100) / len));
 103            }
 104            mSpeed.setText(task.getConvertSpeed());
 105            break;
 106          case DOWNLOAD_PRE:
 107            setBtState(false);
 108            break;
 109          case DOWNLOAD_START:
 110            mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 111            break;
 112          case DOWNLOAD_FAILE:
 113            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 114            setBtState(true);
 115            break;
 116          case DOWNLOAD_STOP:
 117            Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 118            mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 119            setBtState(true);
 120            break;
 121          case DOWNLOAD_CANCEL:
 122            mPb.setProgress(0);
 123            Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 124            mStart.setText(&quot;ÂºÄÂßã&quot;);
 125            setBtState(true);
 126            break;
 127          case DOWNLOAD_RESUME:
 128            mStart.setText(&quot;ÊöÇÂÅú&quot;);
 129            setBtState(false);
 130            break;
 131          case DOWNLOAD_COMPLETE:
 132            mPb.setProgress(100);
 133            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 134            mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 135            mCancel.setEnabled(false);
 136            setBtState(true);
 137            break;
 138        }
 139      }
 140    };
 141  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +  @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +    super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +    Aria.download(this).register();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +</span>
 147    /**
 148     * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 149     */
 150    private void setBtState(boolean state) {
 151      mStart.setEnabled(state);
 152      mStop.setEnabled(!state);
 153    }
 154  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -  @Override protected void onResume() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -    super.onResume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -    Aria.download(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -    //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -</span>
 161    @Override public boolean onCreateOptionsMenu(Menu menu) {
 162      getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 163      return super.onCreateOptionsMenu(menu);
 164    }
 165  
 166    @Override public boolean onMenuItemClick(MenuItem item) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -    if (item.getItemId() == R.id.help) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -      String msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -          + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøátask.getKey().equals(DOWNLOAD_URL)Âà§Êñ≠ÊòØÂê¶ÊòØÂΩìÂâçÈ°µÈù¢ÁöÑ‰∏ãËΩΩÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -          + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -          + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -      showMsgDialog(&quot;tip&quot;, msg);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +    double speed = -1;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +    String msg = &quot;&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +    switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +      case R.id.help:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +        msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +            + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•ÈÄöËøátask.getKey().equals(DOWNLOAD_URL)Âà§Êñ≠ÊòØÂê¶ÊòØÂΩìÂâçÈ°µÈù¢ÁöÑ‰∏ãËΩΩÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +            + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +            + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +        showMsgDialog(&quot;tip&quot;, msg);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +      case R.id.speed_0:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +        speed = 0.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +      case R.id.speed_128:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +        speed = 128.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +      case R.id.speed_256:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        speed = 256.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +      case R.id.speed_512:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +        speed = 512.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +      case R.id.speed_1m:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +        speed = 1024.0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +    if (speed &gt; -1) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +      msg = item.getTitle().toString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +      Aria.download(this).setMaxSpeed(speed);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +      T.showShort(this, msg);</span>
 203      }
 204      return true;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +  @Download.onPre protected void onPre(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +          .sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +  @Download.onTaskStart void taskStart(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +    //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +          .sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +  @Download.onTaskRunning protected void running(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +  @Download.onTaskResume void taskResume(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +  @Download.onTaskStop void taskStop(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +      L.d(TAG, &quot;task__stop&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +  @Download.onTaskCancel void taskCancel(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +      L.d(TAG, &quot;task__cancel&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +  @Download.onTaskFail void taskFail(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +  @Download.onTaskComplete void taskComplete(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +      mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +  @Download.onNoSupportBreakPoint public void onNoSupportBreakPoint(DownloadTask task) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +    if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +      T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +    }</span>
 264    }
 265  
 266    @Override protected int setLayoutId() {
 267      return R.layout.activity_single;
 268    }
 269  
 270    @Override protected void init(Bundle savedInstanceState) {
 271      super.init(savedInstanceState);
 272      setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 273      DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 274      mPb.setProgress(target.getPercent());
 275      if (target.getTaskState() == IEntity.STATE_STOP) {
 276        mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 277        mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 278        setBtState(true);
 279      } else if (target.isDownloading()) {
 280        setBtState(false);
 281      }
 282      mSize.setText(target.getConvertFileSize());
 283      Aria.get(this).getDownloadConfig().setOpenBreadCast(true);
 284    }
 285  
 286    public void onClick(View view) {
 287      switch (view.getId()) {
 288        case R.id.start:
 289          String text = ((TextView) view).getText().toString();
 290          if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 291            Aria.download(this)
 292                .load(DOWNLOAD_URL)
 293                .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 294                .start();
 295          } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 296            Aria.download(this).load(DOWNLOAD_URL).resume();
 297          }
 298          break;
 299        case R.id.stop:
 300          Aria.download(this).load(DOWNLOAD_URL).pause();
 301          break;
 302        case R.id.cancel:
 303          Aria.download(this).load(DOWNLOAD_URL).cancel();
 304          break;
 305      }
 306    }

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 307 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -  private class MySchedulerListener extends Aria.DownloadSchedulerListener {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 310 -    @Override public void onPre(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 311 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 312 -        mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 313 -            .sendToTarget();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 314 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 315 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 316 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -    @Override public void onNoSupportBreakPoint(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -      super.onNoSupportBreakPoint(task);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -      T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 320 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 321 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 322 -    @Override public void onTaskStart(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -      //ÈÄöËøá‰∏ãËΩΩÂú∞ÂùÄÂèØ‰ª•Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊòØ‰Ω†ÊåáÂÆöÁöÑ‰ªªÂä°</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -        mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -            .sendToTarget();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -    @Override public void onTaskResume(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -        mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 336 -    @Override public void onTaskStop(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 337 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 338 -        mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 339 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 340 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 341 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 342 -    @Override public void onTaskCancel(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 343 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 344 -        mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 345 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 346 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 347 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 348 -    @Override public void onTaskFail(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 349 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 350 -        mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 351 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 352 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 353 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 354 -    @Override public void onTaskComplete(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 355 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -        mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -    @Override public void onTaskRunning(DownloadTask task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -      if (task.getKey().equals(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -        mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 363 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 364 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 365 -  }</span>


 366  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            