<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>343</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    343
                    <a href="342.html">prev</a>
                    <a href="344.html">next</a>
                    <a href="343_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_8cb6d5aea72f25034c7f3626ec6ef98783b1bee5_hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;8cb6d5aea72f25034c7f3626ec6ef98783b1bee5:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;8cb6d5aea72f25034c7f3626ec6ef98783b1bee5^1:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;8cb6d5aea72f25034c7f3626ec6ef98783b1bee5^2:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e0745d8713ef7459e406b517c6492b6b4fb88cb6:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  22                                                                                                          </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  24 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  25 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  26 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  27 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  28 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  29 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  30 import org.apache.hadoop.hbase.*;                                                                        </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  31 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  32 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  33 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  34 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  35 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  36 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  37 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  39 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  40 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  41 import java.security.PrivilegedAction;                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  42 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  43 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  44 import java.util.Set;                                                                                    </span>
<span  style="">  45                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  47  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  48  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49  */                                                                                                      </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  50 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                              </span>
<span  style="">  51                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  52     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span  style="">  53                                                                                                          </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  54     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  55     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  56     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  57     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  58     private String[] columnNames;                                                                        </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  59     private String updateMode;                                                                           </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  60     private String[] columnTypes;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  61     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span  style="">  62                                                                                                          </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  63     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  64     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  65     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  66     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  67     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  68     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  69     private String clientKeytabFile;                                                                     </span>
<span  style="">  70                                                                                                          </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  71     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  72     private String[] qualifiers;                                                                         </span>
<span  style="">  73                                                                                                          </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  74     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  75     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  76     private transient Table table;                                                                       </span>
<span  style="">  77                                                                                                          </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  78     private transient ChoreService choreService;                                                         </span>
<span  style="">  79                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  81     public void configure(Configuration parameters) {                                                    </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  82         LOG.warn(&quot;---configure---&quot;);                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  83         conf = HBaseConfiguration.create();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span  style="">  85                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  86     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  87     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  88         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="">  89         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style="">  90         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style="">  91         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style="">  92         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="">  95     private void openConn(){                                                                             </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="">  96         try{                                                                                             </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style="">  97             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style="">  98                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style="">  99                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 100             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 101                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 102                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 103                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 104                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105             }                                                                                            </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 106         }catch (Exception e){                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 107             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108         }                                                                                                </span>
<span  style=""> 109                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110     }                                                                                                    </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 111     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 112         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 113         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 114                                                                                                          </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 115         LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                 </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 116         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 117         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 117         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 118                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 119         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 120                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 121         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 122         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 122         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 123                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 124         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 125         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 126                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 127         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 127         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 128         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 129         conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 130             @Override                                                                                    </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 131             public Connection run() {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 132                 try {                                                                                    </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 133                     ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                         </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 134                     if (authChore != null) {                                                             </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 135                         choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                            </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 136                         choreService.scheduleChore(authChore);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137                     }                                                                                    </span>
<span  style=""> 138                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 139                     return ConnectionFactory.createConnection(finalConf);                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 140                 } catch (IOException e) {                                                                </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 141                     LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 142                     throw new RuntimeException(e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 145         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146     }                                                                                                    </span>
<span  style=""> 147                                                                                                          </span>
<span  style=""> 148                                                                                                          </span>
<span  style=""> 149                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 150     @Override                                                                                            </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 151     public void writeRecord(Tuple2 tuple2) {                                                             </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 152         Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                        </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 153         Row row = tupleTrans.f1;                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 154         dealInsert(row);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155     }                                                                                                    </span>
<span  style=""> 156                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 157     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 158         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 159         if (put == null || put.isEmpty()) {                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 160             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 161             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span  style=""> 163                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 164         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 165             table.put(put);                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 166         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 167             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 168                 LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                               </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 169                 LOG.error(&quot;&quot;, e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170             }                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 171             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172         }                                                                                                </span>
<span  style=""> 173                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 174         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 175             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176         }                                                                                                </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 177         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178     }                                                                                                    </span>
<span  style=""> 179                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 180     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 181         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 182         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 183             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 185         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 186         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 187             Object fieldVal = record.getField(i);                                                        </span>
<span class="5997897899806234844" onmouseenter="enter('5997897899806234844');" onmouseout="out('5997897899806234844');" style=""> 188             byte[] val = null;                                                                           </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 189             if (fieldVal != null) {                                                                      </span>
<span class="-1818687066154573146" onmouseenter="enter('-1818687066154573146');" onmouseout="out('-1818687066154573146');" style=""> 190                 val = fieldVal.toString().getBytes();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191             }                                                                                            </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 192 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-3781685654159973216" onmouseenter="enter('-3781685654159973216');" onmouseout="out('-3781685654159973216');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193             byte[] val = HbaseUtil.toByte(fieldVal);                                                     </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 194 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-4443114221682253197" onmouseenter="enter('-4443114221682253197');" onmouseout="out('-4443114221682253197');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195             Delete delete = new Delete(Bytes.toBytes(rowKey));                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196             try {                                                                                        </span>
<span class="2376467010118351815" onmouseenter="enter('2376467010118351815');" onmouseout="out('2376467010118351815');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                 table.delete(delete);                                                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198             } catch (IOException e) {                                                                    </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199                 if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {   </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200                     LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                           </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201                     LOG.error(&quot;&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202                 }                                                                                        </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203                 outDirtyRecords.inc();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204             }                                                                                            </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206                 LOG.info(record.toString());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207             }                                                                                            </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208             outRecords.inc();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219             Object fieldVal = record.getField(i);                                                        </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220             if (fieldVal == null) {                                                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222             }                                                                                            </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223             byte[] val = fieldVal.toString().getBytes();                                                 </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 224 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 225 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 226             byte[] cf = families[i].getBytes();                                                          </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 227             byte[] qualifier = qualifiers[i].getBytes();                                                 </span>
<span  style=""> 228                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 229             put.addColumn(cf, qualifier, val);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 231         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 234     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 235         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 236         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 237         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 238             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 239             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 240             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 242         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span  style=""> 244                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 245     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 246         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 247         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 248         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 249         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250     }                                                                                                    </span>
<span  style=""> 251                                                                                                          </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 252     private Map&lt;String, Object&gt; rowConvertMap(Row record){                                               </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 253         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 254         for(int i = 0; i &lt; columnNames.length; i++){                                                     </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 255             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 257         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258     }                                                                                                    </span>
<span  style=""> 259                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 260     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 261     public void close() throws IOException {                                                             </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 262         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 263             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 264             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266     }                                                                                                    </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 267     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268     }                                                                                                    </span>
<span  style=""> 269                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 270     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 271         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span  style=""> 273                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 274     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 275                                                                                                          </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 276         private HbaseOutputFormat format;                                                                </span>
<span  style=""> 277                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 278         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 279             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span  style=""> 281                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 282         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 283             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 284             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285         }                                                                                                </span>
<span  style=""> 286                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 287         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 288             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 289             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span  style=""> 291                                                                                                          </span>
<span  style=""> 292                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 293         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 294             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 295             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span  style=""> 297                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 298         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 299             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 300             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301         }                                                                                                </span>
<span  style=""> 302                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 303         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 304             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 305             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306         }                                                                                                </span>
<span  style=""> 307                                                                                                          </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 308         public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                           </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 309             format.columnTypes = columnTypes;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 310             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311         }                                                                                                </span>
<span  style=""> 312                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 313         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 314             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 315             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316         }                                                                                                </span>
<span  style=""> 317                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 318         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 319             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 320             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321         }                                                                                                </span>
<span  style=""> 322                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 323         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 324             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 325             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326         }                                                                                                </span>
<span  style=""> 327                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 328         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 329             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 330             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331         }                                                                                                </span>
<span  style=""> 332                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 333         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 334             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 335             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336         }                                                                                                </span>
<span  style=""> 337                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 338         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 339             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 340             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 341         }                                                                                                </span>
<span  style=""> 342                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 343         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 344             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 345             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346         }                                                                                                </span>
<span  style=""> 347                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 348         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 349             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 350             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351         }                                                                                                </span>
<span  style=""> 352                                                                                                          </span>
<span  style=""> 353                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 354         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 355             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 356             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 357             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 358             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 358             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 359                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 360             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 361             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 362                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 363             if (format.columnNameFamily != null) {                                                       </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 364                 Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                   </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 365                 String[] columns = keySet.toArray(new String[keySet.size()]);                            </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 366                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 367                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 368                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 369                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 370                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 373             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 374             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 375                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 376             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377         }                                                                                                </span>
<span  style=""> 378                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379     }                                                                                                    </span>
<span  style=""> 380                                                                                                          </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""><abbr title=" 381     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,"> 381     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverP🔵</abbr></span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""><abbr title=" 382                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOException {"> 382                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOExc🔵</abbr></span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 383         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 384             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 384             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 386         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 387         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 388         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 389         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 390                                                                                                          </span>
<span  style=""> 391                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 392         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 393             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394         }                                                                                                </span>
<span  style=""> 395                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 396         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 397             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 398             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 399             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 403     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 404     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 405         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 406                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 407                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 408                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 409                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 410                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 411                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 412                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 413                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414     }                                                                                                    </span>
<span  style=""> 415                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  22                                                                                                          </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  24 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  25 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  26 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  27 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  28 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  29 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  30 import org.apache.hadoop.hbase.*;                                                                        </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  31 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  32 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  33 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  34 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  35 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  36 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  37 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  39 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  40 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  41 import java.security.PrivilegedAction;                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  42 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  43 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  44 import java.util.Set;                                                                                    </span>
<span  style="">  45                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  47  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  48  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49  */                                                                                                      </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  50 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                              </span>
<span  style="">  51                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  52     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span  style="">  53                                                                                                          </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  54     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  55     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  56     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  57     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  58     private String[] columnNames;                                                                        </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  59     private String updateMode;                                                                           </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  60     private String[] columnTypes;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  61     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span  style="">  62                                                                                                          </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  63     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  64     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  65     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  66     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  67     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  68     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  69     private String clientKeytabFile;                                                                     </span>
<span  style="">  70                                                                                                          </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  71     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  72     private String[] qualifiers;                                                                         </span>
<span  style="">  73                                                                                                          </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  74     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  75     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  76     private transient Table table;                                                                       </span>
<span  style="">  77                                                                                                          </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  78     private transient ChoreService choreService;                                                         </span>
<span  style="">  79                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  81     public void configure(Configuration parameters) {                                                    </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  82         LOG.warn(&quot;---configure---&quot;);                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  83         conf = HBaseConfiguration.create();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span  style="">  85                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  86     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  87     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  88         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="">  89         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style="">  90         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style="">  91         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style="">  92         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="">  95     private void openConn(){                                                                             </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="">  96         try{                                                                                             </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style="">  97             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style="">  98                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style="">  99                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 100             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 101                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 102                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 103                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 104                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105             }                                                                                            </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 106         }catch (Exception e){                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 107             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108         }                                                                                                </span>
<span  style=""> 109                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110     }                                                                                                    </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 111     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 112         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 113         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 114                                                                                                          </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 115         LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                 </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 116         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 117         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 117         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 118                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 119         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 120                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 121         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 122         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 122         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 123                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 124         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 125         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 126                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 127         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 127         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 128         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 129         conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 130             @Override                                                                                    </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 131             public Connection run() {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 132                 try {                                                                                    </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 133                     ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                         </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 134                     if (authChore != null) {                                                             </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 135                         choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                            </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 136                         choreService.scheduleChore(authChore);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137                     }                                                                                    </span>
<span  style=""> 138                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 139                     return ConnectionFactory.createConnection(finalConf);                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 140                 } catch (IOException e) {                                                                </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 141                     LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 142                     throw new RuntimeException(e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 145         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146     }                                                                                                    </span>
<span  style=""> 147                                                                                                          </span>
<span  style=""> 148                                                                                                          </span>
<span  style=""> 149                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 150     @Override                                                                                            </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 151     public void writeRecord(Tuple2 tuple2) {                                                             </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 152         Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                        </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 153         Row row = tupleTrans.f1;                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 154             dealInsert(row);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155     }                                                                                                    </span>
<span  style=""> 156                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 157     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 158         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 159         if (put == null || put.isEmpty()) {                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 160             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 161             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span  style=""> 163                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 164             try {                                                                                        </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 165             table.put(put);                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 166         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 167                 if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {   </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 168                     LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                           </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 169                     LOG.error(&quot;&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170                 }                                                                                        </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 171                 outDirtyRecords.inc();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172             }                                                                                            </span>
<span  style=""> 173                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 174             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 175                 LOG.info(record.toString());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176             }                                                                                            </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 177             outRecords.inc();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178         }                                                                                                </span>
<span  style=""> 179                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 180     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 181         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 182         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 183             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 185         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 186         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 187             Object fieldVal = record.getField(i);                                                        </span>
<span class="5997897899806234844" onmouseenter="enter('5997897899806234844');" onmouseout="out('5997897899806234844');" style=""> 188             byte[] val = null;                                                                           </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 189             if (fieldVal != null) {                                                                      </span>
<span class="-1818687066154573146" onmouseenter="enter('-1818687066154573146');" onmouseout="out('-1818687066154573146');" style=""> 190                 val = fieldVal.toString().getBytes();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191             }                                                                                            </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 192 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-3781685654159973216" onmouseenter="enter('-3781685654159973216');" onmouseout="out('-3781685654159973216');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193             byte[] val = HbaseUtil.toByte(fieldVal);                                                     </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 194 ||||||| BASE                                                                                             </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195             byte[] val = fieldVal.toString().getBytes();                                                 </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 196 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 197 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 198             byte[] cf = families[i].getBytes();                                                          </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 199             byte[] qualifier = qualifiers[i].getBytes();                                                 </span>
<span  style=""> 200                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 201             put.addColumn(cf, qualifier, val);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 203         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204     }                                                                                                    </span>
<span  style=""> 205                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 206     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 207         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 208         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 209         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 210             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 211             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 212             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 214         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span  style=""> 216                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 217     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 218         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 219         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 220         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 221         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span  style=""> 223                                                                                                          </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 224     private Map&lt;String, Object&gt; rowConvertMap(Row record){                                               </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 225         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 226         for(int i = 0; i &lt; columnNames.length; i++){                                                     </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 227             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 229         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230     }                                                                                                    </span>
<span  style=""> 231                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 232     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 233     public void close() throws IOException {                                                             </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 234         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 235             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 236             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238     }                                                                                                    </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 239     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240     }                                                                                                    </span>
<span  style=""> 241                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 242     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 243         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244     }                                                                                                    </span>
<span  style=""> 245                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 246     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 247                                                                                                          </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 248         private HbaseOutputFormat format;                                                                </span>
<span  style=""> 249                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 250         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 251             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252         }                                                                                                </span>
<span  style=""> 253                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 254         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 255             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 256             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257         }                                                                                                </span>
<span  style=""> 258                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 259         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 260             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 261             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262         }                                                                                                </span>
<span  style=""> 263                                                                                                          </span>
<span  style=""> 264                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 265         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 266             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 267             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268         }                                                                                                </span>
<span  style=""> 269                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 270         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 271             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 272             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273         }                                                                                                </span>
<span  style=""> 274                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 275         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 276             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 277             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278         }                                                                                                </span>
<span  style=""> 279                                                                                                          </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 280         public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                           </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 281             format.columnTypes = columnTypes;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 282             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283         }                                                                                                </span>
<span  style=""> 284                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 285         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 286             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 287             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span  style=""> 289                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 290         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 291             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 292             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293         }                                                                                                </span>
<span  style=""> 294                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 295         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 296             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 297             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298         }                                                                                                </span>
<span  style=""> 299                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 300         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 301             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 302             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303         }                                                                                                </span>
<span  style=""> 304                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 305         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 306             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 307             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308         }                                                                                                </span>
<span  style=""> 309                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 310         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 311             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 312             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313         }                                                                                                </span>
<span  style=""> 314                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 315         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 316             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 317             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318         }                                                                                                </span>
<span  style=""> 319                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 320         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 321             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 322             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323         }                                                                                                </span>
<span  style=""> 324                                                                                                          </span>
<span  style=""> 325                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 326         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 327             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 328             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 329             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 330             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 330             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 331                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 332             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 333             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 334                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 335             if (format.columnNameFamily != null) {                                                       </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 336                 Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                   </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 337                 String[] columns = keySet.toArray(new String[keySet.size()]);                            </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 338                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 339                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 340                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 341                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 342                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 345             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 346             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 347                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 348             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349         }                                                                                                </span>
<span  style=""> 350                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351     }                                                                                                    </span>
<span  style=""> 352                                                                                                          </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""><abbr title=" 353     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,"> 353     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverP🔵</abbr></span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""><abbr title=" 354                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOException {"> 354                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOExc🔵</abbr></span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 355         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 356             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 356             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 358         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 359         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 360         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 361         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 362                                                                                                          </span>
<span  style=""> 363                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 364         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 365             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366         }                                                                                                </span>
<span  style=""> 367                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 368         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 369             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 370             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 371             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 375     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 376     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 377         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 378                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 379                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 380                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 381                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 382                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 383                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 384                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 385                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386     }                                                                                                    </span>
<span  style=""> 387                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388 }                                                                                                        </span>


























</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  18 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  19                                                                                                          </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  20 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  21 import com.google.common.collect.Maps;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  22 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  23 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  24 import java.security.PrivilegedAction;                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  25 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  26 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  27 import java.util.Set;                                                                                    </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  28 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  29 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  30 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  31 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  32 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  33 import org.apache.hadoop.hbase.*;                                                                        </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  34 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  35 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  36 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  37 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  38 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  39 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  40 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span  style="">  42                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  44  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  45  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  46  */                                                                                                      </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  47 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                              </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  48     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span  style="">  49                                                                                                          </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  50     private String host;                                                                                 </span>
<span  style="">  51                                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  52     private String zkParent;                                                                             </span>
<span  style="">  53                                                                                                          </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  54     private String rowkey;                                                                               </span>
<span  style="">  55                                                                                                          </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  56     private String tableName;                                                                            </span>
<span  style="">  57                                                                                                          </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  58     private String[] columnNames;                                                                        </span>
<span  style="">  59                                                                                                          </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  60     private String updateMode;                                                                           </span>
<span  style="">  61                                                                                                          </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  62     private String[] columnTypes;                                                                        </span>
<span  style="">  63                                                                                                          </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  64     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span  style="">  65                                                                                                          </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  66     private boolean kerberosAuthEnable;                                                                  </span>
<span  style="">  67                                                                                                          </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  68     private String regionserverKeytabFile;                                                               </span>
<span  style="">  69                                                                                                          </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  70     private String regionserverPrincipal;                                                                </span>
<span  style="">  71                                                                                                          </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  72     private String securityKrb5Conf;                                                                     </span>
<span  style="">  73                                                                                                          </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  74     private String zookeeperSaslClient;                                                                  </span>
<span  style="">  75                                                                                                          </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  76     private String clientPrincipal;                                                                      </span>
<span  style="">  77                                                                                                          </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  78     private String clientKeytabFile;                                                                     </span>
<span  style="">  79                                                                                                          </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  80     private String[] families;                                                                           </span>
<span  style="">  81                                                                                                          </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  82     private String[] qualifiers;                                                                         </span>
<span  style="">  83                                                                                                          </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  84     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span  style="">  85                                                                                                          </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  86     private transient Connection conn;                                                                   </span>
<span  style="">  87                                                                                                          </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  88     private transient Table table;                                                                       </span>
<span  style="">  89                                                                                                          </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  90     private transient ChoreService choreService;                                                         </span>
<span  style="">  91                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  92     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  93     public void configure(Configuration parameters) {                                                    </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  94         LOG.warn(&quot;---configure---&quot;);                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  95         conf = HBaseConfiguration.create();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  98     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  99     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 100         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 101         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 102         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 103         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 104         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style=""> 107     private void openConn(){                                                                             </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style=""> 108         try{                                                                                             </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 109             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 110                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 111                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 112             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 113                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 114                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 115                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 116                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117             }                                                                                            </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 118         }catch (Exception e){                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 119             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120         }                                                                                                </span>
<span  style=""> 121                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122     }                                                                                                    </span>
<span  style=""> 123                                                                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 124     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 125         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 126         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 127         LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                 </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 128         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 129         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 129         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 130         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span class="-8779060597768643468" onmouseenter="enter('-8779060597768643468');" onmouseout="out('-8779060597768643468');" style=""> 131         clientKeytabFile = (System.getProperty(&quot;user.dir&quot;) + File.separator) + clientKeytabFile;         </span>
<span class="8078785870556044748" onmouseenter="enter('8078785870556044748');" onmouseout="out('8078785870556044748');" style=""><abbr title=" 132         clientPrincipal = (!StringUtils.isEmpty(clientPrincipal)) ? clientPrincipal : regionserverPrincipal;"> 132         clientPrincipal = (!StringUtils.isEmpty(clientPrincipal)) ? clientPrincipal : regionserverPrincip🔵</abbr></span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 133         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 134         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 135         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 135         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 136         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 137         conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138             @Override                                                                                    </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 139             public Connection run() {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 140                 try {                                                                                    </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 141                     ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                         </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 142                     if (authChore != null) {                                                             </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 143                         choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                            </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 144                         choreService.scheduleChore(authChore);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                     }                                                                                    </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 146                     return ConnectionFactory.createConnection(finalConf);                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 147                 } catch (IOException e) {                                                                </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 148                     LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 149                     throw new RuntimeException(e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 152         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153     }                                                                                                    </span>
<span  style=""> 154                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 155     @Override                                                                                            </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 156     public void writeRecord(Tuple2 tuple2) {                                                             </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 157         Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                        </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 158         Row row = tupleTrans.f1;                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 159         dealInsert(row);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160     }                                                                                                    </span>
<span  style=""> 161                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 162     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 163         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 164         if (put == null || put.isEmpty()) {                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 165             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 166             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167         }                                                                                                </span>
<span  style=""> 168                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 169         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 170             table.put(put);                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 171         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 172             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 173                 LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                               </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 174                 LOG.error(&quot;&quot;, e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175             }                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 176             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177         }                                                                                                </span>
<span  style=""> 178                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 179         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 180             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 182         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 185     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 186         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 187         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 188             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 190         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 191         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 192             Object fieldVal = record.getField(i);                                                        </span>
<span class="5997897899806234844" onmouseenter="enter('5997897899806234844');" onmouseout="out('5997897899806234844');" style=""> 193             byte[] val = null;                                                                           </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 194             if (fieldVal != null) {                                                                      </span>
<span class="-1818687066154573146" onmouseenter="enter('-1818687066154573146');" onmouseout="out('-1818687066154573146');" style=""> 195                 val = fieldVal.toString().getBytes();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196             }                                                                                            </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 197             byte[] cf = families[i].getBytes();                                                          </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 198             byte[] qualifier = qualifiers[i].getBytes();                                                 </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 199             put.addColumn(cf, qualifier, val);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 201         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 204     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 205         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 206         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 207         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 208             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 209             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 210             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 212         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 215     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 216         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 217         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 218         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 219         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220     }                                                                                                    </span>
<span  style=""> 221                                                                                                          </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 222     private Map&lt;String, Object&gt; rowConvertMap(Row record){                                               </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 223         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 224         for(int i = 0; i &lt; columnNames.length; i++){                                                     </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 225             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 227         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228     }                                                                                                    </span>
<span  style=""> 229                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 230     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 231     public void close() throws IOException {                                                             </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 232         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 233             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 234             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236     }                                                                                                    </span>
<span  style=""> 237                                                                                                          </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 238     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239     }                                                                                                    </span>
<span  style=""> 240                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 241     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 242         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span  style=""> 244                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 245     public static class HbaseOutputFormatBuilder {                                                       </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 246         private HbaseOutputFormat format;                                                                </span>
<span  style=""> 247                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 248         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 249             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250         }                                                                                                </span>
<span  style=""> 251                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 252         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 253             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 254             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255         }                                                                                                </span>
<span  style=""> 256                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 257         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 258             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 259             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260         }                                                                                                </span>
<span  style=""> 261                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 262         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 263             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 264             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265         }                                                                                                </span>
<span  style=""> 266                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 267         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 268             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 269             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270         }                                                                                                </span>
<span  style=""> 271                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 272         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 273             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 274             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275         }                                                                                                </span>
<span  style=""> 276                                                                                                          </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 277         public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                           </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 278             format.columnTypes = columnTypes;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 279             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span  style=""> 281                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 282         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 283             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 284             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285         }                                                                                                </span>
<span  style=""> 286                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 287         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 288             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 289             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span  style=""> 291                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 292         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 293             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 294             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295         }                                                                                                </span>
<span  style=""> 296                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 297         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 298             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 299             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span  style=""> 301                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 302         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 303             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 304             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305         }                                                                                                </span>
<span  style=""> 306                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 307         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 308             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 309             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310         }                                                                                                </span>
<span  style=""> 311                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 312         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 313             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 314             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315         }                                                                                                </span>
<span  style=""> 316                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 317         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 318             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 319             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span  style=""> 321                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 322         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 323             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 324             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 325             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 326             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 326             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 327             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 328             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 329             if (format.columnNameFamily != null) {                                                       </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 330                 Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                   </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 331                 String[] columns = keySet.toArray(new String[keySet.size()]);                            </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 332                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 333                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 334                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 335                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 336                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 339             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 340             format.qualifiers = qualifiers;                                                              </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 341             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343     }                                                                                                    </span>
<span  style=""> 344                                                                                                          </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""><abbr title=" 345     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,"> 345     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverP🔵</abbr></span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""><abbr title=" 346                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOException {"> 346                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOExc🔵</abbr></span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 347         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 348             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 348             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 350         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 351         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 352         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 353         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 354                                                                                                          </span>
<span  style=""> 355                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 356         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 357             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358         }                                                                                                </span>
<span  style=""> 359                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 360         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 361             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 362             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 363             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365     }                                                                                                    </span>
<span  style=""> 366                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 367     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 368     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 369         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 370                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 371                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 372                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 373                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 374                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 375                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 376                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 377                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379 }                                                                                                        </span>



































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  22                                                                                                                    </span>
<span class="-4800595592392942650" onmouseenter="enter('-4800595592392942650');" onmouseout="out('-4800595592392942650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import com.dtstack.flink.sql.enums.EUpdateMode;                                                                   </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  24  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  27  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  29  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  30  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  31  import org.apache.hadoop.hbase.*;                                                                                 </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  32  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  33  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="162156476597244429" onmouseenter="enter('162156476597244429');" onmouseout="out('162156476597244429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import org.apache.hadoop.hbase.client.Delete;                                                                     </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  35  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  36  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="1523191633494881954" onmouseenter="enter('1523191633494881954');" onmouseout="out('1523191633494881954');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import org.apache.hadoop.hbase.util.Bytes;                                                                        </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  38  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  39  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  40  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  41                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  42  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  43  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  44  import java.security.PrivilegedAction;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  45  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  46  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  47  import java.util.Set;                                                                                             </span>
<span  style="">  48                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  50   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  51   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52   */                                                                                                               </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  53  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                                       </span>
<span  style="">  54                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  55      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span  style="">  56                                                                                                                    </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  57      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  58      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  59      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  60      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  61      private String[] columnNames;                                                                                 </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  62      private String updateMode;                                                                                    </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  63      private String[] columnTypes;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  64      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span  style="">  65                                                                                                                    </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  66      private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  67      private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  68      private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  69      private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  70      private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  71      private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  72      private String clientKeytabFile;                                                                              </span>
<span  style="">  73                                                                                                                    </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  74      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  75      private String[] qualifiers;                                                                                  </span>
<span  style="">  76                                                                                                                    </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  77      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  78      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  79      private transient Table table;                                                                                </span>
<span  style="">  80                                                                                                                    </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  81      private transient ChoreService choreService;                                                                  </span>
<span  style="">  82                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  83      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  84      public void configure(Configuration parameters) {                                                             </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  85          LOG.warn(&quot;---configure---&quot;);                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  86          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87      }                                                                                                             </span>
<span  style="">  88                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  89      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  90      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  91          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="">  92          openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style="">  93          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style="">  94          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style="">  95          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96      }                                                                                                             </span>
<span  style="">  97                                                                                                                    </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="">  98      private void openConn(){                                                                                      </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="">  99          try{                                                                                                      </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 100              if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 101                  LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 102                  openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 103              } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 104                  LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 105                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 106                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 107                  conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108              }                                                                                                     </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 109          }catch (Exception e){                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 110              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111          }                                                                                                         </span>
<span  style=""> 112                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113      }                                                                                                             </span>
<span class="2860698523146859203" onmouseenter="enter('2860698523146859203');" onmouseout="out('2860698523146859203');" style=""> 114      private void openKerberosConn() throws IOException {                                                          </span>

<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 115          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 116          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style=""> 117                                                                                                                    </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 118          LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                          </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 119          Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""> 120          Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style=""> 121                                                                                                                    </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 122          fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style=""> 123                                                                                                                    </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 124          clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""> 125          clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style=""> 126                                                                                                                    </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 127          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 128          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 130          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 130          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clie🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 131          org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 132          conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 133              @Override                                                                                             </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 134              public Connection run() {                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 135                  try {                                                                                             </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 136                      ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                  </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 137                      if (authChore != null) {                                                                      </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 138                          choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                     </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 139                          choreService.scheduleChore(authChore);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                      }                                                                                             </span>
<span  style=""> 141                                                                                                                    </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 142                      return ConnectionFactory.createConnection(finalConf);                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 143                  } catch (IOException e) {                                                                         </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 144                      LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 145                      throw new RuntimeException(e);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 148          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149      }                                                                                                             </span>
<span  style=""> 150                                                                                                                    </span>
<span  style=""> 151                                                                                                                    </span>
<span  style=""> 152                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 153      @Override                                                                                                     </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 154      public void writeRecord(Tuple2 tuple2) {                                                                      </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 155          Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                                 </span>
<span class="-6798598886787048492" onmouseenter="enter('-6798598886787048492');" onmouseout="out('-6798598886787048492');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -        Boolean retract = tupleTrans.f0;                                                                          </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 157          Row row = tupleTrans.f1;                                                                                  </span>
<span class="-4738216633021392189" onmouseenter="enter('-4738216633021392189');" onmouseout="out('-4738216633021392189');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -        if (retract) {                                                                                            </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -            dealInsert(row);                                                                                      </span>
<span class="-6425603269843385069" onmouseenter="enter('-6425603269843385069');" onmouseout="out('-6425603269843385069');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -        } else if (!retract &amp;&amp; StringUtils.equalsIgnoreCase(updateMode, EUpdateMode.UPSERT.name())) {             </span>
<span class="-2497428920962601187" onmouseenter="enter('-2497428920962601187');" onmouseout="out('-2497428920962601187');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -            dealDelete(row);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -        }                                                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +        dealInsert(row);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164      }                                                                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 166      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 167          Put put = getPutByRow(record);                                                                            </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 168          if (put == null || put.isEmpty()) {                                                                       </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 169              outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 170              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171          }                                                                                                         </span>
<span  style=""> 172                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 173          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 174              table.put(put);                                                                                       </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 175          } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 176              if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 177                  LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                        </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 178                  LOG.error(&quot;&quot;, e);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179              }                                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 180              outDirtyRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181          }                                                                                                         </span>
<span  style=""> 182                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 183          if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 184              LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185          }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 186          outRecords.inc();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187      }                                                                                                             </span>
<span  style=""> 188                                                                                                                    </span>
<span class="-6877193357999819834" onmouseenter="enter('-6877193357999819834');" onmouseout="out('-6877193357999819834');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -    protected void dealDelete(Row record) {                                                                       </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -        String rowKey = buildRowKey(record);                                                                      </span>
<span class="-7117490653594367529" onmouseenter="enter('-7117490653594367529');" onmouseout="out('-7117490653594367529');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -        if (!StringUtils.isEmpty(rowKey)) {                                                                       </span>
<span class="-4443114221682253197" onmouseenter="enter('-4443114221682253197');" onmouseout="out('-4443114221682253197');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -            Delete delete = new Delete(Bytes.toBytes(rowKey));                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -            try {                                                                                                 </span>
<span class="2376467010118351815" onmouseenter="enter('2376467010118351815');" onmouseout="out('2376467010118351815');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 194 -                table.delete(delete);                                                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 195 -            } catch (IOException e) {                                                                             </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 196 -                if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {            </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 197 -                    LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                    </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 198 -                    LOG.error(&quot;&quot;, e);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -                }                                                                                                 </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -                outDirtyRecords.inc();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -            }                                                                                                     </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -            if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -                LOG.info(record.toString());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -            }                                                                                                     </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -            outRecords.inc();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -                                                                                                                  </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 209      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 210          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 211          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 212              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 214          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 215          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 216              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style=""> 217              if (fieldVal == null) {                                                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 218                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219              }                                                                                                     </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 220 -            byte[] val = fieldVal.toString().getBytes();                                                          </span>
<span class="-3781685654159973216" onmouseenter="enter('-3781685654159973216');" onmouseout="out('-3781685654159973216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +            byte[] val = HbaseUtil.toByte(fieldVal);                                                              </span>



<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 222              byte[] cf = families[i].getBytes();                                                                   </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 223              byte[] qualifier = qualifiers[i].getBytes();                                                          </span>
<span  style=""> 224                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 225              put.addColumn(cf, qualifier, val);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 227          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228      }                                                                                                             </span>
<span  style=""> 229                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 230      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 231          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 232          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 233          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 234              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 235              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 236              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 238          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239      }                                                                                                             </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 241      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 242          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 243          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 244          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 245          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246      }                                                                                                             </span>
<span  style=""> 247                                                                                                                    </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 248      private Map&lt;String, Object&gt; rowConvertMap(Row record){                                                        </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 249          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 250          for(int i = 0; i &lt; columnNames.length; i++){                                                              </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 251              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 253          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254      }                                                                                                             </span>
<span  style=""> 255                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 256      @Override                                                                                                     </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 257      public void close() throws IOException {                                                                      </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 258          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 259              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 260              conn = null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262      }                                                                                                             </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 263      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264      }                                                                                                             </span>
<span  style=""> 265                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 266      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 267          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268      }                                                                                                             </span>
<span  style=""> 269                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 270      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 271                                                                                                                    </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 272          private HbaseOutputFormat format;                                                                         </span>
<span  style=""> 273                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 274          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 275              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276          }                                                                                                         </span>
<span  style=""> 277                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 278          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 279              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 280              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281          }                                                                                                         </span>
<span  style=""> 282                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 283          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 284              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 285              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286          }                                                                                                         </span>
<span  style=""> 287                                                                                                                    </span>
<span  style=""> 288                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 289          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 290              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 291              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292          }                                                                                                         </span>
<span  style=""> 293                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 294          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 295              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 296              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297          }                                                                                                         </span>
<span  style=""> 298                                                                                                                    </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 299          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 300              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 301              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302          }                                                                                                         </span>
<span  style=""> 303                                                                                                                    </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 304          public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                                    </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 305              format.columnTypes = columnTypes;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 306              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307          }                                                                                                         </span>
<span  style=""> 308                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 309          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 310              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 311              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312          }                                                                                                         </span>
<span  style=""> 313                                                                                                                    </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 314          public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 315              format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 316              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317          }                                                                                                         </span>
<span  style=""> 318                                                                                                                    </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 319          public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 320              format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 321              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322          }                                                                                                         </span>
<span  style=""> 323                                                                                                                    </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 324          public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 325              format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 326              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327          }                                                                                                         </span>
<span  style=""> 328                                                                                                                    </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 329          public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 330              format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 331              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332          }                                                                                                         </span>
<span  style=""> 333                                                                                                                    </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 334          public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 335              format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 336              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337          }                                                                                                         </span>
<span  style=""> 338                                                                                                                    </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 339          public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 340              format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 341              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342          }                                                                                                         </span>
<span  style=""> 343                                                                                                                    </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 344          public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 345              format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 346              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347          }                                                                                                         </span>
<span  style=""> 348                                                                                                                    </span>
<span  style=""> 349                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 350          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 351              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 352              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 353              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 354              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 355                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 356              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 357              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 358                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 359              if (format.columnNameFamily != null) {                                                                </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 360                  Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                            </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 361                  String[] columns = keySet.toArray(new String[keySet.size()]);                                     </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 362                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 363                      String col = columns[i];                                                                      </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 364                      String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 365                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 366                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 369              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 370              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 371                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 372              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373          }                                                                                                         </span>
<span  style=""> 374                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375      }                                                                                                             </span>
<span  style=""> 376                                                                                                                    </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""> 377      private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,</span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""> 378                                          String zookeeperSaslClient, String securityKrb5Conf) throws IOException { </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 379          if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 380              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 380              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381          }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 382          config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 383          config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 384          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 385          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style=""> 386                                                                                                                    </span>
<span  style=""> 387                                                                                                                    </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 388          if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 389              System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390          }                                                                                                         </span>
<span  style=""> 391                                                                                                                    </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 392          if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 393              String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 394              LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 395              System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397      }                                                                                                             </span>
<span  style=""> 398                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 399      @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 400      public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 401          return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 402                  &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 403                  &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 404                  &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 405                  &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 406                  &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 407                  &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 408                  &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 409                  &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410      }                                                                                                             </span>
<span  style=""> 411                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  22                                                                                                                    </span>
<span class="-4800595592392942650" onmouseenter="enter('-4800595592392942650');" onmouseout="out('-4800595592392942650');" style="">  23  import com.dtstack.flink.sql.enums.EUpdateMode;                                                                   </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  24  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  27  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  29  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  30  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  31  import org.apache.hadoop.hbase.*;                                                                                 </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  32  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  33  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="162156476597244429" onmouseenter="enter('162156476597244429');" onmouseout="out('162156476597244429');" style="">  34  import org.apache.hadoop.hbase.client.Delete;                                                                     </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  35  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  36  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="1523191633494881954" onmouseenter="enter('1523191633494881954');" onmouseout="out('1523191633494881954');" style="">  37  import org.apache.hadoop.hbase.util.Bytes;                                                                        </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  38  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  39  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  40  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  41                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  42  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  43  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  44  import java.security.PrivilegedAction;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  45  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  46  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  47  import java.util.Set;                                                                                             </span>
<span  style="">  48                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  50   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  51   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52   */                                                                                                               </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  53  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                                       </span>
<span  style="">  54                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  55      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span  style="">  56                                                                                                                    </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  57      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  58      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  59      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  60      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  61      private String[] columnNames;                                                                                 </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  62      private String updateMode;                                                                                    </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  63      private String[] columnTypes;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  64      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span  style="">  65                                                                                                                    </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  66      private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  67      private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  68      private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  69      private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  70      private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  71      private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  72      private String clientKeytabFile;                                                                              </span>
<span  style="">  73                                                                                                                    </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  74      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  75      private String[] qualifiers;                                                                                  </span>
<span  style="">  76                                                                                                                    </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  77      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  78      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  79      private transient Table table;                                                                                </span>
<span  style="">  80                                                                                                                    </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  81      private transient ChoreService choreService;                                                                  </span>
<span  style="">  82                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  83      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  84      public void configure(Configuration parameters) {                                                             </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  85          LOG.warn(&quot;---configure---&quot;);                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  86          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87      }                                                                                                             </span>
<span  style="">  88                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  89      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  90      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  91          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="">  92          openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style="">  93          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style="">  94          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style="">  95          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96      }                                                                                                             </span>
<span  style="">  97                                                                                                                    </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="">  98      private void openConn(){                                                                                      </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="">  99          try{                                                                                                      </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 100              if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 101                  LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 102                  openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 103              } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 104                  LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 105                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 106                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 107                  conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108              }                                                                                                     </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 109          }catch (Exception e){                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 110              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111          }                                                                                                         </span>
<span  style=""> 112                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113      }                                                                                                             </span>
<span class="2860698523146859203" onmouseenter="enter('2860698523146859203');" onmouseout="out('2860698523146859203');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -    private void openKerberosConn() throws IOException {                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +    private void openKerberosConn() throws Exception {                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 116          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 117          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style=""> 118                                                                                                                    </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 119          LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                          </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 120          Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""> 121          Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style=""> 122                                                                                                                    </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 123          fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style=""> 124                                                                                                                    </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 125          clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""> 126          clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style=""> 127                                                                                                                    </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 128          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 129          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style=""> 130                                                                                                                    </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 131          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 131          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clie🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 132          org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 133          conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 134              @Override                                                                                             </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 135              public Connection run() {                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 136                  try {                                                                                             </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 137                      ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                  </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 138                      if (authChore != null) {                                                                      </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 139                          choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                     </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 140                          choreService.scheduleChore(authChore);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                      }                                                                                             </span>
<span  style=""> 142                                                                                                                    </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 143                      return ConnectionFactory.createConnection(finalConf);                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 144                  } catch (IOException e) {                                                                         </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 145                      LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 146                      throw new RuntimeException(e);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 149          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150      }                                                                                                             </span>
<span  style=""> 151                                                                                                                    </span>
<span  style=""> 152                                                                                                                    </span>
<span  style=""> 153                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 154      @Override                                                                                                     </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 155      public void writeRecord(Tuple2 tuple2) {                                                                      </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 156          Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                                 </span>
<span class="-6798598886787048492" onmouseenter="enter('-6798598886787048492');" onmouseout="out('-6798598886787048492');" style=""> 157          Boolean retract = tupleTrans.f0;                                                                          </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 158          Row row = tupleTrans.f1;                                                                                  </span>
<span class="-4738216633021392189" onmouseenter="enter('-4738216633021392189');" onmouseout="out('-4738216633021392189');" style=""> 159          if (retract) {                                                                                            </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 160              dealInsert(row);                                                                                      </span>
<span class="-6425603269843385069" onmouseenter="enter('-6425603269843385069');" onmouseout="out('-6425603269843385069');" style=""> 161          } else if (!retract &amp;&amp; StringUtils.equalsIgnoreCase(updateMode, EUpdateMode.UPSERT.name())) {             </span>
<span class="-2497428920962601187" onmouseenter="enter('-2497428920962601187');" onmouseout="out('-2497428920962601187');" style=""> 162              dealDelete(row);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163          }                                                                                                         </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164      }                                                                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 166      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 167          Put put = getPutByRow(record);                                                                            </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 168          if (put == null || put.isEmpty()) {                                                                       </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 169              outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 170              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171          }                                                                                                         </span>
<span  style=""> 172                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 173          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 174              table.put(put);                                                                                       </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 175          } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 176              if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 177                  LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                        </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 178                  LOG.error(&quot;&quot;, e);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179              }                                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 180              outDirtyRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181          }                                                                                                         </span>
<span  style=""> 182                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 183          if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 184              LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185          }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 186          outRecords.inc();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187      }                                                                                                             </span>
<span  style=""> 188                                                                                                                    </span>
<span class="-6877193357999819834" onmouseenter="enter('-6877193357999819834');" onmouseout="out('-6877193357999819834');" style=""> 189      protected void dealDelete(Row record) {                                                                       </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 190          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-7117490653594367529" onmouseenter="enter('-7117490653594367529');" onmouseout="out('-7117490653594367529');" style=""> 191          if (!StringUtils.isEmpty(rowKey)) {                                                                       </span>
<span class="-4443114221682253197" onmouseenter="enter('-4443114221682253197');" onmouseout="out('-4443114221682253197');" style=""> 192              Delete delete = new Delete(Bytes.toBytes(rowKey));                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 193              try {                                                                                                 </span>
<span class="2376467010118351815" onmouseenter="enter('2376467010118351815');" onmouseout="out('2376467010118351815');" style=""> 194                  table.delete(delete);                                                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 195              } catch (IOException e) {                                                                             </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 196                  if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {            </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 197                      LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                    </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 198                      LOG.error(&quot;&quot;, e);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199                  }                                                                                                 </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 200                  outDirtyRecords.inc();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201              }                                                                                                     </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 202              if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 203                  LOG.info(record.toString());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204              }                                                                                                     </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 205              outRecords.inc();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207      }                                                                                                             </span>
<span  style=""> 208                                                                                                                    </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 209      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 210          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 211          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 212              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 214          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 215          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 216              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 217 -            if (fieldVal == null) {                                                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 218 -                continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 219 -            }                                                                                                     </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 220 -            byte[] val = fieldVal.toString().getBytes();                                                          </span>
<span class="5997897899806234844" onmouseenter="enter('5997897899806234844');" onmouseout="out('5997897899806234844');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +            byte[] val = null;                                                                                    </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +            if (fieldVal != null) {                                                                               </span>
<span class="-1818687066154573146" onmouseenter="enter('-1818687066154573146');" onmouseout="out('-1818687066154573146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +                val = fieldVal.toString().getBytes();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +            }                                                                                                     </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 225              byte[] cf = families[i].getBytes();                                                                   </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 226              byte[] qualifier = qualifiers[i].getBytes();                                                          </span>
<span  style=""> 227                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 228              put.addColumn(cf, qualifier, val);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 230          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231      }                                                                                                             </span>
<span  style=""> 232                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 233      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 234          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 235          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 236          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 237              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 238              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 239              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 241          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242      }                                                                                                             </span>
<span  style=""> 243                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 244      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 245          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 246          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 247          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 248          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249      }                                                                                                             </span>
<span  style=""> 250                                                                                                                    </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 251      private Map&lt;String, Object&gt; rowConvertMap(Row record){                                                        </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 252          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 253          for(int i = 0; i &lt; columnNames.length; i++){                                                              </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 254              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 256          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257      }                                                                                                             </span>
<span  style=""> 258                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 259      @Override                                                                                                     </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 260      public void close() throws IOException {                                                                      </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 261          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 262              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 263              conn = null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265      }                                                                                                             </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 266      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267      }                                                                                                             </span>
<span  style=""> 268                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 269      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 270          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271      }                                                                                                             </span>
<span  style=""> 272                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 273      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 274                                                                                                                    </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 275          private HbaseOutputFormat format;                                                                         </span>
<span  style=""> 276                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 277          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 278              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279          }                                                                                                         </span>
<span  style=""> 280                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 281          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 282              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 283              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span  style=""> 285                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 286          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 287              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 288              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289          }                                                                                                         </span>
<span  style=""> 290                                                                                                                    </span>
<span  style=""> 291                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 292          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 293              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 294              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295          }                                                                                                         </span>
<span  style=""> 296                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 297          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 298              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 299              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300          }                                                                                                         </span>
<span  style=""> 301                                                                                                                    </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 302          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 303              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 304              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305          }                                                                                                         </span>
<span  style=""> 306                                                                                                                    </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 307          public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                                    </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 308              format.columnTypes = columnTypes;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 309              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310          }                                                                                                         </span>
<span  style=""> 311                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 312          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 313              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 314              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315          }                                                                                                         </span>
<span  style=""> 316                                                                                                                    </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 317          public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 318              format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 319              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320          }                                                                                                         </span>
<span  style=""> 321                                                                                                                    </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 322          public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 323              format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 324              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325          }                                                                                                         </span>
<span  style=""> 326                                                                                                                    </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 327          public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 328              format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 329              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330          }                                                                                                         </span>
<span  style=""> 331                                                                                                                    </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 332          public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 333              format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 334              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335          }                                                                                                         </span>
<span  style=""> 336                                                                                                                    </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 337          public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 338              format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 339              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340          }                                                                                                         </span>
<span  style=""> 341                                                                                                                    </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 342          public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 343              format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 344              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345          }                                                                                                         </span>
<span  style=""> 346                                                                                                                    </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 347          public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 348              format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 349              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350          }                                                                                                         </span>
<span  style=""> 351                                                                                                                    </span>
<span  style=""> 352                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 353          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 354              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 355              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 356              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 357              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 358                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 359              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 360              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 361                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 362              if (format.columnNameFamily != null) {                                                                </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 363                  Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                            </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 364                  String[] columns = keySet.toArray(new String[keySet.size()]);                                     </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 365                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 366                      String col = columns[i];                                                                      </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 367                      String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 368                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 369                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 372              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 373              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 374                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 375              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376          }                                                                                                         </span>
<span  style=""> 377                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378      }                                                                                                             </span>
<span  style=""> 379                                                                                                                    </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""> 380      private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,</span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""> 381                                          String zookeeperSaslClient, String securityKrb5Conf) throws IOException { </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 382          if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 383              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 383              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384          }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 385          config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 386          config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 387          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 388          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style=""> 389                                                                                                                    </span>
<span  style=""> 390                                                                                                                    </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 391          if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 392              System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393          }                                                                                                         </span>
<span  style=""> 394                                                                                                                    </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 395          if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 396              String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 397              LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 398              System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400      }                                                                                                             </span>
<span  style=""> 401                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 402      @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 403      public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 404          return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 405                  &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 406                  &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 407                  &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 408                  &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 409                  &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 410                  &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 411                  &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 412                  &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413      }                                                                                                             </span>
<span  style=""> 414                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            