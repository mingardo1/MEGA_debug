<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>142</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    142
                    <a href="141.html">prev</a>
                    <a href="143.html">next</a>
                    <a href="142_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_ce13b629173d7eb617f15b31f7cbff34f821464b_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/MvelToSearchCriteriaConversionServiceImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;ce13b629173d7eb617f15b31f7cbff34f821464b:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/MvelToSearchCriteriaConversionServiceImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;ce13b629173d7eb617f15b31f7cbff34f821464b^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/MvelToSearchCriteriaConversionServiceImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;ce13b629173d7eb617f15b31f7cbff34f821464b^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/MvelToSearchCriteriaConversionServiceImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;56fa0f50efc09097a89d82211429952f70c40d5c:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/MvelToSearchCriteriaConversionServiceImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [s], [s], [s], [s], [s], [s], [s]], subset: [[bsj], [s], [s]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3  * BroadleafCommerce Common Libraries                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4511052683777238249" onmouseenter="enter('-4511052683777238249');" onmouseout="out('-4511052683777238249');" style="">  18 package org.broadleafcommerce.core.search.service.solr;                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  24 import org.broadleafcommerce.common.locale.domain.Locale;                                                </span>
<span class="-4699531719896516827" onmouseenter="enter('-4699531719896516827');" onmouseout="out('-4699531719896516827');" style="">  25 import org.broadleafcommerce.common.locale.domain.LocaleImpl;                                            </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  26 import org.broadleafcommerce.common.locale.service.LocaleService;                                        </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  27 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  28 import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                              </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  29 import org.broadleafcommerce.core.search.domain.IndexFieldType;                                          </span>
<span class="8917647116637261149" onmouseenter="enter('8917647116637261149');" onmouseout="out('8917647116637261149');" style="">  30 import org.broadleafcommerce.core.search.domain.IndexFieldTypeImpl;                                      </span>
<span class="3348214099427628787" onmouseenter="enter('3348214099427628787');" onmouseout="out('3348214099427628787');" style="">  31 import org.broadleafcommerce.core.search.domain.SearchCriteria;                                          </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  32 import org.broadleafcommerce.core.search.domain.solr.FieldType;                                          </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  33 import org.springframework.stereotype.Service;                                                           </span>
<span  style="">  34                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  35 import java.util.ArrayList;                                                                              </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  36 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  37 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38 import java.util.List;                                                                                   </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  39 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  40 import java.util.regex.Pattern;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  42 import javax.annotation.Resource;                                                                        </span>
<span  style="">  43                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  44 /**                                                                                                      </span>
<span class="-6557419552958427102" onmouseenter="enter('-6557419552958427102');" onmouseout="out('-6557419552958427102');" style="">  45  * Convenience methods for converting simple MVEL rules to Solr SearchCriteria                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  46  *                                                                                                       </span>
<span class="7828829262991528260" onmouseenter="enter('7828829262991528260');" onmouseout="out('7828829262991528260');" style="">  47  * @author Chris Kittrell (ckittrell)                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48  */                                                                                                      </span>
<span class="-5751247617688848665" onmouseenter="enter('-5751247617688848665');" onmouseout="out('-5751247617688848665');" style="">  49 @Service(&quot;blMvelToSearchCriteriaConversionService&quot;)                                                      </span>
<span class="7329482801380297950" onmouseenter="enter('7329482801380297950');" onmouseout="out('7329482801380297950');" style="">  50 public class MvelToSearchCriteriaConversionServiceImpl implements MvelToSearchCriteriaConversionService {</span>
<span  style="">  51                                                                                                          </span>
<span class="5180464717700805782" onmouseenter="enter('5180464717700805782');" onmouseout="out('5180464717700805782');" style="">  52     private static final Log LOG = LogFactory.getLog(MvelToSearchCriteriaConversionServiceImpl.class);   </span>
<span  style="">  53                                                                                                          </span>
<span class="-970930589962964105" onmouseenter="enter('-970930589962964105');" onmouseout="out('-970930589962964105');" style=""><abbr title="  54     public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCategoryIds,\\[\\\&quot;([0-9]+)(,\\\&quot;[0-9]+\\\&quot;)*\\\&quot;\\]\\)\\.size\\(\\)&gt;0$&quot;;">  54     public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?alðŸ”µ</abbr></span>
<span  style="">  55                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  56     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  57     protected CatalogService catalogService;                                                             </span>
<span  style="">  58                                                                                                          </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style="">  59     @Resource(name = &quot;blIndexFieldDao&quot;)                                                                  </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style="">  60     protected IndexFieldDao indexFieldDao;                                                               </span>
<span  style="">  61                                                                                                          </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style="">  62     @Resource(name = &quot;blLocaleService&quot;)                                                                  </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style="">  63     protected LocaleService localeService;                                                               </span>
<span  style="">  64                                                                                                          </span>
<span class="-8412875699496826705" onmouseenter="enter('-8412875699496826705');" onmouseout="out('-8412875699496826705');" style="">  65     @Resource(name=&quot;blSolrHelperService&quot;)                                                                </span>
<span class="-6899732035501197192" onmouseenter="enter('-6899732035501197192');" onmouseout="out('-6899732035501197192');" style="">  66     protected SolrHelperService solrHelperService;                                                       </span>
<span  style="">  67                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  68     @Override                                                                                            </span>
<span class="8517769271291085647" onmouseenter="enter('8517769271291085647');" onmouseout="out('8517769271291085647');" style="">  69     public SearchCriteria convert(String mvelRule) {                                                     </span>
<span class="-3804295702574698939" onmouseenter="enter('-3804295702574698939');" onmouseout="out('-3804295702574698939');" style="">  70         SearchCriteria criteria = new SearchCriteria();                                                  </span>
<span class="-173756114249607612" onmouseenter="enter('-173756114249607612');" onmouseout="out('-173756114249607612');" style="">  71         criteria.setPageSize(Integer.MAX_VALUE);                                                         </span>
<span  style="">  72                                                                                                          </span>
<span class="-5354029622989309350" onmouseenter="enter('-5354029622989309350');" onmouseout="out('-5354029622989309350');" style="">  73         if (isProductRule(mvelRule) || isCategoryTargetingRule(mvelRule)) {                              </span>
<span class="3271724963188919231" onmouseenter="enter('3271724963188919231');" onmouseout="out('3271724963188919231');" style="">  74             Collection&lt;String&gt; strings = convertRuleToFilters(mvelRule);                                 </span>
<span class="-4712490940242734116" onmouseenter="enter('-4712490940242734116');" onmouseout="out('-4712490940242734116');" style="">  75             criteria.setFilterQueries(strings);                                                          </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="">  76         }else {                                                                                          </span>
<span class="-1053745767754751717" onmouseenter="enter('-1053745767754751717');" onmouseout="out('-1053745767754751717');" style=""><abbr title="  77             throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using Rules &quot; +">  77             throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using RðŸ”µ</abbr></span>
<span class="-5527057582948710822" onmouseenter="enter('-5527057582948710822');" onmouseout="out('-5527057582948710822');" style=""><abbr title="  78                     &quot;(Conditional Rules) and selected rule can&#x27;t be translated to solr criteria and so &quot; +">  78                     &quot;(Conditional Rules) and selected rule can&#x27;t be translated to solr criteria and so &quot; ðŸ”µ</abbr></span>
<span class="-622187049424662407" onmouseenter="enter('-622187049424662407');" onmouseout="out('-622187049424662407');" style=""><abbr title="  79                     &quot;does not support selection of a Default Product. See Tooltip for supported rule details&quot;);">  79                     &quot;does not support selection of a Default Product. See Tooltip for supported rule detaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80         }                                                                                                </span>
<span  style="">  81                                                                                                          </span>
<span class="-6542614039530216187" onmouseenter="enter('-6542614039530216187');" onmouseout="out('-6542614039530216187');" style="">  82         return criteria;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83     }                                                                                                    </span>
<span  style="">  84                                                                                                          </span>
<span class="-1196261502723734502" onmouseenter="enter('-1196261502723734502');" onmouseout="out('-1196261502723734502');" style="">  85     protected boolean isProductRule(String rule){                                                        </span>
<span class="-5300376996092551927" onmouseenter="enter('-5300376996092551927');" onmouseout="out('-5300376996092551927');" style="">  86         return rule.contains(&quot;product.&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87     }                                                                                                    </span>
<span  style="">  88                                                                                                          </span>
<span class="7766953117726329902" onmouseenter="enter('7766953117726329902');" onmouseout="out('7766953117726329902');" style="">  89     protected boolean isCustomFieldIndexed(List&lt;IndexFieldType&gt; indexFieldTypes) {                       </span>
<span class="-7835921473874723009" onmouseenter="enter('-7835921473874723009');" onmouseout="out('-7835921473874723009');" style="">  90         return CollectionUtils.isNotEmpty(indexFieldTypes);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style=""><abbr title="  93     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0">  93     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;ðŸ”µ</abbr></span>
<span class="8608097822218680501" onmouseenter="enter('8608097822218680501');" onmouseout="out('8608097822218680501');" style="">  94     protected boolean isCategoryTargetingRule(String mvelRule) {                                         </span>
<span class="395583072845222703" onmouseenter="enter('395583072845222703');" onmouseout="out('395583072845222703');" style="">  95         return mvelRule.matches(CATEGORY_FORMAT_REGEX);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="-4578046640382617025" onmouseenter="enter('-4578046640382617025');" onmouseout="out('-4578046640382617025');" style=""><abbr title="  98     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;,...]).size()&gt;0">  98     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;ðŸ”µ</abbr></span>
<span class="4479154694055573719" onmouseenter="enter('4479154694055573719');" onmouseout="out('4479154694055573719');" style="">  99     protected Long[] getCategoryIds(String mvelRule) {                                                   </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style=""> 100         int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                    </span>
<span class="7462371261616726470" onmouseenter="enter('7462371261616726470');" onmouseout="out('7462371261616726470');" style=""> 101         int endIndex = mvelRule.indexOf(&quot;\&quot;]&quot;);                                                          </span>
<span class="-5169574352696925622" onmouseenter="enter('-5169574352696925622');" onmouseout="out('-5169574352696925622');" style=""> 102         String categoryId = mvelRule.substring(startIndex, endIndex);                                    </span>
<span class="-4041863795518518577" onmouseenter="enter('-4041863795518518577');" onmouseout="out('-4041863795518518577');" style=""> 103         //how about multivalue ?                                                                         </span>
<span class="-1998049530286061470" onmouseenter="enter('-1998049530286061470');" onmouseout="out('-1998049530286061470');" style=""> 104         String[] split = categoryId.split(&quot;,&quot;);                                                          </span>
<span class="-8236882608667390929" onmouseenter="enter('-8236882608667390929');" onmouseout="out('-8236882608667390929');" style=""> 105         Long[] result = null;                                                                            </span>
<span class="7592411771574828106" onmouseenter="enter('7592411771574828106');" onmouseout="out('7592411771574828106');" style=""> 106         int length = split.length;                                                                       </span>
<span class="3316164963146894618" onmouseenter="enter('3316164963146894618');" onmouseout="out('3316164963146894618');" style=""> 107         if (length &gt; 0) {                                                                                </span>
<span class="4047096185297244897" onmouseenter="enter('4047096185297244897');" onmouseout="out('4047096185297244897');" style=""> 108             result = new Long[length];                                                                   </span>
<span class="6908715651536326362" onmouseenter="enter('6908715651536326362');" onmouseout="out('6908715651536326362');" style=""> 109             for (int i = 0; i &lt; length; i++) {                                                           </span>
<span class="-7950545872238553987" onmouseenter="enter('-7950545872238553987');" onmouseout="out('-7950545872238553987');" style=""> 110                 result[i] = Long.parseLong(split[i].replace(&quot;\&quot;&quot;,&quot;&quot;));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 113         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114     }                                                                                                    </span>
<span  style=""> 115                                                                                                          </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style=""> 116     // Expected Custom Field Rule Formats                                                                </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style=""> 117     // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;               </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style=""><abbr title=" 118     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 118     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MðŸ”µ</abbr></span>
<span class="-8358459595516561004" onmouseenter="enter('-8358459595516561004');" onmouseout="out('-8358459595516561004');" style=""> 119     // Also supports string property contains, not contains, starts with, ends with etc.                 </span>
<span class="-3902656267910838436" onmouseenter="enter('-3902656267910838436');" onmouseout="out('-3902656267910838436');" style=""> 120     protected Collection&lt;String&gt; convertRuleToFilters(String matchRule) {                                </span>
<span class="-3458259939128959835" onmouseenter="enter('-3458259939128959835');" onmouseout="out('-3458259939128959835');" style=""> 121         List&lt;String&gt; filters = new ArrayList&lt;&gt;();                                                        </span>
<span  style=""> 122                                                                                                          </span>
<span class="-4116233034312872188" onmouseenter="enter('-4116233034312872188');" onmouseout="out('-4116233034312872188');" style=""> 123         boolean allRulesMustBeTrue = !matchRule.contains(&quot;||&quot;);                                          </span>
<span class="-1571577425596797932" onmouseenter="enter('-1571577425596797932');" onmouseout="out('-1571577425596797932');" style=""> 124         String[] fragments;                                                                              </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style=""> 125         if (allRulesMustBeTrue) {                                                                        </span>
<span class="-7188061614336596101" onmouseenter="enter('-7188061614336596101');" onmouseout="out('-7188061614336596101');" style=""> 126             fragments = StringUtils.split(matchRule, &quot;&amp;&amp;&quot;);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 127         } else {                                                                                         </span>
<span class="413737876388623067" onmouseenter="enter('413737876388623067');" onmouseout="out('413737876388623067');" style=""> 128             fragments = StringUtils.split(matchRule, &quot;||&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129         }                                                                                                </span>
<span  style=""> 130                                                                                                          </span>
<span class="1564812142638062790" onmouseenter="enter('1564812142638062790');" onmouseout="out('1564812142638062790');" style=""> 131         for (String fragment : fragments) {                                                              </span>
<span class="-5367054756288747777" onmouseenter="enter('-5367054756288747777');" onmouseout="out('-5367054756288747777');" style=""> 132             if (isCategoryTargetingRule(fragment)) {                                                     </span>
<span class="-734118791371905848" onmouseenter="enter('-734118791371905848');" onmouseout="out('-734118791371905848');" style=""> 133                 Long[] categoryIds = getCategoryIds(fragment);                                           </span>
<span class="-4909662740848112852" onmouseenter="enter('-4909662740848112852');" onmouseout="out('-4909662740848112852');" style=""> 134                 if (categoryIds != null) {                                                               </span>
<span class="1805589472251784818" onmouseenter="enter('1805589472251784818');" onmouseout="out('1805589472251784818');" style=""> 135                     String explicitCategoryFieldName = solrHelperService.getExplicitCategoryFieldName(); </span>
<span class="-5287974135799764925" onmouseenter="enter('-5287974135799764925');" onmouseout="out('-5287974135799764925');" style=""> 136                     StringBuilder categoryFilter = new StringBuilder(explicitCategoryFieldName + &quot;:(\&quot;&quot;);</span>
<span class="1721743067668120143" onmouseenter="enter('1721743067668120143');" onmouseout="out('1721743067668120143');" style=""> 137                     for (int i = 0; i &lt; categoryIds.length; i++) {                                       </span>
<span class="6049075465718997151" onmouseenter="enter('6049075465718997151');" onmouseout="out('6049075465718997151');" style=""> 138                         Long catId = solrHelperService.getCategoryId(categoryIds[i]);                    </span>
<span class="2247715214170223571" onmouseenter="enter('2247715214170223571');" onmouseout="out('2247715214170223571');" style=""> 139                         categoryFilter.append(catId);                                                    </span>
<span class="670628716832445201" onmouseenter="enter('670628716832445201');" onmouseout="out('670628716832445201');" style=""> 140                         if (i + 1 &lt; categoryIds.length) {                                                </span>
<span class="1110044106003867455" onmouseenter="enter('1110044106003867455');" onmouseout="out('1110044106003867455');" style=""> 141                             categoryFilter.append(&quot;,&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                     }                                                                                    </span>
<span class="1970759344659845383" onmouseenter="enter('1970759344659845383');" onmouseout="out('1970759344659845383');" style=""> 144                     categoryFilter.append(&quot;\&quot;)&quot;);                                                        </span>
<span class="4806920913497685296" onmouseenter="enter('4806920913497685296');" onmouseout="out('4806920913497685296');" style=""> 145                     filters.add(categoryFilter.toString());                                              </span>
<span  style=""> 146                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 148             } else {                                                                                     </span>
<span class="4472642083753197869" onmouseenter="enter('4472642083753197869');" onmouseout="out('4472642083753197869');" style=""> 149                 String fieldName = getCustomFieldPropertyName(fragment);                                 </span>
<span class="6767235149087130096" onmouseenter="enter('6767235149087130096');" onmouseout="out('6767235149087130096');" style=""> 150                 String fieldValue = getCustomFieldValue(fragment);                                       </span>
<span class="209342619518721793" onmouseenter="enter('209342619518721793');" onmouseout="out('209342619518721793');" style=""> 151                 boolean exclude = fragment.contains(&quot;!=&quot;) || fragment.startsWith(&quot;!&quot;);                   </span>
<span class="-513629237674612517" onmouseenter="enter('-513629237674612517');" onmouseout="out('-513629237674612517');" style=""> 152                 boolean isWildCardSearch = isWildCardSearch(fieldValue);                                 </span>
<span class="6416000241166527198" onmouseenter="enter('6416000241166527198');" onmouseout="out('6416000241166527198');" style=""> 153                 fieldName = convertFieldName(fieldName);                                                 </span>
<span class="-701725582702150457" onmouseenter="enter('-701725582702150457');" onmouseout="out('-701725582702150457');" style=""><abbr title=" 154                 List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(fieldName);"> 154                 List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPrðŸ”µ</abbr></span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 155 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-7551168459296007045" onmouseenter="enter('-7551168459296007045');" onmouseout="out('-7551168459296007045');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156                 boolean isCatalog = false;                                                               </span>
<span class="2262076950817925004" onmouseenter="enter('2262076950817925004');" onmouseout="out('2262076950817925004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157                 if(&quot;embeddableCatalogTenantDiscriminator.catalogDiscriminator&quot;.equals(fieldName)){       </span>
<span class="7360464894693146996" onmouseenter="enter('7360464894693146996');" onmouseout="out('7360464894693146996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158                     fieldName = solrHelperService.getCatalogFieldName();                                 </span>
<span class="5561389748107203889" onmouseenter="enter('5561389748107203889');" onmouseout="out('5561389748107203889');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159                     isCatalog = true;                                                                    </span>
<span class="1837365848624951645" onmouseenter="enter('1837365848624951645');" onmouseout="out('1837365848624951645');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160                     indexFieldTypes = new ArrayList&lt;&gt;();                                                 </span>
<span class="-1122114918514757495" onmouseenter="enter('-1122114918514757495');" onmouseout="out('-1122114918514757495');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161                     indexFieldTypes.add(new IndexFieldTypeImpl());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162                 }                                                                                        </span>
<span class="-2103872491504669162" onmouseenter="enter('-2103872491504669162');" onmouseout="out('-2103872491504669162');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163                 if (indexFieldTypes.size() &gt; 0) {                                                        </span>
<span class="7239065776429459040" onmouseenter="enter('7239065776429459040');" onmouseout="out('7239065776429459040');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 164                     Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField().getTranslatable();"> 164                     Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField(ðŸ”µ</abbr></span>
<span class="-1089691400420640956" onmouseenter="enter('-1089691400420640956');" onmouseout="out('-1089691400420640956');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165                     List&lt;Locale&gt; allLocales;                                                             </span>
<span class="-8810081931263659614" onmouseenter="enter('-8810081931263659614');" onmouseout="out('-8810081931263659614');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166                     if (translatable==null || !translatable) {                                           </span>
<span class="3172542301363761225" onmouseenter="enter('3172542301363761225');" onmouseout="out('3172542301363761225');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167                         allLocales = new ArrayList&lt;&gt;();                                                  </span>
<span class="8173230290853321992" onmouseenter="enter('8173230290853321992');" onmouseout="out('8173230290853321992');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168                         LocaleImpl e = new LocaleImpl();                                                 </span>
<span class="5086162913928278042" onmouseenter="enter('5086162913928278042');" onmouseout="out('5086162913928278042');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169                         e.setLocaleCode(&quot;&quot;);                                                             </span>
<span class="6078032241802864002" onmouseenter="enter('6078032241802864002');" onmouseout="out('6078032241802864002');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170                         allLocales.add(e);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171                     } else {                                                                             </span>
<span class="4255792891804321616" onmouseenter="enter('4255792891804321616');" onmouseout="out('4255792891804321616');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172                         allLocales = localeService.findAllLocales();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173                     }                                                                                    </span>
<span class="8261741881178153746" onmouseenter="enter('8261741881178153746');" onmouseout="out('8261741881178153746');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174                     List&lt;String&gt; tmpFilters = new ArrayList&lt;&gt;();                                         </span>
<span class="3584780802697725504" onmouseenter="enter('3584780802697725504');" onmouseout="out('3584780802697725504');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 175                     String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();"> 175                     String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getFieldðŸ”µ</abbr></span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176                     for (Locale locale : allLocales) {                                                   </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177                         for (IndexFieldType indexFieldType : indexFieldTypes) {                          </span>
<span class="-6544082423435460797" onmouseenter="enter('-6544082423435460797');" onmouseout="out('-6544082423435460797');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178                             String type = isCatalog ? &quot;&quot; :indexFieldType.getFieldType().getType();       </span>
<span class="-7046935955085981964" onmouseenter="enter('-7046935955085981964');" onmouseout="out('-7046935955085981964');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 179                             if (!isWildCardSearch || FieldType.STRING.getType().equals(type) || isCatalog) {"> 179                             if (!isWildCardSearch || FieldType.STRING.getType().equals(type) || isCatalogðŸ”µ</abbr></span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180                                 String prefix;                                                           </span>
<span class="7803706642416683862" onmouseenter="enter('7803706642416683862');" onmouseout="out('7803706642416683862');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181                                 if (StringUtils.isNotEmpty(locale.getLocaleCode())) {                    </span>
<span class="2867001838419777415" onmouseenter="enter('2867001838419777415');" onmouseout="out('2867001838419777415');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182                                     prefix = locale.getLocaleCode() + &quot;_&quot;;                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183                                 } else {                                                                 </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184                                     prefix = &quot;&quot;;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                                 }                                                                        </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186                                                                                                          </span>
<span class="-2334123318933248048" onmouseenter="enter('-2334123318933248048');" onmouseout="out('-2334123318933248048');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 187                                 String indexFieldName = isCatalog ? fieldName : (prefix + abbreviation + &quot;_&quot; + type);"> 187                                 String indexFieldName = isCatalog ? fieldName : (prefix + abbreviation + ðŸ”µ</abbr></span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 188 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 189 =======                                                                                                  </span>
<span class="-2103872491504669162" onmouseenter="enter('-2103872491504669162');" onmouseout="out('-2103872491504669162');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190                 if (indexFieldTypes.size() &gt; 0) {                                                        </span>
<span class="-3633847748226049075" onmouseenter="enter('-3633847748226049075');" onmouseout="out('-3633847748226049075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 191                     Boolean translatable = indexFieldTypes.get(0).getIndexField().getField().getTranslatable();"> 191                     Boolean translatable = indexFieldTypes.get(0).getIndexField().getField().getTranslataðŸ”µ</abbr></span>
<span class="-1089691400420640956" onmouseenter="enter('-1089691400420640956');" onmouseout="out('-1089691400420640956');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192                     List&lt;Locale&gt; allLocales;                                                             </span>
<span class="-8810081931263659614" onmouseenter="enter('-8810081931263659614');" onmouseout="out('-8810081931263659614');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193                     if (translatable==null || !translatable) {                                           </span>
<span class="3172542301363761225" onmouseenter="enter('3172542301363761225');" onmouseout="out('3172542301363761225');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194                         allLocales = new ArrayList&lt;&gt;();                                                  </span>
<span class="8173230290853321992" onmouseenter="enter('8173230290853321992');" onmouseout="out('8173230290853321992');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195                         LocaleImpl e = new LocaleImpl();                                                 </span>
<span class="5086162913928278042" onmouseenter="enter('5086162913928278042');" onmouseout="out('5086162913928278042');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196                         e.setLocaleCode(&quot;&quot;);                                                             </span>
<span class="6078032241802864002" onmouseenter="enter('6078032241802864002');" onmouseout="out('6078032241802864002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197                         allLocales.add(e);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                     } else {                                                                             </span>
<span class="4255792891804321616" onmouseenter="enter('4255792891804321616');" onmouseout="out('4255792891804321616');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199                         allLocales = localeService.findAllLocales();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200                     }                                                                                    </span>
<span class="8261741881178153746" onmouseenter="enter('8261741881178153746');" onmouseout="out('8261741881178153746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201                     List&lt;String&gt; tmpFilters = new ArrayList&lt;&gt;();                                         </span>
<span class="884995363436364062" onmouseenter="enter('884995363436364062');" onmouseout="out('884995363436364062');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 202                     String abbreviation = indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();"> 202                     String abbreviation = indexFieldTypes.get(0).getIndexField().getField().getAbbreviatiðŸ”µ</abbr></span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203                     for (Locale locale : allLocales) {                                                   </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204                         for (IndexFieldType indexFieldType : indexFieldTypes) {                          </span>
<span class="-3846951160350906445" onmouseenter="enter('-3846951160350906445');" onmouseout="out('-3846951160350906445');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205                             String type = indexFieldType.getFieldType().getType();                       </span>
<span class="7549083283832157055" onmouseenter="enter('7549083283832157055');" onmouseout="out('7549083283832157055');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206                             if (!isWildCardSearch || FieldType.STRING.getType().equals(type)) {          </span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207                                 String prefix;                                                           </span>
<span class="7803706642416683862" onmouseenter="enter('7803706642416683862');" onmouseout="out('7803706642416683862');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208                                 if (StringUtils.isNotEmpty(locale.getLocaleCode())) {                    </span>
<span class="2867001838419777415" onmouseenter="enter('2867001838419777415');" onmouseout="out('2867001838419777415');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                                     prefix = locale.getLocaleCode() + &quot;_&quot;;                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210                                 } else {                                                                 </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211                                     prefix = &quot;&quot;;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212                                 }                                                                        </span>
<span class="3385923284549100959" onmouseenter="enter('3385923284549100959');" onmouseout="out('3385923284549100959');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213                                 String indexFieldName = prefix + abbreviation + &quot;_&quot; + type;              </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 214 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 215                                                                                                          </span>
<span class="347763688069478794" onmouseenter="enter('347763688069478794');" onmouseout="out('347763688069478794');" style=""><abbr title=" 216                                 // if this is a wildcard search then we do not want to surround the value with quotes"> 216                                 // if this is a wildcard search then we do not want to surround the valueðŸ”µ</abbr></span>
<span class="-2654901131124248979" onmouseenter="enter('-2654901131124248979');" onmouseout="out('-2654901131124248979');" style=""> 217                                 String indexFieldValue = fieldValue;                                     </span>
<span class="2562112514760316298" onmouseenter="enter('2562112514760316298');" onmouseout="out('2562112514760316298');" style=""> 218                                 if (!isWildCardSearch &amp;&amp; !fieldValue.equals(&quot;null&quot;)) {                   </span>
<span class="6375595447189419464" onmouseenter="enter('6375595447189419464');" onmouseout="out('6375595447189419464');" style=""> 219                                     if(fieldValue.contains(&quot;\&quot;,\&quot;&quot;)){                                    </span>
<span class="-5010949076906240822" onmouseenter="enter('-5010949076906240822');" onmouseout="out('-5010949076906240822');" style=""> 220                                         indexFieldValue = &quot;(\&quot;&quot; + fieldValue + &quot;\&quot;)&quot;;                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 221                                     }else {                                                              </span>
<span class="519269224162677901" onmouseenter="enter('519269224162677901');" onmouseout="out('519269224162677901');" style=""> 222                                         indexFieldValue = &quot;\&quot;&quot; + fieldValue + &quot;\&quot;&quot;;                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223                                     }                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224                                 }                                                                        </span>
<span  style=""> 225                                                                                                          </span>
<span class="7698560569635945367" onmouseenter="enter('7698560569635945367');" onmouseout="out('7698560569635945367');" style=""> 226                                 String filter;                                                           </span>
<span class="8917473174740260176" onmouseenter="enter('8917473174740260176');" onmouseout="out('8917473174740260176');" style=""> 227                                 if (indexFieldValue.equals(&quot;null&quot;)) {                                    </span>
<span class="-2294577368288257511" onmouseenter="enter('-2294577368288257511');" onmouseout="out('-2294577368288257511');" style=""> 228                                     // this is for checking if null or non-existent fields               </span>
<span class="2225974712227568097" onmouseenter="enter('2225974712227568097');" onmouseout="out('2225974712227568097');" style=""> 229                                     filter = &quot;(*:* AND -&quot; + indexFieldName + &quot;:[* TO *])&quot;;               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 230                                 } else {                                                                 </span>
<span class="5648282257784433574" onmouseenter="enter('5648282257784433574');" onmouseout="out('5648282257784433574');" style=""> 231                                     filter = indexFieldName + &quot;:&quot; + indexFieldValue;                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232                                 }                                                                        </span>
<span  style=""> 233                                                                                                          </span>
<span class="-2619174266387061747" onmouseenter="enter('-2619174266387061747');" onmouseout="out('-2619174266387061747');" style=""> 234                                 if (exclude) {                                                           </span>
<span class="-5595087398256543047" onmouseenter="enter('-5595087398256543047');" onmouseout="out('-5595087398256543047');" style=""> 235                                     filter = &quot;NOT &quot; + filter;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236                                 }                                                                        </span>
<span  style=""> 237                                                                                                          </span>
<span class="5890716202638474450" onmouseenter="enter('5890716202638474450');" onmouseout="out('5890716202638474450');" style=""> 238                                 tmpFilters.add(filter);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                     }                                                                                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="-5970112842789367779" onmouseenter="enter('-5970112842789367779');" onmouseout="out('-5970112842789367779');" style=""> 243                     if (!exclude) {                                                                      </span>
<span class="4467181224644464926" onmouseenter="enter('4467181224644464926');" onmouseout="out('4467181224644464926');" style=""><abbr title=" 244                         //any of translation and type fields like en_name_tsy, en_name_s etc can match, so concatinate with OR"> 244                         //any of translation and type fields like en_name_tsy, en_name_s etc can match, sðŸ”µ</abbr></span>
<span  style=""> 245                                                                                                          </span>
<span class="-4629588024542266762" onmouseenter="enter('-4629588024542266762');" onmouseout="out('-4629588024542266762');" style=""> 246                         String s = tmpFilters.get(0);                                                    </span>
<span class="6592156823824166930" onmouseenter="enter('6592156823824166930');" onmouseout="out('6592156823824166930');" style=""> 247                         s = &quot;(&quot; + s;                                                                     </span>
<span class="-3902582789072783276" onmouseenter="enter('-3902582789072783276');" onmouseout="out('-3902582789072783276');" style=""> 248                         tmpFilters.set(0, s);                                                            </span>
<span class="-5094388359174835017" onmouseenter="enter('-5094388359174835017');" onmouseout="out('-5094388359174835017');" style=""> 249                         int size = tmpFilters.size() - 1;                                                </span>
<span class="-4545560731951074490" onmouseenter="enter('-4545560731951074490');" onmouseout="out('-4545560731951074490');" style=""> 250                         String s1 = tmpFilters.get(size);                                                </span>
<span class="7346319824215495439" onmouseenter="enter('7346319824215495439');" onmouseout="out('7346319824215495439');" style=""> 251                         s1 = s1 + &quot;)&quot;;                                                                   </span>
<span class="-3192110405084466359" onmouseenter="enter('-3192110405084466359');" onmouseout="out('-3192110405084466359');" style=""> 252                         tmpFilters.set(size, s1);                                                        </span>
<span class="2457502907598950300" onmouseenter="enter('2457502907598950300');" onmouseout="out('2457502907598950300');" style=""> 253                         filters.add(StringUtils.join(tmpFilters, &quot; OR &quot;));                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 254                     } else {                                                                             </span>
<span class="-4161188039224121088" onmouseenter="enter('-4161188039224121088');" onmouseout="out('-4161188039224121088');" style=""> 255                         //if we exclude we don&#x27;t want to see if at all so &quot;AND&quot; is ok                    </span>
<span class="-3843688481962930223" onmouseenter="enter('-3843688481962930223');" onmouseout="out('-3843688481962930223');" style=""> 256                         filters.addAll(tmpFilters);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257                     }                                                                                    </span>
<span class="-2060121676001122986" onmouseenter="enter('-2060121676001122986');" onmouseout="out('-2060121676001122986');" style=""> 258                     if (org.apache.commons.collections4.CollectionUtils.isEmpty(indexFieldTypes)) {      </span>
<span class="-777810702412233183" onmouseenter="enter('-777810702412233183');" onmouseout="out('-777810702412233183');" style=""> 259                         if (fieldName.contains(&quot;catalogDiscriminator&quot;)) {                                </span>
<span class="-7659514470241775465" onmouseenter="enter('-7659514470241775465');" onmouseout="out('-7659514470241775465');" style=""> 260                             String substring = fieldValue.substring(1, fieldValue.length() - 1);         </span>
<span class="475599518347961544" onmouseenter="enter('475599518347961544');" onmouseout="out('475599518347961544');" style=""> 261                             filters.add(&quot;catalog_s:(&quot; + substring + &quot;)&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 264                 } else {                                                                                 </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style=""> 265                     return Collections.emptyList();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268         }                                                                                                </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style=""> 269         if (allRulesMustBeTrue) {                                                                        </span>
<span class="6161622804982278326" onmouseenter="enter('6161622804982278326');" onmouseout="out('6161622804982278326');" style=""> 270             return filters;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 271         } else {                                                                                         </span>
<span class="-9109774989809899377" onmouseenter="enter('-9109774989809899377');" onmouseout="out('-9109774989809899377');" style=""> 272             return Collections.singletonList(StringUtils.join(filters, &quot; OR &quot;));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274     }                                                                                                    </span>
<span  style=""> 275                                                                                                          </span>
<span class="-5406295445993856151" onmouseenter="enter('-5406295445993856151');" onmouseout="out('-5406295445993856151');" style=""> 276     protected String convertFieldName(String fieldName) {                                                </span>
<span class="-7966506343162908990" onmouseenter="enter('-7966506343162908990');" onmouseout="out('-7966506343162908990');" style=""> 277         String result = fieldName;                                                                       </span>
<span class="-4930215839282778035" onmouseenter="enter('-4930215839282778035');" onmouseout="out('-4930215839282778035');" style=""> 278         if (fieldName.startsWith(&quot;product.&quot;)) {                                                          </span>
<span class="-2221476328782692373" onmouseenter="enter('-2221476328782692373');" onmouseout="out('-2221476328782692373');" style=""> 279             result = fieldName.substring(&quot;product.&quot;.length());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span class="-4762333987006846107" onmouseenter="enter('-4762333987006846107');" onmouseout="out('-4762333987006846107');" style=""> 281         if (result.endsWith(&quot;()&quot;)) {                                                                     </span>
<span class="-7370088352248235065" onmouseenter="enter('-7370088352248235065');" onmouseout="out('-7370088352248235065');" style=""> 282             result = parseMethod(result);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283         }                                                                                                </span>
<span class="-6976750953326715195" onmouseenter="enter('-6976750953326715195');" onmouseout="out('-6976750953326715195');" style=""> 284         result = result.replaceAll(&quot;\\?&quot;, &quot;&quot;);                                                           </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 285         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 288     /**                                                                                                  </span>
<span class="-4961595856674117509" onmouseenter="enter('-4961595856674117509');" onmouseout="out('-4961595856674117509');" style=""><abbr title=" 289      * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an attribute."> 289      * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an atðŸ”µ</abbr></span>
<span class="-9122028151948342763" onmouseenter="enter('-9122028151948342763');" onmouseout="out('-9122028151948342763');" style=""> 290      * Currently supports getX() methods                                                                 </span>
<span class="-1753930683541957258" onmouseenter="enter('-1753930683541957258');" onmouseout="out('-1753930683541957258');" style=""> 291      * For example, getType() -&gt; type                                                                    </span>
<span class="3732359556928566541" onmouseenter="enter('3732359556928566541');" onmouseout="out('3732359556928566541');" style=""> 292      * @param fieldName                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 293      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 294      */                                                                                                  </span>
<span class="-2963220266002726124" onmouseenter="enter('-2963220266002726124');" onmouseout="out('-2963220266002726124');" style=""> 295     protected String parseMethod(String fieldName) {                                                     </span>
<span class="-8263038990718822145" onmouseenter="enter('-8263038990718822145');" onmouseout="out('-8263038990718822145');" style=""> 296         String[] segments = fieldName.split(&quot;\\.&quot;);                                                      </span>
<span class="-2872844272696595425" onmouseenter="enter('-2872844272696595425');" onmouseout="out('-2872844272696595425');" style=""> 297         //parse the last segment removing the method prefix (e.g. get)                                   </span>
<span class="-6508141212304130711" onmouseenter="enter('-6508141212304130711');" onmouseout="out('-6508141212304130711');" style=""> 298         String methodSegment = segments[segments.length-1].replaceFirst(&quot;(^get)&quot;, &quot;&quot;);                   </span>
<span class="8940076855127072513" onmouseenter="enter('8940076855127072513');" onmouseout="out('8940076855127072513');" style=""> 299         //lowercase first char and remove the ()                                                         </span>
<span class="-6069661116746750678" onmouseenter="enter('-6069661116746750678');" onmouseout="out('-6069661116746750678');" style=""><abbr title=" 300         segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.substring(1, methodSegment.length() - 2);"> 300         segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.suðŸ”µ</abbr></span>
<span class="918919278535989799" onmouseenter="enter('918919278535989799');" onmouseout="out('918919278535989799');" style=""> 301         return String.join(&quot;.&quot;, segments);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302     }                                                                                                    </span>
<span  style=""> 303                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 304     /**                                                                                                  </span>
<span class="-7802570112181619959" onmouseenter="enter('-7802570112181619959');" onmouseout="out('-7802570112181619959');" style=""><abbr title=" 305      * Determines if the given field value string represents a wild card search. In Solr a wild card search either"> 305      * Determines if the given field value string represents a wild card search. In Solr a wild card searðŸ”µ</abbr></span>
<span class="-5470509459016141827" onmouseenter="enter('-5470509459016141827');" onmouseout="out('-5470509459016141827');" style=""> 306      * starts or ends with an asterisk.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 307      *                                                                                                   </span>
<span class="1221169641673317670" onmouseenter="enter('1221169641673317670');" onmouseout="out('1221169641673317670');" style=""> 308      * @param fieldValue the String field value                                                          </span>
<span class="-1593611972444689897" onmouseenter="enter('-1593611972444689897');" onmouseout="out('-1593611972444689897');" style=""> 309      * @return whether the value is for a wildcard search                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 310      */                                                                                                  </span>
<span class="4130318305105801360" onmouseenter="enter('4130318305105801360');" onmouseout="out('4130318305105801360');" style=""> 311     protected boolean isWildCardSearch(String fieldValue) {                                              </span>
<span class="-2660305773917818782" onmouseenter="enter('-2660305773917818782');" onmouseout="out('-2660305773917818782');" style=""> 312         return fieldValue.startsWith(&quot;*&quot;) || fieldValue.endsWith(&quot;*&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313     }                                                                                                    </span>
<span  style=""> 314                                                                                                          </span>
<span class="-3996318941156881450" onmouseenter="enter('-3996318941156881450');" onmouseout="out('-3996318941156881450');" style=""> 315     protected String getCustomFieldPropertyName(String mvelRule) {                                       </span>
<span class="3679211462672518298" onmouseenter="enter('3679211462672518298');" onmouseout="out('3679211462672518298');" style=""> 316         if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                                      </span>
<span class="-6513848732372278546" onmouseenter="enter('-6513848732372278546');" onmouseout="out('-6513848732372278546');" style=""> 317             //assuming left param is field, right is value                                               </span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style=""> 318             int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                      </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style=""> 319             int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                        </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style=""> 320             mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321         }                                                                                                </span>
<span class="1481037596687278193" onmouseenter="enter('1481037596687278193');" onmouseout="out('1481037596687278193');" style=""> 322         if (mvelRule.indexOf(&quot;[\&quot;&quot;) &gt; 0) {                                                               </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style=""> 323             int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                </span>
<span class="3450072205155988404" onmouseenter="enter('3450072205155988404');" onmouseout="out('3450072205155988404');" style=""> 324             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;]&quot;);                                                  </span>
<span  style=""> 325                                                                                                          </span>
<span class="791618933684830826" onmouseenter="enter('791618933684830826');" onmouseout="out('791618933684830826');" style=""> 326             return mvelRule.substring(startIndex, endIndex);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 327         } else {                                                                                         </span>
<span class="-599506282736455606" onmouseenter="enter('-599506282736455606');" onmouseout="out('-599506282736455606');" style=""><abbr title=" 328             if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;.startsWith&quot;) || mvelRule.contains(&quot;.endsWith&quot;)) {"> 328             if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;ðŸ”µ</abbr></span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style=""> 329                 int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                  </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style=""> 330                 int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                    </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style=""> 331                 mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332             }                                                                                            </span>
<span class="-2959351049191408844" onmouseenter="enter('-2959351049191408844');" onmouseout="out('-2959351049191408844');" style=""> 333             mvelRule = getRuleOrPropertyFromFunction(mvelRule);                                          </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style=""> 334             return mvelRule;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336     }                                                                                                    </span>
<span  style=""> 337                                                                                                          </span>
<span class="-5748560392795934189" onmouseenter="enter('-5748560392795934189');" onmouseout="out('-5748560392795934189');" style=""> 338     protected String getRuleOrPropertyFromFunction(String mvelRule) {                                    </span>
<span class="8079645033185490153" onmouseenter="enter('8079645033185490153');" onmouseout="out('8079645033185490153');" style=""> 339         int i = mvelRule.indexOf(&#x27;(&#x27;);                                                                   </span>
<span class="6118269285616949201" onmouseenter="enter('6118269285616949201');" onmouseout="out('6118269285616949201');" style=""> 340         int j = mvelRule.indexOf(&#x27;)&#x27;, i);                                                                </span>
<span  style=""> 341                                                                                                          </span>
<span class="-6286405257340566993" onmouseenter="enter('-6286405257340566993');" onmouseout="out('-6286405257340566993');" style=""> 342         //no function or maybe just some function? like xxx.xxx.getType()                                </span>
<span class="-6214758649886002427" onmouseenter="enter('-6214758649886002427');" onmouseout="out('-6214758649886002427');" style=""> 343         if (i == j || j == i + 1) {                                                                      </span>
<span class="-7679877352652422097" onmouseenter="enter('-7679877352652422097');" onmouseout="out('-7679877352652422097');" style=""> 344             //expect to have either == or !=                                                             </span>
<span class="3716522410886362712" onmouseenter="enter('3716522410886362712');" onmouseout="out('3716522410886362712');" style=""> 345             int exclamationMark = mvelRule.indexOf(&quot;!&quot;);                                                 </span>
<span class="-1238738714139750554" onmouseenter="enter('-1238738714139750554');" onmouseout="out('-1238738714139750554');" style=""> 346             if (exclamationMark &gt; 0) {                                                                   </span>
<span class="-4221725366469559006" onmouseenter="enter('-4221725366469559006');" onmouseout="out('-4221725366469559006');" style=""> 347                 return mvelRule.substring(0, exclamationMark);                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 348             } else {                                                                                     </span>
<span class="7053255170774622248" onmouseenter="enter('7053255170774622248');" onmouseout="out('7053255170774622248');" style=""> 349                 int equalsSign = mvelRule.indexOf(&quot;=&quot;);                                                  </span>
<span class="2892411250985260390" onmouseenter="enter('2892411250985260390');" onmouseout="out('2892411250985260390');" style=""> 350                 if (equalsSign &gt; 0) {                                                                    </span>
<span class="-303051360151549224" onmouseenter="enter('-303051360151549224');" onmouseout="out('-303051360151549224');" style=""> 351                     return mvelRule.substring(0, equalsSign);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352                 }                                                                                        </span>
<span class="2254302976129981489" onmouseenter="enter('2254302976129981489');" onmouseout="out('2254302976129981489');" style=""> 353                 //unknown format                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 355         } else {                                                                                         </span>
<span class="-8922669227095711265" onmouseenter="enter('-8922669227095711265');" onmouseout="out('-8922669227095711265');" style=""> 356             //looks like some function ?                                                                 </span>
<span class="724941001380407750" onmouseenter="enter('724941001380407750');" onmouseout="out('724941001380407750');" style=""> 357             Pattern pattern = Pattern.compile(&quot;\\([^!=]+\\)&quot;);                                           </span>
<span class="-6113564736220007098" onmouseenter="enter('-6113564736220007098');" onmouseout="out('-6113564736220007098');" style=""> 358             Matcher matcher = pattern.matcher(mvelRule);                                                 </span>
<span class="3484832867986496608" onmouseenter="enter('3484832867986496608');" onmouseout="out('3484832867986496608');" style=""> 359             if (matcher.find()) {                                                                        </span>
<span class="-7610571215329733446" onmouseenter="enter('-7610571215329733446');" onmouseout="out('-7610571215329733446');" style=""> 360                 String group = matcher.group();                                                          </span>
<span class="-8079573508343865500" onmouseenter="enter('-8079573508343865500');" onmouseout="out('-8079573508343865500');" style=""> 361                 return group.substring(1, group.length() - 1);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362             }                                                                                            </span>
<span  style=""> 363                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style=""> 365         return mvelRule;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366     }                                                                                                    </span>
<span  style=""> 367                                                                                                          </span>
<span class="6100636727859994582" onmouseenter="enter('6100636727859994582');" onmouseout="out('6100636727859994582');" style=""> 368     protected String getCustomFieldValue(String mvelRule) {                                              </span>
<span class="-3319890485526010677" onmouseenter="enter('-3319890485526010677');" onmouseout="out('-3319890485526010677');" style=""> 369         String customFieldValue = &quot;&quot;;                                                                    </span>
<span class="4516873309033909875" onmouseenter="enter('4516873309033909875');" onmouseout="out('4516873309033909875');" style=""> 370         if (mvelRule.contains(&quot;.contains&quot;)) {                                                            </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 371             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 372             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span  style=""> 373                                                                                                          </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 374             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="-5613902323637665591" onmouseenter="enter('-5613902323637665591');" onmouseout="out('-5613902323637665591');" style=""> 375         } else if (mvelRule.contains(&quot;==\&quot;&quot;) || mvelRule.contains(&quot;!=\&quot;&quot;)) {                             </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style=""> 376             int startIndex;                                                                              </span>
<span class="1954124054498899570" onmouseenter="enter('1954124054498899570');" onmouseout="out('1954124054498899570');" style=""> 377             int endIndex;                                                                                </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style=""> 378             if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                      </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style=""> 379                 startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="5123844857779866826" onmouseenter="enter('5123844857779866826');" onmouseout="out('5123844857779866826');" style=""> 380                 endIndex = mvelRule.lastIndexOf(&quot;\&quot;)&quot;);                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 381             } else {                                                                                     </span>
<span class="-8607486389615378476" onmouseenter="enter('-8607486389615378476');" onmouseout="out('-8607486389615378476');" style=""> 382                 startIndex = mvelRule.indexOf(&quot;==\&quot;&quot;) + 3;                                               </span>
<span class="6650538524451873352" onmouseenter="enter('6650538524451873352');" onmouseout="out('6650538524451873352');" style=""> 383                 endIndex = mvelRule.lastIndexOf(&quot;\&quot;&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384             }                                                                                            </span>
<span  style=""> 385                                                                                                          </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 386             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="-6310515578280121309" onmouseenter="enter('-6310515578280121309');" onmouseout="out('-6310515578280121309');" style=""> 387         } else if (mvelRule.contains(&quot;==&quot;) || mvelRule.contains(&quot;!=&quot;)) {                                 </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style=""> 388             int startIndex;                                                                              </span>
<span class="-243764101696257862" onmouseenter="enter('-243764101696257862');" onmouseout="out('-243764101696257862');" style=""> 389             int endIndex = mvelRule.length();                                                            </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style=""> 390             if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                      </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style=""> 391                 startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-8058284614077640064" onmouseenter="enter('-8058284614077640064');" onmouseout="out('-8058284614077640064');" style=""> 392                 endIndex = mvelRule.indexOf(&quot;\&quot;)&quot;, startIndex);                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 393             } else {                                                                                     </span>
<span class="6529493184259506230" onmouseenter="enter('6529493184259506230');" onmouseout="out('6529493184259506230');" style=""> 394                 int i = mvelRule.indexOf(&quot;==&quot;);                                                          </span>
<span class="81359043772452968" onmouseenter="enter('81359043772452968');" onmouseout="out('81359043772452968');" style=""> 395                 if (i &gt; 0) {                                                                             </span>
<span class="-4065973875162371300" onmouseenter="enter('-4065973875162371300');" onmouseout="out('-4065973875162371300');" style=""> 396                     startIndex = i + 2;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 397                 } else {                                                                                 </span>
<span class="-3645933873055406183" onmouseenter="enter('-3645933873055406183');" onmouseout="out('-3645933873055406183');" style=""> 398                     startIndex = mvelRule.indexOf(&quot;!=&quot;) + 2;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400             }                                                                                            </span>
<span  style=""> 401                                                                                                          </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 402             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="2218296394576932022" onmouseenter="enter('2218296394576932022');" onmouseout="out('2218296394576932022');" style=""> 403         } else if (mvelRule.contains(&quot;.startsWith&quot;)) {                                                   </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 404             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 405             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span  style=""> 406                                                                                                          </span>
<span class="4581944832870405683" onmouseenter="enter('4581944832870405683');" onmouseout="out('4581944832870405683');" style=""> 407             customFieldValue = mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;) + &quot;*&quot;;    </span>
<span class="-8060497764326038311" onmouseenter="enter('-8060497764326038311');" onmouseout="out('-8060497764326038311');" style=""> 408         } else if (mvelRule.contains(&quot;.endsWith&quot;)) {                                                     </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 409             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 410             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span  style=""> 411                                                                                                          </span>
<span class="-7671395845858615235" onmouseenter="enter('-7671395845858615235');" onmouseout="out('-7671395845858615235');" style=""> 412             customFieldValue = &quot;*&quot; + mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;);    </span>
<span class="2520893722587110945" onmouseenter="enter('2520893722587110945');" onmouseout="out('2520893722587110945');" style=""> 413         } else if (mvelRule.contains(&quot;==null&quot;)) {                                                        </span>
<span class="2478736060735144080" onmouseenter="enter('2478736060735144080');" onmouseout="out('2478736060735144080');" style=""> 414             // this means we have an &quot;is blank&quot; rule                                                     </span>
<span class="7951176582520491354" onmouseenter="enter('7951176582520491354');" onmouseout="out('7951176582520491354');" style=""> 415             customFieldValue = &quot;null&quot;;                                                                   </span>
<span class="8024335045226449466" onmouseenter="enter('8024335045226449466');" onmouseout="out('8024335045226449466');" style=""> 416         } else if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                               </span>
<span class="3487470046753460976" onmouseenter="enter('3487470046753460976');" onmouseout="out('3487470046753460976');" style=""> 417             int startIndex = mvelRule.indexOf(&quot;,&quot;);                                                      </span>
<span class="4188065660318946716" onmouseenter="enter('4188065660318946716');" onmouseout="out('4188065660318946716');" style=""> 418             int endIndex = mvelRule.indexOf(&quot;)&quot;, startIndex);                                            </span>
<span class="-6758459872216563699" onmouseenter="enter('-6758459872216563699');" onmouseout="out('-6758459872216563699');" style=""> 419             customFieldValue = mvelRule.substring(startIndex + 1, endIndex);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span class="3465129211023044589" onmouseenter="enter('3465129211023044589');" onmouseout="out('3465129211023044589');" style=""> 421         //maybe it is something like [x,x1,x2]? -&gt; (x,x1,x2), or [x1]-&gt;x1                                </span>
<span class="4392933608627202925" onmouseenter="enter('4392933608627202925');" onmouseout="out('4392933608627202925');" style=""> 422         if (customFieldValue.startsWith(&quot;[&quot;) &amp;&amp; customFieldValue.endsWith(&quot;]&quot;)) {                        </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style=""> 423                 customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);         </span>
<span class="2068942897632961350" onmouseenter="enter('2068942897632961350');" onmouseout="out('2068942897632961350');" style=""> 424                 if(customFieldValue.startsWith(&quot;\&quot;&quot;) &amp;&amp; customFieldValue.endsWith(&quot;\&quot;&quot;)){                </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style=""> 425                     customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427         }                                                                                                </span>
<span class="2343498638185968541" onmouseenter="enter('2343498638185968541');" onmouseout="out('2343498638185968541');" style=""> 428         return customFieldValue;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429     }                                                                                                    </span>
<span  style=""> 430                                                                                                          </span>
<span  style=""> 431                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432 }                                                                                                        </span>





























</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3  * BroadleafCommerce Common Libraries                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4511052683777238249" onmouseenter="enter('-4511052683777238249');" onmouseout="out('-4511052683777238249');" style="">  18 package org.broadleafcommerce.core.search.service.solr;                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  24 import org.broadleafcommerce.common.locale.domain.Locale;                                                </span>
<span class="-4699531719896516827" onmouseenter="enter('-4699531719896516827');" onmouseout="out('-4699531719896516827');" style="">  25 import org.broadleafcommerce.common.locale.domain.LocaleImpl;                                            </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  26 import org.broadleafcommerce.common.locale.service.LocaleService;                                        </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  27 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  28 import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                              </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  29 import org.broadleafcommerce.core.search.domain.IndexFieldType;                                          </span>
<span class="8917647116637261149" onmouseenter="enter('8917647116637261149');" onmouseout="out('8917647116637261149');" style="">  30 import org.broadleafcommerce.core.search.domain.IndexFieldTypeImpl;                                      </span>
<span class="3348214099427628787" onmouseenter="enter('3348214099427628787');" onmouseout="out('3348214099427628787');" style="">  31 import org.broadleafcommerce.core.search.domain.SearchCriteria;                                          </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  32 import org.broadleafcommerce.core.search.domain.solr.FieldType;                                          </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  33 import org.springframework.stereotype.Service;                                                           </span>
<span  style="">  34                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  35 import java.util.ArrayList;                                                                              </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  36 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  37 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38 import java.util.List;                                                                                   </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  39 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  40 import java.util.regex.Pattern;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  42 import javax.annotation.Resource;                                                                        </span>
<span  style="">  43                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  44 /**                                                                                                      </span>
<span class="-6557419552958427102" onmouseenter="enter('-6557419552958427102');" onmouseout="out('-6557419552958427102');" style="">  45  * Convenience methods for converting simple MVEL rules to Solr SearchCriteria                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  46  *                                                                                                       </span>
<span class="7828829262991528260" onmouseenter="enter('7828829262991528260');" onmouseout="out('7828829262991528260');" style="">  47  * @author Chris Kittrell (ckittrell)                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48  */                                                                                                      </span>
<span class="-5751247617688848665" onmouseenter="enter('-5751247617688848665');" onmouseout="out('-5751247617688848665');" style="">  49 @Service(&quot;blMvelToSearchCriteriaConversionService&quot;)                                                      </span>
<span class="7329482801380297950" onmouseenter="enter('7329482801380297950');" onmouseout="out('7329482801380297950');" style="">  50 public class MvelToSearchCriteriaConversionServiceImpl implements MvelToSearchCriteriaConversionService {</span>
<span  style="">  51                                                                                                          </span>
<span class="5180464717700805782" onmouseenter="enter('5180464717700805782');" onmouseout="out('5180464717700805782');" style="">  52     private static final Log LOG = LogFactory.getLog(MvelToSearchCriteriaConversionServiceImpl.class);   </span>
<span  style="">  53                                                                                                          </span>
<span class="-970930589962964105" onmouseenter="enter('-970930589962964105');" onmouseout="out('-970930589962964105');" style=""><abbr title="  54     public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCategoryIds,\\[\\\&quot;([0-9]+)(,\\\&quot;[0-9]+\\\&quot;)*\\\&quot;\\]\\)\\.size\\(\\)&gt;0$&quot;;">  54     public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?alðŸ”µ</abbr></span>
<span  style="">  55                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  56     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  57     protected CatalogService catalogService;                                                             </span>
<span  style="">  58                                                                                                          </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style="">  59     @Resource(name = &quot;blIndexFieldDao&quot;)                                                                  </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style="">  60     protected IndexFieldDao indexFieldDao;                                                               </span>
<span  style="">  61                                                                                                          </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style="">  62     @Resource(name = &quot;blLocaleService&quot;)                                                                  </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style="">  63     protected LocaleService localeService;                                                               </span>
<span  style="">  64                                                                                                          </span>
<span class="-8412875699496826705" onmouseenter="enter('-8412875699496826705');" onmouseout="out('-8412875699496826705');" style="">  65     @Resource(name=&quot;blSolrHelperService&quot;)                                                                </span>
<span class="-6899732035501197192" onmouseenter="enter('-6899732035501197192');" onmouseout="out('-6899732035501197192');" style="">  66     protected SolrHelperService solrHelperService;                                                       </span>
<span  style="">  67                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  68     @Override                                                                                            </span>
<span class="8517769271291085647" onmouseenter="enter('8517769271291085647');" onmouseout="out('8517769271291085647');" style="">  69     public SearchCriteria convert(String mvelRule) {                                                     </span>
<span class="-3804295702574698939" onmouseenter="enter('-3804295702574698939');" onmouseout="out('-3804295702574698939');" style="">  70         SearchCriteria criteria = new SearchCriteria();                                                  </span>
<span class="-173756114249607612" onmouseenter="enter('-173756114249607612');" onmouseout="out('-173756114249607612');" style="">  71         criteria.setPageSize(Integer.MAX_VALUE);                                                         </span>
<span  style="">  72                                                                                                          </span>
<span class="-5354029622989309350" onmouseenter="enter('-5354029622989309350');" onmouseout="out('-5354029622989309350');" style="">  73         if (isProductRule(mvelRule) || isCategoryTargetingRule(mvelRule)) {                              </span>
<span class="3271724963188919231" onmouseenter="enter('3271724963188919231');" onmouseout="out('3271724963188919231');" style="">  74             Collection&lt;String&gt; strings = convertRuleToFilters(mvelRule);                                 </span>
<span class="-4712490940242734116" onmouseenter="enter('-4712490940242734116');" onmouseout="out('-4712490940242734116');" style="">  75             criteria.setFilterQueries(strings);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  76         } else {                                                                                         </span>
<span class="-1053745767754751717" onmouseenter="enter('-1053745767754751717');" onmouseout="out('-1053745767754751717');" style=""><abbr title="  77             throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using Rules &quot; +">  77             throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using RðŸ”µ</abbr></span>
<span class="-5527057582948710822" onmouseenter="enter('-5527057582948710822');" onmouseout="out('-5527057582948710822');" style=""><abbr title="  78                     &quot;(Conditional Rules) and selected rule can&#x27;t be translated to solr criteria and so &quot; +">  78                     &quot;(Conditional Rules) and selected rule can&#x27;t be translated to solr criteria and so &quot; ðŸ”µ</abbr></span>
<span class="-622187049424662407" onmouseenter="enter('-622187049424662407');" onmouseout="out('-622187049424662407');" style=""><abbr title="  79                     &quot;does not support selection of a Default Product. See Tooltip for supported rule details&quot;);">  79                     &quot;does not support selection of a Default Product. See Tooltip for supported rule detaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80         }                                                                                                </span>
<span  style="">  81                                                                                                          </span>
<span class="-6542614039530216187" onmouseenter="enter('-6542614039530216187');" onmouseout="out('-6542614039530216187');" style="">  82         return criteria;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83     }                                                                                                    </span>
<span  style="">  84                                                                                                          </span>
<span class="-1196261502723734502" onmouseenter="enter('-1196261502723734502');" onmouseout="out('-1196261502723734502');" style="">  85     protected boolean isProductRule(String rule){                                                        </span>
<span class="-5300376996092551927" onmouseenter="enter('-5300376996092551927');" onmouseout="out('-5300376996092551927');" style="">  86         return rule.contains(&quot;product.&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87     }                                                                                                    </span>
<span  style="">  88                                                                                                          </span>
<span class="7766953117726329902" onmouseenter="enter('7766953117726329902');" onmouseout="out('7766953117726329902');" style="">  89     protected boolean isCustomFieldIndexed(List&lt;IndexFieldType&gt; indexFieldTypes) {                       </span>
<span class="-7835921473874723009" onmouseenter="enter('-7835921473874723009');" onmouseout="out('-7835921473874723009');" style="">  90         return CollectionUtils.isNotEmpty(indexFieldTypes);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style=""><abbr title="  93     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0">  93     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;ðŸ”µ</abbr></span>
<span class="8608097822218680501" onmouseenter="enter('8608097822218680501');" onmouseout="out('8608097822218680501');" style="">  94     protected boolean isCategoryTargetingRule(String mvelRule) {                                         </span>
<span class="395583072845222703" onmouseenter="enter('395583072845222703');" onmouseout="out('395583072845222703');" style="">  95         return mvelRule.matches(CATEGORY_FORMAT_REGEX);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="-4578046640382617025" onmouseenter="enter('-4578046640382617025');" onmouseout="out('-4578046640382617025');" style=""><abbr title="  98     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;,...]).size()&gt;0">  98     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;ðŸ”µ</abbr></span>
<span class="4479154694055573719" onmouseenter="enter('4479154694055573719');" onmouseout="out('4479154694055573719');" style="">  99     protected Long[] getCategoryIds(String mvelRule) {                                                   </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style=""> 100         int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                    </span>
<span class="7462371261616726470" onmouseenter="enter('7462371261616726470');" onmouseout="out('7462371261616726470');" style=""> 101         int endIndex = mvelRule.indexOf(&quot;\&quot;]&quot;);                                                          </span>
<span class="-5169574352696925622" onmouseenter="enter('-5169574352696925622');" onmouseout="out('-5169574352696925622');" style=""> 102         String categoryId = mvelRule.substring(startIndex, endIndex);                                    </span>
<span class="-4041863795518518577" onmouseenter="enter('-4041863795518518577');" onmouseout="out('-4041863795518518577');" style=""> 103         //how about multivalue ?                                                                         </span>
<span class="-1998049530286061470" onmouseenter="enter('-1998049530286061470');" onmouseout="out('-1998049530286061470');" style=""> 104         String[] split = categoryId.split(&quot;,&quot;);                                                          </span>
<span class="-8236882608667390929" onmouseenter="enter('-8236882608667390929');" onmouseout="out('-8236882608667390929');" style=""> 105         Long[] result = null;                                                                            </span>
<span class="7592411771574828106" onmouseenter="enter('7592411771574828106');" onmouseout="out('7592411771574828106');" style=""> 106         int length = split.length;                                                                       </span>
<span class="3316164963146894618" onmouseenter="enter('3316164963146894618');" onmouseout="out('3316164963146894618');" style=""> 107         if (length &gt; 0) {                                                                                </span>
<span class="4047096185297244897" onmouseenter="enter('4047096185297244897');" onmouseout="out('4047096185297244897');" style=""> 108             result = new Long[length];                                                                   </span>
<span class="6908715651536326362" onmouseenter="enter('6908715651536326362');" onmouseout="out('6908715651536326362');" style=""> 109             for (int i = 0; i &lt; length; i++) {                                                           </span>
<span class="-7950545872238553987" onmouseenter="enter('-7950545872238553987');" onmouseout="out('-7950545872238553987');" style=""> 110                 result[i] = Long.parseLong(split[i].replace(&quot;\&quot;&quot;,&quot;&quot;));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 113         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114     }                                                                                                    </span>
<span  style=""> 115                                                                                                          </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style=""> 116     // Expected Custom Field Rule Formats                                                                </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style=""> 117     // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;               </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style=""><abbr title=" 118     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 118     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MðŸ”µ</abbr></span>
<span class="-8358459595516561004" onmouseenter="enter('-8358459595516561004');" onmouseout="out('-8358459595516561004');" style=""> 119     // Also supports string property contains, not contains, starts with, ends with etc.                 </span>
<span class="-3902656267910838436" onmouseenter="enter('-3902656267910838436');" onmouseout="out('-3902656267910838436');" style=""> 120     protected Collection&lt;String&gt; convertRuleToFilters(String matchRule) {                                </span>
<span class="-3458259939128959835" onmouseenter="enter('-3458259939128959835');" onmouseout="out('-3458259939128959835');" style=""> 121         List&lt;String&gt; filters = new ArrayList&lt;&gt;();                                                        </span>
<span  style=""> 122                                                                                                          </span>
<span class="-4116233034312872188" onmouseenter="enter('-4116233034312872188');" onmouseout="out('-4116233034312872188');" style=""> 123         boolean allRulesMustBeTrue = !matchRule.contains(&quot;||&quot;);                                          </span>
<span class="-1571577425596797932" onmouseenter="enter('-1571577425596797932');" onmouseout="out('-1571577425596797932');" style=""> 124         String[] fragments;                                                                              </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style=""> 125         if (allRulesMustBeTrue) {                                                                        </span>
<span class="-7188061614336596101" onmouseenter="enter('-7188061614336596101');" onmouseout="out('-7188061614336596101');" style=""> 126             fragments = StringUtils.split(matchRule, &quot;&amp;&amp;&quot;);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 127         } else {                                                                                         </span>
<span class="413737876388623067" onmouseenter="enter('413737876388623067');" onmouseout="out('413737876388623067');" style=""> 128             fragments = StringUtils.split(matchRule, &quot;||&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129         }                                                                                                </span>
<span  style=""> 130                                                                                                          </span>
<span class="1564812142638062790" onmouseenter="enter('1564812142638062790');" onmouseout="out('1564812142638062790');" style=""> 131         for (String fragment : fragments) {                                                              </span>
<span class="-5367054756288747777" onmouseenter="enter('-5367054756288747777');" onmouseout="out('-5367054756288747777');" style=""> 132             if (isCategoryTargetingRule(fragment)) {                                                     </span>
<span class="-734118791371905848" onmouseenter="enter('-734118791371905848');" onmouseout="out('-734118791371905848');" style=""> 133                 Long[] categoryIds = getCategoryIds(fragment);                                           </span>
<span class="-4909662740848112852" onmouseenter="enter('-4909662740848112852');" onmouseout="out('-4909662740848112852');" style=""> 134                 if (categoryIds != null) {                                                               </span>
<span class="1805589472251784818" onmouseenter="enter('1805589472251784818');" onmouseout="out('1805589472251784818');" style=""> 135                     String explicitCategoryFieldName = solrHelperService.getExplicitCategoryFieldName(); </span>
<span class="-5287974135799764925" onmouseenter="enter('-5287974135799764925');" onmouseout="out('-5287974135799764925');" style=""> 136                     StringBuilder categoryFilter = new StringBuilder(explicitCategoryFieldName + &quot;:(\&quot;&quot;);</span>
<span class="1721743067668120143" onmouseenter="enter('1721743067668120143');" onmouseout="out('1721743067668120143');" style=""> 137                     for (int i = 0; i &lt; categoryIds.length; i++) {                                       </span>
<span class="6049075465718997151" onmouseenter="enter('6049075465718997151');" onmouseout="out('6049075465718997151');" style=""> 138                         Long catId = solrHelperService.getCategoryId(categoryIds[i]);                    </span>
<span class="2247715214170223571" onmouseenter="enter('2247715214170223571');" onmouseout="out('2247715214170223571');" style=""> 139                         categoryFilter.append(catId);                                                    </span>
<span class="670628716832445201" onmouseenter="enter('670628716832445201');" onmouseout="out('670628716832445201');" style=""> 140                         if (i + 1 &lt; categoryIds.length) {                                                </span>
<span class="1110044106003867455" onmouseenter="enter('1110044106003867455');" onmouseout="out('1110044106003867455');" style=""> 141                             categoryFilter.append(&quot;,&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                     }                                                                                    </span>
<span class="1970759344659845383" onmouseenter="enter('1970759344659845383');" onmouseout="out('1970759344659845383');" style=""> 144                     categoryFilter.append(&quot;\&quot;)&quot;);                                                        </span>
<span class="4806920913497685296" onmouseenter="enter('4806920913497685296');" onmouseout="out('4806920913497685296');" style=""> 145                     filters.add(categoryFilter.toString());                                              </span>
<span  style=""> 146                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 148             } else {                                                                                     </span>
<span class="4472642083753197869" onmouseenter="enter('4472642083753197869');" onmouseout="out('4472642083753197869');" style=""> 149                 String fieldName = getCustomFieldPropertyName(fragment);                                 </span>
<span class="6767235149087130096" onmouseenter="enter('6767235149087130096');" onmouseout="out('6767235149087130096');" style=""> 150                 String fieldValue = getCustomFieldValue(fragment);                                       </span>
<span class="209342619518721793" onmouseenter="enter('209342619518721793');" onmouseout="out('209342619518721793');" style=""> 151                 boolean exclude = fragment.contains(&quot;!=&quot;) || fragment.startsWith(&quot;!&quot;);                   </span>
<span class="-513629237674612517" onmouseenter="enter('-513629237674612517');" onmouseout="out('-513629237674612517');" style=""> 152                 boolean isWildCardSearch = isWildCardSearch(fieldValue);                                 </span>
<span class="6416000241166527198" onmouseenter="enter('6416000241166527198');" onmouseout="out('6416000241166527198');" style=""> 153                 fieldName = convertFieldName(fieldName);                                                 </span>
<span class="-701725582702150457" onmouseenter="enter('-701725582702150457');" onmouseout="out('-701725582702150457');" style=""><abbr title=" 154                 List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(fieldName);"> 154                 List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPrðŸ”µ</abbr></span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 155 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-7551168459296007045" onmouseenter="enter('-7551168459296007045');" onmouseout="out('-7551168459296007045');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156                 boolean isCatalog = false;                                                               </span>
<span class="2262076950817925004" onmouseenter="enter('2262076950817925004');" onmouseout="out('2262076950817925004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157                 if(&quot;embeddableCatalogTenantDiscriminator.catalogDiscriminator&quot;.equals(fieldName)){       </span>
<span class="7360464894693146996" onmouseenter="enter('7360464894693146996');" onmouseout="out('7360464894693146996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158                     fieldName = solrHelperService.getCatalogFieldName();                                 </span>
<span class="5561389748107203889" onmouseenter="enter('5561389748107203889');" onmouseout="out('5561389748107203889');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159                     isCatalog = true;                                                                    </span>
<span class="1837365848624951645" onmouseenter="enter('1837365848624951645');" onmouseout="out('1837365848624951645');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160                     indexFieldTypes = new ArrayList&lt;&gt;();                                                 </span>
<span class="-1122114918514757495" onmouseenter="enter('-1122114918514757495');" onmouseout="out('-1122114918514757495');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161                     indexFieldTypes.add(new IndexFieldTypeImpl());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162                 }                                                                                        </span>
<span class="-2103872491504669162" onmouseenter="enter('-2103872491504669162');" onmouseout="out('-2103872491504669162');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163                 if (indexFieldTypes.size() &gt; 0) {                                                        </span>
<span class="7239065776429459040" onmouseenter="enter('7239065776429459040');" onmouseout="out('7239065776429459040');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 164                     Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField().getTranslatable();"> 164                     Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField(ðŸ”µ</abbr></span>
<span class="-1089691400420640956" onmouseenter="enter('-1089691400420640956');" onmouseout="out('-1089691400420640956');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165                     List&lt;Locale&gt; allLocales;                                                             </span>
<span class="-8810081931263659614" onmouseenter="enter('-8810081931263659614');" onmouseout="out('-8810081931263659614');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166                     if (translatable==null || !translatable) {                                           </span>
<span class="3172542301363761225" onmouseenter="enter('3172542301363761225');" onmouseout="out('3172542301363761225');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167                         allLocales = new ArrayList&lt;&gt;();                                                  </span>
<span class="8173230290853321992" onmouseenter="enter('8173230290853321992');" onmouseout="out('8173230290853321992');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168                         LocaleImpl e = new LocaleImpl();                                                 </span>
<span class="5086162913928278042" onmouseenter="enter('5086162913928278042');" onmouseout="out('5086162913928278042');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169                         e.setLocaleCode(&quot;&quot;);                                                             </span>
<span class="6078032241802864002" onmouseenter="enter('6078032241802864002');" onmouseout="out('6078032241802864002');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170                         allLocales.add(e);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171                     } else {                                                                             </span>
<span class="4255792891804321616" onmouseenter="enter('4255792891804321616');" onmouseout="out('4255792891804321616');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172                         allLocales = localeService.findAllLocales();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173                     }                                                                                    </span>
<span class="8261741881178153746" onmouseenter="enter('8261741881178153746');" onmouseout="out('8261741881178153746');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174                     List&lt;String&gt; tmpFilters = new ArrayList&lt;&gt;();                                         </span>
<span class="3584780802697725504" onmouseenter="enter('3584780802697725504');" onmouseout="out('3584780802697725504');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 175                     String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();"> 175                     String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getFieldðŸ”µ</abbr></span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176                     for (Locale locale : allLocales) {                                                   </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177                         for (IndexFieldType indexFieldType : indexFieldTypes) {                          </span>
<span class="-6544082423435460797" onmouseenter="enter('-6544082423435460797');" onmouseout="out('-6544082423435460797');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178                             String type = isCatalog ? &quot;&quot; :indexFieldType.getFieldType().getType();       </span>
<span class="-7046935955085981964" onmouseenter="enter('-7046935955085981964');" onmouseout="out('-7046935955085981964');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 179                             if (!isWildCardSearch || FieldType.STRING.getType().equals(type) || isCatalog) {"> 179                             if (!isWildCardSearch || FieldType.STRING.getType().equals(type) || isCatalogðŸ”µ</abbr></span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180                                 String prefix;                                                           </span>
<span class="7803706642416683862" onmouseenter="enter('7803706642416683862');" onmouseout="out('7803706642416683862');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181                                 if (StringUtils.isNotEmpty(locale.getLocaleCode())) {                    </span>
<span class="2867001838419777415" onmouseenter="enter('2867001838419777415');" onmouseout="out('2867001838419777415');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182                                     prefix = locale.getLocaleCode() + &quot;_&quot;;                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183                                 } else {                                                                 </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184                                     prefix = &quot;&quot;;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                                 }                                                                        </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186                                                                                                          </span>
<span class="-2334123318933248048" onmouseenter="enter('-2334123318933248048');" onmouseout="out('-2334123318933248048');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 187                                 String indexFieldName = isCatalog ? fieldName : (prefix + abbreviation + &quot;_&quot; + type);"> 187                                 String indexFieldName = isCatalog ? fieldName : (prefix + abbreviation + ðŸ”µ</abbr></span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 188 ||||||| BASE                                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 189 =======                                                                                                  </span>
<span class="-2103872491504669162" onmouseenter="enter('-2103872491504669162');" onmouseout="out('-2103872491504669162');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190                 if (indexFieldTypes.size() &gt; 0) {                                                        </span>
<span class="-3633847748226049075" onmouseenter="enter('-3633847748226049075');" onmouseout="out('-3633847748226049075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 191                     Boolean translatable = indexFieldTypes.get(0).getIndexField().getField().getTranslatable();"> 191                     Boolean translatable = indexFieldTypes.get(0).getIndexField().getField().getTranslataðŸ”µ</abbr></span>
<span class="-1089691400420640956" onmouseenter="enter('-1089691400420640956');" onmouseout="out('-1089691400420640956');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192                     List&lt;Locale&gt; allLocales;                                                             </span>
<span class="-8810081931263659614" onmouseenter="enter('-8810081931263659614');" onmouseout="out('-8810081931263659614');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193                     if (translatable==null || !translatable) {                                           </span>
<span class="3172542301363761225" onmouseenter="enter('3172542301363761225');" onmouseout="out('3172542301363761225');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194                         allLocales = new ArrayList&lt;&gt;();                                                  </span>
<span class="8173230290853321992" onmouseenter="enter('8173230290853321992');" onmouseout="out('8173230290853321992');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195                         LocaleImpl e = new LocaleImpl();                                                 </span>
<span class="5086162913928278042" onmouseenter="enter('5086162913928278042');" onmouseout="out('5086162913928278042');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196                         e.setLocaleCode(&quot;&quot;);                                                             </span>
<span class="6078032241802864002" onmouseenter="enter('6078032241802864002');" onmouseout="out('6078032241802864002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197                         allLocales.add(e);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                     } else {                                                                             </span>
<span class="4255792891804321616" onmouseenter="enter('4255792891804321616');" onmouseout="out('4255792891804321616');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199                         allLocales = localeService.findAllLocales();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200                     }                                                                                    </span>
<span class="8261741881178153746" onmouseenter="enter('8261741881178153746');" onmouseout="out('8261741881178153746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201                     List&lt;String&gt; tmpFilters = new ArrayList&lt;&gt;();                                         </span>
<span class="884995363436364062" onmouseenter="enter('884995363436364062');" onmouseout="out('884995363436364062');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 202                     String abbreviation = indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();"> 202                     String abbreviation = indexFieldTypes.get(0).getIndexField().getField().getAbbreviatiðŸ”µ</abbr></span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203                     for (Locale locale : allLocales) {                                                   </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204                         for (IndexFieldType indexFieldType : indexFieldTypes) {                          </span>
<span class="-3846951160350906445" onmouseenter="enter('-3846951160350906445');" onmouseout="out('-3846951160350906445');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205                             String type = indexFieldType.getFieldType().getType();                       </span>
<span class="7549083283832157055" onmouseenter="enter('7549083283832157055');" onmouseout="out('7549083283832157055');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206                             if (!isWildCardSearch || FieldType.STRING.getType().equals(type)) {          </span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207                                 String prefix;                                                           </span>
<span class="7803706642416683862" onmouseenter="enter('7803706642416683862');" onmouseout="out('7803706642416683862');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208                                 if (StringUtils.isNotEmpty(locale.getLocaleCode())) {                    </span>
<span class="2867001838419777415" onmouseenter="enter('2867001838419777415');" onmouseout="out('2867001838419777415');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                                     prefix = locale.getLocaleCode() + &quot;_&quot;;                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210                                 } else {                                                                 </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211                                     prefix = &quot;&quot;;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212                                 }                                                                        </span>
<span class="3385923284549100959" onmouseenter="enter('3385923284549100959');" onmouseout="out('3385923284549100959');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213                                 String indexFieldName = prefix + abbreviation + &quot;_&quot; + type;              </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 214 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 215                                                                                                          </span>
<span class="347763688069478794" onmouseenter="enter('347763688069478794');" onmouseout="out('347763688069478794');" style=""><abbr title=" 216                                 // if this is a wildcard search then we do not want to surround the value with quotes"> 216                                 // if this is a wildcard search then we do not want to surround the valueðŸ”µ</abbr></span>
<span class="-2654901131124248979" onmouseenter="enter('-2654901131124248979');" onmouseout="out('-2654901131124248979');" style=""> 217                                 String indexFieldValue = fieldValue;                                     </span>
<span class="2562112514760316298" onmouseenter="enter('2562112514760316298');" onmouseout="out('2562112514760316298');" style=""> 218                                 if (!isWildCardSearch &amp;&amp; !fieldValue.equals(&quot;null&quot;)) {                   </span>
<span class="6375595447189419464" onmouseenter="enter('6375595447189419464');" onmouseout="out('6375595447189419464');" style=""> 219                                     if(fieldValue.contains(&quot;\&quot;,\&quot;&quot;)){                                    </span>
<span class="-5010949076906240822" onmouseenter="enter('-5010949076906240822');" onmouseout="out('-5010949076906240822');" style=""> 220                                         indexFieldValue = &quot;(\&quot;&quot; + fieldValue + &quot;\&quot;)&quot;;                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 221                                     }else {                                                              </span>
<span class="519269224162677901" onmouseenter="enter('519269224162677901');" onmouseout="out('519269224162677901');" style=""> 222                                         indexFieldValue = &quot;\&quot;&quot; + fieldValue + &quot;\&quot;&quot;;                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223                                     }                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224                                 }                                                                        </span>
<span  style=""> 225                                                                                                          </span>
<span class="7698560569635945367" onmouseenter="enter('7698560569635945367');" onmouseout="out('7698560569635945367');" style=""> 226                                 String filter;                                                           </span>
<span class="8917473174740260176" onmouseenter="enter('8917473174740260176');" onmouseout="out('8917473174740260176');" style=""> 227                                 if (indexFieldValue.equals(&quot;null&quot;)) {                                    </span>
<span class="-2294577368288257511" onmouseenter="enter('-2294577368288257511');" onmouseout="out('-2294577368288257511');" style=""> 228                                     // this is for checking if null or non-existent fields               </span>
<span class="2225974712227568097" onmouseenter="enter('2225974712227568097');" onmouseout="out('2225974712227568097');" style=""> 229                                     filter = &quot;(*:* AND -&quot; + indexFieldName + &quot;:[* TO *])&quot;;               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 230                                 } else {                                                                 </span>
<span class="5648282257784433574" onmouseenter="enter('5648282257784433574');" onmouseout="out('5648282257784433574');" style=""> 231                                     filter = indexFieldName + &quot;:&quot; + indexFieldValue;                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232                                 }                                                                        </span>
<span  style=""> 233                                                                                                          </span>
<span class="-2619174266387061747" onmouseenter="enter('-2619174266387061747');" onmouseout="out('-2619174266387061747');" style=""> 234                                 if (exclude) {                                                           </span>
<span class="-5595087398256543047" onmouseenter="enter('-5595087398256543047');" onmouseout="out('-5595087398256543047');" style=""> 235                                     filter = &quot;NOT &quot; + filter;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236                                 }                                                                        </span>
<span  style=""> 237                                                                                                          </span>
<span class="5890716202638474450" onmouseenter="enter('5890716202638474450');" onmouseout="out('5890716202638474450');" style=""> 238                                 tmpFilters.add(filter);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                     }                                                                                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="-5970112842789367779" onmouseenter="enter('-5970112842789367779');" onmouseout="out('-5970112842789367779');" style=""> 243                     if (!exclude) {                                                                      </span>
<span class="4467181224644464926" onmouseenter="enter('4467181224644464926');" onmouseout="out('4467181224644464926');" style=""><abbr title=" 244                         //any of translation and type fields like en_name_tsy, en_name_s etc can match, so concatinate with OR"> 244                         //any of translation and type fields like en_name_tsy, en_name_s etc can match, sðŸ”µ</abbr></span>
<span  style=""> 245                                                                                                          </span>
<span class="-4629588024542266762" onmouseenter="enter('-4629588024542266762');" onmouseout="out('-4629588024542266762');" style=""> 246                         String s = tmpFilters.get(0);                                                    </span>
<span class="6592156823824166930" onmouseenter="enter('6592156823824166930');" onmouseout="out('6592156823824166930');" style=""> 247                         s = &quot;(&quot; + s;                                                                     </span>
<span class="-3902582789072783276" onmouseenter="enter('-3902582789072783276');" onmouseout="out('-3902582789072783276');" style=""> 248                         tmpFilters.set(0, s);                                                            </span>
<span class="-5094388359174835017" onmouseenter="enter('-5094388359174835017');" onmouseout="out('-5094388359174835017');" style=""> 249                         int size = tmpFilters.size() - 1;                                                </span>
<span class="-4545560731951074490" onmouseenter="enter('-4545560731951074490');" onmouseout="out('-4545560731951074490');" style=""> 250                         String s1 = tmpFilters.get(size);                                                </span>
<span class="7346319824215495439" onmouseenter="enter('7346319824215495439');" onmouseout="out('7346319824215495439');" style=""> 251                         s1 = s1 + &quot;)&quot;;                                                                   </span>
<span class="-3192110405084466359" onmouseenter="enter('-3192110405084466359');" onmouseout="out('-3192110405084466359');" style=""> 252                         tmpFilters.set(size, s1);                                                        </span>
<span class="2457502907598950300" onmouseenter="enter('2457502907598950300');" onmouseout="out('2457502907598950300');" style=""> 253                         filters.add(StringUtils.join(tmpFilters, &quot; OR &quot;));                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 254                     } else {                                                                             </span>
<span class="-4161188039224121088" onmouseenter="enter('-4161188039224121088');" onmouseout="out('-4161188039224121088');" style=""> 255                         //if we exclude we don&#x27;t want to see if at all so &quot;AND&quot; is ok                    </span>
<span class="-3843688481962930223" onmouseenter="enter('-3843688481962930223');" onmouseout="out('-3843688481962930223');" style=""> 256                         filters.addAll(tmpFilters);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257                     }                                                                                    </span>
<span class="-2060121676001122986" onmouseenter="enter('-2060121676001122986');" onmouseout="out('-2060121676001122986');" style=""> 258                     if (org.apache.commons.collections4.CollectionUtils.isEmpty(indexFieldTypes)) {      </span>
<span class="-777810702412233183" onmouseenter="enter('-777810702412233183');" onmouseout="out('-777810702412233183');" style=""> 259                         if (fieldName.contains(&quot;catalogDiscriminator&quot;)) {                                </span>
<span class="-7659514470241775465" onmouseenter="enter('-7659514470241775465');" onmouseout="out('-7659514470241775465');" style=""> 260                             String substring = fieldValue.substring(1, fieldValue.length() - 1);         </span>
<span class="475599518347961544" onmouseenter="enter('475599518347961544');" onmouseout="out('475599518347961544');" style=""> 261                             filters.add(&quot;catalog_s:(&quot; + substring + &quot;)&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 264                 } else {                                                                                 </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style=""> 265                     return Collections.emptyList();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268         }                                                                                                </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style=""> 269         if (allRulesMustBeTrue) {                                                                        </span>
<span class="6161622804982278326" onmouseenter="enter('6161622804982278326');" onmouseout="out('6161622804982278326');" style=""> 270             return filters;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 271         } else {                                                                                         </span>
<span class="-9109774989809899377" onmouseenter="enter('-9109774989809899377');" onmouseout="out('-9109774989809899377');" style=""> 272             return Collections.singletonList(StringUtils.join(filters, &quot; OR &quot;));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274     }                                                                                                    </span>
<span  style=""> 275                                                                                                          </span>
<span class="-5406295445993856151" onmouseenter="enter('-5406295445993856151');" onmouseout="out('-5406295445993856151');" style=""> 276     protected String convertFieldName(String fieldName) {                                                </span>
<span class="-7966506343162908990" onmouseenter="enter('-7966506343162908990');" onmouseout="out('-7966506343162908990');" style=""> 277         String result = fieldName;                                                                       </span>
<span class="-4930215839282778035" onmouseenter="enter('-4930215839282778035');" onmouseout="out('-4930215839282778035');" style=""> 278         if (fieldName.startsWith(&quot;product.&quot;)) {                                                          </span>
<span class="-2221476328782692373" onmouseenter="enter('-2221476328782692373');" onmouseout="out('-2221476328782692373');" style=""> 279             result = fieldName.substring(&quot;product.&quot;.length());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span class="-4762333987006846107" onmouseenter="enter('-4762333987006846107');" onmouseout="out('-4762333987006846107');" style=""> 281         if (result.endsWith(&quot;()&quot;)) {                                                                     </span>
<span class="-7370088352248235065" onmouseenter="enter('-7370088352248235065');" onmouseout="out('-7370088352248235065');" style=""> 282             result = parseMethod(result);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283         }                                                                                                </span>
<span class="-6976750953326715195" onmouseenter="enter('-6976750953326715195');" onmouseout="out('-6976750953326715195');" style=""> 284         result = result.replaceAll(&quot;\\?&quot;, &quot;&quot;);                                                           </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 285         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 288     /**                                                                                                  </span>
<span class="-4961595856674117509" onmouseenter="enter('-4961595856674117509');" onmouseout="out('-4961595856674117509');" style=""><abbr title=" 289      * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an attribute."> 289      * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an atðŸ”µ</abbr></span>
<span class="-9122028151948342763" onmouseenter="enter('-9122028151948342763');" onmouseout="out('-9122028151948342763');" style=""> 290      * Currently supports getX() methods                                                                 </span>
<span class="-1753930683541957258" onmouseenter="enter('-1753930683541957258');" onmouseout="out('-1753930683541957258');" style=""> 291      * For example, getType() -&gt; type                                                                    </span>
<span class="3732359556928566541" onmouseenter="enter('3732359556928566541');" onmouseout="out('3732359556928566541');" style=""> 292      * @param fieldName                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 293      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 294      */                                                                                                  </span>
<span class="-2963220266002726124" onmouseenter="enter('-2963220266002726124');" onmouseout="out('-2963220266002726124');" style=""> 295     protected String parseMethod(String fieldName) {                                                     </span>
<span class="-8263038990718822145" onmouseenter="enter('-8263038990718822145');" onmouseout="out('-8263038990718822145');" style=""> 296         String[] segments = fieldName.split(&quot;\\.&quot;);                                                      </span>
<span class="-2872844272696595425" onmouseenter="enter('-2872844272696595425');" onmouseout="out('-2872844272696595425');" style=""> 297         //parse the last segment removing the method prefix (e.g. get)                                   </span>
<span class="-6508141212304130711" onmouseenter="enter('-6508141212304130711');" onmouseout="out('-6508141212304130711');" style=""> 298         String methodSegment = segments[segments.length-1].replaceFirst(&quot;(^get)&quot;, &quot;&quot;);                   </span>
<span class="8940076855127072513" onmouseenter="enter('8940076855127072513');" onmouseout="out('8940076855127072513');" style=""> 299         //lowercase first char and remove the ()                                                         </span>
<span class="-6069661116746750678" onmouseenter="enter('-6069661116746750678');" onmouseout="out('-6069661116746750678');" style=""><abbr title=" 300         segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.substring(1, methodSegment.length() - 2);"> 300         segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.suðŸ”µ</abbr></span>
<span class="918919278535989799" onmouseenter="enter('918919278535989799');" onmouseout="out('918919278535989799');" style=""> 301         return String.join(&quot;.&quot;, segments);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302     }                                                                                                    </span>
<span  style=""> 303                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 304     /**                                                                                                  </span>
<span class="-7802570112181619959" onmouseenter="enter('-7802570112181619959');" onmouseout="out('-7802570112181619959');" style=""><abbr title=" 305      * Determines if the given field value string represents a wild card search. In Solr a wild card search either"> 305      * Determines if the given field value string represents a wild card search. In Solr a wild card searðŸ”µ</abbr></span>
<span class="-5470509459016141827" onmouseenter="enter('-5470509459016141827');" onmouseout="out('-5470509459016141827');" style=""> 306      * starts or ends with an asterisk.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 307      *                                                                                                   </span>
<span class="1221169641673317670" onmouseenter="enter('1221169641673317670');" onmouseout="out('1221169641673317670');" style=""> 308      * @param fieldValue the String field value                                                          </span>
<span class="-1593611972444689897" onmouseenter="enter('-1593611972444689897');" onmouseout="out('-1593611972444689897');" style=""> 309      * @return whether the value is for a wildcard search                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 310      */                                                                                                  </span>
<span class="4130318305105801360" onmouseenter="enter('4130318305105801360');" onmouseout="out('4130318305105801360');" style=""> 311     protected boolean isWildCardSearch(String fieldValue) {                                              </span>
<span class="-2660305773917818782" onmouseenter="enter('-2660305773917818782');" onmouseout="out('-2660305773917818782');" style=""> 312         return fieldValue.startsWith(&quot;*&quot;) || fieldValue.endsWith(&quot;*&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313     }                                                                                                    </span>
<span  style=""> 314                                                                                                          </span>
<span class="-3996318941156881450" onmouseenter="enter('-3996318941156881450');" onmouseout="out('-3996318941156881450');" style=""> 315     protected String getCustomFieldPropertyName(String mvelRule) {                                       </span>
<span class="3679211462672518298" onmouseenter="enter('3679211462672518298');" onmouseout="out('3679211462672518298');" style=""> 316         if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                                      </span>
<span class="-6513848732372278546" onmouseenter="enter('-6513848732372278546');" onmouseout="out('-6513848732372278546');" style=""> 317             //assuming left param is field, right is value                                               </span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style=""> 318             int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                      </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style=""> 319             int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                        </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style=""> 320             mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321         }                                                                                                </span>
<span class="1481037596687278193" onmouseenter="enter('1481037596687278193');" onmouseout="out('1481037596687278193');" style=""> 322         if (mvelRule.indexOf(&quot;[\&quot;&quot;) &gt; 0) {                                                               </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style=""> 323         int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                    </span>
<span class="3450072205155988404" onmouseenter="enter('3450072205155988404');" onmouseout="out('3450072205155988404');" style=""> 324         int endIndex = mvelRule.lastIndexOf(&quot;\&quot;]&quot;);                                                      </span>
<span  style=""> 325                                                                                                          </span>
<span class="791618933684830826" onmouseenter="enter('791618933684830826');" onmouseout="out('791618933684830826');" style=""> 326         return mvelRule.substring(startIndex, endIndex);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 327         } else {                                                                                         </span>
<span class="-599506282736455606" onmouseenter="enter('-599506282736455606');" onmouseout="out('-599506282736455606');" style=""><abbr title=" 328             if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;.startsWith&quot;) || mvelRule.contains(&quot;.endsWith&quot;)) {"> 328             if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;ðŸ”µ</abbr></span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style=""> 329                 int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                  </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style=""> 330                 int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                    </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style=""> 331                 mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332             }                                                                                            </span>
<span class="-2959351049191408844" onmouseenter="enter('-2959351049191408844');" onmouseout="out('-2959351049191408844');" style=""> 333             mvelRule = getRuleOrPropertyFromFunction(mvelRule);                                          </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style=""> 334             return mvelRule;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336     }                                                                                                    </span>
<span  style=""> 337                                                                                                          </span>
<span class="-5748560392795934189" onmouseenter="enter('-5748560392795934189');" onmouseout="out('-5748560392795934189');" style=""> 338     protected String getRuleOrPropertyFromFunction(String mvelRule) {                                    </span>
<span class="8079645033185490153" onmouseenter="enter('8079645033185490153');" onmouseout="out('8079645033185490153');" style=""> 339         int i = mvelRule.indexOf(&#x27;(&#x27;);                                                                   </span>
<span class="6118269285616949201" onmouseenter="enter('6118269285616949201');" onmouseout="out('6118269285616949201');" style=""> 340         int j = mvelRule.indexOf(&#x27;)&#x27;, i);                                                                </span>
<span  style=""> 341                                                                                                          </span>
<span class="-6286405257340566993" onmouseenter="enter('-6286405257340566993');" onmouseout="out('-6286405257340566993');" style=""> 342         //no function or maybe just some function? like xxx.xxx.getType()                                </span>
<span class="-6214758649886002427" onmouseenter="enter('-6214758649886002427');" onmouseout="out('-6214758649886002427');" style=""> 343         if (i == j || j == i + 1) {                                                                      </span>
<span class="-7679877352652422097" onmouseenter="enter('-7679877352652422097');" onmouseout="out('-7679877352652422097');" style=""> 344             //expect to have either == or !=                                                             </span>
<span class="3716522410886362712" onmouseenter="enter('3716522410886362712');" onmouseout="out('3716522410886362712');" style=""> 345             int exclamationMark = mvelRule.indexOf(&quot;!&quot;);                                                 </span>
<span class="-1238738714139750554" onmouseenter="enter('-1238738714139750554');" onmouseout="out('-1238738714139750554');" style=""> 346             if (exclamationMark &gt; 0) {                                                                   </span>
<span class="-4221725366469559006" onmouseenter="enter('-4221725366469559006');" onmouseout="out('-4221725366469559006');" style=""> 347                 return mvelRule.substring(0, exclamationMark);                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 348             } else {                                                                                     </span>
<span class="7053255170774622248" onmouseenter="enter('7053255170774622248');" onmouseout="out('7053255170774622248');" style=""> 349                 int equalsSign = mvelRule.indexOf(&quot;=&quot;);                                                  </span>
<span class="2892411250985260390" onmouseenter="enter('2892411250985260390');" onmouseout="out('2892411250985260390');" style=""> 350                 if (equalsSign &gt; 0) {                                                                    </span>
<span class="-303051360151549224" onmouseenter="enter('-303051360151549224');" onmouseout="out('-303051360151549224');" style=""> 351                     return mvelRule.substring(0, equalsSign);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352                 }                                                                                        </span>
<span class="2254302976129981489" onmouseenter="enter('2254302976129981489');" onmouseout="out('2254302976129981489');" style=""> 353                 //unknown format                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 355         } else {                                                                                         </span>
<span class="-8922669227095711265" onmouseenter="enter('-8922669227095711265');" onmouseout="out('-8922669227095711265');" style=""> 356             //looks like some function ?                                                                 </span>
<span class="724941001380407750" onmouseenter="enter('724941001380407750');" onmouseout="out('724941001380407750');" style=""> 357             Pattern pattern = Pattern.compile(&quot;\\([^!=]+\\)&quot;);                                           </span>
<span class="-6113564736220007098" onmouseenter="enter('-6113564736220007098');" onmouseout="out('-6113564736220007098');" style=""> 358             Matcher matcher = pattern.matcher(mvelRule);                                                 </span>
<span class="3484832867986496608" onmouseenter="enter('3484832867986496608');" onmouseout="out('3484832867986496608');" style=""> 359             if (matcher.find()) {                                                                        </span>
<span class="-7610571215329733446" onmouseenter="enter('-7610571215329733446');" onmouseout="out('-7610571215329733446');" style=""> 360                 String group = matcher.group();                                                          </span>
<span class="-8079573508343865500" onmouseenter="enter('-8079573508343865500');" onmouseout="out('-8079573508343865500');" style=""> 361                 return group.substring(1, group.length() - 1);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362             }                                                                                            </span>
<span  style=""> 363                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style=""> 365         return mvelRule;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366     }                                                                                                    </span>
<span  style=""> 367                                                                                                          </span>
<span class="6100636727859994582" onmouseenter="enter('6100636727859994582');" onmouseout="out('6100636727859994582');" style=""> 368     protected String getCustomFieldValue(String mvelRule) {                                              </span>
<span class="-3319890485526010677" onmouseenter="enter('-3319890485526010677');" onmouseout="out('-3319890485526010677');" style=""> 369         String customFieldValue = &quot;&quot;;                                                                    </span>
<span class="4516873309033909875" onmouseenter="enter('4516873309033909875');" onmouseout="out('4516873309033909875');" style=""> 370         if (mvelRule.contains(&quot;.contains&quot;)) {                                                            </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 371             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 372             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span  style=""> 373                                                                                                          </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 374             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="-5613902323637665591" onmouseenter="enter('-5613902323637665591');" onmouseout="out('-5613902323637665591');" style=""> 375         } else if (mvelRule.contains(&quot;==\&quot;&quot;) || mvelRule.contains(&quot;!=\&quot;&quot;)) {                             </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style=""> 376             int startIndex;                                                                              </span>
<span class="1954124054498899570" onmouseenter="enter('1954124054498899570');" onmouseout="out('1954124054498899570');" style=""> 377             int endIndex;                                                                                </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style=""> 378             if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                      </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style=""> 379                 startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="5123844857779866826" onmouseenter="enter('5123844857779866826');" onmouseout="out('5123844857779866826');" style=""> 380                 endIndex = mvelRule.lastIndexOf(&quot;\&quot;)&quot;);                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 381             } else {                                                                                     </span>
<span class="-8607486389615378476" onmouseenter="enter('-8607486389615378476');" onmouseout="out('-8607486389615378476');" style=""> 382                 startIndex = mvelRule.indexOf(&quot;==\&quot;&quot;) + 3;                                               </span>
<span class="6650538524451873352" onmouseenter="enter('6650538524451873352');" onmouseout="out('6650538524451873352');" style=""> 383                 endIndex = mvelRule.lastIndexOf(&quot;\&quot;&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384         }                                                                                                </span>
<span  style=""> 385                                                                                                          </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 386             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="-6310515578280121309" onmouseenter="enter('-6310515578280121309');" onmouseout="out('-6310515578280121309');" style=""> 387         } else if (mvelRule.contains(&quot;==&quot;) || mvelRule.contains(&quot;!=&quot;)) {                                 </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style=""> 388             int startIndex;                                                                              </span>
<span class="-243764101696257862" onmouseenter="enter('-243764101696257862');" onmouseout="out('-243764101696257862');" style=""> 389             int endIndex = mvelRule.length();                                                            </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style=""> 390             if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                      </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style=""> 391                 startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-8058284614077640064" onmouseenter="enter('-8058284614077640064');" onmouseout="out('-8058284614077640064');" style=""> 392                 endIndex = mvelRule.indexOf(&quot;\&quot;)&quot;, startIndex);                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 393             } else {                                                                                     </span>
<span class="6529493184259506230" onmouseenter="enter('6529493184259506230');" onmouseout="out('6529493184259506230');" style=""> 394                 int i = mvelRule.indexOf(&quot;==&quot;);                                                          </span>
<span class="81359043772452968" onmouseenter="enter('81359043772452968');" onmouseout="out('81359043772452968');" style=""> 395                 if (i &gt; 0) {                                                                             </span>
<span class="-4065973875162371300" onmouseenter="enter('-4065973875162371300');" onmouseout="out('-4065973875162371300');" style=""> 396                     startIndex = i + 2;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 397                 } else {                                                                                 </span>
<span class="-3645933873055406183" onmouseenter="enter('-3645933873055406183');" onmouseout="out('-3645933873055406183');" style=""> 398                     startIndex = mvelRule.indexOf(&quot;!=&quot;) + 2;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400             }                                                                                            </span>
<span  style=""> 401                                                                                                          </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 402             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="2218296394576932022" onmouseenter="enter('2218296394576932022');" onmouseout="out('2218296394576932022');" style=""> 403         } else if (mvelRule.contains(&quot;.startsWith&quot;)) {                                                   </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 404             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 405             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span  style=""> 406                                                                                                          </span>
<span class="4581944832870405683" onmouseenter="enter('4581944832870405683');" onmouseout="out('4581944832870405683');" style=""> 407             customFieldValue = mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;) + &quot;*&quot;;    </span>
<span class="-8060497764326038311" onmouseenter="enter('-8060497764326038311');" onmouseout="out('-8060497764326038311');" style=""> 408         } else if (mvelRule.contains(&quot;.endsWith&quot;)) {                                                     </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 409             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 410             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span  style=""> 411                                                                                                          </span>
<span class="-7671395845858615235" onmouseenter="enter('-7671395845858615235');" onmouseout="out('-7671395845858615235');" style=""> 412             customFieldValue = &quot;*&quot; + mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;);    </span>
<span class="2520893722587110945" onmouseenter="enter('2520893722587110945');" onmouseout="out('2520893722587110945');" style=""> 413         } else if (mvelRule.contains(&quot;==null&quot;)) {                                                        </span>
<span class="2478736060735144080" onmouseenter="enter('2478736060735144080');" onmouseout="out('2478736060735144080');" style=""> 414             // this means we have an &quot;is blank&quot; rule                                                     </span>
<span class="7951176582520491354" onmouseenter="enter('7951176582520491354');" onmouseout="out('7951176582520491354');" style=""> 415             customFieldValue = &quot;null&quot;;                                                                   </span>
<span class="8024335045226449466" onmouseenter="enter('8024335045226449466');" onmouseout="out('8024335045226449466');" style=""> 416         } else if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                               </span>
<span class="3487470046753460976" onmouseenter="enter('3487470046753460976');" onmouseout="out('3487470046753460976');" style=""> 417             int startIndex = mvelRule.indexOf(&quot;,&quot;);                                                      </span>
<span class="4188065660318946716" onmouseenter="enter('4188065660318946716');" onmouseout="out('4188065660318946716');" style=""> 418             int endIndex = mvelRule.indexOf(&quot;)&quot;, startIndex);                                            </span>
<span class="-6758459872216563699" onmouseenter="enter('-6758459872216563699');" onmouseout="out('-6758459872216563699');" style=""> 419             customFieldValue = mvelRule.substring(startIndex + 1, endIndex);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span class="3465129211023044589" onmouseenter="enter('3465129211023044589');" onmouseout="out('3465129211023044589');" style=""> 421         //maybe it is something like [x,x1,x2]? -&gt; (x,x1,x2), or [x1]-&gt;x1                                </span>
<span class="4392933608627202925" onmouseenter="enter('4392933608627202925');" onmouseout="out('4392933608627202925');" style=""> 422         if (customFieldValue.startsWith(&quot;[&quot;) &amp;&amp; customFieldValue.endsWith(&quot;]&quot;)) {                        </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style=""> 423                 customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);         </span>
<span class="2068942897632961350" onmouseenter="enter('2068942897632961350');" onmouseout="out('2068942897632961350');" style=""> 424                 if(customFieldValue.startsWith(&quot;\&quot;&quot;) &amp;&amp; customFieldValue.endsWith(&quot;\&quot;&quot;)){                </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style=""> 425                     customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427         }                                                                                                </span>
<span class="2343498638185968541" onmouseenter="enter('2343498638185968541');" onmouseout="out('2343498638185968541');" style=""> 428         return customFieldValue;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429     }                                                                                                    </span>
<span  style=""> 430                                                                                                          </span>
<span  style=""> 431                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432 }                                                                                                        </span>





























</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3  * BroadleafCommerce Common Libraries                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4511052683777238249" onmouseenter="enter('-4511052683777238249');" onmouseout="out('-4511052683777238249');" style="">  18 package org.broadleafcommerce.core.search.service.solr;                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  20 import java.util.ArrayList;                                                                              </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  21 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  22 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  23 import java.util.List;                                                                                   </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  24 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  25 import java.util.regex.Pattern;                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  26 import javax.annotation.Resource;                                                                        </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  27 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  28 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  29 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  30 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="">  31 import org.broadleafcommerce.common.locale.domain.Locale;                                                </span>
<span class="-4699531719896516827" onmouseenter="enter('-4699531719896516827');" onmouseout="out('-4699531719896516827');" style="">  32 import org.broadleafcommerce.common.locale.domain.LocaleImpl;                                            </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="">  33 import org.broadleafcommerce.common.locale.service.LocaleService;                                        </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  34 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  35 import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                              </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  36 import org.broadleafcommerce.core.search.domain.IndexFieldType;                                          </span>
<span class="8917647116637261149" onmouseenter="enter('8917647116637261149');" onmouseout="out('8917647116637261149');" style="">  37 import org.broadleafcommerce.core.search.domain.IndexFieldTypeImpl;                                      </span>
<span class="3348214099427628787" onmouseenter="enter('3348214099427628787');" onmouseout="out('3348214099427628787');" style="">  38 import org.broadleafcommerce.core.search.domain.SearchCriteria;                                          </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="">  39 import org.broadleafcommerce.core.search.domain.solr.FieldType;                                          </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  40 import org.springframework.stereotype.Service;                                                           </span>
<span  style="">  41                                                                                                          </span>
<span  style="">  42                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43 /**                                                                                                      </span>
<span class="-6557419552958427102" onmouseenter="enter('-6557419552958427102');" onmouseout="out('-6557419552958427102');" style="">  44  * Convenience methods for converting simple MVEL rules to Solr SearchCriteria                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  45  *                                                                                                       </span>
<span class="7828829262991528260" onmouseenter="enter('7828829262991528260');" onmouseout="out('7828829262991528260');" style="">  46  * @author Chris Kittrell (ckittrell)                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47  */                                                                                                      </span>
<span class="-5751247617688848665" onmouseenter="enter('-5751247617688848665');" onmouseout="out('-5751247617688848665');" style="">  48 @Service(&quot;blMvelToSearchCriteriaConversionService&quot;)                                                      </span>
<span class="7329482801380297950" onmouseenter="enter('7329482801380297950');" onmouseout="out('7329482801380297950');" style="">  49 public class MvelToSearchCriteriaConversionServiceImpl implements MvelToSearchCriteriaConversionService {</span>
<span class="5180464717700805782" onmouseenter="enter('5180464717700805782');" onmouseout="out('5180464717700805782');" style="">  50     private static final Log LOG = LogFactory.getLog(MvelToSearchCriteriaConversionServiceImpl.class);   </span>
<span  style="">  51                                                                                                          </span>
<span class="6593911499356929961" onmouseenter="enter('6593911499356929961');" onmouseout="out('6593911499356929961');" style=""><abbr title="  52     public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\.intersection\(product\.\?allParentCategoryIds,\[\&quot;([0-9]+)(,\&quot;[0-9]+\&quot;)*\&quot;\]\)\.size\(\)&gt;0$&quot;;">  52     public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\.intersection\(product\.\?allParðŸ”µ</abbr></span>
<span  style="">  53                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  54     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  55     protected CatalogService catalogService;                                                             </span>
<span  style="">  56                                                                                                          </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style="">  57     @Resource(name = &quot;blIndexFieldDao&quot;)                                                                  </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style="">  58     protected IndexFieldDao indexFieldDao;                                                               </span>
<span  style="">  59                                                                                                          </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style="">  60     @Resource(name = &quot;blLocaleService&quot;)                                                                  </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style="">  61     protected LocaleService localeService;                                                               </span>
<span  style="">  62                                                                                                          </span>
<span class="3433532014428154380" onmouseenter="enter('3433532014428154380');" onmouseout="out('3433532014428154380');" style="">  63     @Resource(name = &quot;blSolrHelperService&quot;)                                                              </span>
<span class="-6899732035501197192" onmouseenter="enter('-6899732035501197192');" onmouseout="out('-6899732035501197192');" style="">  64     protected SolrHelperService solrHelperService;                                                       </span>
<span  style="">  65                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  66     @Override                                                                                            </span>
<span class="8517769271291085647" onmouseenter="enter('8517769271291085647');" onmouseout="out('8517769271291085647');" style="">  67     public SearchCriteria convert(String mvelRule) {                                                     </span>
<span class="-3804295702574698939" onmouseenter="enter('-3804295702574698939');" onmouseout="out('-3804295702574698939');" style="">  68         SearchCriteria criteria = new SearchCriteria();                                                  </span>
<span class="-173756114249607612" onmouseenter="enter('-173756114249607612');" onmouseout="out('-173756114249607612');" style="">  69         criteria.setPageSize(Integer.MAX_VALUE);                                                         </span>
<span class="-5354029622989309350" onmouseenter="enter('-5354029622989309350');" onmouseout="out('-5354029622989309350');" style="">  70         if (isProductRule(mvelRule) || isCategoryTargetingRule(mvelRule)) {                              </span>
<span class="3271724963188919231" onmouseenter="enter('3271724963188919231');" onmouseout="out('3271724963188919231');" style="">  71             Collection&lt;String&gt; strings = convertRuleToFilters(mvelRule);                                 </span>
<span class="-4712490940242734116" onmouseenter="enter('-4712490940242734116');" onmouseout="out('-4712490940242734116');" style="">  72             criteria.setFilterQueries(strings);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  73         } else {                                                                                         </span>
<span class="-3161161881341444459" onmouseenter="enter('-3161161881341444459');" onmouseout="out('-3161161881341444459');" style=""><abbr title="  74             throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using Rules &quot; + (&quot;(Conditional Rules) and selected rule can&#x27;t be translated to solr criteria and so &quot; + &quot;does not support selection of a Default Product. See Tooltip for supported rule details&quot;));">  74             throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using RðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75         }                                                                                                </span>
<span class="-6542614039530216187" onmouseenter="enter('-6542614039530216187');" onmouseout="out('-6542614039530216187');" style="">  76         return criteria;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="2533182473814128926" onmouseenter="enter('2533182473814128926');" onmouseout="out('2533182473814128926');" style="">  79     protected boolean isProductRule(String rule) {                                                       </span>
<span class="-5300376996092551927" onmouseenter="enter('-5300376996092551927');" onmouseout="out('-5300376996092551927');" style="">  80         return rule.contains(&quot;product.&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81     }                                                                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="7766953117726329902" onmouseenter="enter('7766953117726329902');" onmouseout="out('7766953117726329902');" style="">  83     protected boolean isCustomFieldIndexed(List&lt;IndexFieldType&gt; indexFieldTypes) {                       </span>
<span class="-7835921473874723009" onmouseenter="enter('-7835921473874723009');" onmouseout="out('-7835921473874723009');" style="">  84         return CollectionUtils.isNotEmpty(indexFieldTypes);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85     }                                                                                                    </span>
<span  style="">  86                                                                                                          </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style=""><abbr title="  87     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0">  87     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;ðŸ”µ</abbr></span>
<span class="8608097822218680501" onmouseenter="enter('8608097822218680501');" onmouseout="out('8608097822218680501');" style="">  88     protected boolean isCategoryTargetingRule(String mvelRule) {                                         </span>
<span class="395583072845222703" onmouseenter="enter('395583072845222703');" onmouseout="out('395583072845222703');" style="">  89         return mvelRule.matches(CATEGORY_FORMAT_REGEX);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90     }                                                                                                    </span>
<span  style="">  91                                                                                                          </span>
<span class="-4578046640382617025" onmouseenter="enter('-4578046640382617025');" onmouseout="out('-4578046640382617025');" style=""><abbr title="  92     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;,...]).size()&gt;0">  92     // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;ðŸ”µ</abbr></span>
<span class="4479154694055573719" onmouseenter="enter('4479154694055573719');" onmouseout="out('4479154694055573719');" style="">  93     protected Long[] getCategoryIds(String mvelRule) {                                                   </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="">  94         int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                    </span>
<span class="7462371261616726470" onmouseenter="enter('7462371261616726470');" onmouseout="out('7462371261616726470');" style="">  95         int endIndex = mvelRule.indexOf(&quot;\&quot;]&quot;);                                                          </span>
<span class="-5169574352696925622" onmouseenter="enter('-5169574352696925622');" onmouseout="out('-5169574352696925622');" style="">  96         String categoryId = mvelRule.substring(startIndex, endIndex);                                    </span>
<span class="8837399414515747364" onmouseenter="enter('8837399414515747364');" onmouseout="out('8837399414515747364');" style="">  97         // how about multivalue ?                                                                        </span>
<span class="-1998049530286061470" onmouseenter="enter('-1998049530286061470');" onmouseout="out('-1998049530286061470');" style="">  98         String[] split = categoryId.split(&quot;,&quot;);                                                          </span>
<span class="-8236882608667390929" onmouseenter="enter('-8236882608667390929');" onmouseout="out('-8236882608667390929');" style="">  99         Long[] result = null;                                                                            </span>
<span class="7592411771574828106" onmouseenter="enter('7592411771574828106');" onmouseout="out('7592411771574828106');" style=""> 100         int length = split.length;                                                                       </span>
<span class="3316164963146894618" onmouseenter="enter('3316164963146894618');" onmouseout="out('3316164963146894618');" style=""> 101         if (length &gt; 0) {                                                                                </span>
<span class="4047096185297244897" onmouseenter="enter('4047096185297244897');" onmouseout="out('4047096185297244897');" style=""> 102             result = new Long[length];                                                                   </span>
<span class="6908715651536326362" onmouseenter="enter('6908715651536326362');" onmouseout="out('6908715651536326362');" style=""> 103             for (int i = 0; i &lt; length; i++) {                                                           </span>
<span class="-6140979915816817060" onmouseenter="enter('-6140979915816817060');" onmouseout="out('-6140979915816817060');" style=""> 104                 result[i] = Long.parseLong(split[i].replace(&quot;\&quot;&quot;, &quot;&quot;));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 107         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108     }                                                                                                    </span>
<span  style=""> 109                                                                                                          </span>
<span  style=""> 110                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 111 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112     // Expected Custom Field Rule Formats                                                                </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113     // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;               </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 114     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 114     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MðŸ”µ</abbr></span>
<span class="-8358459595516561004" onmouseenter="enter('-8358459595516561004');" onmouseout="out('-8358459595516561004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115     // Also supports string property contains, not contains, starts with, ends with etc.                 </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 116 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 117 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 117 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 118 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119                                                                                                          </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120     // Expected Custom Field Rule Formats                                                                </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121     // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;               </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 122     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 122     // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MðŸ”µ</abbr></span>
<span class="-8358459595516561004" onmouseenter="enter('-8358459595516561004');" onmouseout="out('-8358459595516561004');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123     // Also supports string property contains, not contains, starts with, ends with etc.                 </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 124 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 125                                                                                                          </span>
<span class="-3902656267910838436" onmouseenter="enter('-3902656267910838436');" onmouseout="out('-3902656267910838436');" style=""> 126     protected Collection&lt;String&gt; convertRuleToFilters(String matchRule) {                                </span>
<span class="-3458259939128959835" onmouseenter="enter('-3458259939128959835');" onmouseout="out('-3458259939128959835');" style=""> 127         List&lt;String&gt; filters = new ArrayList&lt;&gt;();                                                        </span>
<span class="-4116233034312872188" onmouseenter="enter('-4116233034312872188');" onmouseout="out('-4116233034312872188');" style=""> 128         boolean allRulesMustBeTrue = !matchRule.contains(&quot;||&quot;);                                          </span>
<span class="-1571577425596797932" onmouseenter="enter('-1571577425596797932');" onmouseout="out('-1571577425596797932');" style=""> 129         String[] fragments;                                                                              </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style=""> 130         if (allRulesMustBeTrue) {                                                                        </span>
<span class="-7188061614336596101" onmouseenter="enter('-7188061614336596101');" onmouseout="out('-7188061614336596101');" style=""> 131             fragments = StringUtils.split(matchRule, &quot;&amp;&amp;&quot;);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 132         } else {                                                                                         </span>
<span class="413737876388623067" onmouseenter="enter('413737876388623067');" onmouseout="out('413737876388623067');" style=""> 133             fragments = StringUtils.split(matchRule, &quot;||&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134         }                                                                                                </span>
<span class="1564812142638062790" onmouseenter="enter('1564812142638062790');" onmouseout="out('1564812142638062790');" style=""> 135         for (String fragment : fragments) {                                                              </span>
<span class="-5367054756288747777" onmouseenter="enter('-5367054756288747777');" onmouseout="out('-5367054756288747777');" style=""> 136             if (isCategoryTargetingRule(fragment)) {                                                     </span>
<span class="-734118791371905848" onmouseenter="enter('-734118791371905848');" onmouseout="out('-734118791371905848');" style=""> 137                 Long[] categoryIds = getCategoryIds(fragment);                                           </span>
<span class="-4909662740848112852" onmouseenter="enter('-4909662740848112852');" onmouseout="out('-4909662740848112852');" style=""> 138                 if (categoryIds != null) {                                                               </span>
<span class="1805589472251784818" onmouseenter="enter('1805589472251784818');" onmouseout="out('1805589472251784818');" style=""> 139                     String explicitCategoryFieldName = solrHelperService.getExplicitCategoryFieldName(); </span>
<span class="-5287974135799764925" onmouseenter="enter('-5287974135799764925');" onmouseout="out('-5287974135799764925');" style=""> 140                     StringBuilder categoryFilter = new StringBuilder(explicitCategoryFieldName + &quot;:(\&quot;&quot;);</span>
<span class="1721743067668120143" onmouseenter="enter('1721743067668120143');" onmouseout="out('1721743067668120143');" style=""> 141                     for (int i = 0; i &lt; categoryIds.length; i++) {                                       </span>
<span class="6049075465718997151" onmouseenter="enter('6049075465718997151');" onmouseout="out('6049075465718997151');" style=""> 142                         Long catId = solrHelperService.getCategoryId(categoryIds[i]);                    </span>
<span class="2247715214170223571" onmouseenter="enter('2247715214170223571');" onmouseout="out('2247715214170223571');" style=""> 143                         categoryFilter.append(catId);                                                    </span>
<span class="3306886924110812560" onmouseenter="enter('3306886924110812560');" onmouseout="out('3306886924110812560');" style=""> 144                         if ((i + 1) &lt; categoryIds.length) {                                              </span>
<span class="1110044106003867455" onmouseenter="enter('1110044106003867455');" onmouseout="out('1110044106003867455');" style=""> 145                             categoryFilter.append(&quot;,&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                     }                                                                                    </span>
<span class="1970759344659845383" onmouseenter="enter('1970759344659845383');" onmouseout="out('1970759344659845383');" style=""> 148                     categoryFilter.append(&quot;\&quot;)&quot;);                                                        </span>
<span class="4806920913497685296" onmouseenter="enter('4806920913497685296');" onmouseout="out('4806920913497685296');" style=""> 149                     filters.add(categoryFilter.toString());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 151             } else {                                                                                     </span>
<span class="4472642083753197869" onmouseenter="enter('4472642083753197869');" onmouseout="out('4472642083753197869');" style=""> 152                 String fieldName = getCustomFieldPropertyName(fragment);                                 </span>
<span class="6767235149087130096" onmouseenter="enter('6767235149087130096');" onmouseout="out('6767235149087130096');" style=""> 153                 String fieldValue = getCustomFieldValue(fragment);                                       </span>
<span class="209342619518721793" onmouseenter="enter('209342619518721793');" onmouseout="out('209342619518721793');" style=""> 154                 boolean exclude = fragment.contains(&quot;!=&quot;) || fragment.startsWith(&quot;!&quot;);                   </span>
<span class="-513629237674612517" onmouseenter="enter('-513629237674612517');" onmouseout="out('-513629237674612517');" style=""> 155                 boolean isWildCardSearch = isWildCardSearch(fieldValue);                                 </span>
<span class="6416000241166527198" onmouseenter="enter('6416000241166527198');" onmouseout="out('6416000241166527198');" style=""> 156                 fieldName = convertFieldName(fieldName);                                                 </span>
<span class="-701725582702150457" onmouseenter="enter('-701725582702150457');" onmouseout="out('-701725582702150457');" style=""><abbr title=" 157                 List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(fieldName);"> 157                 List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPrðŸ”µ</abbr></span>
<span class="-7551168459296007045" onmouseenter="enter('-7551168459296007045');" onmouseout="out('-7551168459296007045');" style=""> 158                 boolean isCatalog = false;                                                               </span>
<span class="-597987551989960439" onmouseenter="enter('-597987551989960439');" onmouseout="out('-597987551989960439');" style=""> 159                 if (&quot;embeddableCatalogTenantDiscriminator.catalogDiscriminator&quot;.equals(fieldName)) {     </span>
<span class="7360464894693146996" onmouseenter="enter('7360464894693146996');" onmouseout="out('7360464894693146996');" style=""> 160                     fieldName = solrHelperService.getCatalogFieldName();                                 </span>
<span class="5561389748107203889" onmouseenter="enter('5561389748107203889');" onmouseout="out('5561389748107203889');" style=""> 161                     isCatalog = true;                                                                    </span>
<span class="1837365848624951645" onmouseenter="enter('1837365848624951645');" onmouseout="out('1837365848624951645');" style=""> 162                     indexFieldTypes = new ArrayList&lt;&gt;();                                                 </span>
<span class="-1122114918514757495" onmouseenter="enter('-1122114918514757495');" onmouseout="out('-1122114918514757495');" style=""> 163                     indexFieldTypes.add(new IndexFieldTypeImpl());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164                 }                                                                                        </span>
<span class="-2103872491504669162" onmouseenter="enter('-2103872491504669162');" onmouseout="out('-2103872491504669162');" style=""> 165                 if (indexFieldTypes.size() &gt; 0) {                                                        </span>
<span  style=""> 166                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 167 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="7239065776429459040" onmouseenter="enter('7239065776429459040');" onmouseout="out('7239065776429459040');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 168                     Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField().getTranslatable();"> 168                     Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField(ðŸ”µ</abbr></span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 169 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 170 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 170 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 171 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172                                                                                                          </span>
<span class="-3633847748226049075" onmouseenter="enter('-3633847748226049075');" onmouseout="out('-3633847748226049075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 173                     Boolean translatable = indexFieldTypes.get(0).getIndexField().getField().getTranslatable();"> 173                     Boolean translatable = indexFieldTypes.get(0).getIndexField().getField().getTranslataðŸ”µ</abbr></span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 174 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 175                                                                                                          </span>
<span class="-1089691400420640956" onmouseenter="enter('-1089691400420640956');" onmouseout="out('-1089691400420640956');" style=""> 176                     List&lt;Locale&gt; allLocales;                                                             </span>
<span class="-4302165372614652619" onmouseenter="enter('-4302165372614652619');" onmouseout="out('-4302165372614652619');" style=""> 177                     if ((translatable == null) || (!translatable)) {                                     </span>
<span class="3172542301363761225" onmouseenter="enter('3172542301363761225');" onmouseout="out('3172542301363761225');" style=""> 178                         allLocales = new ArrayList&lt;&gt;();                                                  </span>
<span class="8173230290853321992" onmouseenter="enter('8173230290853321992');" onmouseout="out('8173230290853321992');" style=""> 179                         LocaleImpl e = new LocaleImpl();                                                 </span>
<span class="5086162913928278042" onmouseenter="enter('5086162913928278042');" onmouseout="out('5086162913928278042');" style=""> 180                         e.setLocaleCode(&quot;&quot;);                                                             </span>
<span class="6078032241802864002" onmouseenter="enter('6078032241802864002');" onmouseout="out('6078032241802864002');" style=""> 181                         allLocales.add(e);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182                     } else {                                                                             </span>
<span class="4255792891804321616" onmouseenter="enter('4255792891804321616');" onmouseout="out('4255792891804321616');" style=""> 183                         allLocales = localeService.findAllLocales();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184                     }                                                                                    </span>
<span class="8261741881178153746" onmouseenter="enter('8261741881178153746');" onmouseout="out('8261741881178153746');" style=""> 185                     List&lt;String&gt; tmpFilters = new ArrayList&lt;&gt;();                                         </span>
<span  style=""> 186                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 187 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="3584780802697725504" onmouseenter="enter('3584780802697725504');" onmouseout="out('3584780802697725504');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 188                     String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();"> 188                     String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getFieldðŸ”µ</abbr></span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 189 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 190 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 190 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 191 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192                                                                                                          </span>
<span class="884995363436364062" onmouseenter="enter('884995363436364062');" onmouseout="out('884995363436364062');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 193                     String abbreviation = indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();"> 193                     String abbreviation = indexFieldTypes.get(0).getIndexField().getField().getAbbreviatiðŸ”µ</abbr></span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 194 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 195                                                                                                          </span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style=""> 196                     for (Locale locale : allLocales) {                                                   </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style=""> 197                         for (IndexFieldType indexFieldType : indexFieldTypes) {                          </span>
<span  style=""> 198                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 199 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-6544082423435460797" onmouseenter="enter('-6544082423435460797');" onmouseout="out('-6544082423435460797');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200                             String type = isCatalog ? &quot;&quot; :indexFieldType.getFieldType().getType();       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 201 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 202 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 202 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 203 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204                                                                                                          </span>
<span class="-3846951160350906445" onmouseenter="enter('-3846951160350906445');" onmouseout="out('-3846951160350906445');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205                 String type = indexFieldType.getFieldType().getType();                                   </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 206 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 207                                                                                                          </span>
<span class="7717622633225589961" onmouseenter="enter('7717622633225589961');" onmouseout="out('7717622633225589961');" style=""> 208                             if (                                                                         </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 209 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-3649564423701670672" onmouseenter="enter('-3649564423701670672');" onmouseout="out('-3649564423701670672');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210 !isWildCardSearch || FieldType.STRING.getType().equals(type) || isCatalog                                </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 211 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 212 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 212 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 213 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214                                                                                                          </span>
<span class="6643642745148981404" onmouseenter="enter('6643642745148981404');" onmouseout="out('6643642745148981404');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215 !isWildCardSearch || FieldType.STRING.getType().equals(type)                                             </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 216 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1249983764631156426" onmouseenter="enter('-1249983764631156426');" onmouseout="out('-1249983764631156426');" style=""> 217                              || )                                                                        </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 218 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219 {                                                                                                        </span>
<span class="-6959390395506016943" onmouseenter="enter('-6959390395506016943');" onmouseout="out('-6959390395506016943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220             customFieldQuery = &quot;*:*&amp;fq=(&quot;;                                                               </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221             for (IndexFieldType indexFieldType : indexFieldTypes) {                                      </span>
<span class="-3846951160350906445" onmouseenter="enter('-3846951160350906445');" onmouseout="out('-3846951160350906445');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222                 String type = indexFieldType.getFieldType().getType();                                   </span>
<span class="5460428113067565695" onmouseenter="enter('5460428113067565695');" onmouseout="out('5460428113067565695');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223                 String indexFieldName = customFieldPropertyName + &quot;_&quot; + type;                            </span>
<span class="4772222536273620275" onmouseenter="enter('4772222536273620275');" onmouseout="out('4772222536273620275');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224                 String indexFieldValue = &quot;\&quot;&quot; + customFieldValue + &quot;\&quot;&quot;;                                 </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225                                                                                                          </span>
<span class="3742298849854377420" onmouseenter="enter('3742298849854377420');" onmouseout="out('3742298849854377420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226                 if (!isFirstItem(customFieldQuery)) {                                                    </span>
<span class="-6766103428194254047" onmouseenter="enter('-6766103428194254047');" onmouseout="out('-6766103428194254047');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227                     customFieldQuery += &quot; OR &quot;;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228                 }                                                                                        </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229                                                                                                          </span>
<span class="8651603528326862044" onmouseenter="enter('8651603528326862044');" onmouseout="out('8651603528326862044');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230                 customFieldQuery += indexFieldName + &quot;:&quot; + indexFieldValue;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231             }                                                                                            </span>
<span class="9186462271769049665" onmouseenter="enter('9186462271769049665');" onmouseout="out('9186462271769049665');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232             customFieldQuery += &quot;)&quot;;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233         }                                                                                                </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 234 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 235 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 235 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 236 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237                                                                                                          </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 {                                                                                                        </span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239                                 String prefix;                                                           </span>
<span class="7803706642416683862" onmouseenter="enter('7803706642416683862');" onmouseout="out('7803706642416683862');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240                                 if (StringUtils.isNotEmpty(locale.getLocaleCode())) {                    </span>
<span class="2867001838419777415" onmouseenter="enter('2867001838419777415');" onmouseout="out('2867001838419777415');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241                                     prefix = locale.getLocaleCode() + &quot;_&quot;;                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242                                 } else {                                                                 </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243                                     prefix = &quot;&quot;;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244                                 }                                                                        </span>
<span class="3385923284549100959" onmouseenter="enter('3385923284549100959');" onmouseout="out('3385923284549100959');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245                                 String indexFieldName = prefix + abbreviation + &quot;_&quot; + type;              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246                                                                                                          </span>
<span class="347763688069478794" onmouseenter="enter('347763688069478794');" onmouseout="out('347763688069478794');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 247                                 // if this is a wildcard search then we do not want to surround the value with quotes"> 247                                 // if this is a wildcard search then we do not want to surround the valueðŸ”µ</abbr></span>
<span class="-2654901131124248979" onmouseenter="enter('-2654901131124248979');" onmouseout="out('-2654901131124248979');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248                                 String indexFieldValue = fieldValue;                                     </span>
<span class="2562112514760316298" onmouseenter="enter('2562112514760316298');" onmouseout="out('2562112514760316298');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249                                 if (!isWildCardSearch &amp;&amp; !fieldValue.equals(&quot;null&quot;)) {                   </span>
<span class="6375595447189419464" onmouseenter="enter('6375595447189419464');" onmouseout="out('6375595447189419464');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250                                     if(fieldValue.contains(&quot;\&quot;,\&quot;&quot;)){                                    </span>
<span class="-5010949076906240822" onmouseenter="enter('-5010949076906240822');" onmouseout="out('-5010949076906240822');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251                                         indexFieldValue = &quot;(\&quot;&quot; + fieldValue + &quot;\&quot;)&quot;;                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252                                     }else {                                                              </span>
<span class="519269224162677901" onmouseenter="enter('519269224162677901');" onmouseout="out('519269224162677901');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253                                         indexFieldValue = &quot;\&quot;&quot; + fieldValue + &quot;\&quot;&quot;;                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254                                     }                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255                                 }                                                                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256                                                                                                          </span>
<span class="7698560569635945367" onmouseenter="enter('7698560569635945367');" onmouseout="out('7698560569635945367');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257                                 String filter;                                                           </span>
<span class="8917473174740260176" onmouseenter="enter('8917473174740260176');" onmouseout="out('8917473174740260176');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258                                 if (indexFieldValue.equals(&quot;null&quot;)) {                                    </span>
<span class="-2294577368288257511" onmouseenter="enter('-2294577368288257511');" onmouseout="out('-2294577368288257511');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259                                     // this is for checking if null or non-existent fields               </span>
<span class="2225974712227568097" onmouseenter="enter('2225974712227568097');" onmouseout="out('2225974712227568097');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260                                     filter = &quot;(*:* AND -&quot; + indexFieldName + &quot;:[* TO *])&quot;;               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261                                 } else {                                                                 </span>
<span class="5648282257784433574" onmouseenter="enter('5648282257784433574');" onmouseout="out('5648282257784433574');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262                                     filter = indexFieldName + &quot;:&quot; + indexFieldValue;                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263                                 }                                                                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264                                                                                                          </span>
<span class="-2619174266387061747" onmouseenter="enter('-2619174266387061747');" onmouseout="out('-2619174266387061747');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265                                 if (exclude) {                                                           </span>
<span class="-5595087398256543047" onmouseenter="enter('-5595087398256543047');" onmouseout="out('-5595087398256543047');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266                                     filter = &quot;NOT &quot; + filter;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267                                 }                                                                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268                                                                                                          </span>
<span class="5890716202638474450" onmouseenter="enter('5890716202638474450');" onmouseout="out('5890716202638474450');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269                                 tmpFilters.add(filter);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270                             }                                                                            </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 271 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 272                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274                     }                                                                                    </span>
<span class="-5970112842789367779" onmouseenter="enter('-5970112842789367779');" onmouseout="out('-5970112842789367779');" style=""> 275                     if (!exclude) {                                                                      </span>
<span class="991843554734680175" onmouseenter="enter('991843554734680175');" onmouseout="out('991843554734680175');" style=""><abbr title=" 276                         // any of translation and type fields like en_name_tsy, en_name_s etc can match, so concatinate with OR"> 276                         // any of translation and type fields like en_name_tsy, en_name_s etc can match, ðŸ”µ</abbr></span>
<span class="-4629588024542266762" onmouseenter="enter('-4629588024542266762');" onmouseout="out('-4629588024542266762');" style=""> 277                         String s = tmpFilters.get(0);                                                    </span>
<span  style=""> 278                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 279 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-520352062744686105" onmouseenter="enter('-520352062744686105');" onmouseout="out('-520352062744686105');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280                         s                                                                                </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 281 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 282 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 282 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 283 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284                                                                                                          </span>
<span class="-520352062744686105" onmouseenter="enter('-520352062744686105');" onmouseout="out('-520352062744686105');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285                         s                                                                                </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 286 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-2881534727897163325" onmouseenter="enter('-2881534727897163325');" onmouseout="out('-2881534727897163325');" style=""> 287                          = &quot;(&quot; + s;                                                                      </span>
<span class="-3902582789072783276" onmouseenter="enter('-3902582789072783276');" onmouseout="out('-3902582789072783276');" style=""> 288                         tmpFilters.set(0, s);                                                            </span>
<span class="-5094388359174835017" onmouseenter="enter('-5094388359174835017');" onmouseout="out('-5094388359174835017');" style=""> 289                         int size = tmpFilters.size() - 1;                                                </span>
<span class="-4545560731951074490" onmouseenter="enter('-4545560731951074490');" onmouseout="out('-4545560731951074490');" style=""> 290                         String s1 = tmpFilters.get(size);                                                </span>
<span class="7346319824215495439" onmouseenter="enter('7346319824215495439');" onmouseout="out('7346319824215495439');" style=""> 291                         s1 = s1 + &quot;)&quot;;                                                                   </span>
<span class="-3192110405084466359" onmouseenter="enter('-3192110405084466359');" onmouseout="out('-3192110405084466359');" style=""> 292                         tmpFilters.set(size, s1);                                                        </span>
<span class="2457502907598950300" onmouseenter="enter('2457502907598950300');" onmouseout="out('2457502907598950300');" style=""> 293                         filters.add(StringUtils.join(tmpFilters, &quot; OR &quot;));                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 294                     } else {                                                                             </span>
<span class="7780744732837103534" onmouseenter="enter('7780744732837103534');" onmouseout="out('7780744732837103534');" style=""> 295                         // if we exclude we don&#x27;t want to see if at all so &quot;AND&quot; is ok                   </span>
<span class="-3843688481962930223" onmouseenter="enter('-3843688481962930223');" onmouseout="out('-3843688481962930223');" style=""> 296                         filters.addAll(tmpFilters);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297                     }                                                                                    </span>
<span class="-2060121676001122986" onmouseenter="enter('-2060121676001122986');" onmouseout="out('-2060121676001122986');" style=""> 298                     if (org.apache.commons.collections4.CollectionUtils.isEmpty(indexFieldTypes)) {      </span>
<span class="-777810702412233183" onmouseenter="enter('-777810702412233183');" onmouseout="out('-777810702412233183');" style=""> 299                         if (fieldName.contains(&quot;catalogDiscriminator&quot;)) {                                </span>
<span class="-7659514470241775465" onmouseenter="enter('-7659514470241775465');" onmouseout="out('-7659514470241775465');" style=""> 300                             String substring = fieldValue.substring(1, fieldValue.length() - 1);         </span>
<span class="-8317620454366352837" onmouseenter="enter('-8317620454366352837');" onmouseout="out('-8317620454366352837');" style=""> 301                             filters.add((&quot;catalog_s:(&quot; + substring) + &quot;)&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 304                 } else {                                                                                 </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style=""> 305                     return Collections.emptyList();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308         }                                                                                                </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style=""> 309         if (allRulesMustBeTrue) {                                                                        </span>
<span class="6161622804982278326" onmouseenter="enter('6161622804982278326');" onmouseout="out('6161622804982278326');" style=""> 310             return filters;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 311         } else {                                                                                         </span>
<span class="-9109774989809899377" onmouseenter="enter('-9109774989809899377');" onmouseout="out('-9109774989809899377');" style=""> 312             return Collections.singletonList(StringUtils.join(filters, &quot; OR &quot;));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314     }                                                                                                    </span>
<span  style=""> 315                                                                                                          </span>
<span class="-5406295445993856151" onmouseenter="enter('-5406295445993856151');" onmouseout="out('-5406295445993856151');" style=""> 316     protected String convertFieldName(String fieldName) {                                                </span>
<span class="-7966506343162908990" onmouseenter="enter('-7966506343162908990');" onmouseout="out('-7966506343162908990');" style=""> 317         String result = fieldName;                                                                       </span>
<span class="-4930215839282778035" onmouseenter="enter('-4930215839282778035');" onmouseout="out('-4930215839282778035');" style=""> 318         if (fieldName.startsWith(&quot;product.&quot;)) {                                                          </span>
<span class="-2221476328782692373" onmouseenter="enter('-2221476328782692373');" onmouseout="out('-2221476328782692373');" style=""> 319             result = fieldName.substring(&quot;product.&quot;.length());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span class="-4762333987006846107" onmouseenter="enter('-4762333987006846107');" onmouseout="out('-4762333987006846107');" style=""> 321         if (result.endsWith(&quot;()&quot;)) {                                                                     </span>
<span class="-7370088352248235065" onmouseenter="enter('-7370088352248235065');" onmouseout="out('-7370088352248235065');" style=""> 322             result = parseMethod(result);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323         }                                                                                                </span>
<span class="-6976750953326715195" onmouseenter="enter('-6976750953326715195');" onmouseout="out('-6976750953326715195');" style=""> 324         result = result.replaceAll(&quot;\\?&quot;, &quot;&quot;);                                                           </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 325         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326     }                                                                                                    </span>
<span  style=""> 327                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 328     /**                                                                                                  </span>
<span class="-4961595856674117509" onmouseenter="enter('-4961595856674117509');" onmouseout="out('-4961595856674117509');" style=""><abbr title=" 329      * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an attribute."> 329      * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an atðŸ”µ</abbr></span>
<span class="-9122028151948342763" onmouseenter="enter('-9122028151948342763');" onmouseout="out('-9122028151948342763');" style=""> 330      * Currently supports getX() methods                                                                 </span>
<span class="-1753930683541957258" onmouseenter="enter('-1753930683541957258');" onmouseout="out('-1753930683541957258');" style=""> 331      * For example, getType() -&gt; type                                                                    </span>
<span class="3732359556928566541" onmouseenter="enter('3732359556928566541');" onmouseout="out('3732359556928566541');" style=""> 332      * @param fieldName                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 333      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 334      */                                                                                                  </span>
<span class="-2963220266002726124" onmouseenter="enter('-2963220266002726124');" onmouseout="out('-2963220266002726124');" style=""> 335     protected String parseMethod(String fieldName) {                                                     </span>
<span class="-8263038990718822145" onmouseenter="enter('-8263038990718822145');" onmouseout="out('-8263038990718822145');" style=""> 336         String[] segments = fieldName.split(&quot;\\.&quot;);                                                      </span>
<span class="1034386915213025069" onmouseenter="enter('1034386915213025069');" onmouseout="out('1034386915213025069');" style=""> 337         // parse the last segment removing the method prefix (e.g. get)                                  </span>
<span class="-4098354496125891323" onmouseenter="enter('-4098354496125891323');" onmouseout="out('-4098354496125891323');" style=""> 338         String methodSegment = segments[segments.length - 1].replaceFirst(&quot;(^get)&quot;, &quot;&quot;);                 </span>
<span class="-8293284896965473642" onmouseenter="enter('-8293284896965473642');" onmouseout="out('-8293284896965473642');" style=""> 339         // lowercase first char and remove the ()                                                        </span>
<span class="-6069661116746750678" onmouseenter="enter('-6069661116746750678');" onmouseout="out('-6069661116746750678');" style=""><abbr title=" 340         segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.substring(1, methodSegment.length() - 2);"> 340         segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.suðŸ”µ</abbr></span>
<span class="918919278535989799" onmouseenter="enter('918919278535989799');" onmouseout="out('918919278535989799');" style=""> 341         return String.join(&quot;.&quot;, segments);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342     }                                                                                                    </span>
<span  style=""> 343                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 344     /**                                                                                                  </span>
<span class="-7802570112181619959" onmouseenter="enter('-7802570112181619959');" onmouseout="out('-7802570112181619959');" style=""><abbr title=" 345      * Determines if the given field value string represents a wild card search. In Solr a wild card search either"> 345      * Determines if the given field value string represents a wild card search. In Solr a wild card searðŸ”µ</abbr></span>
<span class="-5470509459016141827" onmouseenter="enter('-5470509459016141827');" onmouseout="out('-5470509459016141827');" style=""> 346      * starts or ends with an asterisk.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 347      *                                                                                                   </span>
<span class="3791024763378883095" onmouseenter="enter('3791024763378883095');" onmouseout="out('3791024763378883095');" style=""> 348      * @param fieldValue                                                                                 </span>
<span class="-6584668126899956860" onmouseenter="enter('-6584668126899956860');" onmouseout="out('-6584668126899956860');" style=""> 349      * 		the String field value                                                                          </span>
<span class="-1593611972444689897" onmouseenter="enter('-1593611972444689897');" onmouseout="out('-1593611972444689897');" style=""> 350      * @return whether the value is for a wildcard search                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 351      */                                                                                                  </span>
<span class="4130318305105801360" onmouseenter="enter('4130318305105801360');" onmouseout="out('4130318305105801360');" style=""> 352     protected boolean isWildCardSearch(String fieldValue) {                                              </span>
<span class="-2660305773917818782" onmouseenter="enter('-2660305773917818782');" onmouseout="out('-2660305773917818782');" style=""> 353         return fieldValue.startsWith(&quot;*&quot;) || fieldValue.endsWith(&quot;*&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354     }                                                                                                    </span>
<span  style=""> 355                                                                                                          </span>
<span class="-3996318941156881450" onmouseenter="enter('-3996318941156881450');" onmouseout="out('-3996318941156881450');" style=""> 356     protected String getCustomFieldPropertyName(String mvelRule) {                                       </span>
<span class="3679211462672518298" onmouseenter="enter('3679211462672518298');" onmouseout="out('3679211462672518298');" style=""> 357         if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                                      </span>
<span class="-6513848732372278546" onmouseenter="enter('-6513848732372278546');" onmouseout="out('-6513848732372278546');" style=""> 358             //assuming left param is field, right is value                                               </span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style=""> 359             int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                      </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style=""> 360             int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                        </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style=""> 361             mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362         }                                                                                                </span>
<span class="1481037596687278193" onmouseenter="enter('1481037596687278193');" onmouseout="out('1481037596687278193');" style=""> 363         if (mvelRule.indexOf(&quot;[\&quot;&quot;) &gt; 0) {                                                               </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style=""> 364             int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                </span>
<span class="3450072205155988404" onmouseenter="enter('3450072205155988404');" onmouseout="out('3450072205155988404');" style=""> 365             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;]&quot;);                                                  </span>
<span class="791618933684830826" onmouseenter="enter('791618933684830826');" onmouseout="out('791618933684830826');" style=""> 366             return mvelRule.substring(startIndex, endIndex);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 367         } else {                                                                                         </span>
<span class="5804110607104175036" onmouseenter="enter('5804110607104175036');" onmouseout="out('5804110607104175036');" style=""><abbr title=" 368             if ((mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;.startsWith&quot;)) || mvelRule.contains(&quot;.endsWith&quot;)) {"> 368             if ((mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(ðŸ”µ</abbr></span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style=""> 369                 int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                  </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style=""> 370                 int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                    </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style=""> 371                 mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372             }                                                                                            </span>
<span class="-2959351049191408844" onmouseenter="enter('-2959351049191408844');" onmouseout="out('-2959351049191408844');" style=""> 373             mvelRule = getRuleOrPropertyFromFunction(mvelRule);                                          </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style=""> 374             return mvelRule;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376     }                                                                                                    </span>
<span  style=""> 377                                                                                                          </span>
<span class="-5748560392795934189" onmouseenter="enter('-5748560392795934189');" onmouseout="out('-5748560392795934189');" style=""> 378     protected String getRuleOrPropertyFromFunction(String mvelRule) {                                    </span>
<span class="8079645033185490153" onmouseenter="enter('8079645033185490153');" onmouseout="out('8079645033185490153');" style=""> 379         int i = mvelRule.indexOf(&#x27;(&#x27;);                                                                   </span>
<span class="6118269285616949201" onmouseenter="enter('6118269285616949201');" onmouseout="out('6118269285616949201');" style=""> 380         int j = mvelRule.indexOf(&#x27;)&#x27;, i);                                                                </span>
<span class="-6286405257340566993" onmouseenter="enter('-6286405257340566993');" onmouseout="out('-6286405257340566993');" style=""> 381         //no function or maybe just some function? like xxx.xxx.getType()                                </span>
<span class="-1672013807119098091" onmouseenter="enter('-1672013807119098091');" onmouseout="out('-1672013807119098091');" style=""> 382         if ((i == j) || (j == (i + 1))) {                                                                </span>
<span class="-7679877352652422097" onmouseenter="enter('-7679877352652422097');" onmouseout="out('-7679877352652422097');" style=""> 383             //expect to have either == or !=                                                             </span>
<span class="3716522410886362712" onmouseenter="enter('3716522410886362712');" onmouseout="out('3716522410886362712');" style=""> 384             int exclamationMark = mvelRule.indexOf(&quot;!&quot;);                                                 </span>
<span class="-1238738714139750554" onmouseenter="enter('-1238738714139750554');" onmouseout="out('-1238738714139750554');" style=""> 385             if (exclamationMark &gt; 0) {                                                                   </span>
<span class="-4221725366469559006" onmouseenter="enter('-4221725366469559006');" onmouseout="out('-4221725366469559006');" style=""> 386                 return mvelRule.substring(0, exclamationMark);                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 387             } else {                                                                                     </span>
<span class="7053255170774622248" onmouseenter="enter('7053255170774622248');" onmouseout="out('7053255170774622248');" style=""> 388                 int equalsSign = mvelRule.indexOf(&quot;=&quot;);                                                  </span>
<span class="2892411250985260390" onmouseenter="enter('2892411250985260390');" onmouseout="out('2892411250985260390');" style=""> 389                 if (equalsSign &gt; 0) {                                                                    </span>
<span class="-303051360151549224" onmouseenter="enter('-303051360151549224');" onmouseout="out('-303051360151549224');" style=""> 390                     return mvelRule.substring(0, equalsSign);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391                 }                                                                                        </span>
<span class="2254302976129981489" onmouseenter="enter('2254302976129981489');" onmouseout="out('2254302976129981489');" style=""> 392                 //unknown format                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 394         } else {                                                                                         </span>
<span class="-8922669227095711265" onmouseenter="enter('-8922669227095711265');" onmouseout="out('-8922669227095711265');" style=""> 395             //looks like some function ?                                                                 </span>
<span class="724941001380407750" onmouseenter="enter('724941001380407750');" onmouseout="out('724941001380407750');" style=""> 396             Pattern pattern = Pattern.compile(&quot;\\([^!=]+\\)&quot;);                                           </span>
<span class="-6113564736220007098" onmouseenter="enter('-6113564736220007098');" onmouseout="out('-6113564736220007098');" style=""> 397             Matcher matcher = pattern.matcher(mvelRule);                                                 </span>
<span class="3484832867986496608" onmouseenter="enter('3484832867986496608');" onmouseout="out('3484832867986496608');" style=""> 398             if (matcher.find()) {                                                                        </span>
<span class="-7610571215329733446" onmouseenter="enter('-7610571215329733446');" onmouseout="out('-7610571215329733446');" style=""> 399                 String group = matcher.group();                                                          </span>
<span class="-8079573508343865500" onmouseenter="enter('-8079573508343865500');" onmouseout="out('-8079573508343865500');" style=""> 400                 return group.substring(1, group.length() - 1);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402         }                                                                                                </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style=""> 403         return mvelRule;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404     }                                                                                                    </span>
<span  style=""> 405                                                                                                          </span>
<span class="6100636727859994582" onmouseenter="enter('6100636727859994582');" onmouseout="out('6100636727859994582');" style=""> 406     protected String getCustomFieldValue(String mvelRule) {                                              </span>
<span class="-3319890485526010677" onmouseenter="enter('-3319890485526010677');" onmouseout="out('-3319890485526010677');" style=""> 407         String customFieldValue = &quot;&quot;;                                                                    </span>
<span class="4516873309033909875" onmouseenter="enter('4516873309033909875');" onmouseout="out('4516873309033909875');" style=""> 408         if (mvelRule.contains(&quot;.contains&quot;)) {                                                            </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 409             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 410             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 411             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="-5613902323637665591" onmouseenter="enter('-5613902323637665591');" onmouseout="out('-5613902323637665591');" style=""> 412         } else if (mvelRule.contains(&quot;==\&quot;&quot;) || mvelRule.contains(&quot;!=\&quot;&quot;)) {                             </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style=""> 413             int startIndex;                                                                              </span>
<span class="1954124054498899570" onmouseenter="enter('1954124054498899570');" onmouseout="out('1954124054498899570');" style=""> 414             int endIndex;                                                                                </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style=""> 415             if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                      </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style=""> 416                 startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="5123844857779866826" onmouseenter="enter('5123844857779866826');" onmouseout="out('5123844857779866826');" style=""> 417                 endIndex = mvelRule.lastIndexOf(&quot;\&quot;)&quot;);                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 418             } else {                                                                                     </span>
<span class="-8607486389615378476" onmouseenter="enter('-8607486389615378476');" onmouseout="out('-8607486389615378476');" style=""> 419                 startIndex = mvelRule.indexOf(&quot;==\&quot;&quot;) + 3;                                               </span>
<span class="6650538524451873352" onmouseenter="enter('6650538524451873352');" onmouseout="out('6650538524451873352');" style=""> 420                 endIndex = mvelRule.lastIndexOf(&quot;\&quot;&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421             }                                                                                            </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 422             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="-6310515578280121309" onmouseenter="enter('-6310515578280121309');" onmouseout="out('-6310515578280121309');" style=""> 423         } else if (mvelRule.contains(&quot;==&quot;) || mvelRule.contains(&quot;!=&quot;)) {                                 </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style=""> 424             int startIndex;                                                                              </span>
<span class="-243764101696257862" onmouseenter="enter('-243764101696257862');" onmouseout="out('-243764101696257862');" style=""> 425             int endIndex = mvelRule.length();                                                            </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style=""> 426             if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                      </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style=""> 427                 startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-8058284614077640064" onmouseenter="enter('-8058284614077640064');" onmouseout="out('-8058284614077640064');" style=""> 428                 endIndex = mvelRule.indexOf(&quot;\&quot;)&quot;, startIndex);                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 429             } else {                                                                                     </span>
<span class="6529493184259506230" onmouseenter="enter('6529493184259506230');" onmouseout="out('6529493184259506230');" style=""> 430                 int i = mvelRule.indexOf(&quot;==&quot;);                                                          </span>
<span class="81359043772452968" onmouseenter="enter('81359043772452968');" onmouseout="out('81359043772452968');" style=""> 431                 if (i &gt; 0) {                                                                             </span>
<span class="-4065973875162371300" onmouseenter="enter('-4065973875162371300');" onmouseout="out('-4065973875162371300');" style=""> 432                     startIndex = i + 2;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 433                 } else {                                                                                 </span>
<span class="-3645933873055406183" onmouseenter="enter('-3645933873055406183');" onmouseout="out('-3645933873055406183');" style=""> 434                     startIndex = mvelRule.indexOf(&quot;!=&quot;) + 2;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436             }                                                                                            </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 437             customFieldValue = mvelRule.substring(startIndex, endIndex);                                 </span>
<span class="2218296394576932022" onmouseenter="enter('2218296394576932022');" onmouseout="out('2218296394576932022');" style=""> 438         } else if (mvelRule.contains(&quot;.startsWith&quot;)) {                                                   </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 439             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 440             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span class="4581944832870405683" onmouseenter="enter('4581944832870405683');" onmouseout="out('4581944832870405683');" style=""> 441             customFieldValue = mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;) + &quot;*&quot;;    </span>
<span class="-8060497764326038311" onmouseenter="enter('-8060497764326038311');" onmouseout="out('-8060497764326038311');" style=""> 442         } else if (mvelRule.contains(&quot;.endsWith&quot;)) {                                                     </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 443             int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                            </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 444             int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                 </span>
<span class="-7671395845858615235" onmouseenter="enter('-7671395845858615235');" onmouseout="out('-7671395845858615235');" style=""> 445             customFieldValue = &quot;*&quot; + mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;);    </span>
<span class="2520893722587110945" onmouseenter="enter('2520893722587110945');" onmouseout="out('2520893722587110945');" style=""> 446         } else if (mvelRule.contains(&quot;==null&quot;)) {                                                        </span>
<span class="2478736060735144080" onmouseenter="enter('2478736060735144080');" onmouseout="out('2478736060735144080');" style=""> 447             // this means we have an &quot;is blank&quot; rule                                                     </span>
<span class="7951176582520491354" onmouseenter="enter('7951176582520491354');" onmouseout="out('7951176582520491354');" style=""> 448             customFieldValue = &quot;null&quot;;                                                                   </span>
<span class="8024335045226449466" onmouseenter="enter('8024335045226449466');" onmouseout="out('8024335045226449466');" style=""> 449         } else if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                               </span>
<span class="3487470046753460976" onmouseenter="enter('3487470046753460976');" onmouseout="out('3487470046753460976');" style=""> 450             int startIndex = mvelRule.indexOf(&quot;,&quot;);                                                      </span>
<span class="4188065660318946716" onmouseenter="enter('4188065660318946716');" onmouseout="out('4188065660318946716');" style=""> 451             int endIndex = mvelRule.indexOf(&quot;)&quot;, startIndex);                                            </span>
<span class="-6758459872216563699" onmouseenter="enter('-6758459872216563699');" onmouseout="out('-6758459872216563699');" style=""> 452             customFieldValue = mvelRule.substring(startIndex + 1, endIndex);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453         }                                                                                                </span>
<span class="3465129211023044589" onmouseenter="enter('3465129211023044589');" onmouseout="out('3465129211023044589');" style=""> 454         //maybe it is something like [x,x1,x2]? -&gt; (x,x1,x2), or [x1]-&gt;x1                                </span>
<span class="4392933608627202925" onmouseenter="enter('4392933608627202925');" onmouseout="out('4392933608627202925');" style=""> 455         if (customFieldValue.startsWith(&quot;[&quot;) &amp;&amp; customFieldValue.endsWith(&quot;]&quot;)) {                        </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style=""> 456             customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);             </span>
<span class="4504894733537068448" onmouseenter="enter('4504894733537068448');" onmouseout="out('4504894733537068448');" style=""> 457             if (customFieldValue.startsWith(&quot;\&quot;&quot;) &amp;&amp; customFieldValue.endsWith(&quot;\&quot;&quot;)) {                  </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style=""> 458                 customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460         }                                                                                                </span>
<span class="2343498638185968541" onmouseenter="enter('2343498638185968541');" onmouseout="out('2343498638185968541');" style=""> 461         return customFieldValue;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463 }                                                                                                        </span></pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3   * BroadleafCommerce Common Libraries                                                                             </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-4511052683777238249" onmouseenter="enter('-4511052683777238249');" onmouseout="out('-4511052683777238249');" style="">  18  package org.broadleafcommerce.core.search.service.solr;                                                           </span>
<span  style="">  19                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.broadleafcommerce.core.catalog.domain.Category;                                                        </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  25 +import org.broadleafcommerce.common.locale.domain.Locale;                                                         </span>
<span class="-4699531719896516827" onmouseenter="enter('-4699531719896516827');" onmouseout="out('-4699531719896516827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import org.broadleafcommerce.common.locale.domain.LocaleImpl;                                                     </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import org.broadleafcommerce.common.locale.service.LocaleService;                                                 </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  28  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  29  import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                                       </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  30  import org.broadleafcommerce.core.search.domain.IndexFieldType;                                                   </span>
<span class="8917647116637261149" onmouseenter="enter('8917647116637261149');" onmouseout="out('8917647116637261149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +import org.broadleafcommerce.core.search.domain.IndexFieldTypeImpl;                                               </span>
<span class="3348214099427628787" onmouseenter="enter('3348214099427628787');" onmouseout="out('3348214099427628787');" style="">  32  import org.broadleafcommerce.core.search.domain.SearchCriteria;                                                   </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import org.broadleafcommerce.core.search.domain.solr.FieldType;                                                   </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  34  import org.springframework.stereotype.Service;                                                                    </span>
<span  style="">  35                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import java.util.ArrayList;                                                                                       </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import java.util.Collection;                                                                                      </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +import java.util.Collections;                                                                                     </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  39  import java.util.List;                                                                                            </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import java.util.regex.Matcher;                                                                                   </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +import java.util.regex.Pattern;                                                                                   </span>
<span  style="">  42                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  43  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  44                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  45  /**                                                                                                               </span>
<span class="-6557419552958427102" onmouseenter="enter('-6557419552958427102');" onmouseout="out('-6557419552958427102');" style="">  46   * Convenience methods for converting simple MVEL rules to Solr SearchCriteria                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  47   *                                                                                                                </span>
<span class="7828829262991528260" onmouseenter="enter('7828829262991528260');" onmouseout="out('7828829262991528260');" style="">  48   * @author Chris Kittrell (ckittrell)                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49   */                                                                                                               </span>
<span class="-5751247617688848665" onmouseenter="enter('-5751247617688848665');" onmouseout="out('-5751247617688848665');" style="">  50  @Service(&quot;blMvelToSearchCriteriaConversionService&quot;)                                                               </span>
<span class="7329482801380297950" onmouseenter="enter('7329482801380297950');" onmouseout="out('7329482801380297950');" style="">  51  public class MvelToSearchCriteriaConversionServiceImpl implements MvelToSearchCriteriaConversionService {         </span>
<span  style="">  52                                                                                                                    </span>
<span class="5180464717700805782" onmouseenter="enter('5180464717700805782');" onmouseout="out('5180464717700805782');" style="">  53      private static final Log LOG = LogFactory.getLog(MvelToSearchCriteriaConversionServiceImpl.class);            </span>
<span  style="">  54                                                                                                                    </span>
<span class="2834749092279287661" onmouseenter="enter('2834749092279287661');" onmouseout="out('2834749092279287661');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  55 -    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCategoryIds,\\[\\\&quot;([0-9]+)\\\&quot;\\]\\)\\.size\\(\\)&gt;0$&quot;;">  55 -    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCaðŸ”µ</abbr></span>
<span class="-4523406780264004987" onmouseenter="enter('-4523406780264004987');" onmouseout="out('-4523406780264004987');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  56 -    public static final String CUSTOM_FIELD_EQUALS_FORMAT_REGEX = &quot;^product\\.\\?getProductAttributes\\(\\)\\[\\\&quot;([a-zA-Z0-9_]+)\\\&quot;\\]\\=\\=\\\&quot;([a-zA-Z0-9\\s]+)\\\&quot;$&quot;;">  56 -    public static final String CUSTOM_FIELD_EQUALS_FORMAT_REGEX = &quot;^product\\.\\?getProductAttributes\\(\\)\\[\\\&quot;ðŸ”µ</abbr></span>
<span class="3309403789473145229" onmouseenter="enter('3309403789473145229');" onmouseout="out('3309403789473145229');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  57 -    public static final String CUSTOM_FIELD_CONTAINS_FORMAT_REGEX = &quot;^MvelHelper\\.toUpperCase\\(product\\.\\?getProductAttributes\\(\\)\\[\\\&quot;([a-zA-Z0-9_]+)\\\&quot;\\]\\)\\.contains\\(MvelHelper\\.toUpperCase\\(\\\&quot;([a-zA-Z0-9\\s]+)\\\&quot;\\)\\)$&quot;;">  57 -    public static final String CUSTOM_FIELD_CONTAINS_FORMAT_REGEX = &quot;^MvelHelper\\.toUpperCase\\(product\\.\\?getPðŸ”µ</abbr></span>
<span class="-970930589962964105" onmouseenter="enter('-970930589962964105');" onmouseout="out('-970930589962964105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  58 +    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCategoryIds,\\[\\\&quot;([0-9]+)(,\\\&quot;[0-9]+\\\&quot;)*\\\&quot;\\]\\)\\.size\\(\\)&gt;0$&quot;;">  58 +    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCaðŸ”µ</abbr></span>
<span  style="">  59                                                                                                                    </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  60      @Resource(name = &quot;blCatalogService&quot;)                                                                          </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  61      protected CatalogService catalogService;                                                                      </span>
<span  style="">  62                                                                                                                    </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style="">  63      @Resource(name = &quot;blIndexFieldDao&quot;)                                                                           </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style="">  64      protected IndexFieldDao indexFieldDao;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +                                                                                                                  </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +    @Resource(name = &quot;blLocaleService&quot;)                                                                           </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +    protected LocaleService localeService;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +                                                                                                                  </span>
<span class="-8412875699496826705" onmouseenter="enter('-8412875699496826705');" onmouseout="out('-8412875699496826705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    @Resource(name=&quot;blSolrHelperService&quot;)                                                                         </span>
<span class="-6899732035501197192" onmouseenter="enter('-6899732035501197192');" onmouseout="out('-6899732035501197192');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +    protected SolrHelperService solrHelperService;                                                                </span>
<span  style="">  71                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72      @Override                                                                                                     </span>
<span class="8517769271291085647" onmouseenter="enter('8517769271291085647');" onmouseout="out('8517769271291085647');" style="">  73      public SearchCriteria convert(String mvelRule) {                                                              </span>
<span class="-3804295702574698939" onmouseenter="enter('-3804295702574698939');" onmouseout="out('-3804295702574698939');" style="">  74          SearchCriteria criteria = new SearchCriteria();                                                           </span>
<span class="-173756114249607612" onmouseenter="enter('-173756114249607612');" onmouseout="out('-173756114249607612');" style="">  75          criteria.setPageSize(Integer.MAX_VALUE);                                                                  </span>
<span  style="">  76                                                                                                                    </span>
<span class="1420632819213660087" onmouseenter="enter('1420632819213660087');" onmouseout="out('1420632819213660087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -        if (isCustomFieldTargetingRule(mvelRule)) {                                                               </span>
<span class="-446399616822641277" onmouseenter="enter('-446399616822641277');" onmouseout="out('-446399616822641277');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -            String customFieldQuery = buildCustomFieldQuery(mvelRule);                                            </span>
<span class="7600373260617955593" onmouseenter="enter('7600373260617955593');" onmouseout="out('7600373260617955593');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -            criteria.setQuery(customFieldQuery);                                                                  </span>
<span class="-1323593692837228727" onmouseenter="enter('-1323593692837228727');" onmouseout="out('-1323593692837228727');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -        } else if (isCategoryTargetingRule(mvelRule)) {                                                           </span>
<span class="7716210690929206627" onmouseenter="enter('7716210690929206627');" onmouseout="out('7716210690929206627');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -            Long categoryId = getCategoryId(mvelRule);                                                            </span>
<span class="-2855613335921473901" onmouseenter="enter('-2855613335921473901');" onmouseout="out('-2855613335921473901');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -            Category category = catalogService.findCategoryById(categoryId);                                      </span>
<span class="-4309914376254983206" onmouseenter="enter('-4309914376254983206');" onmouseout="out('-4309914376254983206');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -            criteria.setCategory(category);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -        } else {                                                                                                  </span>
<span class="4409051294563969145" onmouseenter="enter('4409051294563969145');" onmouseout="out('4409051294563969145');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -            throw new UnsupportedOperationException(&quot;The provided MVEL rule format is not currently supported &quot; + </span>
<span class="2957324841950163155" onmouseenter="enter('2957324841950163155');" onmouseout="out('2957324841950163155');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -                    &quot;for MVEL to Solr Search Criteria conversion.&quot;);                                              </span>
<span class="-5354029622989309350" onmouseenter="enter('-5354029622989309350');" onmouseout="out('-5354029622989309350');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +        if (isProductRule(mvelRule) || isCategoryTargetingRule(mvelRule)) {                                       </span>
<span class="3271724963188919231" onmouseenter="enter('3271724963188919231');" onmouseout="out('3271724963188919231');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +            Collection&lt;String&gt; strings = convertRuleToFilters(mvelRule);                                          </span>
<span class="-4712490940242734116" onmouseenter="enter('-4712490940242734116');" onmouseout="out('-4712490940242734116');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +            criteria.setFilterQueries(strings);                                                                   </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +        }else {                                                                                                   </span>
<span class="-1053745767754751717" onmouseenter="enter('-1053745767754751717');" onmouseout="out('-1053745767754751717');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +            throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using Rules &quot; + </span>
<span class="-5527057582948710822" onmouseenter="enter('-5527057582948710822');" onmouseout="out('-5527057582948710822');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +                    &quot;(Conditional Rules) and selected rule can&#x27;t be translated to solr criteria and so &quot; +        </span>
<span class="-622187049424662407" onmouseenter="enter('-622187049424662407');" onmouseout="out('-622187049424662407');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +                    &quot;does not support selection of a Default Product. See Tooltip for supported rule details&quot;);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94          }                                                                                                         </span>
<span  style="">  95                                                                                                                    </span>
<span class="-6542614039530216187" onmouseenter="enter('-6542614039530216187');" onmouseout="out('-6542614039530216187');" style="">  96          return criteria;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97      }                                                                                                             </span>
<span  style="">  98                                                                                                                    </span>
<span class="-6427268472263201482" onmouseenter="enter('-6427268472263201482');" onmouseout="out('-6427268472263201482');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -    protected String buildCustomFieldQuery(String mvelRule) {                                                     </span>
<span class="2585264375941701762" onmouseenter="enter('2585264375941701762');" onmouseout="out('2585264375941701762');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -        String customFieldPropertyName = getCustomFieldPropertyName(mvelRule);                                    </span>
<span class="528854707094626309" onmouseenter="enter('528854707094626309');" onmouseout="out('528854707094626309');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -        String customFieldValue = getCustomFieldValue(mvelRule);                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -                                                                                                                  </span>
<span class="6662198990197403694" onmouseenter="enter('6662198990197403694');" onmouseout="out('6662198990197403694');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -        return buildCustomFieldQuery(customFieldPropertyName, customFieldValue);                                  </span>
<span class="-1196261502723734502" onmouseenter="enter('-1196261502723734502');" onmouseout="out('-1196261502723734502');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +    protected boolean isProductRule(String rule){                                                                 </span>
<span class="-5300376996092551927" onmouseenter="enter('-5300376996092551927');" onmouseout="out('-5300376996092551927');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +        return rule.contains(&quot;product.&quot;);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +                                                                                                                  </span>
<span class="7766953117726329902" onmouseenter="enter('7766953117726329902');" onmouseout="out('7766953117726329902');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +    protected boolean isCustomFieldIndexed(List&lt;IndexFieldType&gt; indexFieldTypes) {                                </span>
<span class="-7835921473874723009" onmouseenter="enter('-7835921473874723009');" onmouseout="out('-7835921473874723009');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +        return CollectionUtils.isNotEmpty(indexFieldTypes);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +                                                                                                                  </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 112 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0"> 112 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()ðŸ”µ</abbr></span>
<span class="8608097822218680501" onmouseenter="enter('8608097822218680501');" onmouseout="out('8608097822218680501');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +    protected boolean isCategoryTargetingRule(String mvelRule) {                                                  </span>
<span class="395583072845222703" onmouseenter="enter('395583072845222703');" onmouseout="out('395583072845222703');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +        return mvelRule.matches(CATEGORY_FORMAT_REGEX);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +                                                                                                                  </span>
<span class="-4578046640382617025" onmouseenter="enter('-4578046640382617025');" onmouseout="out('-4578046640382617025');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 117 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;,...]).size()&gt;0"> 117 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;,...]).siðŸ”µ</abbr></span>
<span class="4479154694055573719" onmouseenter="enter('4479154694055573719');" onmouseout="out('4479154694055573719');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +    protected Long[] getCategoryIds(String mvelRule) {                                                            </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +        int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                             </span>
<span class="7462371261616726470" onmouseenter="enter('7462371261616726470');" onmouseout="out('7462371261616726470');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +        int endIndex = mvelRule.indexOf(&quot;\&quot;]&quot;);                                                                   </span>
<span class="-5169574352696925622" onmouseenter="enter('-5169574352696925622');" onmouseout="out('-5169574352696925622');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +        String categoryId = mvelRule.substring(startIndex, endIndex);                                             </span>
<span class="-4041863795518518577" onmouseenter="enter('-4041863795518518577');" onmouseout="out('-4041863795518518577');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +        //how about multivalue ?                                                                                  </span>
<span class="-1998049530286061470" onmouseenter="enter('-1998049530286061470');" onmouseout="out('-1998049530286061470');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +        String[] split = categoryId.split(&quot;,&quot;);                                                                   </span>
<span class="-8236882608667390929" onmouseenter="enter('-8236882608667390929');" onmouseout="out('-8236882608667390929');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +        Long[] result = null;                                                                                     </span>
<span class="7592411771574828106" onmouseenter="enter('7592411771574828106');" onmouseout="out('7592411771574828106');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +        int length = split.length;                                                                                </span>
<span class="3316164963146894618" onmouseenter="enter('3316164963146894618');" onmouseout="out('3316164963146894618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        if (length &gt; 0) {                                                                                         </span>
<span class="4047096185297244897" onmouseenter="enter('4047096185297244897');" onmouseout="out('4047096185297244897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +            result = new Long[length];                                                                            </span>
<span class="6908715651536326362" onmouseenter="enter('6908715651536326362');" onmouseout="out('6908715651536326362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +            for (int i = 0; i &lt; length; i++) {                                                                    </span>
<span class="-7950545872238553987" onmouseenter="enter('-7950545872238553987');" onmouseout="out('-7950545872238553987');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +                result[i] = Long.parseLong(split[i].replace(&quot;\&quot;&quot;,&quot;&quot;));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +        }                                                                                                         </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +        return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133      }                                                                                                             </span>
<span  style=""> 134                                                                                                                    </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style=""> 135      // Expected Custom Field Rule Formats                                                                         </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style=""> 136      // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;                        </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style=""><abbr title=" 137      // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 137      // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelperðŸ”µ</abbr></span>
<span class="-8358459595516561004" onmouseenter="enter('-8358459595516561004');" onmouseout="out('-8358459595516561004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +    // Also supports string property contains, not contains, starts with, ends with etc.                          </span>
<span class="-3902656267910838436" onmouseenter="enter('-3902656267910838436');" onmouseout="out('-3902656267910838436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +    protected Collection&lt;String&gt; convertRuleToFilters(String matchRule) {                                         </span>
<span class="-3458259939128959835" onmouseenter="enter('-3458259939128959835');" onmouseout="out('-3458259939128959835');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +        List&lt;String&gt; filters = new ArrayList&lt;&gt;();                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +                                                                                                                  </span>
<span class="-4116233034312872188" onmouseenter="enter('-4116233034312872188');" onmouseout="out('-4116233034312872188');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +        boolean allRulesMustBeTrue = !matchRule.contains(&quot;||&quot;);                                                   </span>
<span class="-1571577425596797932" onmouseenter="enter('-1571577425596797932');" onmouseout="out('-1571577425596797932');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +        String[] fragments;                                                                                       </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +        if (allRulesMustBeTrue) {                                                                                 </span>
<span class="-7188061614336596101" onmouseenter="enter('-7188061614336596101');" onmouseout="out('-7188061614336596101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +            fragments = StringUtils.split(matchRule, &quot;&amp;&amp;&quot;);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +        } else {                                                                                                  </span>
<span class="413737876388623067" onmouseenter="enter('413737876388623067');" onmouseout="out('413737876388623067');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +            fragments = StringUtils.split(matchRule, &quot;||&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                                                                                                                  </span>
<span class="1564812142638062790" onmouseenter="enter('1564812142638062790');" onmouseout="out('1564812142638062790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +        for (String fragment : fragments) {                                                                       </span>
<span class="-5367054756288747777" onmouseenter="enter('-5367054756288747777');" onmouseout="out('-5367054756288747777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +            if (isCategoryTargetingRule(fragment)) {                                                              </span>
<span class="-734118791371905848" onmouseenter="enter('-734118791371905848');" onmouseout="out('-734118791371905848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                Long[] categoryIds = getCategoryIds(fragment);                                                    </span>
<span class="-4909662740848112852" onmouseenter="enter('-4909662740848112852');" onmouseout="out('-4909662740848112852');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                if (categoryIds != null) {                                                                        </span>
<span class="1805589472251784818" onmouseenter="enter('1805589472251784818');" onmouseout="out('1805589472251784818');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                    String explicitCategoryFieldName = solrHelperService.getExplicitCategoryFieldName();          </span>
<span class="-5287974135799764925" onmouseenter="enter('-5287974135799764925');" onmouseout="out('-5287974135799764925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                    StringBuilder categoryFilter = new StringBuilder(explicitCategoryFieldName + &quot;:(\&quot;&quot;);         </span>
<span class="1721743067668120143" onmouseenter="enter('1721743067668120143');" onmouseout="out('1721743067668120143');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                    for (int i = 0; i &lt; categoryIds.length; i++) {                                                </span>
<span class="6049075465718997151" onmouseenter="enter('6049075465718997151');" onmouseout="out('6049075465718997151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +                        Long catId = solrHelperService.getCategoryId(categoryIds[i]);                             </span>
<span class="2247715214170223571" onmouseenter="enter('2247715214170223571');" onmouseout="out('2247715214170223571');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +                        categoryFilter.append(catId);                                                             </span>
<span class="670628716832445201" onmouseenter="enter('670628716832445201');" onmouseout="out('670628716832445201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +                        if (i + 1 &lt; categoryIds.length) {                                                         </span>
<span class="1110044106003867455" onmouseenter="enter('1110044106003867455');" onmouseout="out('1110044106003867455');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +                            categoryFilter.append(&quot;,&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +                        }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +                    }                                                                                             </span>
<span class="1970759344659845383" onmouseenter="enter('1970759344659845383');" onmouseout="out('1970759344659845383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +                    categoryFilter.append(&quot;\&quot;)&quot;);                                                                 </span>
<span class="4806920913497685296" onmouseenter="enter('4806920913497685296');" onmouseout="out('4806920913497685296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +                    filters.add(categoryFilter.toString());                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +                }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +            } else {                                                                                              </span>
<span class="4472642083753197869" onmouseenter="enter('4472642083753197869');" onmouseout="out('4472642083753197869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +                String fieldName = getCustomFieldPropertyName(fragment);                                          </span>
<span class="6767235149087130096" onmouseenter="enter('6767235149087130096');" onmouseout="out('6767235149087130096');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +                String fieldValue = getCustomFieldValue(fragment);                                                </span>
<span class="209342619518721793" onmouseenter="enter('209342619518721793');" onmouseout="out('209342619518721793');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +                boolean exclude = fragment.contains(&quot;!=&quot;) || fragment.startsWith(&quot;!&quot;);                            </span>
<span class="-513629237674612517" onmouseenter="enter('-513629237674612517');" onmouseout="out('-513629237674612517');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +                boolean isWildCardSearch = isWildCardSearch(fieldValue);                                          </span>
<span class="6416000241166527198" onmouseenter="enter('6416000241166527198');" onmouseout="out('6416000241166527198');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +                fieldName = convertFieldName(fieldName);                                                          </span>
<span class="-701725582702150457" onmouseenter="enter('-701725582702150457');" onmouseout="out('-701725582702150457');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 173 +                List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(fieldName);"> 173 +                List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyNamðŸ”µ</abbr></span>
<span class="-7551168459296007045" onmouseenter="enter('-7551168459296007045');" onmouseout="out('-7551168459296007045');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +                boolean isCatalog = false;                                                                        </span>
<span class="2262076950817925004" onmouseenter="enter('2262076950817925004');" onmouseout="out('2262076950817925004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                if(&quot;embeddableCatalogTenantDiscriminator.catalogDiscriminator&quot;.equals(fieldName)){                </span>
<span class="7360464894693146996" onmouseenter="enter('7360464894693146996');" onmouseout="out('7360464894693146996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                    fieldName = solrHelperService.getCatalogFieldName();                                          </span>
<span class="5561389748107203889" onmouseenter="enter('5561389748107203889');" onmouseout="out('5561389748107203889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +                    isCatalog = true;                                                                             </span>
<span class="1837365848624951645" onmouseenter="enter('1837365848624951645');" onmouseout="out('1837365848624951645');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +                    indexFieldTypes = new ArrayList&lt;&gt;();                                                          </span>
<span class="-1122114918514757495" onmouseenter="enter('-1122114918514757495');" onmouseout="out('-1122114918514757495');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +                    indexFieldTypes.add(new IndexFieldTypeImpl());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +                }                                                                                                 </span>
<span class="-2103872491504669162" onmouseenter="enter('-2103872491504669162');" onmouseout="out('-2103872491504669162');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +                if (indexFieldTypes.size() &gt; 0) {                                                                 </span>
<span class="7239065776429459040" onmouseenter="enter('7239065776429459040');" onmouseout="out('7239065776429459040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 182 +                    Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField().getTranslatable();"> 182 +                    Boolean translatable = !isCatalog &amp;&amp; indexFieldTypes.get(0).getIndexField().getField().getTranðŸ”µ</abbr></span>
<span class="-1089691400420640956" onmouseenter="enter('-1089691400420640956');" onmouseout="out('-1089691400420640956');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +                    List&lt;Locale&gt; allLocales;                                                                      </span>
<span class="-8810081931263659614" onmouseenter="enter('-8810081931263659614');" onmouseout="out('-8810081931263659614');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +                    if (translatable==null || !translatable) {                                                    </span>
<span class="3172542301363761225" onmouseenter="enter('3172542301363761225');" onmouseout="out('3172542301363761225');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +                        allLocales = new ArrayList&lt;&gt;();                                                           </span>
<span class="8173230290853321992" onmouseenter="enter('8173230290853321992');" onmouseout="out('8173230290853321992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +                        LocaleImpl e = new LocaleImpl();                                                          </span>
<span class="5086162913928278042" onmouseenter="enter('5086162913928278042');" onmouseout="out('5086162913928278042');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +                        e.setLocaleCode(&quot;&quot;);                                                                      </span>
<span class="6078032241802864002" onmouseenter="enter('6078032241802864002');" onmouseout="out('6078032241802864002');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +                        allLocales.add(e);                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +                    } else {                                                                                      </span>
<span class="4255792891804321616" onmouseenter="enter('4255792891804321616');" onmouseout="out('4255792891804321616');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +                        allLocales = localeService.findAllLocales();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                    }                                                                                             </span>
<span class="8261741881178153746" onmouseenter="enter('8261741881178153746');" onmouseout="out('8261741881178153746');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +                    List&lt;String&gt; tmpFilters = new ArrayList&lt;&gt;();                                                  </span>
<span class="3584780802697725504" onmouseenter="enter('3584780802697725504');" onmouseout="out('3584780802697725504');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 193 +                    String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();"> 193 +                    String abbreviation = isCatalog ? &quot;&quot;: indexFieldTypes.get(0).getIndexField().getField().getAbbðŸ”µ</abbr></span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +                    for (Locale locale : allLocales) {                                                            </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +                        for (IndexFieldType indexFieldType : indexFieldTypes) {                                   </span>
<span class="-6544082423435460797" onmouseenter="enter('-6544082423435460797');" onmouseout="out('-6544082423435460797');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +                            String type = isCatalog ? &quot;&quot; :indexFieldType.getFieldType().getType();                </span>
<span class="-7046935955085981964" onmouseenter="enter('-7046935955085981964');" onmouseout="out('-7046935955085981964');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +                            if (!isWildCardSearch || FieldType.STRING.getType().equals(type) || isCatalog) {      </span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +                                String prefix;                                                                    </span>
<span class="7803706642416683862" onmouseenter="enter('7803706642416683862');" onmouseout="out('7803706642416683862');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +                                if (StringUtils.isNotEmpty(locale.getLocaleCode())) {                             </span>
<span class="2867001838419777415" onmouseenter="enter('2867001838419777415');" onmouseout="out('2867001838419777415');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +                                    prefix = locale.getLocaleCode() + &quot;_&quot;;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +                                } else {                                                                          </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +                                    prefix = &quot;&quot;;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +                                                                                                                  </span>
<span class="-2334123318933248048" onmouseenter="enter('-2334123318933248048');" onmouseout="out('-2334123318933248048');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 205 +                                String indexFieldName = isCatalog ? fieldName : (prefix + abbreviation + &quot;_&quot; + type);"> 205 +                                String indexFieldName = isCatalog ? fieldName : (prefix + abbreviation + &quot;_&quot; + typðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +                                                                                                                  </span>
<span class="347763688069478794" onmouseenter="enter('347763688069478794');" onmouseout="out('347763688069478794');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 207 +                                // if this is a wildcard search then we do not want to surround the value with quotes"> 207 +                                // if this is a wildcard search then we do not want to surround the value with quoðŸ”µ</abbr></span>
<span class="-2654901131124248979" onmouseenter="enter('-2654901131124248979');" onmouseout="out('-2654901131124248979');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +                                String indexFieldValue = fieldValue;                                              </span>
<span class="2562112514760316298" onmouseenter="enter('2562112514760316298');" onmouseout="out('2562112514760316298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +                                if (!isWildCardSearch &amp;&amp; !fieldValue.equals(&quot;null&quot;)) {                            </span>
<span class="6375595447189419464" onmouseenter="enter('6375595447189419464');" onmouseout="out('6375595447189419464');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +                                    if(fieldValue.contains(&quot;\&quot;,\&quot;&quot;)){                                             </span>
<span class="-5010949076906240822" onmouseenter="enter('-5010949076906240822');" onmouseout="out('-5010949076906240822');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +                                        indexFieldValue = &quot;(\&quot;&quot; + fieldValue + &quot;\&quot;)&quot;;                             </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +                                    }else {                                                                       </span>
<span class="519269224162677901" onmouseenter="enter('519269224162677901');" onmouseout="out('519269224162677901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +                                        indexFieldValue = &quot;\&quot;&quot; + fieldValue + &quot;\&quot;&quot;;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +                                    }                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +                                                                                                                  </span>
<span class="7698560569635945367" onmouseenter="enter('7698560569635945367');" onmouseout="out('7698560569635945367');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                                String filter;                                                                    </span>
<span class="8917473174740260176" onmouseenter="enter('8917473174740260176');" onmouseout="out('8917473174740260176');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +                                if (indexFieldValue.equals(&quot;null&quot;)) {                                             </span>
<span class="-2294577368288257511" onmouseenter="enter('-2294577368288257511');" onmouseout="out('-2294577368288257511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +                                    // this is for checking if null or non-existent fields                        </span>
<span class="2225974712227568097" onmouseenter="enter('2225974712227568097');" onmouseout="out('2225974712227568097');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +                                    filter = &quot;(*:* AND -&quot; + indexFieldName + &quot;:[* TO *])&quot;;                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                                } else {                                                                          </span>
<span class="5648282257784433574" onmouseenter="enter('5648282257784433574');" onmouseout="out('5648282257784433574');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +                                    filter = indexFieldName + &quot;:&quot; + indexFieldValue;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +                                                                                                                  </span>
<span class="-2619174266387061747" onmouseenter="enter('-2619174266387061747');" onmouseout="out('-2619174266387061747');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +                                if (exclude) {                                                                    </span>
<span class="-5595087398256543047" onmouseenter="enter('-5595087398256543047');" onmouseout="out('-5595087398256543047');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +                                    filter = &quot;NOT &quot; + filter;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +                                                                                                                  </span>
<span class="5890716202638474450" onmouseenter="enter('5890716202638474450');" onmouseout="out('5890716202638474450');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +                                tmpFilters.add(filter);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +                            }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +                        }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +                    }                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +                                                                                                                  </span>
<span class="-5970112842789367779" onmouseenter="enter('-5970112842789367779');" onmouseout="out('-5970112842789367779');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +                    if (!exclude) {                                                                               </span>
<span class="4467181224644464926" onmouseenter="enter('4467181224644464926');" onmouseout="out('4467181224644464926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 235 +                        //any of translation and type fields like en_name_tsy, en_name_s etc can match, so concatinate with OR"> 235 +                        //any of translation and type fields like en_name_tsy, en_name_s etc can match, so concatiðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +                                                                                                                  </span>
<span class="-4629588024542266762" onmouseenter="enter('-4629588024542266762');" onmouseout="out('-4629588024542266762');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +                        String s = tmpFilters.get(0);                                                             </span>
<span class="6592156823824166930" onmouseenter="enter('6592156823824166930');" onmouseout="out('6592156823824166930');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +                        s = &quot;(&quot; + s;                                                                              </span>
<span class="-3902582789072783276" onmouseenter="enter('-3902582789072783276');" onmouseout="out('-3902582789072783276');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +                        tmpFilters.set(0, s);                                                                     </span>
<span class="-5094388359174835017" onmouseenter="enter('-5094388359174835017');" onmouseout="out('-5094388359174835017');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +                        int size = tmpFilters.size() - 1;                                                         </span>
<span class="-4545560731951074490" onmouseenter="enter('-4545560731951074490');" onmouseout="out('-4545560731951074490');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +                        String s1 = tmpFilters.get(size);                                                         </span>
<span class="7346319824215495439" onmouseenter="enter('7346319824215495439');" onmouseout="out('7346319824215495439');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +                        s1 = s1 + &quot;)&quot;;                                                                            </span>
<span class="-3192110405084466359" onmouseenter="enter('-3192110405084466359');" onmouseout="out('-3192110405084466359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +                        tmpFilters.set(size, s1);                                                                 </span>
<span class="2457502907598950300" onmouseenter="enter('2457502907598950300');" onmouseout="out('2457502907598950300');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                        filters.add(StringUtils.join(tmpFilters, &quot; OR &quot;));                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +                    } else {                                                                                      </span>
<span class="-4161188039224121088" onmouseenter="enter('-4161188039224121088');" onmouseout="out('-4161188039224121088');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +                        //if we exclude we don&#x27;t want to see if at all so &quot;AND&quot; is ok                             </span>
<span class="-3843688481962930223" onmouseenter="enter('-3843688481962930223');" onmouseout="out('-3843688481962930223');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +                        filters.addAll(tmpFilters);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +                    }                                                                                             </span>
<span class="-2060121676001122986" onmouseenter="enter('-2060121676001122986');" onmouseout="out('-2060121676001122986');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +                    if (org.apache.commons.collections4.CollectionUtils.isEmpty(indexFieldTypes)) {               </span>
<span class="-777810702412233183" onmouseenter="enter('-777810702412233183');" onmouseout="out('-777810702412233183');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +                        if (fieldName.contains(&quot;catalogDiscriminator&quot;)) {                                         </span>
<span class="-7659514470241775465" onmouseenter="enter('-7659514470241775465');" onmouseout="out('-7659514470241775465');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +                            String substring = fieldValue.substring(1, fieldValue.length() - 1);                  </span>
<span class="475599518347961544" onmouseenter="enter('475599518347961544');" onmouseout="out('475599518347961544');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +                            filters.add(&quot;catalog_s:(&quot; + substring + &quot;)&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +                        }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +                    }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +                } else {                                                                                          </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +                    return Collections.emptyList();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +        }                                                                                                         </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +        if (allRulesMustBeTrue) {                                                                                 </span>
<span class="6161622804982278326" onmouseenter="enter('6161622804982278326');" onmouseout="out('6161622804982278326');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +            return filters;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +        } else {                                                                                                  </span>
<span class="-9109774989809899377" onmouseenter="enter('-9109774989809899377');" onmouseout="out('-9109774989809899377');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +            return Collections.singletonList(StringUtils.join(filters, &quot; OR &quot;));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +                                                                                                                  </span>
<span class="-5406295445993856151" onmouseenter="enter('-5406295445993856151');" onmouseout="out('-5406295445993856151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +    protected String convertFieldName(String fieldName) {                                                         </span>
<span class="-7966506343162908990" onmouseenter="enter('-7966506343162908990');" onmouseout="out('-7966506343162908990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +        String result = fieldName;                                                                                </span>
<span class="-4930215839282778035" onmouseenter="enter('-4930215839282778035');" onmouseout="out('-4930215839282778035');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +        if (fieldName.startsWith(&quot;product.&quot;)) {                                                                   </span>
<span class="-2221476328782692373" onmouseenter="enter('-2221476328782692373');" onmouseout="out('-2221476328782692373');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +            result = fieldName.substring(&quot;product.&quot;.length());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +        }                                                                                                         </span>
<span class="-4762333987006846107" onmouseenter="enter('-4762333987006846107');" onmouseout="out('-4762333987006846107');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +        if (result.endsWith(&quot;()&quot;)) {                                                                              </span>
<span class="-7370088352248235065" onmouseenter="enter('-7370088352248235065');" onmouseout="out('-7370088352248235065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +            result = parseMethod(result);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +        }                                                                                                         </span>
<span class="-6976750953326715195" onmouseenter="enter('-6976750953326715195');" onmouseout="out('-6976750953326715195');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +        result = result.replaceAll(&quot;\\?&quot;, &quot;&quot;);                                                                    </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +        return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +    /**                                                                                                           </span>
<span class="-4961595856674117509" onmouseenter="enter('-4961595856674117509');" onmouseout="out('-4961595856674117509');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +     * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an attribute. </span>
<span class="-9122028151948342763" onmouseenter="enter('-9122028151948342763');" onmouseout="out('-9122028151948342763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +     * Currently supports getX() methods                                                                          </span>
<span class="-1753930683541957258" onmouseenter="enter('-1753930683541957258');" onmouseout="out('-1753930683541957258');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +     * For example, getType() -&gt; type                                                                             </span>
<span class="3732359556928566541" onmouseenter="enter('3732359556928566541');" onmouseout="out('3732359556928566541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +     * @param fieldName                                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +     * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +     */                                                                                                           </span>
<span class="-2963220266002726124" onmouseenter="enter('-2963220266002726124');" onmouseout="out('-2963220266002726124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +    protected String parseMethod(String fieldName) {                                                              </span>
<span class="-8263038990718822145" onmouseenter="enter('-8263038990718822145');" onmouseout="out('-8263038990718822145');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +        String[] segments = fieldName.split(&quot;\\.&quot;);                                                               </span>
<span class="-2872844272696595425" onmouseenter="enter('-2872844272696595425');" onmouseout="out('-2872844272696595425');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +        //parse the last segment removing the method prefix (e.g. get)                                            </span>
<span class="-6508141212304130711" onmouseenter="enter('-6508141212304130711');" onmouseout="out('-6508141212304130711');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +        String methodSegment = segments[segments.length-1].replaceFirst(&quot;(^get)&quot;, &quot;&quot;);                            </span>
<span class="8940076855127072513" onmouseenter="enter('8940076855127072513');" onmouseout="out('8940076855127072513');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +        //lowercase first char and remove the ()                                                                  </span>
<span class="-6069661116746750678" onmouseenter="enter('-6069661116746750678');" onmouseout="out('-6069661116746750678');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 291 +        segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.substring(1, methodSegment.length() - 2);"> 291 +        segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.substring(1ðŸ”µ</abbr></span>
<span class="918919278535989799" onmouseenter="enter('918919278535989799');" onmouseout="out('918919278535989799');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +        return String.join(&quot;.&quot;, segments);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +    /**                                                                                                           </span>
<span class="-7802570112181619959" onmouseenter="enter('-7802570112181619959');" onmouseout="out('-7802570112181619959');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +     * Determines if the given field value string represents a wild card search. In Solr a wild card search either</span>
<span class="-5470509459016141827" onmouseenter="enter('-5470509459016141827');" onmouseout="out('-5470509459016141827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +     * starts or ends with an asterisk.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +     *                                                                                                            </span>
<span class="1221169641673317670" onmouseenter="enter('1221169641673317670');" onmouseout="out('1221169641673317670');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +     * @param fieldValue the String field value                                                                   </span>
<span class="-1593611972444689897" onmouseenter="enter('-1593611972444689897');" onmouseout="out('-1593611972444689897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +     * @return whether the value is for a wildcard search                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +     */                                                                                                           </span>
<span class="4130318305105801360" onmouseenter="enter('4130318305105801360');" onmouseout="out('4130318305105801360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +    protected boolean isWildCardSearch(String fieldValue) {                                                       </span>
<span class="-2660305773917818782" onmouseenter="enter('-2660305773917818782');" onmouseout="out('-2660305773917818782');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +        return fieldValue.startsWith(&quot;*&quot;) || fieldValue.endsWith(&quot;*&quot;);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 305 +                                                                                                                  </span>
<span class="-3996318941156881450" onmouseenter="enter('-3996318941156881450');" onmouseout="out('-3996318941156881450');" style=""> 306      protected String getCustomFieldPropertyName(String mvelRule) {                                                </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -        int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                             </span>
<span class="3450072205155988404" onmouseenter="enter('3450072205155988404');" onmouseout="out('3450072205155988404');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -        int endIndex = mvelRule.lastIndexOf(&quot;\&quot;]&quot;);                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -                                                                                                                  </span>
<span class="791618933684830826" onmouseenter="enter('791618933684830826');" onmouseout="out('791618933684830826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -        return mvelRule.substring(startIndex, endIndex);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -                                                                                                                  </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 313 -    // Expected Custom Field Rule Formats                                                                         </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 314 -    // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;                        </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 315 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 315 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelperðŸ”µ</abbr></span>
<span class="3679211462672518298" onmouseenter="enter('3679211462672518298');" onmouseout="out('3679211462672518298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +        if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                                               </span>
<span class="-6513848732372278546" onmouseenter="enter('-6513848732372278546');" onmouseout="out('-6513848732372278546');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +            //assuming left param is field, right is value                                                        </span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +            int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                               </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 319 +            int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                                 </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +            mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +        }                                                                                                         </span>
<span class="1481037596687278193" onmouseenter="enter('1481037596687278193');" onmouseout="out('1481037596687278193');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +        if (mvelRule.indexOf(&quot;[\&quot;&quot;) &gt; 0) {                                                                        </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +            int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                         </span>
<span class="3450072205155988404" onmouseenter="enter('3450072205155988404');" onmouseout="out('3450072205155988404');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;]&quot;);                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +                                                                                                                  </span>
<span class="791618933684830826" onmouseenter="enter('791618933684830826');" onmouseout="out('791618933684830826');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +            return mvelRule.substring(startIndex, endIndex);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +        } else {                                                                                                  </span>
<span class="-599506282736455606" onmouseenter="enter('-599506282736455606');" onmouseout="out('-599506282736455606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 328 +            if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;.startsWith&quot;) || mvelRule.contains(&quot;.endsWith&quot;)) {"> 328 +            if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;.startsWiðŸ”µ</abbr></span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +                int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                           </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +                int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                             </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +                mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +            }                                                                                                     </span>
<span class="-2959351049191408844" onmouseenter="enter('-2959351049191408844');" onmouseout="out('-2959351049191408844');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +            mvelRule = getRuleOrPropertyFromFunction(mvelRule);                                                   </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 334 +            return mvelRule;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +                                                                                                                  </span>
<span class="-5748560392795934189" onmouseenter="enter('-5748560392795934189');" onmouseout="out('-5748560392795934189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +    protected String getRuleOrPropertyFromFunction(String mvelRule) {                                             </span>
<span class="8079645033185490153" onmouseenter="enter('8079645033185490153');" onmouseout="out('8079645033185490153');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +        int i = mvelRule.indexOf(&#x27;(&#x27;);                                                                            </span>
<span class="6118269285616949201" onmouseenter="enter('6118269285616949201');" onmouseout="out('6118269285616949201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +        int j = mvelRule.indexOf(&#x27;)&#x27;, i);                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +                                                                                                                  </span>
<span class="-6286405257340566993" onmouseenter="enter('-6286405257340566993');" onmouseout="out('-6286405257340566993');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +        //no function or maybe just some function? like xxx.xxx.getType()                                         </span>
<span class="-6214758649886002427" onmouseenter="enter('-6214758649886002427');" onmouseout="out('-6214758649886002427');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +        if (i == j || j == i + 1) {                                                                               </span>
<span class="-7679877352652422097" onmouseenter="enter('-7679877352652422097');" onmouseout="out('-7679877352652422097');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +            //expect to have either == or !=                                                                      </span>
<span class="3716522410886362712" onmouseenter="enter('3716522410886362712');" onmouseout="out('3716522410886362712');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +            int exclamationMark = mvelRule.indexOf(&quot;!&quot;);                                                          </span>
<span class="-1238738714139750554" onmouseenter="enter('-1238738714139750554');" onmouseout="out('-1238738714139750554');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +            if (exclamationMark &gt; 0) {                                                                            </span>
<span class="-4221725366469559006" onmouseenter="enter('-4221725366469559006');" onmouseout="out('-4221725366469559006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +                return mvelRule.substring(0, exclamationMark);                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +            } else {                                                                                              </span>
<span class="7053255170774622248" onmouseenter="enter('7053255170774622248');" onmouseout="out('7053255170774622248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 349 +                int equalsSign = mvelRule.indexOf(&quot;=&quot;);                                                           </span>
<span class="2892411250985260390" onmouseenter="enter('2892411250985260390');" onmouseout="out('2892411250985260390');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 350 +                if (equalsSign &gt; 0) {                                                                             </span>
<span class="-303051360151549224" onmouseenter="enter('-303051360151549224');" onmouseout="out('-303051360151549224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 351 +                    return mvelRule.substring(0, equalsSign);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +                }                                                                                                 </span>
<span class="2254302976129981489" onmouseenter="enter('2254302976129981489');" onmouseout="out('2254302976129981489');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 353 +                //unknown format                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +            }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 355 +        } else {                                                                                                  </span>
<span class="-8922669227095711265" onmouseenter="enter('-8922669227095711265');" onmouseout="out('-8922669227095711265');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 356 +            //looks like some function ?                                                                          </span>
<span class="724941001380407750" onmouseenter="enter('724941001380407750');" onmouseout="out('724941001380407750');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 357 +            Pattern pattern = Pattern.compile(&quot;\\([^!=]+\\)&quot;);                                                    </span>
<span class="-6113564736220007098" onmouseenter="enter('-6113564736220007098');" onmouseout="out('-6113564736220007098');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 358 +            Matcher matcher = pattern.matcher(mvelRule);                                                          </span>
<span class="3484832867986496608" onmouseenter="enter('3484832867986496608');" onmouseout="out('3484832867986496608');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 359 +            if (matcher.find()) {                                                                                 </span>
<span class="-7610571215329733446" onmouseenter="enter('-7610571215329733446');" onmouseout="out('-7610571215329733446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 360 +                String group = matcher.group();                                                                   </span>
<span class="-8079573508343865500" onmouseenter="enter('-8079573508343865500');" onmouseout="out('-8079573508343865500');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 361 +                return group.substring(1, group.length() - 1);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 362 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 363 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 364 +        }                                                                                                         </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 365 +        return mvelRule;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 366 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 367 +                                                                                                                  </span>
<span class="6100636727859994582" onmouseenter="enter('6100636727859994582');" onmouseout="out('6100636727859994582');" style=""> 368      protected String getCustomFieldValue(String mvelRule) {                                                       </span>
<span class="-8500170060365651694" onmouseenter="enter('-8500170060365651694');" onmouseout="out('-8500170060365651694');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -        String customFieldValue = new String();                                                                   </span>
<span class="7978195541639566813" onmouseenter="enter('7978195541639566813');" onmouseout="out('7978195541639566813');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -        if (isCustomFieldEqualsCheck(mvelRule)) {                                                                 </span>
<span class="-3884654269271229942" onmouseenter="enter('-3884654269271229942');" onmouseout="out('-3884654269271229942');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -            int startIndex = mvelRule.indexOf(&quot;==\&quot;&quot;) + 3;                                                        </span>
<span class="-7394942243426697137" onmouseenter="enter('-7394942243426697137');" onmouseout="out('-7394942243426697137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;&quot;);                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -                                                                                                                  </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -            customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -                                                                                                                  </span>
<span class="-6562750224709532054" onmouseenter="enter('-6562750224709532054');" onmouseout="out('-6562750224709532054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -        } else if (isCustomFieldContainsCheck(mvelRule)) {                                                        </span>
<span class="-3319890485526010677" onmouseenter="enter('-3319890485526010677');" onmouseout="out('-3319890485526010677');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 377 +        String customFieldValue = &quot;&quot;;                                                                             </span>
<span class="4516873309033909875" onmouseenter="enter('4516873309033909875');" onmouseout="out('4516873309033909875');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 378 +        if (mvelRule.contains(&quot;.contains&quot;)) {                                                                     </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 379              int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 380              int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                          </span>
<span  style=""> 381                                                                                                                    </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 382              customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 383 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -                                                                                                                  </span>
<span class="-5613902323637665591" onmouseenter="enter('-5613902323637665591');" onmouseout="out('-5613902323637665591');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +        } else if (mvelRule.contains(&quot;==\&quot;&quot;) || mvelRule.contains(&quot;!=\&quot;&quot;)) {                                      </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 386 +            int startIndex;                                                                                       </span>
<span class="1954124054498899570" onmouseenter="enter('1954124054498899570');" onmouseout="out('1954124054498899570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 387 +            int endIndex;                                                                                         </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 388 +            if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                               </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +                startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="5123844857779866826" onmouseenter="enter('5123844857779866826');" onmouseout="out('5123844857779866826');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 390 +                endIndex = mvelRule.lastIndexOf(&quot;\&quot;)&quot;);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 391 +            } else {                                                                                              </span>
<span class="-8607486389615378476" onmouseenter="enter('-8607486389615378476');" onmouseout="out('-8607486389615378476');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 392 +                startIndex = mvelRule.indexOf(&quot;==\&quot;&quot;) + 3;                                                        </span>
<span class="6650538524451873352" onmouseenter="enter('6650538524451873352');" onmouseout="out('6650538524451873352');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 393 +                endIndex = mvelRule.lastIndexOf(&quot;\&quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +                                                                                                                  </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 396 +            customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span class="-6310515578280121309" onmouseenter="enter('-6310515578280121309');" onmouseout="out('-6310515578280121309');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 397 +        } else if (mvelRule.contains(&quot;==&quot;) || mvelRule.contains(&quot;!=&quot;)) {                                          </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 398 +            int startIndex;                                                                                       </span>
<span class="-243764101696257862" onmouseenter="enter('-243764101696257862');" onmouseout="out('-243764101696257862');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +            int endIndex = mvelRule.length();                                                                     </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +            if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                               </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +                startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-8058284614077640064" onmouseenter="enter('-8058284614077640064');" onmouseout="out('-8058284614077640064');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +                endIndex = mvelRule.indexOf(&quot;\&quot;)&quot;, startIndex);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 403 +            } else {                                                                                              </span>
<span class="6529493184259506230" onmouseenter="enter('6529493184259506230');" onmouseout="out('6529493184259506230');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +                int i = mvelRule.indexOf(&quot;==&quot;);                                                                   </span>
<span class="81359043772452968" onmouseenter="enter('81359043772452968');" onmouseout="out('81359043772452968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +                if (i &gt; 0) {                                                                                      </span>
<span class="-4065973875162371300" onmouseenter="enter('-4065973875162371300');" onmouseout="out('-4065973875162371300');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +                    startIndex = i + 2;                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +                } else {                                                                                          </span>
<span class="-3645933873055406183" onmouseenter="enter('-3645933873055406183');" onmouseout="out('-3645933873055406183');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +                    startIndex = mvelRule.indexOf(&quot;!=&quot;) + 2;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +                                                                                                                  </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +            customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span class="2218296394576932022" onmouseenter="enter('2218296394576932022');" onmouseout="out('2218296394576932022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +        } else if (mvelRule.contains(&quot;.startsWith&quot;)) {                                                            </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +            int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +                                                                                                                  </span>
<span class="4581944832870405683" onmouseenter="enter('4581944832870405683');" onmouseout="out('4581944832870405683');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +            customFieldValue = mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;) + &quot;*&quot;;             </span>
<span class="-8060497764326038311" onmouseenter="enter('-8060497764326038311');" onmouseout="out('-8060497764326038311');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +        } else if (mvelRule.contains(&quot;.endsWith&quot;)) {                                                              </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +            int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +                                                                                                                  </span>
<span class="-7671395845858615235" onmouseenter="enter('-7671395845858615235');" onmouseout="out('-7671395845858615235');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +            customFieldValue = &quot;*&quot; + mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;);             </span>
<span class="2520893722587110945" onmouseenter="enter('2520893722587110945');" onmouseout="out('2520893722587110945');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +        } else if (mvelRule.contains(&quot;==null&quot;)) {                                                                 </span>
<span class="2478736060735144080" onmouseenter="enter('2478736060735144080');" onmouseout="out('2478736060735144080');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +            // this means we have an &quot;is blank&quot; rule                                                              </span>
<span class="7951176582520491354" onmouseenter="enter('7951176582520491354');" onmouseout="out('7951176582520491354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +            customFieldValue = &quot;null&quot;;                                                                            </span>
<span class="8024335045226449466" onmouseenter="enter('8024335045226449466');" onmouseout="out('8024335045226449466');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 426 +        } else if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                                        </span>
<span class="3487470046753460976" onmouseenter="enter('3487470046753460976');" onmouseout="out('3487470046753460976');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 427 +            int startIndex = mvelRule.indexOf(&quot;,&quot;);                                                               </span>
<span class="4188065660318946716" onmouseenter="enter('4188065660318946716');" onmouseout="out('4188065660318946716');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 428 +            int endIndex = mvelRule.indexOf(&quot;)&quot;, startIndex);                                                     </span>
<span class="-6758459872216563699" onmouseenter="enter('-6758459872216563699');" onmouseout="out('-6758459872216563699');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 429 +            customFieldValue = mvelRule.substring(startIndex + 1, endIndex);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 430 +        }                                                                                                         </span>
<span class="3465129211023044589" onmouseenter="enter('3465129211023044589');" onmouseout="out('3465129211023044589');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 431 +        //maybe it is something like [x,x1,x2]? -&gt; (x,x1,x2), or [x1]-&gt;x1                                         </span>
<span class="4392933608627202925" onmouseenter="enter('4392933608627202925');" onmouseout="out('4392933608627202925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 432 +        if (customFieldValue.startsWith(&quot;[&quot;) &amp;&amp; customFieldValue.endsWith(&quot;]&quot;)) {                                 </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 433 +                customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);                  </span>
<span class="2068942897632961350" onmouseenter="enter('2068942897632961350');" onmouseout="out('2068942897632961350');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 434 +                if(customFieldValue.startsWith(&quot;\&quot;&quot;) &amp;&amp; customFieldValue.endsWith(&quot;\&quot;&quot;)){                         </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 435 +                    customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 436 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 437 +        }                                                                                                         </span>
<span class="2343498638185968541" onmouseenter="enter('2343498638185968541');" onmouseout="out('2343498638185968541');" style=""> 438          return customFieldValue;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439      }                                                                                                             </span>
<span  style=""> 440                                                                                                                    </span>
<span class="2022461544402072772" onmouseenter="enter('2022461544402072772');" onmouseout="out('2022461544402072772');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 441 -    protected String buildCustomFieldQuery(String customFieldPropertyName, String customFieldValue) {             </span>
<span class="3811964394326093800" onmouseenter="enter('3811964394326093800');" onmouseout="out('3811964394326093800');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 442 -        String customFieldQuery;                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 443 -                                                                                                                  </span>
<span class="-880826272471835272" onmouseenter="enter('-880826272471835272');" onmouseout="out('-880826272471835272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 444 -        List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(customFieldPropertyName);"> 444 -        List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(customðŸ”µ</abbr></span>
<span class="5327445461578075570" onmouseenter="enter('5327445461578075570');" onmouseout="out('5327445461578075570');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 445 -        if (isCustomFieldIndexed(indexFieldTypes)) {                                                              </span>
<span class="-6959390395506016943" onmouseenter="enter('-6959390395506016943');" onmouseout="out('-6959390395506016943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 446 -            customFieldQuery = &quot;*:*&amp;fq=(&quot;;                                                                        </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 447 -            for (IndexFieldType indexFieldType : indexFieldTypes) {                                               </span>
<span class="-3846951160350906445" onmouseenter="enter('-3846951160350906445');" onmouseout="out('-3846951160350906445');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 448 -                String type = indexFieldType.getFieldType().getType();                                            </span>
<span class="5460428113067565695" onmouseenter="enter('5460428113067565695');" onmouseout="out('5460428113067565695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 449 -                String indexFieldName = customFieldPropertyName + &quot;_&quot; + type;                                     </span>
<span class="4772222536273620275" onmouseenter="enter('4772222536273620275');" onmouseout="out('4772222536273620275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -                String indexFieldValue = &quot;\&quot;&quot; + customFieldValue + &quot;\&quot;&quot;;                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -                                                                                                                  </span>
<span class="3742298849854377420" onmouseenter="enter('3742298849854377420');" onmouseout="out('3742298849854377420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 452 -                if (!isFirstItem(customFieldQuery)) {                                                             </span>
<span class="-6766103428194254047" onmouseenter="enter('-6766103428194254047');" onmouseout="out('-6766103428194254047');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 453 -                    customFieldQuery += &quot; OR &quot;;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 454 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 455 -                                                                                                                  </span>
<span class="8651603528326862044" onmouseenter="enter('8651603528326862044');" onmouseout="out('8651603528326862044');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -                customFieldQuery += indexFieldName + &quot;:&quot; + indexFieldValue;                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 457 -            }                                                                                                     </span>
<span class="9186462271769049665" onmouseenter="enter('9186462271769049665');" onmouseout="out('9186462271769049665');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -            customFieldQuery += &quot;)&quot;;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 459 -        } else {                                                                                                  </span>
<span class="-7213318884752443458" onmouseenter="enter('-7213318884752443458');" onmouseout="out('-7213318884752443458');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -            customFieldQuery = &quot;&quot;;                                                                                </span>
<span class="7673449448629489621" onmouseenter="enter('7673449448629489621');" onmouseout="out('7673449448629489621');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -            LOG.warn(&quot;The &quot; + customFieldPropertyName + &quot; Custom Field must be indexed with Solr in order &quot; +     </span>
<span class="-2365438714239508567" onmouseenter="enter('-2365438714239508567');" onmouseout="out('-2365438714239508567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -                    &quot;to gather results based on an MVEL rule.&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 464 -                                                                                                                  </span>
<span class="-7117908646646108819" onmouseenter="enter('-7117908646646108819');" onmouseout="out('-7117908646646108819');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 465 -        return customFieldQuery;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 466 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 467 -                                                                                                                  </span>
<span class="6211373445546339851" onmouseenter="enter('6211373445546339851');" onmouseout="out('6211373445546339851');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 468 -    protected boolean isFirstItem(String customFieldQuery) {                                                      </span>
<span class="4077754241212580986" onmouseenter="enter('4077754241212580986');" onmouseout="out('4077754241212580986');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 469 -        return customFieldQuery.endsWith(&quot;&amp;fq=(&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 470 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 471 -                                                                                                                  </span>
<span class="7766953117726329902" onmouseenter="enter('7766953117726329902');" onmouseout="out('7766953117726329902');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 472 -    protected boolean isCustomFieldIndexed(List&lt;IndexFieldType&gt; indexFieldTypes) {                                </span>
<span class="-7835921473874723009" onmouseenter="enter('-7835921473874723009');" onmouseout="out('-7835921473874723009');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 473 -        return CollectionUtils.isNotEmpty(indexFieldTypes);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 474 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 475 -                                                                                                                  </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 476 -    // Expected Custom Field Rule Formats                                                                         </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 477 -    // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;                        </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 478 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 478 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelperðŸ”µ</abbr></span>
<span class="3152820343049190714" onmouseenter="enter('3152820343049190714');" onmouseout="out('3152820343049190714');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -    protected boolean isCustomFieldTargetingRule(String mvelRule) {                                               </span>
<span class="4644160885565809466" onmouseenter="enter('4644160885565809466');" onmouseout="out('4644160885565809466');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 480 -        boolean isEqualsCheck = isCustomFieldEqualsCheck(mvelRule);                                               </span>
<span class="5653554078825376094" onmouseenter="enter('5653554078825376094');" onmouseout="out('5653554078825376094');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 481 -        boolean isContainsCheck = isCustomFieldContainsCheck(mvelRule);                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 482 -                                                                                                                  </span>
<span class="963613174744814282" onmouseenter="enter('963613174744814282');" onmouseout="out('963613174744814282');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 483 -        return isEqualsCheck || isContainsCheck;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 484 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 485 -                                                                                                                  </span>
<span class="-8684692332269672736" onmouseenter="enter('-8684692332269672736');" onmouseout="out('-8684692332269672736');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 486 -    protected boolean isCustomFieldEqualsCheck(String mvelRule) {                                                 </span>
<span class="-2221664955143308193" onmouseenter="enter('-2221664955143308193');" onmouseout="out('-2221664955143308193');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 487 -        return mvelRule.matches(CUSTOM_FIELD_EQUALS_FORMAT_REGEX);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 488 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 489 -                                                                                                                  </span>
<span class="5856400022306021569" onmouseenter="enter('5856400022306021569');" onmouseout="out('5856400022306021569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 490 -    protected boolean isCustomFieldContainsCheck(String mvelRule) {                                               </span>
<span class="1754279180204192312" onmouseenter="enter('1754279180204192312');" onmouseout="out('1754279180204192312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 491 -        return mvelRule.matches(CUSTOM_FIELD_CONTAINS_FORMAT_REGEX);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 492 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 493 -                                                                                                                  </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 494 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0"> 494 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()ðŸ”µ</abbr></span>
<span class="8608097822218680501" onmouseenter="enter('8608097822218680501');" onmouseout="out('8608097822218680501');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -    protected boolean isCategoryTargetingRule(String mvelRule) {                                                  </span>
<span class="395583072845222703" onmouseenter="enter('395583072845222703');" onmouseout="out('395583072845222703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 496 -        return mvelRule.matches(CATEGORY_FORMAT_REGEX);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 497 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 498 -                                                                                                                  </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 499 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0"> 499 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()ðŸ”µ</abbr></span>
<span class="8774549159981507300" onmouseenter="enter('8774549159981507300');" onmouseout="out('8774549159981507300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 500 -    protected Long getCategoryId(String mvelRule) {                                                               </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -        int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                             </span>
<span class="7462371261616726470" onmouseenter="enter('7462371261616726470');" onmouseout="out('7462371261616726470');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 502 -        int endIndex = mvelRule.indexOf(&quot;\&quot;]&quot;);                                                                   </span>
<span class="-5169574352696925622" onmouseenter="enter('-5169574352696925622');" onmouseout="out('-5169574352696925622');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 503 -        String categoryId = mvelRule.substring(startIndex, endIndex);                                             </span>
<span class="5720946778179747754" onmouseenter="enter('5720946778179747754');" onmouseout="out('5720946778179747754');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 504 -        return categoryId == null ? null : Long.parseLong(categoryId);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 505 -    }                                                                                                             </span>
<span  style=""> 506                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3   * BroadleafCommerce Common Libraries                                                                             </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-4511052683777238249" onmouseenter="enter('-4511052683777238249');" onmouseout="out('-4511052683777238249');" style="">  18  package org.broadleafcommerce.core.search.service.solr;                                                           </span>
<span  style="">  19                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.broadleafcommerce.core.catalog.domain.Category;                                                        </span>
<span class="-932411199975142277" onmouseenter="enter('-932411199975142277');" onmouseout="out('-932411199975142277');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  25 +import org.broadleafcommerce.common.locale.domain.Locale;                                                         </span>
<span class="-4699531719896516827" onmouseenter="enter('-4699531719896516827');" onmouseout="out('-4699531719896516827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import org.broadleafcommerce.common.locale.domain.LocaleImpl;                                                     </span>
<span class="3092944370275379663" onmouseenter="enter('3092944370275379663');" onmouseout="out('3092944370275379663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import org.broadleafcommerce.common.locale.service.LocaleService;                                                 </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  28  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="-5557810556425933836" onmouseenter="enter('-5557810556425933836');" onmouseout="out('-5557810556425933836');" style="">  29  import org.broadleafcommerce.core.search.dao.IndexFieldDao;                                                       </span>
<span class="-6169657662549070816" onmouseenter="enter('-6169657662549070816');" onmouseout="out('-6169657662549070816');" style="">  30  import org.broadleafcommerce.core.search.domain.IndexFieldType;                                                   </span>

<span class="3348214099427628787" onmouseenter="enter('3348214099427628787');" onmouseout="out('3348214099427628787');" style="">  31  import org.broadleafcommerce.core.search.domain.SearchCriteria;                                                   </span>
<span class="8785733075363482948" onmouseenter="enter('8785733075363482948');" onmouseout="out('8785733075363482948');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import org.broadleafcommerce.core.search.domain.solr.FieldType;                                                   </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  33  import org.springframework.stereotype.Service;                                                                    </span>
<span  style="">  34                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +import java.util.ArrayList;                                                                                       </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import java.util.Collection;                                                                                      </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import java.util.Collections;                                                                                     </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38  import java.util.List;                                                                                            </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +import java.util.regex.Matcher;                                                                                   </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import java.util.regex.Pattern;                                                                                   </span>
<span  style="">  41                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  42  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  43                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  44  /**                                                                                                               </span>
<span class="-6557419552958427102" onmouseenter="enter('-6557419552958427102');" onmouseout="out('-6557419552958427102');" style="">  45   * Convenience methods for converting simple MVEL rules to Solr SearchCriteria                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  46   *                                                                                                                </span>
<span class="7828829262991528260" onmouseenter="enter('7828829262991528260');" onmouseout="out('7828829262991528260');" style="">  47   * @author Chris Kittrell (ckittrell)                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48   */                                                                                                               </span>
<span class="-5751247617688848665" onmouseenter="enter('-5751247617688848665');" onmouseout="out('-5751247617688848665');" style="">  49  @Service(&quot;blMvelToSearchCriteriaConversionService&quot;)                                                               </span>
<span class="7329482801380297950" onmouseenter="enter('7329482801380297950');" onmouseout="out('7329482801380297950');" style="">  50  public class MvelToSearchCriteriaConversionServiceImpl implements MvelToSearchCriteriaConversionService {         </span>
<span  style="">  51                                                                                                                    </span>
<span class="5180464717700805782" onmouseenter="enter('5180464717700805782');" onmouseout="out('5180464717700805782');" style="">  52      private static final Log LOG = LogFactory.getLog(MvelToSearchCriteriaConversionServiceImpl.class);            </span>
<span  style="">  53                                                                                                                    </span>
<span class="2834749092279287661" onmouseenter="enter('2834749092279287661');" onmouseout="out('2834749092279287661');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  54 -    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCategoryIds,\\[\\\&quot;([0-9]+)\\\&quot;\\]\\)\\.size\\(\\)&gt;0$&quot;;">  54 -    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCaðŸ”µ</abbr></span>
<span class="-4523406780264004987" onmouseenter="enter('-4523406780264004987');" onmouseout="out('-4523406780264004987');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  55 -    public static final String CUSTOM_FIELD_EQUALS_FORMAT_REGEX = &quot;^product\\.\\?getProductAttributes\\(\\)\\[\\\&quot;([a-zA-Z0-9_]+)\\\&quot;\\]\\=\\=\\\&quot;([a-zA-Z0-9\\s]+)\\\&quot;$&quot;;">  55 -    public static final String CUSTOM_FIELD_EQUALS_FORMAT_REGEX = &quot;^product\\.\\?getProductAttributes\\(\\)\\[\\\&quot;ðŸ”µ</abbr></span>
<span class="3309403789473145229" onmouseenter="enter('3309403789473145229');" onmouseout="out('3309403789473145229');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  56 -    public static final String CUSTOM_FIELD_CONTAINS_FORMAT_REGEX = &quot;^MvelHelper\\.toUpperCase\\(product\\.\\?getProductAttributes\\(\\)\\[\\\&quot;([a-zA-Z0-9_]+)\\\&quot;\\]\\)\\.contains\\(MvelHelper\\.toUpperCase\\(\\\&quot;([a-zA-Z0-9\\s]+)\\\&quot;\\)\\)$&quot;;">  56 -    public static final String CUSTOM_FIELD_CONTAINS_FORMAT_REGEX = &quot;^MvelHelper\\.toUpperCase\\(product\\.\\?getPðŸ”µ</abbr></span>
<span class="-970930589962964105" onmouseenter="enter('-970930589962964105');" onmouseout="out('-970930589962964105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  57 +    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCategoryIds,\\[\\\&quot;([0-9]+)(,\\\&quot;[0-9]+\\\&quot;)*\\\&quot;\\]\\)\\.size\\(\\)&gt;0$&quot;;">  57 +    public static final String CATEGORY_FORMAT_REGEX = &quot;^CollectionUtils\\.intersection\\(product\\.\\?allParentCaðŸ”µ</abbr></span>
<span  style="">  58                                                                                                                    </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  59      @Resource(name = &quot;blCatalogService&quot;)                                                                          </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  60      protected CatalogService catalogService;                                                                      </span>
<span  style="">  61                                                                                                                    </span>
<span class="-3300725031587330321" onmouseenter="enter('-3300725031587330321');" onmouseout="out('-3300725031587330321');" style="">  62      @Resource(name = &quot;blIndexFieldDao&quot;)                                                                           </span>
<span class="-3924976290958616503" onmouseenter="enter('-3924976290958616503');" onmouseout="out('-3924976290958616503');" style="">  63      protected IndexFieldDao indexFieldDao;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +                                                                                                                  </span>
<span class="6008764380027861894" onmouseenter="enter('6008764380027861894');" onmouseout="out('6008764380027861894');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +    @Resource(name = &quot;blLocaleService&quot;)                                                                           </span>
<span class="-5080270678165807269" onmouseenter="enter('-5080270678165807269');" onmouseout="out('-5080270678165807269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +    protected LocaleService localeService;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +                                                                                                                  </span>
<span class="-8412875699496826705" onmouseenter="enter('-8412875699496826705');" onmouseout="out('-8412875699496826705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +    @Resource(name=&quot;blSolrHelperService&quot;)                                                                         </span>
<span class="-6899732035501197192" onmouseenter="enter('-6899732035501197192');" onmouseout="out('-6899732035501197192');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    protected SolrHelperService solrHelperService;                                                                </span>
<span  style="">  70                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  71      @Override                                                                                                     </span>
<span class="8517769271291085647" onmouseenter="enter('8517769271291085647');" onmouseout="out('8517769271291085647');" style="">  72      public SearchCriteria convert(String mvelRule) {                                                              </span>
<span class="-3804295702574698939" onmouseenter="enter('-3804295702574698939');" onmouseout="out('-3804295702574698939');" style="">  73          SearchCriteria criteria = new SearchCriteria();                                                           </span>
<span class="-173756114249607612" onmouseenter="enter('-173756114249607612');" onmouseout="out('-173756114249607612');" style="">  74          criteria.setPageSize(Integer.MAX_VALUE);                                                                  </span>
<span  style="">  75                                                                                                                    </span>
<span class="1420632819213660087" onmouseenter="enter('1420632819213660087');" onmouseout="out('1420632819213660087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -        if (isCustomFieldTargetingRule(mvelRule)) {                                                               </span>
<span class="-446399616822641277" onmouseenter="enter('-446399616822641277');" onmouseout="out('-446399616822641277');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -            String customFieldQuery = buildCustomFieldQuery(mvelRule);                                            </span>
<span class="7600373260617955593" onmouseenter="enter('7600373260617955593');" onmouseout="out('7600373260617955593');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -            criteria.setQuery(customFieldQuery);                                                                  </span>
<span class="-1323593692837228727" onmouseenter="enter('-1323593692837228727');" onmouseout="out('-1323593692837228727');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -        } else if (isCategoryTargetingRule(mvelRule)) {                                                           </span>
<span class="7716210690929206627" onmouseenter="enter('7716210690929206627');" onmouseout="out('7716210690929206627');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -            Long categoryId = getCategoryId(mvelRule);                                                            </span>
<span class="-2855613335921473901" onmouseenter="enter('-2855613335921473901');" onmouseout="out('-2855613335921473901');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -            Category category = catalogService.findCategoryById(categoryId);                                      </span>
<span class="-4309914376254983206" onmouseenter="enter('-4309914376254983206');" onmouseout="out('-4309914376254983206');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -            criteria.setCategory(category);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -        } else {                                                                                                  </span>
<span class="4409051294563969145" onmouseenter="enter('4409051294563969145');" onmouseout="out('4409051294563969145');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -            throw new UnsupportedOperationException(&quot;The provided MVEL rule format is not currently supported &quot; + </span>
<span class="2957324841950163155" onmouseenter="enter('2957324841950163155');" onmouseout="out('2957324841950163155');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -                    &quot;for MVEL to Solr Search Criteria conversion.&quot;);                                              </span>
<span class="-5354029622989309350" onmouseenter="enter('-5354029622989309350');" onmouseout="out('-5354029622989309350');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +        if (isProductRule(mvelRule) || isCategoryTargetingRule(mvelRule)) {                                       </span>
<span class="3271724963188919231" onmouseenter="enter('3271724963188919231');" onmouseout="out('3271724963188919231');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +            Collection&lt;String&gt; strings = convertRuleToFilters(mvelRule);                                          </span>
<span class="-4712490940242734116" onmouseenter="enter('-4712490940242734116');" onmouseout="out('-4712490940242734116');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +            criteria.setFilterQueries(strings);                                                                   </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +        }else {                                                                                                   </span>
<span class="-1053745767754751717" onmouseenter="enter('-1053745767754751717');" onmouseout="out('-1053745767754751717');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +            throw new UnsupportedOperationException(&quot;The selected Add-On Product Group is defined using Rules &quot; + </span>
<span class="-5527057582948710822" onmouseenter="enter('-5527057582948710822');" onmouseout="out('-5527057582948710822');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +                    &quot;(Conditional Rules) and selected rule can&#x27;t be translated to solr criteria and so &quot; +        </span>
<span class="-622187049424662407" onmouseenter="enter('-622187049424662407');" onmouseout="out('-622187049424662407');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +                    &quot;does not support selection of a Default Product. See Tooltip for supported rule details&quot;);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93          }                                                                                                         </span>
<span  style="">  94                                                                                                                    </span>
<span class="-6542614039530216187" onmouseenter="enter('-6542614039530216187');" onmouseout="out('-6542614039530216187');" style="">  95          return criteria;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96      }                                                                                                             </span>
<span  style="">  97                                                                                                                    </span>
<span class="-6427268472263201482" onmouseenter="enter('-6427268472263201482');" onmouseout="out('-6427268472263201482');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -    protected String buildCustomFieldQuery(String mvelRule) {                                                     </span>
<span class="2585264375941701762" onmouseenter="enter('2585264375941701762');" onmouseout="out('2585264375941701762');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -        String customFieldPropertyName = getCustomFieldPropertyName(mvelRule);                                    </span>
<span class="528854707094626309" onmouseenter="enter('528854707094626309');" onmouseout="out('528854707094626309');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -        String customFieldValue = getCustomFieldValue(mvelRule);                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -                                                                                                                  </span>
<span class="6662198990197403694" onmouseenter="enter('6662198990197403694');" onmouseout="out('6662198990197403694');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -        return buildCustomFieldQuery(customFieldPropertyName, customFieldValue);                                  </span>
<span class="-1196261502723734502" onmouseenter="enter('-1196261502723734502');" onmouseout="out('-1196261502723734502');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +    protected boolean isProductRule(String rule){                                                                 </span>
<span class="-5300376996092551927" onmouseenter="enter('-5300376996092551927');" onmouseout="out('-5300376996092551927');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +        return rule.contains(&quot;product.&quot;);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +                                                                                                                  </span>
<span class="7766953117726329902" onmouseenter="enter('7766953117726329902');" onmouseout="out('7766953117726329902');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +    protected boolean isCustomFieldIndexed(List&lt;IndexFieldType&gt; indexFieldTypes) {                                </span>
<span class="-7835921473874723009" onmouseenter="enter('-7835921473874723009');" onmouseout="out('-7835921473874723009');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +        return CollectionUtils.isNotEmpty(indexFieldTypes);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +                                                                                                                  </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 111 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0"> 111 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()ðŸ”µ</abbr></span>
<span class="8608097822218680501" onmouseenter="enter('8608097822218680501');" onmouseout="out('8608097822218680501');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +    protected boolean isCategoryTargetingRule(String mvelRule) {                                                  </span>
<span class="395583072845222703" onmouseenter="enter('395583072845222703');" onmouseout="out('395583072845222703');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +        return mvelRule.matches(CATEGORY_FORMAT_REGEX);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +                                                                                                                  </span>
<span class="-4578046640382617025" onmouseenter="enter('-4578046640382617025');" onmouseout="out('-4578046640382617025');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 116 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;,...]).size()&gt;0"> 116 +    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;,...]).siðŸ”µ</abbr></span>
<span class="4479154694055573719" onmouseenter="enter('4479154694055573719');" onmouseout="out('4479154694055573719');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +    protected Long[] getCategoryIds(String mvelRule) {                                                            </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +        int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                             </span>
<span class="7462371261616726470" onmouseenter="enter('7462371261616726470');" onmouseout="out('7462371261616726470');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +        int endIndex = mvelRule.indexOf(&quot;\&quot;]&quot;);                                                                   </span>
<span class="-5169574352696925622" onmouseenter="enter('-5169574352696925622');" onmouseout="out('-5169574352696925622');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +        String categoryId = mvelRule.substring(startIndex, endIndex);                                             </span>
<span class="-4041863795518518577" onmouseenter="enter('-4041863795518518577');" onmouseout="out('-4041863795518518577');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +        //how about multivalue ?                                                                                  </span>
<span class="-1998049530286061470" onmouseenter="enter('-1998049530286061470');" onmouseout="out('-1998049530286061470');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +        String[] split = categoryId.split(&quot;,&quot;);                                                                   </span>
<span class="-8236882608667390929" onmouseenter="enter('-8236882608667390929');" onmouseout="out('-8236882608667390929');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +        Long[] result = null;                                                                                     </span>
<span class="7592411771574828106" onmouseenter="enter('7592411771574828106');" onmouseout="out('7592411771574828106');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +        int length = split.length;                                                                                </span>
<span class="3316164963146894618" onmouseenter="enter('3316164963146894618');" onmouseout="out('3316164963146894618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +        if (length &gt; 0) {                                                                                         </span>
<span class="4047096185297244897" onmouseenter="enter('4047096185297244897');" onmouseout="out('4047096185297244897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +            result = new Long[length];                                                                            </span>
<span class="6908715651536326362" onmouseenter="enter('6908715651536326362');" onmouseout="out('6908715651536326362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +            for (int i = 0; i &lt; length; i++) {                                                                    </span>
<span class="-7950545872238553987" onmouseenter="enter('-7950545872238553987');" onmouseout="out('-7950545872238553987');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +                result[i] = Long.parseLong(split[i].replace(&quot;\&quot;&quot;,&quot;&quot;));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +        }                                                                                                         </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +        return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132      }                                                                                                             </span>
<span  style=""> 133                                                                                                                    </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style=""> 134      // Expected Custom Field Rule Formats                                                                         </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style=""> 135      // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;                        </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style=""><abbr title=" 136      // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 136      // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelperðŸ”µ</abbr></span>
<span class="-8358459595516561004" onmouseenter="enter('-8358459595516561004');" onmouseout="out('-8358459595516561004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +    // Also supports string property contains, not contains, starts with, ends with etc.                          </span>
<span class="-3902656267910838436" onmouseenter="enter('-3902656267910838436');" onmouseout="out('-3902656267910838436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +    protected Collection&lt;String&gt; convertRuleToFilters(String matchRule) {                                         </span>
<span class="-3458259939128959835" onmouseenter="enter('-3458259939128959835');" onmouseout="out('-3458259939128959835');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +        List&lt;String&gt; filters = new ArrayList&lt;&gt;();                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +                                                                                                                  </span>
<span class="-4116233034312872188" onmouseenter="enter('-4116233034312872188');" onmouseout="out('-4116233034312872188');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +        boolean allRulesMustBeTrue = !matchRule.contains(&quot;||&quot;);                                                   </span>
<span class="-1571577425596797932" onmouseenter="enter('-1571577425596797932');" onmouseout="out('-1571577425596797932');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +        String[] fragments;                                                                                       </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +        if (allRulesMustBeTrue) {                                                                                 </span>
<span class="-7188061614336596101" onmouseenter="enter('-7188061614336596101');" onmouseout="out('-7188061614336596101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +            fragments = StringUtils.split(matchRule, &quot;&amp;&amp;&quot;);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +        } else {                                                                                                  </span>
<span class="413737876388623067" onmouseenter="enter('413737876388623067');" onmouseout="out('413737876388623067');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +            fragments = StringUtils.split(matchRule, &quot;||&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                                                                                                                  </span>
<span class="1564812142638062790" onmouseenter="enter('1564812142638062790');" onmouseout="out('1564812142638062790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +        for (String fragment : fragments) {                                                                       </span>
<span class="-5367054756288747777" onmouseenter="enter('-5367054756288747777');" onmouseout="out('-5367054756288747777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +            if (isCategoryTargetingRule(fragment)) {                                                              </span>
<span class="-734118791371905848" onmouseenter="enter('-734118791371905848');" onmouseout="out('-734118791371905848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                Long[] categoryIds = getCategoryIds(fragment);                                                    </span>
<span class="-4909662740848112852" onmouseenter="enter('-4909662740848112852');" onmouseout="out('-4909662740848112852');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                if (categoryIds != null) {                                                                        </span>
<span class="1805589472251784818" onmouseenter="enter('1805589472251784818');" onmouseout="out('1805589472251784818');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                    String explicitCategoryFieldName = solrHelperService.getExplicitCategoryFieldName();          </span>
<span class="-5287974135799764925" onmouseenter="enter('-5287974135799764925');" onmouseout="out('-5287974135799764925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                    StringBuilder categoryFilter = new StringBuilder(explicitCategoryFieldName + &quot;:(\&quot;&quot;);         </span>
<span class="1721743067668120143" onmouseenter="enter('1721743067668120143');" onmouseout="out('1721743067668120143');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                    for (int i = 0; i &lt; categoryIds.length; i++) {                                                </span>
<span class="6049075465718997151" onmouseenter="enter('6049075465718997151');" onmouseout="out('6049075465718997151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                        Long catId = solrHelperService.getCategoryId(categoryIds[i]);                             </span>
<span class="2247715214170223571" onmouseenter="enter('2247715214170223571');" onmouseout="out('2247715214170223571');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +                        categoryFilter.append(catId);                                                             </span>
<span class="670628716832445201" onmouseenter="enter('670628716832445201');" onmouseout="out('670628716832445201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +                        if (i + 1 &lt; categoryIds.length) {                                                         </span>
<span class="1110044106003867455" onmouseenter="enter('1110044106003867455');" onmouseout="out('1110044106003867455');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +                            categoryFilter.append(&quot;,&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +                        }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +                    }                                                                                             </span>
<span class="1970759344659845383" onmouseenter="enter('1970759344659845383');" onmouseout="out('1970759344659845383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +                    categoryFilter.append(&quot;\&quot;)&quot;);                                                                 </span>
<span class="4806920913497685296" onmouseenter="enter('4806920913497685296');" onmouseout="out('4806920913497685296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +                    filters.add(categoryFilter.toString());                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +                }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +            } else {                                                                                              </span>
<span class="4472642083753197869" onmouseenter="enter('4472642083753197869');" onmouseout="out('4472642083753197869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +                String fieldName = getCustomFieldPropertyName(fragment);                                          </span>
<span class="6767235149087130096" onmouseenter="enter('6767235149087130096');" onmouseout="out('6767235149087130096');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +                String fieldValue = getCustomFieldValue(fragment);                                                </span>
<span class="209342619518721793" onmouseenter="enter('209342619518721793');" onmouseout="out('209342619518721793');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +                boolean exclude = fragment.contains(&quot;!=&quot;) || fragment.startsWith(&quot;!&quot;);                            </span>
<span class="-513629237674612517" onmouseenter="enter('-513629237674612517');" onmouseout="out('-513629237674612517');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +                boolean isWildCardSearch = isWildCardSearch(fieldValue);                                          </span>
<span class="6416000241166527198" onmouseenter="enter('6416000241166527198');" onmouseout="out('6416000241166527198');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +                fieldName = convertFieldName(fieldName);                                                          </span>
<span class="-701725582702150457" onmouseenter="enter('-701725582702150457');" onmouseout="out('-701725582702150457');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 172 +                List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(fieldName);"> 172 +                List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyNamðŸ”µ</abbr></span>
<span class="-2103872491504669162" onmouseenter="enter('-2103872491504669162');" onmouseout="out('-2103872491504669162');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +                if (indexFieldTypes.size() &gt; 0) {                                                                 </span>
<span class="-3633847748226049075" onmouseenter="enter('-3633847748226049075');" onmouseout="out('-3633847748226049075');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +                    Boolean translatable = indexFieldTypes.get(0).getIndexField().getField().getTranslatable();   </span>
<span class="-1089691400420640956" onmouseenter="enter('-1089691400420640956');" onmouseout="out('-1089691400420640956');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                    List&lt;Locale&gt; allLocales;                                                                      </span>
<span class="-8810081931263659614" onmouseenter="enter('-8810081931263659614');" onmouseout="out('-8810081931263659614');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                    if (translatable==null || !translatable) {                                                    </span>
<span class="3172542301363761225" onmouseenter="enter('3172542301363761225');" onmouseout="out('3172542301363761225');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +                        allLocales = new ArrayList&lt;&gt;();                                                           </span>
<span class="8173230290853321992" onmouseenter="enter('8173230290853321992');" onmouseout="out('8173230290853321992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +                        LocaleImpl e = new LocaleImpl();                                                          </span>
<span class="5086162913928278042" onmouseenter="enter('5086162913928278042');" onmouseout="out('5086162913928278042');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +                        e.setLocaleCode(&quot;&quot;);                                                                      </span>
<span class="6078032241802864002" onmouseenter="enter('6078032241802864002');" onmouseout="out('6078032241802864002');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +                        allLocales.add(e);                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +                    } else {                                                                                      </span>
<span class="4255792891804321616" onmouseenter="enter('4255792891804321616');" onmouseout="out('4255792891804321616');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +                        allLocales = localeService.findAllLocales();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +                    }                                                                                             </span>
<span class="8261741881178153746" onmouseenter="enter('8261741881178153746');" onmouseout="out('8261741881178153746');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +                    List&lt;String&gt; tmpFilters = new ArrayList&lt;&gt;();                                                  </span>
<span class="884995363436364062" onmouseenter="enter('884995363436364062');" onmouseout="out('884995363436364062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +                    String abbreviation = indexFieldTypes.get(0).getIndexField().getField().getAbbreviation();    </span>
<span class="-925602233997175506" onmouseenter="enter('-925602233997175506');" onmouseout="out('-925602233997175506');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +                    for (Locale locale : allLocales) {                                                            </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +                        for (IndexFieldType indexFieldType : indexFieldTypes) {                                   </span>
<span class="-3846951160350906445" onmouseenter="enter('-3846951160350906445');" onmouseout="out('-3846951160350906445');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +                            String type = indexFieldType.getFieldType().getType();                                </span>
<span class="7549083283832157055" onmouseenter="enter('7549083283832157055');" onmouseout="out('7549083283832157055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +                            if (!isWildCardSearch || FieldType.STRING.getType().equals(type)) {                   </span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +                                String prefix;                                                                    </span>
<span class="7803706642416683862" onmouseenter="enter('7803706642416683862');" onmouseout="out('7803706642416683862');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                                if (StringUtils.isNotEmpty(locale.getLocaleCode())) {                             </span>
<span class="2867001838419777415" onmouseenter="enter('2867001838419777415');" onmouseout="out('2867001838419777415');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +                                    prefix = locale.getLocaleCode() + &quot;_&quot;;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +                                } else {                                                                          </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +                                    prefix = &quot;&quot;;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +                                }                                                                                 </span>
<span class="3385923284549100959" onmouseenter="enter('3385923284549100959');" onmouseout="out('3385923284549100959');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +                                String indexFieldName = prefix + abbreviation + &quot;_&quot; + type;                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +                                                                                                                  </span>
<span class="347763688069478794" onmouseenter="enter('347763688069478794');" onmouseout="out('347763688069478794');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 198 +                                // if this is a wildcard search then we do not want to surround the value with quotes"> 198 +                                // if this is a wildcard search then we do not want to surround the value with quoðŸ”µ</abbr></span>
<span class="-2654901131124248979" onmouseenter="enter('-2654901131124248979');" onmouseout="out('-2654901131124248979');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +                                String indexFieldValue = fieldValue;                                              </span>
<span class="2562112514760316298" onmouseenter="enter('2562112514760316298');" onmouseout="out('2562112514760316298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +                                if (!isWildCardSearch &amp;&amp; !fieldValue.equals(&quot;null&quot;)) {                            </span>
<span class="6375595447189419464" onmouseenter="enter('6375595447189419464');" onmouseout="out('6375595447189419464');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +                                    if(fieldValue.contains(&quot;\&quot;,\&quot;&quot;)){                                             </span>
<span class="-5010949076906240822" onmouseenter="enter('-5010949076906240822');" onmouseout="out('-5010949076906240822');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +                                        indexFieldValue = &quot;(\&quot;&quot; + fieldValue + &quot;\&quot;)&quot;;                             </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +                                    }else {                                                                       </span>
<span class="519269224162677901" onmouseenter="enter('519269224162677901');" onmouseout="out('519269224162677901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +                                        indexFieldValue = &quot;\&quot;&quot; + fieldValue + &quot;\&quot;&quot;;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +                                    }                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +                                                                                                                  </span>
<span class="7698560569635945367" onmouseenter="enter('7698560569635945367');" onmouseout="out('7698560569635945367');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +                                String filter;                                                                    </span>
<span class="8917473174740260176" onmouseenter="enter('8917473174740260176');" onmouseout="out('8917473174740260176');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +                                if (indexFieldValue.equals(&quot;null&quot;)) {                                             </span>
<span class="-2294577368288257511" onmouseenter="enter('-2294577368288257511');" onmouseout="out('-2294577368288257511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +                                    // this is for checking if null or non-existent fields                        </span>
<span class="2225974712227568097" onmouseenter="enter('2225974712227568097');" onmouseout="out('2225974712227568097');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +                                    filter = &quot;(*:* AND -&quot; + indexFieldName + &quot;:[* TO *])&quot;;                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +                                } else {                                                                          </span>
<span class="5648282257784433574" onmouseenter="enter('5648282257784433574');" onmouseout="out('5648282257784433574');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +                                    filter = indexFieldName + &quot;:&quot; + indexFieldValue;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +                                                                                                                  </span>
<span class="-2619174266387061747" onmouseenter="enter('-2619174266387061747');" onmouseout="out('-2619174266387061747');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +                                if (exclude) {                                                                    </span>
<span class="-5595087398256543047" onmouseenter="enter('-5595087398256543047');" onmouseout="out('-5595087398256543047');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                                    filter = &quot;NOT &quot; + filter;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +                                                                                                                  </span>
<span class="5890716202638474450" onmouseenter="enter('5890716202638474450');" onmouseout="out('5890716202638474450');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +                                tmpFilters.add(filter);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                            }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +                        }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +                    }                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +                                                                                                                  </span>
<span class="-5970112842789367779" onmouseenter="enter('-5970112842789367779');" onmouseout="out('-5970112842789367779');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +                    if (!exclude) {                                                                               </span>
<span class="4467181224644464926" onmouseenter="enter('4467181224644464926');" onmouseout="out('4467181224644464926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 226 +                        //any of translation and type fields like en_name_tsy, en_name_s etc can match, so concatinate with OR"> 226 +                        //any of translation and type fields like en_name_tsy, en_name_s etc can match, so concatiðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +                                                                                                                  </span>
<span class="-4629588024542266762" onmouseenter="enter('-4629588024542266762');" onmouseout="out('-4629588024542266762');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +                        String s = tmpFilters.get(0);                                                             </span>
<span class="6592156823824166930" onmouseenter="enter('6592156823824166930');" onmouseout="out('6592156823824166930');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +                        s = &quot;(&quot; + s;                                                                              </span>
<span class="-3902582789072783276" onmouseenter="enter('-3902582789072783276');" onmouseout="out('-3902582789072783276');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +                        tmpFilters.set(0, s);                                                                     </span>
<span class="-5094388359174835017" onmouseenter="enter('-5094388359174835017');" onmouseout="out('-5094388359174835017');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +                        int size = tmpFilters.size() - 1;                                                         </span>
<span class="-4545560731951074490" onmouseenter="enter('-4545560731951074490');" onmouseout="out('-4545560731951074490');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +                        String s1 = tmpFilters.get(size);                                                         </span>
<span class="7346319824215495439" onmouseenter="enter('7346319824215495439');" onmouseout="out('7346319824215495439');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +                        s1 = s1 + &quot;)&quot;;                                                                            </span>
<span class="-3192110405084466359" onmouseenter="enter('-3192110405084466359');" onmouseout="out('-3192110405084466359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +                        tmpFilters.set(size, s1);                                                                 </span>
<span class="2457502907598950300" onmouseenter="enter('2457502907598950300');" onmouseout="out('2457502907598950300');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +                        filters.add(StringUtils.join(tmpFilters, &quot; OR &quot;));                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +                    } else {                                                                                      </span>
<span class="-4161188039224121088" onmouseenter="enter('-4161188039224121088');" onmouseout="out('-4161188039224121088');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +                        //if we exclude we don&#x27;t want to see if at all so &quot;AND&quot; is ok                             </span>
<span class="-3843688481962930223" onmouseenter="enter('-3843688481962930223');" onmouseout="out('-3843688481962930223');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +                        filters.addAll(tmpFilters);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +                    }                                                                                             </span>
<span class="-2060121676001122986" onmouseenter="enter('-2060121676001122986');" onmouseout="out('-2060121676001122986');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +                    if (org.apache.commons.collections4.CollectionUtils.isEmpty(indexFieldTypes)) {               </span>
<span class="-777810702412233183" onmouseenter="enter('-777810702412233183');" onmouseout="out('-777810702412233183');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +                        if (fieldName.contains(&quot;catalogDiscriminator&quot;)) {                                         </span>
<span class="-7659514470241775465" onmouseenter="enter('-7659514470241775465');" onmouseout="out('-7659514470241775465');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +                            String substring = fieldValue.substring(1, fieldValue.length() - 1);                  </span>
<span class="475599518347961544" onmouseenter="enter('475599518347961544');" onmouseout="out('475599518347961544');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +                            filters.add(&quot;catalog_s:(&quot; + substring + &quot;)&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                        }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +                    }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +                } else {                                                                                          </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +                    return Collections.emptyList();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +        }                                                                                                         </span>
<span class="-7114536092016066599" onmouseenter="enter('-7114536092016066599');" onmouseout="out('-7114536092016066599');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +        if (allRulesMustBeTrue) {                                                                                 </span>
<span class="6161622804982278326" onmouseenter="enter('6161622804982278326');" onmouseout="out('6161622804982278326');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +            return filters;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +        } else {                                                                                                  </span>
<span class="-9109774989809899377" onmouseenter="enter('-9109774989809899377');" onmouseout="out('-9109774989809899377');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +            return Collections.singletonList(StringUtils.join(filters, &quot; OR &quot;));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +                                                                                                                  </span>
<span class="-5406295445993856151" onmouseenter="enter('-5406295445993856151');" onmouseout="out('-5406295445993856151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +    protected String convertFieldName(String fieldName) {                                                         </span>
<span class="-7966506343162908990" onmouseenter="enter('-7966506343162908990');" onmouseout="out('-7966506343162908990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +        String result = fieldName;                                                                                </span>
<span class="-4930215839282778035" onmouseenter="enter('-4930215839282778035');" onmouseout="out('-4930215839282778035');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +        if (fieldName.startsWith(&quot;product.&quot;)) {                                                                   </span>
<span class="-2221476328782692373" onmouseenter="enter('-2221476328782692373');" onmouseout="out('-2221476328782692373');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +            result = fieldName.substring(&quot;product.&quot;.length());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +        }                                                                                                         </span>
<span class="-4762333987006846107" onmouseenter="enter('-4762333987006846107');" onmouseout="out('-4762333987006846107');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +        if (result.endsWith(&quot;()&quot;)) {                                                                              </span>
<span class="-7370088352248235065" onmouseenter="enter('-7370088352248235065');" onmouseout="out('-7370088352248235065');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +            result = parseMethod(result);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +        }                                                                                                         </span>
<span class="-6976750953326715195" onmouseenter="enter('-6976750953326715195');" onmouseout="out('-6976750953326715195');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +        result = result.replaceAll(&quot;\\?&quot;, &quot;&quot;);                                                                    </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +        return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +    /**                                                                                                           </span>
<span class="-4961595856674117509" onmouseenter="enter('-4961595856674117509');" onmouseout="out('-4961595856674117509');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +     * Takes in a fieldName that contains a method (indicated with &quot;()&quot;) and converts the method to an attribute. </span>
<span class="-9122028151948342763" onmouseenter="enter('-9122028151948342763');" onmouseout="out('-9122028151948342763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +     * Currently supports getX() methods                                                                          </span>
<span class="-1753930683541957258" onmouseenter="enter('-1753930683541957258');" onmouseout="out('-1753930683541957258');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +     * For example, getType() -&gt; type                                                                             </span>
<span class="3732359556928566541" onmouseenter="enter('3732359556928566541');" onmouseout="out('3732359556928566541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +     * @param fieldName                                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +     * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +     */                                                                                                           </span>
<span class="-2963220266002726124" onmouseenter="enter('-2963220266002726124');" onmouseout="out('-2963220266002726124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +    protected String parseMethod(String fieldName) {                                                              </span>
<span class="-8263038990718822145" onmouseenter="enter('-8263038990718822145');" onmouseout="out('-8263038990718822145');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +        String[] segments = fieldName.split(&quot;\\.&quot;);                                                               </span>
<span class="-2872844272696595425" onmouseenter="enter('-2872844272696595425');" onmouseout="out('-2872844272696595425');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +        //parse the last segment removing the method prefix (e.g. get)                                            </span>
<span class="-6508141212304130711" onmouseenter="enter('-6508141212304130711');" onmouseout="out('-6508141212304130711');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +        String methodSegment = segments[segments.length-1].replaceFirst(&quot;(^get)&quot;, &quot;&quot;);                            </span>
<span class="8940076855127072513" onmouseenter="enter('8940076855127072513');" onmouseout="out('8940076855127072513');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +        //lowercase first char and remove the ()                                                                  </span>
<span class="-6069661116746750678" onmouseenter="enter('-6069661116746750678');" onmouseout="out('-6069661116746750678');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 282 +        segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.substring(1, methodSegment.length() - 2);"> 282 +        segments[segments.length - 1] = Character.toLowerCase(methodSegment.charAt(0)) + methodSegment.substring(1ðŸ”µ</abbr></span>
<span class="918919278535989799" onmouseenter="enter('918919278535989799');" onmouseout="out('918919278535989799');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +        return String.join(&quot;.&quot;, segments);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +    /**                                                                                                           </span>
<span class="-7802570112181619959" onmouseenter="enter('-7802570112181619959');" onmouseout="out('-7802570112181619959');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +     * Determines if the given field value string represents a wild card search. In Solr a wild card search either</span>
<span class="-5470509459016141827" onmouseenter="enter('-5470509459016141827');" onmouseout="out('-5470509459016141827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +     * starts or ends with an asterisk.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +     *                                                                                                            </span>
<span class="1221169641673317670" onmouseenter="enter('1221169641673317670');" onmouseout="out('1221169641673317670');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +     * @param fieldValue the String field value                                                                   </span>
<span class="-1593611972444689897" onmouseenter="enter('-1593611972444689897');" onmouseout="out('-1593611972444689897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +     * @return whether the value is for a wildcard search                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +     */                                                                                                           </span>
<span class="4130318305105801360" onmouseenter="enter('4130318305105801360');" onmouseout="out('4130318305105801360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +    protected boolean isWildCardSearch(String fieldValue) {                                                       </span>
<span class="-2660305773917818782" onmouseenter="enter('-2660305773917818782');" onmouseout="out('-2660305773917818782');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +        return fieldValue.startsWith(&quot;*&quot;) || fieldValue.endsWith(&quot;*&quot;);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +                                                                                                                  </span>








<span class="-3996318941156881450" onmouseenter="enter('-3996318941156881450');" onmouseout="out('-3996318941156881450');" style=""> 297      protected String getCustomFieldPropertyName(String mvelRule) {                                                </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 298 -        int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                             </span>
<span class="3450072205155988404" onmouseenter="enter('3450072205155988404');" onmouseout="out('3450072205155988404');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 299 -        int endIndex = mvelRule.lastIndexOf(&quot;\&quot;]&quot;);                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -                                                                                                                  </span>
<span class="791618933684830826" onmouseenter="enter('791618933684830826');" onmouseout="out('791618933684830826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -        return mvelRule.substring(startIndex, endIndex);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 302 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 303 -                                                                                                                  </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 304 -    // Expected Custom Field Rule Formats                                                                         </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 305 -    // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;                        </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 306 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 306 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelperðŸ”µ</abbr></span>
<span class="3679211462672518298" onmouseenter="enter('3679211462672518298');" onmouseout="out('3679211462672518298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 307 +        if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                                               </span>
<span class="-6513848732372278546" onmouseenter="enter('-6513848732372278546');" onmouseout="out('-6513848732372278546');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 308 +            //assuming left param is field, right is value                                                        </span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +            int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                               </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +            int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                                 </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +            mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +        }                                                                                                         </span>
<span class="1481037596687278193" onmouseenter="enter('1481037596687278193');" onmouseout="out('1481037596687278193');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +        if (mvelRule.indexOf(&quot;[\&quot;&quot;) &gt; 0) {                                                                        </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +            int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                         </span>
<span class="3450072205155988404" onmouseenter="enter('3450072205155988404');" onmouseout="out('3450072205155988404');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;]&quot;);                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +                                                                                                                  </span>
<span class="791618933684830826" onmouseenter="enter('791618933684830826');" onmouseout="out('791618933684830826');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +            return mvelRule.substring(startIndex, endIndex);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +        } else {                                                                                                  </span>
<span class="-599506282736455606" onmouseenter="enter('-599506282736455606');" onmouseout="out('-599506282736455606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 319 +            if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;.startsWith&quot;) || mvelRule.contains(&quot;.endsWith&quot;)) {"> 319 +            if (mvelRule.contains(&quot;org.apache.commons.lang3.StringUtils.contains&quot;) || mvelRule.contains(&quot;.startsWiðŸ”µ</abbr></span>
<span class="8594612171533799528" onmouseenter="enter('8594612171533799528');" onmouseout="out('8594612171533799528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +                int startIndex = mvelRule.indexOf(&quot;(&quot;);                                                           </span>
<span class="-2180454216947719546" onmouseenter="enter('-2180454216947719546');" onmouseout="out('-2180454216947719546');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +                int endIndex = mvelRule.indexOf(&quot;,&quot;);                                                             </span>
<span class="6757044639089116739" onmouseenter="enter('6757044639089116739');" onmouseout="out('6757044639089116739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +                mvelRule = mvelRule.substring(startIndex + 1, endIndex);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +            }                                                                                                     </span>
<span class="-2959351049191408844" onmouseenter="enter('-2959351049191408844');" onmouseout="out('-2959351049191408844');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +            mvelRule = getRuleOrPropertyFromFunction(mvelRule);                                                   </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +            return mvelRule;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +                                                                                                                  </span>
<span class="-5748560392795934189" onmouseenter="enter('-5748560392795934189');" onmouseout="out('-5748560392795934189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +    protected String getRuleOrPropertyFromFunction(String mvelRule) {                                             </span>
<span class="8079645033185490153" onmouseenter="enter('8079645033185490153');" onmouseout="out('8079645033185490153');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +        int i = mvelRule.indexOf(&#x27;(&#x27;);                                                                            </span>
<span class="6118269285616949201" onmouseenter="enter('6118269285616949201');" onmouseout="out('6118269285616949201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +        int j = mvelRule.indexOf(&#x27;)&#x27;, i);                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +                                                                                                                  </span>
<span class="-6286405257340566993" onmouseenter="enter('-6286405257340566993');" onmouseout="out('-6286405257340566993');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +        //no function or maybe just some function? like xxx.xxx.getType()                                         </span>
<span class="-6214758649886002427" onmouseenter="enter('-6214758649886002427');" onmouseout="out('-6214758649886002427');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 334 +        if (i == j || j == i + 1) {                                                                               </span>
<span class="-7679877352652422097" onmouseenter="enter('-7679877352652422097');" onmouseout="out('-7679877352652422097');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +            //expect to have either == or !=                                                                      </span>
<span class="3716522410886362712" onmouseenter="enter('3716522410886362712');" onmouseout="out('3716522410886362712');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +            int exclamationMark = mvelRule.indexOf(&quot;!&quot;);                                                          </span>
<span class="-1238738714139750554" onmouseenter="enter('-1238738714139750554');" onmouseout="out('-1238738714139750554');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +            if (exclamationMark &gt; 0) {                                                                            </span>
<span class="-4221725366469559006" onmouseenter="enter('-4221725366469559006');" onmouseout="out('-4221725366469559006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +                return mvelRule.substring(0, exclamationMark);                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +            } else {                                                                                              </span>
<span class="7053255170774622248" onmouseenter="enter('7053255170774622248');" onmouseout="out('7053255170774622248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +                int equalsSign = mvelRule.indexOf(&quot;=&quot;);                                                           </span>
<span class="2892411250985260390" onmouseenter="enter('2892411250985260390');" onmouseout="out('2892411250985260390');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +                if (equalsSign &gt; 0) {                                                                             </span>
<span class="-303051360151549224" onmouseenter="enter('-303051360151549224');" onmouseout="out('-303051360151549224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +                    return mvelRule.substring(0, equalsSign);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +                }                                                                                                 </span>
<span class="2254302976129981489" onmouseenter="enter('2254302976129981489');" onmouseout="out('2254302976129981489');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +                //unknown format                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +            }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +        } else {                                                                                                  </span>
<span class="-8922669227095711265" onmouseenter="enter('-8922669227095711265');" onmouseout="out('-8922669227095711265');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +            //looks like some function ?                                                                          </span>
<span class="724941001380407750" onmouseenter="enter('724941001380407750');" onmouseout="out('724941001380407750');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +            Pattern pattern = Pattern.compile(&quot;\\([^!=]+\\)&quot;);                                                    </span>
<span class="-6113564736220007098" onmouseenter="enter('-6113564736220007098');" onmouseout="out('-6113564736220007098');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 349 +            Matcher matcher = pattern.matcher(mvelRule);                                                          </span>
<span class="3484832867986496608" onmouseenter="enter('3484832867986496608');" onmouseout="out('3484832867986496608');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 350 +            if (matcher.find()) {                                                                                 </span>
<span class="-7610571215329733446" onmouseenter="enter('-7610571215329733446');" onmouseout="out('-7610571215329733446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 351 +                String group = matcher.group();                                                                   </span>
<span class="-8079573508343865500" onmouseenter="enter('-8079573508343865500');" onmouseout="out('-8079573508343865500');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +                return group.substring(1, group.length() - 1);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 353 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 355 +        }                                                                                                         </span>
<span class="6949920638711488563" onmouseenter="enter('6949920638711488563');" onmouseout="out('6949920638711488563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 356 +        return mvelRule;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 357 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 358 +                                                                                                                  </span>
<span class="6100636727859994582" onmouseenter="enter('6100636727859994582');" onmouseout="out('6100636727859994582');" style=""> 359      protected String getCustomFieldValue(String mvelRule) {                                                       </span>
<span class="-8500170060365651694" onmouseenter="enter('-8500170060365651694');" onmouseout="out('-8500170060365651694');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 360 -        String customFieldValue = new String();                                                                   </span>
<span class="7978195541639566813" onmouseenter="enter('7978195541639566813');" onmouseout="out('7978195541639566813');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 361 -        if (isCustomFieldEqualsCheck(mvelRule)) {                                                                 </span>
<span class="-3884654269271229942" onmouseenter="enter('-3884654269271229942');" onmouseout="out('-3884654269271229942');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 362 -            int startIndex = mvelRule.indexOf(&quot;==\&quot;&quot;) + 3;                                                        </span>
<span class="-7394942243426697137" onmouseenter="enter('-7394942243426697137');" onmouseout="out('-7394942243426697137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;&quot;);                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -                                                                                                                  </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -            customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -                                                                                                                  </span>
<span class="-6562750224709532054" onmouseenter="enter('-6562750224709532054');" onmouseout="out('-6562750224709532054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -        } else if (isCustomFieldContainsCheck(mvelRule)) {                                                        </span>
<span class="-3319890485526010677" onmouseenter="enter('-3319890485526010677');" onmouseout="out('-3319890485526010677');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 368 +        String customFieldValue = &quot;&quot;;                                                                             </span>
<span class="4516873309033909875" onmouseenter="enter('4516873309033909875');" onmouseout="out('4516873309033909875');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 369 +        if (mvelRule.contains(&quot;.contains&quot;)) {                                                                     </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style=""> 370              int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style=""> 371              int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                          </span>
<span  style=""> 372                                                                                                                    </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style=""> 373              customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -                                                                                                                  </span>
<span class="-5613902323637665591" onmouseenter="enter('-5613902323637665591');" onmouseout="out('-5613902323637665591');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 376 +        } else if (mvelRule.contains(&quot;==\&quot;&quot;) || mvelRule.contains(&quot;!=\&quot;&quot;)) {                                      </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 377 +            int startIndex;                                                                                       </span>
<span class="1954124054498899570" onmouseenter="enter('1954124054498899570');" onmouseout="out('1954124054498899570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 378 +            int endIndex;                                                                                         </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 379 +            if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                               </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +                startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="5123844857779866826" onmouseenter="enter('5123844857779866826');" onmouseout="out('5123844857779866826');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 381 +                endIndex = mvelRule.lastIndexOf(&quot;\&quot;)&quot;);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 382 +            } else {                                                                                              </span>
<span class="-8607486389615378476" onmouseenter="enter('-8607486389615378476');" onmouseout="out('-8607486389615378476');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +                startIndex = mvelRule.indexOf(&quot;==\&quot;&quot;) + 3;                                                        </span>
<span class="6650538524451873352" onmouseenter="enter('6650538524451873352');" onmouseout="out('6650538524451873352');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 384 +                endIndex = mvelRule.lastIndexOf(&quot;\&quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 386 +                                                                                                                  </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 387 +            customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span class="-6310515578280121309" onmouseenter="enter('-6310515578280121309');" onmouseout="out('-6310515578280121309');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 388 +        } else if (mvelRule.contains(&quot;==&quot;) || mvelRule.contains(&quot;!=&quot;)) {                                          </span>
<span class="-4696780379258535163" onmouseenter="enter('-4696780379258535163');" onmouseout="out('-4696780379258535163');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +            int startIndex;                                                                                       </span>
<span class="-243764101696257862" onmouseenter="enter('-243764101696257862');" onmouseout="out('-243764101696257862');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 390 +            int endIndex = mvelRule.length();                                                                     </span>
<span class="-146492613412761752" onmouseenter="enter('-146492613412761752');" onmouseout="out('-146492613412761752');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 391 +            if (mvelRule.contains(&quot;toUpperCase&quot;)) {                                                               </span>
<span class="-6344664936425511374" onmouseenter="enter('-6344664936425511374');" onmouseout="out('-6344664936425511374');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 392 +                startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-8058284614077640064" onmouseenter="enter('-8058284614077640064');" onmouseout="out('-8058284614077640064');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 393 +                endIndex = mvelRule.indexOf(&quot;\&quot;)&quot;, startIndex);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +            } else {                                                                                              </span>
<span class="6529493184259506230" onmouseenter="enter('6529493184259506230');" onmouseout="out('6529493184259506230');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +                int i = mvelRule.indexOf(&quot;==&quot;);                                                                   </span>
<span class="81359043772452968" onmouseenter="enter('81359043772452968');" onmouseout="out('81359043772452968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 396 +                if (i &gt; 0) {                                                                                      </span>
<span class="-4065973875162371300" onmouseenter="enter('-4065973875162371300');" onmouseout="out('-4065973875162371300');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 397 +                    startIndex = i + 2;                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 398 +                } else {                                                                                          </span>
<span class="-3645933873055406183" onmouseenter="enter('-3645933873055406183');" onmouseout="out('-3645933873055406183');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +                    startIndex = mvelRule.indexOf(&quot;!=&quot;) + 2;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +                                                                                                                  </span>
<span class="-4191639329098709319" onmouseenter="enter('-4191639329098709319');" onmouseout="out('-4191639329098709319');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 403 +            customFieldValue = mvelRule.substring(startIndex, endIndex);                                          </span>
<span class="2218296394576932022" onmouseenter="enter('2218296394576932022');" onmouseout="out('2218296394576932022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +        } else if (mvelRule.contains(&quot;.startsWith&quot;)) {                                                            </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +            int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +                                                                                                                  </span>
<span class="4581944832870405683" onmouseenter="enter('4581944832870405683');" onmouseout="out('4581944832870405683');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +            customFieldValue = mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;) + &quot;*&quot;;             </span>
<span class="-8060497764326038311" onmouseenter="enter('-8060497764326038311');" onmouseout="out('-8060497764326038311');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +        } else if (mvelRule.contains(&quot;.endsWith&quot;)) {                                                              </span>
<span class="-7969930343796312684" onmouseenter="enter('-7969930343796312684');" onmouseout="out('-7969930343796312684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +            int startIndex = mvelRule.lastIndexOf(&quot;(\&quot;&quot;) + 2;                                                     </span>
<span class="-6662134320706597884" onmouseenter="enter('-6662134320706597884');" onmouseout="out('-6662134320706597884');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +            int endIndex = mvelRule.lastIndexOf(&quot;\&quot;))&quot;);                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +                                                                                                                  </span>
<span class="-7671395845858615235" onmouseenter="enter('-7671395845858615235');" onmouseout="out('-7671395845858615235');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +            customFieldValue = &quot;*&quot; + mvelRule.substring(startIndex, endIndex).replaceAll(&quot; &quot;, &quot;\\ &quot;);             </span>
<span class="2520893722587110945" onmouseenter="enter('2520893722587110945');" onmouseout="out('2520893722587110945');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +        } else if (mvelRule.contains(&quot;==null&quot;)) {                                                                 </span>
<span class="2478736060735144080" onmouseenter="enter('2478736060735144080');" onmouseout="out('2478736060735144080');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +            // this means we have an &quot;is blank&quot; rule                                                              </span>
<span class="7951176582520491354" onmouseenter="enter('7951176582520491354');" onmouseout="out('7951176582520491354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +            customFieldValue = &quot;null&quot;;                                                                            </span>
<span class="8024335045226449466" onmouseenter="enter('8024335045226449466');" onmouseout="out('8024335045226449466');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +        } else if (mvelRule.contains(&quot;CollectionUtils&quot;)) {                                                        </span>
<span class="3487470046753460976" onmouseenter="enter('3487470046753460976');" onmouseout="out('3487470046753460976');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +            int startIndex = mvelRule.indexOf(&quot;,&quot;);                                                               </span>
<span class="4188065660318946716" onmouseenter="enter('4188065660318946716');" onmouseout="out('4188065660318946716');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +            int endIndex = mvelRule.indexOf(&quot;)&quot;, startIndex);                                                     </span>
<span class="-6758459872216563699" onmouseenter="enter('-6758459872216563699');" onmouseout="out('-6758459872216563699');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +            customFieldValue = mvelRule.substring(startIndex + 1, endIndex);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +        }                                                                                                         </span>
<span class="3465129211023044589" onmouseenter="enter('3465129211023044589');" onmouseout="out('3465129211023044589');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +        //maybe it is something like [x,x1,x2]? -&gt; (x,x1,x2), or [x1]-&gt;x1                                         </span>
<span class="4392933608627202925" onmouseenter="enter('4392933608627202925');" onmouseout="out('4392933608627202925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +        if (customFieldValue.startsWith(&quot;[&quot;) &amp;&amp; customFieldValue.endsWith(&quot;]&quot;)) {                                 </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +                customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);                  </span>
<span class="2068942897632961350" onmouseenter="enter('2068942897632961350');" onmouseout="out('2068942897632961350');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +                if(customFieldValue.startsWith(&quot;\&quot;&quot;) &amp;&amp; customFieldValue.endsWith(&quot;\&quot;&quot;)){                         </span>
<span class="7826109696268959972" onmouseenter="enter('7826109696268959972');" onmouseout="out('7826109696268959972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 426 +                    customFieldValue = customFieldValue.substring(1, customFieldValue.length() - 1);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 427 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 428 +        }                                                                                                         </span>
<span class="2343498638185968541" onmouseenter="enter('2343498638185968541');" onmouseout="out('2343498638185968541');" style=""> 429          return customFieldValue;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430      }                                                                                                             </span>
<span  style=""> 431                                                                                                                    </span>
<span class="2022461544402072772" onmouseenter="enter('2022461544402072772');" onmouseout="out('2022461544402072772');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 432 -    protected String buildCustomFieldQuery(String customFieldPropertyName, String customFieldValue) {             </span>
<span class="3811964394326093800" onmouseenter="enter('3811964394326093800');" onmouseout="out('3811964394326093800');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 433 -        String customFieldQuery;                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 434 -                                                                                                                  </span>
<span class="-880826272471835272" onmouseenter="enter('-880826272471835272');" onmouseout="out('-880826272471835272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 435 -        List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(customFieldPropertyName);"> 435 -        List&lt;IndexFieldType&gt; indexFieldTypes = indexFieldDao.getIndexFieldTypesByAbbreviationOrPropertyName(customðŸ”µ</abbr></span>
<span class="5327445461578075570" onmouseenter="enter('5327445461578075570');" onmouseout="out('5327445461578075570');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 436 -        if (isCustomFieldIndexed(indexFieldTypes)) {                                                              </span>
<span class="-6959390395506016943" onmouseenter="enter('-6959390395506016943');" onmouseout="out('-6959390395506016943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 437 -            customFieldQuery = &quot;*:*&amp;fq=(&quot;;                                                                        </span>
<span class="5744874212138018697" onmouseenter="enter('5744874212138018697');" onmouseout="out('5744874212138018697');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 438 -            for (IndexFieldType indexFieldType : indexFieldTypes) {                                               </span>
<span class="-3846951160350906445" onmouseenter="enter('-3846951160350906445');" onmouseout="out('-3846951160350906445');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 439 -                String type = indexFieldType.getFieldType().getType();                                            </span>
<span class="5460428113067565695" onmouseenter="enter('5460428113067565695');" onmouseout="out('5460428113067565695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 440 -                String indexFieldName = customFieldPropertyName + &quot;_&quot; + type;                                     </span>
<span class="4772222536273620275" onmouseenter="enter('4772222536273620275');" onmouseout="out('4772222536273620275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 441 -                String indexFieldValue = &quot;\&quot;&quot; + customFieldValue + &quot;\&quot;&quot;;                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 442 -                                                                                                                  </span>
<span class="3742298849854377420" onmouseenter="enter('3742298849854377420');" onmouseout="out('3742298849854377420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 443 -                if (!isFirstItem(customFieldQuery)) {                                                             </span>
<span class="-6766103428194254047" onmouseenter="enter('-6766103428194254047');" onmouseout="out('-6766103428194254047');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 444 -                    customFieldQuery += &quot; OR &quot;;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 445 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 446 -                                                                                                                  </span>
<span class="8651603528326862044" onmouseenter="enter('8651603528326862044');" onmouseout="out('8651603528326862044');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 447 -                customFieldQuery += indexFieldName + &quot;:&quot; + indexFieldValue;                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 448 -            }                                                                                                     </span>
<span class="9186462271769049665" onmouseenter="enter('9186462271769049665');" onmouseout="out('9186462271769049665');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 449 -            customFieldQuery += &quot;)&quot;;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -        } else {                                                                                                  </span>
<span class="-7213318884752443458" onmouseenter="enter('-7213318884752443458');" onmouseout="out('-7213318884752443458');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -            customFieldQuery = &quot;&quot;;                                                                                </span>
<span class="7673449448629489621" onmouseenter="enter('7673449448629489621');" onmouseout="out('7673449448629489621');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 452 -            LOG.warn(&quot;The &quot; + customFieldPropertyName + &quot; Custom Field must be indexed with Solr in order &quot; +     </span>
<span class="-2365438714239508567" onmouseenter="enter('-2365438714239508567');" onmouseout="out('-2365438714239508567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 453 -                    &quot;to gather results based on an MVEL rule.&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 454 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 455 -                                                                                                                  </span>
<span class="-7117908646646108819" onmouseenter="enter('-7117908646646108819');" onmouseout="out('-7117908646646108819');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -        return customFieldQuery;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 457 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -                                                                                                                  </span>
<span class="6211373445546339851" onmouseenter="enter('6211373445546339851');" onmouseout="out('6211373445546339851');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 459 -    protected boolean isFirstItem(String customFieldQuery) {                                                      </span>
<span class="4077754241212580986" onmouseenter="enter('4077754241212580986');" onmouseout="out('4077754241212580986');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -        return customFieldQuery.endsWith(&quot;&amp;fq=(&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -                                                                                                                  </span>
<span class="7766953117726329902" onmouseenter="enter('7766953117726329902');" onmouseout="out('7766953117726329902');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -    protected boolean isCustomFieldIndexed(List&lt;IndexFieldType&gt; indexFieldTypes) {                                </span>
<span class="-7835921473874723009" onmouseenter="enter('-7835921473874723009');" onmouseout="out('-7835921473874723009');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 464 -        return CollectionUtils.isNotEmpty(indexFieldTypes);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 465 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 466 -                                                                                                                  </span>
<span class="2161351616633289589" onmouseenter="enter('2161351616633289589');" onmouseout="out('2161351616633289589');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 467 -    // Expected Custom Field Rule Formats                                                                         </span>
<span class="-61004025388218336" onmouseenter="enter('-61004025388218336');" onmouseout="out('-61004025388218336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 468 -    // Equals - product.?getProductAttributes()[&quot;custom_field_name&quot;]==&quot;custom field value&quot;                        </span>
<span class="-8843409163359544612" onmouseenter="enter('-8843409163359544612');" onmouseout="out('-8843409163359544612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 469 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelper.toUpperCase(&quot;custom field value&quot;))"> 469 -    // Contains - MvelHelper.toUpperCase(product.?getProductAttributes()[&quot;custom_field_name&quot;]).contains(MvelHelperðŸ”µ</abbr></span>
<span class="3152820343049190714" onmouseenter="enter('3152820343049190714');" onmouseout="out('3152820343049190714');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 470 -    protected boolean isCustomFieldTargetingRule(String mvelRule) {                                               </span>
<span class="4644160885565809466" onmouseenter="enter('4644160885565809466');" onmouseout="out('4644160885565809466');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 471 -        boolean isEqualsCheck = isCustomFieldEqualsCheck(mvelRule);                                               </span>
<span class="5653554078825376094" onmouseenter="enter('5653554078825376094');" onmouseout="out('5653554078825376094');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 472 -        boolean isContainsCheck = isCustomFieldContainsCheck(mvelRule);                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 473 -                                                                                                                  </span>
<span class="963613174744814282" onmouseenter="enter('963613174744814282');" onmouseout="out('963613174744814282');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 474 -        return isEqualsCheck || isContainsCheck;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 475 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 476 -                                                                                                                  </span>
<span class="-8684692332269672736" onmouseenter="enter('-8684692332269672736');" onmouseout="out('-8684692332269672736');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 477 -    protected boolean isCustomFieldEqualsCheck(String mvelRule) {                                                 </span>
<span class="-2221664955143308193" onmouseenter="enter('-2221664955143308193');" onmouseout="out('-2221664955143308193');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 478 -        return mvelRule.matches(CUSTOM_FIELD_EQUALS_FORMAT_REGEX);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 480 -                                                                                                                  </span>
<span class="5856400022306021569" onmouseenter="enter('5856400022306021569');" onmouseout="out('5856400022306021569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 481 -    protected boolean isCustomFieldContainsCheck(String mvelRule) {                                               </span>
<span class="1754279180204192312" onmouseenter="enter('1754279180204192312');" onmouseout="out('1754279180204192312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 482 -        return mvelRule.matches(CUSTOM_FIELD_CONTAINS_FORMAT_REGEX);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 483 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 484 -                                                                                                                  </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 485 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0"> 485 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()ðŸ”µ</abbr></span>
<span class="8608097822218680501" onmouseenter="enter('8608097822218680501');" onmouseout="out('8608097822218680501');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 486 -    protected boolean isCategoryTargetingRule(String mvelRule) {                                                  </span>
<span class="395583072845222703" onmouseenter="enter('395583072845222703');" onmouseout="out('395583072845222703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 487 -        return mvelRule.matches(CATEGORY_FORMAT_REGEX);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 488 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 489 -                                                                                                                  </span>
<span class="-3689932147976443691" onmouseenter="enter('-3689932147976443691');" onmouseout="out('-3689932147976443691');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 490 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()&gt;0"> 490 -    // Expected Category Rule Format - CollectionUtils.intersection(product.?allParentCategoryIds,[&quot;2002&quot;]).size()ðŸ”µ</abbr></span>
<span class="8774549159981507300" onmouseenter="enter('8774549159981507300');" onmouseout="out('8774549159981507300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 491 -    protected Long getCategoryId(String mvelRule) {                                                               </span>
<span class="-7692124125165496123" onmouseenter="enter('-7692124125165496123');" onmouseout="out('-7692124125165496123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 492 -        int startIndex = mvelRule.indexOf(&quot;[\&quot;&quot;) + 2;                                                             </span>
<span class="7462371261616726470" onmouseenter="enter('7462371261616726470');" onmouseout="out('7462371261616726470');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 493 -        int endIndex = mvelRule.indexOf(&quot;\&quot;]&quot;);                                                                   </span>
<span class="-5169574352696925622" onmouseenter="enter('-5169574352696925622');" onmouseout="out('-5169574352696925622');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -        String categoryId = mvelRule.substring(startIndex, endIndex);                                             </span>
<span class="5720946778179747754" onmouseenter="enter('5720946778179747754');" onmouseout="out('5720946778179747754');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -        return categoryId == null ? null : Long.parseLong(categoryId);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 496 -    }                                                                                                             </span>
<span  style=""> 497                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            