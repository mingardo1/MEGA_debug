<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>247</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    247
                    <a href="246.html">prev</a>
                    <a href="248.html">next</a>
                    <a href="247_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CyanogenMod/android_packages_apps_Trebuchet_e3fe3f89ee956e8d7995c569948cb70765ec19b8_src/com/android/launcher3/LauncherBackupHelper.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;e3fe3f89ee956e8d7995c569948cb70765ec19b8:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;e3fe3f89ee956e8d7995c569948cb70765ec19b8^1:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;e3fe3f89ee956e8d7995c569948cb70765ec19b8^2:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;3fec14bedc03d77aa7a066a8053c6068dddda192:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [j]], subset: [[b], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21 import android.app.backup.BackupManager;                                                                 </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  22 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  23 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  24 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  25 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  26 import android.content.Intent;                                                                           </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="">  27 import android.content.pm.ActivityInfo;                                                                  </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  28 import android.content.pm.PackageManager;                                                                </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  29 import android.content.pm.PackageManager.NameNotFoundException;                                          </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">  30 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="">  31 import android.content.res.XmlResourceParser;                                                            </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  32 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  33 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  34 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  35 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  36 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  37 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  38 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  39 import android.util.Log;                                                                                 </span>
<span  style="">  40                                                                                                          </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  41 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  42 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  43 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  44 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  45 import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                       </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  46 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  47 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  48 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  49 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  50 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  51 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  52 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  53 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="">  54 import com.android.launcher3.util.Thunk;                                                                 </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  55 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  56 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span  style="">  57                                                                                                          </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="">  58 import org.xmlpull.v1.XmlPullParser;                                                                     </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="">  59 import org.xmlpull.v1.XmlPullParserException;                                                            </span>
<span  style="">  60                                                                                                          </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  61 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  62 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  63 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  64 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  65 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  66 import java.util.Arrays;                                                                                 </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  67 import java.util.HashSet;                                                                                </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  68 import java.util.zip.CRC32;                                                                              </span>
<span  style="">  69                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  70 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  71  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  72  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  73 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  74     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  75     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  76     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span  style="">  77                                                                                                          </span>
<span class="-984243926892874638" onmouseenter="enter('-984243926892874638');" onmouseout="out('-984243926892874638');" style="">  78     private static final int BACKUP_VERSION = 3;                                                         </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  79     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  80                                                                                                          </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  81     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  82     // key (any Base64 encoded string).                                                                  </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  83     private static final String JOURNAL_KEY = &quot;#&quot;;                                                       </span>
<span  style="">  84                                                                                                          </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  85     /** icons are large, dribble them out */                                                             </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  86     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  87                                                                                                          </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  88     /** widgets contain previews, which are very large, dribble them out */                              </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  89     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  90                                                                                                          </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  91     private static final String[] FAVORITE_PROJECTION = {                                                </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  92         Favorites._ID,                     // 0                                                          </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  93         Favorites.MODIFIED,                // 1                                                          </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  94         Favorites.INTENT,                  // 2                                                          </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  95         Favorites.APPWIDGET_PROVIDER,      // 3                                                          </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style="">  96         Favorites.APPWIDGET_ID,            // 4                                                          </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style="">  97         Favorites.CELLX,                   // 5                                                          </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style="">  98         Favorites.CELLY,                   // 6                                                          </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style="">  99         Favorites.CONTAINER,               // 7                                                          </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 100         Favorites.ICON,                    // 8                                                          </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 101         Favorites.ICON_PACKAGE,            // 9                                                          </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 102         Favorites.ICON_RESOURCE,           // 10                                                         </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 103         Favorites.ICON_TYPE,               // 11                                                         </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 104         Favorites.ITEM_TYPE,               // 12                                                         </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 105         Favorites.SCREEN,                  // 13                                                         </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 106         Favorites.SPANX,                   // 14                                                         </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 107         Favorites.SPANY,                   // 15                                                         </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 108         Favorites.TITLE,                   // 16                                                         </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 109         Favorites.PROFILE_ID,              // 17                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 110     };                                                                                                   </span>
<span  style=""> 111                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 112     private static final int ID_INDEX = 0;                                                               </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 113     private static final int ID_MODIFIED = 1;                                                            </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 114     private static final int INTENT_INDEX = 2;                                                           </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 115     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 116     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 117     private static final int CELLX_INDEX = 5;                                                            </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 118     private static final int CELLY_INDEX = 6;                                                            </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 119     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 120     private static final int ICON_INDEX = 8;                                                             </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 121     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 122     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 123     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 124     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 125     private static final int SCREEN_INDEX = 13;                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 126     private static final int SPANX_INDEX = 14;                                                           </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 127     private static final int SPANY_INDEX = 15;                                                           </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 128     private static final int TITLE_INDEX = 16;                                                           </span>
<span  style=""> 129                                                                                                          </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 130     private static final String[] SCREEN_PROJECTION = {                                                  </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 131         WorkspaceScreens._ID,              // 0                                                          </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 132         WorkspaceScreens.MODIFIED,         // 1                                                          </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 133         WorkspaceScreens.SCREEN_RANK       // 2                                                          </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 134     };                                                                                                   </span>
<span  style=""> 135                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 136     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 137                                                                                                          </span>
<span class="7768295683460392373" onmouseenter="enter('7768295683460392373');" onmouseout="out('7768295683460392373');" style=""> 138     @Thunk final Context mContext;                                                                       </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 139     private final HashSet&lt;String&gt; mExistingKeys;                                                         </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 140     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style=""> 141     private final ItemTypeMatcher[] mItemTypeMatchers;                                                   </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style=""> 142     private final long mUserSerial;                                                                      </span>
<span  style=""> 143                                                                                                          </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 144     private BackupManager mBackupManager;                                                                </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 145     private byte[] mBuffer = new byte[512];                                                              </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 146     private long mLastBackupRestoreTime;                                                                 </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 147     private boolean mBackupDataWasUpdated;                                                               </span>
<span  style=""> 148                                                                                                          </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style=""> 149     private IconCache mIconCache;                                                                        </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style=""> 150     private DeviceProfieData mDeviceProfileData;                                                         </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style=""> 151     private InvariantDeviceProfile mIdp;                                                                 </span>
<span  style=""> 152                                                                                                          </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 153     boolean restoreSuccessful;                                                                           </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 154     int restoredBackupVersion = 1;                                                                       </span>
<span  style=""> 155                                                                                                          </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 156     public LauncherBackupHelper(Context context) {                                                       </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 157         mContext = context;                                                                              </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 158         mExistingKeys = new HashSet&lt;String&gt;();                                                           </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 159         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 160         restoreSuccessful = true;                                                                        </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style=""> 161         mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];               </span>
<span  style=""> 162                                                                                                          </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style=""> 163         UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                         </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style=""> 164         mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165     }                                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 167     private void dataChanged() {                                                                         </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 168         if (mBackupManager == null) {                                                                    </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 169             mBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170         }                                                                                                </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 171         mBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172     }                                                                                                    </span>
<span  style=""> 173                                                                                                          </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 174     private void applyJournal(Journal journal) {                                                         </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 175         mLastBackupRestoreTime = journal.t;                                                              </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 176         mExistingKeys.clear();                                                                           </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 177         if (journal.key != null) {                                                                       </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 178             for (Key key : journal.key) {                                                                </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 179                 mExistingKeys.add(keyToBackupKey(key));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style=""> 182         restoredBackupVersion = journal.backupVersion;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 185     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 186      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 187      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 188      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 189      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 190      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 191      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 192      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 193      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 194      * @param newState notes for the next backup                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 195      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 196     @Override                                                                                            </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 197     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                      </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 198             ParcelFileDescriptor newState) {                                                             </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 199         if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                             </span>
<span  style=""> 200                                                                                                          </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 201         Journal in = readJournal(oldState);                                                              </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 202         if (!launcherIsReady()) {                                                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 203             dataChanged();                                                                               </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 204             // Perform backup later.                                                                     </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 205             writeJournal(newState, in);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 206             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207         }                                                                                                </span>
<span  style=""> 208                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 209         if (mDeviceProfileData == null) {                                                                </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 210             LauncherAppState app = LauncherAppState.getInstance();                                       </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style=""> 211             mIdp = app.getInvariantDeviceProfile();                                                      </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 212             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 213             mIconCache = app.getIconCache();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span  style=""> 215                                                                                                          </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 216         Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                          </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 217         mKeys.clear();                                                                                   </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 218         applyJournal(in);                                                                                </span>
<span  style=""> 219                                                                                                          </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 220         // Record the time before performing backup so that entries edited while the backup              </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 221         // was going on, do not get missed in next backup.                                               </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 222         long newBackupTime = System.currentTimeMillis();                                                 </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 223         mBackupDataWasUpdated = false;                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 224         try {                                                                                            </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 225             backupFavorites(data);                                                                       </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 226             backupScreens(data);                                                                         </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 227             backupIcons(data);                                                                           </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 228             backupWidgets(data);                                                                         </span>
<span  style=""> 229                                                                                                          </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 230             // Delete any key which still exist in the old backup, but is not valid anymore.             </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 231             HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                           </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 232             for (Key key : mKeys) {                                                                      </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 233                 validKeys.add(keyToBackupKey(key));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234             }                                                                                            </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 235             mExistingKeys.removeAll(validKeys);                                                          </span>
<span  style=""> 236                                                                                                          </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 237             // Delete anything left in the existing keys.                                                </span>
<span class="-8057776950468218811" onmouseenter="enter('-8057776950468218811');" onmouseout="out('-8057776950468218811');" style=""> 238             for (String deleted: mExistingKeys) {                                                        </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style=""> 239                 if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                             </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 240                 data.writeEntityHeader(deleted, -1);                                                     </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 241                 mBackupDataWasUpdated = true;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242             }                                                                                            </span>
<span  style=""> 243                                                                                                          </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 244             mExistingKeys.clear();                                                                       </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 245             if (!mBackupDataWasUpdated) {                                                                </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 246                 // Check if any metadata has changed                                                     </span>
<span class="4456255566361909194" onmouseenter="enter('4456255566361909194');" onmouseout="out('4456255566361909194');" style=""> 247                 mBackupDataWasUpdated = (in.profile == null)                                             </span>
<span class="3696867724938300008" onmouseenter="enter('3696867724938300008');" onmouseout="out('3696867724938300008');" style=""> 248                         || !Arrays.equals(DeviceProfieData.toByteArray(in.profile),                      </span>
<span class="-526865330972865914" onmouseenter="enter('-526865330972865914');" onmouseout="out('-526865330972865914');" style=""> 249                             DeviceProfieData.toByteArray(mDeviceProfileData))                            </span>
<span class="-3212861652554024645" onmouseenter="enter('-3212861652554024645');" onmouseout="out('-3212861652554024645');" style=""> 250                         || (in.backupVersion != BACKUP_VERSION)                                          </span>
<span class="3693115347738857050" onmouseenter="enter('3693115347738857050');" onmouseout="out('3693115347738857050');" style=""> 251                         || (in.appVersion != getAppVersion());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252             }                                                                                            </span>
<span  style=""> 253                                                                                                          </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 254             if (mBackupDataWasUpdated) {                                                                 </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 255                 mLastBackupRestoreTime = newBackupTime;                                                  </span>
<span  style=""> 256                                                                                                          </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 257                 // We store the journal at two places.                                                   </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style=""> 258                 //   1) Storing it in newState allows us to do partial backups by comparing old state    </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style=""> 259                 //   2) Storing it in backup data allows us to validate keys during restore              </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 260                 Journal state = getCurrentStateJournal();                                                </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 261                 writeRowToBackup(JOURNAL_KEY, state, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 262             } else {                                                                                     </span>
<span class="6846529623619819273" onmouseenter="enter('6846529623619819273');" onmouseout="out('6846529623619819273');" style=""> 263                 if (DEBUG) Log.d(TAG, &quot;Nothing was written during backup&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 265         } catch (IOException e) {                                                                        </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 266             Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267         }                                                                                                </span>
<span  style=""> 268                                                                                                          </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 269         writeNewStateDescription(newState);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270     }                                                                                                    </span>
<span  style=""> 271                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 272     /**                                                                                                  </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 273      * @return true if the backup corresponding to oldstate can be successfully applied                  </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 274      * to this device.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 275      */                                                                                                  </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 276     private boolean isBackupCompatible(Journal oldState) {                                               </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 277         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 278         DeviceProfieData oldProfile = oldState.profile;                                                  </span>
<span  style=""> 279                                                                                                          </span>
<span class="3516483988150785854" onmouseenter="enter('3516483988150785854');" onmouseout="out('3516483988150785854');" style=""> 280         if (oldProfile == null || oldProfile.desktopCols == 0) {                                         </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 281             // Profile info is not valid, ignore the check.                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 282             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283         }                                                                                                </span>
<span  style=""> 284                                                                                                          </span>
<span class="-3969248474555793010" onmouseenter="enter('-3969248474555793010');" onmouseout="out('-3969248474555793010');" style=""> 285         boolean isHotsetCompatible = false;                                                              </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 286         if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                     </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 287             isHotsetCompatible = true;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span class="-5234148737954946799" onmouseenter="enter('-5234148737954946799');" onmouseout="out('-5234148737954946799');" style=""> 289         if ((currentProfile.hotseatCount &gt;= oldProfile.hotseatCount) &amp;&amp;                                  </span>
<span class="-4785593469925988823" onmouseenter="enter('-4785593469925988823');" onmouseout="out('-4785593469925988823');" style=""> 290                 (currentProfile.allappsRank == oldProfile.allappsRank)) {                                </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 291             isHotsetCompatible = true;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292         }                                                                                                </span>
<span  style=""> 293                                                                                                          </span>
<span class="-6996782978604961637" onmouseenter="enter('-6996782978604961637');" onmouseout="out('-6996782978604961637');" style=""> 294         return isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)              </span>
<span class="4824114787736852304" onmouseenter="enter('4824114787736852304');" onmouseout="out('4824114787736852304');" style=""> 295                 &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296     }                                                                                                    </span>
<span  style=""> 297                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 298     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 299      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 300      * It assumes that the keys will arrive in lexical order. So if the journal was present in the       </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 301      * backup, it should arrive first.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 302      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 303      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 304      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 305     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 306     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 307         if (!restoreSuccessful) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 308             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309         }                                                                                                </span>
<span  style=""> 310                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 311         if (mDeviceProfileData == null) {                                                                </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style=""> 312             // This call does not happen on a looper thread. So LauncherAppState                         </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style=""> 313             // can&#x27;t be created . Instead initialize required dependencies directly.                     </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style=""> 314             mIdp = new InvariantDeviceProfile(mContext);                                                 </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 315             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style=""> 316             mIconCache = new IconCache(mContext, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span  style=""> 318                                                                                                          </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 319         int dataSize = data.size();                                                                      </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 320         if (mBuffer.length &lt; dataSize) {                                                                 </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 321             mBuffer = new byte[dataSize];                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 323         try {                                                                                            </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 324             int bytesRead = data.read(mBuffer, 0, dataSize);                                             </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 325             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);               </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 326             String backupKey = data.getKey();                                                            </span>
<span  style=""> 327                                                                                                          </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 328             if (JOURNAL_KEY.equals(backupKey)) {                                                         </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 329                 if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                       </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 330                 if (!mKeys.isEmpty()) {                                                                  </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 331                     // We received the journal key after a restore key.                                  </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 332                     Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);       </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 333                     restoreSuccessful = false;                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 334                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335                 }                                                                                        </span>
<span  style=""> 336                                                                                                          </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 337                 Journal journal = new Journal();                                                         </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 338                 MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                     </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 339                 applyJournal(journal);                                                                   </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 340                 restoreSuccessful = isBackupCompatible(journal);                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 341                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342             }                                                                                            </span>
<span  style=""> 343                                                                                                          </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 344             if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                        </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 345                 if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 346                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347             }                                                                                            </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 348             Key key = backupKeyToKey(backupKey);                                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 349             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 350             switch (key.type) {                                                                          </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 351                 case Key.FAVORITE:                                                                       </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 352                     restoreFavorite(key, mBuffer, dataSize);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 353                     break;                                                                               </span>
<span  style=""> 354                                                                                                          </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 355                 case Key.SCREEN:                                                                         </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 356                     restoreScreen(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 357                     break;                                                                               </span>
<span  style=""> 358                                                                                                          </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 359                 case Key.ICON:                                                                           </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 360                     restoreIcon(key, mBuffer, dataSize);                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 361                     break;                                                                               </span>
<span  style=""> 362                                                                                                          </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 363                 case Key.WIDGET:                                                                         </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 364                     restoreWidget(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 365                     break;                                                                               </span>
<span  style=""> 366                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 367                 default:                                                                                 </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 368                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 369                     mKeys.remove(key);                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 370                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 372         } catch (IOException e) {                                                                        </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 373             Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375     }                                                                                                    </span>
<span  style=""> 376                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 377     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 378      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 379      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 380      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 381      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 382     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 383     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 384         writeJournal(newState, getCurrentStateJournal());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385     }                                                                                                    </span>
<span  style=""> 386                                                                                                          </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 387     private Journal getCurrentStateJournal() {                                                           </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 388         Journal journal = new Journal();                                                                 </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 389         journal.t = mLastBackupRestoreTime;                                                              </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 390         journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                 </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 391         journal.appVersion = getAppVersion();                                                            </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 392         journal.backupVersion = BACKUP_VERSION;                                                          </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style=""> 393         journal.profile = mDeviceProfileData;                                                            </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 394         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395     }                                                                                                    </span>
<span  style=""> 396                                                                                                          </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 397     private int getAppVersion() {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 398         try {                                                                                            </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 399             return mContext.getPackageManager()                                                          </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 400                     .getPackageInfo(mContext.getPackageName(), 0).versionCode;                           </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 401         } catch (NameNotFoundException e) {                                                              </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 402             return 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404     }                                                                                                    </span>
<span  style=""> 405                                                                                                          </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style=""> 406     private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                     </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style=""> 407         DeviceProfieData data = new DeviceProfieData();                                                  </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style=""> 408         data.desktopRows = profile.numRows;                                                              </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style=""> 409         data.desktopCols = profile.numColumns;                                                           </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style=""> 410         data.hotseatCount = profile.numHotseatIcons;                                                     </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style=""> 411         data.allappsRank = profile.hotseatAllAppsRank;                                                   </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style=""> 412         return data;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413     }                                                                                                    </span>
<span  style=""> 414                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 415     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 416      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 417      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 418      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 419      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 420      */                                                                                                  </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 421     private void backupFavorites(BackupDataOutput data) throws IOException {                             </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 422         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 423         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 424         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 425         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 426                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 427         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 428             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 429             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 430                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 431                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 432                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 433                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 434                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 435                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 436                     writeRowToBackup(key, packFavorite(cursor), data);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 437                 } else {                                                                                 </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 438                     if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 441         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 442             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444     }                                                                                                    </span>
<span  style=""> 445                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 446     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 447      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 448      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 449      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 450      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 451      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 452      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 453      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 454      */                                                                                                  </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 455     private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {              </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 456         if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                         </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 457         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 458                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 459                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 460         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 461         ContentValues values = unpackFavorite(buffer, dataSize);                                         </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style=""> 462         cr.insert(Favorites.CONTENT_URI, values);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463     }                                                                                                    </span>
<span  style=""> 464                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 465     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 466      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 467      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 468      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 469      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 470      */                                                                                                  </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 471     private void backupScreens(BackupDataOutput data) throws IOException {                               </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 472         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 473         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 474         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 475                 null, null, null);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 476         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 477             cursor.moveToPosition(-1);                                                                   </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 478             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 479             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 480                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 481                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 482                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 483                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 484                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 485                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 486                     writeRowToBackup(key, packScreen(cursor), data);                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 487                 } else {                                                                                 </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 488                     if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 491         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 492             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494     }                                                                                                    </span>
<span  style=""> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 496     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 497      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 498      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 499      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 500      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 501      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 502      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 503      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 504      */                                                                                                  </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 505     private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 506         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 507         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 508                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 509                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 510         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 511         ContentValues values = unpackScreen(buffer, dataSize);                                           </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 512         cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513     }                                                                                                    </span>
<span  style=""> 514                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 515     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 516      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 517      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 518      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 519      * @param data output stream for key/value pairs                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 520      */                                                                                                  </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 521     private void backupIcons(BackupDataOutput data) throws IOException {                                 </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 522         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 523         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 524         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 525         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 526         int backupUpIconCount = 0;                                                                       </span>
<span  style=""> 527                                                                                                          </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 528         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 529         String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +      </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 530                 Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                    </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 531                 getUserSelectionArg();                                                                   </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 532         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 533                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 534         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 535             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 536             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 537                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 538                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 539                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 540                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 541                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 542                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 543                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 544                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 545                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 546                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 547                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 548                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                     }                                                                                    </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 550                     if (mExistingKeys.contains(backupKey)) {                                             </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 551                         if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                        </span>
<span  style=""> 552                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 553                         // remember that we already backed this up previously                            </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 554                         mKeys.add(key);                                                                  </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 555                     } else if (backupKey != null) {                                                      </span>
<span class="-6310531343064499436" onmouseenter="enter('-6310531343064499436');" onmouseout="out('-6310531343064499436');" style=""> 556                         if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);            </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 557                         if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                    </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 558                             if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                           </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 559                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 560                             if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {         </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 561                                 writeRowToBackup(key, packIcon(dpi, icon), data);                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 562                                 mKeys.add(key);                                                          </span>
<span class="5377719919294214367" onmouseenter="enter('5377719919294214367');" onmouseout="out('5377719919294214367');" style=""> 563                                 backupUpIconCount ++;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 565                         } else {                                                                         </span>
<span class="4246955911601526686" onmouseenter="enter('4246955911601526686');" onmouseout="out('4246955911601526686');" style=""> 566                             if (VERBOSE) Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);               </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 567                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 568                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 571                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 572                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 573                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 574                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 575                 }                                                                                        </span>
<span  style=""> 576                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 578         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 579             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581     }                                                                                                    </span>
<span  style=""> 582                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 583     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 584      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 585      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 586      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 587      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 588      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 589      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 590      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 591      */                                                                                                  </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 592     private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                  </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 593         if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                             </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 594         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 595                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 596                                                                                                          </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 597         Resource res = unpackProto(new Resource(), buffer, dataSize);                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 598         if (DEBUG) {                                                                                     </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 599             Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600         }                                                                                                </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 601         Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                       </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 602         if (icon == null) {                                                                              </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 603             Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604         }                                                                                                </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 605         if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                 </span>
<span class="-1593325621603386304" onmouseenter="enter('-1593325621603386304');" onmouseout="out('-1593325621603386304');" style=""> 606         mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi,               </span>
<span class="406035679709329885" onmouseenter="enter('406035679709329885');" onmouseout="out('406035679709329885');" style=""> 607                 &quot;&quot; /* label */, mUserSerial);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608     }                                                                                                    </span>
<span  style=""> 609                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 610     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 611      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 612      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 613      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 614      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 615      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 616      */                                                                                                  </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 617     private void backupWidgets(BackupDataOutput data) throws IOException {                               </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 618         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 619         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 620         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 621         int backupWidgetCount = 0;                                                                       </span>
<span  style=""> 622                                                                                                          </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 623         String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;               </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 624                 + getUserSelectionArg();                                                                 </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 625         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 626                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 627         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 628             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 629             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 630                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 631                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 632                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 633                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 634                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 635                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 636                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 637                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 638                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 639                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640                 }                                                                                        </span>
<span class="7478848681639332606" onmouseenter="enter('7478848681639332606');" onmouseout="out('7478848681639332606');" style=""> 641                 if (mExistingKeys.contains(backupKey) &amp;&amp; restoredBackupVersion &gt;= BACKUP_VERSION) {      </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 642                     if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                          </span>
<span  style=""> 643                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 644                     // remember that we already backed this up previously                                </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 645                     mKeys.add(key);                                                                      </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 646                 } else if (backupKey != null) {                                                          </span>
<span class="-6588785262075303708" onmouseenter="enter('-6588785262075303708');" onmouseout="out('-6588785262075303708');" style=""> 647                     if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 648                     if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                      </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 649                         if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                             </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 650                         UserHandleCompat user = UserHandleCompat.myUserHandle();                         </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style=""> 651                         writeRowToBackup(key, packWidget(dpi, provider, user), data);                    </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 652                         mKeys.add(key);                                                                  </span>
<span class="945813103637646770" onmouseenter="enter('945813103637646770');" onmouseout="out('945813103637646770');" style=""> 653                         backupWidgetCount ++;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 654                     } else {                                                                             </span>
<span class="5790411094184621928" onmouseenter="enter('5790411094184621928');" onmouseout="out('5790411094184621928');" style=""> 655                         if (VERBOSE) Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                 </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 656                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 657                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 661         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 662             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664     }                                                                                                    </span>
<span  style=""> 665                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 666     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 667      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 668      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 669      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 670      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 671      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 672      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 673      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 674      */                                                                                                  </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 675     private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 676         if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 677         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 678                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 679         Widget widget = unpackProto(new Widget(), buffer, dataSize);                                     </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 680         if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                            </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 681         if (widget.icon.data != null)  {                                                                 </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 682             Bitmap icon = BitmapFactory                                                                  </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 683                     .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                      </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 684             if (icon == null) {                                                                          </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 685                 Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 686             } else {                                                                                     </span>
<span class="4162878957742609395" onmouseenter="enter('4162878957742609395');" onmouseout="out('4162878957742609395');" style=""> 687                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider),               </span>
<span class="3902851904278031906" onmouseenter="enter('3902851904278031906');" onmouseout="out('3902851904278031906');" style=""> 688                         icon, widget.icon.dpi, widget.label, mUserSerial);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690         }                                                                                                </span>
<span  style=""> 691                                                                                                          </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 692         // future site of widget table mutation                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693     }                                                                                                    </span>
<span  style=""> 694                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 695     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 696      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 697      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 698      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 699      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 700     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 701         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 702         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 703         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 704         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 705         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706     }                                                                                                    </span>
<span  style=""> 707                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 708     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 709      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 710      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 711      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 712      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 713     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 714         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 715         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 716         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 717         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 718         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719     }                                                                                                    </span>
<span  style=""> 720                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 721     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 722     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 723         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724     }                                                                                                    </span>
<span  style=""> 725                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 726     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 727     private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 728         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 729             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 730             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 731                 key = null;                                                                              </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 732                 throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 734             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 735         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 736             throw new InvalidBackupException(e);                                                         </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 737         } catch (IllegalArgumentException e) {                                                           </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 738             throw new InvalidBackupException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740     }                                                                                                    </span>
<span  style=""> 741                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 742     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 743     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 744         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 745         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 746         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 747         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 748         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 749             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 751         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 752     }                                                                                                    </span>
<span  style=""> 753                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 754     /**                                                                                                  </span>
<span class="-7741701430317985923" onmouseenter="enter('-7741701430317985923');" onmouseout="out('-7741701430317985923');" style=""> 755      * @return true if its an hotseat item, that can be replaced during restore.                         </span>
<span class="6416967335754747262" onmouseenter="enter('6416967335754747262');" onmouseout="out('6416967335754747262');" style=""> 756      * TODO: Extend check for folders in hotseat.                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 757      */                                                                                                  </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style=""> 758     private boolean isReplaceableHotseatItem(Favorite favorite) {                                        </span>
<span class="604075697947552793" onmouseenter="enter('604075697947552793');" onmouseout="out('604075697947552793');" style=""> 759         return favorite.container == Favorites.CONTAINER_HOTSEAT                                         </span>
<span class="6256768192304850763" onmouseenter="enter('6256768192304850763');" onmouseout="out('6256768192304850763');" style=""> 760                 &amp;&amp; favorite.intent != null                                                               </span>
<span class="-434659868641842414" onmouseenter="enter('-434659868641842414');" onmouseout="out('-434659868641842414');" style=""> 761                 &amp;&amp; (favorite.itemType == Favorites.ITEM_TYPE_APPLICATION                                 </span>
<span class="5423532842312973304" onmouseenter="enter('5423532842312973304');" onmouseout="out('5423532842312973304');" style=""> 762                 || favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763     }                                                                                                    </span>
<span  style=""> 764                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 765     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 766     private Favorite packFavorite(Cursor c) {                                                            </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 767         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 768         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 769         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 770         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 771         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 772         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 773         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 774         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 775         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span  style=""> 776                                                                                                          </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 777         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 778         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 779             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 781         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style=""> 782         Intent intent = null;                                                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 783         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 784             try {                                                                                        </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style=""> 785                 intent = Intent.parseUri(intentDescription, 0);                                          </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 786                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 787                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 788             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 789                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 791         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 792         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 793         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 794             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 795             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 796             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 797                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798             }                                                                                            </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style=""> 799         } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                  </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 800             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 801                 String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                    </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 802                 if (!TextUtils.isEmpty(iconPackage)) {                                                   </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 803                     favorite.iconPackage = iconPackage;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804                 }                                                                                        </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 805                 String iconResource = c.getString(ICON_RESOURCE_INDEX);                                  </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 806                 if (!TextUtils.isEmpty(iconResource)) {                                                  </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 807                     favorite.iconResource = iconResource;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 808                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809             }                                                                                            </span>
<span  style=""> 810                                                                                                          </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 811             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 812             if (blob != null &amp;&amp; blob.length &gt; 0) {                                                       </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 813                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 815         }                                                                                                </span>
<span  style=""> 816                                                                                                          </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style=""> 817         if (isReplaceableHotseatItem(favorite)) {                                                        </span>
<span class="1125417031607979515" onmouseenter="enter('1125417031607979515');" onmouseout="out('1125417031607979515');" style=""> 818             if (intent != null &amp;&amp; intent.getComponent() != null) {                                       </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style=""> 819                 PackageManager pm = mContext.getPackageManager();                                        </span>
<span class="1376604666851387224" onmouseenter="enter('1376604666851387224');" onmouseout="out('1376604666851387224');" style=""> 820                 ActivityInfo activity = null;;                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 821                 try {                                                                                    </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style=""> 822                     activity = pm.getActivityInfo(intent.getComponent(), 0);                             </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 823                 } catch (NameNotFoundException e) {                                                      </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style=""> 824                     Log.e(TAG, &quot;Target not found&quot;, e);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825                 }                                                                                        </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style=""> 826                 if (activity == null) {                                                                  </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 827                     return favorite;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828                 }                                                                                        </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style=""> 829                 for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                     </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style=""> 830                     if (mItemTypeMatchers[i] == null) {                                                  </span>
<span class="2340950037759851004" onmouseenter="enter('2340950037759851004');" onmouseout="out('2340950037759851004');" style=""> 831                         mItemTypeMatchers[i] = new ItemTypeMatcher(                                      </span>
<span class="8145000845780688523" onmouseenter="enter('8145000845780688523');" onmouseout="out('8145000845780688523');" style=""> 832                                 CommonAppTypeParser.getResourceForItemType(i));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833                     }                                                                                    </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style=""> 834                     if (mItemTypeMatchers[i].matches(activity, pm)) {                                    </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style=""> 835                         favorite.targetType = i;                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 836                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840         }                                                                                                </span>
<span  style=""> 841                                                                                                          </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 842         return favorite;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843     }                                                                                                    </span>
<span  style=""> 844                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 845     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-5576008980985724481" onmouseenter="enter('-5576008980985724481');" onmouseout="out('-5576008980985724481');" style=""> 846     private ContentValues unpackFavorite(byte[] buffer, int dataSize)                                    </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 847             throws IOException {                                                                         </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 848         Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                               </span>
<span  style=""> 849                                                                                                          </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 850         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 851         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 852         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 853         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 854         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 855         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 856         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 857         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span  style=""> 858                                                                                                          </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style=""> 859         if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                         </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 860             values.put(Favorites.ICON_TYPE, favorite.iconType);                                          </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 861             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 862                 values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 863                 values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864             }                                                                                            </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 865             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866         }                                                                                                </span>
<span  style=""> 867                                                                                                          </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 868         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 869             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 870         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 871             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 873         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 874             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 875         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 876         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span  style=""> 877                                                                                                          </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 878         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style=""> 879         long userSerialNumber =                                                                          </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style=""> 880                 UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);            </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 881         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span  style=""> 882                                                                                                          </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 883         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span  style=""> 884                                                                                                          </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 885         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 886             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 887                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 889             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 890             values.put(LauncherSettings.Favorites.RESTORED,                                              </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style=""> 891                     LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                            </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style=""> 892                     LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                      </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style=""> 893                     LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                            </span>
<span  style=""> 894                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 895             // Verify placement                                                                          </span>
<span class="-7553882590673737344" onmouseenter="enter('-7553882590673737344');" onmouseout="out('-7553882590673737344');" style=""> 896             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols)                         </span>
<span class="1436175124930418764" onmouseenter="enter('1436175124930418764');" onmouseout="out('1436175124930418764');" style=""> 897                     || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {               </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 898                 restoreSuccessful = false;                                                               </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style=""> 899                 throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 901         } else {                                                                                         </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style=""> 902             // Check if it is an hotseat item, that can be replaced.                                     </span>
<span class="5088947528875964657" onmouseenter="enter('5088947528875964657');" onmouseout="out('5088947528875964657');" style=""> 903             if (isReplaceableHotseatItem(favorite)                                                       </span>
<span class="-3804650287411139588" onmouseenter="enter('-3804650287411139588');" onmouseout="out('-3804650287411139588');" style=""> 904                     &amp;&amp; favorite.targetType != Favorite.TARGET_NONE                                       </span>
<span class="3747219331600099018" onmouseenter="enter('3747219331600099018');" onmouseout="out('3747219331600099018');" style=""> 905                     &amp;&amp; favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT) {                 </span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style=""> 906                 Log.e(TAG, &quot;Added item type flag&quot;);                                                      </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 907                 values.put(LauncherSettings.Favorites.RESTORED,                                          </span>
<span class="-5769863763985510613" onmouseenter="enter('-5769863763985510613');" onmouseout="out('-5769863763985510613');" style=""> 908                         1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 909             } else {                                                                                     </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 910                 // Let LauncherModel know we&#x27;ve been here.                                               </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 911                 values.put(LauncherSettings.Favorites.RESTORED, 1);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912             }                                                                                            </span>
<span  style=""> 913                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 914             // Verify placement                                                                          </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 915             if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                     </span>
<span class="3850618212667286309" onmouseenter="enter('3850618212667286309');" onmouseout="out('3850618212667286309');" style=""> 916                 if ((favorite.screen &gt;= currentProfile.hotseatCount)                                     </span>
<span class="-2927406358945708190" onmouseenter="enter('-2927406358945708190');" onmouseout="out('-2927406358945708190');" style=""> 917                         || (favorite.screen == currentProfile.allappsRank)) {                            </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 918                     restoreSuccessful = false;                                                           </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style=""> 919                     throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 920                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 921             } else {                                                                                     </span>
<span class="4635538835318305805" onmouseenter="enter('4635538835318305805');" onmouseout="out('4635538835318305805');" style=""> 922                 if ((favorite.cellX &gt;= currentProfile.desktopCols)                                       </span>
<span class="-3183516951997115573" onmouseenter="enter('-3183516951997115573');" onmouseout="out('-3183516951997115573');" style=""> 923                         || (favorite.cellY &gt;= currentProfile.desktopRows)) {                             </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 924                     restoreSuccessful = false;                                                           </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style=""> 925                     throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 927             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 928         }                                                                                                </span>
<span  style=""> 929                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 930         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 933     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style=""> 934     private Screen packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 935         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 936         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 937         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style=""> 938         return screen;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939     }                                                                                                    </span>
<span  style=""> 940                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 941     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style=""> 942     private ContentValues unpackScreen(byte[] buffer, int dataSize)                                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 943             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style=""> 944         Screen screen = unpackProto(new Screen(), buffer, dataSize);                                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 945         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 946         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 947         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 948         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 949     }                                                                                                    </span>
<span  style=""> 950                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 951     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style=""> 952     private Resource packIcon(int dpi, Bitmap icon) {                                                    </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 953         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 954         res.dpi = dpi;                                                                                   </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style=""> 955         res.data = Utilities.flattenBitmap(icon);                                                        </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 956         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 957     }                                                                                                    </span>
<span  style=""> 958                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 959     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style=""> 960     private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                  </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style=""> 961         final LauncherAppWidgetProviderInfo info =                                                       </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style=""> 962                 LauncherModel.getProviderInfo(mContext, provider, user);                                 </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 963         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 964         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 965         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 966         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 967         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 968             widget.icon = new Resource();                                                                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style=""> 969             Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);      </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 970             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style=""> 971             widget.icon.data = Utilities.flattenBitmap(icon);                                            </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 972             widget.icon.dpi = dpi;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 973         }                                                                                                </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 974 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 975                                                                                                          </span>
<span class="8268283353319641350" onmouseenter="enter('8268283353319641350');" onmouseout="out('8268283353319641350');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 976         // Calculate the spans corresponding to any one of the orientations as it should not change      </span>
<span class="-4559634212567806776" onmouseenter="enter('-4559634212567806776');" onmouseout="out('-4559634212567806776');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 977         // based on orientation.                                                                         </span>
<span class="7159740594026618763" onmouseenter="enter('7159740594026618763');" onmouseout="out('7159740594026618763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 978         int[] minSpans = CellLayout.rectToCell(                                                          </span>
<span class="-6534356822831926041" onmouseenter="enter('-6534356822831926041');" onmouseout="out('-6534356822831926041');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 979                 mIdp.portraitProfile, mContext, info.minResizeWidth, info.minResizeHeight, null);        </span>
<span class="414947938502206869" onmouseenter="enter('414947938502206869');" onmouseout="out('414947938502206869');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 980         widget.minSpanX = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0       </span>
<span class="3309711297405339686" onmouseenter="enter('3309711297405339686');" onmouseout="out('3309711297405339686');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 981                 ? minSpans[0] : -1;                                                                      </span>
<span class="6449476295053203863" onmouseenter="enter('6449476295053203863');" onmouseout="out('6449476295053203863');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 982         widget.minSpanY = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0         </span>
<span class="8978476183120858231" onmouseenter="enter('8978476183120858231');" onmouseout="out('8978476183120858231');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 983                 ? minSpans[1] : -1;                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 984                                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 985 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 986             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 987         }                                                                                                </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 988         if (info.previewImage != 0) {                                                                    </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 989             widget.preview = new Resource();                                                             </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 990             Bitmap preview = previewLoader.generateWidgetPreview(info, null);                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 991             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 992             if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                         </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 993                 widget.preview.data = os.toByteArray();                                                  </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 994                 widget.preview.dpi = dpi;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 995             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 996         }                                                                                                </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 997         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 998     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 999                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1000     /**                                                                                                  </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1001      * Deserialize a proto after verifying checksum wrapper.                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1002      */                                                                                                  </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1003     private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1004             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1005         MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1006         if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1007         return proto;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1008     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1009                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1010     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1011      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1012      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1013      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1014      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1015      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1016      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1017      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1018      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1019     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1020         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1021         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1022             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1023         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1024         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1025         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1026             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1027             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1028             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1029                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1030                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1031                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1032                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1033                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1034                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1035                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">1036 =======                                                                                                  </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1037         if (info.previewImage != 0) {                                                                    </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1038             widget.preview = new Resource();                                                             </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1039             Bitmap preview = previewLoader.generateWidgetPreview(info, null);                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1040             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1041             if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                         </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1042                 widget.preview.data = os.toByteArray();                                                  </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1043                 widget.preview.dpi = dpi;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1044             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1045         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1046                                                                                                          </span>
<span class="414947938502206869" onmouseenter="enter('414947938502206869');" onmouseout="out('414947938502206869');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1047         widget.minSpanX = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0       </span>
<span class="-9163706737572277729" onmouseenter="enter('-9163706737572277729');" onmouseout="out('-9163706737572277729');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1048                 ? info.minSpanX : -1;                                                                    </span>
<span class="6449476295053203863" onmouseenter="enter('6449476295053203863');" onmouseout="out('6449476295053203863');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1049         widget.minSpanY = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0         </span>
<span class="1621633565087981805" onmouseenter="enter('1621633565087981805');" onmouseout="out('1621633565087981805');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1050                 ? info.minSpanY : -1;                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">1051 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1052         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1053     }                                                                                                    </span>
<span  style="">1054                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1055     /**                                                                                                  </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="">1056      * Deserialize a proto after verifying checksum wrapper.                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1057      */                                                                                                  </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="">1058     private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1059             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="">1060         MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="">1061         if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="">1062         return proto;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1063     }                                                                                                    </span>
<span  style="">1064                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1065     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1066      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1067      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1068      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1069      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1070      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1071      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1072      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1073      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1074     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1075         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1076         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1077             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1078         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1079         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1080         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1081             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1082             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1083             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1084                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1085                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1086                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1087                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1088                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1089                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1090                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1091                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1092                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1093                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1094                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1095                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1096                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1097                             bytesRead += result;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1098                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1099                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1100                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1101                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1103                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1104                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1105                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1106                     }                                                                                    </span>
<span  style="">1107                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1108                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1109                     try {                                                                                </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1110                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));             </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1111                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1112                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1113                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1114                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1115                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1116                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1117                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1118                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1119                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1120                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1121                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1122                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1123                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1124                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1125             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1126         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1127             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1128         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1129             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1130                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1131             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1132                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1133             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1134         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1135         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1136     }                                                                                                    </span>
<span  style="">1137                                                                                                          </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1138     private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                     </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1139             throws IOException {                                                                         </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1140         writeRowToBackup(keyToBackupKey(key), proto, data);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1141     }                                                                                                    </span>
<span  style="">1142                                                                                                          </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1143     private void writeRowToBackup(String backupKey, MessageNano proto,                                   </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1144             BackupDataOutput data) throws IOException {                                                  </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1145         byte[] blob = writeCheckedBytes(proto);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1146         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1147         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1148         mBackupDataWasUpdated = true;                                                                    </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1149         if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1150     }                                                                                                    </span>
<span  style="">1151                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1152     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1153      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1154      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1155      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1156      * in that case, do a full backup.                                                                   </span>
<span  style="">1157                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1158      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1159      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1160      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1161     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1162         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1163         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1164             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1165             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1166             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1167             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1168             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1169         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1170             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1171         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1172     }                                                                                                    </span>
<span  style="">1173                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1174     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1175     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1176         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1177         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1178         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1179         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1180         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1181         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1182     }                                                                                                    </span>
<span  style="">1183                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1184     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1185     private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1186             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1187         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1188         MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                             </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1189         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1190         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1191         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1192             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1193         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1194         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1195     }                                                                                                    </span>
<span  style="">1196                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1197     /**                                                                                                  </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1198      * @return true if the launcher is in a state to support backup                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1199      */                                                                                                  </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1200     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1201         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1202         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1203         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1204             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1205             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1207         cursor.close();                                                                                  </span>
<span  style="">1208                                                                                                          </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="">1209         if (LauncherAppState.getInstanceNoCreate() == null) {                                            </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1210             // launcher services are unavailable, try again later                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1211             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1212         }                                                                                                </span>
<span  style="">1213                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1214         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1215     }                                                                                                    </span>
<span  style="">1216                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1217     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1218         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1219                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1220     }                                                                                                    </span>
<span  style="">1221                                                                                                          </span>
<span class="-5176517881040090425" onmouseenter="enter('-5176517881040090425');" onmouseout="out('-5176517881040090425');" style="">1222     @Thunk class InvalidBackupException extends IOException {                                            </span>
<span  style="">1223                                                                                                          </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="">1224         private static final long serialVersionUID = 8931456637211665082L;                               </span>
<span  style="">1225                                                                                                          </span>
<span class="5112209169585560371" onmouseenter="enter('5112209169585560371');" onmouseout="out('5112209169585560371');" style="">1226         @Thunk InvalidBackupException(Throwable cause) {                                                 </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1227             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1228         }                                                                                                </span>
<span  style="">1229                                                                                                          </span>
<span class="5097977583346831854" onmouseenter="enter('5097977583346831854');" onmouseout="out('5097977583346831854');" style="">1230         @Thunk InvalidBackupException(String reason) {                                                   </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1231             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1232         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1233     }                                                                                                    </span>
<span  style="">1234                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1235     /**                                                                                                  </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="">1236      * A class to check if an activity can handle one of the intents from a list of                      </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="">1237      * predefined intents.                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1238      */                                                                                                  </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="">1239     private class ItemTypeMatcher {                                                                      </span>
<span  style="">1240                                                                                                          </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="">1241         private final ArrayList&lt;Intent&gt; mIntents;                                                        </span>
<span  style="">1242                                                                                                          </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="">1243         ItemTypeMatcher(int xml_res) {                                                                   </span>
<span class="-2300579919401902073" onmouseenter="enter('-2300579919401902073');" onmouseout="out('-2300579919401902073');" style="">1244             mIntents = xml_res == 0 ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1245         }                                                                                                </span>
<span  style="">1246                                                                                                          </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="">1247         private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                            </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="">1248             ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                         </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="">1249             XmlResourceParser parser = mContext.getResources().getXml(xml_res);                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1250             try {                                                                                        </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="">1251                 DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);              </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="">1252                 final int depth = parser.getDepth();                                                     </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="">1253                 int type;                                                                                </span>
<span class="-1784597901533800040" onmouseenter="enter('-1784597901533800040');" onmouseout="out('-1784597901533800040');" style="">1254                 while (((type = parser.next()) != XmlPullParser.END_TAG ||                               </span>
<span class="9136127903140816012" onmouseenter="enter('9136127903140816012');" onmouseout="out('9136127903140816012');" style="">1255                         parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) {              </span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="">1256                     if (type != XmlPullParser.START_TAG) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="">1257                         continue;                                                                        </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="">1258                     } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {              </span>
<span class="-6398792714141510192" onmouseenter="enter('-6398792714141510192');" onmouseout="out('-6398792714141510192');" style="">1259                         final String uri = DefaultLayoutParser.getAttributeValue(                        </span>
<span class="-7436101632763202971" onmouseenter="enter('-7436101632763202971');" onmouseout="out('-7436101632763202971');" style="">1260                                 parser, DefaultLayoutParser.ATTR_URI);                                   </span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="">1261                         intents.add(Intent.parseUri(uri, 0));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1262                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1263                 }                                                                                        </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="">1264             } catch (URISyntaxException | XmlPullParserException | IOException e) {                      </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="">1265                 Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1266             } finally {                                                                                  </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="">1267                 parser.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1268             }                                                                                            </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="">1269             return intents;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1270         }                                                                                                </span>
<span  style="">1271                                                                                                          </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="">1272         public boolean matches(ActivityInfo activity, PackageManager pm) {                               </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="">1273             for (Intent intent : mIntents) {                                                             </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="">1274                 intent.setPackage(activity.packageName);                                                 </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="">1275                 ResolveInfo info = pm.resolveActivity(intent, 0);                                        </span>
<span class="2104528236737597253" onmouseenter="enter('2104528236737597253');" onmouseout="out('2104528236737597253');" style="">1276                 if (info != null &amp;&amp; (info.activityInfo.name.equals(activity.name)                        </span>
<span class="1520043710369759480" onmouseenter="enter('1520043710369759480');" onmouseout="out('1520043710369759480');" style="">1277                         || info.activityInfo.name.equals(activity.targetActivity))) {                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1278                     return true;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1279                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1280             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1281             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1282         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1283     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1284 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21 import android.app.backup.BackupManager;                                                                 </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  22 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  23 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  24 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  25 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  26 import android.content.Intent;                                                                           </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="">  27 import android.content.pm.ActivityInfo;                                                                  </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  28 import android.content.pm.PackageManager;                                                                </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  29 import android.content.pm.PackageManager.NameNotFoundException;                                          </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">  30 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="">  31 import android.content.res.XmlResourceParser;                                                            </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  32 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  33 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  34 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  35 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  36 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  37 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  38 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  39 import android.util.Log;                                                                                 </span>
<span  style="">  40                                                                                                          </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  41 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  42 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  43 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  44 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  45 import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                       </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  46 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  47 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  48 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  49 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  50 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  51 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  52 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  53 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="">  54 import com.android.launcher3.util.Thunk;                                                                 </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  55 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  56 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span  style="">  57                                                                                                          </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="">  58 import org.xmlpull.v1.XmlPullParser;                                                                     </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="">  59 import org.xmlpull.v1.XmlPullParserException;                                                            </span>
<span  style="">  60                                                                                                          </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  61 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  62 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  63 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  64 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  65 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  66 import java.util.Arrays;                                                                                 </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  67 import java.util.HashSet;                                                                                </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  68 import java.util.zip.CRC32;                                                                              </span>
<span  style="">  69                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  70 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  71  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  72  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  73 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  74     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  75     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  76     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span  style="">  77                                                                                                          </span>
<span class="-984243926892874638" onmouseenter="enter('-984243926892874638');" onmouseout="out('-984243926892874638');" style="">  78     private static final int BACKUP_VERSION = 3;                                                         </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  79     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  80                                                                                                          </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  81     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  82     // key (any Base64 encoded string).                                                                  </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  83     private static final String JOURNAL_KEY = &quot;#&quot;;                                                       </span>
<span  style="">  84                                                                                                          </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  85     /** icons are large, dribble them out */                                                             </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  86     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  87                                                                                                          </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  88     /** widgets contain previews, which are very large, dribble them out */                              </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  89     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  90                                                                                                          </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  91     private static final String[] FAVORITE_PROJECTION = {                                                </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  92         Favorites._ID,                     // 0                                                          </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  93         Favorites.MODIFIED,                // 1                                                          </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  94         Favorites.INTENT,                  // 2                                                          </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  95         Favorites.APPWIDGET_PROVIDER,      // 3                                                          </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style="">  96         Favorites.APPWIDGET_ID,            // 4                                                          </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style="">  97         Favorites.CELLX,                   // 5                                                          </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style="">  98         Favorites.CELLY,                   // 6                                                          </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style="">  99         Favorites.CONTAINER,               // 7                                                          </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 100         Favorites.ICON,                    // 8                                                          </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 101         Favorites.ICON_PACKAGE,            // 9                                                          </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 102         Favorites.ICON_RESOURCE,           // 10                                                         </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 103         Favorites.ICON_TYPE,               // 11                                                         </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 104         Favorites.ITEM_TYPE,               // 12                                                         </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 105         Favorites.SCREEN,                  // 13                                                         </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 106         Favorites.SPANX,                   // 14                                                         </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 107         Favorites.SPANY,                   // 15                                                         </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 108         Favorites.TITLE,                   // 16                                                         </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 109         Favorites.PROFILE_ID,              // 17                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 110     };                                                                                                   </span>
<span  style=""> 111                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 112     private static final int ID_INDEX = 0;                                                               </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 113     private static final int ID_MODIFIED = 1;                                                            </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 114     private static final int INTENT_INDEX = 2;                                                           </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 115     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 116     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 117     private static final int CELLX_INDEX = 5;                                                            </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 118     private static final int CELLY_INDEX = 6;                                                            </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 119     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 120     private static final int ICON_INDEX = 8;                                                             </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 121     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 122     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 123     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 124     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 125     private static final int SCREEN_INDEX = 13;                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 126     private static final int SPANX_INDEX = 14;                                                           </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 127     private static final int SPANY_INDEX = 15;                                                           </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 128     private static final int TITLE_INDEX = 16;                                                           </span>
<span  style=""> 129                                                                                                          </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 130     private static final String[] SCREEN_PROJECTION = {                                                  </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 131         WorkspaceScreens._ID,              // 0                                                          </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 132         WorkspaceScreens.MODIFIED,         // 1                                                          </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 133         WorkspaceScreens.SCREEN_RANK       // 2                                                          </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 134     };                                                                                                   </span>
<span  style=""> 135                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 136     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 137                                                                                                          </span>
<span class="7768295683460392373" onmouseenter="enter('7768295683460392373');" onmouseout="out('7768295683460392373');" style=""> 138     @Thunk final Context mContext;                                                                       </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 139     private final HashSet&lt;String&gt; mExistingKeys;                                                         </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 140     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style=""> 141     private final ItemTypeMatcher[] mItemTypeMatchers;                                                   </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style=""> 142     private final long mUserSerial;                                                                      </span>
<span  style=""> 143                                                                                                          </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style=""> 144     private IconCache mIconCache;                                                                        </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style=""> 145     private DeviceProfieData mDeviceProfileData;                                                         </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style=""> 146     private InvariantDeviceProfile mIdp;                                                                 </span>
<span  style=""> 147                                                                                                          </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 148     private BackupManager mBackupManager;                                                                </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 149     private byte[] mBuffer = new byte[512];                                                              </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 150     private long mLastBackupRestoreTime;                                                                 </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 151     private boolean mBackupDataWasUpdated;                                                               </span>
<span  style=""> 152                                                                                                          </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 153     boolean restoreSuccessful;                                                                           </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 154     int restoredBackupVersion = 1;                                                                       </span>
<span  style=""> 155                                                                                                          </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 156     public LauncherBackupHelper(Context context) {                                                       </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 157         mContext = context;                                                                              </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 158         mExistingKeys = new HashSet&lt;String&gt;();                                                           </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 159         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 160         restoreSuccessful = true;                                                                        </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style=""> 161         mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];               </span>
<span  style=""> 162                                                                                                          </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style=""> 163         UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                         </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style=""> 164         mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165     }                                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 167     private void dataChanged() {                                                                         </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 168         if (mBackupManager == null) {                                                                    </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 169             mBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170         }                                                                                                </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 171         mBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172     }                                                                                                    </span>
<span  style=""> 173                                                                                                          </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 174     private void applyJournal(Journal journal) {                                                         </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 175         mLastBackupRestoreTime = journal.t;                                                              </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 176         mExistingKeys.clear();                                                                           </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 177         if (journal.key != null) {                                                                       </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 178             for (Key key : journal.key) {                                                                </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 179                 mExistingKeys.add(keyToBackupKey(key));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style=""> 182         restoredBackupVersion = journal.backupVersion;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 185     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 186      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 187      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 188      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 189      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 190      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 191      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 192      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 193      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 194      * @param newState notes for the next backup                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 195      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 196     @Override                                                                                            </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 197     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                      </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 198             ParcelFileDescriptor newState) {                                                             </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 199         if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                             </span>
<span  style=""> 200                                                                                                          </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 201         Journal in = readJournal(oldState);                                                              </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 202         if (!launcherIsReady()) {                                                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 203             dataChanged();                                                                               </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 204             // Perform backup later.                                                                     </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 205             writeJournal(newState, in);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 206             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207         }                                                                                                </span>
<span  style=""> 208                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 209         if (mDeviceProfileData == null) {                                                                </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 210             LauncherAppState app = LauncherAppState.getInstance();                                       </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style=""> 211             mIdp = app.getInvariantDeviceProfile();                                                      </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 212             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 213             mIconCache = app.getIconCache();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span  style=""> 215                                                                                                          </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 216         Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                          </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 217         mKeys.clear();                                                                                   </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 218         applyJournal(in);                                                                                </span>
<span  style=""> 219                                                                                                          </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 220         // Record the time before performing backup so that entries edited while the backup              </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 221         // was going on, do not get missed in next backup.                                               </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 222         long newBackupTime = System.currentTimeMillis();                                                 </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 223         mBackupDataWasUpdated = false;                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 224         try {                                                                                            </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 225             backupFavorites(data);                                                                       </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 226             backupScreens(data);                                                                         </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 227             backupIcons(data);                                                                           </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 228             backupWidgets(data);                                                                         </span>
<span  style=""> 229                                                                                                          </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 230             // Delete any key which still exist in the old backup, but is not valid anymore.             </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 231             HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                           </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 232             for (Key key : mKeys) {                                                                      </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 233                 validKeys.add(keyToBackupKey(key));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234             }                                                                                            </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 235             mExistingKeys.removeAll(validKeys);                                                          </span>
<span  style=""> 236                                                                                                          </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 237             // Delete anything left in the existing keys.                                                </span>
<span class="-8057776950468218811" onmouseenter="enter('-8057776950468218811');" onmouseout="out('-8057776950468218811');" style=""> 238             for (String deleted: mExistingKeys) {                                                        </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style=""> 239                 if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                             </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 240                 data.writeEntityHeader(deleted, -1);                                                     </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 241                 mBackupDataWasUpdated = true;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242             }                                                                                            </span>
<span  style=""> 243                                                                                                          </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 244             mExistingKeys.clear();                                                                       </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 245             if (!mBackupDataWasUpdated) {                                                                </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 246                 // Check if any metadata has changed                                                     </span>
<span class="4456255566361909194" onmouseenter="enter('4456255566361909194');" onmouseout="out('4456255566361909194');" style=""> 247                 mBackupDataWasUpdated = (in.profile == null)                                             </span>
<span class="3696867724938300008" onmouseenter="enter('3696867724938300008');" onmouseout="out('3696867724938300008');" style=""> 248                         || !Arrays.equals(DeviceProfieData.toByteArray(in.profile),                      </span>
<span class="-526865330972865914" onmouseenter="enter('-526865330972865914');" onmouseout="out('-526865330972865914');" style=""> 249                             DeviceProfieData.toByteArray(mDeviceProfileData))                            </span>
<span class="-3212861652554024645" onmouseenter="enter('-3212861652554024645');" onmouseout="out('-3212861652554024645');" style=""> 250                         || (in.backupVersion != BACKUP_VERSION)                                          </span>
<span class="3693115347738857050" onmouseenter="enter('3693115347738857050');" onmouseout="out('3693115347738857050');" style=""> 251                         || (in.appVersion != getAppVersion());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252             }                                                                                            </span>
<span  style=""> 253                                                                                                          </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 254             if (mBackupDataWasUpdated) {                                                                 </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 255                 mLastBackupRestoreTime = newBackupTime;                                                  </span>
<span  style=""> 256                                                                                                          </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 257                 // We store the journal at two places.                                                   </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style=""> 258                 //   1) Storing it in newState allows us to do partial backups by comparing old state    </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style=""> 259                 //   2) Storing it in backup data allows us to validate keys during restore              </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 260                 Journal state = getCurrentStateJournal();                                                </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 261                 writeRowToBackup(JOURNAL_KEY, state, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 262             } else {                                                                                     </span>
<span class="6846529623619819273" onmouseenter="enter('6846529623619819273');" onmouseout="out('6846529623619819273');" style=""> 263                 if (DEBUG) Log.d(TAG, &quot;Nothing was written during backup&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 265         } catch (IOException e) {                                                                        </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 266             Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267         }                                                                                                </span>
<span  style=""> 268                                                                                                          </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 269         writeNewStateDescription(newState);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270     }                                                                                                    </span>
<span  style=""> 271                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 272     /**                                                                                                  </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 273      * @return true if the backup corresponding to oldstate can be successfully applied                  </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 274      * to this device.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 275      */                                                                                                  </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 276     private boolean isBackupCompatible(Journal oldState) {                                               </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 277         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 278         DeviceProfieData oldProfile = oldState.profile;                                                  </span>
<span  style=""> 279                                                                                                          </span>
<span class="3516483988150785854" onmouseenter="enter('3516483988150785854');" onmouseout="out('3516483988150785854');" style=""> 280         if (oldProfile == null || oldProfile.desktopCols == 0) {                                         </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 281             // Profile info is not valid, ignore the check.                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 282             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283         }                                                                                                </span>
<span  style=""> 284                                                                                                          </span>
<span class="-3969248474555793010" onmouseenter="enter('-3969248474555793010');" onmouseout="out('-3969248474555793010');" style=""> 285         boolean isHotsetCompatible = false;                                                              </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 286         if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                     </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 287             isHotsetCompatible = true;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span class="-5234148737954946799" onmouseenter="enter('-5234148737954946799');" onmouseout="out('-5234148737954946799');" style=""> 289         if ((currentProfile.hotseatCount &gt;= oldProfile.hotseatCount) &amp;&amp;                                  </span>
<span class="-4785593469925988823" onmouseenter="enter('-4785593469925988823');" onmouseout="out('-4785593469925988823');" style=""> 290                 (currentProfile.allappsRank == oldProfile.allappsRank)) {                                </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 291             isHotsetCompatible = true;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292         }                                                                                                </span>
<span  style=""> 293                                                                                                          </span>
<span class="-6996782978604961637" onmouseenter="enter('-6996782978604961637');" onmouseout="out('-6996782978604961637');" style=""> 294         return isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)              </span>
<span class="4824114787736852304" onmouseenter="enter('4824114787736852304');" onmouseout="out('4824114787736852304');" style=""> 295                 &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296     }                                                                                                    </span>
<span  style=""> 297                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 298     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 299      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 300      * It assumes that the keys will arrive in lexical order. So if the journal was present in the       </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 301      * backup, it should arrive first.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 302      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 303      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 304      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 305     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 306     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 307         if (!restoreSuccessful) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 308             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309         }                                                                                                </span>
<span  style=""> 310                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 311         if (mDeviceProfileData == null) {                                                                </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style=""> 312             // This call does not happen on a looper thread. So LauncherAppState                         </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style=""> 313             // can&#x27;t be created . Instead initialize required dependencies directly.                     </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style=""> 314             mIdp = new InvariantDeviceProfile(mContext);                                                 </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 315             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style=""> 316             mIconCache = new IconCache(mContext, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span  style=""> 318                                                                                                          </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 319         int dataSize = data.size();                                                                      </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 320         if (mBuffer.length &lt; dataSize) {                                                                 </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 321             mBuffer = new byte[dataSize];                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 323         try {                                                                                            </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 324             int bytesRead = data.read(mBuffer, 0, dataSize);                                             </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 325             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);               </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 326             String backupKey = data.getKey();                                                            </span>
<span  style=""> 327                                                                                                          </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 328             if (JOURNAL_KEY.equals(backupKey)) {                                                         </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 329                 if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                       </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 330                 if (!mKeys.isEmpty()) {                                                                  </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 331                     // We received the journal key after a restore key.                                  </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 332                     Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);       </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 333                     restoreSuccessful = false;                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 334                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335                 }                                                                                        </span>
<span  style=""> 336                                                                                                          </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 337                 Journal journal = new Journal();                                                         </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 338                 MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                     </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 339                 applyJournal(journal);                                                                   </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 340                 restoreSuccessful = isBackupCompatible(journal);                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 341                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342             }                                                                                            </span>
<span  style=""> 343                                                                                                          </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 344             if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                        </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 345                 if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 346                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347             }                                                                                            </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 348             Key key = backupKeyToKey(backupKey);                                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 349             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 350             switch (key.type) {                                                                          </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 351                 case Key.FAVORITE:                                                                       </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 352                     restoreFavorite(key, mBuffer, dataSize);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 353                     break;                                                                               </span>
<span  style=""> 354                                                                                                          </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 355                 case Key.SCREEN:                                                                         </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 356                     restoreScreen(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 357                     break;                                                                               </span>
<span  style=""> 358                                                                                                          </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 359                 case Key.ICON:                                                                           </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 360                     restoreIcon(key, mBuffer, dataSize);                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 361                     break;                                                                               </span>
<span  style=""> 362                                                                                                          </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 363                 case Key.WIDGET:                                                                         </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 364                     restoreWidget(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 365                     break;                                                                               </span>
<span  style=""> 366                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 367                 default:                                                                                 </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 368                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 369                     mKeys.remove(key);                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 370                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 372         } catch (IOException e) {                                                                        </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 373             Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375     }                                                                                                    </span>
<span  style=""> 376                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 377     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 378      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 379      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 380      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 381      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 382     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 383     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 384         writeJournal(newState, getCurrentStateJournal());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385     }                                                                                                    </span>
<span  style=""> 386                                                                                                          </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 387     private Journal getCurrentStateJournal() {                                                           </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 388         Journal journal = new Journal();                                                                 </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 389         journal.t = mLastBackupRestoreTime;                                                              </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 390         journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                 </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 391         journal.appVersion = getAppVersion();                                                            </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 392         journal.backupVersion = BACKUP_VERSION;                                                          </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style=""> 393         journal.profile = mDeviceProfileData;                                                            </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 394         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395     }                                                                                                    </span>
<span  style=""> 396                                                                                                          </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 397     private int getAppVersion() {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 398         try {                                                                                            </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 399             return mContext.getPackageManager()                                                          </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 400                     .getPackageInfo(mContext.getPackageName(), 0).versionCode;                           </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 401         } catch (NameNotFoundException e) {                                                              </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 402             return 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404     }                                                                                                    </span>
<span  style=""> 405                                                                                                          </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style=""> 406     private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                     </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style=""> 407         DeviceProfieData data = new DeviceProfieData();                                                  </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style=""> 408         data.desktopRows = profile.numRows;                                                              </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style=""> 409         data.desktopCols = profile.numColumns;                                                           </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style=""> 410         data.hotseatCount = profile.numHotseatIcons;                                                     </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style=""> 411         data.allappsRank = profile.hotseatAllAppsRank;                                                   </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style=""> 412         return data;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413     }                                                                                                    </span>
<span  style=""> 414                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 415     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 416      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 417      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 418      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 419      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 420      */                                                                                                  </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 421     private void backupFavorites(BackupDataOutput data) throws IOException {                             </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 422         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 423         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 424         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 425         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 426                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 427         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 428             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 429             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 430                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 431                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 432                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 433                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 434                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 435                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 436                     writeRowToBackup(key, packFavorite(cursor), data);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 437                 } else {                                                                                 </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 438                     if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 441         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 442             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444     }                                                                                                    </span>
<span  style=""> 445                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 446     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 447      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 448      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 449      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 450      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 451      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 452      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 453      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 454      */                                                                                                  </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 455     private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {              </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 456         if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                         </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 457         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 458                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 459                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 460         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 461         ContentValues values = unpackFavorite(buffer, dataSize);                                         </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style=""> 462         cr.insert(Favorites.CONTENT_URI, values);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463     }                                                                                                    </span>
<span  style=""> 464                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 465     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 466      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 467      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 468      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 469      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 470      */                                                                                                  </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 471     private void backupScreens(BackupDataOutput data) throws IOException {                               </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 472         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 473         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 474         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 475                 null, null, null);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 476         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 477             cursor.moveToPosition(-1);                                                                   </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 478             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 479             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 480                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 481                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 482                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 483                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 484                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 485                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 486                     writeRowToBackup(key, packScreen(cursor), data);                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 487                 } else {                                                                                 </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 488                     if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 491         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 492             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494     }                                                                                                    </span>
<span  style=""> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 496     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 497      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 498      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 499      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 500      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 501      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 502      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 503      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 504      */                                                                                                  </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 505     private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 506         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 507         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 508                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 509                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 510         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 511         ContentValues values = unpackScreen(buffer, dataSize);                                           </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 512         cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513     }                                                                                                    </span>
<span  style=""> 514                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 515     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 516      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 517      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 518      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 519      * @param data output stream for key/value pairs                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 520      */                                                                                                  </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 521     private void backupIcons(BackupDataOutput data) throws IOException {                                 </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 522         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 523         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 524         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 525         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 526         int backupUpIconCount = 0;                                                                       </span>
<span  style=""> 527                                                                                                          </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 528         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 529         String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +      </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 530                 Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                    </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 531                 getUserSelectionArg();                                                                   </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 532         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 533                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 534         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 535             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 536             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 537                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 538                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 539                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 540                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 541                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 542                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 543                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 544                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 545                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 546                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 547                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 548                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                     }                                                                                    </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 550                     if (mExistingKeys.contains(backupKey)) {                                             </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 551                         if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                        </span>
<span  style=""> 552                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 553                         // remember that we already backed this up previously                            </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 554                         mKeys.add(key);                                                                  </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 555                     } else if (backupKey != null) {                                                      </span>
<span class="-6310531343064499436" onmouseenter="enter('-6310531343064499436');" onmouseout="out('-6310531343064499436');" style=""> 556                         if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);            </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 557                         if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                    </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 558                             if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                           </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 559                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 560                             if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {         </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 561                                 writeRowToBackup(key, packIcon(dpi, icon), data);                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 562                                 mKeys.add(key);                                                          </span>
<span class="5377719919294214367" onmouseenter="enter('5377719919294214367');" onmouseout="out('5377719919294214367');" style=""> 563                                 backupUpIconCount ++;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 565                         } else {                                                                         </span>
<span class="4246955911601526686" onmouseenter="enter('4246955911601526686');" onmouseout="out('4246955911601526686');" style=""> 566                             if (VERBOSE) Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);               </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 567                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 568                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 571                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 572                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 573                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 574                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 575                 }                                                                                        </span>
<span  style=""> 576                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 578         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 579             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581     }                                                                                                    </span>
<span  style=""> 582                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 583     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 584      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 585      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 586      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 587      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 588      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 589      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 590      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 591      */                                                                                                  </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 592     private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                  </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 593         if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                             </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 594         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 595                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 596                                                                                                          </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 597         Resource res = unpackProto(new Resource(), buffer, dataSize);                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 598         if (DEBUG) {                                                                                     </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 599             Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600         }                                                                                                </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 601         Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                       </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 602         if (icon == null) {                                                                              </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 603             Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604         }                                                                                                </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 605         if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                 </span>
<span class="-1593325621603386304" onmouseenter="enter('-1593325621603386304');" onmouseout="out('-1593325621603386304');" style=""> 606         mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi,               </span>
<span class="406035679709329885" onmouseenter="enter('406035679709329885');" onmouseout="out('406035679709329885');" style=""> 607                 &quot;&quot; /* label */, mUserSerial);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608     }                                                                                                    </span>
<span  style=""> 609                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 610     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 611      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 612      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 613      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 614      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 615      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 616      */                                                                                                  </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 617     private void backupWidgets(BackupDataOutput data) throws IOException {                               </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 618         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 619         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 620         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 621         int backupWidgetCount = 0;                                                                       </span>
<span  style=""> 622                                                                                                          </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 623         String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;               </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 624                 + getUserSelectionArg();                                                                 </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 625         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 626                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 627         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 628             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 629             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 630                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 631                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 632                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 633                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 634                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 635                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 636                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 637                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 638                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 639                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640                 }                                                                                        </span>
<span class="7478848681639332606" onmouseenter="enter('7478848681639332606');" onmouseout="out('7478848681639332606');" style=""> 641                 if (mExistingKeys.contains(backupKey) &amp;&amp; restoredBackupVersion &gt;= BACKUP_VERSION) {      </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 642                     if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                          </span>
<span  style=""> 643                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 644                     // remember that we already backed this up previously                                </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 645                     mKeys.add(key);                                                                      </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 646                 } else if (backupKey != null) {                                                          </span>
<span class="-6588785262075303708" onmouseenter="enter('-6588785262075303708');" onmouseout="out('-6588785262075303708');" style=""> 647                     if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 648                     if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                      </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 649                         if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                             </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 650                         UserHandleCompat user = UserHandleCompat.myUserHandle();                         </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style=""> 651                         writeRowToBackup(key, packWidget(dpi, provider, user), data);                    </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 652                         mKeys.add(key);                                                                  </span>
<span class="945813103637646770" onmouseenter="enter('945813103637646770');" onmouseout="out('945813103637646770');" style=""> 653                         backupWidgetCount ++;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 654                     } else {                                                                             </span>
<span class="5790411094184621928" onmouseenter="enter('5790411094184621928');" onmouseout="out('5790411094184621928');" style=""> 655                         if (VERBOSE) Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                 </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 656                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 657                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 661         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 662             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664     }                                                                                                    </span>
<span  style=""> 665                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 666     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 667      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 668      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 669      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 670      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 671      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 672      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 673      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 674      */                                                                                                  </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 675     private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 676         if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 677         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 678                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 679         Widget widget = unpackProto(new Widget(), buffer, dataSize);                                     </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 680         if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                            </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 681         if (widget.icon.data != null)  {                                                                 </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 682             Bitmap icon = BitmapFactory                                                                  </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 683                     .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                      </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 684             if (icon == null) {                                                                          </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 685                 Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 686             } else {                                                                                     </span>
<span class="4162878957742609395" onmouseenter="enter('4162878957742609395');" onmouseout="out('4162878957742609395');" style=""> 687                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider),               </span>
<span class="3902851904278031906" onmouseenter="enter('3902851904278031906');" onmouseout="out('3902851904278031906');" style=""> 688                         icon, widget.icon.dpi, widget.label, mUserSerial);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690         }                                                                                                </span>
<span  style=""> 691                                                                                                          </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 692         // future site of widget table mutation                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693     }                                                                                                    </span>
<span  style=""> 694                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 695     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 696      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 697      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 698      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 699      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 700     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 701         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 702         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 703         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 704         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 705         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706     }                                                                                                    </span>
<span  style=""> 707                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 708     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 709      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 710      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 711      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 712      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 713     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 714         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 715         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 716         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 717         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 718         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719     }                                                                                                    </span>
<span  style=""> 720                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 721     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 722     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 723         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724     }                                                                                                    </span>
<span  style=""> 725                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 726     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 727     private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 728         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 729             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 730             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 731                 key = null;                                                                              </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 732                 throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 734             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 735         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 736             throw new InvalidBackupException(e);                                                         </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 737         } catch (IllegalArgumentException e) {                                                           </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 738             throw new InvalidBackupException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740     }                                                                                                    </span>
<span  style=""> 741                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 742     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 743     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 744         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 745         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 746         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 747         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 748         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 749             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 751         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 752     }                                                                                                    </span>
<span  style=""> 753                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 754     /**                                                                                                  </span>
<span class="-7741701430317985923" onmouseenter="enter('-7741701430317985923');" onmouseout="out('-7741701430317985923');" style=""> 755      * @return true if its an hotseat item, that can be replaced during restore.                         </span>
<span class="6416967335754747262" onmouseenter="enter('6416967335754747262');" onmouseout="out('6416967335754747262');" style=""> 756      * TODO: Extend check for folders in hotseat.                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 757      */                                                                                                  </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style=""> 758     private boolean isReplaceableHotseatItem(Favorite favorite) {                                        </span>
<span class="604075697947552793" onmouseenter="enter('604075697947552793');" onmouseout="out('604075697947552793');" style=""> 759         return favorite.container == Favorites.CONTAINER_HOTSEAT                                         </span>
<span class="6256768192304850763" onmouseenter="enter('6256768192304850763');" onmouseout="out('6256768192304850763');" style=""> 760                 &amp;&amp; favorite.intent != null                                                               </span>
<span class="-434659868641842414" onmouseenter="enter('-434659868641842414');" onmouseout="out('-434659868641842414');" style=""> 761                 &amp;&amp; (favorite.itemType == Favorites.ITEM_TYPE_APPLICATION                                 </span>
<span class="5423532842312973304" onmouseenter="enter('5423532842312973304');" onmouseout="out('5423532842312973304');" style=""> 762                 || favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763     }                                                                                                    </span>
<span  style=""> 764                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 765     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 766     private Favorite packFavorite(Cursor c) {                                                            </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 767         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 768         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 769         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 770         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 771         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 772         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 773         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 774         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 775         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span  style=""> 776                                                                                                          </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 777         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 778         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 779             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 781         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style=""> 782         Intent intent = null;                                                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 783         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 784             try {                                                                                        </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style=""> 785                 intent = Intent.parseUri(intentDescription, 0);                                          </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 786                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 787                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 788             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 789                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 791         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 792         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 793         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 794             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 795             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 796             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 797                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798             }                                                                                            </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style=""> 799         } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                  </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 800             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 801                 String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                    </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 802                 if (!TextUtils.isEmpty(iconPackage)) {                                                   </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 803                     favorite.iconPackage = iconPackage;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804                 }                                                                                        </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 805                 String iconResource = c.getString(ICON_RESOURCE_INDEX);                                  </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 806                 if (!TextUtils.isEmpty(iconResource)) {                                                  </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 807                     favorite.iconResource = iconResource;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 808                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809             }                                                                                            </span>
<span  style=""> 810                                                                                                          </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 811             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 812             if (blob != null &amp;&amp; blob.length &gt; 0) {                                                       </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 813                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 815         }                                                                                                </span>
<span  style=""> 816                                                                                                          </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style=""> 817         if (isReplaceableHotseatItem(favorite)) {                                                        </span>
<span class="1125417031607979515" onmouseenter="enter('1125417031607979515');" onmouseout="out('1125417031607979515');" style=""> 818             if (intent != null &amp;&amp; intent.getComponent() != null) {                                       </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style=""> 819                 PackageManager pm = mContext.getPackageManager();                                        </span>
<span class="1376604666851387224" onmouseenter="enter('1376604666851387224');" onmouseout="out('1376604666851387224');" style=""> 820                 ActivityInfo activity = null;;                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 821                 try {                                                                                    </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style=""> 822                     activity = pm.getActivityInfo(intent.getComponent(), 0);                             </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 823                 } catch (NameNotFoundException e) {                                                      </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style=""> 824                     Log.e(TAG, &quot;Target not found&quot;, e);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825                 }                                                                                        </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style=""> 826                 if (activity == null) {                                                                  </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 827                     return favorite;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828                 }                                                                                        </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style=""> 829                 for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                     </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style=""> 830                     if (mItemTypeMatchers[i] == null) {                                                  </span>
<span class="2340950037759851004" onmouseenter="enter('2340950037759851004');" onmouseout="out('2340950037759851004');" style=""> 831                         mItemTypeMatchers[i] = new ItemTypeMatcher(                                      </span>
<span class="8145000845780688523" onmouseenter="enter('8145000845780688523');" onmouseout="out('8145000845780688523');" style=""> 832                                 CommonAppTypeParser.getResourceForItemType(i));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833                     }                                                                                    </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style=""> 834                     if (mItemTypeMatchers[i].matches(activity, pm)) {                                    </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style=""> 835                         favorite.targetType = i;                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 836                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840         }                                                                                                </span>
<span  style=""> 841                                                                                                          </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 842         return favorite;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843     }                                                                                                    </span>
<span  style=""> 844                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 845     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-5576008980985724481" onmouseenter="enter('-5576008980985724481');" onmouseout="out('-5576008980985724481');" style=""> 846     private ContentValues unpackFavorite(byte[] buffer, int dataSize)                                    </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 847             throws IOException {                                                                         </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 848         Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                               </span>
<span  style=""> 849                                                                                                          </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 850         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 851         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 852         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 853         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 854         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 855         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 856         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 857         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span  style=""> 858                                                                                                          </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style=""> 859         if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                         </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 860         values.put(Favorites.ICON_TYPE, favorite.iconType);                                              </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 861         if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                         </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 862             values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                    </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 863             values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864         }                                                                                                </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 865             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866         }                                                                                                </span>
<span  style=""> 867                                                                                                          </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 868         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 869             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 870         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 871             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 873         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 874             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 875         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 876         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span  style=""> 877                                                                                                          </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 878         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style=""> 879         long userSerialNumber =                                                                          </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style=""> 880                 UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);            </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 881         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span  style=""> 882                                                                                                          </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 883         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span  style=""> 884                                                                                                          </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 885         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 886             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 887                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 889             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 890             values.put(LauncherSettings.Favorites.RESTORED,                                              </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style=""> 891                     LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                            </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style=""> 892                     LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                      </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style=""> 893                     LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                            </span>
<span  style=""> 894                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 895             // Verify placement                                                                          </span>
<span class="-7553882590673737344" onmouseenter="enter('-7553882590673737344');" onmouseout="out('-7553882590673737344');" style=""> 896             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols)                         </span>
<span class="1436175124930418764" onmouseenter="enter('1436175124930418764');" onmouseout="out('1436175124930418764');" style=""> 897                     || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {               </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 898                 restoreSuccessful = false;                                                               </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style=""> 899                 throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 901         } else {                                                                                         </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style=""> 902             // Check if it is an hotseat item, that can be replaced.                                     </span>
<span class="5088947528875964657" onmouseenter="enter('5088947528875964657');" onmouseout="out('5088947528875964657');" style=""> 903             if (isReplaceableHotseatItem(favorite)                                                       </span>
<span class="-3804650287411139588" onmouseenter="enter('-3804650287411139588');" onmouseout="out('-3804650287411139588');" style=""> 904                     &amp;&amp; favorite.targetType != Favorite.TARGET_NONE                                       </span>
<span class="3747219331600099018" onmouseenter="enter('3747219331600099018');" onmouseout="out('3747219331600099018');" style=""> 905                     &amp;&amp; favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT) {                 </span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style=""> 906                 Log.e(TAG, &quot;Added item type flag&quot;);                                                      </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 907                 values.put(LauncherSettings.Favorites.RESTORED,                                          </span>
<span class="-5769863763985510613" onmouseenter="enter('-5769863763985510613');" onmouseout="out('-5769863763985510613');" style=""> 908                         1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 909             } else {                                                                                     </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 910             // Let LauncherModel know we&#x27;ve been here.                                                   </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 911             values.put(LauncherSettings.Favorites.RESTORED, 1);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912             }                                                                                            </span>
<span  style=""> 913                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 914             // Verify placement                                                                          </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 915             if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                     </span>
<span class="3850618212667286309" onmouseenter="enter('3850618212667286309');" onmouseout="out('3850618212667286309');" style=""> 916                 if ((favorite.screen &gt;= currentProfile.hotseatCount)                                     </span>
<span class="-2927406358945708190" onmouseenter="enter('-2927406358945708190');" onmouseout="out('-2927406358945708190');" style=""> 917                         || (favorite.screen == currentProfile.allappsRank)) {                            </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 918                     restoreSuccessful = false;                                                           </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style=""> 919                     throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 920                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 921             } else {                                                                                     </span>
<span class="4635538835318305805" onmouseenter="enter('4635538835318305805');" onmouseout="out('4635538835318305805');" style=""> 922                 if ((favorite.cellX &gt;= currentProfile.desktopCols)                                       </span>
<span class="-3183516951997115573" onmouseenter="enter('-3183516951997115573');" onmouseout="out('-3183516951997115573');" style=""> 923                         || (favorite.cellY &gt;= currentProfile.desktopRows)) {                             </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 924                     restoreSuccessful = false;                                                           </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style=""> 925                     throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 927             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 928         }                                                                                                </span>
<span  style=""> 929                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 930         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 933     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style=""> 934     private Screen packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 935         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 936         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 937         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style=""> 938         return screen;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939     }                                                                                                    </span>
<span  style=""> 940                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 941     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style=""> 942     private ContentValues unpackScreen(byte[] buffer, int dataSize)                                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 943             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style=""> 944         Screen screen = unpackProto(new Screen(), buffer, dataSize);                                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 945         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 946         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 947         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 948         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 949     }                                                                                                    </span>
<span  style=""> 950                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 951     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style=""> 952     private Resource packIcon(int dpi, Bitmap icon) {                                                    </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 953         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 954         res.dpi = dpi;                                                                                   </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style=""> 955         res.data = Utilities.flattenBitmap(icon);                                                        </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 956         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 957     }                                                                                                    </span>
<span  style=""> 958                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 959     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style=""> 960     private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                  </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style=""> 961         final LauncherAppWidgetProviderInfo info =                                                       </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style=""> 962                 LauncherModel.getProviderInfo(mContext, provider, user);                                 </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 963         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 964         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 965         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 966         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 967         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 968             widget.icon = new Resource();                                                                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style=""> 969             Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);      </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 970             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style=""> 971             widget.icon.data = Utilities.flattenBitmap(icon);                                            </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 972             widget.icon.dpi = dpi;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 973         }                                                                                                </span>
<span  style=""> 974                                                                                                          </span>
<span class="8268283353319641350" onmouseenter="enter('8268283353319641350');" onmouseout="out('8268283353319641350');" style=""> 975         // Calculate the spans corresponding to any one of the orientations as it should not change      </span>
<span class="-4559634212567806776" onmouseenter="enter('-4559634212567806776');" onmouseout="out('-4559634212567806776');" style=""> 976         // based on orientation.                                                                         </span>
<span class="7159740594026618763" onmouseenter="enter('7159740594026618763');" onmouseout="out('7159740594026618763');" style=""> 977         int[] minSpans = CellLayout.rectToCell(                                                          </span>
<span class="-6534356822831926041" onmouseenter="enter('-6534356822831926041');" onmouseout="out('-6534356822831926041');" style=""> 978                 mIdp.portraitProfile, mContext, info.minResizeWidth, info.minResizeHeight, null);        </span>
<span class="414947938502206869" onmouseenter="enter('414947938502206869');" onmouseout="out('414947938502206869');" style=""> 979         widget.minSpanX = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0       </span>
<span class="3309711297405339686" onmouseenter="enter('3309711297405339686');" onmouseout="out('3309711297405339686');" style=""> 980                 ? minSpans[0] : -1;                                                                      </span>
<span class="6449476295053203863" onmouseenter="enter('6449476295053203863');" onmouseout="out('6449476295053203863');" style=""> 981         widget.minSpanY = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0         </span>
<span class="8978476183120858231" onmouseenter="enter('8978476183120858231');" onmouseout="out('8978476183120858231');" style=""> 982                 ? minSpans[1] : -1;                                                                      </span>
<span  style=""> 983                                                                                                          </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style=""> 984         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 985     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 986 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 987 ||||||| BASE                                                                                             </span>
<span class="122020410304176150" onmouseenter="enter('122020410304176150');" onmouseout="out('122020410304176150');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 988 private Widget packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,               </span>
<span class="-9087206329152770867" onmouseenter="enter('-9087206329152770867');" onmouseout="out('-9087206329152770867');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 989             ComponentName provider, UserHandleCompat user) {                                             </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 990         final LauncherAppWidgetProviderInfo info =                                                       </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 991                 LauncherModel.getProviderInfo(mContext, provider, user);                                 </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 992         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 993         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 994         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 995         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 996         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 997             widget.icon = new Resource();                                                                </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 998             Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);       </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 999             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1000             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1001             if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                            </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1002                 widget.icon.data = os.toByteArray();                                                     </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1003                 widget.icon.dpi = dpi;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1004             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1005         }                                                                                                </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1006         if (info.previewImage != 0) {                                                                    </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1007             widget.preview = new Resource();                                                             </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1008             Bitmap preview = previewLoader.generateWidgetPreview(info, null);                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1009             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1010             if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                         </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1011                 widget.preview.data = os.toByteArray();                                                  </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1012                 widget.preview.dpi = dpi;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1013             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1014         }                                                                                                </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1015         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1016     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">1017 =======                                                                                                  </span>
<span class="122020410304176150" onmouseenter="enter('122020410304176150');" onmouseout="out('122020410304176150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1018 private Widget packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,               </span>
<span class="-9087206329152770867" onmouseenter="enter('-9087206329152770867');" onmouseout="out('-9087206329152770867');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1019             ComponentName provider, UserHandleCompat user) {                                             </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1020         final LauncherAppWidgetProviderInfo info =                                                       </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1021                 LauncherModel.getProviderInfo(mContext, provider, user);                                 </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1022         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1023         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1024         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1025         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1026         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1027             widget.icon = new Resource();                                                                </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1028             Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);       </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1029             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1030             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1031             if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                            </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1032                 widget.icon.data = os.toByteArray();                                                     </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1033                 widget.icon.dpi = dpi;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1034             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1035         }                                                                                                </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1036         if (info.previewImage != 0) {                                                                    </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1037             widget.preview = new Resource();                                                             </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1038             Bitmap preview = previewLoader.generateWidgetPreview(info, null);                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1039             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1040             if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                         </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1041                 widget.preview.data = os.toByteArray();                                                  </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1042                 widget.preview.dpi = dpi;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1043             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1044         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1045                                                                                                          </span>
<span class="414947938502206869" onmouseenter="enter('414947938502206869');" onmouseout="out('414947938502206869');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1046         widget.minSpanX = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0       </span>
<span class="-9163706737572277729" onmouseenter="enter('-9163706737572277729');" onmouseout="out('-9163706737572277729');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1047                 ? info.minSpanX : -1;                                                                    </span>
<span class="6449476295053203863" onmouseenter="enter('6449476295053203863');" onmouseout="out('6449476295053203863');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1048         widget.minSpanY = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0         </span>
<span class="1621633565087981805" onmouseenter="enter('1621633565087981805');" onmouseout="out('1621633565087981805');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1049                 ? info.minSpanY : -1;                                                                    </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1050         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1051     }                                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">1052 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style="">1053                                                                                                          </span>
<span  style="">1054                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1055     /**                                                                                                  </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="">1056      * Deserialize a proto after verifying checksum wrapper.                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1057      */                                                                                                  </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="">1058     private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1059             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="">1060         MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="">1061         if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="">1062         return proto;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1063     }                                                                                                    </span>
<span  style="">1064                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1065     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1066      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1067      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1068      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1069      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1070      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1071      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1072      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1073      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1074     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1075         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1076         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1077             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1078         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1079         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1080         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1081             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1082             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1083             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1084                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1085                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1086                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1087                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1088                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1089                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1090                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1091                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1092                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1093                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1094                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1095                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1096                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1097                             bytesRead += result;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1098                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1099                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1100                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1101                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1103                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1104                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1105                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1106                     }                                                                                    </span>
<span  style="">1107                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1108                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1109                     try {                                                                                </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1110                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));             </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1111                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1112                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1113                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1114                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1115                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1116                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1117                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1118                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1119                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1120                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1121                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1122                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1123                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1124                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1125             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1126         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1127             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1128         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1129             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1130                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1131             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1132                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1133             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1134         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1135         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1136     }                                                                                                    </span>
<span  style="">1137                                                                                                          </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1138     private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                     </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1139             throws IOException {                                                                         </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1140         writeRowToBackup(keyToBackupKey(key), proto, data);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1141     }                                                                                                    </span>
<span  style="">1142                                                                                                          </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1143     private void writeRowToBackup(String backupKey, MessageNano proto,                                   </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1144             BackupDataOutput data) throws IOException {                                                  </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1145         byte[] blob = writeCheckedBytes(proto);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1146         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1147         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1148         mBackupDataWasUpdated = true;                                                                    </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1149         if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1150     }                                                                                                    </span>
<span  style="">1151                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1152     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1153      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1154      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1155      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1156      * in that case, do a full backup.                                                                   </span>
<span  style="">1157                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1158      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1159      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1160      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1161     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1162         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1163         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1164             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1165             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1166             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1167             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1168             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1169         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1170             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1171         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1172     }                                                                                                    </span>
<span  style="">1173                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1174     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1175     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1176         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1177         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1178         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1179         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1180         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1181         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1182     }                                                                                                    </span>
<span  style="">1183                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1184     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1185     private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1186             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1187         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1188         MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                             </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1189         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1190         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1191         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1192             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1193         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1194         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1195     }                                                                                                    </span>
<span  style="">1196                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1197     /**                                                                                                  </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1198      * @return true if the launcher is in a state to support backup                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1199      */                                                                                                  </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1200     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1201         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1202         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1203         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1204             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1205             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1207         cursor.close();                                                                                  </span>
<span  style="">1208                                                                                                          </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="">1209         if (LauncherAppState.getInstanceNoCreate() == null) {                                            </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1210             // launcher services are unavailable, try again later                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1211             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1212         }                                                                                                </span>
<span  style="">1213                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1214         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1215     }                                                                                                    </span>
<span  style="">1216                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1217     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1218         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1219                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1220     }                                                                                                    </span>
<span  style="">1221                                                                                                          </span>
<span class="-5176517881040090425" onmouseenter="enter('-5176517881040090425');" onmouseout="out('-5176517881040090425');" style="">1222     @Thunk class InvalidBackupException extends IOException {                                            </span>
<span  style="">1223                                                                                                          </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="">1224         private static final long serialVersionUID = 8931456637211665082L;                               </span>
<span  style="">1225                                                                                                          </span>
<span class="5112209169585560371" onmouseenter="enter('5112209169585560371');" onmouseout="out('5112209169585560371');" style="">1226         @Thunk InvalidBackupException(Throwable cause) {                                                 </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1227             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1228         }                                                                                                </span>
<span  style="">1229                                                                                                          </span>
<span class="5097977583346831854" onmouseenter="enter('5097977583346831854');" onmouseout="out('5097977583346831854');" style="">1230         @Thunk InvalidBackupException(String reason) {                                                   </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1231             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1232         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1233     }                                                                                                    </span>
<span  style="">1234                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1235     /**                                                                                                  </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="">1236      * A class to check if an activity can handle one of the intents from a list of                      </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="">1237      * predefined intents.                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1238      */                                                                                                  </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="">1239     private class ItemTypeMatcher {                                                                      </span>
<span  style="">1240                                                                                                          </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="">1241         private final ArrayList&lt;Intent&gt; mIntents;                                                        </span>
<span  style="">1242                                                                                                          </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="">1243         ItemTypeMatcher(int xml_res) {                                                                   </span>
<span class="-2300579919401902073" onmouseenter="enter('-2300579919401902073');" onmouseout="out('-2300579919401902073');" style="">1244             mIntents = xml_res == 0 ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1245         }                                                                                                </span>
<span  style="">1246                                                                                                          </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="">1247         private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                            </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="">1248             ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                         </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="">1249             XmlResourceParser parser = mContext.getResources().getXml(xml_res);                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1250             try {                                                                                        </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="">1251                 DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);              </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="">1252                 final int depth = parser.getDepth();                                                     </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="">1253                 int type;                                                                                </span>
<span class="-1784597901533800040" onmouseenter="enter('-1784597901533800040');" onmouseout="out('-1784597901533800040');" style="">1254                 while (((type = parser.next()) != XmlPullParser.END_TAG ||                               </span>
<span class="9136127903140816012" onmouseenter="enter('9136127903140816012');" onmouseout="out('9136127903140816012');" style="">1255                         parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) {              </span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="">1256                     if (type != XmlPullParser.START_TAG) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="">1257                         continue;                                                                        </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="">1258                     } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {              </span>
<span class="-6398792714141510192" onmouseenter="enter('-6398792714141510192');" onmouseout="out('-6398792714141510192');" style="">1259                         final String uri = DefaultLayoutParser.getAttributeValue(                        </span>
<span class="-7436101632763202971" onmouseenter="enter('-7436101632763202971');" onmouseout="out('-7436101632763202971');" style="">1260                                 parser, DefaultLayoutParser.ATTR_URI);                                   </span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="">1261                         intents.add(Intent.parseUri(uri, 0));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1262                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1263                 }                                                                                        </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="">1264             } catch (URISyntaxException | XmlPullParserException | IOException e) {                      </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="">1265                 Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1266             } finally {                                                                                  </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="">1267                 parser.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1268             }                                                                                            </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="">1269             return intents;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1270         }                                                                                                </span>
<span  style="">1271                                                                                                          </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="">1272         public boolean matches(ActivityInfo activity, PackageManager pm) {                               </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="">1273             for (Intent intent : mIntents) {                                                             </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="">1274                 intent.setPackage(activity.packageName);                                                 </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="">1275                 ResolveInfo info = pm.resolveActivity(intent, 0);                                        </span>
<span class="2104528236737597253" onmouseenter="enter('2104528236737597253');" onmouseout="out('2104528236737597253');" style="">1276                 if (info != null &amp;&amp; (info.activityInfo.name.equals(activity.name)                        </span>
<span class="1520043710369759480" onmouseenter="enter('1520043710369759480');" onmouseout="out('1520043710369759480');" style="">1277                         || info.activityInfo.name.equals(activity.targetActivity))) {                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1278                     return true;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1279                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1280             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1281             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1282         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1283     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1284 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21 import android.app.backup.BackupManager;                                                                 </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  22 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  23 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  24 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  25 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  26 import android.content.Intent;                                                                           </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="">  27 import android.content.pm.ActivityInfo;                                                                  </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  28 import android.content.pm.PackageManager.NameNotFoundException;                                          </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  29 import android.content.pm.PackageManager;                                                                </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">  30 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="">  31 import android.content.res.XmlResourceParser;                                                            </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  32 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  33 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  34 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  35 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  36 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  37 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  38 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  39 import android.util.Log;                                                                                 </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  40 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  41 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  42 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  43 import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                       </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  44 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  45 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  46 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  47 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  48 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  49 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  50 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  51 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  52 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="">  53 import com.android.launcher3.util.Thunk;                                                                 </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  54 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  55 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  56 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  57 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  58 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  59 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  60 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  61 import java.util.Arrays;                                                                                 </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  62 import java.util.HashSet;                                                                                </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  63 import java.util.zip.CRC32;                                                                              </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="">  64 import org.xmlpull.v1.XmlPullParser;                                                                     </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="">  65 import org.xmlpull.v1.XmlPullParserException;                                                            </span>
<span  style="">  66                                                                                                          </span>
<span  style="">  67                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  68 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  69  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  70  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  71 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  72     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span  style="">  73                                                                                                          </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  74     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span  style="">  75                                                                                                          </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  76     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span  style="">  77                                                                                                          </span>
<span class="-984243926892874638" onmouseenter="enter('-984243926892874638');" onmouseout="out('-984243926892874638');" style="">  78     private static final int BACKUP_VERSION = 3;                                                         </span>
<span  style="">  79                                                                                                          </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  80     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  81                                                                                                          </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  82     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  83     // key (any Base64 encoded string).                                                                  </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  84     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  85     // key (any Base64 encoded string).                                                                  </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  86     private static final String JOURNAL_KEY = &quot;#&quot;;                                                       </span>
<span  style="">  87                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  88     /**                                                                                                  </span>
<span class="-8065821024341297110" onmouseenter="enter('-8065821024341297110');" onmouseout="out('-8065821024341297110');" style="">  89      * icons are large, dribble them out                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  90      */                                                                                                  </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  91     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  93     /**                                                                                                  </span>
<span class="3256952212797886844" onmouseenter="enter('3256952212797886844');" onmouseout="out('3256952212797886844');" style="">  94      * widgets contain previews, which are very large, dribble them out                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  95      */                                                                                                  </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  96     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  97                                                                                                          </span>
<span class="1587707096878894918" onmouseenter="enter('1587707096878894918');" onmouseout="out('1587707096878894918');" style="">  98     private static final String[] FAVORITE_PROJECTION = new java.lang.String[]{ Favorites._ID, // 0      </span>
<span class="-8910357097358992059" onmouseenter="enter('-8910357097358992059');" onmouseout="out('-8910357097358992059');" style="">  99     Favorites.MODIFIED, // 1                                                                             </span>
<span class="-749201270860763817" onmouseenter="enter('-749201270860763817');" onmouseout="out('-749201270860763817');" style=""> 100     Favorites.INTENT, // 2                                                                               </span>
<span class="-612495736897876596" onmouseenter="enter('-612495736897876596');" onmouseout="out('-612495736897876596');" style=""> 101     Favorites.APPWIDGET_PROVIDER// 3                                                                     </span>
<span class="-6720320026711450546" onmouseenter="enter('-6720320026711450546');" onmouseout="out('-6720320026711450546');" style=""> 102     , Favorites.APPWIDGET_ID, // 4                                                                       </span>
<span class="3218168104679783416" onmouseenter="enter('3218168104679783416');" onmouseout="out('3218168104679783416');" style=""> 103     Favorites.CELLX, // 5                                                                                </span>
<span class="8245952406225141877" onmouseenter="enter('8245952406225141877');" onmouseout="out('8245952406225141877');" style=""> 104     Favorites.CELLY, // 6                                                                                </span>
<span class="-2109237276185492425" onmouseenter="enter('-2109237276185492425');" onmouseout="out('-2109237276185492425');" style=""> 105     Favorites.CONTAINER, // 7                                                                            </span>
<span class="-8366598762535535129" onmouseenter="enter('-8366598762535535129');" onmouseout="out('-8366598762535535129');" style=""> 106     Favorites.ICON, // 8                                                                                 </span>
<span class="-3642835515557756243" onmouseenter="enter('-3642835515557756243');" onmouseout="out('-3642835515557756243');" style=""> 107     Favorites.ICON_PACKAGE, // 9                                                                         </span>
<span class="-2327923354092612113" onmouseenter="enter('-2327923354092612113');" onmouseout="out('-2327923354092612113');" style=""> 108     Favorites.ICON_RESOURCE, // 10                                                                       </span>
<span class="5850657317434177997" onmouseenter="enter('5850657317434177997');" onmouseout="out('5850657317434177997');" style=""> 109     Favorites.ICON_TYPE, // 11                                                                           </span>
<span class="3850117922988643466" onmouseenter="enter('3850117922988643466');" onmouseout="out('3850117922988643466');" style=""> 110     Favorites.ITEM_TYPE, // 12                                                                           </span>
<span class="-6475101418922352990" onmouseenter="enter('-6475101418922352990');" onmouseout="out('-6475101418922352990');" style=""> 111     Favorites.SCREEN, // 13                                                                              </span>
<span class="5128229125325386907" onmouseenter="enter('5128229125325386907');" onmouseout="out('5128229125325386907');" style=""> 112     Favorites.SPANX, // 14                                                                               </span>
<span class="-6122457275871599674" onmouseenter="enter('-6122457275871599674');" onmouseout="out('-6122457275871599674');" style=""> 113     Favorites.SPANY, // 15                                                                               </span>
<span class="-1948317659803091992" onmouseenter="enter('-1948317659803091992');" onmouseout="out('-1948317659803091992');" style=""> 114     Favorites.TITLE, // 16                                                                               </span>
<span class="-5109695553719171621" onmouseenter="enter('-5109695553719171621');" onmouseout="out('-5109695553719171621');" style=""> 115     Favorites.PROFILE_ID// 17                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 116      };                                                                                                  </span>
<span  style=""> 117                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 118     private static final int ID_INDEX = 0;                                                               </span>
<span  style=""> 119                                                                                                          </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 120     private static final int ID_MODIFIED = 1;                                                            </span>
<span  style=""> 121                                                                                                          </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 122     private static final int INTENT_INDEX = 2;                                                           </span>
<span  style=""> 123                                                                                                          </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 124     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span  style=""> 125                                                                                                          </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 126     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span  style=""> 127                                                                                                          </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 128     private static final int CELLX_INDEX = 5;                                                            </span>
<span  style=""> 129                                                                                                          </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 130     private static final int CELLY_INDEX = 6;                                                            </span>
<span  style=""> 131                                                                                                          </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 132     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span  style=""> 133                                                                                                          </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 134     private static final int ICON_INDEX = 8;                                                             </span>
<span  style=""> 135                                                                                                          </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 136     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span  style=""> 137                                                                                                          </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 138     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span  style=""> 139                                                                                                          </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 140     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span  style=""> 141                                                                                                          </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 142     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span  style=""> 143                                                                                                          </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 144     private static final int SCREEN_INDEX = 13;                                                          </span>
<span  style=""> 145                                                                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 146     private static final int SPANX_INDEX = 14;                                                           </span>
<span  style=""> 147                                                                                                          </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 148     private static final int SPANY_INDEX = 15;                                                           </span>
<span  style=""> 149                                                                                                          </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 150     private static final int TITLE_INDEX = 16;                                                           </span>
<span  style=""> 151                                                                                                          </span>
<span class="5285461630596938806" onmouseenter="enter('5285461630596938806');" onmouseout="out('5285461630596938806');" style=""> 152     private static final String[] SCREEN_PROJECTION = new java.lang.String[]{ WorkspaceScreens._ID, // 0 </span>
<span class="-468774149427187497" onmouseenter="enter('-468774149427187497');" onmouseout="out('-468774149427187497');" style=""> 153     WorkspaceScreens.MODIFIED, // 1                                                                      </span>
<span class="500123378539811644" onmouseenter="enter('500123378539811644');" onmouseout="out('500123378539811644');" style=""> 154     WorkspaceScreens.SCREEN_RANK// 2                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 155      };                                                                                                  </span>
<span  style=""> 156                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 157     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 158                                                                                                          </span>
<span class="7768295683460392373" onmouseenter="enter('7768295683460392373');" onmouseout="out('7768295683460392373');" style=""> 159     @Thunk final Context mContext;                                                                       </span>
<span  style=""> 160                                                                                                          </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 161     private final HashSet&lt;String&gt; mExistingKeys;                                                         </span>
<span  style=""> 162                                                                                                          </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 163     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span  style=""> 164                                                                                                          </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style=""> 165     private final ItemTypeMatcher[] mItemTypeMatchers;                                                   </span>
<span  style=""> 166                                                                                                          </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style=""> 167     private final long mUserSerial;                                                                      </span>
<span  style=""> 168                                                                                                          </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 169     private BackupManager mBackupManager;                                                                </span>
<span  style=""> 170                                                                                                          </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 171     private byte[] mBuffer = new byte[512];                                                              </span>
<span  style=""> 172                                                                                                          </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 173     private long mLastBackupRestoreTime;                                                                 </span>
<span  style=""> 174                                                                                                          </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 175     private boolean mBackupDataWasUpdated;                                                               </span>
<span  style=""> 176                                                                                                          </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style=""> 177     private IconCache mIconCache;                                                                        </span>
<span  style=""> 178                                                                                                          </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style=""> 179     private DeviceProfieData mDeviceProfileData;                                                         </span>
<span  style=""> 180                                                                                                          </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style=""> 181     private InvariantDeviceProfile mIdp;                                                                 </span>
<span  style=""> 182                                                                                                          </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 183     boolean restoreSuccessful;                                                                           </span>
<span  style=""> 184                                                                                                          </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 185     int restoredBackupVersion = 1;                                                                       </span>
<span  style=""> 186                                                                                                          </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 187     public LauncherBackupHelper(Context context) {                                                       </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 188         mContext = context;                                                                              </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 189         mExistingKeys = new HashSet&lt;String&gt;();                                                           </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 190         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 191         restoreSuccessful = true;                                                                        </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style=""> 192         mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];               </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style=""> 193         UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                         </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style=""> 194         mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 197     private void dataChanged() {                                                                         </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 198         if (mBackupManager == null) {                                                                    </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 199             mBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 201         mBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 204     private void applyJournal(Journal journal) {                                                         </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 205         mLastBackupRestoreTime = journal.t;                                                              </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 206         mExistingKeys.clear();                                                                           </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 207         if (journal.key != null) {                                                                       </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 208             for (Key key : journal.key) {                                                                </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 209                 mExistingKeys.add(keyToBackupKey(key));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211         }                                                                                                </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style=""> 212         restoredBackupVersion = journal.backupVersion;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 215     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 216      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 217      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 218      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 219      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 220      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 221      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 222      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 223      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 224      * @param newState notes for the next backup                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 225      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 226     @Override                                                                                            </span>
<span class="-5806703195927255708" onmouseenter="enter('-5806703195927255708');" onmouseout="out('-5806703195927255708');" style=""><abbr title=" 227     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data, ParcelFileDescriptor newState) {"> 227     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data, ParcelFileDescriptor </abbr></span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 228         if (VERBOSE) {                                                                                   </span>
<span class="-5617118756948088857" onmouseenter="enter('-5617118756948088857');" onmouseout="out('-5617118756948088857');" style=""> 229             Log.v(TAG, &quot;onBackup&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230         }                                                                                                </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 231         Journal in = readJournal(oldState);                                                              </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 232         if (!launcherIsReady()) {                                                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 233             dataChanged();                                                                               </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 234             // Perform backup later.                                                                     </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 235             writeJournal(newState, in);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 236             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237         }                                                                                                </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 238         if (mDeviceProfileData == null) {                                                                </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 239             LauncherAppState app = LauncherAppState.getInstance();                                       </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style=""> 240             mIdp = app.getInvariantDeviceProfile();                                                      </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 241             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 242             mIconCache = app.getIconCache();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243         }                                                                                                </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 244         Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                          </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 245         mKeys.clear();                                                                                   </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 246         applyJournal(in);                                                                                </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 247         // Record the time before performing backup so that entries edited while the backup              </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 248         // was going on, do not get missed in next backup.                                               </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 249         long newBackupTime = System.currentTimeMillis();                                                 </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 250         mBackupDataWasUpdated = false;                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 251         try {                                                                                            </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 252             backupFavorites(data);                                                                       </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 253             backupScreens(data);                                                                         </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 254             backupIcons(data);                                                                           </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 255             backupWidgets(data);                                                                         </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 256             // Delete any key which still exist in the old backup, but is not valid anymore.             </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 257             HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                           </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 258             for (Key key : mKeys) {                                                                      </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 259                 validKeys.add(keyToBackupKey(key));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260             }                                                                                            </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 261             mExistingKeys.removeAll(validKeys);                                                          </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 262             // Delete anything left in the existing keys.                                                </span>
<span class="4811572641015042658" onmouseenter="enter('4811572641015042658');" onmouseout="out('4811572641015042658');" style=""> 263             for (String deleted : mExistingKeys) {                                                       </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 264                 if (VERBOSE) {                                                                           </span>
<span class="1150942118378003601" onmouseenter="enter('1150942118378003601');" onmouseout="out('1150942118378003601');" style=""> 265                     Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266                 }                                                                                        </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 267                 data.writeEntityHeader(deleted, -1);                                                     </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 268                 mBackupDataWasUpdated = true;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269             }                                                                                            </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 270             mExistingKeys.clear();                                                                       </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 271             if (!mBackupDataWasUpdated) {                                                                </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 272                 // Check if any metadata has changed                                                     </span>
<span class="-1567327741722237843" onmouseenter="enter('-1567327741722237843');" onmouseout="out('-1567327741722237843');" style=""><abbr title=" 273                 mBackupDataWasUpdated = (((in.profile == null) || (!Arrays.equals(DeviceProfieData.toByteArray(in.profile), DeviceProfieData.toByteArray(mDeviceProfileData)))) || (in.backupVersion != BACKUP_VERSION)) || (in.appVersion != getAppVersion());"> 273                 mBackupDataWasUpdated = (((in.profile == null) || (!Arrays.equals(DeviceProfieData.toByte</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274             }                                                                                            </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 275             if (mBackupDataWasUpdated) {                                                                 </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 276                 mLastBackupRestoreTime = newBackupTime;                                                  </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 277                 // We store the journal at two places.                                                   </span>
<span class="4290466575057092605" onmouseenter="enter('4290466575057092605');" onmouseout="out('4290466575057092605');" style=""> 278                 // 1) Storing it in newState allows us to do partial backups by comparing old state      </span>
<span class="5756403488043250658" onmouseenter="enter('5756403488043250658');" onmouseout="out('5756403488043250658');" style=""> 279                 // 2) Storing it in backup data allows us to validate keys during restore                </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 280                 Journal state = getCurrentStateJournal();                                                </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 281                 writeRowToBackup(JOURNAL_KEY, state, data);                                              </span>
<span class="-5471896261648202052" onmouseenter="enter('-5471896261648202052');" onmouseout="out('-5471896261648202052');" style=""> 282             } else if (DEBUG) {                                                                          </span>
<span class="3608009003540804130" onmouseenter="enter('3608009003540804130');" onmouseout="out('3608009003540804130');" style=""> 283                 Log.d(TAG, &quot;Nothing was written during backup&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 285         } catch (IOException e) {                                                                        </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 286             Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287         }                                                                                                </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 288         writeNewStateDescription(newState);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289     }                                                                                                    </span>
<span  style=""> 290                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 291     /**                                                                                                  </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 292      * @return true if the backup corresponding to oldstate can be successfully applied                  </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 293      * to this device.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 294      */                                                                                                  </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 295     private boolean isBackupCompatible(Journal oldState) {                                               </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 296         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 297         DeviceProfieData oldProfile = oldState.profile;                                                  </span>
<span class="-5663454642251425284" onmouseenter="enter('-5663454642251425284');" onmouseout="out('-5663454642251425284');" style=""> 298         if ((oldProfile == null) || (oldProfile.desktopCols == 0)) {                                     </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 299             // Profile info is not valid, ignore the check.                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 300             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301         }                                                                                                </span>
<span class="-3969248474555793010" onmouseenter="enter('-3969248474555793010');" onmouseout="out('-3969248474555793010');" style=""> 302         boolean isHotsetCompatible = false;                                                              </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 303         if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                     </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 304             isHotsetCompatible = true;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305         }                                                                                                </span>
<span class="-8710001377939156799" onmouseenter="enter('-8710001377939156799');" onmouseout="out('-8710001377939156799');" style=""><abbr title=" 306         if ((currentProfile.hotseatCount &gt;= oldProfile.hotseatCount) &amp;&amp; (currentProfile.allappsRank == oldProfile.allappsRank)) {"> 306         if ((currentProfile.hotseatCount &gt;= oldProfile.hotseatCount) &amp;&amp; (currentProfile.allappsRank == ol</abbr></span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 307             isHotsetCompatible = true;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308         }                                                                                                </span>
<span class="2902868092242092650" onmouseenter="enter('2902868092242092650');" onmouseout="out('2902868092242092650');" style=""><abbr title=" 309         return (isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)) &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);"> 309         return (isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)) &amp;&amp; (current</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310     }                                                                                                    </span>
<span  style=""> 311                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 312     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 313      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 314      * It assumes that the keys will arrive in lexical order. So if the journal was present in the       </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 315      * backup, it should arrive first.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 316      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 317      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 318      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 319     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 320     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 321         if (!restoreSuccessful) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 322             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323         }                                                                                                </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 324         if (mDeviceProfileData == null) {                                                                </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style=""> 325             // This call does not happen on a looper thread. So LauncherAppState                         </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style=""> 326             // can&#x27;t be created . Instead initialize required dependencies directly.                     </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style=""> 327             mIdp = new InvariantDeviceProfile(mContext);                                                 </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 328             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style=""> 329             mIconCache = new IconCache(mContext, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330         }                                                                                                </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 331         int dataSize = data.size();                                                                      </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 332         if (mBuffer.length &lt; dataSize) {                                                                 </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 333             mBuffer = new byte[dataSize];                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 335         try {                                                                                            </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 336             int bytesRead = data.read(mBuffer, 0, dataSize);                                             </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 337             if (DEBUG) {                                                                                 </span>
<span class="8996496803609627725" onmouseenter="enter('8996496803609627725');" onmouseout="out('8996496803609627725');" style=""> 338                 Log.d(TAG, (((&quot;read &quot; + bytesRead) + &quot; of &quot;) + dataSize) + &quot; available&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339             }                                                                                            </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 340             String backupKey = data.getKey();                                                            </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 341             if (JOURNAL_KEY.equals(backupKey)) {                                                         </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 342                 if (VERBOSE) {                                                                           </span>
<span class="-2230266871029732794" onmouseenter="enter('-2230266871029732794');" onmouseout="out('-2230266871029732794');" style=""> 343                     Log.v(TAG, &quot;Journal entry restored&quot;);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344                 }                                                                                        </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 345                 if (!mKeys.isEmpty()) {                                                                  </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 346                     // We received the journal key after a restore key.                                  </span>
<span class="-4686256114772101773" onmouseenter="enter('-4686256114772101773');" onmouseout="out('-4686256114772101773');" style=""> 347                     Log.wtf(TAG, (keyToBackupKey(mKeys.get(0)) + &quot; received after &quot;) + JOURNAL_KEY);     </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 348                     restoreSuccessful = false;                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 349                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350                 }                                                                                        </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 351                 Journal journal = new Journal();                                                         </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 352                 MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                     </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 353                 applyJournal(journal);                                                                   </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 354                 restoreSuccessful = isBackupCompatible(journal);                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 355                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356             }                                                                                            </span>
<span class="7483085946619488974" onmouseenter="enter('7483085946619488974');" onmouseout="out('7483085946619488974');" style=""> 357             if ((!mExistingKeys.isEmpty()) &amp;&amp; (!mExistingKeys.contains(backupKey))) {                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 358                 if (DEBUG) {                                                                             </span>
<span class="-4761886863514344241" onmouseenter="enter('-4761886863514344241');" onmouseout="out('-4761886863514344241');" style=""> 359                     Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 361                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362             }                                                                                            </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 363             Key key = backupKeyToKey(backupKey);                                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 364             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 365             switch (key.type) {                                                                          </span>
<span class="6496334887013597344" onmouseenter="enter('6496334887013597344');" onmouseout="out('6496334887013597344');" style=""> 366                 case Key.FAVORITE :                                                                      </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 367                     restoreFavorite(key, mBuffer, dataSize);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 368                     break;                                                                               </span>
<span class="287087988598936739" onmouseenter="enter('287087988598936739');" onmouseout="out('287087988598936739');" style=""> 369                 case Key.SCREEN :                                                                        </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 370                     restoreScreen(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 371                     break;                                                                               </span>
<span class="-8891757616372688198" onmouseenter="enter('-8891757616372688198');" onmouseout="out('-8891757616372688198');" style=""> 372                 case Key.ICON :                                                                          </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 373                     restoreIcon(key, mBuffer, dataSize);                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 374                     break;                                                                               </span>
<span class="-8481070254821362106" onmouseenter="enter('-8481070254821362106');" onmouseout="out('-8481070254821362106');" style=""> 375                 case Key.WIDGET :                                                                        </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 376                     restoreWidget(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 377                     break;                                                                               </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 378                 default :                                                                                </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 379                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 380                     mKeys.remove(key);                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 381                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 383         } catch (IOException e) {                                                                        </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 384             Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386     }                                                                                                    </span>
<span  style=""> 387                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 388     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 389      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 390      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 391      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 392      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 393     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 394     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 395         writeJournal(newState, getCurrentStateJournal());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396     }                                                                                                    </span>
<span  style=""> 397                                                                                                          </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 398     private Journal getCurrentStateJournal() {                                                           </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 399         Journal journal = new Journal();                                                                 </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 400         journal.t = mLastBackupRestoreTime;                                                              </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 401         journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                 </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 402         journal.appVersion = getAppVersion();                                                            </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 403         journal.backupVersion = BACKUP_VERSION;                                                          </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style=""> 404         journal.profile = mDeviceProfileData;                                                            </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 405         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406     }                                                                                                    </span>
<span  style=""> 407                                                                                                          </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 408     private int getAppVersion() {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 409         try {                                                                                            </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 410             return mContext.getPackageManager()                                                          </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 411                     .getPackageInfo(mContext.getPackageName(), 0).versionCode;                           </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 412         } catch (NameNotFoundException e) {                                                              </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 413             return 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415     }                                                                                                    </span>
<span  style=""> 416                                                                                                          </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style=""> 417     private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                     </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style=""> 418         DeviceProfieData data = new DeviceProfieData();                                                  </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style=""> 419         data.desktopRows = profile.numRows;                                                              </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style=""> 420         data.desktopCols = profile.numColumns;                                                           </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style=""> 421         data.hotseatCount = profile.numHotseatIcons;                                                     </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style=""> 422         data.allappsRank = profile.hotseatAllAppsRank;                                                   </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style=""> 423         return data;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424     }                                                                                                    </span>
<span  style=""> 425                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 426     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 427      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 428      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 429      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 430      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 431      */                                                                                                  </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 432     private void backupFavorites(BackupDataOutput data) throws IOException {                             </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 433         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 434         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 435         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 436         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 437                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 438         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 439             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 440             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 441                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 442                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 443                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 444                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 445                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 446                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 447                     writeRowToBackup(key, packFavorite(cursor), data);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 448                 } else {                                                                                 </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 449                     if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 452         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 453             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455     }                                                                                                    </span>
<span  style=""> 456                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 457     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 458      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 459      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 460      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 461      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 462      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 463      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 464      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 465      */                                                                                                  </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 466     private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {              </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 467         if (VERBOSE) {                                                                                   </span>
<span class="-6123834741244844948" onmouseenter="enter('-6123834741244844948');" onmouseout="out('-6123834741244844948');" style=""> 468             Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 470         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 471             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 471             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472         }                                                                                                </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 473         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 474         ContentValues values = unpackFavorite(buffer, dataSize);                                         </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style=""> 475         cr.insert(Favorites.CONTENT_URI, values);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476     }                                                                                                    </span>
<span  style=""> 477                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 478     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 479      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 480      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 481      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 482      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 483      */                                                                                                  </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 484     private void backupScreens(BackupDataOutput data) throws IOException {                               </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 485         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 486         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 487         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 488                 null, null, null);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 489         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 490             cursor.moveToPosition(-1);                                                                   </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 491             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 492             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 493                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 494                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 495                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 496                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 497                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 498                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 499                     writeRowToBackup(key, packScreen(cursor), data);                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 500                 } else {                                                                                 </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 501                     if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 504         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 505             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507     }                                                                                                    </span>
<span  style=""> 508                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 509     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 510      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 511      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 512      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 513      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 514      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 515      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 516      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 517      */                                                                                                  </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 518     private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 519         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 520         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 521                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 522                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 523         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 524         ContentValues values = unpackScreen(buffer, dataSize);                                           </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 525         cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526     }                                                                                                    </span>
<span  style=""> 527                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 528     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 529      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 530      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 531      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 532      * @param data output stream for key/value pairs                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 533      */                                                                                                  </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 534     private void backupIcons(BackupDataOutput data) throws IOException {                                 </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 535         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 536         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 537         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 538         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 539         int backupUpIconCount = 0;                                                                       </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 540         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="-6932835081018188666" onmouseenter="enter('-6932835081018188666');" onmouseout="out('-6932835081018188666');" style=""><abbr title=" 541         String where = ((((((((&quot;(&quot; + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_APPLICATION) + &quot; OR &quot;) + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_SHORTCUT) + &quot;) AND &quot;) + getUserSelectionArg();"> 541         String where = ((((((((&quot;(&quot; + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_APPLICATION) + &quot; O</abbr></span>
<span class="-6766008609016485436" onmouseenter="enter('-6766008609016485436');" onmouseout="out('-6766008609016485436');" style=""> 542         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, where, null, null);         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 543         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 544             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 545             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 546                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 547                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 548                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 549                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 550                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 551                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 552                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 553                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 554                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 555                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 556                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 557                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558                     }                                                                                    </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 559                     if (mExistingKeys.contains(backupKey)) {                                             </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 560                         if (DEBUG) {                                                                     </span>
<span class="4635087996775304723" onmouseenter="enter('4635087996775304723');" onmouseout="out('4635087996775304723');" style=""> 561                             Log.d(TAG, &quot;already saved icon &quot; + backupKey);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562                         }                                                                                </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 563                         // remember that we already backed this up previously                            </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 564                         mKeys.add(key);                                                                  </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 565                     } else if (backupKey != null) {                                                      </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 566                         if (DEBUG) {                                                                     </span>
<span class="530416191072288257" onmouseenter="enter('530416191072288257');" onmouseout="out('530416191072288257');" style=""> 567                             Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568                         }                                                                                </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 569                         if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 570                             if (DEBUG) {                                                                 </span>
<span class="-2589587613337864598" onmouseenter="enter('-2589587613337864598');" onmouseout="out('-2589587613337864598');" style=""> 571                                 Log.d(TAG, &quot;saving icon &quot; + backupKey);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572                             }                                                                            </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 573                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="8052636830342996642" onmouseenter="enter('8052636830342996642');" onmouseout="out('8052636830342996642');" style=""> 574                             if ((icon != null) &amp;&amp; (!mIconCache.isDefaultIcon(icon, myUserHandle))) {     </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 575                                 writeRowToBackup(key, packIcon(dpi, icon), data);                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 576                                 mKeys.add(key);                                                          </span>
<span class="235400677560042881" onmouseenter="enter('235400677560042881');" onmouseout="out('235400677560042881');" style=""> 577                                 backupUpIconCount++;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 579                         } else {                                                                         </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 580                             if (VERBOSE) {                                                               </span>
<span class="5129938609128680853" onmouseenter="enter('5129938609128680853');" onmouseout="out('5129938609128680853');" style=""> 581                                 Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 582                             }                                                                            </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 583                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 584                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 587                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 588                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 589                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 590                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 593         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 594             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596     }                                                                                                    </span>
<span  style=""> 597                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 598     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 599      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 600      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 601      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 602      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 603      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 604      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 605      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 606      */                                                                                                  </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 607     private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                  </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 608         if (VERBOSE) {                                                                                   </span>
<span class="-4078819072521132180" onmouseenter="enter('-4078819072521132180');" onmouseout="out('-4078819072521132180');" style=""> 609             Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 611         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 612             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 612             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 613         }                                                                                                </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 614         Resource res = unpackProto(new Resource(), buffer, dataSize);                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 615         if (DEBUG) {                                                                                     </span>
<span class="1496105702580132456" onmouseenter="enter('1496105702580132456');" onmouseout="out('1496105702580132456');" style=""> 616             Log.d(TAG, (&quot;unpacked &quot; + res.dpi) + &quot; dpi icon&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617         }                                                                                                </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 618         Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                       </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 619         if (icon == null) {                                                                              </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 620             Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621         }                                                                                                </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 622         if (VERBOSE) {                                                                                   </span>
<span class="7868918963870702505" onmouseenter="enter('7868918963870702505');" onmouseout="out('7868918963870702505');" style=""> 623             Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624         }                                                                                                </span>
<span class="3133606860225122509" onmouseenter="enter('3133606860225122509');" onmouseout="out('3133606860225122509');" style=""> 625                 /* label */                                                                              </span>
<span class="5699101804009838706" onmouseenter="enter('5699101804009838706');" onmouseout="out('5699101804009838706');" style=""><abbr title=" 626         mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi, &quot;&quot;, mUserSerial);"> 626         mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi, &quot;&quot;, mUserSeria</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627     }                                                                                                    </span>
<span  style=""> 628                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 629     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 630      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 631      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 632      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 633      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 634      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 635      */                                                                                                  </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 636     private void backupWidgets(BackupDataOutput data) throws IOException {                               </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 637         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 638         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 639         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 640         int backupWidgetCount = 0;                                                                       </span>
<span class="-6307972240176527729" onmouseenter="enter('-6307972240176527729');" onmouseout="out('-6307972240176527729');" style=""><abbr title=" 641         String where = (((Favorites.ITEM_TYPE + &quot;=&quot;) + Favorites.ITEM_TYPE_APPWIDGET) + &quot; AND &quot;) + getUserSelectionArg();"> 641         String where = (((Favorites.ITEM_TYPE + &quot;=&quot;) + Favorites.ITEM_TYPE_APPWIDGET) + &quot; AND &quot;) + getUse</abbr></span>
<span class="-6766008609016485436" onmouseenter="enter('-6766008609016485436');" onmouseout="out('-6766008609016485436');" style=""> 642         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, where, null, null);         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 643         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 644             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 645             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 646                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 647                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 648                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 649                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 650                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 651                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 652                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 653                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 654                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 655                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656                 }                                                                                        </span>
<span class="1863995525512557052" onmouseenter="enter('1863995525512557052');" onmouseout="out('1863995525512557052');" style=""> 657                 if (mExistingKeys.contains(backupKey) &amp;&amp; (restoredBackupVersion &gt;= BACKUP_VERSION)) {    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 658                     if (DEBUG) {                                                                         </span>
<span class="5278806361360866030" onmouseenter="enter('5278806361360866030');" onmouseout="out('5278806361360866030');" style=""> 659                         Log.d(TAG, &quot;already saved widget &quot; + backupKey);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660                     }                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 661                     // remember that we already backed this up previously                                </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 662                     mKeys.add(key);                                                                      </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 663                 } else if (backupKey != null) {                                                          </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 664                     if (DEBUG) {                                                                         </span>
<span class="678155715926072897" onmouseenter="enter('678155715926072897');" onmouseout="out('678155715926072897');" style=""> 665                         Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666                     }                                                                                    </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 667                     if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                      </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 668                         if (DEBUG) {                                                                     </span>
<span class="5540811938341971613" onmouseenter="enter('5540811938341971613');" onmouseout="out('5540811938341971613');" style=""> 669                             Log.d(TAG, &quot;saving widget &quot; + backupKey);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 670                         }                                                                                </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 671                         UserHandleCompat user = UserHandleCompat.myUserHandle();                         </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style=""> 672                         writeRowToBackup(key, packWidget(dpi, provider, user), data);                    </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 673                         mKeys.add(key);                                                                  </span>
<span class="3646169184741034315" onmouseenter="enter('3646169184741034315');" onmouseout="out('3646169184741034315');" style=""> 674                         backupWidgetCount++;                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 675                     } else {                                                                             </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 676                         if (VERBOSE) {                                                                   </span>
<span class="5514285149038000298" onmouseenter="enter('5514285149038000298');" onmouseout="out('5514285149038000298');" style=""> 677                             Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678                         }                                                                                </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 679                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 680                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 682                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 684         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 685             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687     }                                                                                                    </span>
<span  style=""> 688                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 689     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 690      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 691      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 692      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 693      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 694      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 695      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 696      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 697      */                                                                                                  </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 698     private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 699         if (VERBOSE) {                                                                                   </span>
<span class="-6524290342693786597" onmouseenter="enter('-6524290342693786597');" onmouseout="out('-6524290342693786597');" style=""> 700             Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 702         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 703             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 703             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704         }                                                                                                </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 705         Widget widget = unpackProto(new Widget(), buffer, dataSize);                                     </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 706         if (DEBUG) {                                                                                     </span>
<span class="-9093045750186824630" onmouseenter="enter('-9093045750186824630');" onmouseout="out('-9093045750186824630');" style=""> 707             Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 708         }                                                                                                </span>
<span class="-2352547474915147862" onmouseenter="enter('-2352547474915147862');" onmouseout="out('-2352547474915147862');" style=""> 709         if (widget.icon.data != null) {                                                                  </span>
<span class="-4697846519687927474" onmouseenter="enter('-4697846519687927474');" onmouseout="out('-4697846519687927474');" style=""> 710             Bitmap icon = BitmapFactory.decodeByteArray(widget.icon.data, 0, widget.icon.data.length);   </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 711             if (icon == null) {                                                                          </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 712                 Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 713             } else {                                                                                     </span>
<span class="3722982284822269625" onmouseenter="enter('3722982284822269625');" onmouseout="out('3722982284822269625');" style=""><abbr title=" 714                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider), icon, widget.icon.dpi, widget.label, mUserSerial);"> 714                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider), icon, widget.i</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 715             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716         }                                                                                                </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 717         // future site of widget table mutation                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718     }                                                                                                    </span>
<span  style=""> 719                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 720     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 721      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 722      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 723      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 724      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 725     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 726         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 727         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 728         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 729         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 730         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731     }                                                                                                    </span>
<span  style=""> 732                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 733     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 734      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 735      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 736      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 737      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 738     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 739         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 740         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 741         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 742         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 743         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 744     }                                                                                                    </span>
<span  style=""> 745                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 746     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 747     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 748         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749     }                                                                                                    </span>
<span  style=""> 750                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 751     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 752     private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 753         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 754             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 755             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 756                 key = null;                                                                              </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 757                 throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 759             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 760         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 761             throw new InvalidBackupException(e);                                                         </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 762         } catch (IllegalArgumentException e) {                                                           </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 763             throw new InvalidBackupException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 765     }                                                                                                    </span>
<span  style=""> 766                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 767     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 768     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 769         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 770         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 771         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 772         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 773         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 774             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 776         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777     }                                                                                                    </span>
<span  style=""> 778                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 779     /**                                                                                                  </span>
<span class="-4501492075935595010" onmouseenter="enter('-4501492075935595010');" onmouseout="out('-4501492075935595010');" style=""> 780      * @return the current device profile information.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 781      */                                                                                                  </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style=""> 782     private boolean isReplaceableHotseatItem(Favorite favorite) {                                        </span>
<span class="2678893273476874271" onmouseenter="enter('2678893273476874271');" onmouseout="out('2678893273476874271');" style=""><abbr title=" 783         return ((favorite.container == Favorites.CONTAINER_HOTSEAT) &amp;&amp; (favorite.intent != null)) &amp;&amp; ((favorite.itemType == Favorites.ITEM_TYPE_APPLICATION) || (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT));"> 783         return ((favorite.container == Favorites.CONTAINER_HOTSEAT) &amp;&amp; (favorite.intent != null)) &amp;&amp; ((fa</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784     }                                                                                                    </span>
<span  style=""> 785                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 786     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 787     private Favorite packFavorite(Cursor c) {                                                            </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 788         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 789         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 790         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 791         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 792         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 793         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 794         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 795         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 796         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 797         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 798         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 799             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 801         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style=""> 802         Intent intent = null;                                                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 803         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 804             try {                                                                                        </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style=""> 805                 intent = Intent.parseUri(intentDescription, 0);                                          </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 806                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 807                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 808             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 809                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 812         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 813         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 814             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 815             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 816             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 817                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818             }                                                                                            </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style=""> 819         } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                  </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 820             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 821                 String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                    </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 822                 if (!TextUtils.isEmpty(iconPackage)) {                                                   </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 823                     favorite.iconPackage = iconPackage;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824                 }                                                                                        </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 825                 String iconResource = c.getString(ICON_RESOURCE_INDEX);                                  </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 826                 if (!TextUtils.isEmpty(iconResource)) {                                                  </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 827                     favorite.iconResource = iconResource;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829             }                                                                                            </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 830             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-7768091047370598017" onmouseenter="enter('-7768091047370598017');" onmouseout="out('-7768091047370598017');" style=""> 831             if ((blob != null) &amp;&amp; (blob.length &gt; 0)) {                                                   </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 832                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834         }                                                                                                </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style=""> 835         if (isReplaceableHotseatItem(favorite)) {                                                        </span>
<span class="-5359258242147093219" onmouseenter="enter('-5359258242147093219');" onmouseout="out('-5359258242147093219');" style=""> 836             if ((intent != null) &amp;&amp; (intent.getComponent() != null)) {                                   </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style=""> 837                 PackageManager pm = mContext.getPackageManager();                                        </span>
<span class="4317298495692205294" onmouseenter="enter('4317298495692205294');" onmouseout="out('4317298495692205294');" style=""> 838                 ActivityInfo activity = null;                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 839                 try {                                                                                    </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style=""> 840                     activity = pm.getActivityInfo(intent.getComponent(), 0);                             </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 841                 } catch (NameNotFoundException e) {                                                      </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style=""> 842                     Log.e(TAG, &quot;Target not found&quot;, e);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843                 }                                                                                        </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style=""> 844                 if (activity == null) {                                                                  </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 845                     return favorite;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846                 }                                                                                        </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style=""> 847                 for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                     </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style=""> 848                     if (mItemTypeMatchers[i] == null) {                                                  </span>
<span class="-4832415767623566243" onmouseenter="enter('-4832415767623566243');" onmouseout="out('-4832415767623566243');" style=""><abbr title=" 849                         mItemTypeMatchers[i] = new ItemTypeMatcher(CommonAppTypeParser.getResourceForItemType(i));"> 849                         mItemTypeMatchers[i] = new ItemTypeMatcher(CommonAppTypeParser.getResourceForItem</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850                     }                                                                                    </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style=""> 851                     if (mItemTypeMatchers[i].matches(activity, pm)) {                                    </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style=""> 852                         favorite.targetType = i;                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 853                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 854                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 857         }                                                                                                </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 858         return favorite;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859     }                                                                                                    </span>
<span  style=""> 860                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 861     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-2705156603149131066" onmouseenter="enter('-2705156603149131066');" onmouseout="out('-2705156603149131066');" style=""> 862     private ContentValues unpackFavorite(byte[] buffer, int dataSize) throws IOException {               </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 863         Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                               </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 864         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 865         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 866         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 867         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 868         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 869         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 870         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 871         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style=""> 872         if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                         </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 873             values.put(Favorites.ICON_TYPE, favorite.iconType);                                          </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 874             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 875                 values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 876                 values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877             }                                                                                            </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 878             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879         }                                                                                                </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 880         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 881             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 882         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 883             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 885         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 886             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 887         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 888         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 889         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="927954047226477943" onmouseenter="enter('927954047226477943');" onmouseout="out('927954047226477943');" style=""><abbr title=" 890         long userSerialNumber = UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);"> 890         long userSerialNumber = UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHand</abbr></span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 891         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 892         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 893         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 894             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 895                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 896             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 897             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="4553452473703868579" onmouseenter="enter('4553452473703868579');" onmouseout="out('4553452473703868579');" style=""><abbr title=" 898             values.put(LauncherSettings.Favorites.RESTORED, (LauncherAppWidgetInfo.FLAG_ID_NOT_VALID | LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY) | LauncherAppWidgetInfo.FLAG_UI_NOT_READY);"> 898             values.put(LauncherSettings.Favorites.RESTORED, (LauncherAppWidgetInfo.FLAG_ID_NOT_VALID | La</abbr></span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 899             // Verify placement                                                                          </span>
<span class="3504964728132522462" onmouseenter="enter('3504964728132522462');" onmouseout="out('3504964728132522462');" style=""><abbr title=" 900             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols) || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {"> 900             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols) || ((favorite.cellY + fa</abbr></span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 901                 restoreSuccessful = false;                                                               </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style=""> 902                 throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 904         } else {                                                                                         </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style=""> 905             // Check if it is an hotseat item, that can be replaced.                                     </span>
<span class="279700350632264948" onmouseenter="enter('279700350632264948');" onmouseout="out('279700350632264948');" style=""><abbr title=" 906             if ((isReplaceableHotseatItem(favorite) &amp;&amp; (favorite.targetType != Favorite.TARGET_NONE)) &amp;&amp; (favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT)) {"> 906             if ((isReplaceableHotseatItem(favorite) &amp;&amp; (favorite.targetType != Favorite.TARGET_NONE)) &amp;&amp; </abbr></span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style=""> 907                 Log.e(TAG, &quot;Added item type flag&quot;);                                                      </span>
<span class="8152825144969340057" onmouseenter="enter('8152825144969340057');" onmouseout="out('8152825144969340057');" style=""><abbr title=" 908                 values.put(LauncherSettings.Favorites.RESTORED, 1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));"> 908                 values.put(LauncherSettings.Favorites.RESTORED, 1 | CommonAppTypeParser.encodeItemTypeToF</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 909             } else {                                                                                     </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 910                 // Let LauncherModel know we&#x27;ve been here.                                               </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 911                 values.put(LauncherSettings.Favorites.RESTORED, 1);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912             }                                                                                            </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 913             // Verify placement                                                                          </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 914             if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                     </span>
<span class="2545967495709376645" onmouseenter="enter('2545967495709376645');" onmouseout="out('2545967495709376645');" style=""><abbr title=" 915                 if ((favorite.screen &gt;= currentProfile.hotseatCount) || (favorite.screen == currentProfile.allappsRank)) {"> 915                 if ((favorite.screen &gt;= currentProfile.hotseatCount) || (favorite.screen == currentProfil</abbr></span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 916                     restoreSuccessful = false;                                                           </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style=""> 917                     throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 918                 }                                                                                        </span>
<span class="1112998508371516182" onmouseenter="enter('1112998508371516182');" onmouseout="out('1112998508371516182');" style=""><abbr title=" 919             } else if ((favorite.cellX &gt;= currentProfile.desktopCols) || (favorite.cellY &gt;= currentProfile.desktopRows)) {"> 919             } else if ((favorite.cellX &gt;= currentProfile.desktopCols) || (favorite.cellY &gt;= currentProfil</abbr></span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 920                 restoreSuccessful = false;                                                               </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style=""> 921                 throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 922             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 923         }                                                                                                </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 924         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 925     }                                                                                                    </span>
<span  style=""> 926                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 927     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style=""> 928     private Screen packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 929         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 930         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 931         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style=""> 932         return screen;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 933     }                                                                                                    </span>
<span  style=""> 934                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 935     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style=""> 936     private ContentValues unpackScreen(byte[] buffer, int dataSize)                                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 937             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style=""> 938         Screen screen = unpackProto(new Screen(), buffer, dataSize);                                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 939         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 940         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 941         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 942         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 943     }                                                                                                    </span>
<span  style=""> 944                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 945     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style=""> 946     private Resource packIcon(int dpi, Bitmap icon) {                                                    </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 947         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 948         res.dpi = dpi;                                                                                   </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style=""> 949         res.data = Utilities.flattenBitmap(icon);                                                        </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 950         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951     }                                                                                                    </span>
<span  style=""> 952                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 953     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style=""> 954     private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                  </span>
<span class="-1416918261157743074" onmouseenter="enter('-1416918261157743074');" onmouseout="out('-1416918261157743074');" style=""><abbr title=" 955         final LauncherAppWidgetProviderInfo info = LauncherModel.getProviderInfo(mContext, provider, user);"> 955         final LauncherAppWidgetProviderInfo info = LauncherModel.getProviderInfo(mContext, provider, user</abbr></span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 956         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 957         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 958         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 959         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 960         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 961             widget.icon = new Resource();                                                                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style=""> 962             Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);      </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 963             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style=""> 964             widget.icon.data = Utilities.flattenBitmap(icon);                                            </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 965             widget.icon.dpi = dpi;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 966         }                                                                                                </span>
<span class="8268283353319641350" onmouseenter="enter('8268283353319641350');" onmouseout="out('8268283353319641350');" style=""> 967         // Calculate the spans corresponding to any one of the orientations as it should not change      </span>
<span class="-4559634212567806776" onmouseenter="enter('-4559634212567806776');" onmouseout="out('-4559634212567806776');" style=""> 968         // based on orientation.                                                                         </span>
<span class="-5998062733532150357" onmouseenter="enter('-5998062733532150357');" onmouseout="out('-5998062733532150357');" style=""><abbr title=" 969         int[] minSpans = CellLayout.rectToCell(mIdp.portraitProfile, mContext, info.minResizeWidth, info.minResizeHeight, null);"> 969         int[] minSpans = CellLayout.rectToCell(mIdp.portraitProfile, mContext, info.minResizeWidth, info.</abbr></span>
<span class="-7177902876744646191" onmouseenter="enter('-7177902876744646191');" onmouseout="out('-7177902876744646191');" style=""><abbr title=" 970         widget.minSpanX = ((info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0) ? minSpans[0] : -1;"> 970         widget.minSpanX = ((info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0) ? mi</abbr></span>
<span class="-5672534363743955568" onmouseenter="enter('-5672534363743955568');" onmouseout="out('-5672534363743955568');" style=""><abbr title=" 971         widget.minSpanY = ((info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0) ? minSpans[1] : -1;"> 971         widget.minSpanY = ((info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0) ? minS</abbr></span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style=""> 972         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 973     }                                                                                                    </span>
<span  style=""> 974                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 975     /**                                                                                                  </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style=""> 976      * Deserialize a proto after verifying checksum wrapper.                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 977      */                                                                                                  </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style=""> 978     private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 979             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style=""> 980         MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style=""> 981         if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style=""> 982         return proto;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 983     }                                                                                                    </span>
<span  style=""> 984                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 985     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style=""> 986      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 987      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style=""> 988      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style=""> 989      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 990      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style=""> 991      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style=""> 992      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 993      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style=""> 994     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 995         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style=""> 996         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 997             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 998         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style=""> 999         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1000         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1001             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1002             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1003             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1004                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1005                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1006                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1007                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1008                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1009                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1010                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1011                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1012                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1013                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1014                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1015                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1016                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1017                             bytesRead += result;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1018                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1019                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1020                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1021                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1022                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1023                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1024                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1025                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1026                     }                                                                                    </span>
<span  style="">1027                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1028                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1029                     try {                                                                                </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1030                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));             </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1031                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1032                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1033                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1034                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1035                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1036                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1037                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1038                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1039                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1040                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1041                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1042                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1043                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1044                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1045             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1046         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1047             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1048         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1049             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1050                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1051             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1052                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1053             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1054         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1055         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1056     }                                                                                                    </span>
<span  style="">1057                                                                                                          </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1058     private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                     </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1059             throws IOException {                                                                         </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1060         writeRowToBackup(keyToBackupKey(key), proto, data);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1061     }                                                                                                    </span>
<span  style="">1062                                                                                                          </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1063     private void writeRowToBackup(String backupKey, MessageNano proto,                                   </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1064             BackupDataOutput data) throws IOException {                                                  </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1065         byte[] blob = writeCheckedBytes(proto);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1066         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1067         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1068         mBackupDataWasUpdated = true;                                                                    </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1069         if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1070     }                                                                                                    </span>
<span  style="">1071                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1072     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1073      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1074      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1075      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1076      * in that case, do a full backup.                                                                   </span>
<span  style="">1077                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1078      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1079      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1080      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1081     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1082         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1083         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1084             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1085             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1086             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1087             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1088             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1089         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1090             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1091         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1092     }                                                                                                    </span>
<span  style="">1093                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1094     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1095     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1096         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1097         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1098         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1099         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1100         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1101         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102     }                                                                                                    </span>
<span  style="">1103                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1104     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1105     private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1106             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1107         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1108         MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                             </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1109         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1110         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1111         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1112             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1113         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1114         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1115     }                                                                                                    </span>
<span  style="">1116                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1117     /**                                                                                                  </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1118      * @return true if the launcher is in a state to support backup                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1119      */                                                                                                  </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1120     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1121         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1122         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1123         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1124             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1125             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1126         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1127         cursor.close();                                                                                  </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="">1128         if (LauncherAppState.getInstanceNoCreate() == null) {                                            </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1129             // launcher services are unavailable, try again later                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1130             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1131         }                                                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1132         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1133     }                                                                                                    </span>
<span  style="">1134                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1135     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1136         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1137                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1138     }                                                                                                    </span>
<span  style="">1139                                                                                                          </span>
<span class="-2238806055197440738" onmouseenter="enter('-2238806055197440738');" onmouseout="out('-2238806055197440738');" style="">1140     @Thunk                                                                                               </span>
<span class="-7015206867904851673" onmouseenter="enter('-7015206867904851673');" onmouseout="out('-7015206867904851673');" style="">1141     class InvalidBackupException extends IOException {                                                   </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="">1142         private static final long serialVersionUID = 8931456637211665082L;                               </span>
<span  style="">1143                                                                                                          </span>
<span class="-2238806055197440738" onmouseenter="enter('-2238806055197440738');" onmouseout="out('-2238806055197440738');" style="">1144         @Thunk                                                                                           </span>
<span class="-4902678955413310672" onmouseenter="enter('-4902678955413310672');" onmouseout="out('-4902678955413310672');" style="">1145         InvalidBackupException(Throwable cause) {                                                        </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1146             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1147         }                                                                                                </span>
<span  style="">1148                                                                                                          </span>
<span class="-2238806055197440738" onmouseenter="enter('-2238806055197440738');" onmouseout="out('-2238806055197440738');" style="">1149         @Thunk                                                                                           </span>
<span class="7967891493045537234" onmouseenter="enter('7967891493045537234');" onmouseout="out('7967891493045537234');" style="">1150         InvalidBackupException(String reason) {                                                          </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1151             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1152         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1153     }                                                                                                    </span>
<span  style="">1154                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1155     /**                                                                                                  </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="">1156      * A class to check if an activity can handle one of the intents from a list of                      </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="">1157      * predefined intents.                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1158      */                                                                                                  </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="">1159     private class ItemTypeMatcher {                                                                      </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="">1160         private final ArrayList&lt;Intent&gt; mIntents;                                                        </span>
<span  style="">1161                                                                                                          </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="">1162         ItemTypeMatcher(int xml_res) {                                                                   </span>
<span class="7774102846924447028" onmouseenter="enter('7774102846924447028');" onmouseout="out('7774102846924447028');" style="">1163             mIntents = (xml_res == 0) ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1164         }                                                                                                </span>
<span  style="">1165                                                                                                          </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="">1166         private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                            </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="">1167             ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                         </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="">1168             XmlResourceParser parser = mContext.getResources().getXml(xml_res);                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1169             try {                                                                                        </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="">1170                 DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);              </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="">1171                 final int depth = parser.getDepth();                                                     </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="">1172                 int type;                                                                                </span>
<span class="4981837604325580139" onmouseenter="enter('4981837604325580139');" onmouseout="out('4981837604325580139');" style=""><abbr title="1173                 while ((((type = parser.next()) != XmlPullParser.END_TAG) || (parser.getDepth() &gt; depth)) &amp;&amp; (type != XmlPullParser.END_DOCUMENT)) {">1173                 while ((((type = parser.next()) != XmlPullParser.END_TAG) || (parser.getDepth() &gt; depth))</abbr></span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="">1174                     if (type != XmlPullParser.START_TAG) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="">1175                         continue;                                                                        </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="">1176                     } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {              </span>
<span class="2100728637087232742" onmouseenter="enter('2100728637087232742');" onmouseout="out('2100728637087232742');" style=""><abbr title="1177                         final String uri = DefaultLayoutParser.getAttributeValue(parser, DefaultLayoutParser.ATTR_URI);">1177                         final String uri = DefaultLayoutParser.getAttributeValue(parser, DefaultLayoutPar</abbr></span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="">1178                         intents.add(Intent.parseUri(uri, 0));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1179                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1180                 }                                                                                        </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="">1181             } catch (URISyntaxException | XmlPullParserException | IOException e) {                      </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="">1182                 Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1183             } finally {                                                                                  </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="">1184                 parser.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1185             }                                                                                            </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="">1186             return intents;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1187         }                                                                                                </span>
<span  style="">1188                                                                                                          </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="">1189         public boolean matches(ActivityInfo activity, PackageManager pm) {                               </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="">1190             for (Intent intent : mIntents) {                                                             </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="">1191                 intent.setPackage(activity.packageName);                                                 </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="">1192                 ResolveInfo info = pm.resolveActivity(intent, 0);                                        </span>
<span class="515179691964617202" onmouseenter="enter('515179691964617202');" onmouseout="out('515179691964617202');" style=""><abbr title="1193                 if ((info != null) &amp;&amp; (info.activityInfo.name.equals(activity.name) || info.activityInfo.name.equals(activity.targetActivity))) {">1193                 if ((info != null) &amp;&amp; (info.activityInfo.name.equals(activity.name) || info.activityInfo.</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1194                     return true;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1195                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1196             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1197             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1198         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1199     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1200 }                                                                                                        </span>


















































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2   * Copyright (C) 2013 The Android Open Source Project                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16  package com.android.launcher3;                                                                                    </span>
<span  style="">  17                                                                                                                    </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18  import android.app.backup.BackupDataInputStream;                                                                  </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19  import android.app.backup.BackupDataOutput;                                                                       </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20  import android.app.backup.BackupHelper;                                                                           </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21  import android.app.backup.BackupManager;                                                                          </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import android.appwidget.AppWidgetProviderInfo;                                                                   </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  23  import android.content.ComponentName;                                                                             </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  24  import android.content.ContentResolver;                                                                           </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  25  import android.content.ContentValues;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  26  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  27  import android.content.Intent;                                                                                    </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import android.content.pm.ActivityInfo;                                                                           </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import android.content.pm.PackageManager;                                                                         </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  30  import android.content.pm.PackageManager.NameNotFoundException;                                                   </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +import android.content.pm.ResolveInfo;                                                                            </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import android.content.res.XmlResourceParser;                                                                     </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  33  import android.database.Cursor;                                                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  34  import android.graphics.Bitmap;                                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  35  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  36  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  37  import android.os.ParcelFileDescriptor;                                                                           </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  38  import android.text.TextUtils;                                                                                    </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  39  import android.util.Base64;                                                                                       </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  40  import android.util.Log;                                                                                          </span>
<span  style="">  41                                                                                                                    </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  42  import com.android.launcher3.LauncherSettings.Favorites;                                                          </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  43  import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                                   </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  44  import com.android.launcher3.backup.BackupProtos;                                                                 </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  45  import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                                  </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  46  import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                                </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  47  import com.android.launcher3.backup.BackupProtos.Favorite;                                                        </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  48  import com.android.launcher3.backup.BackupProtos.Journal;                                                         </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  49  import com.android.launcher3.backup.BackupProtos.Key;                                                             </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  50  import com.android.launcher3.backup.BackupProtos.Resource;                                                        </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  51  import com.android.launcher3.backup.BackupProtos.Screen;                                                          </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  52  import com.android.launcher3.backup.BackupProtos.Widget;                                                          </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  53  import com.android.launcher3.compat.UserHandleCompat;                                                             </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  54  import com.android.launcher3.compat.UserManagerCompat;                                                            </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +import com.android.launcher3.util.Thunk;                                                                          </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  56  import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                               </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  57  import com.google.protobuf.nano.MessageNano;                                                                      </span>
<span  style="">  58                                                                                                                    </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -import java.io.ByteArrayOutputStream;                                                                             </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +import org.xmlpull.v1.XmlPullParser;                                                                              </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +import org.xmlpull.v1.XmlPullParserException;                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +                                                                                                                  </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  63  import java.io.FileInputStream;                                                                                   </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  64  import java.io.FileOutputStream;                                                                                  </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  65  import java.io.IOException;                                                                                       </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  66  import java.net.URISyntaxException;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  67  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  68  import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  70  import java.util.HashSet;                                                                                         </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  71  import java.util.zip.CRC32;                                                                                       </span>
<span  style="">  72                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  73  /**                                                                                                               </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  74   * Persist the launcher home state across calamities.                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  75   */                                                                                                               </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  76  public class LauncherBackupHelper implements BackupHelper {                                                       </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  77      private static final String TAG = &quot;LauncherBackupHelper&quot;;                                                     </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  78      private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                                     </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  79      private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                         </span>
<span  style="">  80                                                                                                                    </span>
<span class="-1169906795921543870" onmouseenter="enter('-1169906795921543870');" onmouseout="out('-1169906795921543870');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -    private static final int BACKUP_VERSION = 2;                                                                  </span>
<span class="-984243926892874638" onmouseenter="enter('-984243926892874638');" onmouseout="out('-984243926892874638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +    private static final int BACKUP_VERSION = 3;                                                                  </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  83      private static final int MAX_JOURNAL_SIZE = 1000000;                                                          </span>
<span  style="">  84                                                                                                                    </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  85      // Journal key is such that it is always smaller than any dynamically generated                               </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  86      // key (any Base64 encoded string).                                                                           </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  87      private static final String JOURNAL_KEY = &quot;#&quot;;                                                                </span>
<span  style="">  88                                                                                                                    </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  89      /** icons are large, dribble them out */                                                                      </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  90      private static final int MAX_ICONS_PER_PASS = 10;                                                             </span>
<span  style="">  91                                                                                                                    </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  92      /** widgets contain previews, which are very large, dribble them out */                                       </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  93      private static final int MAX_WIDGETS_PER_PASS = 5;                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -                                                                                                                  </span>
<span class="-1476094414441025702" onmouseenter="enter('-1476094414441025702');" onmouseout="out('-1476094414441025702');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -    private static final int IMAGE_COMPRESSION_QUALITY = 75;                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -                                                                                                                  </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -    private static final Bitmap.CompressFormat IMAGE_FORMAT =                                                     </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -            android.graphics.Bitmap.CompressFormat.PNG;                                                           </span>
<span  style="">  99                                                                                                                    </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style=""> 100      private static final String[] FAVORITE_PROJECTION = {                                                         </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style=""> 101          Favorites._ID,                     // 0                                                                   </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style=""> 102          Favorites.MODIFIED,                // 1                                                                   </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style=""> 103          Favorites.INTENT,                  // 2                                                                   </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style=""> 104          Favorites.APPWIDGET_PROVIDER,      // 3                                                                   </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style=""> 105          Favorites.APPWIDGET_ID,            // 4                                                                   </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style=""> 106          Favorites.CELLX,                   // 5                                                                   </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style=""> 107          Favorites.CELLY,                   // 6                                                                   </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 108          Favorites.CONTAINER,               // 7                                                                   </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 109          Favorites.ICON,                    // 8                                                                   </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 110          Favorites.ICON_PACKAGE,            // 9                                                                   </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 111          Favorites.ICON_RESOURCE,           // 10                                                                  </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 112          Favorites.ICON_TYPE,               // 11                                                                  </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 113          Favorites.ITEM_TYPE,               // 12                                                                  </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 114          Favorites.SCREEN,                  // 13                                                                  </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 115          Favorites.SPANX,                   // 14                                                                  </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 116          Favorites.SPANY,                   // 15                                                                  </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 117          Favorites.TITLE,                   // 16                                                                  </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 118          Favorites.PROFILE_ID,              // 17                                                                  </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 119      };                                                                                                            </span>
<span  style=""> 120                                                                                                                    </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 121      private static final int ID_INDEX = 0;                                                                        </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 122      private static final int ID_MODIFIED = 1;                                                                     </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 123      private static final int INTENT_INDEX = 2;                                                                    </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 124      private static final int APPWIDGET_PROVIDER_INDEX = 3;                                                        </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 125      private static final int APPWIDGET_ID_INDEX = 4;                                                              </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 126      private static final int CELLX_INDEX = 5;                                                                     </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 127      private static final int CELLY_INDEX = 6;                                                                     </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 128      private static final int CONTAINER_INDEX = 7;                                                                 </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 129      private static final int ICON_INDEX = 8;                                                                      </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 130      private static final int ICON_PACKAGE_INDEX = 9;                                                              </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 131      private static final int ICON_RESOURCE_INDEX = 10;                                                            </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 132      private static final int ICON_TYPE_INDEX = 11;                                                                </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 133      private static final int ITEM_TYPE_INDEX = 12;                                                                </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 134      private static final int SCREEN_INDEX = 13;                                                                   </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 135      private static final int SPANX_INDEX = 14;                                                                    </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 136      private static final int SPANY_INDEX = 15;                                                                    </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 137      private static final int TITLE_INDEX = 16;                                                                    </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 139      private static final String[] SCREEN_PROJECTION = {                                                           </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 140          WorkspaceScreens._ID,              // 0                                                                   </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 141          WorkspaceScreens.MODIFIED,         // 1                                                                   </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 142          WorkspaceScreens.SCREEN_RANK       // 2                                                                   </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 143      };                                                                                                            </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 145      private static final int SCREEN_RANK_INDEX = 2;                                                               </span>
<span  style=""> 146                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -    private final Context mContext;                                                                               </span>
<span class="7768295683460392373" onmouseenter="enter('7768295683460392373');" onmouseout="out('7768295683460392373');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +    @Thunk final Context mContext;                                                                                </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 149      private final HashSet&lt;String&gt; mExistingKeys;                                                                  </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 150      private final ArrayList&lt;Key&gt; mKeys;                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -                                                                                                                  </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -    private IconCache mIconCache;                                                                                 </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +    private final ItemTypeMatcher[] mItemTypeMatchers;                                                            </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +    private final long mUserSerial;                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                                                                                                                  </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 156      private BackupManager mBackupManager;                                                                         </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 157      private byte[] mBuffer = new byte[512];                                                                       </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 158      private long mLastBackupRestoreTime;                                                                          </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 159      private boolean mBackupDataWasUpdated;                                                                        </span>
<span  style=""> 160                                                                                                                    </span>
<span class="-6659096482642381235" onmouseenter="enter('-6659096482642381235');" onmouseout="out('-6659096482642381235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -    private DeviceProfieData mCurrentProfile;                                                                     </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +    private IconCache mIconCache;                                                                                 </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +    private DeviceProfieData mDeviceProfileData;                                                                  </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +    private InvariantDeviceProfile mIdp;                                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +                                                                                                                  </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 166      boolean restoreSuccessful;                                                                                    </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 167      int restoredBackupVersion = 1;                                                                                </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 169      public LauncherBackupHelper(Context context) {                                                                </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 170          mContext = context;                                                                                       </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 171          mExistingKeys = new HashSet&lt;String&gt;();                                                                    </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 172          mKeys = new ArrayList&lt;Key&gt;();                                                                             </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 173          restoreSuccessful = true;                                                                                 </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +        mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                                                                                                                  </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +        UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                                  </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +        mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178      }                                                                                                             </span>
<span  style=""> 179                                                                                                                    </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 180      private void dataChanged() {                                                                                  </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 181          if (mBackupManager == null) {                                                                             </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 182              mBackupManager = new BackupManager(mContext);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183          }                                                                                                         </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 184          mBackupManager.dataChanged();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185      }                                                                                                             </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 187      private void applyJournal(Journal journal) {                                                                  </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 188          mLastBackupRestoreTime = journal.t;                                                                       </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 189          mExistingKeys.clear();                                                                                    </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 190          if (journal.key != null) {                                                                                </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 191              for (Key key : journal.key) {                                                                         </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 192                  mExistingKeys.add(keyToBackupKey(key));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194          }                                                                                                         </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +        restoredBackupVersion = journal.backupVersion;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196      }                                                                                                             </span>
<span  style=""> 197                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 198      /**                                                                                                           </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 199       * Back up launcher data so we can restore the user&#x27;s state on a new device.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 200       *                                                                                                            </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 201       * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 202       *                                                                                                            </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 203       * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 204       *                                                                                                            </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 205       * @param oldState notes from the last backup                                                                 </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 206       * @param data incremental key/value pairs to persist off-device                                              </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 207       * @param newState notes for the next backup                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 208       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 209      @Override                                                                                                     </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 210      public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                               </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 211              ParcelFileDescriptor newState) {                                                                      </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 212          if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                                      </span>
<span  style=""> 213                                                                                                                    </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 214          Journal in = readJournal(oldState);                                                                       </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 215          if (!launcherIsReady()) {                                                                                 </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +            dataChanged();                                                                                        </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 217              // Perform backup later.                                                                              </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 218              writeJournal(newState, in);                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 219              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                                                                                                                  </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +        if (mDeviceProfileData == null) {                                                                         </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +            LauncherAppState app = LauncherAppState.getInstance();                                                </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +            mIdp = app.getInvariantDeviceProfile();                                                               </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +            mDeviceProfileData = initDeviceProfileData(mIdp);                                                     </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +            mIconCache = app.getIconCache();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +                                                                                                                  </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 229          Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                                   </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 230          mKeys.clear();                                                                                            </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 231          applyJournal(in);                                                                                         </span>
<span  style=""> 232                                                                                                                    </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 233          // Record the time before performing backup so that entries edited while the backup                       </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 234          // was going on, do not get missed in next backup.                                                        </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 235          long newBackupTime = System.currentTimeMillis();                                                          </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 236          mBackupDataWasUpdated = false;                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 237          try {                                                                                                     </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 238              backupFavorites(data);                                                                                </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 239              backupScreens(data);                                                                                  </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 240              backupIcons(data);                                                                                    </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 241              backupWidgets(data);                                                                                  </span>
<span  style=""> 242                                                                                                                    </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 243              // Delete any key which still exist in the old backup, but is not valid anymore.                      </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 244              HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                                    </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 245              for (Key key : mKeys) {                                                                               </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 246                  validKeys.add(keyToBackupKey(key));                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247              }                                                                                                     </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 248              mExistingKeys.removeAll(validKeys);                                                                   </span>
<span  style=""> 249                                                                                                                    </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 250              // Delete anything left in the existing keys.                                                         </span>
<span class="-8057776950468218811" onmouseenter="enter('-8057776950468218811');" onmouseout="out('-8057776950468218811');" style=""> 251              for (String deleted: mExistingKeys) {                                                                 </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style=""> 252                  if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                      </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 253                  data.writeEntityHeader(deleted, -1);                                                              </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 254                  mBackupDataWasUpdated = true;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255              }                                                                                                     </span>
<span  style=""> 256                                                                                                                    </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 257              mExistingKeys.clear();                                                                                </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 258              if (!mBackupDataWasUpdated) {                                                                         </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 259                  // Check if any metadata has changed                                                              </span>
<span class="4456255566361909194" onmouseenter="enter('4456255566361909194');" onmouseout="out('4456255566361909194');" style=""> 260                  mBackupDataWasUpdated = (in.profile == null)                                                      </span>
<span class="3696867724938300008" onmouseenter="enter('3696867724938300008');" onmouseout="out('3696867724938300008');" style=""> 261                          || !Arrays.equals(DeviceProfieData.toByteArray(in.profile),                               </span>
<span class="-1876011232687984521" onmouseenter="enter('-1876011232687984521');" onmouseout="out('-1876011232687984521');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -                            DeviceProfieData.toByteArray(getDeviceProfieData()))                                  </span>
<span class="-526865330972865914" onmouseenter="enter('-526865330972865914');" onmouseout="out('-526865330972865914');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +                            DeviceProfieData.toByteArray(mDeviceProfileData))                                     </span>
<span class="-3212861652554024645" onmouseenter="enter('-3212861652554024645');" onmouseout="out('-3212861652554024645');" style=""> 264                          || (in.backupVersion != BACKUP_VERSION)                                                   </span>
<span class="3693115347738857050" onmouseenter="enter('3693115347738857050');" onmouseout="out('3693115347738857050');" style=""> 265                          || (in.appVersion != getAppVersion());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266              }                                                                                                     </span>
<span  style=""> 267                                                                                                                    </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 268              if (mBackupDataWasUpdated) {                                                                          </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 269                  mLastBackupRestoreTime = newBackupTime;                                                           </span>
<span  style=""> 270                                                                                                                    </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 271                  // We store the journal at two places.                                                            </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style=""> 272                  //   1) Storing it in newState allows us to do partial backups by comparing old state             </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style=""> 273                  //   2) Storing it in backup data allows us to validate keys during restore                       </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 274                  Journal state = getCurrentStateJournal();                                                         </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 275                  writeRowToBackup(JOURNAL_KEY, state, data);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 276              } else {                                                                                              </span>
<span class="6846529623619819273" onmouseenter="enter('6846529623619819273');" onmouseout="out('6846529623619819273');" style=""> 277                  if (DEBUG) Log.d(TAG, &quot;Nothing was written during backup&quot;);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 279          } catch (IOException e) {                                                                                 </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 280              Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281          }                                                                                                         </span>
<span  style=""> 282                                                                                                                    </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 283          writeNewStateDescription(newState);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284      }                                                                                                             </span>
<span  style=""> 285                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 286      /**                                                                                                           </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 287       * @return true if the backup corresponding to oldstate can be successfully applied                           </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 288       * to this device.                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 289       */                                                                                                           </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 290      private boolean isBackupCompatible(Journal oldState) {                                                        </span>
<span class="6840222601736111479" onmouseenter="enter('6840222601736111479');" onmouseout="out('6840222601736111479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -        DeviceProfieData currentProfile = getDeviceProfieData();                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 292 -                                                                                                                  </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +        DeviceProfieData currentProfile = mDeviceProfileData;                                                     </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 294          DeviceProfieData oldProfile = oldState.profile;                                                           </span>
<span  style=""> 295                                                                                                                    </span>
<span class="3516483988150785854" onmouseenter="enter('3516483988150785854');" onmouseout="out('3516483988150785854');" style=""> 296          if (oldProfile == null || oldProfile.desktopCols == 0) {                                                  </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 297              // Profile info is not valid, ignore the check.                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 298              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299          }                                                                                                         </span>
<span  style=""> 300                                                                                                                    </span>
<span class="-3969248474555793010" onmouseenter="enter('-3969248474555793010');" onmouseout="out('-3969248474555793010');" style=""> 301          boolean isHotsetCompatible = false;                                                                       </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 302          if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                              </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 303              isHotsetCompatible = true;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304          }                                                                                                         </span>
<span class="-5234148737954946799" onmouseenter="enter('-5234148737954946799');" onmouseout="out('-5234148737954946799');" style=""> 305          if ((currentProfile.hotseatCount &gt;= oldProfile.hotseatCount) &amp;&amp;                                           </span>
<span class="-4785593469925988823" onmouseenter="enter('-4785593469925988823');" onmouseout="out('-4785593469925988823');" style=""> 306                  (currentProfile.allappsRank == oldProfile.allappsRank)) {                                         </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 307              isHotsetCompatible = true;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308          }                                                                                                         </span>
<span  style=""> 309                                                                                                                    </span>
<span class="-6996782978604961637" onmouseenter="enter('-6996782978604961637');" onmouseout="out('-6996782978604961637');" style=""> 310          return isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)                       </span>
<span class="4824114787736852304" onmouseenter="enter('4824114787736852304');" onmouseout="out('4824114787736852304');" style=""> 311                  &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312      }                                                                                                             </span>
<span  style=""> 313                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 314      /**                                                                                                           </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 315       * Restore launcher configuration from the restored data stream.                                              </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 316       * It assumes that the keys will arrive in lexical order. So if the journal was present in the                </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 317       * backup, it should arrive first.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 318       *                                                                                                            </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 319       * @param data the key/value pair from the server                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 320       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 321      @Override                                                                                                     </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 322      public void restoreEntity(BackupDataInputStream data) {                                                       </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 323          if (!restoreSuccessful) {                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 324              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +                                                                                                                  </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +        if (mDeviceProfileData == null) {                                                                         </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +            // This call does not happen on a looper thread. So LauncherAppState                                  </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +            // can&#x27;t be created . Instead initialize required dependencies directly.                              </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +            mIdp = new InvariantDeviceProfile(mContext);                                                          </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +            mDeviceProfileData = initDeviceProfileData(mIdp);                                                     </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +            mIconCache = new IconCache(mContext, mIdp);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333          }                                                                                                         </span>
<span  style=""> 334                                                                                                                    </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 335          int dataSize = data.size();                                                                               </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 336          if (mBuffer.length &lt; dataSize) {                                                                          </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 337              mBuffer = new byte[dataSize];                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 339          try {                                                                                                     </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 340              int bytesRead = data.read(mBuffer, 0, dataSize);                                                      </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 341              if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);                        </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 342              String backupKey = data.getKey();                                                                     </span>
<span  style=""> 343                                                                                                                    </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 344              if (JOURNAL_KEY.equals(backupKey)) {                                                                  </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 345                  if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                                </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 346                  if (!mKeys.isEmpty()) {                                                                           </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 347                      // We received the journal key after a restore key.                                           </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 348                      Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);                </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 349                      restoreSuccessful = false;                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 350                      return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351                  }                                                                                                 </span>
<span  style=""> 352                                                                                                                    </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 353                  Journal journal = new Journal();                                                                  </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 354                  MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                              </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 355                  applyJournal(journal);                                                                            </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 356                  restoreSuccessful = isBackupCompatible(journal);                                                  </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 357 -                restoredBackupVersion = journal.backupVersion;                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 358                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359              }                                                                                                     </span>
<span  style=""> 360                                                                                                                    </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 361              if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                                 </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 362                  if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 363                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364              }                                                                                                     </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 365              Key key = backupKeyToKey(backupKey);                                                                  </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 366              mKeys.add(key);                                                                                       </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 367              switch (key.type) {                                                                                   </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 368                  case Key.FAVORITE:                                                                                </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 369                      restoreFavorite(key, mBuffer, dataSize);                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 370                      break;                                                                                        </span>
<span  style=""> 371                                                                                                                    </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 372                  case Key.SCREEN:                                                                                  </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 373                      restoreScreen(key, mBuffer, dataSize);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 374                      break;                                                                                        </span>
<span  style=""> 375                                                                                                                    </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 376                  case Key.ICON:                                                                                    </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 377                      restoreIcon(key, mBuffer, dataSize);                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 378                      break;                                                                                        </span>
<span  style=""> 379                                                                                                                    </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 380                  case Key.WIDGET:                                                                                  </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 381                      restoreWidget(key, mBuffer, dataSize);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 382                      break;                                                                                        </span>
<span  style=""> 383                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 384                  default:                                                                                          </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 385                      Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                                       </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 386                      mKeys.remove(key);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 387                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 389          } catch (IOException e) {                                                                                 </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 390              Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392      }                                                                                                             </span>
<span  style=""> 393                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 394      /**                                                                                                           </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 395       * Record the restore state for the next backup.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 396       *                                                                                                            </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 397       * @param newState notes about the backup state after restore.                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 398       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 399      @Override                                                                                                     </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 400      public void writeNewStateDescription(ParcelFileDescriptor newState) {                                         </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 401          writeJournal(newState, getCurrentStateJournal());                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402      }                                                                                                             </span>
<span  style=""> 403                                                                                                                    </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 404      private Journal getCurrentStateJournal() {                                                                    </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 405          Journal journal = new Journal();                                                                          </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 406          journal.t = mLastBackupRestoreTime;                                                                       </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 407          journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                          </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 408          journal.appVersion = getAppVersion();                                                                     </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 409          journal.backupVersion = BACKUP_VERSION;                                                                   </span>
<span class="-6030934345780896454" onmouseenter="enter('-6030934345780896454');" onmouseout="out('-6030934345780896454');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -        journal.profile = getDeviceProfieData();                                                                  </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +        journal.profile = mDeviceProfileData;                                                                     </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 412          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413      }                                                                                                             </span>
<span  style=""> 414                                                                                                                    </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 415      private int getAppVersion() {                                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 416          try {                                                                                                     </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 417              return mContext.getPackageManager()                                                                   </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 418                      .getPackageInfo(mContext.getPackageName(), 0).versionCode;                                    </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 419          } catch (NameNotFoundException e) {                                                                       </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 420              return 0;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422      }                                                                                                             </span>
<span  style=""> 423                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 424 -    /**                                                                                                           </span>
<span class="-4501492075935595010" onmouseenter="enter('-4501492075935595010');" onmouseout="out('-4501492075935595010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 425 -     * @return the current device profile information.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 426 -     */                                                                                                           </span>
<span class="4124629983355258626" onmouseenter="enter('4124629983355258626');" onmouseout="out('4124629983355258626');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 427 -    private DeviceProfieData getDeviceProfieData() {                                                              </span>
<span class="-7376286606070162099" onmouseenter="enter('-7376286606070162099');" onmouseout="out('-7376286606070162099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 428 -        if (mCurrentProfile != null) {                                                                            </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 429 -            return mCurrentProfile;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 430 -        }                                                                                                         </span>
<span class="-5497719505817004004" onmouseenter="enter('-5497719505817004004');" onmouseout="out('-5497719505817004004');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 431 -        final Context applicationContext = mContext.getApplicationContext();                                      </span>
<span class="7980813194196555392" onmouseenter="enter('7980813194196555392');" onmouseout="out('7980813194196555392');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 432 -        DeviceProfile profile = LauncherAppState.createDynamicGrid(applicationContext, null)                      </span>
<span class="-5938220650159761744" onmouseenter="enter('-5938220650159761744');" onmouseout="out('-5938220650159761744');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 433 -                .getDeviceProfile();                                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 434 -                                                                                                                  </span>
<span class="-8088032308844031335" onmouseenter="enter('-8088032308844031335');" onmouseout="out('-8088032308844031335');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 435 -        mCurrentProfile = new DeviceProfieData();                                                                 </span>
<span class="7442338639987606524" onmouseenter="enter('7442338639987606524');" onmouseout="out('7442338639987606524');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 436 -        mCurrentProfile.desktopRows = profile.numRows;                                                            </span>
<span class="-4500555851720273514" onmouseenter="enter('-4500555851720273514');" onmouseout="out('-4500555851720273514');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 437 -        mCurrentProfile.desktopCols = profile.numColumns;                                                         </span>
<span class="-3431910476829522829" onmouseenter="enter('-3431910476829522829');" onmouseout="out('-3431910476829522829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 438 -        mCurrentProfile.hotseatCount = profile.numHotseatIcons;                                                   </span>
<span class="1465841957362210064" onmouseenter="enter('1465841957362210064');" onmouseout="out('1465841957362210064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 439 -        mCurrentProfile.allappsRank = profile.hotseatAllAppsRank;                                                 </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 440 -        return mCurrentProfile;                                                                                   </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 441 +    private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                              </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 442 +        DeviceProfieData data = new DeviceProfieData();                                                           </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 443 +        data.desktopRows = profile.numRows;                                                                       </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 444 +        data.desktopCols = profile.numColumns;                                                                    </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 445 +        data.hotseatCount = profile.numHotseatIcons;                                                              </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 446 +        data.allappsRank = profile.hotseatAllAppsRank;                                                            </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 447 +        return data;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448      }                                                                                                             </span>
<span  style=""> 449                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 450      /**                                                                                                           </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 451       * Write all modified favorites to the data stream.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 452       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 453       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 454       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 455       */                                                                                                           </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 456      private void backupFavorites(BackupDataOutput data) throws IOException {                                      </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 457          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 458          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 459          // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 460          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 461                  getUserSelectionArg(), null, null);                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 462          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 463              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 464              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 465                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 466                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 467                  Key key = getKey(Key.FAVORITE, id);                                                               </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 468                  mKeys.add(key);                                                                                   </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 469                  final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 470                  if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {                 </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 471                      writeRowToBackup(key, packFavorite(cursor), data);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 472                  } else {                                                                                          </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 473                      if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 476          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 477              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479      }                                                                                                             </span>
<span  style=""> 480                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 481      /**                                                                                                           </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 482       * Read a favorite from the stream.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 483       *                                                                                                            </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 484       * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 485       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 486       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 487       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 488       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 489       */                                                                                                           </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 490      private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {                       </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 491          if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                                  </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 492          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 493                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 494                                                                                                                    </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 495          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 496          ContentValues values = unpackFavorite(buffer, dataSize);                                                  </span>
<span class="-1772646669374892986" onmouseenter="enter('-1772646669374892986');" onmouseout="out('-1772646669374892986');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 497 -        cr.insert(Favorites.CONTENT_URI_NO_NOTIFICATION, values);                                                 </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 498 +        cr.insert(Favorites.CONTENT_URI, values);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499      }                                                                                                             </span>
<span  style=""> 500                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 501      /**                                                                                                           </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 502       * Write all modified screens to the data stream.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 503       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 504       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 505       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 506       */                                                                                                           </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 507      private void backupScreens(BackupDataOutput data) throws IOException {                                        </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 508          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 509          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 510          Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                                 </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 511                  null, null, null);                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 512          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 513              cursor.moveToPosition(-1);                                                                            </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 514              if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 515              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 516                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 517                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 518                  Key key = getKey(Key.SCREEN, id);                                                                 </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 519                  mKeys.add(key);                                                                                   </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 520                  final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 521                  if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {                 </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 522                      writeRowToBackup(key, packScreen(cursor), data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 523                  } else {                                                                                          </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 524                      if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 527          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 528              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530      }                                                                                                             </span>
<span  style=""> 531                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 532      /**                                                                                                           </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 533       * Read a screen from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 534       *                                                                                                            </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 535       * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 536       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 537       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 538       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 539       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 540       */                                                                                                           </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 541      private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                         </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 542          if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 543          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 544                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 545                                                                                                                    </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 546          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 547          ContentValues values = unpackScreen(buffer, dataSize);                                                    </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 548          cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549      }                                                                                                             </span>
<span  style=""> 550                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 551      /**                                                                                                           </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 552       * Write all the static icon resources we need to render placeholders                                         </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 553       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 554       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 555       * @param data output stream for key/value pairs                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 556       */                                                                                                           </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 557      private void backupIcons(BackupDataOutput data) throws IOException {                                          </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 558          // persist icons that haven&#x27;t been persisted yet                                                          </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 559 -        if (!initializeIconCache()) {                                                                             </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 560 -            dataChanged(); // try again later                                                                     </span>
<span class="-8112704428397532174" onmouseenter="enter('-8112704428397532174');" onmouseout="out('-8112704428397532174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 561 -            if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 562 -            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 563 -        }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 564          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 565          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 566          final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                    </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 567          int backupUpIconCount = 0;                                                                                </span>
<span  style=""> 568                                                                                                                    </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 569          // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 570          String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +               </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 571                  Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                             </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 572                  getUserSelectionArg();                                                                            </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 573          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 574                  where, null, null);                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 575          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 576              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 577              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 578                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 579                  final String intentDescription = cursor.getString(INTENT_INDEX);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 580                  try {                                                                                             </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 581                      Intent intent = Intent.parseUri(intentDescription, 0);                                        </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 582                      ComponentName cn = intent.getComponent();                                                     </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 583                      Key key = null;                                                                               </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 584                      String backupKey = null;                                                                      </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 585                      if (cn != null) {                                                                             </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 586                          key = getKey(Key.ICON, cn.flattenToShortString());                                        </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 587                          backupKey = keyToBackupKey(key);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 588                      } else {                                                                                      </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 589                          Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590                      }                                                                                             </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 591                      if (mExistingKeys.contains(backupKey)) {                                                      </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 592                          if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                                 </span>
<span  style=""> 593                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 594                          // remember that we already backed this up previously                                     </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 595                          mKeys.add(key);                                                                           </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 596                      } else if (backupKey != null) {                                                               </span>
<span class="-6310531343064499436" onmouseenter="enter('-6310531343064499436');" onmouseout="out('-6310531343064499436');" style=""> 597                          if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);                     </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 598                          if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                             </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 599                              if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                                    </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 600                              Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                               </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 601                              if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {                  </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 602                                  writeRowToBackup(key, packIcon(dpi, icon), data);                                 </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 603                                  mKeys.add(key);                                                                   </span>
<span class="5377719919294214367" onmouseenter="enter('5377719919294214367');" onmouseout="out('5377719919294214367');" style=""> 604                                  backupUpIconCount ++;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605                              }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 606                          } else {                                                                                  </span>
<span class="4246955911601526686" onmouseenter="enter('4246955911601526686');" onmouseout="out('4246955911601526686');" style=""> 607                              if (VERBOSE) Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);                        </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 608                              // too many icons for this pass, request another.                                     </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 609                              dataChanged();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 611                      }                                                                                             </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 612                  } catch (URISyntaxException e) {                                                                  </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 613                      Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 614                  } catch (IOException e) {                                                                         </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 615                      Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616                  }                                                                                                 </span>
<span  style=""> 617                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 619          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 620              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622      }                                                                                                             </span>
<span  style=""> 623                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 624      /**                                                                                                           </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 625       * Read an icon from the stream.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 626       *                                                                                                            </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 627       * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 628       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 629       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 630       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 631       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 632       */                                                                                                           </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 633      private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                           </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 634          if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                      </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 635          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 636                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 637                                                                                                                    </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 638          Resource res = unpackProto(new Resource(), buffer, dataSize);                                             </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 639          if (DEBUG) {                                                                                              </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 640              Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 641          }                                                                                                         </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 642          Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                                </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 643          if (icon == null) {                                                                                       </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 644              Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645          }                                                                                                         </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 646          if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                          </span>
<span class="-6103588571021946959" onmouseenter="enter('-6103588571021946959');" onmouseout="out('-6103588571021946959');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 647 -        IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name), icon, res.dpi);              </span>
<span class="-1593325621603386304" onmouseenter="enter('-1593325621603386304');" onmouseout="out('-1593325621603386304');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 648 +        mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi,                        </span>
<span class="406035679709329885" onmouseenter="enter('406035679709329885');" onmouseout="out('406035679709329885');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 649 +                &quot;&quot; /* label */, mUserSerial);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 650      }                                                                                                             </span>
<span  style=""> 651                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 652      /**                                                                                                           </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 653       * Write all the static widget resources we need to render placeholders                                       </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 654       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 655       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 656       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 657       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 658       */                                                                                                           </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 659      private void backupWidgets(BackupDataOutput data) throws IOException {                                        </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 660          // persist static widget info that hasn&#x27;t been persisted yet                                              </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 661 -        final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="3171498958920755873" onmouseenter="enter('3171498958920755873');" onmouseout="out('3171498958920755873');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 662 -        if (appState == null || !initializeIconCache()) {                                                         </span>
<span class="-8001735677136208699" onmouseenter="enter('-8001735677136208699');" onmouseout="out('-8001735677136208699');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 663 -            Log.w(TAG, &quot;Failed to get icon cache during restore&quot;);                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 664 -            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 665 -        }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 666          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 667 -        final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                              </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 668 -        final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 669          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 670 -        final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                               </span>
<span class="8742319267076301489" onmouseenter="enter('8742319267076301489');" onmouseout="out('8742319267076301489');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 671 -        if (DEBUG) Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                             </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 672          int backupWidgetCount = 0;                                                                                </span>
<span  style=""> 673                                                                                                                    </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 674          String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;                        </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 675                  + getUserSelectionArg();                                                                          </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 676          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 677                  where, null, null);                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 678          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 679              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 680              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 681                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 682                  final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                           </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 683 -                final int spanX = cursor.getInt(SPANX_INDEX);                                                     </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 684 -                final int spanY = cursor.getInt(SPANY_INDEX);                                                     </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 685                  final ComponentName provider = ComponentName.unflattenFromString(providerName);                   </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 686                  Key key = null;                                                                                   </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 687                  String backupKey = null;                                                                          </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 688                  if (provider != null) {                                                                           </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 689                      key = getKey(Key.WIDGET, providerName);                                                       </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 690                      backupKey = keyToBackupKey(key);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 691                  } else {                                                                                          </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 692                      Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693                  }                                                                                                 </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 694 -                if (mExistingKeys.contains(backupKey)) {                                                          </span>
<span class="7478848681639332606" onmouseenter="enter('7478848681639332606');" onmouseout="out('7478848681639332606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 695 +                if (mExistingKeys.contains(backupKey) &amp;&amp; restoredBackupVersion &gt;= BACKUP_VERSION) {               </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 696                      if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                                   </span>
<span  style=""> 697                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 698                      // remember that we already backed this up previously                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 699                      mKeys.add(key);                                                                               </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 700                  } else if (backupKey != null) {                                                                   </span>
<span class="-6588785262075303708" onmouseenter="enter('-6588785262075303708');" onmouseout="out('-6588785262075303708');" style=""> 701                      if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                         </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 702                      if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                               </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 703                          if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                                      </span>
<span class="5731902488844945769" onmouseenter="enter('5731902488844945769');" onmouseout="out('5731902488844945769');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 704 -                        previewLoader.setPreviewSize(spanX * profile.cellWidthPx,                                 </span>
<span class="4335834404207041696" onmouseenter="enter('4335834404207041696');" onmouseout="out('4335834404207041696');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 705 -                                spanY * profile.cellHeightPx, widgetSpacingLayout);                               </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 706                          UserHandleCompat user = UserHandleCompat.myUserHandle();                                  </span>
<span class="2806251153376750688" onmouseenter="enter('2806251153376750688');" onmouseout="out('2806251153376750688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 707 -                        writeRowToBackup(key,                                                                     </span>
<span class="1049894294073861081" onmouseenter="enter('1049894294073861081');" onmouseout="out('1049894294073861081');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 708 -                                packWidget(dpi, previewLoader, mIconCache, provider, user),                       </span>
<span class="2995666273282439458" onmouseenter="enter('2995666273282439458');" onmouseout="out('2995666273282439458');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 709 -                                data);                                                                            </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 710 +                        writeRowToBackup(key, packWidget(dpi, provider, user), data);                             </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 711                          mKeys.add(key);                                                                           </span>
<span class="945813103637646770" onmouseenter="enter('945813103637646770');" onmouseout="out('945813103637646770');" style=""> 712                          backupWidgetCount ++;                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 713                      } else {                                                                                      </span>
<span class="5790411094184621928" onmouseenter="enter('5790411094184621928');" onmouseout="out('5790411094184621928');" style=""> 714                          if (VERBOSE) Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                          </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 715                          // too many widgets for this pass, request another.                                       </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 716                          dataChanged();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 720          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 721              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 722          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723      }                                                                                                             </span>
<span  style=""> 724                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 725      /**                                                                                                           </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 726       * Read a widget from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 727       *                                                                                                            </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 728       * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 729       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 730       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 731       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 732       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 733       */                                                                                                           </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 734      private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                         </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 735          if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 736          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 737                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 738          Widget widget = unpackProto(new Widget(), buffer, dataSize);                                              </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 739          if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                                     </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 740          if (widget.icon.data != null)  {                                                                          </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 741              Bitmap icon = BitmapFactory                                                                           </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 742                      .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                               </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 743              if (icon == null) {                                                                                   </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 744                  Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 745              } else {                                                                                              </span>
<span class="-5118804049175440922" onmouseenter="enter('-5118804049175440922');" onmouseout="out('-5118804049175440922');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 746 -                IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider),               </span>
<span class="-4542677240226290463" onmouseenter="enter('-4542677240226290463');" onmouseout="out('-4542677240226290463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 747 -                        icon, widget.icon.dpi);                                                                   </span>
<span class="4162878957742609395" onmouseenter="enter('4162878957742609395');" onmouseout="out('4162878957742609395');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 748 +                mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider),                        </span>
<span class="3902851904278031906" onmouseenter="enter('3902851904278031906');" onmouseout="out('3902851904278031906');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 749 +                        icon, widget.icon.dpi, widget.label, mUserSerial);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751          }                                                                                                         </span>
<span  style=""> 752                                                                                                                    </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 753          // future site of widget table mutation                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 754      }                                                                                                             </span>
<span  style=""> 755                                                                                                                    </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 756      /** create a new key, with an integer ID.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 757       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 758       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 759       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 760       */                                                                                                           </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 761      private Key getKey(int type, long id) {                                                                       </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 762          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 763          key.type = type;                                                                                          </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 764          key.id = id;                                                                                              </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 765          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 766          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767      }                                                                                                             </span>
<span  style=""> 768                                                                                                                    </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 769      /** create a new key for a named object.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 770       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 771       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 772       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 773       */                                                                                                           </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 774      private Key getKey(int type, String name) {                                                                   </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 775          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 776          key.type = type;                                                                                          </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 777          key.name = name;                                                                                          </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 778          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 779          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780      }                                                                                                             </span>
<span  style=""> 781                                                                                                                    </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 782      /** keys need to be strings, serialize and encode. */                                                         </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 783      private String keyToBackupKey(Key key) {                                                                      </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 784          return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785      }                                                                                                             </span>
<span  style=""> 786                                                                                                                    </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 787      /** keys need to be strings, decode and parse. */                                                             </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 788      private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 789          try {                                                                                                     </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 790              Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                                    </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 791              if (key.checksum != checkKey(key)) {                                                                  </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 792                  key = null;                                                                                       </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 793                  throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794              }                                                                                                     </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 795              return key;                                                                                           </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 796          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 797              throw new InvalidBackupException(e);                                                                  </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 798          } catch (IllegalArgumentException e) {                                                                    </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 799              throw new InvalidBackupException(e);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801      }                                                                                                             </span>
<span  style=""> 802                                                                                                                    </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 803      /** Compute the checksum over the important bits of a key. */                                                 </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 804      private long checkKey(Key key) {                                                                              </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 805          CRC32 checksum = new CRC32();                                                                             </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 806          checksum.update(key.type);                                                                                </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 807          checksum.update((int) (key.id &amp; 0xffff));                                                                 </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 808          checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                         </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 809          if (!TextUtils.isEmpty(key.name)) {                                                                       </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 810              checksum.update(key.name.getBytes());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811          }                                                                                                         </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 812          return checksum.getValue();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 813 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 814 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 815 +    /**                                                                                                           </span>
<span class="-7741701430317985923" onmouseenter="enter('-7741701430317985923');" onmouseout="out('-7741701430317985923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 816 +     * @return true if its an hotseat item, that can be replaced during restore.                                  </span>
<span class="6416967335754747262" onmouseenter="enter('6416967335754747262');" onmouseout="out('6416967335754747262');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 817 +     * TODO: Extend check for folders in hotseat.                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 818 +     */                                                                                                           </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 819 +    private boolean isReplaceableHotseatItem(Favorite favorite) {                                                 </span>
<span class="604075697947552793" onmouseenter="enter('604075697947552793');" onmouseout="out('604075697947552793');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 820 +        return favorite.container == Favorites.CONTAINER_HOTSEAT                                                  </span>
<span class="6256768192304850763" onmouseenter="enter('6256768192304850763');" onmouseout="out('6256768192304850763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 821 +                &amp;&amp; favorite.intent != null                                                                        </span>
<span class="-434659868641842414" onmouseenter="enter('-434659868641842414');" onmouseout="out('-434659868641842414');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 822 +                &amp;&amp; (favorite.itemType == Favorites.ITEM_TYPE_APPLICATION                                          </span>
<span class="5423532842312973304" onmouseenter="enter('5423532842312973304');" onmouseout="out('5423532842312973304');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 823 +                || favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824      }                                                                                                             </span>
<span  style=""> 825                                                                                                                    </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 826      /** Serialize a Favorite for persistence, including a checksum wrapper. */                                    </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 827      private Favorite packFavorite(Cursor c) {                                                                     </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 828          Favorite favorite = new Favorite();                                                                       </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 829          favorite.id = c.getLong(ID_INDEX);                                                                        </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 830          favorite.screen = c.getInt(SCREEN_INDEX);                                                                 </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 831          favorite.container = c.getInt(CONTAINER_INDEX);                                                           </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 832          favorite.cellX = c.getInt(CELLX_INDEX);                                                                   </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 833          favorite.cellY = c.getInt(CELLY_INDEX);                                                                   </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 834          favorite.spanX = c.getInt(SPANX_INDEX);                                                                   </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 835          favorite.spanY = c.getInt(SPANY_INDEX);                                                                   </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 836          favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                            </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 837 -        if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 838 -            String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                                 </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 839 -            if (!TextUtils.isEmpty(iconPackage)) {                                                                </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 840 -                favorite.iconPackage = iconPackage;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 841 -            }                                                                                                     </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 842 -            String iconResource = c.getString(ICON_RESOURCE_INDEX);                                               </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 843 -            if (!TextUtils.isEmpty(iconResource)) {                                                               </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 844 -                favorite.iconResource = iconResource;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 845 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 846 -        }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 847 -        if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 848 -            byte[] blob = c.getBlob(ICON_INDEX);                                                                  </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 849 -            if (blob != null &amp;&amp; blob.length &gt; 0) {                                                                </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 850 -                favorite.icon = blob;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 851 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 852 -        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 853 +                                                                                                                  </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 854          String title = c.getString(TITLE_INDEX);                                                                  </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 855          if (!TextUtils.isEmpty(title)) {                                                                          </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 856              favorite.title = title;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 857          }                                                                                                         </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 858          String intentDescription = c.getString(INTENT_INDEX);                                                     </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 859 +        Intent intent = null;                                                                                     </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 860          if (!TextUtils.isEmpty(intentDescription)) {                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 861              try {                                                                                                 </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 862 -                Intent intent = Intent.parseUri(intentDescription, 0);                                            </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 863 +                intent = Intent.parseUri(intentDescription, 0);                                                   </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 864                  intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                                       </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 865                  favorite.intent = intent.toUri(0);                                                                </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 866              } catch (URISyntaxException e) {                                                                      </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 867                  Log.e(TAG, &quot;Invalid intent&quot;, e);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869          }                                                                                                         </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 870          favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                            </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 871          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 872              favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                                  </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 873              String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                                     </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 874              if (!TextUtils.isEmpty(appWidgetProvider)) {                                                          </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 875                  favorite.appWidgetProvider = appWidgetProvider;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876              }                                                                                                     </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 877 +        } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                           </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 878 +            if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                              </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 879 +                String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                             </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 880 +                if (!TextUtils.isEmpty(iconPackage)) {                                                            </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 881 +                    favorite.iconPackage = iconPackage;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 882 +                }                                                                                                 </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 883 +                String iconResource = c.getString(ICON_RESOURCE_INDEX);                                           </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 884 +                if (!TextUtils.isEmpty(iconResource)) {                                                           </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 885 +                    favorite.iconResource = iconResource;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 886 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 887 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 888 +                                                                                                                  </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 889 +            byte[] blob = c.getBlob(ICON_INDEX);                                                                  </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 890 +            if (blob != null &amp;&amp; blob.length &gt; 0) {                                                                </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 891 +                favorite.icon = blob;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 892 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 893 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 894 +                                                                                                                  </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 895 +        if (isReplaceableHotseatItem(favorite)) {                                                                 </span>
<span class="1125417031607979515" onmouseenter="enter('1125417031607979515');" onmouseout="out('1125417031607979515');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 896 +            if (intent != null &amp;&amp; intent.getComponent() != null) {                                                </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 897 +                PackageManager pm = mContext.getPackageManager();                                                 </span>
<span class="1376604666851387224" onmouseenter="enter('1376604666851387224');" onmouseout="out('1376604666851387224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 898 +                ActivityInfo activity = null;;                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 899 +                try {                                                                                             </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 900 +                    activity = pm.getActivityInfo(intent.getComponent(), 0);                                      </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 901 +                } catch (NameNotFoundException e) {                                                               </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 902 +                    Log.e(TAG, &quot;Target not found&quot;, e);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 903 +                }                                                                                                 </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 904 +                if (activity == null) {                                                                           </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 905 +                    return favorite;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 906 +                }                                                                                                 </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 907 +                for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                              </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 908 +                    if (mItemTypeMatchers[i] == null) {                                                           </span>
<span class="2340950037759851004" onmouseenter="enter('2340950037759851004');" onmouseout="out('2340950037759851004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 909 +                        mItemTypeMatchers[i] = new ItemTypeMatcher(                                               </span>
<span class="8145000845780688523" onmouseenter="enter('8145000845780688523');" onmouseout="out('8145000845780688523');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 910 +                                CommonAppTypeParser.getResourceForItemType(i));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 911 +                    }                                                                                             </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 912 +                    if (mItemTypeMatchers[i].matches(activity, pm)) {                                             </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 913 +                        favorite.targetType = i;                                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 914 +                        break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 915 +                    }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 916 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 917 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 918          }                                                                                                         </span>
<span  style=""> 919                                                                                                                    </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 920          return favorite;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 921      }                                                                                                             </span>
<span  style=""> 922                                                                                                                    </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 923      /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                             </span>
<span class="-5576008980985724481" onmouseenter="enter('-5576008980985724481');" onmouseout="out('-5576008980985724481');" style=""> 924      private ContentValues unpackFavorite(byte[] buffer, int dataSize)                                             </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 925              throws IOException {                                                                                  </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 926          Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 927 +                                                                                                                  </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 928          ContentValues values = new ContentValues();                                                               </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 929          values.put(Favorites._ID, favorite.id);                                                                   </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 930          values.put(Favorites.SCREEN, favorite.screen);                                                            </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 931          values.put(Favorites.CONTAINER, favorite.container);                                                      </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 932          values.put(Favorites.CELLX, favorite.cellX);                                                              </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 933          values.put(Favorites.CELLY, favorite.cellY);                                                              </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 934          values.put(Favorites.SPANX, favorite.spanX);                                                              </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 935          values.put(Favorites.SPANY, favorite.spanY);                                                              </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 936 -        values.put(Favorites.ICON_TYPE, favorite.iconType);                                                       </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 937 -        if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 938 -            values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                             </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 939 -            values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 940 -        }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 941 -        if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 942 +                                                                                                                  </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 943 +        if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                                  </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 944 +            values.put(Favorites.ICON_TYPE, favorite.iconType);                                                   </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 945 +            if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                              </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 946 +                values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                         </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 947 +                values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 948 +            }                                                                                                     </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 949              values.put(Favorites.ICON, favorite.icon);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 950          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 951 +                                                                                                                  </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 952          if (!TextUtils.isEmpty(favorite.title)) {                                                                 </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 953              values.put(Favorites.TITLE, favorite.title);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 954          } else {                                                                                                  </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 955              values.put(Favorites.TITLE, &quot;&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 956          }                                                                                                         </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 957          if (!TextUtils.isEmpty(favorite.intent)) {                                                                </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 958              values.put(Favorites.INTENT, favorite.intent);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 959          }                                                                                                         </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 960          values.put(Favorites.ITEM_TYPE, favorite.itemType);                                                       </span>
<span  style=""> 961                                                                                                                    </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 962          UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                          </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style=""> 963          long userSerialNumber =                                                                                   </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style=""> 964                  UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);                     </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 965          values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                                      </span>
<span  style=""> 966                                                                                                                    </span>
<span class="6840222601736111479" onmouseenter="enter('6840222601736111479');" onmouseout="out('6840222601736111479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 967 -        DeviceProfieData currentProfile = getDeviceProfieData();                                                  </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 968 +        DeviceProfieData currentProfile = mDeviceProfileData;                                                     </span>
<span  style=""> 969                                                                                                                    </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 970          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 971              if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                                 </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 972                  values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 973              }                                                                                                     </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 974              values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                             </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 975              values.put(LauncherSettings.Favorites.RESTORED,                                                       </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style=""> 976                      LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                                     </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style=""> 977                      LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                               </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style=""> 978                      LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                                     </span>
<span  style=""> 979                                                                                                                    </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 980              // Verify placement                                                                                   </span>
<span class="-7553882590673737344" onmouseenter="enter('-7553882590673737344');" onmouseout="out('-7553882590673737344');" style=""> 981              if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols)                                  </span>
<span class="1436175124930418764" onmouseenter="enter('1436175124930418764');" onmouseout="out('1436175124930418764');" style=""> 982                      || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {                        </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 983                  restoreSuccessful = false;                                                                        </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style=""> 984                  throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 985              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 986          } else {                                                                                                  </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 987 -            // Let LauncherModel know we&#x27;ve been here.                                                            </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 988 -            values.put(LauncherSettings.Favorites.RESTORED, 1);                                                   </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 989 +            // Check if it is an hotseat item, that can be replaced.                                              </span>
<span class="5088947528875964657" onmouseenter="enter('5088947528875964657');" onmouseout="out('5088947528875964657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 990 +            if (isReplaceableHotseatItem(favorite)                                                                </span>
<span class="-3804650287411139588" onmouseenter="enter('-3804650287411139588');" onmouseout="out('-3804650287411139588');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 991 +                    &amp;&amp; favorite.targetType != Favorite.TARGET_NONE                                                </span>
<span class="3747219331600099018" onmouseenter="enter('3747219331600099018');" onmouseout="out('3747219331600099018');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 992 +                    &amp;&amp; favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT) {                          </span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 993 +                Log.e(TAG, &quot;Added item type flag&quot;);                                                               </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 994 +                values.put(LauncherSettings.Favorites.RESTORED,                                                   </span>
<span class="-5769863763985510613" onmouseenter="enter('-5769863763985510613');" onmouseout="out('-5769863763985510613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 995 +                        1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 996 +            } else {                                                                                              </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 997 +                // Let LauncherModel know we&#x27;ve been here.                                                        </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 998 +                values.put(LauncherSettings.Favorites.RESTORED, 1);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 999 +            }                                                                                                     </span>
<span  style="">1000                                                                                                                    </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style="">1001              // Verify placement                                                                                   </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style="">1002              if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                              </span>
<span class="3850618212667286309" onmouseenter="enter('3850618212667286309');" onmouseout="out('3850618212667286309');" style="">1003                  if ((favorite.screen &gt;= currentProfile.hotseatCount)                                              </span>
<span class="-2927406358945708190" onmouseenter="enter('-2927406358945708190');" onmouseout="out('-2927406358945708190');" style="">1004                          || (favorite.screen == currentProfile.allappsRank)) {                                     </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1005                      restoreSuccessful = false;                                                                    </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style="">1006                      throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1007                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1008              } else {                                                                                              </span>
<span class="4635538835318305805" onmouseenter="enter('4635538835318305805');" onmouseout="out('4635538835318305805');" style="">1009                  if ((favorite.cellX &gt;= currentProfile.desktopCols)                                                </span>
<span class="-3183516951997115573" onmouseenter="enter('-3183516951997115573');" onmouseout="out('-3183516951997115573');" style="">1010                          || (favorite.cellY &gt;= currentProfile.desktopRows)) {                                      </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1011                      restoreSuccessful = false;                                                                    </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style="">1012                      throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1013                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1014              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1015          }                                                                                                         </span>
<span  style="">1016                                                                                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="">1017          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1018      }                                                                                                             </span>
<span  style="">1019                                                                                                                    </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style="">1020      /** Serialize a Screen for persistence, including a checksum wrapper. */                                      </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style="">1021      private Screen packScreen(Cursor c) {                                                                         </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style="">1022          Screen screen = new Screen();                                                                             </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style="">1023          screen.id = c.getLong(ID_INDEX);                                                                          </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style="">1024          screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                                </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style="">1025          return screen;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1026      }                                                                                                             </span>
<span  style="">1027                                                                                                                    </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style="">1028      /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                               </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style="">1029      private ContentValues unpackScreen(byte[] buffer, int dataSize)                                               </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1030              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style="">1031          Screen screen = unpackProto(new Screen(), buffer, dataSize);                                              </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style="">1032          ContentValues values = new ContentValues();                                                               </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style="">1033          values.put(WorkspaceScreens._ID, screen.id);                                                              </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style="">1034          values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="">1035          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1036      }                                                                                                             </span>
<span  style="">1037                                                                                                                    </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style="">1038      /** Serialize an icon Resource for persistence, including a checksum wrapper. */                              </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style="">1039      private Resource packIcon(int dpi, Bitmap icon) {                                                             </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style="">1040          Resource res = new Resource();                                                                            </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style="">1041          res.dpi = dpi;                                                                                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1042 -        ByteArrayOutputStream os = new ByteArrayOutputStream();                                                   </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1043 -        if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                         </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1044 -            res.data = os.toByteArray();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1045 -        }                                                                                                         </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1046 +        res.data = Utilities.flattenBitmap(icon);                                                                 </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style="">1047          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1048      }                                                                                                             </span>
<span  style="">1049                                                                                                                    </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style="">1050      /** Serialize a widget for persistence, including a checksum wrapper. */                                      </span>
<span class="122020410304176150" onmouseenter="enter('122020410304176150');" onmouseout="out('122020410304176150');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1051 -    private Widget packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,                    </span>
<span class="-9087206329152770867" onmouseenter="enter('-9087206329152770867');" onmouseout="out('-9087206329152770867');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1052 -            ComponentName provider, UserHandleCompat user) {                                                      </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1053 +    private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                           </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style="">1054          final LauncherAppWidgetProviderInfo info =                                                                </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style="">1055                  LauncherModel.getProviderInfo(mContext, provider, user);                                          </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1056          Widget widget = new Widget();                                                                             </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style="">1057          widget.provider = provider.flattenToShortString();                                                        </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="">1058          widget.label = info.label;                                                                                </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="">1059          widget.configure = info.configure != null;                                                                </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="">1060          if (info.icon != 0) {                                                                                     </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="">1061              widget.icon = new Resource();                                                                         </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1062 -            Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1063 +            Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);               </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="">1064              Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                                      </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1065 -            ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1066 -            if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                     </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1067 -                widget.icon.data = os.toByteArray();                                                              </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1068 -                widget.icon.dpi = dpi;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1069 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1070 -        }                                                                                                         </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1071 -        if (info.previewImage != 0) {                                                                             </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1072 -            widget.preview = new Resource();                                                                      </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1073 -            Bitmap preview = previewLoader.generateWidgetPreview(info, null);                                     </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1074 -            ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1075 -            if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                  </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1076 -                widget.preview.data = os.toByteArray();                                                           </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1077 -                widget.preview.dpi = dpi;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1078 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1079 -        }                                                                                                         </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1080 +            widget.icon.data = Utilities.flattenBitmap(icon);                                                     </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1081 +            widget.icon.dpi = dpi;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1082 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1083 +                                                                                                                  </span>
<span class="8268283353319641350" onmouseenter="enter('8268283353319641350');" onmouseout="out('8268283353319641350');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1084 +        // Calculate the spans corresponding to any one of the orientations as it should not change               </span>
<span class="-4559634212567806776" onmouseenter="enter('-4559634212567806776');" onmouseout="out('-4559634212567806776');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1085 +        // based on orientation.                                                                                  </span>
<span class="7159740594026618763" onmouseenter="enter('7159740594026618763');" onmouseout="out('7159740594026618763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1086 +        int[] minSpans = CellLayout.rectToCell(                                                                   </span>
<span class="-6534356822831926041" onmouseenter="enter('-6534356822831926041');" onmouseout="out('-6534356822831926041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1087 +                mIdp.portraitProfile, mContext, info.minResizeWidth, info.minResizeHeight, null);                 </span>
<span class="414947938502206869" onmouseenter="enter('414947938502206869');" onmouseout="out('414947938502206869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1088 +        widget.minSpanX = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0                </span>
<span class="3309711297405339686" onmouseenter="enter('3309711297405339686');" onmouseout="out('3309711297405339686');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1089 +                ? minSpans[0] : -1;                                                                               </span>
<span class="6449476295053203863" onmouseenter="enter('6449476295053203863');" onmouseout="out('6449476295053203863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1090 +        widget.minSpanY = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0                  </span>
<span class="8978476183120858231" onmouseenter="enter('8978476183120858231');" onmouseout="out('8978476183120858231');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1091 +                ? minSpans[1] : -1;                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1092 +                                                                                                                  </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1093          return widget;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1094      }                                                                                                             </span>
<span  style="">1095                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1096      /**                                                                                                           </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="">1097       * Deserialize a proto after verifying checksum wrapper.                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1098       */                                                                                                           </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="">1099      private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                           </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1100              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="">1101          MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                         </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="">1102          if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                         </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="">1103          return proto;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1104      }                                                                                                             </span>
<span  style="">1105                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1106      /**                                                                                                           </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1107       * Read the old journal from the input file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1108       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1109       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1110       * in that case, do a full backup.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1111       *                                                                                                            </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1112       * @param oldState the read-0only file descriptor pointing to the old journal                                 </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1113       * @return a Journal protocol buffer                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1114       */                                                                                                           </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1115      private Journal readJournal(ParcelFileDescriptor oldState) {                                                  </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1116          Journal journal = new Journal();                                                                          </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1117          if (oldState == null) {                                                                                   </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1118              return journal;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1119          }                                                                                                         </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1120          FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1121          try {                                                                                                     </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1122              int availableBytes = inStream.available();                                                            </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1123              if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                                 </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1124              if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                              </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1125                  byte[] buffer = new byte[availableBytes];                                                         </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1126                  int bytesRead = 0;                                                                                </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1127                  boolean valid = false;                                                                            </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1128                  InvalidProtocolBufferNanoException lastProtoException = null;                                     </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1129                  while (availableBytes &gt; 0) {                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1130                      try {                                                                                         </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1131                          // OMG what are you doing? This is crazy inefficient!                                     </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1132                          // If we read a byte that is not ours, we will cause trouble: b/12491813                  </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1133                          // However, we don&#x27;t know how many bytes to expect (oops).                                </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1134                          // So we have to step through *slowly*, watching for the end.                             </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1135                          int result = inStream.read(buffer, bytesRead, 1);                                         </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1136                          if (result &gt; 0) {                                                                         </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1137                              availableBytes -= result;                                                             </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1138                              bytesRead += result;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1139                          } else {                                                                                  </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1140                              Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                          </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1141                              // stop reading and see what there is to parse                                        </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1142                              availableBytes = 0;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1143                          }                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1144                      } catch (IOException e) {                                                                     </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1145                          buffer = null;                                                                            </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1146                          availableBytes = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1147                      }                                                                                             </span>
<span  style="">1148                                                                                                                    </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1149                      // check the buffer to see if we have a valid journal                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1150                      try {                                                                                         </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1151                          MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));                      </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1152                          // if we are here, then we have read a valid, checksum-verified journal                   </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1153                          valid = true;                                                                             </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1154                          availableBytes = 0;                                                                       </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1155                          if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);                       </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1156                      } catch (InvalidProtocolBufferNanoException e) {                                              </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1157                          // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.              </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1158                          lastProtoException = e;                                                                   </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1159                          journal.clear();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1160                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1161                  }                                                                                                 </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1162                  if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                                        </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1163                  if (!valid) {                                                                                     </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1164                      Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1165                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1166              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1167          } catch (IOException e) {                                                                                 </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1168              Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1169          } finally {                                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1170              try {                                                                                                 </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1171                  inStream.close();                                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1172              } catch (IOException e) {                                                                             </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1173                  Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1174              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1175          }                                                                                                         </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1176          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1177      }                                                                                                             </span>
<span  style="">1178                                                                                                                    </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1179      private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                              </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1180              throws IOException {                                                                                  </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1181          writeRowToBackup(keyToBackupKey(key), proto, data);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1182      }                                                                                                             </span>
<span  style="">1183                                                                                                                    </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1184      private void writeRowToBackup(String backupKey, MessageNano proto,                                            </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1185              BackupDataOutput data) throws IOException {                                                           </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1186          byte[] blob = writeCheckedBytes(proto);                                                                   </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1187          data.writeEntityHeader(backupKey, blob.length);                                                           </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1188          data.writeEntityData(blob, blob.length);                                                                  </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1189          mBackupDataWasUpdated = true;                                                                             </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1190          if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1191      }                                                                                                             </span>
<span  style="">1192                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1193      /**                                                                                                           </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1194       * Write the new journal to the output file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1195       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1196       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1197       * in that case, do a full backup.                                                                            </span>
<span  style="">1198                                                                                                                    </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1199       * @param newState the write-only file descriptor pointing to the new journal                                 </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1200       * @param journal a Journal protocol buffer                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1201       */                                                                                                           </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1202      private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                                   </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1203          FileOutputStream outStream = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1204          try {                                                                                                     </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1205              outStream = new FileOutputStream(newState.getFileDescriptor());                                       </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1206              final byte[] journalBytes = writeCheckedBytes(journal);                                               </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1207              outStream.write(journalBytes);                                                                        </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1208              outStream.close();                                                                                    </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1209              if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1210          } catch (IOException e) {                                                                                 </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1211              Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1212          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1213      }                                                                                                             </span>
<span  style="">1214                                                                                                                    </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1215      /** Wrap a proto in a CheckedMessage and compute the checksum. */                                             </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1216      private byte[] writeCheckedBytes(MessageNano proto) {                                                         </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1217          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1218          wrapper.payload = MessageNano.toByteArray(proto);                                                         </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1219          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1220          checksum.update(wrapper.payload);                                                                         </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1221          wrapper.checksum = checksum.getValue();                                                                   </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1222          return MessageNano.toByteArray(wrapper);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1223      }                                                                                                             </span>
<span  style="">1224                                                                                                                    </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1225      /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                                  </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1226      private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                           </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1227              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1228          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1229          MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                                      </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1230          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1231          checksum.update(wrapper.payload);                                                                         </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1232          if (wrapper.checksum != checksum.getValue()) {                                                            </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1233              throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1234          }                                                                                                         </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1235          return wrapper.payload;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1236      }                                                                                                             </span>
<span  style="">1237                                                                                                                    </span>
<span class="-3747865328185427292" onmouseenter="enter('-3747865328185427292');" onmouseout="out('-3747865328185427292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1238 -    private boolean initializeIconCache() {                                                                       </span>
<span class="786459695793008309" onmouseenter="enter('786459695793008309');" onmouseout="out('786459695793008309');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1239 -        if (mIconCache != null) {                                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1240 -            return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1241 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1242 -                                                                                                                  </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1243 -        final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1244 -        if (appState == null) {                                                                                   </span>
<span class="-1606020641700129220" onmouseenter="enter('-1606020641700129220');" onmouseout="out('-1606020641700129220');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1245 -            Throwable stackTrace = new Throwable();                                                               </span>
<span class="4026238654429205346" onmouseenter="enter('4026238654429205346');" onmouseout="out('4026238654429205346');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1246 -            stackTrace.fillInStackTrace();                                                                        </span>
<span class="3094768706025518149" onmouseenter="enter('3094768706025518149');" onmouseout="out('3094768706025518149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1247 -            Log.w(TAG, &quot;Failed to get app state during backup/restore&quot;, stackTrace);                              </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1248 -            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1249 -        }                                                                                                         </span>
<span class="5846627122202929436" onmouseenter="enter('5846627122202929436');" onmouseout="out('5846627122202929436');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1250 -        mIconCache = appState.getIconCache();                                                                     </span>
<span class="-110431678061537477" onmouseenter="enter('-110431678061537477');" onmouseout="out('-110431678061537477');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1251 -        return mIconCache != null;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1252 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1253 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1254 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1255      /**                                                                                                           </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1256       * @return true if the launcher is in a state to support backup                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1257       */                                                                                                           </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1258      private boolean launcherIsReady() {                                                                           </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1259          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1260          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);                   </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1261          if (cursor == null) {                                                                                     </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1262              // launcher data has been wiped, do nothing                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1263              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1264          }                                                                                                         </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1265          cursor.close();                                                                                           </span>
<span  style="">1266                                                                                                                    </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1267 -        if (!initializeIconCache()) {                                                                             </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1268 +        if (LauncherAppState.getInstanceNoCreate() == null) {                                                     </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1269              // launcher services are unavailable, try again later                                                 </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1270 -            dataChanged();                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1271              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1272          }                                                                                                         </span>
<span  style="">1273                                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1274          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1275      }                                                                                                             </span>
<span  style="">1276                                                                                                                    </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1277      private String getUserSelectionArg() {                                                                        </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1278          return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                               </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1279                  .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1280      }                                                                                                             </span>
<span  style="">1281                                                                                                                    </span>
<span class="2300443005706538875" onmouseenter="enter('2300443005706538875');" onmouseout="out('2300443005706538875');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1282 -    private class InvalidBackupException extends IOException {                                                    </span>
<span class="7118811970258264720" onmouseenter="enter('7118811970258264720');" onmouseout="out('7118811970258264720');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1283 -        private InvalidBackupException(Throwable cause) {                                                         </span>
<span class="-5176517881040090425" onmouseenter="enter('-5176517881040090425');" onmouseout="out('-5176517881040090425');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1284 +    @Thunk class InvalidBackupException extends IOException {                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1285 +                                                                                                                  </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1286 +        private static final long serialVersionUID = 8931456637211665082L;                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1287 +                                                                                                                  </span>
<span class="5112209169585560371" onmouseenter="enter('5112209169585560371');" onmouseout="out('5112209169585560371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1288 +        @Thunk InvalidBackupException(Throwable cause) {                                                          </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1289              super(cause);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1290          }                                                                                                         </span>
<span  style="">1291                                                                                                                    </span>
<span class="3383530736812522133" onmouseenter="enter('3383530736812522133');" onmouseout="out('3383530736812522133');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1292 -        public InvalidBackupException(String reason) {                                                            </span>
<span class="5097977583346831854" onmouseenter="enter('5097977583346831854');" onmouseout="out('5097977583346831854');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1293 +        @Thunk InvalidBackupException(String reason) {                                                            </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1294              super(reason);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1295          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1296      }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1297 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1298 +    /**                                                                                                           </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1299 +     * A class to check if an activity can handle one of the intents from a list of                               </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1300 +     * predefined intents.                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1301 +     */                                                                                                           </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1302 +    private class ItemTypeMatcher {                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1303 +                                                                                                                  </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1304 +        private final ArrayList&lt;Intent&gt; mIntents;                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1305 +                                                                                                                  </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1306 +        ItemTypeMatcher(int xml_res) {                                                                            </span>
<span class="-2300579919401902073" onmouseenter="enter('-2300579919401902073');" onmouseout="out('-2300579919401902073');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1307 +            mIntents = xml_res == 0 ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1308 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1309 +                                                                                                                  </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1310 +        private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                                     </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1311 +            ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                                  </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1312 +            XmlResourceParser parser = mContext.getResources().getXml(xml_res);                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1313 +            try {                                                                                                 </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1314 +                DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);                       </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1315 +                final int depth = parser.getDepth();                                                              </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1316 +                int type;                                                                                         </span>
<span class="-1784597901533800040" onmouseenter="enter('-1784597901533800040');" onmouseout="out('-1784597901533800040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1317 +                while (((type = parser.next()) != XmlPullParser.END_TAG ||                                        </span>
<span class="9136127903140816012" onmouseenter="enter('9136127903140816012');" onmouseout="out('9136127903140816012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1318 +                        parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) {                       </span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1319 +                    if (type != XmlPullParser.START_TAG) {                                                        </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1320 +                        continue;                                                                                 </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1321 +                    } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {                       </span>
<span class="-6398792714141510192" onmouseenter="enter('-6398792714141510192');" onmouseout="out('-6398792714141510192');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1322 +                        final String uri = DefaultLayoutParser.getAttributeValue(                                 </span>
<span class="-7436101632763202971" onmouseenter="enter('-7436101632763202971');" onmouseout="out('-7436101632763202971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1323 +                                parser, DefaultLayoutParser.ATTR_URI);                                            </span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1324 +                        intents.add(Intent.parseUri(uri, 0));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1325 +                    }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1326 +                }                                                                                                 </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1327 +            } catch (URISyntaxException | XmlPullParserException | IOException e) {                               </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1328 +                Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                                      </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1329 +            } finally {                                                                                           </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1330 +                parser.close();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1331 +            }                                                                                                     </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1332 +            return intents;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1333 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1334 +                                                                                                                  </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1335 +        public boolean matches(ActivityInfo activity, PackageManager pm) {                                        </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1336 +            for (Intent intent : mIntents) {                                                                      </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1337 +                intent.setPackage(activity.packageName);                                                          </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1338 +                ResolveInfo info = pm.resolveActivity(intent, 0);                                                 </span>
<span class="2104528236737597253" onmouseenter="enter('2104528236737597253');" onmouseout="out('2104528236737597253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1339 +                if (info != null &amp;&amp; (info.activityInfo.name.equals(activity.name)                                 </span>
<span class="1520043710369759480" onmouseenter="enter('1520043710369759480');" onmouseout="out('1520043710369759480');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1340 +                        || info.activityInfo.name.equals(activity.targetActivity))) {                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1341 +                    return true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1342 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1343 +            }                                                                                                     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1344 +            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1345 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1346 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1347  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2   * Copyright (C) 2013 The Android Open Source Project                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16  package com.android.launcher3;                                                                                    </span>
<span  style="">  17                                                                                                                    </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18  import android.app.backup.BackupDataInputStream;                                                                  </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19  import android.app.backup.BackupDataOutput;                                                                       </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20  import android.app.backup.BackupHelper;                                                                           </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21  import android.app.backup.BackupManager;                                                                          </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import android.appwidget.AppWidgetProviderInfo;                                                                   </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  23  import android.content.ComponentName;                                                                             </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  24  import android.content.ContentResolver;                                                                           </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  25  import android.content.ContentValues;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  26  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  27  import android.content.Intent;                                                                                    </span>


<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  28  import android.content.pm.PackageManager.NameNotFoundException;                                                   </span>


<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  29  import android.database.Cursor;                                                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  30  import android.graphics.Bitmap;                                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  31  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  32  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  33  import android.os.ParcelFileDescriptor;                                                                           </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  34  import android.text.TextUtils;                                                                                    </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  35  import android.util.Base64;                                                                                       </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  36  import android.util.Log;                                                                                          </span>
<span  style="">  37                                                                                                                    </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  38  import com.android.launcher3.LauncherSettings.Favorites;                                                          </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  39  import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                                   </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  40  import com.android.launcher3.backup.BackupProtos;                                                                 </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  41  import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                                  </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  42  import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                                </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  43  import com.android.launcher3.backup.BackupProtos.Favorite;                                                        </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  44  import com.android.launcher3.backup.BackupProtos.Journal;                                                         </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  45  import com.android.launcher3.backup.BackupProtos.Key;                                                             </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  46  import com.android.launcher3.backup.BackupProtos.Resource;                                                        </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  47  import com.android.launcher3.backup.BackupProtos.Screen;                                                          </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  48  import com.android.launcher3.backup.BackupProtos.Widget;                                                          </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  49  import com.android.launcher3.compat.UserHandleCompat;                                                             </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  50  import com.android.launcher3.compat.UserManagerCompat;                                                            </span>

<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  51  import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                               </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  52  import com.google.protobuf.nano.MessageNano;                                                                      </span>
<span  style="">  53                                                                                                                    </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  54  import java.io.ByteArrayOutputStream;                                                                             </span>



<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  55  import java.io.FileInputStream;                                                                                   </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  56  import java.io.FileOutputStream;                                                                                  </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  57  import java.io.IOException;                                                                                       </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  58  import java.net.URISyntaxException;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  59  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  60  import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  62  import java.util.HashSet;                                                                                         </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  63  import java.util.zip.CRC32;                                                                                       </span>
<span  style="">  64                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  65  /**                                                                                                               </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  66   * Persist the launcher home state across calamities.                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  67   */                                                                                                               </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  68  public class LauncherBackupHelper implements BackupHelper {                                                       </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  69      private static final String TAG = &quot;LauncherBackupHelper&quot;;                                                     </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  70      private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                                     </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  71      private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                         </span>
<span  style="">  72                                                                                                                    </span>
<span class="-1169906795921543870" onmouseenter="enter('-1169906795921543870');" onmouseout="out('-1169906795921543870');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -    private static final int BACKUP_VERSION = 2;                                                                  </span>
<span class="-984243926892874638" onmouseenter="enter('-984243926892874638');" onmouseout="out('-984243926892874638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +    private static final int BACKUP_VERSION = 3;                                                                  </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  75      private static final int MAX_JOURNAL_SIZE = 1000000;                                                          </span>
<span  style="">  76                                                                                                                    </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  77      // Journal key is such that it is always smaller than any dynamically generated                               </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  78      // key (any Base64 encoded string).                                                                           </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  79      private static final String JOURNAL_KEY = &quot;#&quot;;                                                                </span>
<span  style="">  80                                                                                                                    </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  81      /** icons are large, dribble them out */                                                                      </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  82      private static final int MAX_ICONS_PER_PASS = 10;                                                             </span>
<span  style="">  83                                                                                                                    </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  84      /** widgets contain previews, which are very large, dribble them out */                                       </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  85      private static final int MAX_WIDGETS_PER_PASS = 5;                                                            </span>
<span  style="">  86                                                                                                                    </span>
<span class="-1476094414441025702" onmouseenter="enter('-1476094414441025702');" onmouseout="out('-1476094414441025702');" style="">  87      private static final int IMAGE_COMPRESSION_QUALITY = 75;                                                      </span>
<span  style="">  88                                                                                                                    </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="">  89      private static final Bitmap.CompressFormat IMAGE_FORMAT =                                                     </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="">  90              android.graphics.Bitmap.CompressFormat.PNG;                                                           </span>
<span  style="">  91                                                                                                                    </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  92      private static final String[] FAVORITE_PROJECTION = {                                                         </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  93          Favorites._ID,                     // 0                                                                   </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  94          Favorites.MODIFIED,                // 1                                                                   </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  95          Favorites.INTENT,                  // 2                                                                   </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  96          Favorites.APPWIDGET_PROVIDER,      // 3                                                                   </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style="">  97          Favorites.APPWIDGET_ID,            // 4                                                                   </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style="">  98          Favorites.CELLX,                   // 5                                                                   </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style="">  99          Favorites.CELLY,                   // 6                                                                   </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 100          Favorites.CONTAINER,               // 7                                                                   </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 101          Favorites.ICON,                    // 8                                                                   </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 102          Favorites.ICON_PACKAGE,            // 9                                                                   </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 103          Favorites.ICON_RESOURCE,           // 10                                                                  </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 104          Favorites.ICON_TYPE,               // 11                                                                  </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 105          Favorites.ITEM_TYPE,               // 12                                                                  </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 106          Favorites.SCREEN,                  // 13                                                                  </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 107          Favorites.SPANX,                   // 14                                                                  </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 108          Favorites.SPANY,                   // 15                                                                  </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 109          Favorites.TITLE,                   // 16                                                                  </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 110          Favorites.PROFILE_ID,              // 17                                                                  </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 111      };                                                                                                            </span>
<span  style=""> 112                                                                                                                    </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 113      private static final int ID_INDEX = 0;                                                                        </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 114      private static final int ID_MODIFIED = 1;                                                                     </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 115      private static final int INTENT_INDEX = 2;                                                                    </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 116      private static final int APPWIDGET_PROVIDER_INDEX = 3;                                                        </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 117      private static final int APPWIDGET_ID_INDEX = 4;                                                              </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 118      private static final int CELLX_INDEX = 5;                                                                     </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 119      private static final int CELLY_INDEX = 6;                                                                     </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 120      private static final int CONTAINER_INDEX = 7;                                                                 </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 121      private static final int ICON_INDEX = 8;                                                                      </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 122      private static final int ICON_PACKAGE_INDEX = 9;                                                              </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 123      private static final int ICON_RESOURCE_INDEX = 10;                                                            </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 124      private static final int ICON_TYPE_INDEX = 11;                                                                </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 125      private static final int ITEM_TYPE_INDEX = 12;                                                                </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 126      private static final int SCREEN_INDEX = 13;                                                                   </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 127      private static final int SPANX_INDEX = 14;                                                                    </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 128      private static final int SPANY_INDEX = 15;                                                                    </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 129      private static final int TITLE_INDEX = 16;                                                                    </span>
<span  style=""> 130                                                                                                                    </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 131      private static final String[] SCREEN_PROJECTION = {                                                           </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 132          WorkspaceScreens._ID,              // 0                                                                   </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 133          WorkspaceScreens.MODIFIED,         // 1                                                                   </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 134          WorkspaceScreens.SCREEN_RANK       // 2                                                                   </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 135      };                                                                                                            </span>
<span  style=""> 136                                                                                                                    </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 137      private static final int SCREEN_RANK_INDEX = 2;                                                               </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 139      private final Context mContext;                                                                               </span>

<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 140      private final HashSet&lt;String&gt; mExistingKeys;                                                                  </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 141      private final ArrayList&lt;Key&gt; mKeys;                                                                           </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style=""> 143      private IconCache mIconCache;                                                                                 </span>



<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 144      private BackupManager mBackupManager;                                                                         </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 145      private byte[] mBuffer = new byte[512];                                                                       </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 146      private long mLastBackupRestoreTime;                                                                          </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 147      private boolean mBackupDataWasUpdated;                                                                        </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-6659096482642381235" onmouseenter="enter('-6659096482642381235');" onmouseout="out('-6659096482642381235');" style=""> 149      private DeviceProfieData mCurrentProfile;                                                                     </span>




<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 150      boolean restoreSuccessful;                                                                                    </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 151      int restoredBackupVersion = 1;                                                                                </span>
<span  style=""> 152                                                                                                                    </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 153      public LauncherBackupHelper(Context context) {                                                                </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 154          mContext = context;                                                                                       </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 155          mExistingKeys = new HashSet&lt;String&gt;();                                                                    </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 156          mKeys = new ArrayList&lt;Key&gt;();                                                                             </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 157          restoreSuccessful = true;                                                                                 </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158      }                                                                                                             </span>
<span  style=""> 159                                                                                                                    </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 160      private void dataChanged() {                                                                                  </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 161          if (mBackupManager == null) {                                                                             </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 162              mBackupManager = new BackupManager(mContext);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163          }                                                                                                         </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 164          mBackupManager.dataChanged();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165      }                                                                                                             </span>
<span  style=""> 166                                                                                                                    </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 167      private void applyJournal(Journal journal) {                                                                  </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 168          mLastBackupRestoreTime = journal.t;                                                                       </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 169          mExistingKeys.clear();                                                                                    </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 170          if (journal.key != null) {                                                                                </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 171              for (Key key : journal.key) {                                                                         </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 172                  mExistingKeys.add(keyToBackupKey(key));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174          }                                                                                                         </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +        restoredBackupVersion = journal.backupVersion;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176      }                                                                                                             </span>
<span  style=""> 177                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178      /**                                                                                                           </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 179       * Back up launcher data so we can restore the user&#x27;s state on a new device.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 180       *                                                                                                            </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 181       * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 182       *                                                                                                            </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 183       * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 184       *                                                                                                            </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 185       * @param oldState notes from the last backup                                                                 </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 186       * @param data incremental key/value pairs to persist off-device                                              </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 187       * @param newState notes for the next backup                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 188       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 189      @Override                                                                                                     </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 190      public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                               </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 191              ParcelFileDescriptor newState) {                                                                      </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 192          if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                                      </span>
<span  style=""> 193                                                                                                                    </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 194          Journal in = readJournal(oldState);                                                                       </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 195          if (!launcherIsReady()) {                                                                                 </span>

<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 196              // Perform backup later.                                                                              </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 197              writeJournal(newState, in);                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 198              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199          }                                                                                                         </span>








<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 200          Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                                   </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 201          mKeys.clear();                                                                                            </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 202          applyJournal(in);                                                                                         </span>
<span  style=""> 203                                                                                                                    </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 204          // Record the time before performing backup so that entries edited while the backup                       </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 205          // was going on, do not get missed in next backup.                                                        </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 206          long newBackupTime = System.currentTimeMillis();                                                          </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 207          mBackupDataWasUpdated = false;                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 208          try {                                                                                                     </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 209              backupFavorites(data);                                                                                </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 210              backupScreens(data);                                                                                  </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 211              backupIcons(data);                                                                                    </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 212              backupWidgets(data);                                                                                  </span>
<span  style=""> 213                                                                                                                    </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 214              // Delete any key which still exist in the old backup, but is not valid anymore.                      </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 215              HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                                    </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 216              for (Key key : mKeys) {                                                                               </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 217                  validKeys.add(keyToBackupKey(key));                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218              }                                                                                                     </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 219              mExistingKeys.removeAll(validKeys);                                                                   </span>
<span  style=""> 220                                                                                                                    </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 221              // Delete anything left in the existing keys.                                                         </span>
<span class="-8057776950468218811" onmouseenter="enter('-8057776950468218811');" onmouseout="out('-8057776950468218811');" style=""> 222              for (String deleted: mExistingKeys) {                                                                 </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style=""> 223                  if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                      </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 224                  data.writeEntityHeader(deleted, -1);                                                              </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 225                  mBackupDataWasUpdated = true;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226              }                                                                                                     </span>
<span  style=""> 227                                                                                                                    </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 228              mExistingKeys.clear();                                                                                </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 229              if (!mBackupDataWasUpdated) {                                                                         </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 230                  // Check if any metadata has changed                                                              </span>
<span class="4456255566361909194" onmouseenter="enter('4456255566361909194');" onmouseout="out('4456255566361909194');" style=""> 231                  mBackupDataWasUpdated = (in.profile == null)                                                      </span>
<span class="3696867724938300008" onmouseenter="enter('3696867724938300008');" onmouseout="out('3696867724938300008');" style=""> 232                          || !Arrays.equals(DeviceProfieData.toByteArray(in.profile),                               </span>
<span class="-1876011232687984521" onmouseenter="enter('-1876011232687984521');" onmouseout="out('-1876011232687984521');" style=""> 233                              DeviceProfieData.toByteArray(getDeviceProfieData()))                                  </span>

<span class="-3212861652554024645" onmouseenter="enter('-3212861652554024645');" onmouseout="out('-3212861652554024645');" style=""> 234                          || (in.backupVersion != BACKUP_VERSION)                                                   </span>
<span class="3693115347738857050" onmouseenter="enter('3693115347738857050');" onmouseout="out('3693115347738857050');" style=""> 235                          || (in.appVersion != getAppVersion());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236              }                                                                                                     </span>
<span  style=""> 237                                                                                                                    </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 238              if (mBackupDataWasUpdated) {                                                                          </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 239                  mLastBackupRestoreTime = newBackupTime;                                                           </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 241                  // We store the journal at two places.                                                            </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style=""> 242                  //   1) Storing it in newState allows us to do partial backups by comparing old state             </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style=""> 243                  //   2) Storing it in backup data allows us to validate keys during restore                       </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 244                  Journal state = getCurrentStateJournal();                                                         </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 245                  writeRowToBackup(JOURNAL_KEY, state, data);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 246              } else {                                                                                              </span>
<span class="6846529623619819273" onmouseenter="enter('6846529623619819273');" onmouseout="out('6846529623619819273');" style=""> 247                  if (DEBUG) Log.d(TAG, &quot;Nothing was written during backup&quot;);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 249          } catch (IOException e) {                                                                                 </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 250              Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251          }                                                                                                         </span>
<span  style=""> 252                                                                                                                    </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 253          writeNewStateDescription(newState);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254      }                                                                                                             </span>
<span  style=""> 255                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 256      /**                                                                                                           </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 257       * @return true if the backup corresponding to oldstate can be successfully applied                           </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 258       * to this device.                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 259       */                                                                                                           </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 260      private boolean isBackupCompatible(Journal oldState) {                                                        </span>
<span class="6840222601736111479" onmouseenter="enter('6840222601736111479');" onmouseout="out('6840222601736111479');" style=""> 261          DeviceProfieData currentProfile = getDeviceProfieData();                                                  </span>
<span  style=""> 262                                                                                                                    </span>

<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 263          DeviceProfieData oldProfile = oldState.profile;                                                           </span>
<span  style=""> 264                                                                                                                    </span>
<span class="3516483988150785854" onmouseenter="enter('3516483988150785854');" onmouseout="out('3516483988150785854');" style=""> 265          if (oldProfile == null || oldProfile.desktopCols == 0) {                                                  </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 266              // Profile info is not valid, ignore the check.                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 267              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268          }                                                                                                         </span>
<span  style=""> 269                                                                                                                    </span>
<span class="-3969248474555793010" onmouseenter="enter('-3969248474555793010');" onmouseout="out('-3969248474555793010');" style=""> 270          boolean isHotsetCompatible = false;                                                                       </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 271          if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                              </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 272              isHotsetCompatible = true;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273          }                                                                                                         </span>
<span class="-5234148737954946799" onmouseenter="enter('-5234148737954946799');" onmouseout="out('-5234148737954946799');" style=""> 274          if ((currentProfile.hotseatCount &gt;= oldProfile.hotseatCount) &amp;&amp;                                           </span>
<span class="-4785593469925988823" onmouseenter="enter('-4785593469925988823');" onmouseout="out('-4785593469925988823');" style=""> 275                  (currentProfile.allappsRank == oldProfile.allappsRank)) {                                         </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style=""> 276              isHotsetCompatible = true;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277          }                                                                                                         </span>
<span  style=""> 278                                                                                                                    </span>
<span class="-6996782978604961637" onmouseenter="enter('-6996782978604961637');" onmouseout="out('-6996782978604961637');" style=""> 279          return isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)                       </span>
<span class="4824114787736852304" onmouseenter="enter('4824114787736852304');" onmouseout="out('4824114787736852304');" style=""> 280                  &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281      }                                                                                                             </span>
<span  style=""> 282                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 283      /**                                                                                                           </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 284       * Restore launcher configuration from the restored data stream.                                              </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 285       * It assumes that the keys will arrive in lexical order. So if the journal was present in the                </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 286       * backup, it should arrive first.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 287       *                                                                                                            </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 288       * @param data the key/value pair from the server                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 289       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 290      @Override                                                                                                     </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 291      public void restoreEntity(BackupDataInputStream data) {                                                       </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 292          if (!restoreSuccessful) {                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 293              return;                                                                                               </span>








<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294          }                                                                                                         </span>
<span  style=""> 295                                                                                                                    </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 296          int dataSize = data.size();                                                                               </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 297          if (mBuffer.length &lt; dataSize) {                                                                          </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 298              mBuffer = new byte[dataSize];                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 300          try {                                                                                                     </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 301              int bytesRead = data.read(mBuffer, 0, dataSize);                                                      </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 302              if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);                        </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 303              String backupKey = data.getKey();                                                                     </span>
<span  style=""> 304                                                                                                                    </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 305              if (JOURNAL_KEY.equals(backupKey)) {                                                                  </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 306                  if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                                </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 307                  if (!mKeys.isEmpty()) {                                                                           </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 308                      // We received the journal key after a restore key.                                           </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 309                      Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);                </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 310                      restoreSuccessful = false;                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 311                      return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312                  }                                                                                                 </span>
<span  style=""> 313                                                                                                                    </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 314                  Journal journal = new Journal();                                                                  </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 315                  MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                              </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 316                  applyJournal(journal);                                                                            </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 317                  restoreSuccessful = isBackupCompatible(journal);                                                  </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 318 -                restoredBackupVersion = journal.backupVersion;                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 319                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320              }                                                                                                     </span>
<span  style=""> 321                                                                                                                    </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 322              if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                                 </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 323                  if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 324                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325              }                                                                                                     </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 326              Key key = backupKeyToKey(backupKey);                                                                  </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 327              mKeys.add(key);                                                                                       </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 328              switch (key.type) {                                                                                   </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 329                  case Key.FAVORITE:                                                                                </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 330                      restoreFavorite(key, mBuffer, dataSize);                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 331                      break;                                                                                        </span>
<span  style=""> 332                                                                                                                    </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 333                  case Key.SCREEN:                                                                                  </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 334                      restoreScreen(key, mBuffer, dataSize);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 335                      break;                                                                                        </span>
<span  style=""> 336                                                                                                                    </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 337                  case Key.ICON:                                                                                    </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 338                      restoreIcon(key, mBuffer, dataSize);                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 339                      break;                                                                                        </span>
<span  style=""> 340                                                                                                                    </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 341                  case Key.WIDGET:                                                                                  </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 342                      restoreWidget(key, mBuffer, dataSize);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 343                      break;                                                                                        </span>
<span  style=""> 344                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 345                  default:                                                                                          </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 346                      Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                                       </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 347                      mKeys.remove(key);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 348                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 350          } catch (IOException e) {                                                                                 </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 351              Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353      }                                                                                                             </span>
<span  style=""> 354                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 355      /**                                                                                                           </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 356       * Record the restore state for the next backup.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 357       *                                                                                                            </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 358       * @param newState notes about the backup state after restore.                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 359       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 360      @Override                                                                                                     </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 361      public void writeNewStateDescription(ParcelFileDescriptor newState) {                                         </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 362          writeJournal(newState, getCurrentStateJournal());                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363      }                                                                                                             </span>
<span  style=""> 364                                                                                                                    </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 365      private Journal getCurrentStateJournal() {                                                                    </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 366          Journal journal = new Journal();                                                                          </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 367          journal.t = mLastBackupRestoreTime;                                                                       </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 368          journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                          </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 369          journal.appVersion = getAppVersion();                                                                     </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 370          journal.backupVersion = BACKUP_VERSION;                                                                   </span>
<span class="-6030934345780896454" onmouseenter="enter('-6030934345780896454');" onmouseout="out('-6030934345780896454');" style=""> 371          journal.profile = getDeviceProfieData();                                                                  </span>

<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 372          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373      }                                                                                                             </span>
<span  style=""> 374                                                                                                                    </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 375      private int getAppVersion() {                                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 376          try {                                                                                                     </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 377              return mContext.getPackageManager()                                                                   </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 378                      .getPackageInfo(mContext.getPackageName(), 0).versionCode;                                    </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 379          } catch (NameNotFoundException e) {                                                                       </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 380              return 0;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382      }                                                                                                             </span>
<span  style=""> 383                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 384      /**                                                                                                           </span>
<span class="-4501492075935595010" onmouseenter="enter('-4501492075935595010');" onmouseout="out('-4501492075935595010');" style=""> 385       * @return the current device profile information.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 386       */                                                                                                           </span>
<span class="4124629983355258626" onmouseenter="enter('4124629983355258626');" onmouseout="out('4124629983355258626');" style=""> 387      private DeviceProfieData getDeviceProfieData() {                                                              </span>
<span class="-7376286606070162099" onmouseenter="enter('-7376286606070162099');" onmouseout="out('-7376286606070162099');" style=""> 388          if (mCurrentProfile != null) {                                                                            </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style=""> 389              return mCurrentProfile;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390          }                                                                                                         </span>
<span class="-5497719505817004004" onmouseenter="enter('-5497719505817004004');" onmouseout="out('-5497719505817004004');" style=""> 391          final Context applicationContext = mContext.getApplicationContext();                                      </span>
<span class="7980813194196555392" onmouseenter="enter('7980813194196555392');" onmouseout="out('7980813194196555392');" style=""> 392          DeviceProfile profile = LauncherAppState.createDynamicGrid(applicationContext, null)                      </span>
<span class="-5938220650159761744" onmouseenter="enter('-5938220650159761744');" onmouseout="out('-5938220650159761744');" style=""> 393                  .getDeviceProfile();                                                                              </span>
<span  style=""> 394                                                                                                                    </span>
<span class="-8088032308844031335" onmouseenter="enter('-8088032308844031335');" onmouseout="out('-8088032308844031335');" style=""> 395          mCurrentProfile = new DeviceProfieData();                                                                 </span>
<span class="7442338639987606524" onmouseenter="enter('7442338639987606524');" onmouseout="out('7442338639987606524');" style=""> 396          mCurrentProfile.desktopRows = profile.numRows;                                                            </span>
<span class="-4500555851720273514" onmouseenter="enter('-4500555851720273514');" onmouseout="out('-4500555851720273514');" style=""> 397          mCurrentProfile.desktopCols = profile.numColumns;                                                         </span>
<span class="-3431910476829522829" onmouseenter="enter('-3431910476829522829');" onmouseout="out('-3431910476829522829');" style=""> 398          mCurrentProfile.hotseatCount = profile.numHotseatIcons;                                                   </span>
<span class="1465841957362210064" onmouseenter="enter('1465841957362210064');" onmouseout="out('1465841957362210064');" style=""> 399          mCurrentProfile.allappsRank = profile.hotseatAllAppsRank;                                                 </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style=""> 400          return mCurrentProfile;                                                                                   </span>







<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401      }                                                                                                             </span>
<span  style=""> 402                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 403      /**                                                                                                           </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 404       * Write all modified favorites to the data stream.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 405       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 406       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 407       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 408       */                                                                                                           </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 409      private void backupFavorites(BackupDataOutput data) throws IOException {                                      </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 410          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 411          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 412          // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 413          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 414                  getUserSelectionArg(), null, null);                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 415          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 416              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 417              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 418                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 419                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 420                  Key key = getKey(Key.FAVORITE, id);                                                               </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 421                  mKeys.add(key);                                                                                   </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 422                  final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 423                  if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {                 </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 424                      writeRowToBackup(key, packFavorite(cursor), data);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 425                  } else {                                                                                          </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 426                      if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 429          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 430              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432      }                                                                                                             </span>
<span  style=""> 433                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 434      /**                                                                                                           </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 435       * Read a favorite from the stream.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 436       *                                                                                                            </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 437       * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 438       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 439       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 440       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 441       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 442       */                                                                                                           </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 443      private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {                       </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 444          if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                                  </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 445          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 446                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 447                                                                                                                    </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 448          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 449          ContentValues values = unpackFavorite(buffer, dataSize);                                                  </span>
<span class="-1772646669374892986" onmouseenter="enter('-1772646669374892986');" onmouseout="out('-1772646669374892986');" style=""> 450          cr.insert(Favorites.CONTENT_URI_NO_NOTIFICATION, values);                                                 </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451      }                                                                                                             </span>
<span  style=""> 452                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 453      /**                                                                                                           </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 454       * Write all modified screens to the data stream.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 455       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 456       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 457       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 458       */                                                                                                           </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 459      private void backupScreens(BackupDataOutput data) throws IOException {                                        </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 460          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 461          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 462          Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                                 </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 463                  null, null, null);                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 464          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 465              cursor.moveToPosition(-1);                                                                            </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 466              if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 467              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 468                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 469                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 470                  Key key = getKey(Key.SCREEN, id);                                                                 </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 471                  mKeys.add(key);                                                                                   </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 472                  final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 473                  if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {                 </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 474                      writeRowToBackup(key, packScreen(cursor), data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 475                  } else {                                                                                          </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 476                      if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 479          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 480              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482      }                                                                                                             </span>
<span  style=""> 483                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 484      /**                                                                                                           </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 485       * Read a screen from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 486       *                                                                                                            </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 487       * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 488       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 489       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 490       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 491       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 492       */                                                                                                           </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 493      private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                         </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 494          if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 495          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 496                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 497                                                                                                                    </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 498          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 499          ContentValues values = unpackScreen(buffer, dataSize);                                                    </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 500          cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501      }                                                                                                             </span>
<span  style=""> 502                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 503      /**                                                                                                           </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 504       * Write all the static icon resources we need to render placeholders                                         </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 505       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 506       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 507       * @param data output stream for key/value pairs                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 508       */                                                                                                           </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 509      private void backupIcons(BackupDataOutput data) throws IOException {                                          </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 510          // persist icons that haven&#x27;t been persisted yet                                                          </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style=""> 511          if (!initializeIconCache()) {                                                                             </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style=""> 512              dataChanged(); // try again later                                                                     </span>
<span class="-8112704428397532174" onmouseenter="enter('-8112704428397532174');" onmouseout="out('-8112704428397532174');" style=""> 513              if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 514              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515          }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 516          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 517          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 518          final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                    </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 519          int backupUpIconCount = 0;                                                                                </span>
<span  style=""> 520                                                                                                                    </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 521          // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 522          String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +               </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 523                  Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                             </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 524                  getUserSelectionArg();                                                                            </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 525          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 526                  where, null, null);                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 527          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 528              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 529              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 530                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 531                  final String intentDescription = cursor.getString(INTENT_INDEX);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 532                  try {                                                                                             </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 533                      Intent intent = Intent.parseUri(intentDescription, 0);                                        </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 534                      ComponentName cn = intent.getComponent();                                                     </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 535                      Key key = null;                                                                               </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 536                      String backupKey = null;                                                                      </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 537                      if (cn != null) {                                                                             </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 538                          key = getKey(Key.ICON, cn.flattenToShortString());                                        </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 539                          backupKey = keyToBackupKey(key);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 540                      } else {                                                                                      </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 541                          Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                      }                                                                                             </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 543                      if (mExistingKeys.contains(backupKey)) {                                                      </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 544                          if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                                 </span>
<span  style=""> 545                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 546                          // remember that we already backed this up previously                                     </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 547                          mKeys.add(key);                                                                           </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 548                      } else if (backupKey != null) {                                                               </span>
<span class="-6310531343064499436" onmouseenter="enter('-6310531343064499436');" onmouseout="out('-6310531343064499436');" style=""> 549                          if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);                     </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 550                          if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                             </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 551                              if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                                    </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 552                              Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                               </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 553                              if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {                  </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 554                                  writeRowToBackup(key, packIcon(dpi, icon), data);                                 </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 555                                  mKeys.add(key);                                                                   </span>
<span class="5377719919294214367" onmouseenter="enter('5377719919294214367');" onmouseout="out('5377719919294214367');" style=""> 556                                  backupUpIconCount ++;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557                              }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 558                          } else {                                                                                  </span>
<span class="4246955911601526686" onmouseenter="enter('4246955911601526686');" onmouseout="out('4246955911601526686');" style=""> 559                              if (VERBOSE) Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);                        </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 560                              // too many icons for this pass, request another.                                     </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 561                              dataChanged();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563                      }                                                                                             </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 564                  } catch (URISyntaxException e) {                                                                  </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 565                      Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 566                  } catch (IOException e) {                                                                         </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 567                      Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568                  }                                                                                                 </span>
<span  style=""> 569                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 571          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 572              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574      }                                                                                                             </span>
<span  style=""> 575                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 576      /**                                                                                                           </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 577       * Read an icon from the stream.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 578       *                                                                                                            </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 579       * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 580       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 581       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 582       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 583       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 584       */                                                                                                           </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 585      private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                           </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 586          if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                      </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 587          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 588                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 589                                                                                                                    </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 590          Resource res = unpackProto(new Resource(), buffer, dataSize);                                             </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 591          if (DEBUG) {                                                                                              </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 592              Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593          }                                                                                                         </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 594          Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                                </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 595          if (icon == null) {                                                                                       </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 596              Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597          }                                                                                                         </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 598          if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                          </span>
<span class="-6103588571021946959" onmouseenter="enter('-6103588571021946959');" onmouseout="out('-6103588571021946959');" style=""> 599          IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name), icon, res.dpi);              </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600      }                                                                                                             </span>
<span  style=""> 601                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 602      /**                                                                                                           </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 603       * Write all the static widget resources we need to render placeholders                                       </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 604       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 605       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 606       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 607       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 608       */                                                                                                           </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 609      private void backupWidgets(BackupDataOutput data) throws IOException {                                        </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 610          // persist static widget info that hasn&#x27;t been persisted yet                                              </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style=""> 611          final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="3171498958920755873" onmouseenter="enter('3171498958920755873');" onmouseout="out('3171498958920755873');" style=""> 612          if (appState == null || !initializeIconCache()) {                                                         </span>
<span class="-8001735677136208699" onmouseenter="enter('-8001735677136208699');" onmouseout="out('-8001735677136208699');" style=""> 613              Log.w(TAG, &quot;Failed to get icon cache during restore&quot;);                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 614              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615          }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 616          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style=""> 617          final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                              </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style=""> 618          final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 619          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style=""> 620          final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                               </span>
<span class="8742319267076301489" onmouseenter="enter('8742319267076301489');" onmouseout="out('8742319267076301489');" style=""> 621          if (DEBUG) Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                             </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 622          int backupWidgetCount = 0;                                                                                </span>
<span  style=""> 623                                                                                                                    </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 624          String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;                        </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 625                  + getUserSelectionArg();                                                                          </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 626          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 627                  where, null, null);                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 628          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 629              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 630              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 631                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 632                  final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                           </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style=""> 633                  final int spanX = cursor.getInt(SPANX_INDEX);                                                     </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style=""> 634                  final int spanY = cursor.getInt(SPANY_INDEX);                                                     </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 635                  final ComponentName provider = ComponentName.unflattenFromString(providerName);                   </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 636                  Key key = null;                                                                                   </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 637                  String backupKey = null;                                                                          </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 638                  if (provider != null) {                                                                           </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 639                      key = getKey(Key.WIDGET, providerName);                                                       </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 640                      backupKey = keyToBackupKey(key);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 641                  } else {                                                                                          </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 642                      Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643                  }                                                                                                 </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 644 -                if (mExistingKeys.contains(backupKey)) {                                                          </span>
<span class="7478848681639332606" onmouseenter="enter('7478848681639332606');" onmouseout="out('7478848681639332606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 645 +                if (mExistingKeys.contains(backupKey) &amp;&amp; restoredBackupVersion &gt;= BACKUP_VERSION) {               </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 646                      if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                                   </span>
<span  style=""> 647                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 648                      // remember that we already backed this up previously                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 649                      mKeys.add(key);                                                                               </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 650                  } else if (backupKey != null) {                                                                   </span>
<span class="-6588785262075303708" onmouseenter="enter('-6588785262075303708');" onmouseout="out('-6588785262075303708');" style=""> 651                      if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                         </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 652                      if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                               </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 653                          if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                                      </span>
<span class="5731902488844945769" onmouseenter="enter('5731902488844945769');" onmouseout="out('5731902488844945769');" style=""> 654                          previewLoader.setPreviewSize(spanX * profile.cellWidthPx,                                 </span>
<span class="4335834404207041696" onmouseenter="enter('4335834404207041696');" onmouseout="out('4335834404207041696');" style=""> 655                                  spanY * profile.cellHeightPx, widgetSpacingLayout);                               </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 656                          UserHandleCompat user = UserHandleCompat.myUserHandle();                                  </span>
<span class="2806251153376750688" onmouseenter="enter('2806251153376750688');" onmouseout="out('2806251153376750688');" style=""> 657                          writeRowToBackup(key,                                                                     </span>
<span class="1049894294073861081" onmouseenter="enter('1049894294073861081');" onmouseout="out('1049894294073861081');" style=""> 658                                  packWidget(dpi, previewLoader, mIconCache, provider, user),                       </span>
<span class="2995666273282439458" onmouseenter="enter('2995666273282439458');" onmouseout="out('2995666273282439458');" style=""> 659                                  data);                                                                            </span>

<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 660                          mKeys.add(key);                                                                           </span>
<span class="945813103637646770" onmouseenter="enter('945813103637646770');" onmouseout="out('945813103637646770');" style=""> 661                          backupWidgetCount ++;                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 662                      } else {                                                                                      </span>
<span class="5790411094184621928" onmouseenter="enter('5790411094184621928');" onmouseout="out('5790411094184621928');" style=""> 663                          if (VERBOSE) Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                          </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 664                          // too many widgets for this pass, request another.                                       </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 665                          dataChanged();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 669          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 670              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 671          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672      }                                                                                                             </span>
<span  style=""> 673                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 674      /**                                                                                                           </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 675       * Read a widget from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 676       *                                                                                                            </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 677       * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 678       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 679       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 680       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 681       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 682       */                                                                                                           </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 683      private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                         </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 684          if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 685          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 686                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 687          Widget widget = unpackProto(new Widget(), buffer, dataSize);                                              </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 688          if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                                     </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 689          if (widget.icon.data != null)  {                                                                          </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 690              Bitmap icon = BitmapFactory                                                                           </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 691                      .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                               </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 692              if (icon == null) {                                                                                   </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 693                  Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 694              } else {                                                                                              </span>
<span class="-5118804049175440922" onmouseenter="enter('-5118804049175440922');" onmouseout="out('-5118804049175440922');" style=""> 695                  IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider),               </span>
<span class="-4542677240226290463" onmouseenter="enter('-4542677240226290463');" onmouseout="out('-4542677240226290463');" style=""> 696                          icon, widget.icon.dpi);                                                                   </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698          }                                                                                                         </span>
<span  style=""> 699                                                                                                                    </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 700          // future site of widget table mutation                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701      }                                                                                                             </span>
<span  style=""> 702                                                                                                                    </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 703      /** create a new key, with an integer ID.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 704       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 705       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 706       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 707       */                                                                                                           </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 708      private Key getKey(int type, long id) {                                                                       </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 709          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 710          key.type = type;                                                                                          </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 711          key.id = id;                                                                                              </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 712          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 713          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714      }                                                                                                             </span>
<span  style=""> 715                                                                                                                    </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 716      /** create a new key for a named object.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 717       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 718       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 719       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 720       */                                                                                                           </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 721      private Key getKey(int type, String name) {                                                                   </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 722          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 723          key.type = type;                                                                                          </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 724          key.name = name;                                                                                          </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 725          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 726          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727      }                                                                                                             </span>
<span  style=""> 728                                                                                                                    </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 729      /** keys need to be strings, serialize and encode. */                                                         </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 730      private String keyToBackupKey(Key key) {                                                                      </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 731          return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732      }                                                                                                             </span>
<span  style=""> 733                                                                                                                    </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 734      /** keys need to be strings, decode and parse. */                                                             </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 735      private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 736          try {                                                                                                     </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 737              Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                                    </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 738              if (key.checksum != checkKey(key)) {                                                                  </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 739                  key = null;                                                                                       </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 740                  throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 741              }                                                                                                     </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 742              return key;                                                                                           </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 743          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 744              throw new InvalidBackupException(e);                                                                  </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 745          } catch (IllegalArgumentException e) {                                                                    </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 746              throw new InvalidBackupException(e);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748      }                                                                                                             </span>
<span  style=""> 749                                                                                                                    </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 750      /** Compute the checksum over the important bits of a key. */                                                 </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 751      private long checkKey(Key key) {                                                                              </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 752          CRC32 checksum = new CRC32();                                                                             </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 753          checksum.update(key.type);                                                                                </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 754          checksum.update((int) (key.id &amp; 0xffff));                                                                 </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 755          checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                         </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 756          if (!TextUtils.isEmpty(key.name)) {                                                                       </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 757              checksum.update(key.name.getBytes());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758          }                                                                                                         </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 759          return checksum.getValue();                                                                               </span>











<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 760      }                                                                                                             </span>
<span  style=""> 761                                                                                                                    </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 762      /** Serialize a Favorite for persistence, including a checksum wrapper. */                                    </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 763      private Favorite packFavorite(Cursor c) {                                                                     </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 764          Favorite favorite = new Favorite();                                                                       </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 765          favorite.id = c.getLong(ID_INDEX);                                                                        </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 766          favorite.screen = c.getInt(SCREEN_INDEX);                                                                 </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 767          favorite.container = c.getInt(CONTAINER_INDEX);                                                           </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 768          favorite.cellX = c.getInt(CELLX_INDEX);                                                                   </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 769          favorite.cellY = c.getInt(CELLY_INDEX);                                                                   </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 770          favorite.spanX = c.getInt(SPANX_INDEX);                                                                   </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 771          favorite.spanY = c.getInt(SPANY_INDEX);                                                                   </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 772          favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                            </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 773          if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 774              String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                                 </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 775              if (!TextUtils.isEmpty(iconPackage)) {                                                                </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 776                  favorite.iconPackage = iconPackage;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777              }                                                                                                     </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 778              String iconResource = c.getString(ICON_RESOURCE_INDEX);                                               </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 779              if (!TextUtils.isEmpty(iconResource)) {                                                               </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 780                  favorite.iconResource = iconResource;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 781              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782          }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 783          if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 784              byte[] blob = c.getBlob(ICON_INDEX);                                                                  </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 785              if (blob != null &amp;&amp; blob.length &gt; 0) {                                                                </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 786                  favorite.icon = blob;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 787              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 788          }                                                                                                         </span>

<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 789          String title = c.getString(TITLE_INDEX);                                                                  </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 790          if (!TextUtils.isEmpty(title)) {                                                                          </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 791              favorite.title = title;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792          }                                                                                                         </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 793          String intentDescription = c.getString(INTENT_INDEX);                                                     </span>

<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 794          if (!TextUtils.isEmpty(intentDescription)) {                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 795              try {                                                                                                 </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 796                  Intent intent = Intent.parseUri(intentDescription, 0);                                            </span>

<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 797                  intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                                       </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 798                  favorite.intent = intent.toUri(0);                                                                </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 799              } catch (URISyntaxException e) {                                                                      </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 800                  Log.e(TAG, &quot;Invalid intent&quot;, e);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802          }                                                                                                         </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 803          favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                            </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 804          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 805              favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                                  </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 806              String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                                     </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 807              if (!TextUtils.isEmpty(appWidgetProvider)) {                                                          </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 808                  favorite.appWidgetProvider = appWidgetProvider;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809              }                                                                                                     </span>









































<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810          }                                                                                                         </span>
<span  style=""> 811                                                                                                                    </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 812          return favorite;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813      }                                                                                                             </span>
<span  style=""> 814                                                                                                                    </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 815      /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                             </span>
<span class="-5576008980985724481" onmouseenter="enter('-5576008980985724481');" onmouseout="out('-5576008980985724481');" style=""> 816      private ContentValues unpackFavorite(byte[] buffer, int dataSize)                                             </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 817              throws IOException {                                                                                  </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 818          Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                                        </span>

<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 819          ContentValues values = new ContentValues();                                                               </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 820          values.put(Favorites._ID, favorite.id);                                                                   </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 821          values.put(Favorites.SCREEN, favorite.screen);                                                            </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 822          values.put(Favorites.CONTAINER, favorite.container);                                                      </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 823          values.put(Favorites.CELLX, favorite.cellX);                                                              </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 824          values.put(Favorites.CELLY, favorite.cellY);                                                              </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 825          values.put(Favorites.SPANX, favorite.spanX);                                                              </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 826          values.put(Favorites.SPANY, favorite.spanY);                                                              </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 827          values.put(Favorites.ICON_TYPE, favorite.iconType);                                                       </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 828          if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 829              values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                             </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 830              values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 831          }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 832          if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>







<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 833              values.put(Favorites.ICON, favorite.icon);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834          }                                                                                                         </span>

<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 835          if (!TextUtils.isEmpty(favorite.title)) {                                                                 </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 836              values.put(Favorites.TITLE, favorite.title);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 837          } else {                                                                                                  </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 838              values.put(Favorites.TITLE, &quot;&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839          }                                                                                                         </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 840          if (!TextUtils.isEmpty(favorite.intent)) {                                                                </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 841              values.put(Favorites.INTENT, favorite.intent);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 842          }                                                                                                         </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 843          values.put(Favorites.ITEM_TYPE, favorite.itemType);                                                       </span>
<span  style=""> 844                                                                                                                    </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 845          UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                          </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style=""> 846          long userSerialNumber =                                                                                   </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style=""> 847                  UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);                     </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 848          values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                                      </span>
<span  style=""> 849                                                                                                                    </span>
<span class="6840222601736111479" onmouseenter="enter('6840222601736111479');" onmouseout="out('6840222601736111479');" style=""> 850          DeviceProfieData currentProfile = getDeviceProfieData();                                                  </span>

<span  style=""> 851                                                                                                                    </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 852          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 853              if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                                 </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 854                  values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855              }                                                                                                     </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 856              values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                             </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 857              values.put(LauncherSettings.Favorites.RESTORED,                                                       </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style=""> 858                      LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                                     </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style=""> 859                      LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                               </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style=""> 860                      LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                                     </span>
<span  style=""> 861                                                                                                                    </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 862              // Verify placement                                                                                   </span>
<span class="-7553882590673737344" onmouseenter="enter('-7553882590673737344');" onmouseout="out('-7553882590673737344');" style=""> 863              if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols)                                  </span>
<span class="1436175124930418764" onmouseenter="enter('1436175124930418764');" onmouseout="out('1436175124930418764');" style=""> 864                      || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {                        </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 865                  restoreSuccessful = false;                                                                        </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style=""> 866                  throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 868          } else {                                                                                                  </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 869              // Let LauncherModel know we&#x27;ve been here.                                                            </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 870              values.put(LauncherSettings.Favorites.RESTORED, 1);                                                   </span>











<span  style=""> 871                                                                                                                    </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 872              // Verify placement                                                                                   </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 873              if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                              </span>
<span class="3850618212667286309" onmouseenter="enter('3850618212667286309');" onmouseout="out('3850618212667286309');" style=""> 874                  if ((favorite.screen &gt;= currentProfile.hotseatCount)                                              </span>
<span class="-2927406358945708190" onmouseenter="enter('-2927406358945708190');" onmouseout="out('-2927406358945708190');" style=""> 875                          || (favorite.screen == currentProfile.allappsRank)) {                                     </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 876                      restoreSuccessful = false;                                                                    </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style=""> 877                      throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 879              } else {                                                                                              </span>
<span class="4635538835318305805" onmouseenter="enter('4635538835318305805');" onmouseout="out('4635538835318305805');" style=""> 880                  if ((favorite.cellX &gt;= currentProfile.desktopCols)                                                </span>
<span class="-3183516951997115573" onmouseenter="enter('-3183516951997115573');" onmouseout="out('-3183516951997115573');" style=""> 881                          || (favorite.cellY &gt;= currentProfile.desktopRows)) {                                      </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 882                      restoreSuccessful = false;                                                                    </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style=""> 883                      throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 885              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886          }                                                                                                         </span>
<span  style=""> 887                                                                                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 888          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 889      }                                                                                                             </span>
<span  style=""> 890                                                                                                                    </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 891      /** Serialize a Screen for persistence, including a checksum wrapper. */                                      </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style=""> 892      private Screen packScreen(Cursor c) {                                                                         </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 893          Screen screen = new Screen();                                                                             </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 894          screen.id = c.getLong(ID_INDEX);                                                                          </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 895          screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                                </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style=""> 896          return screen;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897      }                                                                                                             </span>
<span  style=""> 898                                                                                                                    </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 899      /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                               </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style=""> 900      private ContentValues unpackScreen(byte[] buffer, int dataSize)                                               </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 901              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style=""> 902          Screen screen = unpackProto(new Screen(), buffer, dataSize);                                              </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 903          ContentValues values = new ContentValues();                                                               </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 904          values.put(WorkspaceScreens._ID, screen.id);                                                              </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 905          values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 906          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 907      }                                                                                                             </span>
<span  style=""> 908                                                                                                                    </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 909      /** Serialize an icon Resource for persistence, including a checksum wrapper. */                              </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style=""> 910      private Resource packIcon(int dpi, Bitmap icon) {                                                             </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 911          Resource res = new Resource();                                                                            </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 912          res.dpi = dpi;                                                                                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 913          ByteArrayOutputStream os = new ByteArrayOutputStream();                                                   </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 914          if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                         </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style=""> 915              res.data = os.toByteArray();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 916          }                                                                                                         </span>

<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 917          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 918      }                                                                                                             </span>
<span  style=""> 919                                                                                                                    </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 920      /** Serialize a widget for persistence, including a checksum wrapper. */                                      </span>
<span class="122020410304176150" onmouseenter="enter('122020410304176150');" onmouseout="out('122020410304176150');" style=""> 921      private Widget packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,                    </span>
<span class="-9087206329152770867" onmouseenter="enter('-9087206329152770867');" onmouseout="out('-9087206329152770867');" style=""> 922              ComponentName provider, UserHandleCompat user) {                                                      </span>

<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style=""> 923          final LauncherAppWidgetProviderInfo info =                                                                </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style=""> 924                  LauncherModel.getProviderInfo(mContext, provider, user);                                          </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 925          Widget widget = new Widget();                                                                             </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 926          widget.provider = provider.flattenToShortString();                                                        </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 927          widget.label = info.label;                                                                                </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 928          widget.configure = info.configure != null;                                                                </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 929          if (info.icon != 0) {                                                                                     </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 930              widget.icon = new Resource();                                                                         </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style=""> 931              Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);                </span>

<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 932              Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                                      </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 933              ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 934              if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                     </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style=""> 935                  widget.icon.data = os.toByteArray();                                                              </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 936                  widget.icon.dpi = dpi;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 937              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 938          }                                                                                                         </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 939          if (info.previewImage != 0) {                                                                             </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style=""> 940              widget.preview = new Resource();                                                                      </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style=""> 941              Bitmap preview = previewLoader.generateWidgetPreview(info, null);                                     </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 942              ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style=""> 943              if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                  </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style=""> 944                  widget.preview.data = os.toByteArray();                                                           </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style=""> 945                  widget.preview.dpi = dpi;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 946              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 948 +                                                                                                                  </span>
<span class="414947938502206869" onmouseenter="enter('414947938502206869');" onmouseout="out('414947938502206869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 949 +        widget.minSpanX = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_HORIZONTAL) != 0                </span>
<span class="-9163706737572277729" onmouseenter="enter('-9163706737572277729');" onmouseout="out('-9163706737572277729');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 950 +                ? info.minSpanX : -1;                                                                             </span>
<span class="6449476295053203863" onmouseenter="enter('6449476295053203863');" onmouseout="out('6449476295053203863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 951 +        widget.minSpanY = (info.resizeMode &amp; LauncherAppWidgetProviderInfo.RESIZE_VERTICAL) != 0                  </span>
<span class="1621633565087981805" onmouseenter="enter('1621633565087981805');" onmouseout="out('1621633565087981805');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 952 +                ? info.minSpanY : -1;                                                                             </span>








<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style=""> 953          return widget;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 954      }                                                                                                             </span>
<span  style=""> 955                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 956      /**                                                                                                           </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style=""> 957       * Deserialize a proto after verifying checksum wrapper.                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 958       */                                                                                                           </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style=""> 959      private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                           </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 960              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style=""> 961          MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                         </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style=""> 962          if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                         </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style=""> 963          return proto;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 964      }                                                                                                             </span>
<span  style=""> 965                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 966      /**                                                                                                           </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style=""> 967       * Read the old journal from the input file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 968       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style=""> 969       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style=""> 970       * in that case, do a full backup.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 971       *                                                                                                            </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style=""> 972       * @param oldState the read-0only file descriptor pointing to the old journal                                 </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style=""> 973       * @return a Journal protocol buffer                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 974       */                                                                                                           </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style=""> 975      private Journal readJournal(ParcelFileDescriptor oldState) {                                                  </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 976          Journal journal = new Journal();                                                                          </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style=""> 977          if (oldState == null) {                                                                                   </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 978              return journal;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 979          }                                                                                                         </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style=""> 980          FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 981          try {                                                                                                     </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style=""> 982              int availableBytes = inStream.available();                                                            </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style=""> 983              if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                                 </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style=""> 984              if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                              </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style=""> 985                  byte[] buffer = new byte[availableBytes];                                                         </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style=""> 986                  int bytesRead = 0;                                                                                </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style=""> 987                  boolean valid = false;                                                                            </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style=""> 988                  InvalidProtocolBufferNanoException lastProtoException = null;                                     </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style=""> 989                  while (availableBytes &gt; 0) {                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 990                      try {                                                                                         </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style=""> 991                          // OMG what are you doing? This is crazy inefficient!                                     </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style=""> 992                          // If we read a byte that is not ours, we will cause trouble: b/12491813                  </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style=""> 993                          // However, we don&#x27;t know how many bytes to expect (oops).                                </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style=""> 994                          // So we have to step through *slowly*, watching for the end.                             </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style=""> 995                          int result = inStream.read(buffer, bytesRead, 1);                                         </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style=""> 996                          if (result &gt; 0) {                                                                         </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style=""> 997                              availableBytes -= result;                                                             </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style=""> 998                              bytesRead += result;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 999                          } else {                                                                                  </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1000                              Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                          </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1001                              // stop reading and see what there is to parse                                        </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1002                              availableBytes = 0;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1003                          }                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1004                      } catch (IOException e) {                                                                     </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1005                          buffer = null;                                                                            </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1006                          availableBytes = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1007                      }                                                                                             </span>
<span  style="">1008                                                                                                                    </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1009                      // check the buffer to see if we have a valid journal                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1010                      try {                                                                                         </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1011                          MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));                      </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1012                          // if we are here, then we have read a valid, checksum-verified journal                   </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1013                          valid = true;                                                                             </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1014                          availableBytes = 0;                                                                       </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1015                          if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);                       </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1016                      } catch (InvalidProtocolBufferNanoException e) {                                              </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1017                          // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.              </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1018                          lastProtoException = e;                                                                   </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1019                          journal.clear();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1020                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1021                  }                                                                                                 </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1022                  if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                                        </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1023                  if (!valid) {                                                                                     </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1024                      Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1025                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1026              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1027          } catch (IOException e) {                                                                                 </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1028              Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1029          } finally {                                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1030              try {                                                                                                 </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1031                  inStream.close();                                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1032              } catch (IOException e) {                                                                             </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1033                  Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1034              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1035          }                                                                                                         </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1036          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1037      }                                                                                                             </span>
<span  style="">1038                                                                                                                    </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1039      private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                              </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1040              throws IOException {                                                                                  </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1041          writeRowToBackup(keyToBackupKey(key), proto, data);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1042      }                                                                                                             </span>
<span  style="">1043                                                                                                                    </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1044      private void writeRowToBackup(String backupKey, MessageNano proto,                                            </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1045              BackupDataOutput data) throws IOException {                                                           </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1046          byte[] blob = writeCheckedBytes(proto);                                                                   </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1047          data.writeEntityHeader(backupKey, blob.length);                                                           </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1048          data.writeEntityData(blob, blob.length);                                                                  </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1049          mBackupDataWasUpdated = true;                                                                             </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1050          if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1051      }                                                                                                             </span>
<span  style="">1052                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1053      /**                                                                                                           </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1054       * Write the new journal to the output file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1055       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1056       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1057       * in that case, do a full backup.                                                                            </span>
<span  style="">1058                                                                                                                    </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1059       * @param newState the write-only file descriptor pointing to the new journal                                 </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1060       * @param journal a Journal protocol buffer                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1061       */                                                                                                           </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1062      private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                                   </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1063          FileOutputStream outStream = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1064          try {                                                                                                     </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1065              outStream = new FileOutputStream(newState.getFileDescriptor());                                       </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1066              final byte[] journalBytes = writeCheckedBytes(journal);                                               </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1067              outStream.write(journalBytes);                                                                        </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1068              outStream.close();                                                                                    </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1069              if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1070          } catch (IOException e) {                                                                                 </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1071              Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1072          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1073      }                                                                                                             </span>
<span  style="">1074                                                                                                                    </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1075      /** Wrap a proto in a CheckedMessage and compute the checksum. */                                             </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1076      private byte[] writeCheckedBytes(MessageNano proto) {                                                         </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1077          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1078          wrapper.payload = MessageNano.toByteArray(proto);                                                         </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1079          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1080          checksum.update(wrapper.payload);                                                                         </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1081          wrapper.checksum = checksum.getValue();                                                                   </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1082          return MessageNano.toByteArray(wrapper);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1083      }                                                                                                             </span>
<span  style="">1084                                                                                                                    </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1085      /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                                  </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1086      private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                           </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1087              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1088          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1089          MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                                      </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1090          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1091          checksum.update(wrapper.payload);                                                                         </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1092          if (wrapper.checksum != checksum.getValue()) {                                                            </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1093              throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1094          }                                                                                                         </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1095          return wrapper.payload;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1096      }                                                                                                             </span>
<span  style="">1097                                                                                                                    </span>
<span class="-3747865328185427292" onmouseenter="enter('-3747865328185427292');" onmouseout="out('-3747865328185427292');" style="">1098      private boolean initializeIconCache() {                                                                       </span>
<span class="786459695793008309" onmouseenter="enter('786459695793008309');" onmouseout="out('786459695793008309');" style="">1099          if (mIconCache != null) {                                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1100              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1101          }                                                                                                         </span>
<span  style="">1102                                                                                                                    </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="">1103          final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="">1104          if (appState == null) {                                                                                   </span>
<span class="-1606020641700129220" onmouseenter="enter('-1606020641700129220');" onmouseout="out('-1606020641700129220');" style="">1105              Throwable stackTrace = new Throwable();                                                               </span>
<span class="4026238654429205346" onmouseenter="enter('4026238654429205346');" onmouseout="out('4026238654429205346');" style="">1106              stackTrace.fillInStackTrace();                                                                        </span>
<span class="3094768706025518149" onmouseenter="enter('3094768706025518149');" onmouseout="out('3094768706025518149');" style="">1107              Log.w(TAG, &quot;Failed to get app state during backup/restore&quot;, stackTrace);                              </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1108              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1109          }                                                                                                         </span>
<span class="5846627122202929436" onmouseenter="enter('5846627122202929436');" onmouseout="out('5846627122202929436');" style="">1110          mIconCache = appState.getIconCache();                                                                     </span>
<span class="-110431678061537477" onmouseenter="enter('-110431678061537477');" onmouseout="out('-110431678061537477');" style="">1111          return mIconCache != null;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1112      }                                                                                                             </span>
<span  style="">1113                                                                                                                    </span>
<span  style="">1114                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1115      /**                                                                                                           </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1116       * @return true if the launcher is in a state to support backup                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1117       */                                                                                                           </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1118      private boolean launcherIsReady() {                                                                           </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1119          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1120          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);                   </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1121          if (cursor == null) {                                                                                     </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1122              // launcher data has been wiped, do nothing                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1123              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1124          }                                                                                                         </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1125          cursor.close();                                                                                           </span>
<span  style="">1126                                                                                                                    </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="">1127          if (!initializeIconCache()) {                                                                             </span>

<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1128              // launcher services are unavailable, try again later                                                 </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="">1129              dataChanged();                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1130              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1131          }                                                                                                         </span>
<span  style="">1132                                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1133          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1134      }                                                                                                             </span>
<span  style="">1135                                                                                                                    </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1136      private String getUserSelectionArg() {                                                                        </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1137          return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                               </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1138                  .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1139      }                                                                                                             </span>
<span  style="">1140                                                                                                                    </span>
<span class="2300443005706538875" onmouseenter="enter('2300443005706538875');" onmouseout="out('2300443005706538875');" style="">1141      private class InvalidBackupException extends IOException {                                                    </span>
<span class="7118811970258264720" onmouseenter="enter('7118811970258264720');" onmouseout="out('7118811970258264720');" style="">1142          private InvalidBackupException(Throwable cause) {                                                         </span>





<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1143              super(cause);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1144          }                                                                                                         </span>
<span  style="">1145                                                                                                                    </span>
<span class="3383530736812522133" onmouseenter="enter('3383530736812522133');" onmouseout="out('3383530736812522133');" style="">1146          public InvalidBackupException(String reason) {                                                            </span>

<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1147              super(reason);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1148          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1149      }                                                                                                             </span>


















































<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1150  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            