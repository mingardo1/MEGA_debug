<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>516</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    516
                    <a href="515.html">prev</a>
                    <a href="517.html">next</a>
                    <a href="516_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Freeyourgadget/Gadgetbridge_10bf45201730458aa2e1fae97e27b47417237b98_app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;10bf45201730458aa2e1fae97e27b47417237b98:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;10bf45201730458aa2e1fae97e27b47417237b98^1:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;10bf45201730458aa2e1fae97e27b47417237b98^2:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;6f91e6053e945154331162c2009d0888ad2fbc7c:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bs], [b], [bj], [j], [j]], subset: [[bsj], [b], [bj], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="1906883787138771170" onmouseenter="enter('1906883787138771170');" onmouseout="out('1906883787138771170');" style="">   1 /*  Copyright (C) 2015-2020 abettenburg, Andreas Shimokawa, AndrewBedscastle,                            </span>
<span class="-3541979219390877329" onmouseenter="enter('-3541979219390877329');" onmouseout="out('-3541979219390877329');" style="">   2     Carsten Pfeiffer, Daniel Dakhno, Daniele Gobbetti, Frank Slezak, Hasan Ammar,                        </span>
<span class="-531692918395923150" onmouseenter="enter('-531692918395923150');" onmouseout="out('-531692918395923150');" style="">   3     JosÃ© Rebelo, Julien Pivotto, Kevin Richter, Matthieu Baerts, Normano64,                              </span>
<span class="1862847412929924698" onmouseenter="enter('1862847412929924698');" onmouseout="out('1862847412929924698');" style="">   4     Steffen Liebergeld, Taavi EomÃ¤e, veecue, Zhong Jianxin                                               </span>
<span  style="">   5                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   6     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   7                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   8     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   9     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">  10     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  11     (at your option) any later version.                                                                  </span>
<span  style="">  12                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  13     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  14     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  15     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  16     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  17                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  18     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  19     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  20 package nodomain.freeyourgadget.gadgetbridge.externalevents;                                             </span>
<span  style="">  21                                                                                                          </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  22 import android.app.ActivityManager;                                                                      </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  23 import android.app.Notification;                                                                         </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  24 import android.app.NotificationManager;                                                                  </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  25 import android.app.PendingIntent;                                                                        </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  26 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  27 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  28 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  29 import android.content.IntentFilter;                                                                     </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30 import android.content.pm.PackageManager;                                                                </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31 import android.graphics.Bitmap;                                                                          </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32 import android.graphics.Color;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34 import android.media.MediaMetadata;                                                                      </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  35 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  36 import android.os.PowerManager;                                                                          </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  37 import android.os.RemoteException;                                                                       </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  38 import android.service.notification.NotificationListenerService;                                         </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  39 import android.service.notification.StatusBarNotification;                                               </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  40 import android.support.v4.media.MediaMetadataCompat;                                                     </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  41 import android.support.v4.media.session.MediaControllerCompat;                                           </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  42 import android.support.v4.media.session.MediaSessionCompat;                                              </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  43 import android.support.v4.media.session.PlaybackStateCompat;                                             </span>
<span  style="">  44                                                                                                          </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="">  45 import androidx.annotation.NonNull;                                                                      </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="">  46 import androidx.core.app.NotificationCompat;                                                             </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="">  47 import androidx.core.app.RemoteInput;                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  48 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="">  49 import androidx.palette.graphics.Palette;                                                                </span>
<span  style="">  50                                                                                                          </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  51 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  52 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  53 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  54                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  55 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  56 import java.util.Collections;                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  57 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  58 import java.util.List;                                                                                   </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  59 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  60 import java.util.Set;                                                                                    </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  61 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  62                                                                                                          </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  63 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  64 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  65 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  66 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  67 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  68 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  69 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  70 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  71 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  72 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="">  73 import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                   </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  74 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="1593353296711823731" onmouseenter="enter('1593353296711823731');" onmouseout="out('1593353296711823731');" style="">  75 import nodomain.freeyourgadget.gadgetbridge.model.DeviceType;                                            </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  76 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  77 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  78 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="">  79 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                      </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  80 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  81 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  82 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  83 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  84 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span  style="">  85                                                                                                          </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="">  86 import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                          </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title="  87 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;">  87 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title="  88 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;">  88 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title="  89 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;">  89 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span  style="">  90                                                                                                          </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  91 public class NotificationListener extends NotificationListenerService {                                  </span>
<span  style="">  92                                                                                                          </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  93     private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);               </span>
<span  style="">  94                                                                                                          </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  95     public static final String ACTION_DISMISS                                                            </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  96             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  97     public static final String ACTION_DISMISS_ALL                                                        </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style="">  98             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;            </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style="">  99     public static final String ACTION_OPEN                                                               </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style=""> 100             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                   </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style=""> 101     public static final String ACTION_MUTE                                                               </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style=""> 102             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                   </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style=""> 103     public static final String ACTION_REPLY                                                              </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 104             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                  </span>
<span  style=""> 105                                                                                                          </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 106     private LimitedQueue mActionLookup = new LimitedQueue(32);                                           </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 107     private LimitedQueue mPackageLookup = new LimitedQueue(64);                                          </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 108     private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                              </span>
<span  style=""> 109                                                                                                          </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 110     private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                         </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 111     private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                     </span>
<span  style=""> 112                                                                                                          </span>
<span class="8101473837509778470" onmouseenter="enter('8101473837509778470');" onmouseout="out('8101473837509778470');" style=""> 113     private static final Set&lt;String&gt; GROUP_SUMMARY_WHITELIST = Collections.singleton(                    </span>
<span class="-8080841529654579062" onmouseenter="enter('-8080841529654579062');" onmouseout="out('-8080841529654579062');" style=""> 114             &quot;mikado.bizcalpro&quot;                                                                           </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 115     );                                                                                                   </span>
<span  style=""> 116                                                                                                          </span>
<span class="-3455620612898728599" onmouseenter="enter('-3455620612898728599');" onmouseout="out('-3455620612898728599');" style=""> 117     public static ArrayList&lt;String&gt; notificationStack = new ArrayList&lt;&gt;();                               </span>
<span  style=""> 118                                                                                                          </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 119     private long activeCallPostTime;                                                                     </span>
<span class="-3341855908928415567" onmouseenter="enter('-3341855908928415567');" onmouseout="out('-3341855908928415567');" style=""> 120     private int mLastCallCommand = CallSpec.CALL_UNDEFINED;                                              </span>
<span  style=""> 121                                                                                                          </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 122     private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                </span>
<span  style=""> 123                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 124         @Override                                                                                        </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 125         public void onReceive(Context context, Intent intent) {                                          </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 126             String action = intent.getAction();                                                          </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 127             if (action == null) {                                                                        </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 128                 LOG.warn(&quot;no action&quot;);                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 129                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130             }                                                                                            </span>
<span  style=""> 131                                                                                                          </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 132             int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                        </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 133             switch (action) {                                                                            </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 134                 case GBApplication.ACTION_QUIT:                                                          </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 135                     stopSelf();                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 136                     break;                                                                               </span>
<span  style=""> 137                                                                                                          </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 138                 case ACTION_OPEN: {                                                                      </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 139                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 140                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 141                     if (ts == null) {                                                                    </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 142                         LOG.info(&quot;could not lookup handle for open action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 143                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                     }                                                                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 146                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 147                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148                             try {                                                                        </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 149                                 PendingIntent pi = sbn.getNotification().contentIntent;                  </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 150                                 if (pi != null) {                                                        </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 151                                     pi.send();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                                 }                                                                        </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 153                             } catch (PendingIntent.CanceledException e) {                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 154                                 e.printStackTrace();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 158                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                 }                                                                                        </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 160                 case ACTION_MUTE:                                                                        </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 161                     String packageName = (String) mPackageLookup.lookup(handle);                         </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 162                     if (packageName == null) {                                                           </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 163                         LOG.info(&quot;could not lookup handle for mute action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 164                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                     }                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 167                     LOG.info(&quot;going to mute &quot; + packageName);                                            </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 168                     GBApplication.addAppToNotifBlacklist(packageName);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 169                     break;                                                                               </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 170                 case ACTION_DISMISS: {                                                                   </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 171                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 172                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 173                     if (ts == null) {                                                                    </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 174                         LOG.info(&quot;could not lookup handle for dismiss action&quot;);                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 175                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                     }                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 177                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 178                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 179                             if (GBApplication.isRunningLollipopOrLater()) {                              </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 180                                 String key = sbn.getKey();                                               </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 181                                 NotificationListener.this.cancelNotification(key);                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182                             } else {                                                                     </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 183                                 int id = sbn.getId();                                                    </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 184                                 String pkg = sbn.getPackageName();                                       </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 185                                 String tag = sbn.getTag();                                               </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 186                                 NotificationListener.this.cancelNotification(pkg, tag, id);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 190                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                 }                                                                                        </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 192                 case ACTION_DISMISS_ALL:                                                                 </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 193                     NotificationListener.this.cancelAllNotifications();                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 194                     break;                                                                               </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 195                 case ACTION_REPLY:                                                                       </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 196                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 196                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.ðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 197                     String reply = intent.getStringExtra(&quot;reply&quot;);                                       </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 198                     if (wearableAction != null) {                                                        </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 199                         PendingIntent actionIntent = wearableAction.getActionIntent();                   </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 200                         Intent localIntent = new Intent();                                               </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 201                         localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                             </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 202                         if(wearableAction.getRemoteInputs()!=null) {                                     </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 203                             RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();               </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 204                             Bundle extras = new Bundle();                                                </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 205                             extras.putCharSequence(remoteInputs[0].getResultKey(), reply);               </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 206                             RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 208                         try {                                                                            </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 209                             LOG.info(&quot;will send exec intent to remote application&quot;);                     </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 210                             actionIntent.send(context, 0, localIntent);                                  </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 211                             mActionLookup.remove(handle);                                                </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 212                         } catch (PendingIntent.CanceledException e) {                                    </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 213                             LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 216                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 219     };                                                                                                   </span>
<span  style=""> 220                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 221     @Override                                                                                            </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 222     public void onCreate() {                                                                             </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 223         super.onCreate();                                                                                </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 224         IntentFilter filterLocal = new IntentFilter();                                                   </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 225         filterLocal.addAction(GBApplication.ACTION_QUIT);                                                </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 226         filterLocal.addAction(ACTION_OPEN);                                                              </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 227         filterLocal.addAction(ACTION_DISMISS);                                                           </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 228         filterLocal.addAction(ACTION_DISMISS_ALL);                                                       </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 229         filterLocal.addAction(ACTION_MUTE);                                                              </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 230         filterLocal.addAction(ACTION_REPLY);                                                             </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 231         LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234     @Override                                                                                            </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 235     public void onDestroy() {                                                                            </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 236         LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                           </span>
<span class="-3610691555806270699" onmouseenter="enter('-3610691555806270699');" onmouseout="out('-3610691555806270699');" style=""> 237         notificationStack.clear();                                                                       </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 238         super.onDestroy();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239     }                                                                                                    </span>
<span  style=""> 240                                                                                                          </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 241     public String getAppName(String pkg) {                                                               </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 242         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 243         PackageManager pm = getPackageManager();                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 244         try {                                                                                            </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style=""> 245             return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                        </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 246         } catch (PackageManager.NameNotFoundException e) {                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 247             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 249         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250     }                                                                                                    </span>
<span  style=""> 251                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 252     @Override                                                                                            </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 253     public void onNotificationPosted(StatusBarNotification sbn) {                                        </span>
<span class="-1858334129449927430" onmouseenter="enter('-1858334129449927430');" onmouseout="out('-1858334129449927430');" style=""> 254         logNotification(sbn, true);                                                                      </span>
<span  style=""> 255                                                                                                          </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 256         notificationStack.remove(sbn.getPackageName());                                                  </span>
<span class="6183718114314290730" onmouseenter="enter('6183718114314290730');" onmouseout="out('6183718114314290730');" style=""> 257         notificationStack.add(sbn.getPackageName());                                                     </span>
<span  style=""> 258                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 259 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-8448425987946302452" onmouseenter="enter('-8448425987946302452');" onmouseout="out('-8448425987946302452');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 261             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {"> 261             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_vðŸ”µ</abbr></span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266                                                                                                          </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="4755371366859202493" onmouseenter="enter('4755371366859202493');" onmouseout="out('4755371366859202493');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 268             if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to allow phone alarm notification"> 268             if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to ðŸ”µ</abbr></span>
<span class="2012465491164047553" onmouseenter="enter('2012465491164047553');" onmouseout="out('2012465491164047553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269                 LOG.info(&quot;Ignore notification: &quot; + sbn.getPackageName());               // need to fix   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271             }                                                                                            </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 272 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-8448425987946302452" onmouseenter="enter('-8448425987946302452');" onmouseout="out('-8448425987946302452');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 273             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {"> 273             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_vðŸ”µ</abbr></span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         }                                                                                                </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279             LOG.info(&quot;Ignore notification&quot;);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282                                                                                                          </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         switch (GBApplication.getGrantedInterruptionFilter()) {                                          </span>
<span class="4109165554183544277" onmouseenter="enter('4109165554183544277');" onmouseout="out('4109165554183544277');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284             case NotificationManager.INTERRUPTION_FILTER_ALL:                                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 285 =======                                                                                                  </span>
<span class="4991954782201742281" onmouseenter="enter('4991954782201742281');" onmouseout="out('4991954782201742281');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         if (shouldIgnoreNotifications()) return;                                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287                                                                                                          </span>
<span class="4264709970930991859" onmouseenter="enter('4264709970930991859');" onmouseout="out('4264709970930991859');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288         if (shouldIgnoreSource(sbn)) {                                                                   </span>
<span class="4946725858664366504" onmouseenter="enter('4946725858664366504');" onmouseout="out('4946725858664366504');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289             LOG.debug(&quot;Ignoring notification source&quot;);                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290             return;                                                                                      </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 291 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292         }                                                                                                </span>
<span  style=""> 293                                                                                                          </span>
<span class="4712720955611963966" onmouseenter="enter('4712720955611963966');" onmouseout="out('4712720955611963966');" style=""> 294         if (handleMediaSessionNotification(sbn)) return;                                                 </span>
<span  style=""> 295                                                                                                          </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 296         switch (GBApplication.getGrantedInterruptionFilter()) {                                          </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 297             case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                         </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 298             case NotificationManager.INTERRUPTION_FILTER_NONE:                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 299                 return;                                                                                  </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 300             case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                       </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 301                 // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 302                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303         }                                                                                                </span>
<span  style=""> 304                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 305         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 306         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-8969748416921643208" onmouseenter="enter('-8969748416921643208');" onmouseout="out('-8969748416921643208');" style=""> 307             if (NotificationCompat.CATEGORY_CALL.equals(sbn.getNotification().category)                  </span>
<span class="-2610866924656962115" onmouseenter="enter('-2610866924656962115');" onmouseout="out('-2610866924656962115');" style=""> 308                     &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {                     </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style=""> 309                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 310                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312         }                                                                                                </span>
<span  style=""> 313                                                                                                          </span>
<span class="-7697907629896539664" onmouseenter="enter('-7697907629896539664');" onmouseout="out('-7697907629896539664');" style=""> 314         if (shouldIgnoreNotification(sbn)) {                                                             </span>
<span class="5145250427849470730" onmouseenter="enter('5145250427849470730');" onmouseout="out('5145250427849470730');" style=""> 315             LOG.info(&quot;Ignoring notification&quot;);                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 316             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span  style=""> 318                                                                                                          </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 319         String source = sbn.getPackageName().toLowerCase();                                              </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 320         Notification notification = sbn.getNotification();                                               </span>
<span  style=""> 321                                                                                                          </span>
<span class="-1441185864931598228" onmouseenter="enter('-1441185864931598228');" onmouseout="out('-1441185864931598228');" style=""> 322         Long notificationOldRepeatPreventionValue = notificationOldRepeatPrevention.get(source);         </span>
<span class="-2948904860852754633" onmouseenter="enter('-2948904860852754633');" onmouseout="out('-2948904860852754633');" style=""> 323         if (notificationOldRepeatPreventionValue != null                                                 </span>
<span class="-8958216021585134671" onmouseenter="enter('-8958216021585134671');" onmouseout="out('-8958216021585134671');" style=""> 324                 &amp;&amp; notification.when &lt;= notificationOldRepeatPreventionValue) {                          </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""> 325             LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;); </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 326             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327         }                                                                                                </span>
<span  style=""> 328                                                                                                          </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 329         // Ignore too frequent notifications, according to user preference                               </span>
<span class="6854200181184360965" onmouseenter="enter('6854200181184360965');" onmouseout="out('6854200181184360965');" style=""> 330         long curTime = System.nanoTime();                                                                </span>
<span class="-1119754415295906213" onmouseenter="enter('-1119754415295906213');" onmouseout="out('-1119754415295906213');" style=""> 331         Long notificationBurstPreventionValue = notificationBurstPrevention.get(source);                 </span>
<span class="3983885705215150872" onmouseenter="enter('3983885705215150872');" onmouseout="out('3983885705215150872');" style=""> 332         if (notificationBurstPreventionValue != null) {                                                  </span>
<span class="-4450214003094206879" onmouseenter="enter('-4450214003094206879');" onmouseout="out('-4450214003094206879');" style=""> 333             long diff = curTime - notificationBurstPreventionValue;                                      </span>
<span class="-2015672682083463299" onmouseenter="enter('-2015672682083463299');" onmouseout="out('-2015672682083463299');" style=""> 334             if (diff &lt; TimeUnit.SECONDS.toNanos(prefs.getInt(&quot;notifications_timeout&quot;, 0))) {             </span>
<span class="-7079262005450253436" onmouseenter="enter('-7079262005450253436');" onmouseout="out('-7079262005450253436');" style=""> 335                 LOG.info(&quot;Ignoring frequent notification, last one was &quot;                                 </span>
<span class="6353466646675639227" onmouseenter="enter('6353466646675639227');" onmouseout="out('6353466646675639227');" style=""> 336                         + TimeUnit.NANOSECONDS.toMillis(diff) + &quot;ms ago&quot;);                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 337                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339         }                                                                                                </span>
<span  style=""> 340                                                                                                          </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 341         NotificationSpec notificationSpec = new NotificationSpec();                                      </span>
<span  style=""> 342                                                                                                          </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 343         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 344         String name = getAppName(source);                                                                </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 345         if (name != null) {                                                                              </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 346             notificationSpec.sourceName = name;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347         }                                                                                                </span>
<span  style=""> 348                                                                                                          </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 349         boolean preferBigText = false;                                                                   </span>
<span  style=""> 350                                                                                                          </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 351         // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 351         // Get the app ID that generated this notification. For now only used by pebble color, but may beðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 352         notificationSpec.sourceAppId = source;                                                           </span>
<span  style=""> 353                                                                                                          </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 354         notificationSpec.type = AppNotificationType.getInstance().get(source);                           </span>
<span  style=""> 355                                                                                                          </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 356         //FIXME: some quirks lookup table would be the minor evil here                                   </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 357         if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                          </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 358             if (NotificationCompat.isGroupSummary(notification)) {                                       </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 359                 LOG.info(&quot;ignore K9 group summary&quot;);                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 360                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361             }                                                                                            </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 362             preferBigText = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363         }                                                                                                </span>
<span  style=""> 364                                                                                                          </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 365         if (notificationSpec.type == null) {                                                             </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 366             notificationSpec.type = NotificationType.UNKNOWN;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367         }                                                                                                </span>
<span  style=""> 368                                                                                                          </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 369         // Get color                                                                                     </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 370         notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                  </span>
<span  style=""> 371                                                                                                          </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 372         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 372         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMiðŸ”µ</abbr></span>
<span  style=""> 373                                                                                                          </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 374         dissectNotificationTo(notification, notificationSpec, preferBigText);                            </span>
<span  style=""> 375                                                                                                          </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 376         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 376         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificatioðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 377             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378         }                                                                                                </span>
<span  style=""> 379                                                                                                          </span>
<span  style=""> 380                                                                                                          </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 381         // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen          </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 382         if (getApplicationContext().getPackageName().equals(source)) {                                   </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""><abbr title=" 383             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {"> 383             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.tiðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 384                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386         }                                                                                                </span>
<span  style=""> 387                                                                                                          </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 388         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 388         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(noðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 389         List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                         </span>
<span  style=""> 390                                                                                                          </span>
<span  style=""> 391                                                                                                          </span>
<span class="-5165487096538852929" onmouseenter="enter('-5165487096538852929');" onmouseout="out('-5165487096538852929');" style=""> 392         if (actions.isEmpty() &amp;&amp; NotificationCompat.isGroupSummary(notification)                         </span>
<span class="-390635856025090115" onmouseenter="enter('-390635856025090115');" onmouseout="out('-390635856025090115');" style=""> 393                 &amp;&amp; !GROUP_SUMMARY_WHITELIST.contains(source)) { //this could cause #395 to come back     </span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 394             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 394             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action preseðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 395             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396         }                                                                                                </span>
<span  style=""> 397                                                                                                          </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 398         notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                            </span>
<span  style=""> 399                                                                                                          </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 400         // DISMISS action                                                                                </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 401         NotificationSpec.Action dismissAction = new NotificationSpec.Action();                           </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 402         dismissAction.title = &quot;Dismiss&quot;;                                                                 </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 403         dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                             </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 404         notificationSpec.attachedActions.add(dismissAction);                                             </span>
<span  style=""> 405                                                                                                          </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 406         for (NotificationCompat.Action act : actions) {                                                  </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 407             if (act != null) {                                                                           </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 408                 NotificationSpec.Action wearableAction = new NotificationSpec.Action();                  </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 409                 wearableAction.title = act.getTitle().toString();                                        </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 410                 if(act.getRemoteInputs()!=null) {                                                        </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 411                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 412                 } else {                                                                                 </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 413                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414                 }                                                                                        </span>
<span  style=""> 415                                                                                                          </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 416                 notificationSpec.attachedActions.add(wearableAction);                                    </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""><abbr title=" 417                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);"> 417                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size()ðŸ”µ</abbr></span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 418                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 418                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ actðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 419             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span  style=""> 421                                                                                                          </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 422         // OPEN action                                                                                   </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 423         NotificationSpec.Action openAction = new NotificationSpec.Action();                              </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 424         openAction.title = getString(R.string._pebble_watch_open_on_phone);                              </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 425         openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                   </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 426         notificationSpec.attachedActions.add(openAction);                                                </span>
<span  style=""> 427                                                                                                          </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 428         // MUTE action                                                                                   </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 429         NotificationSpec.Action muteAction = new NotificationSpec.Action();                              </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 430         muteAction.title = getString(R.string._pebble_watch_mute);                                       </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 431         muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                   </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 432         notificationSpec.attachedActions.add(muteAction);                                                </span>
<span  style=""> 433                                                                                                          </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""><abbr title=" 434         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN"> 434         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS aðŸ”µ</abbr></span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 435         mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                  </span>
<span  style=""> 436                                                                                                          </span>
<span class="-240819969350733584" onmouseenter="enter('-240819969350733584');" onmouseout="out('-240819969350733584');" style=""> 437         notificationBurstPrevention.put(source, curTime);                                                </span>
<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style=""> 438         if(0 != notification.when) {                                                                     </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 439             notificationOldRepeatPrevention.put(source, notification.when);                              </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 440         }else {                                                                                          </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""><abbr title=" 441             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);"> 441             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + souðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442         }                                                                                                </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 443         GBApplication.deviceService().onNotification(notificationSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444     }                                                                                                    </span>
<span  style=""> 445                                                                                                          </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 446     private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {      </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 447         long start = System.currentTimeMillis();                                                         </span>
<span  style=""> 448                                                                                                          </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 449         List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                      </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 450         NotificationFilter notificationFilter;                                                           </span>
<span  style=""> 451                                                                                                          </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 452         try (DBHandler db = GBApplication.acquireDB()) {                                                 </span>
<span  style=""> 453                                                                                                          </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 454             NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao(); </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 455             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 455             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilðŸ”µ</abbr></span>
<span  style=""> 456                                                                                                          </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 457             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 457             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFiltðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 458             notificationFilter = query.unique();                                                         </span>
<span  style=""> 459                                                                                                          </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 460             if (notificationFilter == null) {                                                            </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 461                 LOG.debug(&quot;No Notification Filter found&quot;);                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 462                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463             }                                                                                            </span>
<span  style=""> 464                                                                                                          </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 465             LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                               </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 466             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 466             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().whereðŸ”µ</abbr></span>
<span  style=""> 467                                                                                                          </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 468             List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                           </span>
<span  style=""> 469                                                                                                          </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 470             if (BuildConfig.DEBUG) {                                                                     </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 471                 LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472             }                                                                                            </span>
<span  style=""> 473                                                                                                          </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 474             if (!filterEntries.isEmpty()) {                                                              </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 475                 for (NotificationFilterEntry temp : filterEntries) {                                     </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 476                     wordsList.add(temp.getNotificationFilterContent());                                  </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 477                     LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479             }                                                                                            </span>
<span  style=""> 480                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 481         } catch (Exception e) {                                                                          </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 482             LOG.error(&quot;Could not acquire DB.&quot;, e);                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 483             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484         }                                                                                                </span>
<span  style=""> 485                                                                                                          </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 486         return shouldContinueAfterFilter(body, wordsList, notificationFilter);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487     }                                                                                                    </span>
<span  style=""> 488                                                                                                          </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 489     private void handleCallNotification(StatusBarNotification sbn) {                                     </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 490         String app = sbn.getPackageName();                                                               </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 491         LOG.debug(&quot;got call from: &quot; + app);                                                              </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style=""> 492         if(app.equals(&quot;com.android.dialer&quot;)) {                                                           </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 493             LOG.debug(&quot;Ignoring non-voip call&quot;);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 494             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495         }                                                                                                </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 496         Notification noti = sbn.getNotification();                                                       </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 497         dumpExtras(noti.extras);                                                                         </span>
<span class="-894861467263649997" onmouseenter="enter('-894861467263649997');" onmouseout="out('-894861467263649997');" style=""> 498         boolean callStarted = false;                                                                     </span>
<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style=""> 499         if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                            </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 500             for (Notification.Action action : noti.actions) {                                            </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 501                 LOG.info(&quot;Found call action: &quot; + action.title);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502             }                                                                                            </span>
<span class="150001560550536139" onmouseenter="enter('150001560550536139');" onmouseout="out('150001560550536139');" style=""> 503             if (noti.actions.length == 1) {                                                              </span>
<span class="1124706287521813013" onmouseenter="enter('1124706287521813013');" onmouseout="out('1124706287521813013');" style=""> 504                 if (mLastCallCommand == CallSpec.CALL_INCOMING) {                                        </span>
<span class="-8019351633415130414" onmouseenter="enter('-8019351633415130414');" onmouseout="out('-8019351633415130414');" style=""><abbr title=" 505                     LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuming call started&quot;);"> 505                     LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuminðŸ”µ</abbr></span>
<span class="3182682807764059315" onmouseenter="enter('3182682807764059315');" onmouseout="out('3182682807764059315');" style=""> 506                     callStarted = true;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 507                 } else {                                                                                 </span>
<span class="-4501418827174237895" onmouseenter="enter('-4501418827174237895');" onmouseout="out('-4501418827174237895');" style=""><abbr title=" 508                     LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assuming outgoing call / duplicate notification and ignoring&quot;);"> 508                     LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assðŸ”µ</abbr></span>
<span class="-8333753567790744727" onmouseenter="enter('-8333753567790744727');" onmouseout="out('-8333753567790744727');" style=""><abbr title=" 509                     // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more complete VoIP call state tracking?"> 509                     // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more coðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 510                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512             }                                                                                            </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 513             /*try {                                                                                      </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 514                 LOG.info(&quot;Executing first action&quot;);                                                      </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 515                 noti.actions[0].actionIntent.send();                                                     </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 516             } catch (PendingIntent.CanceledException e) {                                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 517                 e.printStackTrace();                                                                     </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 518             }*/                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519         }                                                                                                </span>
<span  style=""> 520                                                                                                          </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 521         // figure out sender                                                                             </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 522         String number;                                                                                   </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style=""> 523         if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                         </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 524             number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                   </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style=""> 525         } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                   </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 526             number = noti.extras.getString(Notification.EXTRA_TITLE);                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 527         } else {                                                                                         </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 528             String appName = getAppName(app);                                                            </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style=""> 529             number = appName != null ? appName : app;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530         }                                                                                                </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 531         activeCallPostTime = sbn.getPostTime();                                                          </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 532         CallSpec callSpec = new CallSpec();                                                              </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 533         callSpec.number = number;                                                                        </span>
<span class="-7145633475877048589" onmouseenter="enter('-7145633475877048589');" onmouseout="out('-7145633475877048589');" style=""> 534         callSpec.command = callStarted ? CallSpec.CALL_START : CallSpec.CALL_INCOMING;                   </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style=""> 535         mLastCallCommand = callSpec.command;                                                             </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 536         GBApplication.deviceService().onSetCallState(callSpec);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 537     }                                                                                                    </span>
<span  style=""> 538                                                                                                          </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 539     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 539     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotðŸ”µ</abbr></span>
<span  style=""> 540                                                                                                          </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 541         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 541         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterModðŸ”µ</abbr></span>
<span  style=""> 542                                                                                                          </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""><abbr title=" 543         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;"> 543         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODðŸ”µ</abbr></span>
<span  style=""> 544                                                                                                          </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 545         switch (notificationFilter.getNotificationFilterMode()) {                                        </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 546             case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 547                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 548                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 549                         if (!body.contains(word)) {                                                      </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""><abbr title=" 550                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;);"> 550                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing contiðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 551                             return true;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553                     }                                                                                    </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 554                     LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 555                     return false;                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 556                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 557                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 557                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 558                     if (!containsAny) {                                                                  </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""><abbr title=" 559                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);"> 559                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continuðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 560                     } else {                                                                             </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""><abbr title=" 561                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);"> 561                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562                     }                                                                                    </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 563                     return !containsAny;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564                 }                                                                                        </span>
<span  style=""> 565                                                                                                          </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 566             case NOTIFICATION_FILTER_MODE_WHITELIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 567                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 568                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 569                         if (!body.contains(word)) {                                                      </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""><abbr title=" 570                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);"> 570                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stopsðŸ”µ</abbr></span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 571                             return false;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573                     }                                                                                    </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 574                     LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 575                     return true;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 576                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 577                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 577                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 578                     if (containsAny) {                                                                   </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 579                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 579                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 580                     } else {                                                                             </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""><abbr title=" 581                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);"> 581                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 582                     }                                                                                    </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 583                     return containsAny;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584                 }                                                                                        </span>
<span  style=""> 585                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 586             default:                                                                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 587                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589     }                                                                                                    </span>
<span  style=""> 590                                                                                                          </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 591     // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons    </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 592     private String sanitizeUnicode(String orig) {                                                        </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 593         return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594     }                                                                                                    </span>
<span  style=""> 595                                                                                                          </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 596     private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,     </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 597                                        boolean preferBigText) {                                          </span>
<span  style=""> 598                                                                                                          </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 599         Bundle extras = NotificationCompat.getExtras(notification);                                      </span>
<span  style=""> 600                                                                                                          </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 601         //dumpExtras(extras);                                                                            </span>
<span class="3231714309982698113" onmouseenter="enter('3231714309982698113');" onmouseout="out('3231714309982698113');" style=""> 602         if (extras == null) {                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 603             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604         }                                                                                                </span>
<span  style=""> 605                                                                                                          </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 606         CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                           </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 607         if (title != null) {                                                                             </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 608             notificationSpec.title = sanitizeUnicode(title.toString());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609         }                                                                                                </span>
<span  style=""> 610                                                                                                          </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 611         CharSequence contentCS = null;                                                                   </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 612         if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                          </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 613             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                       </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 614         } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                        </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 615             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616         }                                                                                                </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 617         if (contentCS != null) {                                                                         </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 618             notificationSpec.body = sanitizeUnicode(contentCS.toString());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619         }                                                                                                </span>
<span  style=""> 620                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621     }                                                                                                    </span>
<span  style=""> 622                                                                                                          </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 623     private boolean isServiceRunning() {                                                                 </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 624         ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                  </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 625         if (manager == null) {                                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 626             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627         }                                                                                                </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""><abbr title=" 628         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {"> 628         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) ðŸ”µ</abbr></span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 629             if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 630                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 633         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634     }                                                                                                    </span>
<span  style=""> 635                                                                                                          </span>
<span class="5320463064367359781" onmouseenter="enter('5320463064367359781');" onmouseout="out('5320463064367359781');" style=""> 636     private boolean handleMediaSessionNotification(StatusBarNotification sbn) {                          </span>
<span class="-4962670587938601541" onmouseenter="enter('-4962670587938601541');" onmouseout="out('-4962670587938601541');" style=""> 637         MediaSessionCompat.Token mediaSession = getMediaSession(sbn.getNotification());                  </span>
<span class="-7622006372947125189" onmouseenter="enter('-7622006372947125189');" onmouseout="out('-7622006372947125189');" style=""> 638         return mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639     }                                                                                                    </span>
<span  style=""> 640                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 641     /**                                                                                                  </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 642      * Try to handle media session notifications that tell info about the current play state.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 643      *                                                                                                   </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 644      * @param mediaSession The mediasession to handle.                                                   </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 645      * @return true if notification was handled, false otherwise                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 646      */                                                                                                  </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 647     public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {               </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 648         MusicSpec musicSpec = new MusicSpec();                                                           </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 649         MusicStateSpec stateSpec = new MusicStateSpec();                                                 </span>
<span  style=""> 650                                                                                                          </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 651         MediaControllerCompat c;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 652         try {                                                                                            </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 653             c = new MediaControllerCompat(getApplicationContext(), mediaSession);                        </span>
<span  style=""> 654                                                                                                          </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 655             PlaybackStateCompat s = c.getPlaybackState();                                                </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 656             stateSpec.position = (int) (s.getPosition() / 1000);                                         </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 657             stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                 </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 658             stateSpec.repeat = 1;                                                                        </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 659             stateSpec.shuffle = 1;                                                                       </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 660             switch (s.getState()) {                                                                      </span>
<span class="-5763838617161449343" onmouseenter="enter('-5763838617161449343');" onmouseout="out('-5763838617161449343');" style=""> 661                 case PlaybackStateCompat.STATE_PLAYING:                                                  </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 662                     stateSpec.state = MusicStateSpec.STATE_PLAYING;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 663                     break;                                                                               </span>
<span class="4559404571574135097" onmouseenter="enter('4559404571574135097');" onmouseout="out('4559404571574135097');" style=""> 664                 case PlaybackStateCompat.STATE_STOPPED:                                                  </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 665                     stateSpec.state = MusicStateSpec.STATE_STOPPED;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 666                     break;                                                                               </span>
<span class="1489652375659370630" onmouseenter="enter('1489652375659370630');" onmouseout="out('1489652375659370630');" style=""> 667                 case PlaybackStateCompat.STATE_PAUSED:                                                   </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 668                     stateSpec.state = MusicStateSpec.STATE_PAUSED;                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 669                     break;                                                                               </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 670                 default:                                                                                 </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 671                     stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 672                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 673             }                                                                                            </span>
<span  style=""> 674                                                                                                          </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 675             MediaMetadataCompat d = c.getMetadata();                                                     </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 676             if (d == null)                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 677                 return false;                                                                            </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 678             if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                        </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 679                 musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                 </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 680             if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                         </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 681                 musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                   </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 682             if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                         </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 683                 musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                   </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 684             if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                      </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 685                 musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;  </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 686             if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                    </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 687                 musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);     </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 688             if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                  </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 689                 musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);      </span>
<span  style=""> 690                                                                                                          </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 691             // finally, tell the device about it                                                         </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 692             GBApplication.deviceService().onSetMusicInfo(musicSpec);                                     </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 693             GBApplication.deviceService().onSetMusicState(stateSpec);                                    </span>
<span  style=""> 694                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 695             return true;                                                                                 </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 696         } catch (NullPointerException | RemoteException e) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 697             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699     }                                                                                                    </span>
<span  style=""> 700                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 701     @Override                                                                                            </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 702     public void onNotificationRemoved(StatusBarNotification sbn) {                                       </span>
<span class="6067501100626656036" onmouseenter="enter('6067501100626656036');" onmouseout="out('6067501100626656036');" style=""> 703         logNotification(sbn, false);                                                                     </span>
<span  style=""> 704                                                                                                          </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 705         notificationStack.remove(sbn.getPackageName());                                                  </span>
<span  style=""> 706                                                                                                          </span>
<span class="4991954782201742281" onmouseenter="enter('4991954782201742281');" onmouseout="out('4991954782201742281');" style=""> 707         if (shouldIgnoreNotifications()) return;                                                         </span>
<span class="-8648926181838166573" onmouseenter="enter('-8648926181838166573');" onmouseout="out('-8648926181838166573');" style=""> 708         if (shouldIgnoreSource(sbn)) return;                                                             </span>
<span  style=""> 709                                                                                                          </span>
<span class="4712720955611963966" onmouseenter="enter('4712720955611963966');" onmouseout="out('4712720955611963966');" style=""> 710         if (handleMediaSessionNotification(sbn)) return;                                                 </span>
<span  style=""> 711                                                                                                          </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 712         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="809759750927856809" onmouseenter="enter('809759750927856809');" onmouseout="out('809759750927856809');" style=""> 713             if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category)                         </span>
<span class="-9057216622014896702" onmouseenter="enter('-9057216622014896702');" onmouseout="out('-9057216622014896702');" style=""> 714                     &amp;&amp; activeCallPostTime == sbn.getPostTime()) {                                        </span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style=""> 715                 activeCallPostTime = 0;                                                                  </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 716                 CallSpec callSpec = new CallSpec();                                                      </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style=""> 717                 callSpec.command = CallSpec.CALL_END;                                                    </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style=""> 718                 mLastCallCommand = callSpec.command;                                                     </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 719                 GBApplication.deviceService().onSetCallState(callSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721         }                                                                                                </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 722         // FIXME: DISABLED for now                                                                       </span>
<span  style=""> 723                                                                                                          </span>
<span class="8463134039225075309" onmouseenter="enter('8463134039225075309');" onmouseout="out('8463134039225075309');" style=""> 724         if (shouldIgnoreNotification(sbn)) return;                                                       </span>
<span  style=""> 725                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 726         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-1296834313751396403" onmouseenter="enter('-1296834313751396403');" onmouseout="out('-1296834313751396403');" style=""> 727         if (prefs.getBoolean(&quot;autoremove_notifications&quot;, true)) {                                        </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 728             LOG.info(&quot;notification removed, will ask device to delete it&quot;);                              </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 729             GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 730         }                                                                                                </span>
<span  style=""> 731                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732     }                                                                                                    </span>
<span  style=""> 733                                                                                                          </span>
<span class="-2321374120209641351" onmouseenter="enter('-2321374120209641351');" onmouseout="out('-2321374120209641351');" style=""> 734     private void logNotification(StatusBarNotification sbn, boolean posted) {                            </span>
<span class="1002552013175598925" onmouseenter="enter('1002552013175598925');" onmouseout="out('1002552013175598925');" style=""> 735         String infoMsg = (posted ? &quot;Notification posted&quot; : &quot;Notification removed&quot;)                       </span>
<span class="7538128381914780026" onmouseenter="enter('7538128381914780026');" onmouseout="out('7538128381914780026');" style=""> 736                 + &quot;: &quot; + sbn.getPackageName();                                                           </span>
<span  style=""> 737                                                                                                          </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 738         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-2325475546032777056" onmouseenter="enter('-2325475546032777056');" onmouseout="out('-2325475546032777056');" style=""> 739             infoMsg += &quot;: &quot; + sbn.getNotification().category;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740         }                                                                                                </span>
<span  style=""> 741                                                                                                          </span>
<span class="-8299794314619245363" onmouseenter="enter('-8299794314619245363');" onmouseout="out('-8299794314619245363');" style=""> 742         LOG.debug(infoMsg);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743     }                                                                                                    </span>
<span  style=""> 744                                                                                                          </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 745     private void dumpExtras(Bundle bundle) {                                                             </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 746         for (String key : bundle.keySet()) {                                                             </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 747             Object value = bundle.get(key);                                                              </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 748             if (value == null) {                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 749                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750             }                                                                                            </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 751             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 751             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 752         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753     }                                                                                                    </span>
<span  style=""> 754                                                                                                          </span>
<span  style=""> 755                                                                                                          </span>
<span class="-3948619442008818904" onmouseenter="enter('-3948619442008818904');" onmouseout="out('-3948619442008818904');" style=""> 756     private boolean shouldIgnoreNotifications() {                                                        </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 757         /*                                                                                               </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 758          * return early if DeviceCommunicationService is not running,                                    </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 759          * else the service would get started every time we get a notification.                          </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 760          * unfortunately we cannot enable/disable NotificationListener at runtime like we do with        </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 761          * broadcast receivers because it seems to invalidate the permissions that are                   </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 762          * necessary for NotificationListenerService                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 763          */                                                                                              </span>
<span class="1533232748109360412" onmouseenter="enter('1533232748109360412');" onmouseout="out('1533232748109360412');" style=""> 764         if (!isServiceRunning()) {                                                                       </span>
<span class="4366338841311618901" onmouseenter="enter('4366338841311618901');" onmouseout="out('4366338841311618901');" style=""> 765             LOG.trace(&quot;Service is not running, ignoring notification&quot;);                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 766             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767         }                                                                                                </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 768 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 769         return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                     </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 770                 sbn.getNotification(), sbn.getPackageName());                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 771                                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 772 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 773     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 774                                                                                                          </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 775     private boolean shouldIgnoreSource(String source) {                                                  </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 776         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 777                                                                                                          </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 778         /* do not display messages from &quot;android&quot;                                                        </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 779          * This includes keyboard selection message, usb connection messages, etc                        </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 780          * Hope it does not filter out too much, we will see...                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 781          */                                                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 782                                                                                                          </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 783         if (source.equals(&quot;android&quot;) ||                                                                  </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 784                 source.equals(&quot;com.android.systemui&quot;) ||                                                 </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 785                 source.equals(&quot;com.android.dialer&quot;) ||                                                   </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 786                 source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                               </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 787             LOG.info(&quot;Ignoring notification, is a system event&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 788             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 789         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 790                                                                                                          </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 791         if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                           </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 792                 source.equals(&quot;com.android.mms&quot;) ||                                                      </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 793                 source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                       </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 794                 source.equals(&quot;com.android.messaging&quot;) ||                                                </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 795                 source.equals(&quot;org.smssecure.smssecure&quot;)) {                                              </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 796             if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 797                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 798             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 799         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 800                                                                                                          </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 801         if (GBApplication.appIsNotifBlacklisted(source)) {                                               </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 802             LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 803             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 804         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 805                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 806         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 807     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 808                                                                                                          </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 809     private boolean shouldIgnoreNotification(Notification notification, String source) {                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 810                                                                                                          </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 811         MediaSessionCompat.Token mediaSession = getMediaSession(notification);                           </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 812         //try to handle media session notifications                                                      </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 813         if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 814             return true;                                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 815                                                                                                          </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 816         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 817         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 817         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 818         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 819         if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                             </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 820                 type != NotificationType.WECHAT &amp;&amp;                                                       </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 821                 type != NotificationType.OUTLOOK &amp;&amp;                                                      </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 822                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109"> 822                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/isðŸ”µ</abbr></span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 823             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 824 =======                                                                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 825         return false;                                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 826 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827     }                                                                                                    </span>
<span  style=""> 828                                                                                                          </span>
<span class="1771766823989063914" onmouseenter="enter('1771766823989063914');" onmouseout="out('1771766823989063914');" style=""> 829     private boolean shouldIgnoreSource(StatusBarNotification sbn) {                                      </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style=""> 830         String source = sbn.getPackageName();                                                            </span>
<span  style=""> 831                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 832         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style=""> 833                                                                                                          </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 834         /* do not display messages from &quot;android&quot;                                                        </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 835          * This includes keyboard selection message, usb connection messages, etc                        </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 836          * Hope it does not filter out too much, we will see...                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 837          */                                                                                              </span>
<span  style=""> 838                                                                                                          </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 839         if (source.equals(&quot;android&quot;) ||                                                                  </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 840                 source.equals(&quot;com.android.systemui&quot;) ||                                                 </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 841                 source.equals(&quot;com.android.dialer&quot;) ||                                                   </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 842                 source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                               </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 843             LOG.info(&quot;Ignoring notification, is a system event&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 844             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845         }                                                                                                </span>
<span  style=""> 846                                                                                                          </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 847         if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                           </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 848                 source.equals(&quot;com.android.mms&quot;) ||                                                      </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 849                 source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                       </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 850                 source.equals(&quot;com.android.messaging&quot;) ||                                                </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 851                 source.equals(&quot;org.smssecure.smssecure&quot;)) {                                              </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 852             if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 853                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 854             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855         }                                                                                                </span>
<span  style=""> 856                                                                                                          </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 857         if (GBApplication.appIsNotifBlacklisted(source)) {                                               </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 858             LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 859             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 860         }                                                                                                </span>
<span  style=""> 861                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 862         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863     }                                                                                                    </span>
<span  style=""> 864                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 865 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 866     private boolean shouldIgnoreNotification(Notification notification, String source) {                 </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 867                                                                                                          </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 868         MediaSessionCompat.Token mediaSession = getMediaSession(notification);                           </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 869         //try to handle media session notifications                                                      </span>
<span class="2560486009094026972" onmouseenter="enter('2560486009094026972');" onmouseout="out('2560486009094026972');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 870         if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession)) {                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 871             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 872         }                                                                                                </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 873 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 874         //try to handle media session notifications                                                      </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 875         if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 876             return true;                                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 877                                                                                                          </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 878         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 879         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 879         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 880         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 881         if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                             </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 882                 type != NotificationType.WECHAT &amp;&amp;                                                       </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 883                 type != NotificationType.OUTLOOK &amp;&amp;                                                      </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 884                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109"> 884                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/isðŸ”µ</abbr></span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 885             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 886             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 887         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 888                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 889         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 890         if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                            </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 891             PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                  </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 892             if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                     </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 893 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);"> 893 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow ðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 894                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 895             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 896         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 897                                                                                                          </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 898         return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;</span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 899                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 900     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 901                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 902                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 903     /**                                                                                                  </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 904      * Get the notification color that should be used for this Pebble notification.                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 905      *                                                                                                   </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 906      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 906      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PeðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 907      *                                                                                                   </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 908      * See Issue #815 on GitHub to see how notification colors are set.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 909      *                                                                                                   </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 910      * @param notificationSpec The NotificationSpec to read from.                                        </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 911      * @return Returns a PebbleColor that best represents this notification.                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 912      */                                                                                                  </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 913     private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                      </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 914         String appId = notificationSpec.sourceAppId;                                                     </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 915         NotificationType existingType = notificationSpec.type;                                           </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 916                                                                                                          </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 917         // If the notification type is known, return the associated color.                               </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 918         if (existingType != NotificationType.UNKNOWN) {                                                  </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 919             return existingType.color;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 920         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 921                                                                                                          </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 922         // Otherwise, we go and attempt to find the color from the app icon.                             </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 923         Drawable icon;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 924         try {                                                                                            </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 925             icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 926             Objects.requireNonNull(icon);                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 927 =======                                                                                                  </span>
<span class="2810158062458488939" onmouseenter="enter('2810158062458488939');" onmouseout="out('2810158062458488939');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 928     private boolean shouldIgnoreNotification(StatusBarNotification sbn) {                                </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 929         Notification notification = sbn.getNotification();                                               </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 930         String source = sbn.getPackageName();                                                            </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 931 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 932                                                                                                          </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 933         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 934         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 934         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 935         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 936         if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                             </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 937                 type != NotificationType.WECHAT &amp;&amp;                                                       </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 938                 type != NotificationType.OUTLOOK &amp;&amp;                                                      </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""><abbr title=" 939                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109"> 939                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/isðŸ”µ</abbr></span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 940             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 941             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 942         }                                                                                                </span>
<span  style=""> 943                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 944         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 945         if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                            </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 946             PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                  </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 947             if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                     </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""><abbr title=" 948 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);"> 948 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow ðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 949                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 950             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951         }                                                                                                </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 952         return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;</span>
<span  style=""> 953                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 954     }                                                                                                    </span>
<span  style=""> 955                                                                                                          </span>
<span  style=""> 956                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 957     /**                                                                                                  </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 958      * Get the notification color that should be used for this Pebble notification.                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 959      *                                                                                                   </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 960      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 960      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PeðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 961      *                                                                                                   </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 962      * See Issue #815 on GitHub to see how notification colors are set.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 963      *                                                                                                   </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 964      * @param notificationSpec The NotificationSpec to read from.                                        </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 965      * @return Returns a PebbleColor that best represents this notification.                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 966      */                                                                                                  </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 967     private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                      </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 968         String appId = notificationSpec.sourceAppId;                                                     </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 969         NotificationType existingType = notificationSpec.type;                                           </span>
<span  style=""> 970                                                                                                          </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 971         // If the notification type is known, return the associated color.                               </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 972         if (existingType != NotificationType.UNKNOWN) {                                                  </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 973             return existingType.color;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 974         }                                                                                                </span>
<span  style=""> 975                                                                                                          </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 976         // Otherwise, we go and attempt to find the color from the app icon.                             </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 977         Drawable icon;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 978         try {                                                                                            </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 979             icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 980             Objects.requireNonNull(icon);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 981         } catch (Exception ex) {                                                                         </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 982             // If we can&#x27;t get the icon, we go with the default defined above.                           </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 983             LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                       </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 984             return PebbleColor.IslamicGreen;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 985         }                                                                                                </span>
<span  style=""> 986                                                                                                          </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 987         Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                    </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 988         int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                           </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 989                 .generate()                                                                              </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 990                 .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                           </span>
<span  style=""> 991                                                                                                          </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 992         return PebbleUtils.getPebbleColor(iconPrimaryColor);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 993     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 994 }                                                                                                        </span></pre></td>
                            <td><pre><span class="197175695684748742" onmouseenter="enter('197175695684748742');" onmouseout="out('197175695684748742');" style="">   1 /*  Copyright (C) 2015-2019 abettenburg, Andreas Shimokawa, AndrewBedscastle,                            </span>
<span class="-3541979219390877329" onmouseenter="enter('-3541979219390877329');" onmouseout="out('-3541979219390877329');" style="">   2     Carsten Pfeiffer, Daniel Dakhno, Daniele Gobbetti, Frank Slezak, Hasan Ammar,                        </span>
<span class="-531692918395923150" onmouseenter="enter('-531692918395923150');" onmouseout="out('-531692918395923150');" style="">   3     JosÃ© Rebelo, Julien Pivotto, Kevin Richter, Matthieu Baerts, Normano64,                              </span>
<span class="1862847412929924698" onmouseenter="enter('1862847412929924698');" onmouseout="out('1862847412929924698');" style="">   4     Steffen Liebergeld, Taavi EomÃ¤e, veecue, Zhong Jianxin                                               </span>
<span  style="">   5                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   6     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   7                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   8     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   9     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">  10     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  11     (at your option) any later version.                                                                  </span>
<span  style="">  12                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  13     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  14     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  15     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  16     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  17                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  18     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  19     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  20 package nodomain.freeyourgadget.gadgetbridge.externalevents;                                             </span>
<span  style="">  21                                                                                                          </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  22 import android.app.ActivityManager;                                                                      </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  23 import android.app.Notification;                                                                         </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  24 import android.app.NotificationManager;                                                                  </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  25 import android.app.PendingIntent;                                                                        </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  26 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  27 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  28 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  29 import android.content.IntentFilter;                                                                     </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30 import android.content.pm.PackageManager;                                                                </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31 import android.graphics.Bitmap;                                                                          </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32 import android.graphics.Color;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34 import android.media.MediaMetadata;                                                                      </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  35 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  36 import android.os.PowerManager;                                                                          </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  37 import android.os.RemoteException;                                                                       </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  38 import android.service.notification.NotificationListenerService;                                         </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  39 import android.service.notification.StatusBarNotification;                                               </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  40 import android.support.v4.media.MediaMetadataCompat;                                                     </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  41 import android.support.v4.media.session.MediaControllerCompat;                                           </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  42 import android.support.v4.media.session.MediaSessionCompat;                                              </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  43 import android.support.v4.media.session.PlaybackStateCompat;                                             </span>
<span  style="">  44                                                                                                          </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="">  45 import androidx.annotation.NonNull;                                                                      </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="">  46 import androidx.core.app.NotificationCompat;                                                             </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="">  47 import androidx.core.app.RemoteInput;                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  48 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="">  49 import androidx.palette.graphics.Palette;                                                                </span>
<span  style="">  50                                                                                                          </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  51 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  52 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  53 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  54                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  55 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  56 import java.util.Collections;                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  57 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  58 import java.util.List;                                                                                   </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  59 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  60 import java.util.Set;                                                                                    </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  61 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  62                                                                                                          </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  63 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  64 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  65 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  66 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  67 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  68 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  69 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  70 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  71 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  72 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="">  73 import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                   </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  74 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="1593353296711823731" onmouseenter="enter('1593353296711823731');" onmouseout="out('1593353296711823731');" style="">  75 import nodomain.freeyourgadget.gadgetbridge.model.DeviceType;                                            </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  76 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  77 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  78 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="">  79 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                      </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  80 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  81 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  82 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  83 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  84 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span  style="">  85                                                                                                          </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="">  86 import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                          </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title="  87 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;">  87 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title="  88 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;">  88 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title="  89 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;">  89 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span  style="">  90                                                                                                          </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  91 public class NotificationListener extends NotificationListenerService {                                  </span>
<span  style="">  92                                                                                                          </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  93     private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);               </span>
<span  style="">  94                                                                                                          </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  95     public static final String ACTION_DISMISS                                                            </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  96             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  97     public static final String ACTION_DISMISS_ALL                                                        </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style="">  98             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;            </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style="">  99     public static final String ACTION_OPEN                                                               </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style=""> 100             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                   </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style=""> 101     public static final String ACTION_MUTE                                                               </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style=""> 102             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                   </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style=""> 103     public static final String ACTION_REPLY                                                              </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 104             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                  </span>
<span  style=""> 105                                                                                                          </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 106     private LimitedQueue mActionLookup = new LimitedQueue(32);                                           </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 107     private LimitedQueue mPackageLookup = new LimitedQueue(64);                                          </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 108     private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                              </span>
<span  style=""> 109                                                                                                          </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 110     private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                         </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 111     private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                     </span>
<span  style=""> 112                                                                                                          </span>
<span class="8101473837509778470" onmouseenter="enter('8101473837509778470');" onmouseout="out('8101473837509778470');" style=""> 113     private static final Set&lt;String&gt; GROUP_SUMMARY_WHITELIST = Collections.singleton(                    </span>
<span class="-8080841529654579062" onmouseenter="enter('-8080841529654579062');" onmouseout="out('-8080841529654579062');" style=""> 114             &quot;mikado.bizcalpro&quot;                                                                           </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 115     );                                                                                                   </span>
<span  style=""> 116                                                                                                          </span>
<span class="-3455620612898728599" onmouseenter="enter('-3455620612898728599');" onmouseout="out('-3455620612898728599');" style=""> 117     public static ArrayList&lt;String&gt; notificationStack = new ArrayList&lt;&gt;();                               </span>
<span  style=""> 118                                                                                                          </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 119     private long activeCallPostTime;                                                                     </span>
<span class="-3341855908928415567" onmouseenter="enter('-3341855908928415567');" onmouseout="out('-3341855908928415567');" style=""> 120     private int mLastCallCommand = CallSpec.CALL_UNDEFINED;                                              </span>
<span  style=""> 121                                                                                                          </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 122     private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                </span>
<span  style=""> 123                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 124         @Override                                                                                        </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 125         public void onReceive(Context context, Intent intent) {                                          </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 126             String action = intent.getAction();                                                          </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 127             if (action == null) {                                                                        </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 128                 LOG.warn(&quot;no action&quot;);                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 129                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130             }                                                                                            </span>
<span  style=""> 131                                                                                                          </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 132             int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                        </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 133             switch (action) {                                                                            </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 134                 case GBApplication.ACTION_QUIT:                                                          </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 135                     stopSelf();                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 136                     break;                                                                               </span>
<span  style=""> 137                                                                                                          </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 138                 case ACTION_OPEN: {                                                                      </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 139                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 140                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 141                     if (ts == null) {                                                                    </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 142                         LOG.info(&quot;could not lookup handle for open action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 143                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                     }                                                                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 146                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 147                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148                             try {                                                                        </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 149                                 PendingIntent pi = sbn.getNotification().contentIntent;                  </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 150                                 if (pi != null) {                                                        </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 151                                     pi.send();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                                 }                                                                        </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 153                             } catch (PendingIntent.CanceledException e) {                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 154                                 e.printStackTrace();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 158                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                 }                                                                                        </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 160                 case ACTION_MUTE:                                                                        </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 161                     String packageName = (String) mPackageLookup.lookup(handle);                         </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 162                     if (packageName == null) {                                                           </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 163                         LOG.info(&quot;could not lookup handle for mute action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 164                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                     }                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 167                     LOG.info(&quot;going to mute &quot; + packageName);                                            </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 168                     GBApplication.addAppToNotifBlacklist(packageName);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 169                     break;                                                                               </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 170                 case ACTION_DISMISS: {                                                                   </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 171                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 172                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 173                     if (ts == null) {                                                                    </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 174                         LOG.info(&quot;could not lookup handle for dismiss action&quot;);                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 175                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                     }                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 177                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 178                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 179                             if (GBApplication.isRunningLollipopOrLater()) {                              </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 180                                 String key = sbn.getKey();                                               </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 181                                 NotificationListener.this.cancelNotification(key);                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182                             } else {                                                                     </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 183                                 int id = sbn.getId();                                                    </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 184                                 String pkg = sbn.getPackageName();                                       </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 185                                 String tag = sbn.getTag();                                               </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 186                                 NotificationListener.this.cancelNotification(pkg, tag, id);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 190                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                 }                                                                                        </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 192                 case ACTION_DISMISS_ALL:                                                                 </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 193                     NotificationListener.this.cancelAllNotifications();                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 194                     break;                                                                               </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 195                 case ACTION_REPLY:                                                                       </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 196                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 196                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.ðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 197                     String reply = intent.getStringExtra(&quot;reply&quot;);                                       </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 198                     if (wearableAction != null) {                                                        </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 199                         PendingIntent actionIntent = wearableAction.getActionIntent();                   </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 200                         Intent localIntent = new Intent();                                               </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 201                         localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                             </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 202                         if(wearableAction.getRemoteInputs()!=null) {                                     </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 203                             RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();               </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 204                             Bundle extras = new Bundle();                                                </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 205                             extras.putCharSequence(remoteInputs[0].getResultKey(), reply);               </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 206                             RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 208                         try {                                                                            </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 209                             LOG.info(&quot;will send exec intent to remote application&quot;);                     </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 210                             actionIntent.send(context, 0, localIntent);                                  </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 211                             mActionLookup.remove(handle);                                                </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 212                         } catch (PendingIntent.CanceledException e) {                                    </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 213                             LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 216                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 219     };                                                                                                   </span>
<span  style=""> 220                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 221     @Override                                                                                            </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 222     public void onCreate() {                                                                             </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 223         super.onCreate();                                                                                </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 224         IntentFilter filterLocal = new IntentFilter();                                                   </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 225         filterLocal.addAction(GBApplication.ACTION_QUIT);                                                </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 226         filterLocal.addAction(ACTION_OPEN);                                                              </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 227         filterLocal.addAction(ACTION_DISMISS);                                                           </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 228         filterLocal.addAction(ACTION_DISMISS_ALL);                                                       </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 229         filterLocal.addAction(ACTION_MUTE);                                                              </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 230         filterLocal.addAction(ACTION_REPLY);                                                             </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 231         LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234     @Override                                                                                            </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 235     public void onDestroy() {                                                                            </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 236         LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                           </span>
<span class="-3610691555806270699" onmouseenter="enter('-3610691555806270699');" onmouseout="out('-3610691555806270699');" style=""> 237         notificationStack.clear();                                                                       </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 238         super.onDestroy();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239     }                                                                                                    </span>
<span  style=""> 240                                                                                                          </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 241     public String getAppName(String pkg) {                                                               </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 242         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 243         PackageManager pm = getPackageManager();                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 244         try {                                                                                            </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style=""> 245             return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                        </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 246         } catch (PackageManager.NameNotFoundException e) {                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 247             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 249         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250     }                                                                                                    </span>
<span  style=""> 251                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 252     @Override                                                                                            </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 253     public void onNotificationPosted(StatusBarNotification sbn) {                                        </span>
<span class="-1858334129449927430" onmouseenter="enter('-1858334129449927430');" onmouseout="out('-1858334129449927430');" style=""> 254         logNotification(sbn, true);                                                                      </span>
<span  style=""> 255                                                                                                          </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 256         notificationStack.remove(sbn.getPackageName());                                                  </span>
<span class="6183718114314290730" onmouseenter="enter('6183718114314290730');" onmouseout="out('6183718114314290730');" style=""> 257         notificationStack.add(sbn.getPackageName());                                                     </span>
<span  style=""> 258                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 259 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-8448425987946302452" onmouseenter="enter('-8448425987946302452');" onmouseout="out('-8448425987946302452');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 261             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {"> 261             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_vðŸ”µ</abbr></span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266                                                                                                          </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="4755371366859202493" onmouseenter="enter('4755371366859202493');" onmouseout="out('4755371366859202493');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 268             if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to allow phone alarm notification"> 268             if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to ðŸ”µ</abbr></span>
<span class="2012465491164047553" onmouseenter="enter('2012465491164047553');" onmouseout="out('2012465491164047553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269                 LOG.info(&quot;Ignore notification: &quot; + sbn.getPackageName());               // need to fix   </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 270 ||||||| BASE                                                                                             </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-8448425987946302452" onmouseenter="enter('-8448425987946302452');" onmouseout="out('-8448425987946302452');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 272             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {"> 272             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_vðŸ”µ</abbr></span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276         }                                                                                                </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             LOG.info(&quot;Ignore notification&quot;);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 281 =======                                                                                                  </span>
<span class="4991954782201742281" onmouseenter="enter('4991954782201742281');" onmouseout="out('4991954782201742281');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282         if (shouldIgnoreNotifications()) return;                                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283                                                                                                          </span>
<span class="4264709970930991859" onmouseenter="enter('4264709970930991859');" onmouseout="out('4264709970930991859');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         if (shouldIgnoreSource(sbn)) {                                                                   </span>
<span class="4946725858664366504" onmouseenter="enter('4946725858664366504');" onmouseout="out('4946725858664366504');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285             LOG.debug(&quot;Ignoring notification source&quot;);                                                   </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 286 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 287             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289         }                                                                                                </span>
<span  style=""> 290                                                                                                          </span>
<span class="4712720955611963966" onmouseenter="enter('4712720955611963966');" onmouseout="out('4712720955611963966');" style=""> 291         if (handleMediaSessionNotification(sbn)) return;                                                 </span>
<span  style=""> 292                                                                                                          </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 293         switch (GBApplication.getGrantedInterruptionFilter()) {                                          </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 294             case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                         </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 295             case NotificationManager.INTERRUPTION_FILTER_NONE:                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 296                 return;                                                                                  </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 297             case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                       </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 298                 // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 299                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span  style=""> 301                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 302         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 303         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-8969748416921643208" onmouseenter="enter('-8969748416921643208');" onmouseout="out('-8969748416921643208');" style=""> 304             if (NotificationCompat.CATEGORY_CALL.equals(sbn.getNotification().category)                  </span>
<span class="-2610866924656962115" onmouseenter="enter('-2610866924656962115');" onmouseout="out('-2610866924656962115');" style=""> 305                     &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {                     </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style=""> 306                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 307                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309         }                                                                                                </span>
<span  style=""> 310                                                                                                          </span>
<span class="-7697907629896539664" onmouseenter="enter('-7697907629896539664');" onmouseout="out('-7697907629896539664');" style=""> 311         if (shouldIgnoreNotification(sbn)) {                                                             </span>
<span class="5145250427849470730" onmouseenter="enter('5145250427849470730');" onmouseout="out('5145250427849470730');" style=""> 312             LOG.info(&quot;Ignoring notification&quot;);                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 313             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314         }                                                                                                </span>
<span  style=""> 315                                                                                                          </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 316         String source = sbn.getPackageName().toLowerCase();                                              </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 317         Notification notification = sbn.getNotification();                                               </span>
<span  style=""> 318                                                                                                          </span>
<span class="-1441185864931598228" onmouseenter="enter('-1441185864931598228');" onmouseout="out('-1441185864931598228');" style=""> 319         Long notificationOldRepeatPreventionValue = notificationOldRepeatPrevention.get(source);         </span>
<span class="-2948904860852754633" onmouseenter="enter('-2948904860852754633');" onmouseout="out('-2948904860852754633');" style=""> 320         if (notificationOldRepeatPreventionValue != null                                                 </span>
<span class="-8958216021585134671" onmouseenter="enter('-8958216021585134671');" onmouseout="out('-8958216021585134671');" style=""> 321                 &amp;&amp; notification.when &lt;= notificationOldRepeatPreventionValue) {                          </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""> 322             LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;); </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 323             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324         }                                                                                                </span>
<span  style=""> 325                                                                                                          </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 326         // Ignore too frequent notifications, according to user preference                               </span>
<span class="6854200181184360965" onmouseenter="enter('6854200181184360965');" onmouseout="out('6854200181184360965');" style=""> 327         long curTime = System.nanoTime();                                                                </span>
<span class="-1119754415295906213" onmouseenter="enter('-1119754415295906213');" onmouseout="out('-1119754415295906213');" style=""> 328         Long notificationBurstPreventionValue = notificationBurstPrevention.get(source);                 </span>
<span class="3983885705215150872" onmouseenter="enter('3983885705215150872');" onmouseout="out('3983885705215150872');" style=""> 329         if (notificationBurstPreventionValue != null) {                                                  </span>
<span class="-4450214003094206879" onmouseenter="enter('-4450214003094206879');" onmouseout="out('-4450214003094206879');" style=""> 330             long diff = curTime - notificationBurstPreventionValue;                                      </span>
<span class="-2015672682083463299" onmouseenter="enter('-2015672682083463299');" onmouseout="out('-2015672682083463299');" style=""> 331             if (diff &lt; TimeUnit.SECONDS.toNanos(prefs.getInt(&quot;notifications_timeout&quot;, 0))) {             </span>
<span class="-7079262005450253436" onmouseenter="enter('-7079262005450253436');" onmouseout="out('-7079262005450253436');" style=""> 332                 LOG.info(&quot;Ignoring frequent notification, last one was &quot;                                 </span>
<span class="6353466646675639227" onmouseenter="enter('6353466646675639227');" onmouseout="out('6353466646675639227');" style=""> 333                         + TimeUnit.NANOSECONDS.toMillis(diff) + &quot;ms ago&quot;);                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 334                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336         }                                                                                                </span>
<span  style=""> 337                                                                                                          </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 338         NotificationSpec notificationSpec = new NotificationSpec();                                      </span>
<span  style=""> 339                                                                                                          </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 340         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 341         String name = getAppName(source);                                                                </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 342         if (name != null) {                                                                              </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 343             notificationSpec.sourceName = name;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344         }                                                                                                </span>
<span  style=""> 345                                                                                                          </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 346         boolean preferBigText = false;                                                                   </span>
<span  style=""> 347                                                                                                          </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 348         // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 348         // Get the app ID that generated this notification. For now only used by pebble color, but may beðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 349         notificationSpec.sourceAppId = source;                                                           </span>
<span  style=""> 350                                                                                                          </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 351         notificationSpec.type = AppNotificationType.getInstance().get(source);                           </span>
<span  style=""> 352                                                                                                          </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 353         //FIXME: some quirks lookup table would be the minor evil here                                   </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 354         if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                          </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 355             if (NotificationCompat.isGroupSummary(notification)) {                                       </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 356                 LOG.info(&quot;ignore K9 group summary&quot;);                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 357                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358             }                                                                                            </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 359             preferBigText = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360         }                                                                                                </span>
<span  style=""> 361                                                                                                          </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 362         if (notificationSpec.type == null) {                                                             </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 363             notificationSpec.type = NotificationType.UNKNOWN;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span  style=""> 365                                                                                                          </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 366         // Get color                                                                                     </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 367         notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                  </span>
<span  style=""> 368                                                                                                          </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 369         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 369         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMiðŸ”µ</abbr></span>
<span  style=""> 370                                                                                                          </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 371         dissectNotificationTo(notification, notificationSpec, preferBigText);                            </span>
<span  style=""> 372                                                                                                          </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 373         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 373         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificatioðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 374             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375         }                                                                                                </span>
<span  style=""> 376                                                                                                          </span>
<span  style=""> 377                                                                                                          </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 378         // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen          </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 379         if (getApplicationContext().getPackageName().equals(source)) {                                   </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""><abbr title=" 380             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {"> 380             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.tiðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 381                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383         }                                                                                                </span>
<span  style=""> 384                                                                                                          </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 385         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 385         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(noðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 386         List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                         </span>
<span  style=""> 387                                                                                                          </span>
<span  style=""> 388                                                                                                          </span>
<span class="-5165487096538852929" onmouseenter="enter('-5165487096538852929');" onmouseout="out('-5165487096538852929');" style=""> 389         if (actions.isEmpty() &amp;&amp; NotificationCompat.isGroupSummary(notification)                         </span>
<span class="-390635856025090115" onmouseenter="enter('-390635856025090115');" onmouseout="out('-390635856025090115');" style=""> 390                 &amp;&amp; !GROUP_SUMMARY_WHITELIST.contains(source)) { //this could cause #395 to come back     </span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 391             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 391             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action preseðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 392             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393         }                                                                                                </span>
<span  style=""> 394                                                                                                          </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 395         notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                            </span>
<span  style=""> 396                                                                                                          </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 397         // DISMISS action                                                                                </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 398         NotificationSpec.Action dismissAction = new NotificationSpec.Action();                           </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 399         dismissAction.title = &quot;Dismiss&quot;;                                                                 </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 400         dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                             </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 401         notificationSpec.attachedActions.add(dismissAction);                                             </span>
<span  style=""> 402                                                                                                          </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 403         for (NotificationCompat.Action act : actions) {                                                  </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 404             if (act != null) {                                                                           </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 405                 NotificationSpec.Action wearableAction = new NotificationSpec.Action();                  </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 406                 wearableAction.title = act.getTitle().toString();                                        </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 407                 if(act.getRemoteInputs()!=null) {                                                        </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 408                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 409                 } else {                                                                                 </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 410                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411                 }                                                                                        </span>
<span  style=""> 412                                                                                                          </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 413                 notificationSpec.attachedActions.add(wearableAction);                                    </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""><abbr title=" 414                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);"> 414                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size()ðŸ”µ</abbr></span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 415                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 415                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ actðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417         }                                                                                                </span>
<span  style=""> 418                                                                                                          </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 419         // OPEN action                                                                                   </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 420         NotificationSpec.Action openAction = new NotificationSpec.Action();                              </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 421         openAction.title = getString(R.string._pebble_watch_open_on_phone);                              </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 422         openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                   </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 423         notificationSpec.attachedActions.add(openAction);                                                </span>
<span  style=""> 424                                                                                                          </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 425         // MUTE action                                                                                   </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 426         NotificationSpec.Action muteAction = new NotificationSpec.Action();                              </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 427         muteAction.title = getString(R.string._pebble_watch_mute);                                       </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 428         muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                   </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 429         notificationSpec.attachedActions.add(muteAction);                                                </span>
<span  style=""> 430                                                                                                          </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""><abbr title=" 431         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN"> 431         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS aðŸ”µ</abbr></span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 432         mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                  </span>
<span  style=""> 433                                                                                                          </span>
<span class="-240819969350733584" onmouseenter="enter('-240819969350733584');" onmouseout="out('-240819969350733584');" style=""> 434         notificationBurstPrevention.put(source, curTime);                                                </span>
<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style=""> 435         if(0 != notification.when) {                                                                     </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 436             notificationOldRepeatPrevention.put(source, notification.when);                              </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 437         }else {                                                                                          </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""><abbr title=" 438             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);"> 438             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + souðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439         }                                                                                                </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 440         GBApplication.deviceService().onNotification(notificationSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441     }                                                                                                    </span>
<span  style=""> 442                                                                                                          </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 443     private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {      </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 444         long start = System.currentTimeMillis();                                                         </span>
<span  style=""> 445                                                                                                          </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 446         List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                      </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 447         NotificationFilter notificationFilter;                                                           </span>
<span  style=""> 448                                                                                                          </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 449         try (DBHandler db = GBApplication.acquireDB()) {                                                 </span>
<span  style=""> 450                                                                                                          </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 451             NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao(); </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 452             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 452             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilðŸ”µ</abbr></span>
<span  style=""> 453                                                                                                          </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 454             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 454             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFiltðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 455             notificationFilter = query.unique();                                                         </span>
<span  style=""> 456                                                                                                          </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 457             if (notificationFilter == null) {                                                            </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 458                 LOG.debug(&quot;No Notification Filter found&quot;);                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 459                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460             }                                                                                            </span>
<span  style=""> 461                                                                                                          </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 462             LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                               </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 463             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 463             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().whereðŸ”µ</abbr></span>
<span  style=""> 464                                                                                                          </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 465             List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                           </span>
<span  style=""> 466                                                                                                          </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 467             if (BuildConfig.DEBUG) {                                                                     </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 468                 LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469             }                                                                                            </span>
<span  style=""> 470                                                                                                          </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 471             if (!filterEntries.isEmpty()) {                                                              </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 472                 for (NotificationFilterEntry temp : filterEntries) {                                     </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 473                     wordsList.add(temp.getNotificationFilterContent());                                  </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 474                     LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476             }                                                                                            </span>
<span  style=""> 477                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 478         } catch (Exception e) {                                                                          </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 479             LOG.error(&quot;Could not acquire DB.&quot;, e);                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 480             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481         }                                                                                                </span>
<span  style=""> 482                                                                                                          </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 483         return shouldContinueAfterFilter(body, wordsList, notificationFilter);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484     }                                                                                                    </span>
<span  style=""> 485                                                                                                          </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 486     private void handleCallNotification(StatusBarNotification sbn) {                                     </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 487         String app = sbn.getPackageName();                                                               </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 488         LOG.debug(&quot;got call from: &quot; + app);                                                              </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style=""> 489         if(app.equals(&quot;com.android.dialer&quot;)) {                                                           </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 490             LOG.debug(&quot;Ignoring non-voip call&quot;);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 491             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492         }                                                                                                </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 493         Notification noti = sbn.getNotification();                                                       </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 494         dumpExtras(noti.extras);                                                                         </span>
<span class="-894861467263649997" onmouseenter="enter('-894861467263649997');" onmouseout="out('-894861467263649997');" style=""> 495         boolean callStarted = false;                                                                     </span>
<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style=""> 496         if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                            </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 497             for (Notification.Action action : noti.actions) {                                            </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 498                 LOG.info(&quot;Found call action: &quot; + action.title);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499             }                                                                                            </span>
<span class="150001560550536139" onmouseenter="enter('150001560550536139');" onmouseout="out('150001560550536139');" style=""> 500             if (noti.actions.length == 1) {                                                              </span>
<span class="1124706287521813013" onmouseenter="enter('1124706287521813013');" onmouseout="out('1124706287521813013');" style=""> 501                 if (mLastCallCommand == CallSpec.CALL_INCOMING) {                                        </span>
<span class="-8019351633415130414" onmouseenter="enter('-8019351633415130414');" onmouseout="out('-8019351633415130414');" style=""><abbr title=" 502                     LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuming call started&quot;);"> 502                     LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuminðŸ”µ</abbr></span>
<span class="3182682807764059315" onmouseenter="enter('3182682807764059315');" onmouseout="out('3182682807764059315');" style=""> 503                     callStarted = true;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 504                 } else {                                                                                 </span>
<span class="-4501418827174237895" onmouseenter="enter('-4501418827174237895');" onmouseout="out('-4501418827174237895');" style=""><abbr title=" 505                     LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assuming outgoing call / duplicate notification and ignoring&quot;);"> 505                     LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assðŸ”µ</abbr></span>
<span class="-8333753567790744727" onmouseenter="enter('-8333753567790744727');" onmouseout="out('-8333753567790744727');" style=""><abbr title=" 506                     // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more complete VoIP call state tracking?"> 506                     // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more coðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 507                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 509             }                                                                                            </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 510             /*try {                                                                                      </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 511                 LOG.info(&quot;Executing first action&quot;);                                                      </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 512                 noti.actions[0].actionIntent.send();                                                     </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 513             } catch (PendingIntent.CanceledException e) {                                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 514                 e.printStackTrace();                                                                     </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 515             }*/                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516         }                                                                                                </span>
<span  style=""> 517                                                                                                          </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 518         // figure out sender                                                                             </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 519         String number;                                                                                   </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style=""> 520         if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                         </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 521             number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                   </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style=""> 522         } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                   </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 523             number = noti.extras.getString(Notification.EXTRA_TITLE);                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 524         } else {                                                                                         </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 525             String appName = getAppName(app);                                                            </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style=""> 526             number = appName != null ? appName : app;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527         }                                                                                                </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 528         activeCallPostTime = sbn.getPostTime();                                                          </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 529         CallSpec callSpec = new CallSpec();                                                              </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 530         callSpec.number = number;                                                                        </span>
<span class="-7145633475877048589" onmouseenter="enter('-7145633475877048589');" onmouseout="out('-7145633475877048589');" style=""> 531         callSpec.command = callStarted ? CallSpec.CALL_START : CallSpec.CALL_INCOMING;                   </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style=""> 532         mLastCallCommand = callSpec.command;                                                             </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 533         GBApplication.deviceService().onSetCallState(callSpec);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534     }                                                                                                    </span>
<span  style=""> 535                                                                                                          </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 536     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 536     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotðŸ”µ</abbr></span>
<span  style=""> 537                                                                                                          </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 538         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 538         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterModðŸ”µ</abbr></span>
<span  style=""> 539                                                                                                          </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""><abbr title=" 540         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;"> 540         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODðŸ”µ</abbr></span>
<span  style=""> 541                                                                                                          </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 542         switch (notificationFilter.getNotificationFilterMode()) {                                        </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 543             case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 544                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 545                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 546                         if (!body.contains(word)) {                                                      </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""><abbr title=" 547                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;);"> 547                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing contiðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 548                             return true;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550                     }                                                                                    </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 551                     LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 552                     return false;                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 553                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 554                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 554                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 555                     if (!containsAny) {                                                                  </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""><abbr title=" 556                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);"> 556                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continuðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 557                     } else {                                                                             </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""><abbr title=" 558                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);"> 558                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559                     }                                                                                    </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 560                     return !containsAny;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561                 }                                                                                        </span>
<span  style=""> 562                                                                                                          </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 563             case NOTIFICATION_FILTER_MODE_WHITELIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 564                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 565                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 566                         if (!body.contains(word)) {                                                      </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""><abbr title=" 567                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);"> 567                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stopsðŸ”µ</abbr></span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 568                             return false;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570                     }                                                                                    </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 571                     LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 572                     return true;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 573                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 574                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 574                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 575                     if (containsAny) {                                                                   </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 576                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 576                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 577                     } else {                                                                             </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""><abbr title=" 578                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);"> 578                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579                     }                                                                                    </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 580                     return containsAny;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581                 }                                                                                        </span>
<span  style=""> 582                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 583             default:                                                                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 584                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586     }                                                                                                    </span>
<span  style=""> 587                                                                                                          </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 588     // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons    </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 589     private String sanitizeUnicode(String orig) {                                                        </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 590         return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591     }                                                                                                    </span>
<span  style=""> 592                                                                                                          </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 593     private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,     </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 594                                        boolean preferBigText) {                                          </span>
<span  style=""> 595                                                                                                          </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 596         Bundle extras = NotificationCompat.getExtras(notification);                                      </span>
<span  style=""> 597                                                                                                          </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 598         //dumpExtras(extras);                                                                            </span>
<span class="3231714309982698113" onmouseenter="enter('3231714309982698113');" onmouseout="out('3231714309982698113');" style=""> 599         if (extras == null) {                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 600             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601         }                                                                                                </span>
<span  style=""> 602                                                                                                          </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 603         CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                           </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 604         if (title != null) {                                                                             </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 605             notificationSpec.title = sanitizeUnicode(title.toString());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606         }                                                                                                </span>
<span  style=""> 607                                                                                                          </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 608         CharSequence contentCS = null;                                                                   </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 609         if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                          </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 610             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                       </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 611         } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                        </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 612             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 613         }                                                                                                </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 614         if (contentCS != null) {                                                                         </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 615             notificationSpec.body = sanitizeUnicode(contentCS.toString());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616         }                                                                                                </span>
<span  style=""> 617                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618     }                                                                                                    </span>
<span  style=""> 619                                                                                                          </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 620     private boolean isServiceRunning() {                                                                 </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 621         ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                  </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 622         if (manager == null) {                                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 623             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624         }                                                                                                </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""><abbr title=" 625         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {"> 625         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) ðŸ”µ</abbr></span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 626             if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 627                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 628             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 629         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 630         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631     }                                                                                                    </span>
<span  style=""> 632                                                                                                          </span>
<span class="5320463064367359781" onmouseenter="enter('5320463064367359781');" onmouseout="out('5320463064367359781');" style=""> 633     private boolean handleMediaSessionNotification(StatusBarNotification sbn) {                          </span>
<span class="-4962670587938601541" onmouseenter="enter('-4962670587938601541');" onmouseout="out('-4962670587938601541');" style=""> 634         MediaSessionCompat.Token mediaSession = getMediaSession(sbn.getNotification());                  </span>
<span class="-7622006372947125189" onmouseenter="enter('-7622006372947125189');" onmouseout="out('-7622006372947125189');" style=""> 635         return mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636     }                                                                                                    </span>
<span  style=""> 637                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 638     /**                                                                                                  </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 639      * Try to handle media session notifications that tell info about the current play state.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 640      *                                                                                                   </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 641      * @param mediaSession The mediasession to handle.                                                   </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 642      * @return true if notification was handled, false otherwise                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 643      */                                                                                                  </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 644     public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {               </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 645         MusicSpec musicSpec = new MusicSpec();                                                           </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 646         MusicStateSpec stateSpec = new MusicStateSpec();                                                 </span>
<span  style=""> 647                                                                                                          </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 648         MediaControllerCompat c;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 649         try {                                                                                            </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 650             c = new MediaControllerCompat(getApplicationContext(), mediaSession);                        </span>
<span  style=""> 651                                                                                                          </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 652             PlaybackStateCompat s = c.getPlaybackState();                                                </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 653             stateSpec.position = (int) (s.getPosition() / 1000);                                         </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 654             stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                 </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 655             stateSpec.repeat = 1;                                                                        </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 656             stateSpec.shuffle = 1;                                                                       </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 657             switch (s.getState()) {                                                                      </span>
<span class="-5763838617161449343" onmouseenter="enter('-5763838617161449343');" onmouseout="out('-5763838617161449343');" style=""> 658                 case PlaybackStateCompat.STATE_PLAYING:                                                  </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 659                     stateSpec.state = MusicStateSpec.STATE_PLAYING;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 660                     break;                                                                               </span>
<span class="4559404571574135097" onmouseenter="enter('4559404571574135097');" onmouseout="out('4559404571574135097');" style=""> 661                 case PlaybackStateCompat.STATE_STOPPED:                                                  </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 662                     stateSpec.state = MusicStateSpec.STATE_STOPPED;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 663                     break;                                                                               </span>
<span class="1489652375659370630" onmouseenter="enter('1489652375659370630');" onmouseout="out('1489652375659370630');" style=""> 664                 case PlaybackStateCompat.STATE_PAUSED:                                                   </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 665                     stateSpec.state = MusicStateSpec.STATE_PAUSED;                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 666                     break;                                                                               </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 667                 default:                                                                                 </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 668                     stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 669                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 670             }                                                                                            </span>
<span  style=""> 671                                                                                                          </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 672             MediaMetadataCompat d = c.getMetadata();                                                     </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 673             if (d == null)                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 674                 return false;                                                                            </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 675             if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                        </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 676                 musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                 </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 677             if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                         </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 678                 musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                   </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 679             if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                         </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 680                 musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                   </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 681             if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                      </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 682                 musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;  </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 683             if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                    </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 684                 musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);     </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 685             if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                  </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 686                 musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);      </span>
<span  style=""> 687                                                                                                          </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 688             // finally, tell the device about it                                                         </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 689             GBApplication.deviceService().onSetMusicInfo(musicSpec);                                     </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 690             GBApplication.deviceService().onSetMusicState(stateSpec);                                    </span>
<span  style=""> 691                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 692             return true;                                                                                 </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 693         } catch (NullPointerException | RemoteException e) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 694             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696     }                                                                                                    </span>
<span  style=""> 697                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 698         @Override                                                                                        </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 699     public void onNotificationRemoved(StatusBarNotification sbn) {                                       </span>
<span class="6067501100626656036" onmouseenter="enter('6067501100626656036');" onmouseout="out('6067501100626656036');" style=""> 700         logNotification(sbn, false);                                                                     </span>
<span  style=""> 701                                                                                                          </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 702         notificationStack.remove(sbn.getPackageName());                                                  </span>
<span  style=""> 703                                                                                                          </span>
<span class="4991954782201742281" onmouseenter="enter('4991954782201742281');" onmouseout="out('4991954782201742281');" style=""> 704         if (shouldIgnoreNotifications()) return;                                                         </span>
<span class="-8648926181838166573" onmouseenter="enter('-8648926181838166573');" onmouseout="out('-8648926181838166573');" style=""> 705         if (shouldIgnoreSource(sbn)) return;                                                             </span>
<span  style=""> 706                                                                                                          </span>
<span class="4712720955611963966" onmouseenter="enter('4712720955611963966');" onmouseout="out('4712720955611963966');" style=""> 707         if (handleMediaSessionNotification(sbn)) return;                                                 </span>
<span  style=""> 708                                                                                                          </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 709         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="809759750927856809" onmouseenter="enter('809759750927856809');" onmouseout="out('809759750927856809');" style=""> 710             if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category)                         </span>
<span class="-9057216622014896702" onmouseenter="enter('-9057216622014896702');" onmouseout="out('-9057216622014896702');" style=""> 711                     &amp;&amp; activeCallPostTime == sbn.getPostTime()) {                                        </span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style=""> 712             activeCallPostTime = 0;                                                                      </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 713             CallSpec callSpec = new CallSpec();                                                          </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style=""> 714             callSpec.command = CallSpec.CALL_END;                                                        </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style=""> 715                 mLastCallCommand = callSpec.command;                                                     </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 716             GBApplication.deviceService().onSetCallState(callSpec);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718         }                                                                                                </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 719         // FIXME: DISABLED for now                                                                       </span>
<span  style=""> 720                                                                                                          </span>
<span class="8463134039225075309" onmouseenter="enter('8463134039225075309');" onmouseout="out('8463134039225075309');" style=""> 721         if (shouldIgnoreNotification(sbn)) return;                                                       </span>
<span  style=""> 722                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 723         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-1296834313751396403" onmouseenter="enter('-1296834313751396403');" onmouseout="out('-1296834313751396403');" style=""> 724         if (prefs.getBoolean(&quot;autoremove_notifications&quot;, true)) {                                        </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 725             LOG.info(&quot;notification removed, will ask device to delete it&quot;);                              </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 726             GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727         }                                                                                                </span>
<span  style=""> 728                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729     }                                                                                                    </span>
<span  style=""> 730                                                                                                          </span>
<span class="-2321374120209641351" onmouseenter="enter('-2321374120209641351');" onmouseout="out('-2321374120209641351');" style=""> 731     private void logNotification(StatusBarNotification sbn, boolean posted) {                            </span>
<span class="1002552013175598925" onmouseenter="enter('1002552013175598925');" onmouseout="out('1002552013175598925');" style=""> 732         String infoMsg = (posted ? &quot;Notification posted&quot; : &quot;Notification removed&quot;)                       </span>
<span class="7538128381914780026" onmouseenter="enter('7538128381914780026');" onmouseout="out('7538128381914780026');" style=""> 733                 + &quot;: &quot; + sbn.getPackageName();                                                           </span>
<span  style=""> 734                                                                                                          </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 735         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-2325475546032777056" onmouseenter="enter('-2325475546032777056');" onmouseout="out('-2325475546032777056');" style=""> 736             infoMsg += &quot;: &quot; + sbn.getNotification().category;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737         }                                                                                                </span>
<span  style=""> 738                                                                                                          </span>
<span class="-8299794314619245363" onmouseenter="enter('-8299794314619245363');" onmouseout="out('-8299794314619245363');" style=""> 739         LOG.debug(infoMsg);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740     }                                                                                                    </span>
<span  style=""> 741                                                                                                          </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 742     private void dumpExtras(Bundle bundle) {                                                             </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 743         for (String key : bundle.keySet()) {                                                             </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 744             Object value = bundle.get(key);                                                              </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 745             if (value == null) {                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 746                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747             }                                                                                            </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 748             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 748             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 751 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 752 private boolean shouldIgnore(StatusBarNotification sbn) {                                                </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 753         /*                                                                                               </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 754          * return early if DeviceCommunicationService is not running,                                    </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 755          * else the service would get started every time we get a notification.                          </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 756          * unfortunately we cannot enable/disable NotificationListener at runtime like we do with        </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 757          * broadcast receivers because it seems to invalidate the permissions that are                   </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 758          * necessary for NotificationListenerService                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 759          */                                                                                              </span>
<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 760         if (!isServiceRunning() || sbn == null) {                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 761             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 762         }                                                                                                </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 763         return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                     </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 764                 sbn.getNotification(), sbn.getPackageName());                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 765                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 766     }                                                                                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 767 ||||||| BASE                                                                                             </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 768 private boolean shouldIgnore(StatusBarNotification sbn) {                                                </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 769         /*                                                                                               </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 770          * return early if DeviceCommunicationService is not running,                                    </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 771          * else the service would get started every time we get a notification.                          </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 772          * unfortunately we cannot enable/disable NotificationListener at runtime like we do with        </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 773          * broadcast receivers because it seems to invalidate the permissions that are                   </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 774          * necessary for NotificationListenerService                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 775          */                                                                                              </span>
<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 776         if (!isServiceRunning() || sbn == null) {                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 777             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 778         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 779                                                                                                          </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 780         return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                     </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 781                 sbn.getNotification(), sbn.getPackageName());                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 782                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 783     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 784 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 785 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 786                                                                                                          </span>
<span  style=""> 787                                                                                                          </span>
<span class="1771766823989063914" onmouseenter="enter('1771766823989063914');" onmouseout="out('1771766823989063914');" style=""> 788     private boolean shouldIgnoreSource(StatusBarNotification sbn) {                                      </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style=""> 789         String source = sbn.getPackageName();                                                            </span>
<span  style=""> 790                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 791         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style=""> 792                                                                                                          </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 793         /* do not display messages from &quot;android&quot;                                                        </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 794          * This includes keyboard selection message, usb connection messages, etc                        </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 795          * Hope it does not filter out too much, we will see...                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 796          */                                                                                              </span>
<span  style=""> 797                                                                                                          </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 798         if (source.equals(&quot;android&quot;) ||                                                                  </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 799                 source.equals(&quot;com.android.systemui&quot;) ||                                                 </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 800                 source.equals(&quot;com.android.dialer&quot;) ||                                                   </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 801                 source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                               </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 802             LOG.info(&quot;Ignoring notification, is a system event&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 803             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804         }                                                                                                </span>
<span  style=""> 805                                                                                                          </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 806         if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                           </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 807                 source.equals(&quot;com.android.mms&quot;) ||                                                      </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 808                 source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                       </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 809                 source.equals(&quot;com.android.messaging&quot;) ||                                                </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 810                 source.equals(&quot;org.smssecure.smssecure&quot;)) {                                              </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 811             if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 812                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814         }                                                                                                </span>
<span  style=""> 815                                                                                                          </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 816         if (GBApplication.appIsNotifBlacklisted(source)) {                                               </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 817             LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 818             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819         }                                                                                                </span>
<span  style=""> 820                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 821         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822     }                                                                                                    </span>
<span  style=""> 823                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 824 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 825 private boolean shouldIgnoreNotification(Notification notification, String source) {                     </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 826                                                                                                          </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 827         MediaSessionCompat.Token mediaSession = getMediaSession(notification);                           </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 828         //try to handle media session notifications                                                      </span>
<span class="2560486009094026972" onmouseenter="enter('2560486009094026972');" onmouseout="out('2560486009094026972');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 829         if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession)) {                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 830             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 831         }                                                                                                </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 832 ||||||| BASE                                                                                             </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 833 private boolean shouldIgnoreNotification(Notification notification, String source) {                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 834                                                                                                          </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 835         MediaSessionCompat.Token mediaSession = getMediaSession(notification);                           </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 836         //try to handle media session notifications                                                      </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 837         if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 838             return true;                                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 839                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 840 =======                                                                                                  </span>
<span class="2810158062458488939" onmouseenter="enter('2810158062458488939');" onmouseout="out('2810158062458488939');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 841 private boolean shouldIgnoreNotification(StatusBarNotification sbn) {                                    </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 842         Notification notification = sbn.getNotification();                                               </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 843         String source = sbn.getPackageName();                                                            </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 844 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 845                                                                                                          </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 846         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 847         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 847         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 848         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 849         if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                             </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 850                 type != NotificationType.WECHAT &amp;&amp;                                                       </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 851                 type != NotificationType.OUTLOOK &amp;&amp;                                                      </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""><abbr title=" 852                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109"> 852                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/isðŸ”µ</abbr></span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 853             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 854             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855         }                                                                                                </span>
<span  style=""> 856                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 857         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 858         if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                            </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 859             PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                  </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 860             if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                     </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""><abbr title=" 861 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);"> 861 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow ðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 862                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864         }                                                                                                </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 865         return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;</span>
<span  style=""> 866                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867     }                                                                                                    </span>
<span  style=""> 868                                                                                                          </span>
<span  style=""> 869                                                                                                          </span>
<span class="-3948619442008818904" onmouseenter="enter('-3948619442008818904');" onmouseout="out('-3948619442008818904');" style=""> 870     private boolean shouldIgnoreNotifications() {                                                        </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 871         /*                                                                                               </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 872          * return early if DeviceCommunicationService is not running,                                    </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 873          * else the service would get started every time we get a notification.                          </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 874          * unfortunately we cannot enable/disable NotificationListener at runtime like we do with        </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 875          * broadcast receivers because it seems to invalidate the permissions that are                   </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 876          * necessary for NotificationListenerService                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 877          */                                                                                              </span>
<span class="1533232748109360412" onmouseenter="enter('1533232748109360412');" onmouseout="out('1533232748109360412');" style=""> 878         if (!isServiceRunning()) {                                                                       </span>
<span class="4366338841311618901" onmouseenter="enter('4366338841311618901');" onmouseout="out('4366338841311618901');" style=""> 879             LOG.trace(&quot;Service is not running, ignoring notification&quot;);                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 880             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 882         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883     }                                                                                                    </span>
<span  style=""> 884                                                                                                          </span>
<span  style=""> 885                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 886     /**                                                                                                  </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 887      * Get the notification color that should be used for this Pebble notification.                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 888      *                                                                                                   </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 889      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 889      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PeðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 890      *                                                                                                   </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 891      * See Issue #815 on GitHub to see how notification colors are set.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 892      *                                                                                                   </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 893      * @param notificationSpec The NotificationSpec to read from.                                        </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 894      * @return Returns a PebbleColor that best represents this notification.                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 895      */                                                                                                  </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 896     private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                      </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 897         String appId = notificationSpec.sourceAppId;                                                     </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 898         NotificationType existingType = notificationSpec.type;                                           </span>
<span  style=""> 899                                                                                                          </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 900         // If the notification type is known, return the associated color.                               </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 901         if (existingType != NotificationType.UNKNOWN) {                                                  </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 902             return existingType.color;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903         }                                                                                                </span>
<span  style=""> 904                                                                                                          </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 905         // Otherwise, we go and attempt to find the color from the app icon.                             </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 906         Drawable icon;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 907         try {                                                                                            </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 908             icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 909             Objects.requireNonNull(icon);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 910         } catch (Exception ex) {                                                                         </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 911             // If we can&#x27;t get the icon, we go with the default defined above.                           </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 912             LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                       </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 913             return PebbleColor.IslamicGreen;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 914         }                                                                                                </span>
<span  style=""> 915                                                                                                          </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 916         Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                    </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 917         int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                           </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 918                 .generate()                                                                              </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 919                 .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                           </span>
<span  style=""> 920                                                                                                          </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 921         return PebbleUtils.getPebbleColor(iconPrimaryColor);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 922     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 923 }                                                                                                        </span>





































































</pre></td>
                            <td><pre><span class="1906883787138771170" onmouseenter="enter('1906883787138771170');" onmouseout="out('1906883787138771170');" style="">   1 /*  Copyright (C) 2015-2020 abettenburg, Andreas Shimokawa, AndrewBedscastle,                            </span>
<span class="-3541979219390877329" onmouseenter="enter('-3541979219390877329');" onmouseout="out('-3541979219390877329');" style="">   2     Carsten Pfeiffer, Daniel Dakhno, Daniele Gobbetti, Frank Slezak, Hasan Ammar,                        </span>
<span class="-531692918395923150" onmouseenter="enter('-531692918395923150');" onmouseout="out('-531692918395923150');" style="">   3     JosÃ© Rebelo, Julien Pivotto, Kevin Richter, Matthieu Baerts, Normano64,                              </span>
<span class="1862847412929924698" onmouseenter="enter('1862847412929924698');" onmouseout="out('1862847412929924698');" style="">   4     Steffen Liebergeld, Taavi EomÃ¤e, veecue, Zhong Jianxin                                               </span>
<span  style="">   5                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   6     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   7                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   8     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   9     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">  10     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  11     (at your option) any later version.                                                                  </span>
<span  style="">  12                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  13     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  14     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  15     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  16     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  17                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  18     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  19     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  20 package nodomain.freeyourgadget.gadgetbridge.externalevents;                                             </span>
<span  style="">  21                                                                                                          </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  22 import android.app.ActivityManager;                                                                      </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  23 import android.app.Notification;                                                                         </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  24 import android.app.NotificationManager;                                                                  </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  25 import android.app.PendingIntent;                                                                        </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  26 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  27 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  28 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  29 import android.content.IntentFilter;                                                                     </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30 import android.content.pm.PackageManager;                                                                </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31 import android.graphics.Bitmap;                                                                          </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32 import android.graphics.Color;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34 import android.media.MediaMetadata;                                                                      </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  35 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  36 import android.os.PowerManager;                                                                          </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  37 import android.os.RemoteException;                                                                       </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  38 import android.service.notification.NotificationListenerService;                                         </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  39 import android.service.notification.StatusBarNotification;                                               </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  40 import android.support.v4.media.MediaMetadataCompat;                                                     </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  41 import android.support.v4.media.session.MediaControllerCompat;                                           </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  42 import android.support.v4.media.session.MediaSessionCompat;                                              </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  43 import android.support.v4.media.session.PlaybackStateCompat;                                             </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="">  44 import androidx.annotation.NonNull;                                                                      </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="">  45 import androidx.core.app.NotificationCompat;                                                             </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="">  46 import androidx.core.app.RemoteInput;                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  47 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="">  48 import androidx.palette.graphics.Palette;                                                                </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  49 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  50 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  51 import java.util.Collections;                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  52 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  53 import java.util.List;                                                                                   </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  54 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  55 import java.util.Set;                                                                                    </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  56 import java.util.concurrent.TimeUnit;                                                                    </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  57 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  58 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  59 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  60 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  61 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  62 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  63 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  64 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  65 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="">  66 import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                   </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  67 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="1593353296711823731" onmouseenter="enter('1593353296711823731');" onmouseout="out('1593353296711823731');" style="">  68 import nodomain.freeyourgadget.gadgetbridge.model.DeviceType;                                            </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  69 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  70 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  71 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="">  72 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                      </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  73 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  74 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  75 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  76 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  77 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  78 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  79 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  80 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="">  81 import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                          </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title="  82 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;">  82 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title="  83 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;">  83 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title="  84 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;">  84 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span  style="">  85                                                                                                          </span>
<span  style="">  86                                                                                                          </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  87 public class NotificationListener extends NotificationListenerService {                                  </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  88     private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);               </span>
<span  style="">  89                                                                                                          </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  90     public static final String ACTION_DISMISS                                                            </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  91             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                </span>
<span  style="">  92                                                                                                          </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  93     public static final String ACTION_DISMISS_ALL                                                        </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style="">  94             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;            </span>
<span  style="">  95                                                                                                          </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style="">  96     public static final String ACTION_OPEN                                                               </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style="">  97             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                   </span>
<span  style="">  98                                                                                                          </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style="">  99     public static final String ACTION_MUTE                                                               </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style=""> 100             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                   </span>
<span  style=""> 101                                                                                                          </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style=""> 102     public static final String ACTION_REPLY                                                              </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 103             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                  </span>
<span  style=""> 104                                                                                                          </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 105     private LimitedQueue mActionLookup = new LimitedQueue(32);                                           </span>
<span  style=""> 106                                                                                                          </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 107     private LimitedQueue mPackageLookup = new LimitedQueue(64);                                          </span>
<span  style=""> 108                                                                                                          </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 109     private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                              </span>
<span  style=""> 110                                                                                                          </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 111     private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                         </span>
<span  style=""> 112                                                                                                          </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 113     private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                     </span>
<span  style=""> 114                                                                                                          </span>
<span class="8101473837509778470" onmouseenter="enter('8101473837509778470');" onmouseout="out('8101473837509778470');" style=""> 115     private static final Set&lt;String&gt; GROUP_SUMMARY_WHITELIST = Collections.singleton(                    </span>
<span class="-8080841529654579062" onmouseenter="enter('-8080841529654579062');" onmouseout="out('-8080841529654579062');" style=""> 116             &quot;mikado.bizcalpro&quot;                                                                           </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 117     );                                                                                                   </span>
<span  style=""> 118                                                                                                          </span>
<span class="-3455620612898728599" onmouseenter="enter('-3455620612898728599');" onmouseout="out('-3455620612898728599');" style=""> 119     public static ArrayList&lt;String&gt; notificationStack = new ArrayList&lt;&gt;();                               </span>
<span  style=""> 120                                                                                                          </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 121     private long activeCallPostTime;                                                                     </span>
<span  style=""> 122                                                                                                          </span>
<span class="-3341855908928415567" onmouseenter="enter('-3341855908928415567');" onmouseout="out('-3341855908928415567');" style=""> 123     private int mLastCallCommand = CallSpec.CALL_UNDEFINED;                                              </span>
<span  style=""> 124                                                                                                          </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 125     private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 126         @Override                                                                                        </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 127         public void onReceive(Context context, Intent intent) {                                          </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 128             String action = intent.getAction();                                                          </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 129             if (action == null) {                                                                        </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 130                 LOG.warn(&quot;no action&quot;);                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 131                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132             }                                                                                            </span>
<span class="-8522569859437208143" onmouseenter="enter('-8522569859437208143');" onmouseout="out('-8522569859437208143');" style=""> 133             int handle = ((int) (intent.getLongExtra(&quot;handle&quot;, -1)));                                    </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 134             switch (action) {                                                                            </span>
<span class="3445389342864668009" onmouseenter="enter('3445389342864668009');" onmouseout="out('3445389342864668009');" style=""> 135                 case GBApplication.ACTION_QUIT :                                                         </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 136                     stopSelf();                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 137                     break;                                                                               </span>
<span class="-5547688122153857280" onmouseenter="enter('-5547688122153857280');" onmouseout="out('-5547688122153857280');" style=""> 138                 case ACTION_OPEN :                                                                       </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 139                     {                                                                                    </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""><abbr title=" 140                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();"> 140                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications()ðŸ”µ</abbr></span>
<span class="8871626058142499694" onmouseenter="enter('8871626058142499694');" onmouseout="out('8871626058142499694');" style=""> 141                         Long ts = ((Long) (mNotificationHandleLookup.lookup(handle)));                   </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 142                         if (ts == null) {                                                                </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 143                             LOG.info(&quot;could not lookup handle for open action&quot;);                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                         }                                                                                </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 146                         for (StatusBarNotification sbn : sbns) {                                         </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 147                             if (sbn.getPostTime() == ts) {                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 148                                 try {                                                                    </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 149                                     PendingIntent pi = sbn.getNotification().contentIntent;              </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 150                                     if (pi != null) {                                                    </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 151                                         pi.send();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                                     }                                                                    </span>
<span class="-7631067620786105934" onmouseenter="enter('-7631067620786105934');" onmouseout="out('-7631067620786105934');" style=""> 153                                 } catch (PendingIntent e) {                                              </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 154                                     e.printStackTrace();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 158                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                     }                                                                                    </span>
<span class="4895194214786786257" onmouseenter="enter('4895194214786786257');" onmouseout="out('4895194214786786257');" style=""> 160                 case ACTION_MUTE :                                                                       </span>
<span class="9128513059934580751" onmouseenter="enter('9128513059934580751');" onmouseout="out('9128513059934580751');" style=""> 161                     String packageName = ((String) (mPackageLookup.lookup(handle)));                     </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 162                     if (packageName == null) {                                                           </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 163                         LOG.info(&quot;could not lookup handle for mute action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 164                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                     }                                                                                    </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 166                     LOG.info(&quot;going to mute &quot; + packageName);                                            </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 167                     GBApplication.addAppToNotifBlacklist(packageName);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 168                     break;                                                                               </span>
<span class="-2731864045103809175" onmouseenter="enter('-2731864045103809175');" onmouseout="out('-2731864045103809175');" style=""> 169                 case ACTION_DISMISS :                                                                    </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 170                     {                                                                                    </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""><abbr title=" 171                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();"> 171                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications()ðŸ”µ</abbr></span>
<span class="8871626058142499694" onmouseenter="enter('8871626058142499694');" onmouseout="out('8871626058142499694');" style=""> 172                         Long ts = ((Long) (mNotificationHandleLookup.lookup(handle)));                   </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 173                         if (ts == null) {                                                                </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 174                             LOG.info(&quot;could not lookup handle for dismiss action&quot;);                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 175                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                         }                                                                                </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 177                         for (StatusBarNotification sbn : sbns) {                                         </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 178                             if (sbn.getPostTime() == ts) {                                               </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 179                                 if (GBApplication.isRunningLollipopOrLater()) {                          </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 180                                     String key = sbn.getKey();                                           </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 181                                     NotificationListener.this.cancelNotification(key);                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182                                 } else {                                                                 </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 183                                     int id = sbn.getId();                                                </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 184                                     String pkg = sbn.getPackageName();                                   </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 185                                     String tag = sbn.getTag();                                           </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 186                                     NotificationListener.this.cancelNotification(pkg, tag, id);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 190                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                     }                                                                                    </span>
<span class="3656305978861666618" onmouseenter="enter('3656305978861666618');" onmouseout="out('3656305978861666618');" style=""> 192                 case ACTION_DISMISS_ALL :                                                                </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 193                     NotificationListener.this.cancelAllNotifications();                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 194                     break;                                                                               </span>
<span class="-6395486145934723530" onmouseenter="enter('-6395486145934723530');" onmouseout="out('-6395486145934723530');" style=""> 195                 case ACTION_REPLY :                                                                      </span>
<span class="3246293661004050434" onmouseenter="enter('3246293661004050434');" onmouseout="out('3246293661004050434');" style=""><abbr title=" 196                     NotificationCompat.Action wearableAction = ((NotificationCompat.Action) (mActionLookup.lookup(handle)));"> 196                     NotificationCompat.Action wearableAction = ((NotificationCompat.Action) (mActionLookuðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 197                     String reply = intent.getStringExtra(&quot;reply&quot;);                                       </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 198                     if (wearableAction != null) {                                                        </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 199                         PendingIntent actionIntent = wearableAction.getActionIntent();                   </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 200                         Intent localIntent = new Intent();                                               </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 201                         localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                             </span>
<span class="691073611137837703" onmouseenter="enter('691073611137837703');" onmouseout="out('691073611137837703');" style=""> 202                         if (wearableAction.getRemoteInputs() != null) {                                  </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 203                             RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();               </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 204                             Bundle extras = new Bundle();                                                </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 205                             extras.putCharSequence(remoteInputs[0].getResultKey(), reply);               </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 206                             RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 208                         try {                                                                            </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 209                             LOG.info(&quot;will send exec intent to remote application&quot;);                     </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 210                             actionIntent.send(context, 0, localIntent);                                  </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 211                             mActionLookup.remove(handle);                                                </span>
<span class="-7631067620786105934" onmouseenter="enter('-7631067620786105934');" onmouseout="out('-7631067620786105934');" style=""> 212                         } catch (PendingIntent e) {                                                      </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 213                             LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 216                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 219     };                                                                                                   </span>
<span  style=""> 220                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 221     @Override                                                                                            </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 222     public void onCreate() {                                                                             </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 223         super.onCreate();                                                                                </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 224         IntentFilter filterLocal = new IntentFilter();                                                   </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 225         filterLocal.addAction(GBApplication.ACTION_QUIT);                                                </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 226         filterLocal.addAction(ACTION_OPEN);                                                              </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 227         filterLocal.addAction(ACTION_DISMISS);                                                           </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 228         filterLocal.addAction(ACTION_DISMISS_ALL);                                                       </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 229         filterLocal.addAction(ACTION_MUTE);                                                              </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 230         filterLocal.addAction(ACTION_REPLY);                                                             </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 231         LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234     @Override                                                                                            </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 235     public void onDestroy() {                                                                            </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 236         LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                           </span>
<span class="-3610691555806270699" onmouseenter="enter('-3610691555806270699');" onmouseout="out('-3610691555806270699');" style=""> 237         notificationStack.clear();                                                                       </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 238         super.onDestroy();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239     }                                                                                                    </span>
<span  style=""> 240                                                                                                          </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 241     public String getAppName(String pkg) {                                                               </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 242         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 243         PackageManager pm = getPackageManager();                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 244         try {                                                                                            </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style=""> 245             return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                        </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 246         } catch (PackageManager.NameNotFoundException e) {                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 247             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 249         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250     }                                                                                                    </span>
<span  style=""> 251                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 252     @Override                                                                                            </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 253     public void onNotificationPosted(StatusBarNotification sbn) {                                        </span>
<span class="-1858334129449927430" onmouseenter="enter('-1858334129449927430');" onmouseout="out('-1858334129449927430');" style=""> 254         logNotification(sbn, true);                                                                      </span>
<span  style=""> 255                                                                                                          </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 256         notificationStack.remove(sbn.getPackageName());                                                  </span>
<span class="6183718114314290730" onmouseenter="enter('6183718114314290730');" onmouseout="out('6183718114314290730');" style=""> 257         notificationStack.add(sbn.getPackageName());                                                     </span>
<span  style=""> 258                                                                                                          </span>
<span  style=""> 259                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 260 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-8448425987946302452" onmouseenter="enter('-8448425987946302452');" onmouseout="out('-8448425987946302452');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 262             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {"> 262             if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_vðŸ”µ</abbr></span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267                                                                                                          </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="4755371366859202493" onmouseenter="enter('4755371366859202493');" onmouseout="out('4755371366859202493');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 269             if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to allow phone alarm notification"> 269             if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to ðŸ”µ</abbr></span>
<span class="2012465491164047553" onmouseenter="enter('2012465491164047553');" onmouseout="out('2012465491164047553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270                 LOG.info(&quot;Ignore notification: &quot; + sbn.getPackageName());               // need to fix   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 274 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 275 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 275 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 276 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277                                                                                                          </span>
<span class="4991954782201742281" onmouseenter="enter('4991954782201742281');" onmouseout="out('4991954782201742281');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278         if (shouldIgnoreNotifications()) return;                                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279                                                                                                          </span>
<span class="4264709970930991859" onmouseenter="enter('4264709970930991859');" onmouseout="out('4264709970930991859');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280         if (shouldIgnoreSource(sbn)) {                                                                   </span>
<span class="4946725858664366504" onmouseenter="enter('4946725858664366504');" onmouseout="out('4946725858664366504');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281             LOG.debug(&quot;Ignoring notification source&quot;);                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282             return;                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 284 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285         }                                                                                                </span>
<span  style=""> 286                                                                                                          </span>
<span class="4712720955611963966" onmouseenter="enter('4712720955611963966');" onmouseout="out('4712720955611963966');" style=""> 287         if (handleMediaSessionNotification(sbn)) return;                                                 </span>
<span  style=""> 288                                                                                                          </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 289         switch (GBApplication.getGrantedInterruptionFilter()) {                                          </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 290             case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                         </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 291             case NotificationManager.INTERRUPTION_FILTER_NONE:                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 292                 return;                                                                                  </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 293             case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                       </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 294                 // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 295                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span  style=""> 297                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 298         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 299         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-8969748416921643208" onmouseenter="enter('-8969748416921643208');" onmouseout="out('-8969748416921643208');" style=""> 300             if (NotificationCompat.CATEGORY_CALL.equals(sbn.getNotification().category)                  </span>
<span class="-2610866924656962115" onmouseenter="enter('-2610866924656962115');" onmouseout="out('-2610866924656962115');" style=""> 301                     &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {                     </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style=""> 302                 handleCallNotification(sbn);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 303                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305         }                                                                                                </span>
<span  style=""> 306                                                                                                          </span>
<span class="-7697907629896539664" onmouseenter="enter('-7697907629896539664');" onmouseout="out('-7697907629896539664');" style=""> 307         if (shouldIgnoreNotification(sbn)) {                                                             </span>
<span class="5145250427849470730" onmouseenter="enter('5145250427849470730');" onmouseout="out('5145250427849470730');" style=""> 308             LOG.info(&quot;Ignoring notification&quot;);                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 309             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310         }                                                                                                </span>
<span  style=""> 311                                                                                                          </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 312         String source = sbn.getPackageName().toLowerCase();                                              </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 313         Notification notification = sbn.getNotification();                                               </span>
<span  style=""> 314                                                                                                          </span>
<span class="-1441185864931598228" onmouseenter="enter('-1441185864931598228');" onmouseout="out('-1441185864931598228');" style=""> 315         Long notificationOldRepeatPreventionValue = notificationOldRepeatPrevention.get(source);         </span>
<span class="-2948904860852754633" onmouseenter="enter('-2948904860852754633');" onmouseout="out('-2948904860852754633');" style=""> 316         if (notificationOldRepeatPreventionValue != null                                                 </span>
<span class="-8958216021585134671" onmouseenter="enter('-8958216021585134671');" onmouseout="out('-8958216021585134671');" style=""> 317                 &amp;&amp; notification.when &lt;= notificationOldRepeatPreventionValue) {                          </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""> 318             LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;); </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 319             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span  style=""> 321                                                                                                          </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 322         // Ignore too frequent notifications, according to user preference                               </span>
<span class="6854200181184360965" onmouseenter="enter('6854200181184360965');" onmouseout="out('6854200181184360965');" style=""> 323         long curTime = System.nanoTime();                                                                </span>
<span class="-1119754415295906213" onmouseenter="enter('-1119754415295906213');" onmouseout="out('-1119754415295906213');" style=""> 324         Long notificationBurstPreventionValue = notificationBurstPrevention.get(source);                 </span>
<span class="3983885705215150872" onmouseenter="enter('3983885705215150872');" onmouseout="out('3983885705215150872');" style=""> 325         if (notificationBurstPreventionValue != null) {                                                  </span>
<span class="-4450214003094206879" onmouseenter="enter('-4450214003094206879');" onmouseout="out('-4450214003094206879');" style=""> 326             long diff = curTime - notificationBurstPreventionValue;                                      </span>
<span class="-2015672682083463299" onmouseenter="enter('-2015672682083463299');" onmouseout="out('-2015672682083463299');" style=""> 327             if (diff &lt; TimeUnit.SECONDS.toNanos(prefs.getInt(&quot;notifications_timeout&quot;, 0))) {             </span>
<span class="-7079262005450253436" onmouseenter="enter('-7079262005450253436');" onmouseout="out('-7079262005450253436');" style=""> 328                 LOG.info(&quot;Ignoring frequent notification, last one was &quot;                                 </span>
<span class="6353466646675639227" onmouseenter="enter('6353466646675639227');" onmouseout="out('6353466646675639227');" style=""> 329                         + TimeUnit.NANOSECONDS.toMillis(diff) + &quot;ms ago&quot;);                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 330                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332         }                                                                                                </span>
<span  style=""> 333                                                                                                          </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 334         NotificationSpec notificationSpec = new NotificationSpec();                                      </span>
<span  style=""> 335                                                                                                          </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 336         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 337         String name = getAppName(source);                                                                </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 338         if (name != null) {                                                                              </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 339             notificationSpec.sourceName = name;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340         }                                                                                                </span>
<span  style=""> 341                                                                                                          </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 342         boolean preferBigText = false;                                                                   </span>
<span  style=""> 343                                                                                                          </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 344         // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 344         // Get the app ID that generated this notification. For now only used by pebble color, but may beðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 345         notificationSpec.sourceAppId = source;                                                           </span>
<span  style=""> 346                                                                                                          </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 347         notificationSpec.type = AppNotificationType.getInstance().get(source);                           </span>
<span  style=""> 348                                                                                                          </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 349         //FIXME: some quirks lookup table would be the minor evil here                                   </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 350         if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                          </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 351             if (NotificationCompat.isGroupSummary(notification)) {                                       </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 352                 LOG.info(&quot;ignore K9 group summary&quot;);                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 353                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354             }                                                                                            </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 355             preferBigText = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356         }                                                                                                </span>
<span  style=""> 357                                                                                                          </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 358         if (notificationSpec.type == null) {                                                             </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 359             notificationSpec.type = NotificationType.UNKNOWN;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360         }                                                                                                </span>
<span  style=""> 361                                                                                                          </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 362         // Get color                                                                                     </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 363         notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                  </span>
<span  style=""> 364                                                                                                          </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 365         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 365         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMiðŸ”µ</abbr></span>
<span  style=""> 366                                                                                                          </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 367         dissectNotificationTo(notification, notificationSpec, preferBigText);                            </span>
<span  style=""> 368                                                                                                          </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 369         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 369         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificatioðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 370             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371         }                                                                                                </span>
<span  style=""> 372                                                                                                          </span>
<span  style=""> 373                                                                                                          </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 374         // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen          </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 375         if (getApplicationContext().getPackageName().equals(source)) {                                   </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""><abbr title=" 376             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {"> 376             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.tiðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 377                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379         }                                                                                                </span>
<span  style=""> 380                                                                                                          </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 381         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 381         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(noðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 382         List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                         </span>
<span  style=""> 383                                                                                                          </span>
<span  style=""> 384                                                                                                          </span>
<span class="-5165487096538852929" onmouseenter="enter('-5165487096538852929');" onmouseout="out('-5165487096538852929');" style=""> 385         if (actions.isEmpty() &amp;&amp; NotificationCompat.isGroupSummary(notification)                         </span>
<span class="-390635856025090115" onmouseenter="enter('-390635856025090115');" onmouseout="out('-390635856025090115');" style=""> 386                 &amp;&amp; !GROUP_SUMMARY_WHITELIST.contains(source)) { //this could cause #395 to come back     </span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 387             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 387             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action preseðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 388             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389         }                                                                                                </span>
<span  style=""> 390                                                                                                          </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 391         notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                            </span>
<span  style=""> 392                                                                                                          </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 393         // DISMISS action                                                                                </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 394         NotificationSpec.Action dismissAction = new NotificationSpec.Action();                           </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 395         dismissAction.title = &quot;Dismiss&quot;;                                                                 </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 396         dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                             </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 397         notificationSpec.attachedActions.add(dismissAction);                                             </span>
<span  style=""> 398                                                                                                          </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 399         for (NotificationCompat.Action act : actions) {                                                  </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 400             if (act != null) {                                                                           </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 401                 NotificationSpec.Action wearableAction = new NotificationSpec.Action();                  </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 402                 wearableAction.title = act.getTitle().toString();                                        </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 403                 if(act.getRemoteInputs()!=null) {                                                        </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 404                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 405                 } else {                                                                                 </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 406                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407                 }                                                                                        </span>
<span  style=""> 408                                                                                                          </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 409                 notificationSpec.attachedActions.add(wearableAction);                                    </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""><abbr title=" 410                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);"> 410                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size()ðŸ”µ</abbr></span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 411                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 411                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ actðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413         }                                                                                                </span>
<span  style=""> 414                                                                                                          </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 415         // OPEN action                                                                                   </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 416         NotificationSpec.Action openAction = new NotificationSpec.Action();                              </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 417         openAction.title = getString(R.string._pebble_watch_open_on_phone);                              </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 418         openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                   </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 419         notificationSpec.attachedActions.add(openAction);                                                </span>
<span  style=""> 420                                                                                                          </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 421         // MUTE action                                                                                   </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 422         NotificationSpec.Action muteAction = new NotificationSpec.Action();                              </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 423         muteAction.title = getString(R.string._pebble_watch_mute);                                       </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 424         muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                   </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 425         notificationSpec.attachedActions.add(muteAction);                                                </span>
<span  style=""> 426                                                                                                          </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""><abbr title=" 427         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN"> 427         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS aðŸ”µ</abbr></span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 428         mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                  </span>
<span  style=""> 429                                                                                                          </span>
<span class="-240819969350733584" onmouseenter="enter('-240819969350733584');" onmouseout="out('-240819969350733584');" style=""> 430         notificationBurstPrevention.put(source, curTime);                                                </span>
<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style=""> 431         if(0 != notification.when) {                                                                     </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 432             notificationOldRepeatPrevention.put(source, notification.when);                              </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 433         }else {                                                                                          </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""><abbr title=" 434             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);"> 434             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + souðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435         }                                                                                                </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 436         GBApplication.deviceService().onNotification(notificationSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437     }                                                                                                    </span>
<span  style=""> 438                                                                                                          </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 439     private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {      </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 440         long start = System.currentTimeMillis();                                                         </span>
<span  style=""> 441                                                                                                          </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 442         List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                      </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 443         NotificationFilter notificationFilter;                                                           </span>
<span  style=""> 444                                                                                                          </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 445         try (DBHandler db = GBApplication.acquireDB()) {                                                 </span>
<span  style=""> 446                                                                                                          </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 447             NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao(); </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 448             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 448             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilðŸ”µ</abbr></span>
<span  style=""> 449                                                                                                          </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 450             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 450             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFiltðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 451             notificationFilter = query.unique();                                                         </span>
<span  style=""> 452                                                                                                          </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 453             if (notificationFilter == null) {                                                            </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 454                 LOG.debug(&quot;No Notification Filter found&quot;);                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 455                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456             }                                                                                            </span>
<span  style=""> 457                                                                                                          </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 458             LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                               </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 459             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 459             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().whereðŸ”µ</abbr></span>
<span  style=""> 460                                                                                                          </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 461             List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                           </span>
<span  style=""> 462                                                                                                          </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 463             if (BuildConfig.DEBUG) {                                                                     </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 464                 LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465             }                                                                                            </span>
<span  style=""> 466                                                                                                          </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 467             if (!filterEntries.isEmpty()) {                                                              </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 468                 for (NotificationFilterEntry temp : filterEntries) {                                     </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 469                     wordsList.add(temp.getNotificationFilterContent());                                  </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 470                     LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472             }                                                                                            </span>
<span  style=""> 473                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 474         } catch (Exception e) {                                                                          </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 475             LOG.error(&quot;Could not acquire DB.&quot;, e);                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 476             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477         }                                                                                                </span>
<span  style=""> 478                                                                                                          </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 479         return shouldContinueAfterFilter(body, wordsList, notificationFilter);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480     }                                                                                                    </span>
<span  style=""> 481                                                                                                          </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 482     private void handleCallNotification(StatusBarNotification sbn) {                                     </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 483         String app = sbn.getPackageName();                                                               </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 484         LOG.debug(&quot;got call from: &quot; + app);                                                              </span>
<span class="-8307329673155612035" onmouseenter="enter('-8307329673155612035');" onmouseout="out('-8307329673155612035');" style=""> 485         if (app.equals(&quot;com.android.dialer&quot;)) {                                                          </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 486             LOG.debug(&quot;Ignoring non-voip call&quot;);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 487             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488         }                                                                                                </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 489         Notification noti = sbn.getNotification();                                                       </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 490         dumpExtras(noti.extras);                                                                         </span>
<span class="-894861467263649997" onmouseenter="enter('-894861467263649997');" onmouseout="out('-894861467263649997');" style=""> 491         boolean callStarted = false;                                                                     </span>
<span class="2342169434199266179" onmouseenter="enter('2342169434199266179');" onmouseout="out('2342169434199266179');" style=""> 492         if ((noti.actions != null) &amp;&amp; (noti.actions.length &gt; 0)) {                                       </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 493             for (Notification.Action action : noti.actions) {                                            </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 494                 LOG.info(&quot;Found call action: &quot; + action.title);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495             }                                                                                            </span>
<span class="150001560550536139" onmouseenter="enter('150001560550536139');" onmouseout="out('150001560550536139');" style=""> 496             if (noti.actions.length == 1) {                                                              </span>
<span class="1124706287521813013" onmouseenter="enter('1124706287521813013');" onmouseout="out('1124706287521813013');" style=""> 497                 if (mLastCallCommand == CallSpec.CALL_INCOMING) {                                        </span>
<span class="-8019351633415130414" onmouseenter="enter('-8019351633415130414');" onmouseout="out('-8019351633415130414');" style=""><abbr title=" 498                     LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuming call started&quot;);"> 498                     LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuminðŸ”µ</abbr></span>
<span class="3182682807764059315" onmouseenter="enter('3182682807764059315');" onmouseout="out('3182682807764059315');" style=""> 499                     callStarted = true;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 500                 } else {                                                                                 </span>
<span class="-4501418827174237895" onmouseenter="enter('-4501418827174237895');" onmouseout="out('-4501418827174237895');" style=""><abbr title=" 501                     LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assuming outgoing call / duplicate notification and ignoring&quot;);"> 501                     LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assðŸ”µ</abbr></span>
<span class="-8333753567790744727" onmouseenter="enter('-8333753567790744727');" onmouseout="out('-8333753567790744727');" style=""><abbr title=" 502                     // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more complete VoIP call state tracking?"> 502                     // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more coðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 503                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505             }                                                                                            </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 506             /*try {                                                                                      </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 507                 LOG.info(&quot;Executing first action&quot;);                                                      </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 508                 noti.actions[0].actionIntent.send();                                                     </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 509             } catch (PendingIntent.CanceledException e) {                                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 510                 e.printStackTrace();                                                                     </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 511             }*/                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512         }                                                                                                </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 513         // figure out sender                                                                             </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 514         String number;                                                                                   </span>
<span class="-15530700481497318" onmouseenter="enter('-15530700481497318');" onmouseout="out('-15530700481497318');" style=""> 515         if (noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                        </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 516             number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                   </span>
<span class="-9135287877624693374" onmouseenter="enter('-9135287877624693374');" onmouseout="out('-9135287877624693374');" style=""> 517         } else if (noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                  </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 518             number = noti.extras.getString(Notification.EXTRA_TITLE);                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 519         } else {                                                                                         </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 520             String appName = getAppName(app);                                                            </span>
<span class="-3582513979089678358" onmouseenter="enter('-3582513979089678358');" onmouseout="out('-3582513979089678358');" style=""> 521             number = (appName != null) ? appName : app;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522         }                                                                                                </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 523         activeCallPostTime = sbn.getPostTime();                                                          </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 524         CallSpec callSpec = new CallSpec();                                                              </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 525         callSpec.number = number;                                                                        </span>
<span class="-6721676865225830271" onmouseenter="enter('-6721676865225830271');" onmouseout="out('-6721676865225830271');" style=""> 526         callSpec.command = (callStarted) ? CallSpec.CALL_START : CallSpec.CALL_INCOMING;                 </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style=""> 527         mLastCallCommand = callSpec.command;                                                             </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 528         GBApplication.deviceService().onSetCallState(callSpec);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529     }                                                                                                    </span>
<span  style=""> 530                                                                                                          </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 531     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 531     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotðŸ”µ</abbr></span>
<span  style=""> 532                                                                                                          </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 533         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 533         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterModðŸ”µ</abbr></span>
<span  style=""> 534                                                                                                          </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""><abbr title=" 535         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;"> 535         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODðŸ”µ</abbr></span>
<span  style=""> 536                                                                                                          </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 537         switch (notificationFilter.getNotificationFilterMode()) {                                        </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 538             case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 539                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 540                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 541                         if (!body.contains(word)) {                                                      </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""><abbr title=" 542                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;);"> 542                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing contiðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 543                             return true;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545                     }                                                                                    </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 546                     LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 547                     return false;                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 548                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 549                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 549                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 550                     if (!containsAny) {                                                                  </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""><abbr title=" 551                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);"> 551                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continuðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 552                     } else {                                                                             </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""><abbr title=" 553                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);"> 553                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554                     }                                                                                    </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 555                     return !containsAny;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556                 }                                                                                        </span>
<span  style=""> 557                                                                                                          </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 558             case NOTIFICATION_FILTER_MODE_WHITELIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 559                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 560                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 561                         if (!body.contains(word)) {                                                      </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""><abbr title=" 562                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);"> 562                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stopsðŸ”µ</abbr></span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 563                             return false;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565                     }                                                                                    </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 566                     LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 567                     return true;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 568                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 569                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 569                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 570                     if (containsAny) {                                                                   </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 571                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 571                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 572                     } else {                                                                             </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""><abbr title=" 573                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);"> 573                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574                     }                                                                                    </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 575                     return containsAny;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576                 }                                                                                        </span>
<span  style=""> 577                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 578             default:                                                                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 579                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581     }                                                                                                    </span>
<span  style=""> 582                                                                                                          </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 583     // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons    </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 584     private String sanitizeUnicode(String orig) {                                                        </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 585         return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586     }                                                                                                    </span>
<span  style=""> 587                                                                                                          </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 588     private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,     </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 589                                        boolean preferBigText) {                                          </span>
<span  style=""> 590                                                                                                          </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 591         Bundle extras = NotificationCompat.getExtras(notification);                                      </span>
<span  style=""> 592                                                                                                          </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 593         //dumpExtras(extras);                                                                            </span>
<span class="3231714309982698113" onmouseenter="enter('3231714309982698113');" onmouseout="out('3231714309982698113');" style=""> 594         if (extras == null) {                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 595             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596         }                                                                                                </span>
<span  style=""> 597                                                                                                          </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 598         CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                           </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 599         if (title != null) {                                                                             </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 600             notificationSpec.title = sanitizeUnicode(title.toString());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601         }                                                                                                </span>
<span  style=""> 602                                                                                                          </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 603         CharSequence contentCS = null;                                                                   </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 604         if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                          </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 605             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                       </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 606         } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                        </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 607             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608         }                                                                                                </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 609         if (contentCS != null) {                                                                         </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 610             notificationSpec.body = sanitizeUnicode(contentCS.toString());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 611         }                                                                                                </span>
<span  style=""> 612                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 613     }                                                                                                    </span>
<span  style=""> 614                                                                                                          </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 615     private boolean isServiceRunning() {                                                                 </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 616         ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                  </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 617         if (manager == null) {                                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 618             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619         }                                                                                                </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""><abbr title=" 620         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {"> 620         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) ðŸ”µ</abbr></span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 621             if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 622                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 623             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 625         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626     }                                                                                                    </span>
<span  style=""> 627                                                                                                          </span>
<span class="5320463064367359781" onmouseenter="enter('5320463064367359781');" onmouseout="out('5320463064367359781');" style=""> 628     private boolean handleMediaSessionNotification(StatusBarNotification sbn) {                          </span>
<span class="-4962670587938601541" onmouseenter="enter('-4962670587938601541');" onmouseout="out('-4962670587938601541');" style=""> 629         MediaSessionCompat.Token mediaSession = getMediaSession(sbn.getNotification());                  </span>
<span class="2957772218986016328" onmouseenter="enter('2957772218986016328');" onmouseout="out('2957772218986016328');" style=""> 630         return (mediaSession != null) &amp;&amp; handleMediaSessionNotification(mediaSession);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631     }                                                                                                    </span>
<span  style=""> 632                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 633     /**                                                                                                  </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 634      * Try to handle media session notifications that tell info about the current play state.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 635      *                                                                                                   </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 636      * @param mediaSession The mediasession to handle.                                                   </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 637      * @return true if notification was handled, false otherwise                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 638      */                                                                                                  </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 639     public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {               </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 640         MusicSpec musicSpec = new MusicSpec();                                                           </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 641         MusicStateSpec stateSpec = new MusicStateSpec();                                                 </span>
<span  style=""> 642                                                                                                          </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 643         MediaControllerCompat c;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 644         try {                                                                                            </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 645             c = new MediaControllerCompat(getApplicationContext(), mediaSession);                        </span>
<span  style=""> 646                                                                                                          </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 647             PlaybackStateCompat s = c.getPlaybackState();                                                </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 648             stateSpec.position = (int) (s.getPosition() / 1000);                                         </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 649             stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                 </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 650             stateSpec.repeat = 1;                                                                        </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 651             stateSpec.shuffle = 1;                                                                       </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 652             switch (s.getState()) {                                                                      </span>
<span class="-5763838617161449343" onmouseenter="enter('-5763838617161449343');" onmouseout="out('-5763838617161449343');" style=""> 653                 case PlaybackStateCompat.STATE_PLAYING:                                                  </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 654                     stateSpec.state = MusicStateSpec.STATE_PLAYING;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 655                     break;                                                                               </span>
<span class="4559404571574135097" onmouseenter="enter('4559404571574135097');" onmouseout="out('4559404571574135097');" style=""> 656                 case PlaybackStateCompat.STATE_STOPPED:                                                  </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 657                     stateSpec.state = MusicStateSpec.STATE_STOPPED;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 658                     break;                                                                               </span>
<span class="1489652375659370630" onmouseenter="enter('1489652375659370630');" onmouseout="out('1489652375659370630');" style=""> 659                 case PlaybackStateCompat.STATE_PAUSED:                                                   </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 660                     stateSpec.state = MusicStateSpec.STATE_PAUSED;                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 661                     break;                                                                               </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 662                 default:                                                                                 </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 663                     stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 664                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665             }                                                                                            </span>
<span  style=""> 666                                                                                                          </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 667             MediaMetadataCompat d = c.getMetadata();                                                     </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 668             if (d == null)                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 669                 return false;                                                                            </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 670             if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                        </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 671                 musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                 </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 672             if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                         </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 673                 musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                   </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 674             if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                         </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 675                 musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                   </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 676             if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                      </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 677                 musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;  </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 678             if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                    </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 679                 musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);     </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 680             if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                  </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 681                 musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);      </span>
<span  style=""> 682                                                                                                          </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 683             // finally, tell the device about it                                                         </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 684             GBApplication.deviceService().onSetMusicInfo(musicSpec);                                     </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 685             GBApplication.deviceService().onSetMusicState(stateSpec);                                    </span>
<span  style=""> 686                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 687             return true;                                                                                 </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 688         } catch (NullPointerException | RemoteException e) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 689             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691     }                                                                                                    </span>
<span  style=""> 692                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 693     @Override                                                                                            </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 694     public void onNotificationRemoved(StatusBarNotification sbn) {                                       </span>
<span class="6067501100626656036" onmouseenter="enter('6067501100626656036');" onmouseout="out('6067501100626656036');" style=""> 695         logNotification(sbn, false);                                                                     </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 696         notificationStack.remove(sbn.getPackageName());                                                  </span>
<span class="8206101288573418362" onmouseenter="enter('8206101288573418362');" onmouseout="out('8206101288573418362');" style=""> 697         if (shouldIgnoreNotifications()) {                                                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 698             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699         }                                                                                                </span>
<span class="4264709970930991859" onmouseenter="enter('4264709970930991859');" onmouseout="out('4264709970930991859');" style=""> 700         if (shouldIgnoreSource(sbn)) {                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 701             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702         }                                                                                                </span>
<span class="3690366605899069409" onmouseenter="enter('3690366605899069409');" onmouseout="out('3690366605899069409');" style=""> 703         if (handleMediaSessionNotification(sbn)) {                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 704             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 705         }                                                                                                </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 706         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="5729570006670653729" onmouseenter="enter('5729570006670653729');" onmouseout="out('5729570006670653729');" style=""><abbr title=" 707             if (Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; (activeCallPostTime == sbn.getPostTime())) {"> 707             if (Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; (activeCallPostTime ðŸ”µ</abbr></span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style=""> 708                 activeCallPostTime = 0;                                                                  </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 709                 CallSpec callSpec = new CallSpec();                                                      </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style=""> 710                 callSpec.command = CallSpec.CALL_END;                                                    </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style=""> 711                 mLastCallCommand = callSpec.command;                                                     </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 712                 GBApplication.deviceService().onSetCallState(callSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714         }                                                                                                </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 715         // FIXME: DISABLED for now                                                                       </span>
<span class="-7697907629896539664" onmouseenter="enter('-7697907629896539664');" onmouseout="out('-7697907629896539664');" style=""> 716         if (shouldIgnoreNotification(sbn)) {                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 717             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718         }                                                                                                </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 719         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-1296834313751396403" onmouseenter="enter('-1296834313751396403');" onmouseout="out('-1296834313751396403');" style=""> 720         if (prefs.getBoolean(&quot;autoremove_notifications&quot;, true)) {                                        </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 721             LOG.info(&quot;notification removed, will ask device to delete it&quot;);                              </span>
<span class="-8350046841151188784" onmouseenter="enter('-8350046841151188784');" onmouseout="out('-8350046841151188784');" style=""> 722             GBApplication.deviceService().onDeleteNotification(((int) (sbn.getPostTime())));             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724     }                                                                                                    </span>
<span  style=""> 725                                                                                                          </span>
<span class="-2321374120209641351" onmouseenter="enter('-2321374120209641351');" onmouseout="out('-2321374120209641351');" style=""> 726     private void logNotification(StatusBarNotification sbn, boolean posted) {                            </span>
<span class="-8189953457642874915" onmouseenter="enter('-8189953457642874915');" onmouseout="out('-8189953457642874915');" style=""><abbr title=" 727         String infoMsg = ((posted ? &quot;Notification posted&quot; : &quot;Notification removed&quot;) + &quot;: &quot;) + sbn.getPackageName();"> 727         String infoMsg = ((posted ? &quot;Notification posted&quot; : &quot;Notification removed&quot;) + &quot;: &quot;) + sbn.getPackðŸ”µ</abbr></span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 728         if (GBApplication.isRunningLollipopOrLater()) {                                                  </span>
<span class="-2325475546032777056" onmouseenter="enter('-2325475546032777056');" onmouseout="out('-2325475546032777056');" style=""> 729             infoMsg += &quot;: &quot; + sbn.getNotification().category;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 730         }                                                                                                </span>
<span class="-8299794314619245363" onmouseenter="enter('-8299794314619245363');" onmouseout="out('-8299794314619245363');" style=""> 731         LOG.debug(infoMsg);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732     }                                                                                                    </span>
<span  style=""> 733                                                                                                          </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 734     private void dumpExtras(Bundle bundle) {                                                             </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 735         for (String key : bundle.keySet()) {                                                             </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 736             Object value = bundle.get(key);                                                              </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 737             if (value == null) {                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 738                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739             }                                                                                            </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 740             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 740             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 741         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 742     }                                                                                                    </span>
<span  style=""> 743                                                                                                          </span>
<span class="-3948619442008818904" onmouseenter="enter('-3948619442008818904');" onmouseout="out('-3948619442008818904');" style=""> 744     private boolean shouldIgnoreNotifications() {                                                        </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 745         /*                                                                                               </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 746          * return early if DeviceCommunicationService is not running,                                    </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 747          * else the service would get started every time we get a notification.                          </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 748          * unfortunately we cannot enable/disable NotificationListener at runtime like we do with        </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 749          * broadcast receivers because it seems to invalidate the permissions that are                   </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 750          * necessary for NotificationListenerService                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 751          */                                                                                              </span>
<span class="1533232748109360412" onmouseenter="enter('1533232748109360412');" onmouseout="out('1533232748109360412');" style=""> 752         if (!isServiceRunning()) {                                                                       </span>
<span class="4366338841311618901" onmouseenter="enter('4366338841311618901');" onmouseout="out('4366338841311618901');" style=""> 753             LOG.trace(&quot;Service is not running, ignoring notification&quot;);                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 754             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 756         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757     }                                                                                                    </span>
<span  style=""> 758                                                                                                          </span>
<span class="1771766823989063914" onmouseenter="enter('1771766823989063914');" onmouseout="out('1771766823989063914');" style=""> 759     private boolean shouldIgnoreSource(StatusBarNotification sbn) {                                      </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style=""> 760         String source = sbn.getPackageName();                                                            </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 761         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 762         /* do not display messages from &quot;android&quot;                                                        </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 763          * This includes keyboard selection message, usb connection messages, etc                        </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 764          * Hope it does not filter out too much, we will see...                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 765          */                                                                                              </span>
<span class="-2734204316913447780" onmouseenter="enter('-2734204316913447780');" onmouseout="out('-2734204316913447780');" style=""><abbr title=" 766         if (((source.equals(&quot;android&quot;) || source.equals(&quot;com.android.systemui&quot;)) || source.equals(&quot;com.android.dialer&quot;)) || source.equals(&quot;com.cyanogenmod.eleven&quot;)) {"> 766         if (((source.equals(&quot;android&quot;) || source.equals(&quot;com.android.systemui&quot;)) || source.equals(&quot;com.anðŸ”µ</abbr></span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 767             LOG.info(&quot;Ignoring notification, is a system event&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 768             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769         }                                                                                                </span>
<span class="3827970238385322855" onmouseenter="enter('3827970238385322855');" onmouseout="out('3827970238385322855');" style=""><abbr title=" 770         if ((((source.equals(&quot;com.moez.QKSMS&quot;) || source.equals(&quot;com.android.mms&quot;)) || source.equals(&quot;com.sonyericsson.conversations&quot;)) || source.equals(&quot;com.android.messaging&quot;)) || source.equals(&quot;org.smssecure.smssecure&quot;)) {"> 770         if ((((source.equals(&quot;com.moez.QKSMS&quot;) || source.equals(&quot;com.android.mms&quot;)) || source.equals(&quot;comðŸ”µ</abbr></span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 771             if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 772                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774         }                                                                                                </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 775         if (GBApplication.appIsNotifBlacklisted(source)) {                                               </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 776             LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 777             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 779         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780     }                                                                                                    </span>
<span  style=""> 781                                                                                                          </span>
<span class="2810158062458488939" onmouseenter="enter('2810158062458488939');" onmouseout="out('2810158062458488939');" style=""> 782     private boolean shouldIgnoreNotification(StatusBarNotification sbn) {                                </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 783         Notification notification = sbn.getNotification();                                               </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style=""> 784         String source = sbn.getPackageName();                                                            </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 785         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 786         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 786         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 787         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-243380540587029064" onmouseenter="enter('-243380540587029064');" onmouseout="out('-243380540587029064');" style=""><abbr title=" 788         if (((NotificationCompat.getLocalOnly(notification) &amp;&amp; (type != NotificationType.WECHAT)) &amp;&amp; (type != NotificationType.OUTLOOK)) &amp;&amp; (type != NotificationType.SKYPE)) {"> 788         if (((NotificationCompat.getLocalOnly(notification) &amp;&amp; (type != NotificationType.WECHAT)) &amp;&amp; (typðŸ”µ</abbr></span>
<span class="-4400049527969698929" onmouseenter="enter('-4400049527969698929');" onmouseout="out('-4400049527969698929');" style=""> 789             // see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109                            </span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 790             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 791             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792         }                                                                                                </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 793         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 794         if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                            </span>
<span class="-1033540538762468291" onmouseenter="enter('-1033540538762468291');" onmouseout="out('-1033540538762468291');" style=""> 795             PowerManager powermanager = ((PowerManager) (getSystemService(POWER_SERVICE)));              </span>
<span class="-5809956872773294216" onmouseenter="enter('-5809956872773294216');" onmouseout="out('-5809956872773294216');" style=""> 796             if ((powermanager != null) &amp;&amp; powermanager.isScreenOn()) {                                   </span>
<span class="-7763261956658220331" onmouseenter="enter('-7763261956658220331');" onmouseout="out('-7763261956658220331');" style=""><abbr title=" 797                 // LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);"> 797                 // LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allowðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 798                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800         }                                                                                                </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 801         return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802     }                                                                                                    </span>
<span  style=""> 803                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 804     /**                                                                                                  </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 805      * Get the notification color that should be used for this Pebble notification.                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 806      *                                                                                                   </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 807      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 807      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PeðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 808      *                                                                                                   </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 809      * See Issue #815 on GitHub to see how notification colors are set.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 810      *                                                                                                   </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 811      * @param notificationSpec The NotificationSpec to read from.                                        </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 812      * @return Returns a PebbleColor that best represents this notification.                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 813      */                                                                                                  </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 814     private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                      </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 815         String appId = notificationSpec.sourceAppId;                                                     </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 816         NotificationType existingType = notificationSpec.type;                                           </span>
<span  style=""> 817                                                                                                          </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 818         // If the notification type is known, return the associated color.                               </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 819         if (existingType != NotificationType.UNKNOWN) {                                                  </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 820             return existingType.color;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821         }                                                                                                </span>
<span  style=""> 822                                                                                                          </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 823         // Otherwise, we go and attempt to find the color from the app icon.                             </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 824         Drawable icon;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 825         try {                                                                                            </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 826             icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 827             Objects.requireNonNull(icon);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 828         } catch (Exception ex) {                                                                         </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 829             // If we can&#x27;t get the icon, we go with the default defined above.                           </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 830             LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                       </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 831             return PebbleColor.IslamicGreen;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832         }                                                                                                </span>
<span  style=""> 833                                                                                                          </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 834         Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                    </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 835         int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                           </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 836                 .generate()                                                                              </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 837                 .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                           </span>
<span  style=""> 838                                                                                                          </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 839         return PebbleUtils.getPebbleColor(iconPrimaryColor);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 841 }                                                                                                        </span>























































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="197175695684748742" onmouseenter="enter('197175695684748742');" onmouseout="out('197175695684748742');" style="">   1  /*  Copyright (C) 2015-2019 abettenburg, Andreas Shimokawa, AndrewBedscastle,                                     </span>

<span class="-3541979219390877329" onmouseenter="enter('-3541979219390877329');" onmouseout="out('-3541979219390877329');" style="">   2      Carsten Pfeiffer, Daniel Dakhno, Daniele Gobbetti, Frank Slezak, Hasan Ammar,                                 </span>
<span class="-531692918395923150" onmouseenter="enter('-531692918395923150');" onmouseout="out('-531692918395923150');" style="">   3      JosÃ© Rebelo, Julien Pivotto, Kevin Richter, Matthieu Baerts, Normano64,                                       </span>
<span class="1862847412929924698" onmouseenter="enter('1862847412929924698');" onmouseout="out('1862847412929924698');" style="">   4      Steffen Liebergeld, Taavi EomÃ¤e, veecue, Zhong Jianxin                                                        </span>
<span  style="">   5                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   6      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   7                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   8      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   9      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">  10      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  11      (at your option) any later version.                                                                           </span>
<span  style="">  12                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  13      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  14      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  15      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  16      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  17                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  18      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  19      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  20  package nodomain.freeyourgadget.gadgetbridge.externalevents;                                                      </span>
<span  style="">  21                                                                                                                    </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  22  import android.app.ActivityManager;                                                                               </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  23  import android.app.Notification;                                                                                  </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  24  import android.app.NotificationManager;                                                                           </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  25  import android.app.PendingIntent;                                                                                 </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  26  import android.content.BroadcastReceiver;                                                                         </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  27  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  28  import android.content.Intent;                                                                                    </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  29  import android.content.IntentFilter;                                                                              </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30  import android.content.pm.PackageManager;                                                                         </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31  import android.graphics.Bitmap;                                                                                   </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32  import android.graphics.Color;                                                                                    </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34  import android.media.MediaMetadata;                                                                               </span>
<span class="-4549785658871057260" onmouseenter="enter('-4549785658871057260');" onmouseout="out('-4549785658871057260');" style="">  35  import android.os.Build;                                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  36  import android.os.Bundle;                                                                                         </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  37  import android.os.PowerManager;                                                                                   </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  38  import android.os.RemoteException;                                                                                </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  39  import android.service.notification.NotificationListenerService;                                                  </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  40  import android.service.notification.StatusBarNotification;                                                        </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  41  import android.support.v4.media.MediaMetadataCompat;                                                              </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  42  import android.support.v4.media.session.MediaControllerCompat;                                                    </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  43  import android.support.v4.media.session.MediaSessionCompat;                                                       </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  44  import android.support.v4.media.session.PlaybackStateCompat;                                                      </span>
<span  style="">  45                                                                                                                    </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="">  46  import androidx.annotation.NonNull;                                                                               </span>
<span class="6920508932322900435" onmouseenter="enter('6920508932322900435');" onmouseout="out('6920508932322900435');" style="">  47  import androidx.annotation.RequiresApi;                                                                           </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="">  48  import androidx.core.app.NotificationCompat;                                                                      </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="">  49  import androidx.core.app.RemoteInput;                                                                             </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  50  import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                              </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="">  51  import androidx.palette.graphics.Palette;                                                                         </span>
<span  style="">  52                                                                                                                    </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  53  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  54  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  55  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  56                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  57  import java.util.ArrayList;                                                                                       </span>

<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  58  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  59  import java.util.List;                                                                                            </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  60  import java.util.Objects;                                                                                         </span>


<span  style="">  61                                                                                                                    </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  62  import de.greenrobot.dao.query.Query;                                                                             </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  63  import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                          </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  64  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  65  import nodomain.freeyourgadget.gadgetbridge.R;                                                                    </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  66  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  67  import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                           </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  68  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                          </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  69  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                                       </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  70  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                                     </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  71  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                                  </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="">  72  import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                            </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  73  import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                                       </span>
<span class="1593353296711823731" onmouseenter="enter('1593353296711823731');" onmouseout="out('1593353296711823731');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +import nodomain.freeyourgadget.gadgetbridge.model.DeviceType;                                                     </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  75  import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                                      </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  76  import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                                 </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  77  import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                               </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="">  78  import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                               </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  79  import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                                   </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  80  import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                                      </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  81  import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                                    </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  82  import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                                     </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  83  import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                           </span>
<span  style="">  84                                                                                                                    </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="">  85  import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                                   </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title="  86  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;">  86  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_ðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title="  87  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;">  87  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_ðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title="  88  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;">  88  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMOðŸ”µ</abbr></span>
<span  style="">  89                                                                                                                    </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  90  public class NotificationListener extends NotificationListenerService {                                           </span>
<span  style="">  91                                                                                                                    </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  92      private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);                        </span>
<span  style="">  93                                                                                                                    </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  94      public static final String ACTION_DISMISS                                                                     </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  95              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                         </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  96      public static final String ACTION_DISMISS_ALL                                                                 </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style="">  97              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;                     </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style="">  98      public static final String ACTION_OPEN                                                                        </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style="">  99              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                            </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style=""> 100      public static final String ACTION_MUTE                                                                        </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style=""> 101              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                            </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style=""> 102      public static final String ACTION_REPLY                                                                       </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 103              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                           </span>
<span  style=""> 104                                                                                                                    </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 105      private LimitedQueue mActionLookup = new LimitedQueue(32);                                                    </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 106      private LimitedQueue mPackageLookup = new LimitedQueue(64);                                                   </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 107      private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                                       </span>
<span  style=""> 108                                                                                                                    </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 109      private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                                  </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 110      private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                              </span>
<span  style=""> 111                                                                                                                    </span>




<span class="-3455620612898728599" onmouseenter="enter('-3455620612898728599');" onmouseout="out('-3455620612898728599');" style=""> 112      public static ArrayList&lt;String&gt; notificationStack = new ArrayList&lt;&gt;();                                        </span>
<span  style=""> 113                                                                                                                    </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 114      private long activeCallPostTime;                                                                              </span>

<span  style=""> 115                                                                                                                    </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 116      private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                         </span>
<span  style=""> 117                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 118          @Override                                                                                                 </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 119          public void onReceive(Context context, Intent intent) {                                                   </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 120              String action = intent.getAction();                                                                   </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 121              if (action == null) {                                                                                 </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 122                  LOG.warn(&quot;no action&quot;);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 123                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124              }                                                                                                     </span>
<span  style=""> 125                                                                                                                    </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 126              int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                                 </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 127              switch (action) {                                                                                     </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 128                  case GBApplication.ACTION_QUIT:                                                                   </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 129                      stopSelf();                                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 130                      break;                                                                                        </span>
<span  style=""> 131                                                                                                                    </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 132                  case ACTION_OPEN: {                                                                               </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 133                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 134                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 135                      if (ts == null) {                                                                             </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 136                          LOG.info(&quot;could not lookup handle for open action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 137                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                      }                                                                                             </span>
<span  style=""> 139                                                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 140                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 141                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 142                              try {                                                                                 </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 143                                  PendingIntent pi = sbn.getNotification().contentIntent;                           </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 144                                  if (pi != null) {                                                                 </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 145                                      pi.send();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                                  }                                                                                 </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 147                              } catch (PendingIntent.CanceledException e) {                                         </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 148                                  e.printStackTrace();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 152                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153                  }                                                                                                 </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 154                  case ACTION_MUTE:                                                                                 </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 155                      String packageName = (String) mPackageLookup.lookup(handle);                                  </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 156                      if (packageName == null) {                                                                    </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 157                          LOG.info(&quot;could not lookup handle for mute action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 158                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                      }                                                                                             </span>
<span  style=""> 160                                                                                                                    </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 161                      LOG.info(&quot;going to mute &quot; + packageName);                                                     </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 162                      GBApplication.addAppToNotifBlacklist(packageName);                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 163                      break;                                                                                        </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 164                  case ACTION_DISMISS: {                                                                            </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 165                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 166                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 167                      if (ts == null) {                                                                             </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 168                          LOG.info(&quot;could not lookup handle for dismiss action&quot;);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 169                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170                      }                                                                                             </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 171                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 172                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 173                              if (GBApplication.isRunningLollipopOrLater()) {                                       </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 174                                  String key = sbn.getKey();                                                        </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 175                                  NotificationListener.this.cancelNotification(key);                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 176                              } else {                                                                              </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 177                                  int id = sbn.getId();                                                             </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 178                                  String pkg = sbn.getPackageName();                                                </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 179                                  String tag = sbn.getTag();                                                        </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 180                                  NotificationListener.this.cancelNotification(pkg, tag, id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 184                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                  }                                                                                                 </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 186                  case ACTION_DISMISS_ALL:                                                                          </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 187                      NotificationListener.this.cancelAllNotifications();                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 188                      break;                                                                                        </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 189                  case ACTION_REPLY:                                                                                </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 190                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 190                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(haðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 191                      String reply = intent.getStringExtra(&quot;reply&quot;);                                                </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 192                      if (wearableAction != null) {                                                                 </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 193                          PendingIntent actionIntent = wearableAction.getActionIntent();                            </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 194                          Intent localIntent = new Intent();                                                        </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 195                          localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                                      </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 196                          if(wearableAction.getRemoteInputs()!=null) {                                              </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 197                              RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();                        </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 198                              Bundle extras = new Bundle();                                                         </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 199                              extras.putCharSequence(remoteInputs[0].getResultKey(), reply);                        </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 200                              RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201                          }                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 202                          try {                                                                                     </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 203                              LOG.info(&quot;will send exec intent to remote application&quot;);                              </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 204                              actionIntent.send(context, 0, localIntent);                                           </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 205                              mActionLookup.remove(handle);                                                         </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 206                          } catch (PendingIntent.CanceledException e) {                                             </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 207                              LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 210                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 213      };                                                                                                            </span>
<span  style=""> 214                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 215      @Override                                                                                                     </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 216      public void onCreate() {                                                                                      </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 217          super.onCreate();                                                                                         </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 218          IntentFilter filterLocal = new IntentFilter();                                                            </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 219          filterLocal.addAction(GBApplication.ACTION_QUIT);                                                         </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 220          filterLocal.addAction(ACTION_OPEN);                                                                       </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 221          filterLocal.addAction(ACTION_DISMISS);                                                                    </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 222          filterLocal.addAction(ACTION_DISMISS_ALL);                                                                </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 223          filterLocal.addAction(ACTION_MUTE);                                                                       </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 224          filterLocal.addAction(ACTION_REPLY);                                                                      </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 225          LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226      }                                                                                                             </span>
<span  style=""> 227                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 228      @Override                                                                                                     </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 229      public void onDestroy() {                                                                                     </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 230          LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                                    </span>
<span class="-3610691555806270699" onmouseenter="enter('-3610691555806270699');" onmouseout="out('-3610691555806270699');" style=""> 231          notificationStack.clear();                                                                                </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 232          super.onDestroy();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233      }                                                                                                             </span>
<span  style=""> 234                                                                                                                    </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 235      public String getAppName(String pkg) {                                                                        </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 236          // determinate Source App Name (&quot;Label&quot;)                                                                  </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 237          PackageManager pm = getPackageManager();                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 238          try {                                                                                                     </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style=""> 239              return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                                 </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 240          } catch (PackageManager.NameNotFoundException e) {                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 241              e.printStackTrace();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 243          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244      }                                                                                                             </span>
<span  style=""> 245                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 246      @Override                                                                                                     </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 247      public void onNotificationPosted(StatusBarNotification sbn) {                                                 </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 248          Prefs prefs = GBApplication.getPrefs();                                                                   </span>

<span  style=""> 249                                                                                                                    </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 250          notificationStack.remove(sbn.getPackageName());                                                           </span>
<span class="6183718114314290730" onmouseenter="enter('6183718114314290730');" onmouseout="out('6183718114314290730');" style=""> 251          notificationStack.add(sbn.getPackageName());                                                              </span>
<span  style=""> 252                                                                                                                    </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 253          if (GBApplication.isRunningLollipopOrLater()) {                                                           </span>
<span class="-8448425987946302452" onmouseenter="enter('-8448425987946302452');" onmouseout="out('-8448425987946302452');" style=""><abbr title=" 254              if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {"> 254              if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_callsðŸ”µ</abbr></span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style=""> 255                  handleCallNotification(sbn);                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 256                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +                                                                                                                  </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style=""> 260          if (shouldIgnore(sbn)) {                                                                                  </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 261 -            LOG.info(&quot;Ignore notification&quot;);                                                                      </span>




<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -            return;                                                                                               </span>
<span class="4755371366859202493" onmouseenter="enter('4755371366859202493');" onmouseout="out('4755371366859202493');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 263 +            if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to allow phone alarm notification"> 263 +            if (!&quot;com.sec.android.app.clockpackage&quot;.equals(sbn.getPackageName())) {     // workaround to allow phoðŸ”µ</abbr></span>
<span class="2012465491164047553" onmouseenter="enter('2012465491164047553');" onmouseout="out('2012465491164047553');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +                LOG.info(&quot;Ignore notification: &quot; + sbn.getPackageName());               // need to fix            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267          }                                                                                                         </span>
<span  style=""> 268                                                                                                                    </span>


<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 269          switch (GBApplication.getGrantedInterruptionFilter()) {                                                   </span>
<span class="4109165554183544277" onmouseenter="enter('4109165554183544277');" onmouseout="out('4109165554183544277');" style=""> 270              case NotificationManager.INTERRUPTION_FILTER_ALL:                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 271                  break;                                                                                            </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 272              case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                                  </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 273              case NotificationManager.INTERRUPTION_FILTER_NONE:                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 274                  return;                                                                                           </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 275              case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                                </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 276                  // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 277                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278          }                                                                                                         </span>
<span  style=""> 279                                                                                                                    </span>














<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 280          String source = sbn.getPackageName().toLowerCase();                                                       </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 281          Notification notification = sbn.getNotification();                                                        </span>
<span class="4218475881538878307" onmouseenter="enter('4218475881538878307');" onmouseout="out('4218475881538878307');" style=""> 282          if (notificationOldRepeatPrevention.containsKey(source)) {                                                </span>
<span class="6155853035860803703" onmouseenter="enter('6155853035860803703');" onmouseout="out('6155853035860803703');" style=""> 283              if (notification.when &lt;= notificationOldRepeatPrevention.get(source)) {                               </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""> 284                  LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 285                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286              }                                                                                                     </span>






<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287          }                                                                                                         </span>
<span  style=""> 288                                                                                                                    </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 289          // Ignore too frequent notifications, according to user preference                                        </span>
<span class="8739203694966910315" onmouseenter="enter('8739203694966910315');" onmouseout="out('8739203694966910315');" style=""> 290          long min_timeout = (long)prefs.getInt(&quot;notifications_timeout&quot;, 0) * 1000L;                                </span>
<span class="7158364678624901735" onmouseenter="enter('7158364678624901735');" onmouseout="out('7158364678624901735');" style=""> 291          long cur_time = System.currentTimeMillis();                                                               </span>
<span class="4691272725591601941" onmouseenter="enter('4691272725591601941');" onmouseout="out('4691272725591601941');" style=""> 292          if (notificationBurstPrevention.containsKey(source)) {                                                    </span>
<span class="-7388621012045880255" onmouseenter="enter('-7388621012045880255');" onmouseout="out('-7388621012045880255');" style=""> 293              long last_time = notificationBurstPrevention.get(source);                                             </span>
<span class="8371821158922557754" onmouseenter="enter('8371821158922557754');" onmouseout="out('8371821158922557754');" style=""> 294              if (cur_time - last_time &lt; min_timeout) {                                                             </span>
<span class="761193726766758320" onmouseenter="enter('761193726766758320');" onmouseout="out('761193726766758320');" style=""> 295                  LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms ago&quot;);    </span>







<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 296                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298          }                                                                                                         </span>
<span  style=""> 299                                                                                                                    </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 300          NotificationSpec notificationSpec = new NotificationSpec();                                               </span>
<span  style=""> 301                                                                                                                    </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 302          // determinate Source App Name (&quot;Label&quot;)                                                                  </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 303          String name = getAppName(source);                                                                         </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 304          if (name != null) {                                                                                       </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 305              notificationSpec.sourceName = name;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306          }                                                                                                         </span>
<span  style=""> 307                                                                                                                    </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 308          boolean preferBigText = false;                                                                            </span>
<span  style=""> 309                                                                                                                    </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 310          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 310          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 311          notificationSpec.sourceAppId = source;                                                                    </span>
<span  style=""> 312                                                                                                                    </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 313          notificationSpec.type = AppNotificationType.getInstance().get(source);                                    </span>
<span  style=""> 314                                                                                                                    </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 315          //FIXME: some quirks lookup table would be the minor evil here                                            </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 316          if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                                   </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 317              if (NotificationCompat.isGroupSummary(notification)) {                                                </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 318                  LOG.info(&quot;ignore K9 group summary&quot;);                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 319                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320              }                                                                                                     </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 321              preferBigText = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322          }                                                                                                         </span>
<span  style=""> 323                                                                                                                    </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 324          if (notificationSpec.type == null) {                                                                      </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 325              notificationSpec.type = NotificationType.UNKNOWN;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326          }                                                                                                         </span>
<span  style=""> 327                                                                                                                    </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 328          // Get color                                                                                              </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 329          notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                           </span>
<span  style=""> 330                                                                                                                    </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 331          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 331          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - ðŸ”µ</abbr></span>
<span  style=""> 332                                                                                                                    </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 333          dissectNotificationTo(notification, notificationSpec, preferBigText);                                     </span>
<span  style=""> 334                                                                                                                    </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 335          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 335          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.bodðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 336              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337          }                                                                                                         </span>
<span  style=""> 338                                                                                                                    </span>
<span  style=""> 339                                                                                                                    </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 340          // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen                   </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 341          if (getApplicationContext().getPackageName().equals(source)) {                                            </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""> 342              if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 343                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345          }                                                                                                         </span>
<span  style=""> 346                                                                                                                    </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 347          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 347          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notificatioðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 348          List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                                  </span>
<span  style=""> 349                                                                                                                    </span>
<span  style=""> 350                                                                                                                    </span>
<span class="7774033817539746019" onmouseenter="enter('7774033817539746019');" onmouseout="out('7774033817539746019');" style=""><abbr title=" 351          if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to come back"> 351          if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to cðŸ”µ</abbr></span>


<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 352              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 352              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. NotifðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 353              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354          }                                                                                                         </span>
<span  style=""> 355                                                                                                                    </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 356          notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                                     </span>
<span  style=""> 357                                                                                                                    </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 358          // DISMISS action                                                                                         </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 359          NotificationSpec.Action dismissAction = new NotificationSpec.Action();                                    </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 360          dismissAction.title = &quot;Dismiss&quot;;                                                                          </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 361          dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                                      </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 362          notificationSpec.attachedActions.add(dismissAction);                                                      </span>
<span  style=""> 363                                                                                                                    </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 364          for (NotificationCompat.Action act : actions) {                                                           </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 365              if (act != null) {                                                                                    </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 366                  NotificationSpec.Action wearableAction = new NotificationSpec.Action();                           </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 367                  wearableAction.title = act.getTitle().toString();                                                 </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 368                  if(act.getRemoteInputs()!=null) {                                                                 </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 369                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 370                  } else {                                                                                          </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 371                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372                  }                                                                                                 </span>
<span  style=""> 373                                                                                                                    </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 374                  notificationSpec.attachedActions.add(wearableAction);                                             </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""> 375                  mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);  </span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 376                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 376                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378          }                                                                                                         </span>
<span  style=""> 379                                                                                                                    </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 380          // OPEN action                                                                                            </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 381          NotificationSpec.Action openAction = new NotificationSpec.Action();                                       </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 382          openAction.title = getString(R.string._pebble_watch_open_on_phone);                                       </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 383          openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                            </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 384          notificationSpec.attachedActions.add(openAction);                                                         </span>
<span  style=""> 385                                                                                                                    </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 386          // MUTE action                                                                                            </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 387          NotificationSpec.Action muteAction = new NotificationSpec.Action();                                       </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 388          muteAction.title = getString(R.string._pebble_watch_mute);                                                </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 389          muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                            </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 390          notificationSpec.attachedActions.add(muteAction);                                                         </span>
<span  style=""> 391                                                                                                                    </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""> 392          mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN  </span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 393          mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                           </span>
<span  style=""> 394                                                                                                                    </span>
<span class="5979670797208442666" onmouseenter="enter('5979670797208442666');" onmouseout="out('5979670797208442666');" style=""> 395          notificationBurstPrevention.put(source, cur_time);                                                        </span>

<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style=""> 396          if(0 != notification.when) {                                                                              </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 397              notificationOldRepeatPrevention.put(source, notification.when);                                       </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 398          }else {                                                                                                   </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""> 399              LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400          }                                                                                                         </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 401          GBApplication.deviceService().onNotification(notificationSpec);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402      }                                                                                                             </span>
<span  style=""> 403                                                                                                                    </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 404      private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {               </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 405          long start = System.currentTimeMillis();                                                                  </span>
<span  style=""> 406                                                                                                                    </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 407          List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                               </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 408          NotificationFilter notificationFilter;                                                                    </span>
<span  style=""> 409                                                                                                                    </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 410          try (DBHandler db = GBApplication.acquireDB()) {                                                          </span>
<span  style=""> 411                                                                                                                    </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 412              NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao();          </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 413              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 413              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDðŸ”µ</abbr></span>
<span  style=""> 414                                                                                                                    </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 415              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 415              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.ProðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 416              notificationFilter = query.unique();                                                                  </span>
<span  style=""> 417                                                                                                                    </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 418              if (notificationFilter == null) {                                                                     </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 419                  LOG.debug(&quot;No Notification Filter found&quot;);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 420                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421              }                                                                                                     </span>
<span  style=""> 422                                                                                                                    </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 423              LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                                        </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 424              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 424              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificaðŸ”µ</abbr></span>
<span  style=""> 425                                                                                                                    </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 426              List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                                    </span>
<span  style=""> 427                                                                                                                    </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 428              if (BuildConfig.DEBUG) {                                                                              </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 429                  LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430              }                                                                                                     </span>
<span  style=""> 431                                                                                                                    </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 432              if (!filterEntries.isEmpty()) {                                                                       </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 433                  for (NotificationFilterEntry temp : filterEntries) {                                              </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 434                      wordsList.add(temp.getNotificationFilterContent());                                           </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 435                      LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437              }                                                                                                     </span>
<span  style=""> 438                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 439          } catch (Exception e) {                                                                                   </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 440              LOG.error(&quot;Could not acquire DB.&quot;, e);                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 441              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442          }                                                                                                         </span>
<span  style=""> 443                                                                                                                    </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 444          return shouldContinueAfterFilter(body, wordsList, notificationFilter);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445      }                                                                                                             </span>
<span  style=""> 446                                                                                                                    </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 447      private void handleCallNotification(StatusBarNotification sbn) {                                              </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 448          String app = sbn.getPackageName();                                                                        </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 449          LOG.debug(&quot;got call from: &quot; + app);                                                                       </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style=""> 450          if(app.equals(&quot;com.android.dialer&quot;)) {                                                                    </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 451              LOG.debug(&quot;Ignoring non-voip call&quot;);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 452              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453          }                                                                                                         </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 454          Notification noti = sbn.getNotification();                                                                </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 455          dumpExtras(noti.extras);                                                                                  </span>

<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style=""> 456          if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                                     </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 457              for (Notification.Action action : noti.actions) {                                                     </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 458                  LOG.info(&quot;Found call action: &quot; + action.title);                                                   </span>










<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459              }                                                                                                     </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 460              /*try {                                                                                               </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 461                  LOG.info(&quot;Executing first action&quot;);                                                               </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 462                  noti.actions[0].actionIntent.send();                                                              </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 463              } catch (PendingIntent.CanceledException e) {                                                         </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 464                  e.printStackTrace();                                                                              </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 465              }*/                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466          }                                                                                                         </span>
<span  style=""> 467                                                                                                                    </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 468          // figure out sender                                                                                      </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 469          String number;                                                                                            </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style=""> 470          if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                                  </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 471              number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                            </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style=""> 472          } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                            </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 473              number = noti.extras.getString(Notification.EXTRA_TITLE);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 474          } else {                                                                                                  </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 475              String appName = getAppName(app);                                                                     </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style=""> 476              number = appName != null ? appName : app;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477          }                                                                                                         </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 478          activeCallPostTime = sbn.getPostTime();                                                                   </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 479          CallSpec callSpec = new CallSpec();                                                                       </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 480          callSpec.number = number;                                                                                 </span>
<span class="-4416193589830976087" onmouseenter="enter('-4416193589830976087');" onmouseout="out('-4416193589830976087');" style=""> 481          callSpec.command = CallSpec.CALL_INCOMING;                                                                </span>


<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 482          GBApplication.deviceService().onSetCallState(callSpec);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483      }                                                                                                             </span>
<span  style=""> 484                                                                                                                    </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 485      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 485      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationðŸ”µ</abbr></span>
<span  style=""> 486                                                                                                                    </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 487          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 487          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notiðŸ”µ</abbr></span>
<span  style=""> 488                                                                                                                    </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""> 489          boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;   </span>
<span  style=""> 490                                                                                                                    </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 491          switch (notificationFilter.getNotificationFilterMode()) {                                                 </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 492              case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 493                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 494                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 495                          if (!body.contains(word)) {                                                               </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""> 496                              LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;); </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 497                              return true;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499                      }                                                                                             </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 500                      LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 501                      return false;                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 502                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 503                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 504                      if (!containsAny) {                                                                           </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""> 505                          LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 506                      } else {                                                                                      </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""> 507                          LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508                      }                                                                                             </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 509                      return !containsAny;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510                  }                                                                                                 </span>
<span  style=""> 511                                                                                                                    </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 512              case NOTIFICATION_FILTER_MODE_WHITELIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 513                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 514                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 515                          if (!body.contains(word)) {                                                               </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""> 516                              LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 517                              return false;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519                      }                                                                                             </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 520                      LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 521                      return true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 522                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 523                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 524                      if (containsAny) {                                                                            </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 525                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 525                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continuesðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 526                      } else {                                                                                      </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""> 527                          LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528                      }                                                                                             </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 529                      return containsAny;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530                  }                                                                                                 </span>
<span  style=""> 531                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 532              default:                                                                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 533                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535      }                                                                                                             </span>
<span  style=""> 536                                                                                                                    </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 537      // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons             </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 538      private String sanitizeUnicode(String orig) {                                                                 </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 539          return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540      }                                                                                                             </span>
<span  style=""> 541                                                                                                                    </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 542      private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,              </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 543                                         boolean preferBigText) {                                                   </span>
<span  style=""> 544                                                                                                                    </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 545          Bundle extras = NotificationCompat.getExtras(notification);                                               </span>
<span  style=""> 546                                                                                                                    </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 547          //dumpExtras(extras);                                                                                     </span>
<span class="3231714309982698113" onmouseenter="enter('3231714309982698113');" onmouseout="out('3231714309982698113');" style=""> 548          if (extras == null) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 549              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550          }                                                                                                         </span>
<span  style=""> 551                                                                                                                    </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 552          CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                                    </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 553          if (title != null) {                                                                                      </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 554              notificationSpec.title = sanitizeUnicode(title.toString());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555          }                                                                                                         </span>
<span  style=""> 556                                                                                                                    </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 557          CharSequence contentCS = null;                                                                            </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 558          if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                                   </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 559              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                                </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 560          } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                                 </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 561              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562          }                                                                                                         </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 563          if (contentCS != null) {                                                                                  </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 564              notificationSpec.body = sanitizeUnicode(contentCS.toString());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565          }                                                                                                         </span>
<span  style=""> 566                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567      }                                                                                                             </span>
<span  style=""> 568                                                                                                                    </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 569      private boolean isServiceRunning() {                                                                          </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 570          ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                           </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 571          if (manager == null) {                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 572              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573          }                                                                                                         </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""> 574          for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {        </span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 575              if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 576                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 579          return false;                                                                                             </span>





<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580      }                                                                                                             </span>
<span  style=""> 581                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 582      /**                                                                                                           </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 583       * Try to handle media session notifications that tell info about the current play state.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 584       *                                                                                                            </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 585       * @param mediaSession The mediasession to handle.                                                            </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 586       * @return true if notification was handled, false otherwise                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 587       */                                                                                                           </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 588      public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {                        </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 589          MusicSpec musicSpec = new MusicSpec();                                                                    </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 590          MusicStateSpec stateSpec = new MusicStateSpec();                                                          </span>
<span  style=""> 591                                                                                                                    </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 592          MediaControllerCompat c;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 593          try {                                                                                                     </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 594              c = new MediaControllerCompat(getApplicationContext(), mediaSession);                                 </span>
<span  style=""> 595                                                                                                                    </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 596              PlaybackStateCompat s = c.getPlaybackState();                                                         </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 597              stateSpec.position = (int) (s.getPosition() / 1000);                                                  </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 598              stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                          </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 599              stateSpec.repeat = 1;                                                                                 </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 600              stateSpec.shuffle = 1;                                                                                </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 601              switch (s.getState()) {                                                                               </span>
<span class="-5763838617161449343" onmouseenter="enter('-5763838617161449343');" onmouseout="out('-5763838617161449343');" style=""> 602                  case PlaybackStateCompat.STATE_PLAYING:                                                           </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 603                      stateSpec.state = MusicStateSpec.STATE_PLAYING;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 604                      break;                                                                                        </span>
<span class="4559404571574135097" onmouseenter="enter('4559404571574135097');" onmouseout="out('4559404571574135097');" style=""> 605                  case PlaybackStateCompat.STATE_STOPPED:                                                           </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 606                      stateSpec.state = MusicStateSpec.STATE_STOPPED;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 607                      break;                                                                                        </span>
<span class="1489652375659370630" onmouseenter="enter('1489652375659370630');" onmouseout="out('1489652375659370630');" style=""> 608                  case PlaybackStateCompat.STATE_PAUSED:                                                            </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 609                      stateSpec.state = MusicStateSpec.STATE_PAUSED;                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 610                      break;                                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 611                  default:                                                                                          </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 612                      stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 613                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 614              }                                                                                                     </span>
<span  style=""> 615                                                                                                                    </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 616              MediaMetadataCompat d = c.getMetadata();                                                              </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 617              if (d == null)                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 618                  return false;                                                                                     </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 619              if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                                 </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 620                  musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                          </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 621              if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                                  </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 622                  musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                            </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 623              if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                                  </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 624                  musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                            </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 625              if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                               </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 626                  musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;           </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 627              if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                             </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 628                  musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);              </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 629              if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                           </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 630                  musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);               </span>
<span  style=""> 631                                                                                                                    </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 632              // finally, tell the device about it                                                                  </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 633              GBApplication.deviceService().onSetMusicInfo(musicSpec);                                              </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 634              GBApplication.deviceService().onSetMusicState(stateSpec);                                             </span>
<span  style=""> 635                                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 636              return true;                                                                                          </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 637          } catch (NullPointerException | RemoteException e) {                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 638              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640      }                                                                                                             </span>
<span  style=""> 641                                                                                                                    </span>
<span class="-6009027471382121669" onmouseenter="enter('-6009027471382121669');" onmouseout="out('-6009027471382121669');" style=""> 642      @RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)                                                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 643      @Override                                                                                                     </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 644      public void onNotificationRemoved(StatusBarNotification sbn) {                                                </span>
<span class="-4502832560681421381" onmouseenter="enter('-4502832560681421381');" onmouseout="out('-4502832560681421381');" style=""> 645          LOG.info(&quot;Notification removed: &quot; + sbn.getPackageName() + &quot;: &quot; + sbn.getNotification().category);        </span>

<span  style=""> 646                                                                                                                    </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 647          notificationStack.remove(sbn.getPackageName());                                                           </span>
<span  style=""> 648                                                                                                                    </span>
<span class="940449061862943006" onmouseenter="enter('940449061862943006');" onmouseout="out('940449061862943006');" style=""><abbr title=" 649          if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTime()) {"> 649          if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTðŸ”µ</abbr></span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style=""> 650              activeCallPostTime = 0;                                                                               </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 651              CallSpec callSpec = new CallSpec();                                                                   </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style=""> 652              callSpec.command = CallSpec.CALL_END;                                                                 </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 653              GBApplication.deviceService().onSetCallState(callSpec);                                               </span>














<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654          }                                                                                                         </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 655          // FIXME: DISABLED for now                                                                                </span>
<span  style=""> 656                                                                                                                    </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style=""> 657          if (shouldIgnore(sbn))                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 658              return;                                                                                               </span>

<span  style=""> 659                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 660          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="-1296834313751396403" onmouseenter="enter('-1296834313751396403');" onmouseout="out('-1296834313751396403');" style=""> 661          if (prefs.getBoolean(&quot;autoremove_notifications&quot;, true)) {                                                 </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 662              LOG.info(&quot;notification removed, will ask device to delete it&quot;);                                       </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 663              GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664          }                                                                                                         </span>
<span  style=""> 665                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666      }                                                                                                             </span>
<span  style=""> 667                                                                                                                    </span>










<span  style=""> 668                                                                                                                    </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 669      private void dumpExtras(Bundle bundle) {                                                                      </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 670          for (String key : bundle.keySet()) {                                                                      </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 671              Object value = bundle.get(key);                                                                       </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 672              if (value == null) {                                                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 673                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674              }                                                                                                     </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 675              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 675              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getNðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677      }                                                                                                             </span>
<span  style=""> 678                                                                                                                    </span>
<span  style=""> 679                                                                                                                    </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style=""> 680      private boolean shouldIgnore(StatusBarNotification sbn) {                                                     </span>

<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 681          /*                                                                                                        </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 682           * return early if DeviceCommunicationService is not running,                                             </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 683           * else the service would get started every time we get a notification.                                   </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 684           * unfortunately we cannot enable/disable NotificationListener at runtime like we do with                 </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 685           * broadcast receivers because it seems to invalidate the permissions that are                            </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 686           * necessary for NotificationListenerService                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 687           */                                                                                                       </span>
<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style=""> 688          if (!isServiceRunning() || sbn == null) {                                                                 </span>


<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 689              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690          }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 691 -                                                                                                                  </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style=""> 692          return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                              </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style=""> 693                  sbn.getNotification(), sbn.getPackageName());                                                     </span>
<span  style=""> 694                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695      }                                                                                                             </span>
<span  style=""> 696                                                                                                                    </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style=""> 697      private boolean shouldIgnoreSource(String source) {                                                           </span>






<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 698          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span  style=""> 699                                                                                                                    </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 700          /* do not display messages from &quot;android&quot;                                                                 </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 701           * This includes keyboard selection message, usb connection messages, etc                                 </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 702           * Hope it does not filter out too much, we will see...                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 703           */                                                                                                       </span>
<span  style=""> 704                                                                                                                    </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 705          if (source.equals(&quot;android&quot;) ||                                                                           </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 706                  source.equals(&quot;com.android.systemui&quot;) ||                                                          </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 707                  source.equals(&quot;com.android.dialer&quot;) ||                                                            </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 708                  source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                                        </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 709              LOG.info(&quot;Ignoring notification, is a system event&quot;);                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 710              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711          }                                                                                                         </span>
<span  style=""> 712                                                                                                                    </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 713          if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                                    </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 714                  source.equals(&quot;com.android.mms&quot;) ||                                                               </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 715                  source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                                </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 716                  source.equals(&quot;com.android.messaging&quot;) ||                                                         </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 717                  source.equals(&quot;org.smssecure.smssecure&quot;)) {                                                       </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 718              if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {                   </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 719                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721          }                                                                                                         </span>
<span  style=""> 722                                                                                                                    </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 723          if (GBApplication.appIsNotifBlacklisted(source)) {                                                        </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 724              LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 725              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726          }                                                                                                         </span>
<span  style=""> 727                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 728          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729      }                                                                                                             </span>
<span  style=""> 730                                                                                                                    </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style=""> 731      private boolean shouldIgnoreNotification(Notification notification, String source) {                          </span>
<span  style=""> 732                                                                                                                    </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style=""> 733          MediaSessionCompat.Token mediaSession = getMediaSession(notification);                                    </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style=""> 734          //try to handle media session notifications                                                               </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 735 -        if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                                 </span>
<span class="2560486009094026972" onmouseenter="enter('2560486009094026972');" onmouseout="out('2560486009094026972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 736 +        if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession)) {                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 737              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 738 +        }                                                                                                         </span>


<span  style=""> 739                                                                                                                    </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 740          NotificationType type = AppNotificationType.getInstance().get(source);                                    </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 741          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 741          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NotificatioðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 742          //some Apps always mark their notifcations as read-only                                                   </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 743          if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                                      </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 744                  type != NotificationType.WECHAT &amp;&amp;                                                                </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 745                  type != NotificationType.OUTLOOK &amp;&amp;                                                               </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""> 746                  type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109</span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 747              LOG.info(&quot;local only&quot;);                                                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 748              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749          }                                                                                                         </span>
<span  style=""> 750                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 751          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 752          if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                                     </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 753              PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                           </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 754              if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                              </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""> 755  //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 756                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758          }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 759 -                                                                                                                  </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 760          return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;         </span>
<span  style=""> 761                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762      }                                                                                                             </span>
<span  style=""> 763                                                                                                                    </span>
<span  style=""> 764                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 765      /**                                                                                                           </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 766       * Get the notification color that should be used for this Pebble notification.                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 767       *                                                                                                            </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 768       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 768       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColorðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 769       *                                                                                                            </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 770       * See Issue #815 on GitHub to see how notification colors are set.                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 771       *                                                                                                            </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 772       * @param notificationSpec The NotificationSpec to read from.                                                 </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 773       * @return Returns a PebbleColor that best represents this notification.                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 774       */                                                                                                           </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 775      private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                               </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 776          String appId = notificationSpec.sourceAppId;                                                              </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 777          NotificationType existingType = notificationSpec.type;                                                    </span>
<span  style=""> 778                                                                                                                    </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 779          // If the notification type is known, return the associated color.                                        </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 780          if (existingType != NotificationType.UNKNOWN) {                                                           </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 781              return existingType.color;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782          }                                                                                                         </span>
<span  style=""> 783                                                                                                                    </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 784          // Otherwise, we go and attempt to find the color from the app icon.                                      </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 785          Drawable icon;                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 786          try {                                                                                                     </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 787              icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                         </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 788              Objects.requireNonNull(icon);                                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 789          } catch (Exception ex) {                                                                                  </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 790              // If we can&#x27;t get the icon, we go with the default defined above.                                    </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 791              LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                                </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 792              return PebbleColor.IslamicGreen;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 793          }                                                                                                         </span>
<span  style=""> 794                                                                                                                    </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 795          Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                             </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 796          int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                                    </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 797                  .generate()                                                                                       </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 798                  .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                                    </span>
<span  style=""> 799                                                                                                                    </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 800          return PebbleUtils.getPebbleColor(iconPrimaryColor);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="197175695684748742" onmouseenter="enter('197175695684748742');" onmouseout="out('197175695684748742');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -/*  Copyright (C) 2015-2019 abettenburg, Andreas Shimokawa, AndrewBedscastle,                                     </span>
<span class="1906883787138771170" onmouseenter="enter('1906883787138771170');" onmouseout="out('1906883787138771170');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   2 +/*  Copyright (C) 2015-2020 abettenburg, Andreas Shimokawa, AndrewBedscastle,                                     </span>
<span class="-3541979219390877329" onmouseenter="enter('-3541979219390877329');" onmouseout="out('-3541979219390877329');" style="">   3      Carsten Pfeiffer, Daniel Dakhno, Daniele Gobbetti, Frank Slezak, Hasan Ammar,                                 </span>
<span class="-531692918395923150" onmouseenter="enter('-531692918395923150');" onmouseout="out('-531692918395923150');" style="">   4      JosÃ© Rebelo, Julien Pivotto, Kevin Richter, Matthieu Baerts, Normano64,                                       </span>
<span class="1862847412929924698" onmouseenter="enter('1862847412929924698');" onmouseout="out('1862847412929924698');" style="">   5      Steffen Liebergeld, Taavi EomÃ¤e, veecue, Zhong Jianxin                                                        </span>
<span  style="">   6                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   7      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   8                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   9      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">  10      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">  11      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  12      (at your option) any later version.                                                                           </span>
<span  style="">  13                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  14      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  15      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  16      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  17      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  18                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  19      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  20      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  21  package nodomain.freeyourgadget.gadgetbridge.externalevents;                                                      </span>
<span  style="">  22                                                                                                                    </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  23  import android.app.ActivityManager;                                                                               </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  24  import android.app.Notification;                                                                                  </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  25  import android.app.NotificationManager;                                                                           </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  26  import android.app.PendingIntent;                                                                                 </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  27  import android.content.BroadcastReceiver;                                                                         </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  28  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  29  import android.content.Intent;                                                                                    </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  30  import android.content.IntentFilter;                                                                              </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  31  import android.content.pm.PackageManager;                                                                         </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  32  import android.graphics.Bitmap;                                                                                   </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  33  import android.graphics.Color;                                                                                    </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  34  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  35  import android.media.MediaMetadata;                                                                               </span>
<span class="-4549785658871057260" onmouseenter="enter('-4549785658871057260');" onmouseout="out('-4549785658871057260');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import android.os.Build;                                                                                          </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  37  import android.os.Bundle;                                                                                         </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  38  import android.os.PowerManager;                                                                                   </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  39  import android.os.RemoteException;                                                                                </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  40  import android.service.notification.NotificationListenerService;                                                  </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  41  import android.service.notification.StatusBarNotification;                                                        </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  42  import android.support.v4.media.MediaMetadataCompat;                                                              </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  43  import android.support.v4.media.session.MediaControllerCompat;                                                    </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  44  import android.support.v4.media.session.MediaSessionCompat;                                                       </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  45  import android.support.v4.media.session.PlaybackStateCompat;                                                      </span>
<span  style="">  46                                                                                                                    </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="">  47  import androidx.annotation.NonNull;                                                                               </span>
<span class="6920508932322900435" onmouseenter="enter('6920508932322900435');" onmouseout="out('6920508932322900435');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  48 -import androidx.annotation.RequiresApi;                                                                           </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="">  49  import androidx.core.app.NotificationCompat;                                                                      </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="">  50  import androidx.core.app.RemoteInput;                                                                             </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  51  import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                              </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="">  52  import androidx.palette.graphics.Palette;                                                                         </span>
<span  style="">  53                                                                                                                    </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  54  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  55  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  56  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  57                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  58  import java.util.ArrayList;                                                                                       </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +import java.util.Collections;                                                                                     </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  60  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  61  import java.util.List;                                                                                            </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  62  import java.util.Objects;                                                                                         </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import java.util.Set;                                                                                             </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  65                                                                                                                    </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  66  import de.greenrobot.dao.query.Query;                                                                             </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  67  import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                          </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  68  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  69  import nodomain.freeyourgadget.gadgetbridge.R;                                                                    </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  70  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  71  import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                           </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  72  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                          </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  73  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                                       </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  74  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                                     </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  75  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                                  </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="">  76  import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                            </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  77  import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                                       </span>

<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  78  import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                                      </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  79  import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                                 </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  80  import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                               </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="">  81  import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                               </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  82  import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                                   </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  83  import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                                      </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  84  import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                                    </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  85  import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                                     </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  86  import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                           </span>
<span  style="">  87                                                                                                                    </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="">  88  import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                                   </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title="  89  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;">  89  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_ðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title="  90  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;">  90  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_ðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title="  91  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;">  91  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMOðŸ”µ</abbr></span>
<span  style="">  92                                                                                                                    </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  93  public class NotificationListener extends NotificationListenerService {                                           </span>
<span  style="">  94                                                                                                                    </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  95      private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);                        </span>
<span  style="">  96                                                                                                                    </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  97      public static final String ACTION_DISMISS                                                                     </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  98              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                         </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  99      public static final String ACTION_DISMISS_ALL                                                                 </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style=""> 100              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;                     </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style=""> 101      public static final String ACTION_OPEN                                                                        </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style=""> 102              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                            </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style=""> 103      public static final String ACTION_MUTE                                                                        </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style=""> 104              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                            </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style=""> 105      public static final String ACTION_REPLY                                                                       </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 106              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                           </span>
<span  style=""> 107                                                                                                                    </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 108      private LimitedQueue mActionLookup = new LimitedQueue(32);                                                    </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 109      private LimitedQueue mPackageLookup = new LimitedQueue(64);                                                   </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 110      private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                                       </span>
<span  style=""> 111                                                                                                                    </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 112      private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                                  </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 113      private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                              </span>
<span  style=""> 114                                                                                                                    </span>
<span class="8101473837509778470" onmouseenter="enter('8101473837509778470');" onmouseout="out('8101473837509778470');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +    private static final Set&lt;String&gt; GROUP_SUMMARY_WHITELIST = Collections.singleton(                             </span>
<span class="-8080841529654579062" onmouseenter="enter('-8080841529654579062');" onmouseout="out('-8080841529654579062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +            &quot;mikado.bizcalpro&quot;                                                                                    </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +    );                                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +                                                                                                                  </span>
<span class="-3455620612898728599" onmouseenter="enter('-3455620612898728599');" onmouseout="out('-3455620612898728599');" style=""> 119      public static ArrayList&lt;String&gt; notificationStack = new ArrayList&lt;&gt;();                                        </span>
<span  style=""> 120                                                                                                                    </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 121      private long activeCallPostTime;                                                                              </span>
<span class="-3341855908928415567" onmouseenter="enter('-3341855908928415567');" onmouseout="out('-3341855908928415567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +    private int mLastCallCommand = CallSpec.CALL_UNDEFINED;                                                       </span>
<span  style=""> 123                                                                                                                    </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 124      private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                         </span>
<span  style=""> 125                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 126          @Override                                                                                                 </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 127          public void onReceive(Context context, Intent intent) {                                                   </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 128              String action = intent.getAction();                                                                   </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 129              if (action == null) {                                                                                 </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 130                  LOG.warn(&quot;no action&quot;);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 131                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132              }                                                                                                     </span>
<span  style=""> 133                                                                                                                    </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 134              int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                                 </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 135              switch (action) {                                                                                     </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 136                  case GBApplication.ACTION_QUIT:                                                                   </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 137                      stopSelf();                                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 138                      break;                                                                                        </span>
<span  style=""> 139                                                                                                                    </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 140                  case ACTION_OPEN: {                                                                               </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 141                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 142                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 143                      if (ts == null) {                                                                             </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 144                          LOG.info(&quot;could not lookup handle for open action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 145                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                      }                                                                                             </span>
<span  style=""> 147                                                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 148                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 149                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 150                              try {                                                                                 </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 151                                  PendingIntent pi = sbn.getNotification().contentIntent;                           </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 152                                  if (pi != null) {                                                                 </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 153                                      pi.send();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154                                  }                                                                                 </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 155                              } catch (PendingIntent.CanceledException e) {                                         </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 156                                  e.printStackTrace();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 160                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                  }                                                                                                 </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 162                  case ACTION_MUTE:                                                                                 </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 163                      String packageName = (String) mPackageLookup.lookup(handle);                                  </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 164                      if (packageName == null) {                                                                    </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 165                          LOG.info(&quot;could not lookup handle for mute action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 166                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167                      }                                                                                             </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 169                      LOG.info(&quot;going to mute &quot; + packageName);                                                     </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 170                      GBApplication.addAppToNotifBlacklist(packageName);                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 171                      break;                                                                                        </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 172                  case ACTION_DISMISS: {                                                                            </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 173                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 174                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 175                      if (ts == null) {                                                                             </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 176                          LOG.info(&quot;could not lookup handle for dismiss action&quot;);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 177                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                      }                                                                                             </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 179                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 180                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 181                              if (GBApplication.isRunningLollipopOrLater()) {                                       </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 182                                  String key = sbn.getKey();                                                        </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 183                                  NotificationListener.this.cancelNotification(key);                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 184                              } else {                                                                              </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 185                                  int id = sbn.getId();                                                             </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 186                                  String pkg = sbn.getPackageName();                                                </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 187                                  String tag = sbn.getTag();                                                        </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 188                                  NotificationListener.this.cancelNotification(pkg, tag, id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 192                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193                  }                                                                                                 </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 194                  case ACTION_DISMISS_ALL:                                                                          </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 195                      NotificationListener.this.cancelAllNotifications();                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 196                      break;                                                                                        </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 197                  case ACTION_REPLY:                                                                                </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 198                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 198                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(haðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 199                      String reply = intent.getStringExtra(&quot;reply&quot;);                                                </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 200                      if (wearableAction != null) {                                                                 </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 201                          PendingIntent actionIntent = wearableAction.getActionIntent();                            </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 202                          Intent localIntent = new Intent();                                                        </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 203                          localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                                      </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 204                          if(wearableAction.getRemoteInputs()!=null) {                                              </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 205                              RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();                        </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 206                              Bundle extras = new Bundle();                                                         </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 207                              extras.putCharSequence(remoteInputs[0].getResultKey(), reply);                        </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 208                              RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209                          }                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 210                          try {                                                                                     </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 211                              LOG.info(&quot;will send exec intent to remote application&quot;);                              </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 212                              actionIntent.send(context, 0, localIntent);                                           </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 213                              mActionLookup.remove(handle);                                                         </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 214                          } catch (PendingIntent.CanceledException e) {                                             </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 215                              LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 218                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 221      };                                                                                                            </span>
<span  style=""> 222                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223      @Override                                                                                                     </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 224      public void onCreate() {                                                                                      </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 225          super.onCreate();                                                                                         </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 226          IntentFilter filterLocal = new IntentFilter();                                                            </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 227          filterLocal.addAction(GBApplication.ACTION_QUIT);                                                         </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 228          filterLocal.addAction(ACTION_OPEN);                                                                       </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 229          filterLocal.addAction(ACTION_DISMISS);                                                                    </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 230          filterLocal.addAction(ACTION_DISMISS_ALL);                                                                </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 231          filterLocal.addAction(ACTION_MUTE);                                                                       </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 232          filterLocal.addAction(ACTION_REPLY);                                                                      </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 233          LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234      }                                                                                                             </span>
<span  style=""> 235                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 236      @Override                                                                                                     </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 237      public void onDestroy() {                                                                                     </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 238          LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                                    </span>
<span class="-3610691555806270699" onmouseenter="enter('-3610691555806270699');" onmouseout="out('-3610691555806270699');" style=""> 239          notificationStack.clear();                                                                                </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 240          super.onDestroy();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241      }                                                                                                             </span>
<span  style=""> 242                                                                                                                    </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 243      public String getAppName(String pkg) {                                                                        </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 244          // determinate Source App Name (&quot;Label&quot;)                                                                  </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 245          PackageManager pm = getPackageManager();                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 246          try {                                                                                                     </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style=""> 247              return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                                 </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 248          } catch (PackageManager.NameNotFoundException e) {                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 249              e.printStackTrace();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 251          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252      }                                                                                                             </span>
<span  style=""> 253                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 254      @Override                                                                                                     </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 255      public void onNotificationPosted(StatusBarNotification sbn) {                                                 </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 256 -        Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="-1858334129449927430" onmouseenter="enter('-1858334129449927430');" onmouseout="out('-1858334129449927430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +        logNotification(sbn, true);                                                                               </span>
<span  style=""> 258                                                                                                                    </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 259          notificationStack.remove(sbn.getPackageName());                                                           </span>
<span class="6183718114314290730" onmouseenter="enter('6183718114314290730');" onmouseout="out('6183718114314290730');" style=""> 260          notificationStack.add(sbn.getPackageName());                                                              </span>
<span  style=""> 261                                                                                                                    </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -        if (GBApplication.isRunningLollipopOrLater()) {                                                           </span>
<span class="-8448425987946302452" onmouseenter="enter('-8448425987946302452');" onmouseout="out('-8448425987946302452');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 263 -            if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {"> 263 -            if (&quot;call&quot;.equals(sbn.getNotification().category) &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_callsðŸ”µ</abbr></span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -                handleCallNotification(sbn);                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -        }                                                                                                         </span>

<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -        if (shouldIgnore(sbn)) {                                                                                  </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -            LOG.info(&quot;Ignore notification&quot;);                                                                      </span>
<span class="4991954782201742281" onmouseenter="enter('4991954782201742281');" onmouseout="out('4991954782201742281');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +        if (shouldIgnoreNotifications()) return;                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                                                                                                                  </span>
<span class="4264709970930991859" onmouseenter="enter('4264709970930991859');" onmouseout="out('4264709970930991859');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +        if (shouldIgnoreSource(sbn)) {                                                                            </span>
<span class="4946725858664366504" onmouseenter="enter('4946725858664366504');" onmouseout="out('4946725858664366504');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +            LOG.debug(&quot;Ignoring notification source&quot;);                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 274              return;                                                                                               </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275          }                                                                                                         </span>
<span  style=""> 276                                                                                                                    </span>
<span class="4712720955611963966" onmouseenter="enter('4712720955611963966');" onmouseout="out('4712720955611963966');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +        if (handleMediaSessionNotification(sbn)) return;                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +                                                                                                                  </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 279          switch (GBApplication.getGrantedInterruptionFilter()) {                                                   </span>
<span class="4109165554183544277" onmouseenter="enter('4109165554183544277');" onmouseout="out('4109165554183544277');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 280 -            case NotificationManager.INTERRUPTION_FILTER_ALL:                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 281 -                break;                                                                                            </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 282              case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                                  </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 283              case NotificationManager.INTERRUPTION_FILTER_NONE:                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 284                  return;                                                                                           </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 285              case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                                </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 286                  // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 287                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288          }                                                                                                         </span>
<span  style=""> 289                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +        Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +        if (GBApplication.isRunningLollipopOrLater()) {                                                           </span>
<span class="-8969748416921643208" onmouseenter="enter('-8969748416921643208');" onmouseout="out('-8969748416921643208');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +            if (NotificationCompat.CATEGORY_CALL.equals(sbn.getNotification().category)                           </span>
<span class="-2610866924656962115" onmouseenter="enter('-2610866924656962115');" onmouseout="out('-2610866924656962115');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +                    &amp;&amp; prefs.getBoolean(&quot;notification_support_voip_calls&quot;, false)) {                              </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +                handleCallNotification(sbn);                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +                                                                                                                  </span>
<span class="-7697907629896539664" onmouseenter="enter('-7697907629896539664');" onmouseout="out('-7697907629896539664');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +        if (shouldIgnoreNotification(sbn)) {                                                                      </span>
<span class="5145250427849470730" onmouseenter="enter('5145250427849470730');" onmouseout="out('5145250427849470730');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +            LOG.info(&quot;Ignoring notification&quot;);                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +                                                                                                                  </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 304          String source = sbn.getPackageName().toLowerCase();                                                       </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 305          Notification notification = sbn.getNotification();                                                        </span>
<span class="4218475881538878307" onmouseenter="enter('4218475881538878307');" onmouseout="out('4218475881538878307');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 306 -        if (notificationOldRepeatPrevention.containsKey(source)) {                                                </span>
<span class="6155853035860803703" onmouseenter="enter('6155853035860803703');" onmouseout="out('6155853035860803703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -            if (notification.when &lt;= notificationOldRepeatPrevention.get(source)) {                               </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -                LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -                return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +                                                                                                                  </span>
<span class="-1441185864931598228" onmouseenter="enter('-1441185864931598228');" onmouseout="out('-1441185864931598228');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +        Long notificationOldRepeatPreventionValue = notificationOldRepeatPrevention.get(source);                  </span>
<span class="-2948904860852754633" onmouseenter="enter('-2948904860852754633');" onmouseout="out('-2948904860852754633');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +        if (notificationOldRepeatPreventionValue != null                                                          </span>
<span class="-8958216021585134671" onmouseenter="enter('-8958216021585134671');" onmouseout="out('-8958216021585134671');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +                &amp;&amp; notification.when &lt;= notificationOldRepeatPreventionValue) {                                   </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +            LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317          }                                                                                                         </span>
<span  style=""> 318                                                                                                                    </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 319          // Ignore too frequent notifications, according to user preference                                        </span>
<span class="8739203694966910315" onmouseenter="enter('8739203694966910315');" onmouseout="out('8739203694966910315');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 320 -        long min_timeout = (long)prefs.getInt(&quot;notifications_timeout&quot;, 0) * 1000L;                                </span>
<span class="7158364678624901735" onmouseenter="enter('7158364678624901735');" onmouseout="out('7158364678624901735');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 321 -        long cur_time = System.currentTimeMillis();                                                               </span>
<span class="4691272725591601941" onmouseenter="enter('4691272725591601941');" onmouseout="out('4691272725591601941');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 322 -        if (notificationBurstPrevention.containsKey(source)) {                                                    </span>
<span class="-7388621012045880255" onmouseenter="enter('-7388621012045880255');" onmouseout="out('-7388621012045880255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 323 -            long last_time = notificationBurstPrevention.get(source);                                             </span>
<span class="8371821158922557754" onmouseenter="enter('8371821158922557754');" onmouseout="out('8371821158922557754');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 324 -            if (cur_time - last_time &lt; min_timeout) {                                                             </span>
<span class="761193726766758320" onmouseenter="enter('761193726766758320');" onmouseout="out('761193726766758320');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -                LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms ago&quot;);    </span>
<span class="6854200181184360965" onmouseenter="enter('6854200181184360965');" onmouseout="out('6854200181184360965');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +        long curTime = System.nanoTime();                                                                         </span>
<span class="-1119754415295906213" onmouseenter="enter('-1119754415295906213');" onmouseout="out('-1119754415295906213');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +        Long notificationBurstPreventionValue = notificationBurstPrevention.get(source);                          </span>
<span class="3983885705215150872" onmouseenter="enter('3983885705215150872');" onmouseout="out('3983885705215150872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +        if (notificationBurstPreventionValue != null) {                                                           </span>
<span class="-4450214003094206879" onmouseenter="enter('-4450214003094206879');" onmouseout="out('-4450214003094206879');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +            long diff = curTime - notificationBurstPreventionValue;                                               </span>
<span class="-2015672682083463299" onmouseenter="enter('-2015672682083463299');" onmouseout="out('-2015672682083463299');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +            if (diff &lt; TimeUnit.SECONDS.toNanos(prefs.getInt(&quot;notifications_timeout&quot;, 0))) {                      </span>
<span class="-7079262005450253436" onmouseenter="enter('-7079262005450253436');" onmouseout="out('-7079262005450253436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +                LOG.info(&quot;Ignoring frequent notification, last one was &quot;                                          </span>
<span class="6353466646675639227" onmouseenter="enter('6353466646675639227');" onmouseout="out('6353466646675639227');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +                        + TimeUnit.NANOSECONDS.toMillis(diff) + &quot;ms ago&quot;);                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 333                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335          }                                                                                                         </span>
<span  style=""> 336                                                                                                                    </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 337          NotificationSpec notificationSpec = new NotificationSpec();                                               </span>
<span  style=""> 338                                                                                                                    </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 339          // determinate Source App Name (&quot;Label&quot;)                                                                  </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 340          String name = getAppName(source);                                                                         </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 341          if (name != null) {                                                                                       </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 342              notificationSpec.sourceName = name;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343          }                                                                                                         </span>
<span  style=""> 344                                                                                                                    </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 345          boolean preferBigText = false;                                                                            </span>
<span  style=""> 346                                                                                                                    </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 347          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 347          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 348          notificationSpec.sourceAppId = source;                                                                    </span>
<span  style=""> 349                                                                                                                    </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 350          notificationSpec.type = AppNotificationType.getInstance().get(source);                                    </span>
<span  style=""> 351                                                                                                                    </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 352          //FIXME: some quirks lookup table would be the minor evil here                                            </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 353          if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                                   </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 354              if (NotificationCompat.isGroupSummary(notification)) {                                                </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 355                  LOG.info(&quot;ignore K9 group summary&quot;);                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 356                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357              }                                                                                                     </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 358              preferBigText = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359          }                                                                                                         </span>
<span  style=""> 360                                                                                                                    </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 361          if (notificationSpec.type == null) {                                                                      </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 362              notificationSpec.type = NotificationType.UNKNOWN;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363          }                                                                                                         </span>
<span  style=""> 364                                                                                                                    </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 365          // Get color                                                                                              </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 366          notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                           </span>
<span  style=""> 367                                                                                                                    </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 368          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 368          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - ðŸ”µ</abbr></span>
<span  style=""> 369                                                                                                                    </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 370          dissectNotificationTo(notification, notificationSpec, preferBigText);                                     </span>
<span  style=""> 371                                                                                                                    </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 372          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 372          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.bodðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 373              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374          }                                                                                                         </span>
<span  style=""> 375                                                                                                                    </span>
<span  style=""> 376                                                                                                                    </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 377          // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen                   </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 378          if (getApplicationContext().getPackageName().equals(source)) {                                            </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""> 379              if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 380                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382          }                                                                                                         </span>
<span  style=""> 383                                                                                                                    </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 384          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 384          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notificatioðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 385          List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                                  </span>
<span  style=""> 386                                                                                                                    </span>
<span  style=""> 387                                                                                                                    </span>
<span class="7774033817539746019" onmouseenter="enter('7774033817539746019');" onmouseout="out('7774033817539746019');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 388 -        if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to come back"> 388 -        if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to cðŸ”µ</abbr></span>
<span class="-5165487096538852929" onmouseenter="enter('-5165487096538852929');" onmouseout="out('-5165487096538852929');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +        if (actions.isEmpty() &amp;&amp; NotificationCompat.isGroupSummary(notification)                                  </span>
<span class="-390635856025090115" onmouseenter="enter('-390635856025090115');" onmouseout="out('-390635856025090115');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 390 +                &amp;&amp; !GROUP_SUMMARY_WHITELIST.contains(source)) { //this could cause #395 to come back              </span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 391              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 391              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. NotifðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 392              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393          }                                                                                                         </span>
<span  style=""> 394                                                                                                                    </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 395          notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                                     </span>
<span  style=""> 396                                                                                                                    </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 397          // DISMISS action                                                                                         </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 398          NotificationSpec.Action dismissAction = new NotificationSpec.Action();                                    </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 399          dismissAction.title = &quot;Dismiss&quot;;                                                                          </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 400          dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                                      </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 401          notificationSpec.attachedActions.add(dismissAction);                                                      </span>
<span  style=""> 402                                                                                                                    </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 403          for (NotificationCompat.Action act : actions) {                                                           </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 404              if (act != null) {                                                                                    </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 405                  NotificationSpec.Action wearableAction = new NotificationSpec.Action();                           </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 406                  wearableAction.title = act.getTitle().toString();                                                 </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 407                  if(act.getRemoteInputs()!=null) {                                                                 </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 408                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 409                  } else {                                                                                          </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 410                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411                  }                                                                                                 </span>
<span  style=""> 412                                                                                                                    </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 413                  notificationSpec.attachedActions.add(wearableAction);                                             </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""> 414                  mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);  </span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 415                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 415                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417          }                                                                                                         </span>
<span  style=""> 418                                                                                                                    </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 419          // OPEN action                                                                                            </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 420          NotificationSpec.Action openAction = new NotificationSpec.Action();                                       </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 421          openAction.title = getString(R.string._pebble_watch_open_on_phone);                                       </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 422          openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                            </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 423          notificationSpec.attachedActions.add(openAction);                                                         </span>
<span  style=""> 424                                                                                                                    </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 425          // MUTE action                                                                                            </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 426          NotificationSpec.Action muteAction = new NotificationSpec.Action();                                       </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 427          muteAction.title = getString(R.string._pebble_watch_mute);                                                </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 428          muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                            </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 429          notificationSpec.attachedActions.add(muteAction);                                                         </span>
<span  style=""> 430                                                                                                                    </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""> 431          mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN  </span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 432          mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                           </span>
<span  style=""> 433                                                                                                                    </span>
<span class="5979670797208442666" onmouseenter="enter('5979670797208442666');" onmouseout="out('5979670797208442666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 434 -        notificationBurstPrevention.put(source, cur_time);                                                        </span>
<span class="-240819969350733584" onmouseenter="enter('-240819969350733584');" onmouseout="out('-240819969350733584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 435 +        notificationBurstPrevention.put(source, curTime);                                                         </span>
<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style=""> 436          if(0 != notification.when) {                                                                              </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 437              notificationOldRepeatPrevention.put(source, notification.when);                                       </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 438          }else {                                                                                                   </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""> 439              LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440          }                                                                                                         </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 441          GBApplication.deviceService().onNotification(notificationSpec);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442      }                                                                                                             </span>
<span  style=""> 443                                                                                                                    </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 444      private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {               </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 445          long start = System.currentTimeMillis();                                                                  </span>
<span  style=""> 446                                                                                                                    </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 447          List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                               </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 448          NotificationFilter notificationFilter;                                                                    </span>
<span  style=""> 449                                                                                                                    </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 450          try (DBHandler db = GBApplication.acquireDB()) {                                                          </span>
<span  style=""> 451                                                                                                                    </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 452              NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao();          </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 453              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 453              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDðŸ”µ</abbr></span>
<span  style=""> 454                                                                                                                    </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 455              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 455              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.ProðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 456              notificationFilter = query.unique();                                                                  </span>
<span  style=""> 457                                                                                                                    </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 458              if (notificationFilter == null) {                                                                     </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 459                  LOG.debug(&quot;No Notification Filter found&quot;);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 460                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461              }                                                                                                     </span>
<span  style=""> 462                                                                                                                    </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 463              LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                                        </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 464              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 464              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificaðŸ”µ</abbr></span>
<span  style=""> 465                                                                                                                    </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 466              List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                                    </span>
<span  style=""> 467                                                                                                                    </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 468              if (BuildConfig.DEBUG) {                                                                              </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 469                  LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470              }                                                                                                     </span>
<span  style=""> 471                                                                                                                    </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 472              if (!filterEntries.isEmpty()) {                                                                       </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 473                  for (NotificationFilterEntry temp : filterEntries) {                                              </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 474                      wordsList.add(temp.getNotificationFilterContent());                                           </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 475                      LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477              }                                                                                                     </span>
<span  style=""> 478                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 479          } catch (Exception e) {                                                                                   </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 480              LOG.error(&quot;Could not acquire DB.&quot;, e);                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 481              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482          }                                                                                                         </span>
<span  style=""> 483                                                                                                                    </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 484          return shouldContinueAfterFilter(body, wordsList, notificationFilter);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485      }                                                                                                             </span>
<span  style=""> 486                                                                                                                    </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 487      private void handleCallNotification(StatusBarNotification sbn) {                                              </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 488          String app = sbn.getPackageName();                                                                        </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 489          LOG.debug(&quot;got call from: &quot; + app);                                                                       </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style=""> 490          if(app.equals(&quot;com.android.dialer&quot;)) {                                                                    </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 491              LOG.debug(&quot;Ignoring non-voip call&quot;);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 492              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493          }                                                                                                         </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 494          Notification noti = sbn.getNotification();                                                                </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 495          dumpExtras(noti.extras);                                                                                  </span>
<span class="-894861467263649997" onmouseenter="enter('-894861467263649997');" onmouseout="out('-894861467263649997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 496 +        boolean callStarted = false;                                                                              </span>
<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style=""> 497          if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                                     </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 498              for (Notification.Action action : noti.actions) {                                                     </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 499                  LOG.info(&quot;Found call action: &quot; + action.title);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 500 +            }                                                                                                     </span>
<span class="150001560550536139" onmouseenter="enter('150001560550536139');" onmouseout="out('150001560550536139');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 501 +            if (noti.actions.length == 1) {                                                                       </span>
<span class="1124706287521813013" onmouseenter="enter('1124706287521813013');" onmouseout="out('1124706287521813013');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +                if (mLastCallCommand == CallSpec.CALL_INCOMING) {                                                 </span>
<span class="-8019351633415130414" onmouseenter="enter('-8019351633415130414');" onmouseout="out('-8019351633415130414');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 503 +                    LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuming call started&quot;);"> 503 +                    LOG.info(&quot;There is only one call action and previous state was CALL_INCOMING, assuming call stðŸ”µ</abbr></span>
<span class="3182682807764059315" onmouseenter="enter('3182682807764059315');" onmouseout="out('3182682807764059315');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 504 +                    callStarted = true;                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 505 +                } else {                                                                                          </span>
<span class="-4501418827174237895" onmouseenter="enter('-4501418827174237895');" onmouseout="out('-4501418827174237895');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 506 +                    LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assuming outgoing call / duplicate notification and ignoring&quot;);"> 506 +                    LOG.info(&quot;There is only one call action and previous state was not CALL_INCOMING, assuming outðŸ”µ</abbr></span>
<span class="-8333753567790744727" onmouseenter="enter('-8333753567790744727');" onmouseout="out('-8333753567790744727');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 507 +                    // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more complete VoIP call state tracking?"> 507 +                    // FIXME: is there a way to detect transition CALL_OUTGOING -&gt; CALL_START for more complete VoðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 508 +                    return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 509 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510              }                                                                                                     </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 511              /*try {                                                                                               </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 512                  LOG.info(&quot;Executing first action&quot;);                                                               </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 513                  noti.actions[0].actionIntent.send();                                                              </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 514              } catch (PendingIntent.CanceledException e) {                                                         </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 515                  e.printStackTrace();                                                                              </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 516              }*/                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517          }                                                                                                         </span>
<span  style=""> 518                                                                                                                    </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 519          // figure out sender                                                                                      </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 520          String number;                                                                                            </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style=""> 521          if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                                  </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 522              number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                            </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style=""> 523          } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                            </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 524              number = noti.extras.getString(Notification.EXTRA_TITLE);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 525          } else {                                                                                                  </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 526              String appName = getAppName(app);                                                                     </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style=""> 527              number = appName != null ? appName : app;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528          }                                                                                                         </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 529          activeCallPostTime = sbn.getPostTime();                                                                   </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 530          CallSpec callSpec = new CallSpec();                                                                       </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 531          callSpec.number = number;                                                                                 </span>
<span class="-4416193589830976087" onmouseenter="enter('-4416193589830976087');" onmouseout="out('-4416193589830976087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 532 -        callSpec.command = CallSpec.CALL_INCOMING;                                                                </span>
<span class="-7145633475877048589" onmouseenter="enter('-7145633475877048589');" onmouseout="out('-7145633475877048589');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 533 +        callSpec.command = callStarted ? CallSpec.CALL_START : CallSpec.CALL_INCOMING;                            </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 534 +        mLastCallCommand = callSpec.command;                                                                      </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 535          GBApplication.deviceService().onSetCallState(callSpec);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536      }                                                                                                             </span>
<span  style=""> 537                                                                                                                    </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 538      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 538      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationðŸ”µ</abbr></span>
<span  style=""> 539                                                                                                                    </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 540          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 540          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notiðŸ”µ</abbr></span>
<span  style=""> 541                                                                                                                    </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""> 542          boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;   </span>
<span  style=""> 543                                                                                                                    </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 544          switch (notificationFilter.getNotificationFilterMode()) {                                                 </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 545              case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 546                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 547                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 548                          if (!body.contains(word)) {                                                               </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""> 549                              LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;); </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 550                              return true;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552                      }                                                                                             </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 553                      LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 554                      return false;                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 555                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 556                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 557                      if (!containsAny) {                                                                           </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""> 558                          LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 559                      } else {                                                                                      </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""> 560                          LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561                      }                                                                                             </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 562                      return !containsAny;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563                  }                                                                                                 </span>
<span  style=""> 564                                                                                                                    </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 565              case NOTIFICATION_FILTER_MODE_WHITELIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 566                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 567                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 568                          if (!body.contains(word)) {                                                               </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""> 569                              LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 570                              return false;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572                      }                                                                                             </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 573                      LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 574                      return true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 575                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 576                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 577                      if (containsAny) {                                                                            </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 578                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 578                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continuesðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 579                      } else {                                                                                      </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""> 580                          LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581                      }                                                                                             </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 582                      return containsAny;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 583                  }                                                                                                 </span>
<span  style=""> 584                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 585              default:                                                                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 586                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 587          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588      }                                                                                                             </span>
<span  style=""> 589                                                                                                                    </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 590      // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons             </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 591      private String sanitizeUnicode(String orig) {                                                                 </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 592          return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593      }                                                                                                             </span>
<span  style=""> 594                                                                                                                    </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 595      private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,              </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 596                                         boolean preferBigText) {                                                   </span>
<span  style=""> 597                                                                                                                    </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 598          Bundle extras = NotificationCompat.getExtras(notification);                                               </span>
<span  style=""> 599                                                                                                                    </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 600          //dumpExtras(extras);                                                                                     </span>
<span class="3231714309982698113" onmouseenter="enter('3231714309982698113');" onmouseout="out('3231714309982698113');" style=""> 601          if (extras == null) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 602              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603          }                                                                                                         </span>
<span  style=""> 604                                                                                                                    </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 605          CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                                    </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 606          if (title != null) {                                                                                      </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 607              notificationSpec.title = sanitizeUnicode(title.toString());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608          }                                                                                                         </span>
<span  style=""> 609                                                                                                                    </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 610          CharSequence contentCS = null;                                                                            </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 611          if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                                   </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 612              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                                </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 613          } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                                 </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 614              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615          }                                                                                                         </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 616          if (contentCS != null) {                                                                                  </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 617              notificationSpec.body = sanitizeUnicode(contentCS.toString());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618          }                                                                                                         </span>
<span  style=""> 619                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620      }                                                                                                             </span>
<span  style=""> 621                                                                                                                    </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 622      private boolean isServiceRunning() {                                                                          </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 623          ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                           </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 624          if (manager == null) {                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 625              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626          }                                                                                                         </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""> 627          for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {        </span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 628              if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 629                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 632          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 633 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 634 +                                                                                                                  </span>
<span class="5320463064367359781" onmouseenter="enter('5320463064367359781');" onmouseout="out('5320463064367359781');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 635 +    private boolean handleMediaSessionNotification(StatusBarNotification sbn) {                                   </span>
<span class="-4962670587938601541" onmouseenter="enter('-4962670587938601541');" onmouseout="out('-4962670587938601541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 636 +        MediaSessionCompat.Token mediaSession = getMediaSession(sbn.getNotification());                           </span>
<span class="-7622006372947125189" onmouseenter="enter('-7622006372947125189');" onmouseout="out('-7622006372947125189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 637 +        return mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 638      }                                                                                                             </span>
<span  style=""> 639                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 640      /**                                                                                                           </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 641       * Try to handle media session notifications that tell info about the current play state.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 642       *                                                                                                            </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 643       * @param mediaSession The mediasession to handle.                                                            </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 644       * @return true if notification was handled, false otherwise                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 645       */                                                                                                           </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 646      public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {                        </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 647          MusicSpec musicSpec = new MusicSpec();                                                                    </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 648          MusicStateSpec stateSpec = new MusicStateSpec();                                                          </span>
<span  style=""> 649                                                                                                                    </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 650          MediaControllerCompat c;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 651          try {                                                                                                     </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 652              c = new MediaControllerCompat(getApplicationContext(), mediaSession);                                 </span>
<span  style=""> 653                                                                                                                    </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 654              PlaybackStateCompat s = c.getPlaybackState();                                                         </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 655              stateSpec.position = (int) (s.getPosition() / 1000);                                                  </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 656              stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                          </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 657              stateSpec.repeat = 1;                                                                                 </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 658              stateSpec.shuffle = 1;                                                                                </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 659              switch (s.getState()) {                                                                               </span>
<span class="-5763838617161449343" onmouseenter="enter('-5763838617161449343');" onmouseout="out('-5763838617161449343');" style=""> 660                  case PlaybackStateCompat.STATE_PLAYING:                                                           </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 661                      stateSpec.state = MusicStateSpec.STATE_PLAYING;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 662                      break;                                                                                        </span>
<span class="4559404571574135097" onmouseenter="enter('4559404571574135097');" onmouseout="out('4559404571574135097');" style=""> 663                  case PlaybackStateCompat.STATE_STOPPED:                                                           </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 664                      stateSpec.state = MusicStateSpec.STATE_STOPPED;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 665                      break;                                                                                        </span>
<span class="1489652375659370630" onmouseenter="enter('1489652375659370630');" onmouseout="out('1489652375659370630');" style=""> 666                  case PlaybackStateCompat.STATE_PAUSED:                                                            </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 667                      stateSpec.state = MusicStateSpec.STATE_PAUSED;                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 668                      break;                                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 669                  default:                                                                                          </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 670                      stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 671                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672              }                                                                                                     </span>
<span  style=""> 673                                                                                                                    </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 674              MediaMetadataCompat d = c.getMetadata();                                                              </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 675              if (d == null)                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 676                  return false;                                                                                     </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 677              if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                                 </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 678                  musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                          </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 679              if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                                  </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 680                  musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                            </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 681              if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                                  </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 682                  musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                            </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 683              if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                               </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 684                  musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;           </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 685              if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                             </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 686                  musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);              </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 687              if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                           </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 688                  musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);               </span>
<span  style=""> 689                                                                                                                    </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 690              // finally, tell the device about it                                                                  </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 691              GBApplication.deviceService().onSetMusicInfo(musicSpec);                                              </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 692              GBApplication.deviceService().onSetMusicState(stateSpec);                                             </span>
<span  style=""> 693                                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 694              return true;                                                                                          </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 695          } catch (NullPointerException | RemoteException e) {                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 696              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698      }                                                                                                             </span>
<span  style=""> 699                                                                                                                    </span>
<span class="-6009027471382121669" onmouseenter="enter('-6009027471382121669');" onmouseout="out('-6009027471382121669');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 700 -    @RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)                                                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 701      @Override                                                                                                     </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 702      public void onNotificationRemoved(StatusBarNotification sbn) {                                                </span>
<span class="-4502832560681421381" onmouseenter="enter('-4502832560681421381');" onmouseout="out('-4502832560681421381');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 703 -        LOG.info(&quot;Notification removed: &quot; + sbn.getPackageName() + &quot;: &quot; + sbn.getNotification().category);        </span>
<span class="6067501100626656036" onmouseenter="enter('6067501100626656036');" onmouseout="out('6067501100626656036');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 704 +        logNotification(sbn, false);                                                                              </span>
<span  style=""> 705                                                                                                                    </span>
<span class="4876315977256832177" onmouseenter="enter('4876315977256832177');" onmouseout="out('4876315977256832177');" style=""> 706          notificationStack.remove(sbn.getPackageName());                                                           </span>
<span  style=""> 707                                                                                                                    </span>
<span class="940449061862943006" onmouseenter="enter('940449061862943006');" onmouseout="out('940449061862943006');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 708 -        if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTime()) {"> 708 -        if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTðŸ”µ</abbr></span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 709 -            activeCallPostTime = 0;                                                                               </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 710 -            CallSpec callSpec = new CallSpec();                                                                   </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 711 -            callSpec.command = CallSpec.CALL_END;                                                                 </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 712 -            GBApplication.deviceService().onSetCallState(callSpec);                                               </span>
<span class="4991954782201742281" onmouseenter="enter('4991954782201742281');" onmouseout="out('4991954782201742281');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 713 +        if (shouldIgnoreNotifications()) return;                                                                  </span>
<span class="-8648926181838166573" onmouseenter="enter('-8648926181838166573');" onmouseout="out('-8648926181838166573');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 714 +        if (shouldIgnoreSource(sbn)) return;                                                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 715 +                                                                                                                  </span>
<span class="4712720955611963966" onmouseenter="enter('4712720955611963966');" onmouseout="out('4712720955611963966');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 716 +        if (handleMediaSessionNotification(sbn)) return;                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 717 +                                                                                                                  </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 718 +        if (GBApplication.isRunningLollipopOrLater()) {                                                           </span>
<span class="809759750927856809" onmouseenter="enter('809759750927856809');" onmouseout="out('809759750927856809');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 719 +            if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category)                                  </span>
<span class="-9057216622014896702" onmouseenter="enter('-9057216622014896702');" onmouseout="out('-9057216622014896702');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 720 +                    &amp;&amp; activeCallPostTime == sbn.getPostTime()) {                                                 </span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 721 +                activeCallPostTime = 0;                                                                           </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 722 +                CallSpec callSpec = new CallSpec();                                                               </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 723 +                callSpec.command = CallSpec.CALL_END;                                                             </span>
<span class="-8788885635723741149" onmouseenter="enter('-8788885635723741149');" onmouseout="out('-8788885635723741149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 724 +                mLastCallCommand = callSpec.command;                                                              </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 725 +                GBApplication.deviceService().onSetCallState(callSpec);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 726 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727          }                                                                                                         </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 728          // FIXME: DISABLED for now                                                                                </span>
<span  style=""> 729                                                                                                                    </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 730 -        if (shouldIgnore(sbn))                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 731 -            return;                                                                                               </span>
<span class="8463134039225075309" onmouseenter="enter('8463134039225075309');" onmouseout="out('8463134039225075309');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 732 +        if (shouldIgnoreNotification(sbn)) return;                                                                </span>
<span  style=""> 733                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 734          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="-1296834313751396403" onmouseenter="enter('-1296834313751396403');" onmouseout="out('-1296834313751396403');" style=""> 735          if (prefs.getBoolean(&quot;autoremove_notifications&quot;, true)) {                                                 </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 736              LOG.info(&quot;notification removed, will ask device to delete it&quot;);                                       </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 737              GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738          }                                                                                                         </span>
<span  style=""> 739                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740      }                                                                                                             </span>
<span  style=""> 741                                                                                                                    </span>
<span class="-2321374120209641351" onmouseenter="enter('-2321374120209641351');" onmouseout="out('-2321374120209641351');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 742 +    private void logNotification(StatusBarNotification sbn, boolean posted) {                                     </span>
<span class="1002552013175598925" onmouseenter="enter('1002552013175598925');" onmouseout="out('1002552013175598925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 743 +        String infoMsg = (posted ? &quot;Notification posted&quot; : &quot;Notification removed&quot;)                                </span>
<span class="7538128381914780026" onmouseenter="enter('7538128381914780026');" onmouseout="out('7538128381914780026');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 744 +                + &quot;: &quot; + sbn.getPackageName();                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 745 +                                                                                                                  </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 746 +        if (GBApplication.isRunningLollipopOrLater()) {                                                           </span>
<span class="-2325475546032777056" onmouseenter="enter('-2325475546032777056');" onmouseout="out('-2325475546032777056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 747 +            infoMsg += &quot;: &quot; + sbn.getNotification().category;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 748 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 749 +                                                                                                                  </span>
<span class="-8299794314619245363" onmouseenter="enter('-8299794314619245363');" onmouseout="out('-8299794314619245363');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 750 +        LOG.debug(infoMsg);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 751 +    }                                                                                                             </span>
<span  style=""> 752                                                                                                                    </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 753      private void dumpExtras(Bundle bundle) {                                                                      </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 754          for (String key : bundle.keySet()) {                                                                      </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 755              Object value = bundle.get(key);                                                                       </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 756              if (value == null) {                                                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 757                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758              }                                                                                                     </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 759              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 759              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getNðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 760          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761      }                                                                                                             </span>
<span  style=""> 762                                                                                                                    </span>
<span  style=""> 763                                                                                                                    </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 764 -    private boolean shouldIgnore(StatusBarNotification sbn) {                                                     </span>
<span class="-3948619442008818904" onmouseenter="enter('-3948619442008818904');" onmouseout="out('-3948619442008818904');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 765 +    private boolean shouldIgnoreNotifications() {                                                                 </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 766          /*                                                                                                        </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 767           * return early if DeviceCommunicationService is not running,                                             </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 768           * else the service would get started every time we get a notification.                                   </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 769           * unfortunately we cannot enable/disable NotificationListener at runtime like we do with                 </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 770           * broadcast receivers because it seems to invalidate the permissions that are                            </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 771           * necessary for NotificationListenerService                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 772           */                                                                                                       </span>
<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 773 -        if (!isServiceRunning() || sbn == null) {                                                                 </span>
<span class="1533232748109360412" onmouseenter="enter('1533232748109360412');" onmouseout="out('1533232748109360412');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 774 +        if (!isServiceRunning()) {                                                                                </span>
<span class="4366338841311618901" onmouseenter="enter('4366338841311618901');" onmouseout="out('4366338841311618901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 775 +            LOG.trace(&quot;Service is not running, ignoring notification&quot;);                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 776              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777          }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 778 -                                                                                                                  </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 779 -        return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                              </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 780 -                sbn.getNotification(), sbn.getPackageName());                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 781 -                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 782 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 783 -                                                                                                                  </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 784 -    private boolean shouldIgnoreSource(String source) {                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 785 +        return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 786 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 787 +                                                                                                                  </span>
<span class="1771766823989063914" onmouseenter="enter('1771766823989063914');" onmouseout="out('1771766823989063914');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 788 +    private boolean shouldIgnoreSource(StatusBarNotification sbn) {                                               </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 789 +        String source = sbn.getPackageName();                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 790 +                                                                                                                  </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 791          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span  style=""> 792                                                                                                                    </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 793          /* do not display messages from &quot;android&quot;                                                                 </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 794           * This includes keyboard selection message, usb connection messages, etc                                 </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 795           * Hope it does not filter out too much, we will see...                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 796           */                                                                                                       </span>
<span  style=""> 797                                                                                                                    </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 798          if (source.equals(&quot;android&quot;) ||                                                                           </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 799                  source.equals(&quot;com.android.systemui&quot;) ||                                                          </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 800                  source.equals(&quot;com.android.dialer&quot;) ||                                                            </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 801                  source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                                        </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 802              LOG.info(&quot;Ignoring notification, is a system event&quot;);                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 803              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804          }                                                                                                         </span>
<span  style=""> 805                                                                                                                    </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 806          if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                                    </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 807                  source.equals(&quot;com.android.mms&quot;) ||                                                               </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 808                  source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                                </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 809                  source.equals(&quot;com.android.messaging&quot;) ||                                                         </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 810                  source.equals(&quot;org.smssecure.smssecure&quot;)) {                                                       </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 811              if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {                   </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 812                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814          }                                                                                                         </span>
<span  style=""> 815                                                                                                                    </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 816          if (GBApplication.appIsNotifBlacklisted(source)) {                                                        </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 817              LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 818              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819          }                                                                                                         </span>
<span  style=""> 820                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 821          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822      }                                                                                                             </span>
<span  style=""> 823                                                                                                                    </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 824 -    private boolean shouldIgnoreNotification(Notification notification, String source) {                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 825 -                                                                                                                  </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 826 -        MediaSessionCompat.Token mediaSession = getMediaSession(notification);                                    </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 827 -        //try to handle media session notifications                                                               </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 828 -        if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                                 </span>

<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 829 -            return true;                                                                                          </span>
<span class="2810158062458488939" onmouseenter="enter('2810158062458488939');" onmouseout="out('2810158062458488939');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 830 +    private boolean shouldIgnoreNotification(StatusBarNotification sbn) {                                         </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 831 +        Notification notification = sbn.getNotification();                                                        </span>
<span class="3423191584357118633" onmouseenter="enter('3423191584357118633');" onmouseout="out('3423191584357118633');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 832 +        String source = sbn.getPackageName();                                                                     </span>
<span  style=""> 833                                                                                                                    </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 834          NotificationType type = AppNotificationType.getInstance().get(source);                                    </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 835          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 835          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NotificatioðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 836          //some Apps always mark their notifcations as read-only                                                   </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 837          if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                                      </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 838                  type != NotificationType.WECHAT &amp;&amp;                                                                </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 839                  type != NotificationType.OUTLOOK &amp;&amp;                                                               </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""> 840                  type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109</span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 841              LOG.info(&quot;local only&quot;);                                                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 842              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843          }                                                                                                         </span>
<span  style=""> 844                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 845          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 846          if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                                     </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 847              PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                           </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 848              if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                              </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""> 849  //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 850                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 851              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852          }                                                                                                         </span>
<span  style=""> 853                                                                                                                    </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 854          return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;         </span>
<span  style=""> 855                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856      }                                                                                                             </span>
<span  style=""> 857                                                                                                                    </span>
<span  style=""> 858                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 859      /**                                                                                                           </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 860       * Get the notification color that should be used for this Pebble notification.                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 861       *                                                                                                            </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 862       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 862       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColorðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 863       *                                                                                                            </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 864       * See Issue #815 on GitHub to see how notification colors are set.                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 865       *                                                                                                            </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 866       * @param notificationSpec The NotificationSpec to read from.                                                 </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 867       * @return Returns a PebbleColor that best represents this notification.                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 868       */                                                                                                           </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 869      private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                               </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 870          String appId = notificationSpec.sourceAppId;                                                              </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 871          NotificationType existingType = notificationSpec.type;                                                    </span>
<span  style=""> 872                                                                                                                    </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 873          // If the notification type is known, return the associated color.                                        </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 874          if (existingType != NotificationType.UNKNOWN) {                                                           </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 875              return existingType.color;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876          }                                                                                                         </span>
<span  style=""> 877                                                                                                                    </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 878          // Otherwise, we go and attempt to find the color from the app icon.                                      </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 879          Drawable icon;                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 880          try {                                                                                                     </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 881              icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                         </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 882              Objects.requireNonNull(icon);                                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 883          } catch (Exception ex) {                                                                                  </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 884              // If we can&#x27;t get the icon, we go with the default defined above.                                    </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 885              LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                                </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 886              return PebbleColor.IslamicGreen;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 887          }                                                                                                         </span>
<span  style=""> 888                                                                                                                    </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 889          Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                             </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 890          int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                                    </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 891                  .generate()                                                                                       </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 892                  .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                                    </span>
<span  style=""> 893                                                                                                                    </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 894          return PebbleUtils.getPebbleColor(iconPrimaryColor);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 895      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 896  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            